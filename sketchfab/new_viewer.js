Model = function()
{
    this.verts = [];
    this.normals = [];
    this.uvs = [];
    this.indices = [];

    this.textureSrc = [];
    this.instanceID = -1;
};

var gNumTotalModels = 0;
var gTextureSrc = null;
var gTextureImageData = null;
var gModels = [];

function checkModelCreated(obj)
{
    var primitives = obj._geometry._primitives;
    var created = false;
    for (var i = 0; i < primitives.length; i++) {
        var primitive = primitives[i];
        if (primitive.indices._gl) {
            created = true;
            break;
        }
    }

    return created;
}

function saveModel(obj)
{
    var model = new Model();
    model.instanceID = obj._geometry._primitives[0].indices._instanceID;

    var boundingBox = obj._geometry._boundingBox;
    var boundX = boundingBox._max[0] - boundingBox._min[0];
    var boundY = boundingBox._max[1] - boundingBox._min[1];
    var boundZ = boundingBox._max[2] - boundingBox._min[2];

    var modelScale = 1.0 / boundX;
    if (boundY > boundX && boundY > boundZ)
    {
        modelScale = 1.0 / boundY;
    }
    else if (boundZ > boundX && boundZ > boundY)
    {
        modelScale = 1.0 / boundZ;
    }

    var dataOutput = 'g model\n';
    var materialOutput = 'newmtl material0\nKa 1.000000 1.000000 1.000000\nKd 1.000000 1.000000 1.000000\n\nKs 0.000000 0.000000 0.000000\nTr 1.000000\nillum 1\nNs 0.000000';

    var vertices = obj._geometry._attributes['Vertex']._elements;
    for (var i = 0; i < vertices.length; i += 3) {
        model.verts.push(vertices[i] * modelScale);
        model.verts.push(vertices[i + 1] * modelScale);
        model.verts.push(vertices[i + 2] * modelScale);

        dataOutput += 'v ' + (vertices[i] * modelScale) + ' ' + (vertices[i + 2] * modelScale) + ' ' + (vertices[i + 1] * modelScale) + '\n';
    }

    var uvs = null;
    for (var key in obj._geometry._attributes)
    {
        if (obj._geometry._attributes.hasOwnProperty(key))
        {
            if(key.indexOf('TexCoord') != -1)
            {
                uvs = obj._geometry._attributes[key]._elements;
                break;
            }
        }
    }

    for (var i = 0; i < uvs.length; i += 2) {
        model.uvs.push(uvs[i]);
        model.uvs.push(uvs[i + 1]);

        dataOutput += 'vt ' + uvs[i] + ' ' + uvs[i + 1] + '\n';
    }

    if ('Normal' in obj._geometry._attributes) {
        var normals = obj._geometry._attributes['Normal']._elements;
        for (var i = 0; i < normals.length; i += 3) {
            model.normals.push(normals[i]);
            model.normals.push(normals[i + 1]);
            model.normals.push(normals[i + 2]);

            dataOutput += 'vn ' + normals[i] + ' ' + normals[i + 2] + ' ' + normals[i + 1] + '\n';
        }
    }

    dataOutput += 'usemtl material0\n'

    var primitives = obj._geometry._primitives;
    for (var i = 0; i < primitives.length; i++) {
        var primitive = primitives[i];

        var indices = [];
        if (primitive.mode == 4) {
            // triangle
            for (var j = 0; j < primitive.indices._elements.length; j += 3) {
                if (primitive.indices._elements[j] != primitive.indices._elements[j + 1] &&
                    primitive.indices._elements[j + 1] != primitive.indices._elements[j + 2] &&
                    primitive.indices._elements[j + 2] != primitive.indices._elements[j]) {
                    var v0 = parseInt(primitive.indices._elements[j]) + 1;
                    var v1 = parseInt(primitive.indices._elements[j + 1]) + 1;
                    var v2 = parseInt(primitive.indices._elements[j + 2]) + 1;

                    dataOutput += 'f ';
                    dataOutput += v0 + '/' + v0 + '/' + v0 + ' ';
                    dataOutput += v1 + '/' + v1 + '/' + v1 + ' ';
                    dataOutput += v2 + '/' + v2 + '/' + v2 + '\n';

                    model.indices.push(v0);
                    model.indices.push(v1);
                    model.indices.push(v2);
                }
            }
        }
        else if (primitive.mode == 5) {
            // tri strip
            for (var j = 0; j < primitive.indices._elements.length; j++) {
                if (j >= primitive.indices._elements.length - 2) {
                    break;
                }

                if (primitive.indices._elements[j] != primitive.indices._elements[j + 1] &&
                    primitive.indices._elements[j + 1] != primitive.indices._elements[j + 2] &&
                    primitive.indices._elements[j + 2] != primitive.indices._elements[j]) {
                    var v0 = parseInt(primitive.indices._elements[j]) + 1;
                    var v1 = parseInt(primitive.indices._elements[j + 1]) + 1;
                    var v2 = parseInt(primitive.indices._elements[j + 2]) + 1;

                    dataOutput += 'f ';
                    dataOutput += v0 + '/' + v0 + '/' + v0 + ' ';
                    dataOutput += v1 + '/' + v1 + '/' + v1 + ' ';
                    dataOutput += v2 + '/' + v2 + '/' + v2 + '\n';
                }
            }
        }

    }


    var a = window.document.createElement('a');
    a.href = window.URL.createObjectURL(new Blob([dataOutput], { type: 'text/plain' }));
    a.download = 'new_model_' + gNumTotalModels + '.obj';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    a = window.document.createElement('a');
    a.href = window.URL.createObjectURL(new Blob([materialOutput], { type: 'text/plain' }));
    a.download = 'new_model_' + gNumTotalModels + '.mtl';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    console.log('new model ' + a.download);

    gModels.push(model);

    ++gNumTotalModels;
}

function saveImageSrc(arguments)
{
    if (arguments[arguments.length - 1] != null && arguments[arguments.length - 1] instanceof Image) {
        var image = arguments[arguments.length - 1];
        var imageSrc = new String(image.src);
        var baseName = imageSrc.substring(imageSrc.lastIndexOf('/') + 1);
        var extension = imageSrc.substring(imageSrc.lastIndexOf('.') + 1);

        if (gTextureSrc == null)
        {
            gTextureSrc = new Array();
        }

        gTextureSrc.push(image.src);

        console.log('image src = ' + image.src + ' (' + image.width + ', ' + image.height + ')');
    }
    /*else {
        gTextureImageData = new Array();
        for (var i = 0; i < arguments[arguments.length - 1].length; i++) {
            gTextureImageData.push(arguments[arguments.length - 1][i]);
        }
    }*/
}

function setModelTexture(obj)
{
    for (var i = 0; i < gModels.length; i++) {
        var model = gModels[i];
        if (model.instanceID == obj._geometry._primitives[0].indices._instanceID) {
            if (gTextureSrc) {
                for (var j = 0; j < gTextureSrc.length; j++) {
                    model.textureSrc.push(gTextureSrc[j]);
                }
            }

            break;
        }
    }

    gTextureSrc = new Array();
    gTextureImageData = null;
}

webpackJsonp([49], Array(241).concat([function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(242)
      , a = i(243)
      , s = i(216)
      , o = i(244)
      , u = i(249)
      , l = i(233)
      , c = i(251)
      , h = i(239)
      , d = i(252)
      , p = i(253)
      , f = a.Loader.extend({
        getSource: function(t) {
            return {
                src: {
                    type: "code",
                    obj: window.nunjucksPrecompiled[t]
                },
                path: t
            }
        }
    })
      , g = new a.Environment([new f],{
        autoescape: !0
    });
    g.addFilter("log", function(t) {
        return console.log("[Nunjucks] : ", t),
        t
    }),
    g.addFilter("urlize", p.urlize),
    g.addFilter("best_fit", c),
    g.addFilter("iterable", function(t) {
        return Array.isArray(t) ? t : [t]
    }),
    g.addFilter("slugify", p.slugify),
    g.addFilter("call_macro_by_name", function(t) {
        var e = this.ctx[t]
          , i = Array.prototype.slice.call(arguments, 1);
        if (!e)
            throw new Error('Missing macro "' + t + '"');
        return e.apply(this, i)
    }),
    g.addFilter("user_profile_filled", function(t) {
        return "avatar-blue" !== t.avatars.name && "avatar-orange" !== t.avatars.name && "avatar-grey" !== t.avatars.name && (t.biography || t.tagline || t.city || t.country) && (t.website || t.twitterUsername || t.linkedinUsername || t.facebookUsername)
    }),
    g.addFilter("print_suggestion_verb", function(t, e) {
        var i = "";
        return 0 === t && (i = e.displayName + " is a <b>popular</b> user"),
        10 === t && (i = "You <b>liked</b> their models :"),
        20 === t && (i = "You share a common <b>skill</b> :"),
        30 === t && (i = "You share a common <b>interest</b> :"),
        40 === t && (i = "Your profiles are similar."),
        a.runtime.markSafe(i)
    }),
    g.addFilter("print_suggestion_target", function(t, e) {
        if (0 === e)
            return "";
        if (10 === e) {
            var i = [];
            return t.forEach(function(t) {
                var e = n('<a href="/models/' + t.uid + '">' + t.name + "</a>");
                i.push(n("<div>").append(e).html())
            }),
            a.runtime.markSafe(i.join(", "))
        }
        return 20 === e ? t.name : 30 === e ? t.name : 40 === e ? "" : void 0
    });
    var m;
    g.addFilter("skill_slug_to_name", function(t) {
        return m || (m = new u,
        m.fetch({
            immediate: !0
        })),
        m.findWhere({
            slug: t
        }).get("name")
    });
    var v;
    g.addFilter("category_uid_to_name", function(t) {
        v || (v = new o,
        v.fetch({
            immediate: !0
        }));
        var e = v.findWhere({
            uid: t
        })
          , i = e.get("name");
        return e.get("parent") && (i = v.findWhere({
            uid: e.get("parent")
        }).get("name ") + "/" + i),
        i
    }),
    g.addFilter("underscorify", p.underscorify),
    g.addFilter("image_container", function(t, e, i, r, s, o) {
        var u = g.getFilter("best_fit")(t, e, i)
          , l = ""
          , c = u ? {
            backgroundImage: "url(" + u + ")"
        } : {}
          , h = n("<div/>").attr("class", "image-container").css({
            width: r ? "100%" : e
        });
        return o ? (l = n("<div/>").attr("class", "model-card-placeholder")[0].outerHTML,
        h.attr("data-background", u)) : h.css(c),
        a.runtime.markSafe(l + h.append(n("<div/>").css({
            paddingTop: i / e * 100 + "%"
        }))[0].outerHTML)
    }),
    g.addFilter("query_string", function(t, e) {
        var i = document.createElement("a");
        return i.href = t,
        Object.keys(e).length && (i.search = "?" + h.craft(h.reset(i.search, e))),
        i.href
    }),
    g.addFilter("first_n", function(t, e) {
        return t.slice(0, e)
    }),
    g.addFilter("fill_null", function(t, e) {
        for (var i = t.slice(); i.length < e; )
            i.push(null);
        return i
    }),
    g.addFilter("prettify_text", function(t, e) {
        var i = g.getFilter("striptags")(t)
          , n = g.getFilter("urlize")(i, e);
        return n
    }),
    g.addFilter("paragraphy", p.paragraphy),
    g.addFilter("striptags", p.stripTags),
    g.addFilter("humanize_number", function(t) {
        var e = parseFloat(t)
          , i = [3, 6, 9, 12, 15]
          , n = ["k", "M", "B", "T", "P"];
        if (!e)
            return t;
        var r = e < 0 ? "-" : ""
          , a = Math.abs(e);
        if (a < 1e3)
            return e;
        for (var s = 0, o = i.length; s < o; ++s)
            if (a < 1e3 * Math.pow(10, i[s])) {
                var u = a / Math.pow(10, i[s])
                  , l = Math.floor(u);
                return u !== l ? r + u.toString(10).substr(0, u.toString(10).indexOf(".") + 2) + n[s] : r + l + n[s]
            }
        return e < 0 ? "1000- P" : "1000+ P"
    }),
    g.addFilter("pluralize", p.pluralize),
    g.addFilter("merge", function(t, e) {
        return s.extend({}, t, e)
    }),
    g.addFilter("json_data", function(t) {
        return JSON.stringify(t).replace(/<\//g, "<\\/")
    }),
    g.addFilter("format_date", function(t, e) {
        var i;
        return i = "full" === e ? "YYYY/MM/DD HH:mm" : "L",
        r.utc(t).format(i)
    }),
    g.addFilter("max", function(t) {
        return Math.max.apply(Math, t)
    }),
    g.addFilter("min", function(t) {
        return Math.min.apply(Math, t)
    }),
    g.addFilter("time_ago", function(t) {
        return d.timeAgo(r.utc(t).toDate())
    }),
    g.addFilter("seconds_to_duration", function(t) {
        return r.utc(1e3 * parseFloat(t)).format("mm:ss")
    }),
    g.addFilter("can_upgrade_to_pro", function(t) {
        return new l(t).canUpgradeToPro()
    }),
    g.addFilter("can_protect_models", function(t) {
        return new l(t).canProtectModels()
    });
    var _ = g.getFilter("trim");
    g.addFilter("trim", function(t) {
        return null === t ? "" : _(t)
    }),
    t.exports = {
        get: function(t, e) {
            var i = function(e) {
                return g.render(t + ".jinja", e)
            };
            return e ? i(e) : i
        },
        getFromString: function(t, e) {
            var i = function(e) {
                return g.renderString(t, e)
            };
            return e ? i(e) : i
        },
        getFromMacro: function(t, e, i) {
            Array.isArray(t) && (i = e,
            e = t[1],
            t = t[0]);
            var n = function(i) {
                return g.renderString(["{%- from source import " + e + " -%}", "{{ " + e + "(" + i.map(function(t, e) {
                    return "parameters[ " + e + " ]"
                }).join(",") + ") }}"].join("\n"), {
                    source: t + ".jinja",
                    parameters: i
                })
            };
            return i ? n(i) : n
        },
        equal: function() {
            var t, e, i;
            return "object" == typeof arguments[1] ? (t = arguments[0],
            e = arguments[1],
            i = Array.prototype.slice.call(arguments, 2)) : (t = arguments[0],
            e = {},
            i = Array.prototype.slice.call(arguments, 1)),
            equal.apply(void 0, [this.getFromString(t, e)].concat(i))
        }
    }
}
, function(t, e, i) {
    var n, r;
    //! moment.js
    //! version : 2.2.1
    //! authors : Tim Wood, Iskren Chernev, Moment.js contributors
    //! license : MIT
    //! momentjs.com
    (function(i) {
        function a(t, e) {
            return function(i) {
                return d(t.call(this, i), e)
            }
        }
        function s(t, e) {
            return function(i) {
                return this.lang().ordinal(t.call(this, i), e)
            }
        }
        function o() {}
        function u(t) {
            c(this, t)
        }
        function l(t) {
            var e = t.years || t.year || t.y || 0
              , i = t.months || t.month || t.M || 0
              , n = t.weeks || t.week || t.w || 0
              , r = t.days || t.day || t.d || 0
              , a = t.hours || t.hour || t.h || 0
              , s = t.minutes || t.minute || t.m || 0
              , o = t.seconds || t.second || t.s || 0
              , u = t.milliseconds || t.millisecond || t.ms || 0;
            this._input = t,
            this._milliseconds = +u + 1e3 * o + 6e4 * s + 36e5 * a,
            this._days = +r + 7 * n,
            this._months = +i + 12 * e,
            this._data = {},
            this._bubble()
        }
        function c(t, e) {
            for (var i in e)
                e.hasOwnProperty(i) && (t[i] = e[i]);
            return t
        }
        function h(t) {
            return t < 0 ? Math.ceil(t) : Math.floor(t)
        }
        function d(t, e) {
            for (var i = t + ""; i.length < e; )
                i = "0" + i;
            return i
        }
        function p(t, e, i, n) {
            var r, a, s = e._milliseconds, o = e._days, u = e._months;
            s && t._d.setTime(+t._d + s * i),
            (o || u) && (r = t.minute(),
            a = t.hour()),
            o && t.date(t.date() + o * i),
            u && t.month(t.month() + u * i),
            s && !n && G.updateOffset(t),
            (o || u) && (t.minute(r),
            t.hour(a))
        }
        function f(t) {
            return "[object Array]" === Object.prototype.toString.call(t)
        }
        function g(t, e) {
            var i, n = Math.min(t.length, e.length), r = Math.abs(t.length - e.length), a = 0;
            for (i = 0; i < n; i++)
                ~~t[i] !== ~~e[i] && a++;
            return a + r
        }
        function m(t) {
            return t ? dt[t] || t.toLowerCase().replace(/(.)s$/, "$1") : t
        }
        function v(t, e) {
            return e.abbr = t,
            W[t] || (W[t] = new o),
            W[t].set(e),
            W[t]
        }
        function _(t) {
            delete W[t]
        }
        function b(t) {
            if (!t)
                return G.fn._lang;
            if (!W[t] && q)
                try {
                    !function() {
                        var t = new Error('Cannot find module "./lang"');
                        throw t.code = "MODULE_NOT_FOUND",
                        t
                    }()
                } catch (e) {
                    return G.fn._lang
                }
            return W[t] || G.fn._lang
        }
        function x(t) {
            return t.match(/\[.*\]/) ? t.replace(/^\[|\]$/g, "") : t.replace(/\\/g, "")
        }
        function A(t) {
            var e, i, n = t.match(X);
            for (e = 0,
            i = n.length; e < i; e++)
                mt[n[e]] ? n[e] = mt[n[e]] : n[e] = x(n[e]);
            return function(r) {
                var a = "";
                for (e = 0; e < i; e++)
                    a += n[e]instanceof Function ? n[e].call(r, t) : n[e];
                return a
            }
        }
        function y(t, e) {
            return e = S(e, t.lang()),
            pt[e] || (pt[e] = A(e)),
            pt[e](t)
        }
        function S(t, e) {
            function i(t) {
                return e.longDateFormat(t) || t
            }
            for (var n = 5; n-- && (K.lastIndex = 0,
            K.test(t)); )
                t = t.replace(K, i);
            return t
        }
        function C(t, e) {
            switch (t) {
            case "DDDD":
                return $;
            case "YYYY":
                return tt;
            case "YYYYY":
                return et;
            case "S":
            case "SS":
            case "SSS":
            case "DDD":
                return Z;
            case "MMM":
            case "MMMM":
            case "dd":
            case "ddd":
            case "dddd":
                return it;
            case "a":
            case "A":
                return b(e._l)._meridiemParse;
            case "X":
                return at;
            case "Z":
            case "ZZ":
                return nt;
            case "T":
                return rt;
            case "MM":
            case "DD":
            case "YY":
            case "HH":
            case "hh":
            case "mm":
            case "ss":
            case "M":
            case "D":
            case "d":
            case "H":
            case "h":
            case "m":
            case "s":
                return J;
            default:
                return new RegExp(t.replace("\\", ""))
            }
        }
        function M(t) {
            var e = (nt.exec(t) || [])[0]
              , i = (e + "").match(lt) || ["-", 0, 0]
              , n = +(60 * i[1]) + ~~i[2];
            return "+" === i[0] ? -n : n
        }
        function w(t, e, i) {
            var n, r = i._a;
            switch (t) {
            case "M":
            case "MM":
                null != e && (r[1] = ~~e - 1);
                break;
            case "MMM":
            case "MMMM":
                n = b(i._l).monthsParse(e),
                null != n ? r[1] = n : i._isValid = !1;
                break;
            case "D":
            case "DD":
                null != e && (r[2] = ~~e);
                break;
            case "DDD":
            case "DDDD":
                null != e && (r[1] = 0,
                r[2] = ~~e);
                break;
            case "YY":
                r[0] = ~~e + (~~e > 68 ? 1900 : 2e3);
                break;
            case "YYYY":
            case "YYYYY":
                r[0] = ~~e;
                break;
            case "a":
            case "A":
                i._isPm = b(i._l).isPM(e);
                break;
            case "H":
            case "HH":
            case "h":
            case "hh":
                r[3] = ~~e;
                break;
            case "m":
            case "mm":
                r[4] = ~~e;
                break;
            case "s":
            case "ss":
                r[5] = ~~e;
                break;
            case "S":
            case "SS":
            case "SSS":
                r[6] = ~~(1e3 * ("0." + e));
                break;
            case "X":
                i._d = new Date(1e3 * parseFloat(e));
                break;
            case "Z":
            case "ZZ":
                i._useUTC = !0,
                i._tzm = M(e)
            }
            null == e && (i._isValid = !1)
        }
        function T(t) {
            var e, i, n, r = [];
            if (!t._d) {
                for (n = I(t),
                e = 0; e < 3 && null == t._a[e]; ++e)
                    t._a[e] = r[e] = n[e];
                for (; e < 7; e++)
                    t._a[e] = r[e] = null == t._a[e] ? 2 === e ? 1 : 0 : t._a[e];
                r[3] += ~~((t._tzm || 0) / 60),
                r[4] += ~~((t._tzm || 0) % 60),
                i = new Date(0),
                t._useUTC ? (i.setUTCFullYear(r[0], r[1], r[2]),
                i.setUTCHours(r[3], r[4], r[5], r[6])) : (i.setFullYear(r[0], r[1], r[2]),
                i.setHours(r[3], r[4], r[5], r[6])),
                t._d = i
            }
        }
        function E(t) {
            var e = t._i;
            t._d || (t._a = [e.years || e.year || e.y, e.months || e.month || e.M, e.days || e.day || e.d, e.hours || e.hour || e.h, e.minutes || e.minute || e.m, e.seconds || e.second || e.s, e.milliseconds || e.millisecond || e.ms],
            T(t))
        }
        function I(t) {
            var e = new Date;
            return t._useUTC ? [e.getUTCFullYear(), e.getUTCMonth(), e.getUTCDate()] : [e.getFullYear(), e.getMonth(), e.getDate()]
        }
        function k(t) {
            var e, i, n, r = b(t._l), a = "" + t._i;
            for (n = S(t._f, r).match(X),
            t._a = [],
            e = 0; e < n.length; e++)
                i = (C(n[e], t).exec(a) || [])[0],
                i && (a = a.slice(a.indexOf(i) + i.length)),
                mt[n[e]] && w(n[e], i, t);
            a && (t._il = a),
            t._isPm && t._a[3] < 12 && (t._a[3] += 12),
            t._isPm === !1 && 12 === t._a[3] && (t._a[3] = 0),
            T(t)
        }
        function F(t) {
            var e, i, n, r, a, s = 99;
            for (r = 0; r < t._f.length; r++)
                e = c({}, t),
                e._f = t._f[r],
                k(e),
                i = new u(e),
                a = g(e._a, i.toArray()),
                i._il && (a += i._il.length),
                a < s && (s = a,
                n = i);
            c(t, n)
        }
        function D(t) {
            var e, i = t._i, n = st.exec(i);
            if (n) {
                for (t._f = "YYYY-MM-DD" + (n[2] || " "),
                e = 0; e < 4; e++)
                    if (ut[e][1].exec(i)) {
                        t._f += ut[e][0];
                        break
                    }
                nt.exec(i) && (t._f += " Z"),
                k(t)
            } else
                t._d = new Date(i)
        }
        function N(t) {
            var e = t._i
              , n = Y.exec(e);
            e === i ? t._d = new Date : n ? t._d = new Date((+n[1])) : "string" == typeof e ? D(t) : f(e) ? (t._a = e.slice(0),
            T(t)) : e instanceof Date ? t._d = new Date((+e)) : "object" == typeof e ? E(t) : t._d = new Date(e)
        }
        function R(t, e, i, n, r) {
            return r.relativeTime(e || 1, !!i, t, n)
        }
        function P(t, e, i) {
            var n = j(Math.abs(t) / 1e3)
              , r = j(n / 60)
              , a = j(r / 60)
              , s = j(a / 24)
              , o = j(s / 365)
              , u = n < 45 && ["s", n] || 1 === r && ["m"] || r < 45 && ["mm", r] || 1 === a && ["h"] || a < 22 && ["hh", a] || 1 === s && ["d"] || s <= 25 && ["dd", s] || s <= 45 && ["M"] || s < 345 && ["MM", j(s / 30)] || 1 === o && ["y"] || ["yy", o];
            return u[2] = e,
            u[3] = t > 0,
            u[4] = i,
            R.apply({}, u)
        }
        function L(t, e, i) {
            var n, r = i - e, a = i - t.day();
            return a > r && (a -= 7),
            a < r - 7 && (a += 7),
            n = G(t).add("d", a),
            {
                week: Math.ceil(n.dayOfYear() / 7),
                year: n.year()
            }
        }
        function O(t) {
            var e = t._i
              , i = t._f;
            return null === e || "" === e ? null : ("string" == typeof e && (t._i = e = b().preparse(e)),
            G.isMoment(e) ? (t = c({}, e),
            t._d = new Date((+e._d))) : i ? f(i) ? F(t) : k(t) : N(t),
            new u(t))
        }
        function V(t, e) {
            G.fn[t] = G.fn[t + "s"] = function(t) {
                var i = this._isUTC ? "UTC" : "";
                return null != t ? (this._d["set" + i + e](t),
                G.updateOffset(this),
                this) : this._d["get" + i + e]()
            }
        }
        function B(t) {
            G.duration.fn[t] = function() {
                return this._data[t]
            }
        }
        function U(t, e) {
            G.duration.fn["as" + t] = function() {
                return +this / e
            }
        }
        for (var G, z, H = "2.2.1", j = Math.round, W = {}, q = "undefined" != typeof t && t.exports, Y = /^\/?Date\((\-?\d+)/i, Q = /(\-)?(?:(\d*)\.)?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/, X = /(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g, K = /(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g, J = /\d\d?/, Z = /\d{1,3}/, $ = /\d{3}/, tt = /\d{1,4}/, et = /[+\-]?\d{1,6}/, it = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i, nt = /Z|[\+\-]\d\d:?\d\d/i, rt = /T/i, at = /[\+\-]?\d+(\.\d{1,3})?/, st = /^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/, ot = "YYYY-MM-DDTHH:mm:ssZ", ut = [["HH:mm:ss.S", /(T| )\d\d:\d\d:\d\d\.\d{1,3}/], ["HH:mm:ss", /(T| )\d\d:\d\d:\d\d/], ["HH:mm", /(T| )\d\d:\d\d/], ["HH", /(T| )\d\d/]], lt = /([\+\-]|\d\d)/gi, ct = "Date|Hours|Minutes|Seconds|Milliseconds".split("|"), ht = {
            Milliseconds: 1,
            Seconds: 1e3,
            Minutes: 6e4,
            Hours: 36e5,
            Days: 864e5,
            Months: 2592e6,
            Years: 31536e6
        }, dt = {
            ms: "millisecond",
            s: "second",
            m: "minute",
            h: "hour",
            d: "day",
            w: "week",
            W: "isoweek",
            M: "month",
            y: "year"
        }, pt = {}, ft = "DDD w W M D d".split(" "), gt = "M D H h m s w W".split(" "), mt = {
            M: function() {
                return this.month() + 1
            },
            MMM: function(t) {
                return this.lang().monthsShort(this, t)
            },
            MMMM: function(t) {
                return this.lang().months(this, t)
            },
            D: function() {
                return this.date()
            },
            DDD: function() {
                return this.dayOfYear()
            },
            d: function() {
                return this.day()
            },
            dd: function(t) {
                return this.lang().weekdaysMin(this, t)
            },
            ddd: function(t) {
                return this.lang().weekdaysShort(this, t)
            },
            dddd: function(t) {
                return this.lang().weekdays(this, t)
            },
            w: function() {
                return this.week()
            },
            W: function() {
                return this.isoWeek()
            },
            YY: function() {
                return d(this.year() % 100, 2)
            },
            YYYY: function() {
                return d(this.year(), 4)
            },
            YYYYY: function() {
                return d(this.year(), 5)
            },
            gg: function() {
                return d(this.weekYear() % 100, 2)
            },
            gggg: function() {
                return this.weekYear()
            },
            ggggg: function() {
                return d(this.weekYear(), 5)
            },
            GG: function() {
                return d(this.isoWeekYear() % 100, 2)
            },
            GGGG: function() {
                return this.isoWeekYear()
            },
            GGGGG: function() {
                return d(this.isoWeekYear(), 5)
            },
            e: function() {
                return this.weekday()
            },
            E: function() {
                return this.isoWeekday()
            },
            a: function() {
                return this.lang().meridiem(this.hours(), this.minutes(), !0)
            },
            A: function() {
                return this.lang().meridiem(this.hours(), this.minutes(), !1)
            },
            H: function() {
                return this.hours()
            },
            h: function() {
                return this.hours() % 12 || 12
            },
            m: function() {
                return this.minutes()
            },
            s: function() {
                return this.seconds()
            },
            S: function() {
                return ~~(this.milliseconds() / 100)
            },
            SS: function() {
                return d(~~(this.milliseconds() / 10), 2)
            },
            SSS: function() {
                return d(this.milliseconds(), 3)
            },
            Z: function() {
                var t = -this.zone()
                  , e = "+";
                return t < 0 && (t = -t,
                e = "-"),
                e + d(~~(t / 60), 2) + ":" + d(~~t % 60, 2)
            },
            ZZ: function() {
                var t = -this.zone()
                  , e = "+";
                return t < 0 && (t = -t,
                e = "-"),
                e + d(~~(10 * t / 6), 4)
            },
            z: function() {
                return this.zoneAbbr()
            },
            zz: function() {
                return this.zoneName()
            },
            X: function() {
                return this.unix()
            }
        }; ft.length; )
            z = ft.pop(),
            mt[z + "o"] = s(mt[z], z);
        for (; gt.length; )
            z = gt.pop(),
            mt[z + z] = a(mt[z], 2);
        for (mt.DDDD = a(mt.DDD, 3),
        c(o.prototype, {
            set: function(t) {
                var e, i;
                for (i in t)
                    e = t[i],
                    "function" == typeof e ? this[i] = e : this["_" + i] = e
            },
            _months: "January_February_March_April_May_June_July_August_September_October_November_December".split("_"),
            months: function(t) {
                return this._months[t.month()]
            },
            _monthsShort: "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),
            monthsShort: function(t) {
                return this._monthsShort[t.month()]
            },
            monthsParse: function(t) {
                var e, i, n;
                for (this._monthsParse || (this._monthsParse = []),
                e = 0; e < 12; e++)
                    if (this._monthsParse[e] || (i = G.utc([2e3, e]),
                    n = "^" + this.months(i, "") + "|^" + this.monthsShort(i, ""),
                    this._monthsParse[e] = new RegExp(n.replace(".", ""),"i")),
                    this._monthsParse[e].test(t))
                        return e
            },
            _weekdays: "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),
            weekdays: function(t) {
                return this._weekdays[t.day()]
            },
            _weekdaysShort: "Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),
            weekdaysShort: function(t) {
                return this._weekdaysShort[t.day()]
            },
            _weekdaysMin: "Su_Mo_Tu_We_Th_Fr_Sa".split("_"),
            weekdaysMin: function(t) {
                return this._weekdaysMin[t.day()]
            },
            weekdaysParse: function(t) {
                var e, i, n;
                for (this._weekdaysParse || (this._weekdaysParse = []),
                e = 0; e < 7; e++)
                    if (this._weekdaysParse[e] || (i = G([2e3, 1]).day(e),
                    n = "^" + this.weekdays(i, "") + "|^" + this.weekdaysShort(i, "") + "|^" + this.weekdaysMin(i, ""),
                    this._weekdaysParse[e] = new RegExp(n.replace(".", ""),"i")),
                    this._weekdaysParse[e].test(t))
                        return e
            },
            _longDateFormat: {
                LT: "h:mm A",
                L: "MM/DD/YYYY",
                LL: "MMMM D YYYY",
                LLL: "MMMM D YYYY LT",
                LLLL: "dddd, MMMM D YYYY LT"
            },
            longDateFormat: function(t) {
                var e = this._longDateFormat[t];
                return !e && this._longDateFormat[t.toUpperCase()] && (e = this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g, function(t) {
                    return t.slice(1)
                }),
                this._longDateFormat[t] = e),
                e
            },
            isPM: function(t) {
                return "p" === (t + "").toLowerCase().charAt(0)
            },
            _meridiemParse: /[ap]\.?m?\.?/i,
            meridiem: function(t, e, i) {
                return t > 11 ? i ? "pm" : "PM" : i ? "am" : "AM"
            },
            _calendar: {
                sameDay: "[Today at] LT",
                nextDay: "[Tomorrow at] LT",
                nextWeek: "dddd [at] LT",
                lastDay: "[Yesterday at] LT",
                lastWeek: "[Last] dddd [at] LT",
                sameElse: "L"
            },
            calendar: function(t, e) {
                var i = this._calendar[t];
                return "function" == typeof i ? i.apply(e) : i
            },
            _relativeTime: {
                future: "in %s",
                past: "%s ago",
                s: "a few seconds",
                m: "a minute",
                mm: "%d minutes",
                h: "an hour",
                hh: "%d hours",
                d: "a day",
                dd: "%d days",
                M: "a month",
                MM: "%d months",
                y: "a year",
                yy: "%d years"
            },
            relativeTime: function(t, e, i, n) {
                var r = this._relativeTime[i];
                return "function" == typeof r ? r(t, e, i, n) : r.replace(/%d/i, t)
            },
            pastFuture: function(t, e) {
                var i = this._relativeTime[t > 0 ? "future" : "past"];
                return "function" == typeof i ? i(e) : i.replace(/%s/i, e)
            },
            ordinal: function(t) {
                return this._ordinal.replace("%d", t)
            },
            _ordinal: "%d",
            preparse: function(t) {
                return t
            },
            postformat: function(t) {
                return t
            },
            week: function(t) {
                return L(t, this._week.dow, this._week.doy).week
            },
            _week: {
                dow: 0,
                doy: 6
            }
        }),
        G = function(t, e, i) {
            return O({
                _i: t,
                _f: e,
                _l: i,
                _isUTC: !1
            })
        }
        ,
        G.utc = function(t, e, i) {
            return O({
                _useUTC: !0,
                _isUTC: !0,
                _l: i,
                _i: t,
                _f: e
            }).utc()
        }
        ,
        G.unix = function(t) {
            return G(1e3 * t)
        }
        ,
        G.duration = function(t, e) {
            var i, n, r = G.isDuration(t), a = "number" == typeof t, s = r ? t._input : a ? {} : t, o = Q.exec(t);
            return a ? e ? s[e] = t : s.milliseconds = t : o && (i = "-" === o[1] ? -1 : 1,
            s = {
                y: 0,
                d: ~~o[2] * i,
                h: ~~o[3] * i,
                m: ~~o[4] * i,
                s: ~~o[5] * i,
                ms: ~~o[6] * i
            }),
            n = new l(s),
            r && t.hasOwnProperty("_lang") && (n._lang = t._lang),
            n
        }
        ,
        G.version = H,
        G.defaultFormat = ot,
        G.updateOffset = function() {}
        ,
        G.lang = function(t, e) {
            return t ? (t = t.toLowerCase(),
            t = t.replace("_", "-"),
            e ? v(t, e) : null === e ? (_(t),
            t = "en") : W[t] || b(t),
            void (G.duration.fn._lang = G.fn._lang = b(t))) : G.fn._lang._abbr
        }
        ,
        G.langData = function(t) {
            return t && t._lang && t._lang._abbr && (t = t._lang._abbr),
            b(t)
        }
        ,
        G.isMoment = function(t) {
            return t instanceof u
        }
        ,
        G.isDuration = function(t) {
            return t instanceof l
        }
        ,
        c(G.fn = u.prototype, {
            clone: function() {
                return G(this)
            },
            valueOf: function() {
                return +this._d + 6e4 * (this._offset || 0)
            },
            unix: function() {
                return Math.floor(+this / 1e3)
            },
            toString: function() {
                return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")
            },
            toDate: function() {
                return this._offset ? new Date((+this)) : this._d
            },
            toISOString: function() {
                return y(G(this).utc(), "YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")
            },
            toArray: function() {
                var t = this;
                return [t.year(), t.month(), t.date(), t.hours(), t.minutes(), t.seconds(), t.milliseconds()]
            },
            isValid: function() {
                return null == this._isValid && (this._a ? this._isValid = !g(this._a, (this._isUTC ? G.utc(this._a) : G(this._a)).toArray()) : this._isValid = !isNaN(this._d.getTime())),
                !!this._isValid
            },
            invalidAt: function() {
                var t, e = this._a, i = (this._isUTC ? G.utc(this._a) : G(this._a)).toArray();
                for (t = 6; t >= 0 && e[t] === i[t]; --t)
                    ;
                return t
            },
            utc: function() {
                return this.zone(0)
            },
            local: function() {
                return this.zone(0),
                this._isUTC = !1,
                this
            },
            format: function(t) {
                var e = y(this, t || G.defaultFormat);
                return this.lang().postformat(e)
            },
            add: function(t, e) {
                var i;
                return i = "string" == typeof t ? G.duration(+e, t) : G.duration(t, e),
                p(this, i, 1),
                this
            },
            subtract: function(t, e) {
                var i;
                return i = "string" == typeof t ? G.duration(+e, t) : G.duration(t, e),
                p(this, i, -1),
                this
            },
            diff: function(t, e, i) {
                var n, r, a = this._isUTC ? G(t).zone(this._offset || 0) : G(t).local(), s = 6e4 * (this.zone() - a.zone());
                return e = m(e),
                "year" === e || "month" === e ? (n = 432e5 * (this.daysInMonth() + a.daysInMonth()),
                r = 12 * (this.year() - a.year()) + (this.month() - a.month()),
                r += (this - G(this).startOf("month") - (a - G(a).startOf("month"))) / n,
                r -= 6e4 * (this.zone() - G(this).startOf("month").zone() - (a.zone() - G(a).startOf("month").zone())) / n,
                "year" === e && (r /= 12)) : (n = this - a,
                r = "second" === e ? n / 1e3 : "minute" === e ? n / 6e4 : "hour" === e ? n / 36e5 : "day" === e ? (n - s) / 864e5 : "week" === e ? (n - s) / 6048e5 : n),
                i ? r : h(r)
            },
            from: function(t, e) {
                return G.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)
            },
            fromNow: function(t) {
                return this.from(G(), t)
            },
            calendar: function() {
                var t = this.diff(G().zone(this.zone()).startOf("day"), "days", !0)
                  , e = t < -6 ? "sameElse" : t < -1 ? "lastWeek" : t < 0 ? "lastDay" : t < 1 ? "sameDay" : t < 2 ? "nextDay" : t < 7 ? "nextWeek" : "sameElse";
                return this.format(this.lang().calendar(e, this))
            },
            isLeapYear: function() {
                var t = this.year();
                return t % 4 === 0 && t % 100 !== 0 || t % 400 === 0
            },
            isDST: function() {
                return this.zone() < this.clone().month(0).zone() || this.zone() < this.clone().month(5).zone()
            },
            day: function(t) {
                var e = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
                return null != t ? "string" == typeof t && (t = this.lang().weekdaysParse(t),
                "number" != typeof t) ? this : this.add({
                    d: t - e
                }) : e
            },
            month: function(t) {
                var e, i = this._isUTC ? "UTC" : "";
                return null != t ? "string" == typeof t && (t = this.lang().monthsParse(t),
                "number" != typeof t) ? this : (e = this.date(),
                this.date(1),
                this._d["set" + i + "Month"](t),
                this.date(Math.min(e, this.daysInMonth())),
                G.updateOffset(this),
                this) : this._d["get" + i + "Month"]()
            },
            startOf: function(t) {
                switch (t = m(t)) {
                case "year":
                    this.month(0);
                case "month":
                    this.date(1);
                case "week":
                case "isoweek":
                case "day":
                    this.hours(0);
                case "hour":
                    this.minutes(0);
                case "minute":
                    this.seconds(0);
                case "second":
                    this.milliseconds(0)
                }
                return "week" === t ? this.weekday(0) : "isoweek" === t && this.isoWeekday(1),
                this
            },
            endOf: function(t) {
                return t = m(t),
                this.startOf(t).add("isoweek" === t ? "week" : t, 1).subtract("ms", 1)
            },
            isAfter: function(t, e) {
                return e = "undefined" != typeof e ? e : "millisecond",
                +this.clone().startOf(e) > +G(t).startOf(e)
            },
            isBefore: function(t, e) {
                return e = "undefined" != typeof e ? e : "millisecond",
                +this.clone().startOf(e) < +G(t).startOf(e)
            },
            isSame: function(t, e) {
                return e = "undefined" != typeof e ? e : "millisecond",
                +this.clone().startOf(e) === +G(t).startOf(e)
            },
            min: function(t) {
                return t = G.apply(null, arguments),
                t < this ? this : t
            },
            max: function(t) {
                return t = G.apply(null, arguments),
                t > this ? this : t
            },
            zone: function(t) {
                var e = this._offset || 0;
                return null == t ? this._isUTC ? e : this._d.getTimezoneOffset() : ("string" == typeof t && (t = M(t)),
                Math.abs(t) < 16 && (t = 60 * t),
                this._offset = t,
                this._isUTC = !0,
                e !== t && p(this, G.duration(e - t, "m"), 1, !0),
                this)
            },
            zoneAbbr: function() {
                return this._isUTC ? "UTC" : ""
            },
            zoneName: function() {
                return this._isUTC ? "Coordinated Universal Time" : ""
            },
            hasAlignedHourOffset: function(t) {
                return t = t ? G(t).zone() : 0,
                (this.zone() - t) % 60 === 0
            },
            daysInMonth: function() {
                return G.utc([this.year(), this.month() + 1, 0]).date()
            },
            dayOfYear: function(t) {
                var e = j((G(this).startOf("day") - G(this).startOf("year")) / 864e5) + 1;
                return null == t ? e : this.add("d", t - e)
            },
            weekYear: function(t) {
                var e = L(this, this.lang()._week.dow, this.lang()._week.doy).year;
                return null == t ? e : this.add("y", t - e)
            },
            isoWeekYear: function(t) {
                var e = L(this, 1, 4).year;
                return null == t ? e : this.add("y", t - e)
            },
            week: function(t) {
                var e = this.lang().week(this);
                return null == t ? e : this.add("d", 7 * (t - e))
            },
            isoWeek: function(t) {
                var e = L(this, 1, 4).week;
                return null == t ? e : this.add("d", 7 * (t - e))
            },
            weekday: function(t) {
                var e = (this._d.getDay() + 7 - this.lang()._week.dow) % 7;
                return null == t ? e : this.add("d", t - e)
            },
            isoWeekday: function(t) {
                return null == t ? this.day() || 7 : this.day(this.day() % 7 ? t : t - 7)
            },
            get: function(t) {
                return t = m(t),
                this[t.toLowerCase()]()
            },
            set: function(t, e) {
                t = m(t),
                this[t.toLowerCase()](e)
            },
            lang: function(t) {
                return t === i ? this._lang : (this._lang = b(t),
                this)
            }
        }),
        z = 0; z < ct.length; z++)
            V(ct[z].toLowerCase().replace(/s$/, ""), ct[z]);
        V("year", "FullYear"),
        G.fn.days = G.fn.day,
        G.fn.months = G.fn.month,
        G.fn.weeks = G.fn.week,
        G.fn.isoWeeks = G.fn.isoWeek,
        G.fn.toJSON = G.fn.toISOString,
        c(G.duration.fn = l.prototype, {
            _bubble: function() {
                var t, e, i, n, r = this._milliseconds, a = this._days, s = this._months, o = this._data;
                o.milliseconds = r % 1e3,
                t = h(r / 1e3),
                o.seconds = t % 60,
                e = h(t / 60),
                o.minutes = e % 60,
                i = h(e / 60),
                o.hours = i % 24,
                a += h(i / 24),
                o.days = a % 30,
                s += h(a / 30),
                o.months = s % 12,
                n = h(s / 12),
                o.years = n
            },
            weeks: function() {
                return h(this.days() / 7)
            },
            valueOf: function() {
                return this._milliseconds + 864e5 * this._days + this._months % 12 * 2592e6 + 31536e6 * ~~(this._months / 12)
            },
            humanize: function(t) {
                var e = +this
                  , i = P(e, !t, this.lang());
                return t && (i = this.lang().pastFuture(e, i)),
                this.lang().postformat(i)
            },
            add: function(t, e) {
                var i = G.duration(t, e);
                return this._milliseconds += i._milliseconds,
                this._days += i._days,
                this._months += i._months,
                this._bubble(),
                this
            },
            subtract: function(t, e) {
                var i = G.duration(t, e);
                return this._milliseconds -= i._milliseconds,
                this._days -= i._days,
                this._months -= i._months,
                this._bubble(),
                this
            },
            get: function(t) {
                return t = m(t),
                this[t.toLowerCase() + "s"]()
            },
            as: function(t) {
                return t = m(t),
                this["as" + t.charAt(0).toUpperCase() + t.slice(1) + "s"]()
            },
            lang: G.fn.lang
        });
        for (z in ht)
            ht.hasOwnProperty(z) && (U(z, ht[z]),
            B(z.toLowerCase()));
        U("Weeks", 6048e5),
        G.duration.fn.asMonths = function() {
            return (+this - 31536e6 * this.years()) / 2592e6 + 12 * this.years()
        }
        ,
        G.lang("en", {
            ordinal: function(t) {
                var e = t % 10
                  , i = 1 === ~~(t % 100 / 10) ? "th" : 1 === e ? "st" : 2 === e ? "nd" : 3 === e ? "rd" : "th";
                return t + i
            }
        }),
        G.lang("en"),
        q && (t.exports = G),
        "undefined" == typeof ender && (this.moment = G),
        n = [],
        r = function() {
            return G
        }
        .apply(e, n),
        !(r !== i && (t.exports = r))
    }
    ).call(this)
}
, function(t, e, i) {
    var n;
    !function() {
        var r = {};
        !function() {
            "use strict";
            function t(e, i, n) {
                var r = function() {};
                r.prototype = e.prototype;
                var a = new r
                  , s = /xyz/.test(function() {
                    xyz
                }) ? /\bparent\b/ : /.*/;
                n = n || {};
                for (var o in n) {
                    var u = n[o]
                      , l = a[o];
                    "function" == typeof l && "function" == typeof u && s.test(u) ? a[o] = function(t, e) {
                        return function() {
                            var i = this.parent;
                            this.parent = e;
                            var n = t.apply(this, arguments);
                            return this.parent = i,
                            n
                        }
                    }(u, l) : a[o] = u
                }
                a.typename = i;
                var c = function() {
                    a.init && a.init.apply(this, arguments)
                };
                return c.prototype = a,
                c.prototype.constructor = c,
                c.extend = function(e, i) {
                    return "object" == typeof e && (i = e,
                    e = "anonymous"),
                    t(c, e, i)
                }
                ,
                c
            }
            r.object = t(Object, "Object", {})
        }(),
        function() {
            "use strict";
            var t = Array.prototype
              , e = Object.prototype
              , i = {
                "&": "&amp;",
                '"': "&quot;",
                "'": "&#39;",
                "<": "&lt;",
                ">": "&gt;"
            }
              , n = /[&"'<>]/g
              , a = function(t) {
                return i[t]
            }
              , s = r.lib = {};
            s.withPrettyErrors = function(t, e, i) {
                try {
                    return i()
                } catch (n) {
                    if (n.Update || (n = new s.TemplateError(n)),
                    n.Update(t),
                    !e) {
                        var r = n;
                        n = new Error(r.message),
                        n.name = r.name
                    }
                    throw n
                }
            }
            ,
            s.TemplateError = function(t, e, i) {
                var n = this;
                return t instanceof Error ? (n = t,
                t = t.name + ": " + t.message) : Error.captureStackTrace && Error.captureStackTrace(n),
                n.name = "Template render error",
                n.message = t,
                n.lineno = e,
                n.colno = i,
                n.firstUpdate = !0,
                n.Update = function(t) {
                    var e = "(" + (t || "unknown path") + ")";
                    return this.firstUpdate && (this.lineno && this.colno ? e += " [Line " + this.lineno + ", Column " + this.colno + "]" : this.lineno && (e += " [Line " + this.lineno + "]")),
                    e += "\n ",
                    this.firstUpdate && (e += " "),
                    this.message = e + (this.message || ""),
                    this.firstUpdate = !1,
                    this
                }
                ,
                n
            }
            ,
            s.TemplateError.prototype = Error.prototype,
            s.escape = function(t) {
                return t.replace(n, a)
            }
            ,
            s.isFunction = function(t) {
                return "[object Function]" === e.toString.call(t)
            }
            ,
            s.isArray = Array.isArray || function(t) {
                return "[object Array]" === e.toString.call(t)
            }
            ,
            s.isString = function(t) {
                return "[object String]" === e.toString.call(t)
            }
            ,
            s.isObject = function(t) {
                return "[object Object]" === e.toString.call(t)
            }
            ,
            s.groupBy = function(t, e) {
                for (var i = {}, n = s.isFunction(e) ? e : function(t) {
                    return t[e]
                }
                , r = 0; r < t.length; r++) {
                    var a = t[r]
                      , o = n(a, r);
                    (i[o] || (i[o] = [])).push(a)
                }
                return i
            }
            ,
            s.toArray = function(t) {
                return Array.prototype.slice.call(t)
            }
            ,
            s.without = function(t) {
                var e = [];
                if (!t)
                    return e;
                for (var i = -1, n = t.length, r = s.toArray(arguments).slice(1); ++i < n; )
                    s.indexOf(r, t[i]) === -1 && e.push(t[i]);
                return e
            }
            ,
            s.extend = function(t, e) {
                for (var i in e)
                    t[i] = e[i];
                return t
            }
            ,
            s.repeat = function(t, e) {
                for (var i = "", n = 0; n < e; n++)
                    i += t;
                return i
            }
            ,
            s.each = function(e, i, n) {
                if (null != e)
                    if (t.each && e.each === t.each)
                        e.forEach(i, n);
                    else if (e.length === +e.length)
                        for (var r = 0, a = e.length; r < a; r++)
                            i.call(n, e[r], r, e)
            }
            ,
            s.map = function(e, i) {
                var n = [];
                if (null == e)
                    return n;
                if (t.map && e.map === t.map)
                    return e.map(i);
                for (var r = 0; r < e.length; r++)
                    n[n.length] = i(e[r], r);
                return e.length === +e.length && (n.length = e.length),
                n
            }
            ,
            s.asyncIter = function(t, e, i) {
                function n() {
                    r++,
                    r < t.length ? e(t[r], r, n, i) : i()
                }
                var r = -1;
                n()
            }
            ,
            s.asyncFor = function(t, e, i) {
                function n() {
                    o++;
                    var s = r[o];
                    o < a ? e(s, t[s], o, a, n) : i()
                }
                var r = s.keys(t)
                  , a = r.length
                  , o = -1;
                n()
            }
            ,
            s.indexOf = Array.prototype.indexOf ? function(t, e, i) {
                return Array.prototype.indexOf.call(t, e, i)
            }
            : function(t, e, i) {
                var n = this.length >>> 0;
                for (i = +i || 0,
                Math.abs(i) === 1 / 0 && (i = 0),
                i < 0 && (i += n,
                i < 0 && (i = 0)); i < n; i++)
                    if (t[i] === e)
                        return i;
                return -1
            }
            ,
            Array.prototype.map || (Array.prototype.map = function() {
                throw new Error("map is unimplemented for this js engine")
            }
            ),
            s.keys = function(t) {
                if (Object.prototype.keys)
                    return t.keys();
                var e = [];
                for (var i in t)
                    t.hasOwnProperty(i) && e.push(i);
                return e
            }
        }(),
        function() {
            "use strict";
            function t(t, e, i) {
                t instanceof e && i.push(t),
                t instanceof s && t.findAll(e, i)
            }
            function e(t, r) {
                function a(t, e, n) {
                    for (var r = t.split("\n"), a = 0; a < r.length; a++) {
                        if (r[a] && (n && a > 0 || !n))
                            for (var s = 0; s < e; s++)
                                i.print(" ");
                        a === r.length - 1 ? i.print(r[a]) : i.puts(r[a])
                    }
                }
                if (r = r || 0,
                a(t.typename + ": ", r),
                t instanceof u)
                    a("\n"),
                    n.each(t.children, function(t) {
                        e(t, r + 2)
                    });
                else if (t instanceof it)
                    a(t.extName + "." + t.prop),
                    a("\n"),
                    t.args && e(t.args, r + 2),
                    t.contentArgs && n.each(t.contentArgs, function(t) {
                        e(t, r + 2)
                    });
                else {
                    var o = null
                      , l = null;
                    if (t.iterFields(function(t, e) {
                        t instanceof s ? (o = o || {},
                        o[e] = t) : (l = l || {},
                        l[e] = t)
                    }),
                    l ? a(i.inspect(l, !0, null) + "\n", null, !0) : a("\n"),
                    o)
                        for (var c in o)
                            e(o[c], r + 2)
                }
            }
            var i = r.util
              , n = r.lib
              , a = r.object
              , s = a.extend("Node", {
                init: function(t, e) {
                    this.lineno = t,
                    this.colno = e;
                    for (var i = this.fields, n = 0, r = i.length; n < r; n++) {
                        var a = i[n]
                          , s = arguments[n + 2];
                        void 0 === s && (s = null),
                        this[a] = s
                    }
                },
                findAll: function(e, i) {
                    if (i = i || [],
                    this instanceof u)
                        for (var n = this.children, r = 0, a = n.length; r < a; r++)
                            t(n[r], e, i);
                    else
                        for (var s = this.fields, r = 0, a = s.length; r < a; r++)
                            t(this[s[r]], e, i);
                    return i
                },
                iterFields: function(t) {
                    n.each(this.fields, function(e) {
                        t(this[e], e)
                    }, this)
                }
            })
              , o = s.extend("Value", {
                fields: ["value"]
            })
              , u = s.extend("NodeList", {
                fields: ["children"],
                init: function(t, e, i) {
                    this.parent(t, e, i || [])
                },
                addChild: function(t) {
                    this.children.push(t)
                }
            })
              , l = u.extend("Root")
              , c = o.extend("Literal")
              , h = o.extend("Symbol")
              , d = u.extend("Group")
              , p = u.extend("Array")
              , f = s.extend("Pair", {
                fields: ["key", "value"]
            })
              , g = u.extend("Dict")
              , m = s.extend("LookupVal", {
                fields: ["target", "val"]
            })
              , v = s.extend("If", {
                fields: ["cond", "body", "else_"]
            })
              , _ = v.extend("IfAsync")
              , b = s.extend("InlineIf", {
                fields: ["cond", "body", "else_"]
            })
              , x = s.extend("For", {
                fields: ["arr", "name", "body", "else_"]
            })
              , A = x.extend("AsyncEach")
              , y = x.extend("AsyncAll")
              , S = s.extend("Macro", {
                fields: ["name", "args", "body"]
            })
              , C = S.extend("Caller")
              , M = s.extend("Import", {
                fields: ["template", "target", "withContext"]
            })
              , w = s.extend("FromImport", {
                fields: ["template", "names", "withContext"],
                init: function(t, e, i, n, r) {
                    this.parent(t, e, i, n || new u, r)
                }
            })
              , T = s.extend("FunCall", {
                fields: ["name", "args"]
            })
              , E = T.extend("Filter")
              , I = E.extend("FilterAsync", {
                fields: ["name", "args", "symbol"]
            })
              , k = g.extend("KeywordArgs")
              , F = s.extend("Block", {
                fields: ["name", "body"]
            })
              , D = s.extend("Super", {
                fields: ["blockName", "symbol"]
            })
              , N = s.extend("TemplateRef", {
                fields: ["template"]
            })
              , R = N.extend("Extends")
              , P = N.extend("Include")
              , L = s.extend("Set", {
                fields: ["targets", "value"]
            })
              , O = u.extend("Output")
              , V = c.extend("TemplateData")
              , B = s.extend("UnaryOp", {
                fields: ["target"]
            })
              , U = s.extend("BinOp", {
                fields: ["left", "right"]
            })
              , G = U.extend("In")
              , z = U.extend("Or")
              , H = U.extend("And")
              , j = B.extend("Not")
              , W = U.extend("Add")
              , q = U.extend("Sub")
              , Y = U.extend("Mul")
              , Q = U.extend("Div")
              , X = U.extend("FloorDiv")
              , K = U.extend("Mod")
              , J = U.extend("Pow")
              , Z = B.extend("Neg")
              , $ = B.extend("Pos")
              , tt = s.extend("Compare", {
                fields: ["expr", "ops"]
            })
              , et = s.extend("CompareOperand", {
                fields: ["expr", "type"]
            })
              , it = (s.extend("CustomTag", {
                init: function(t, e, i) {
                    this.lineno = t,
                    this.colno = e,
                    this.name = i
                }
            }),
            s.extend("CallExtension", {
                fields: ["extName", "prop", "args", "contentArgs"],
                init: function(t, e, i, n) {
                    this.extName = t._name || t,
                    this.prop = e,
                    this.args = i || new u,
                    this.contentArgs = n || [],
                    this.autoescape = t.autoescape
                }
            }))
              , nt = it.extend("CallExtensionAsync");
            r.nodes = {
                Node: s,
                Root: l,
                NodeList: u,
                Value: o,
                Literal: c,
                Symbol: h,
                Group: d,
                Array: p,
                Pair: f,
                Dict: g,
                Output: O,
                TemplateData: V,
                If: v,
                IfAsync: _,
                InlineIf: b,
                For: x,
                AsyncEach: A,
                AsyncAll: y,
                Macro: S,
                Caller: C,
                Import: M,
                FromImport: w,
                FunCall: T,
                Filter: E,
                FilterAsync: I,
                KeywordArgs: k,
                Block: F,
                Super: D,
                Extends: R,
                Include: P,
                Set: L,
                LookupVal: m,
                BinOp: U,
                In: G,
                Or: z,
                And: H,
                Not: j,
                Add: W,
                Sub: q,
                Mul: Y,
                Div: Q,
                FloorDiv: X,
                Mod: K,
                Pow: J,
                Neg: Z,
                Pos: $,
                Compare: tt,
                CompareOperand: et,
                CallExtension: it,
                CallExtensionAsync: nt,
                printNodes: e
            }
        }(),
        function() {
            "use strict";
            function t(t, e, r) {
                return function() {
                    var a, s = n(arguments), o = i(arguments);
                    if (s > t.length) {
                        a = Array.prototype.slice.call(arguments, 0, t.length);
                        for (var u = Array.prototype.slice.call(arguments, a.length, s), l = 0; l < u.length; l++)
                            l < e.length && (o[e[l]] = u[l]);
                        a.push(o)
                    } else if (s < t.length) {
                        a = Array.prototype.slice.call(arguments, 0, s);
                        for (var l = s; l < t.length; l++) {
                            var c = t[l];
                            a.push(o[c]),
                            delete o[c]
                        }
                        a.push(o)
                    } else
                        a = arguments;
                    return r.apply(this, a)
                }
            }
            function e(t) {
                return t.__keywords = !0,
                t
            }
            function i(t) {
                var e = t.length;
                if (e) {
                    var i = t[e - 1];
                    if (i && i.hasOwnProperty("__keywords"))
                        return i
                }
                return {}
            }
            function n(t) {
                var e = t.length;
                if (0 === e)
                    return 0;
                var i = t[e - 1];
                return i && i.hasOwnProperty("__keywords") ? e - 1 : e
            }
            function a(t) {
                return "string" != typeof t ? t : void (this.val = t)
            }
            function s(t, e) {
                return t instanceof a ? new a(e) : e.toString()
            }
            function o(t) {
                var e = typeof t;
                return "string" === e ? new a(t) : "function" !== e ? t : function() {
                    var e = t.apply(this, arguments);
                    return "string" == typeof e ? new a(e) : e
                }
            }
            function u(t, e) {
                return t = void 0 !== t && null !== t ? t : "",
                e && "string" == typeof t && (t = g.escape(t)),
                t
            }
            function l(t, e) {
                return t = t || {},
                "function" == typeof t[e] ? function() {
                    return t[e].apply(t, arguments)
                }
                : t[e]
            }
            function c(t, e, i) {
                if (!t)
                    throw new Error("Unable to call `" + e + "`, which is undefined or falsey");
                if ("function" != typeof t)
                    throw new Error("Unable to call `" + e + "`, which is not a function");
                return t.apply(this, i)
            }
            function h(t, e, i) {
                var n = e.lookup(i);
                return void 0 !== n && null !== n ? n : t.lookup(i)
            }
            function d(t, e, i) {
                return t.lineno ? t : new g.TemplateError(t,e,i)
            }
            function p(t, e, i, n) {
                if (g.isArray(t)) {
                    var r = t.length;
                    g.asyncIter(t, function(t, n, a) {
                        switch (e) {
                        case 1:
                            i(t, n, r, a);
                            break;
                        case 2:
                            i(t[0], t[1], n, r, a);
                            break;
                        case 3:
                            i(t[0], t[1], t[2], n, r, a);
                            break;
                        default:
                            t.push(n, a),
                            i.apply(this, t)
                        }
                    }, n)
                } else
                    g.asyncFor(t, function(t, e, n, r, a) {
                        i(t, e, n, r, a)
                    }, n)
            }
            function f(t, e, i, n) {
                function r(t, e) {
                    o++,
                    s[t] = e,
                    o === a && n(null, s.join(""))
                }
                var a, s, o = 0;
                if (g.isArray(t))
                    if (a = t.length,
                    s = new Array(a),
                    0 === a)
                        n(null, "");
                    else
                        for (var u = 0; u < t.length; u++) {
                            var l = t[u];
                            switch (e) {
                            case 1:
                                i(l, u, a, r);
                                break;
                            case 2:
                                i(l[0], l[1], u, a, r);
                                break;
                            case 3:
                                i(l[0], l[1], l[2], u, a, r);
                                break;
                            default:
                                l.push(u, r),
                                i.apply(this, l)
                            }
                        }
                else {
                    var c = g.keys(t);
                    if (a = c.length,
                    s = new Array(a),
                    0 === a)
                        n(null, "");
                    else
                        for (var u = 0; u < c.length; u++) {
                            var h = c[u];
                            i(h, t[h], u, a, r)
                        }
                }
            }
            var g = r.lib
              , m = r.object
              , v = m.extend({
                init: function(t) {
                    this.variables = {},
                    this.parent = t
                },
                set: function(t, e, i) {
                    var n = t.split(".")
                      , r = this.variables
                      , a = this;
                    if (i) {
                        if (a = this.resolve(n[0]))
                            return void a.set(t, e);
                        a = this
                    }
                    for (var s = 0; s < n.length - 1; s++) {
                        var o = n[s];
                        r[o] || (r[o] = {}),
                        r = r[o]
                    }
                    r[n[n.length - 1]] = e
                },
                get: function(t) {
                    var e = this.variables[t];
                    return void 0 !== e && null !== e ? e : null
                },
                lookup: function(t) {
                    var e = this.parent
                      , i = this.variables[t];
                    return void 0 !== i && null !== i ? i : e && e.lookup(t)
                },
                resolve: function(t) {
                    var e = this.parent
                      , i = this.variables[t];
                    return void 0 !== i && null !== i ? this : e && e.resolve(t)
                },
                push: function() {
                    return new v(this)
                },
                pop: function() {
                    return this.parent
                }
            });
            a.prototype = Object.create(String.prototype),
            a.prototype.valueOf = function() {
                return this.val
            }
            ,
            a.prototype.toString = function() {
                return this.val
            }
            ,
            r.runtime = {
                Frame: v,
                makeMacro: t,
                makeKeywordArgs: e,
                numArgs: n,
                suppressValue: u,
                memberLookup: l,
                contextOrFrameLookup: h,
                callWrap: c,
                handleError: d,
                isArray: g.isArray,
                keys: g.keys,
                SafeString: a,
                copySafeness: s,
                markSafe: o,
                asyncEach: p,
                asyncAll: f
            }
        }(),
        function() {
            "use strict";
            function t(t, e, i, n) {
                return {
                    type: t,
                    value: e,
                    lineno: i,
                    colno: n
                }
            }
            function e(t, e) {
                this.str = t,
                this.index = 0,
                this.len = t.length,
                this.lineno = 0,
                this.colno = 0,
                this.in_code = !1,
                e = e || {};
                var i = e.tags || {};
                this.tags = {
                    BLOCK_START: i.blockStart || o,
                    BLOCK_END: i.blockEnd || u,
                    VARIABLE_START: i.variableStart || l,
                    VARIABLE_END: i.variableEnd || c,
                    COMMENT_START: i.commentStart || h,
                    COMMENT_END: i.commentEnd || d
                },
                this.trimBlocks = !!e.trimBlocks,
                this.lstripBlocks = !!e.lstripBlocks
            }
            var i = r.lib
              , n = " \n\t\r"
              , a = "()[]{}%*-+/#,:|.<>=!"
              , s = "0123456789"
              , o = "{%"
              , u = "%}"
              , l = "{{"
              , c = "}}"
              , h = "{#"
              , d = "#}"
              , p = "string"
              , f = "whitespace"
              , g = "data"
              , m = "block-start"
              , v = "block-end"
              , _ = "variable-start"
              , b = "variable-end"
              , x = "comment"
              , A = "left-paren"
              , y = "right-paren"
              , S = "left-bracket"
              , C = "right-bracket"
              , M = "left-curly"
              , w = "right-curly"
              , T = "operator"
              , E = "comma"
              , I = "colon"
              , k = "pipe"
              , F = "int"
              , D = "float"
              , N = "boolean"
              , R = "symbol"
              , P = "special"
              , L = "regex";
            e.prototype.nextToken = function() {
                var e, r = this.lineno, o = this.colno;
                if (this.in_code) {
                    var u = this.current();
                    if (this.is_finished())
                        return null;
                    if ('"' === u || "'" === u)
                        return t(p, this.parseString(u), r, o);
                    if (e = this._extract(n))
                        return t(f, e, r, o);
                    if ((e = this._extractString(this.tags.BLOCK_END)) || (e = this._extractString("-" + this.tags.BLOCK_END)))
                        return this.in_code = !1,
                        this.trimBlocks && (u = this.current(),
                        "\n" === u && this.forward()),
                        t(v, e, r, o);
                    if (e = this._extractString(this.tags.VARIABLE_END))
                        return this.in_code = !1,
                        t(b, e, r, o);
                    if ("r" === u && "/" === this.str.charAt(this.index + 1)) {
                        this.forwardN(2);
                        for (var l = ""; !this.is_finished(); ) {
                            if ("/" === this.current() && "\\" !== this.previous()) {
                                this.forward();
                                break
                            }
                            l += this.current(),
                            this.forward()
                        }
                        for (var c = ["g", "i", "m", "y"], h = ""; !this.is_finished(); ) {
                            var d = c.indexOf(this.current()) !== -1;
                            if (!d)
                                break;
                            h += this.current(),
                            this.forward()
                        }
                        return t(L, {
                            body: l,
                            flags: h
                        }, r, o)
                    }
                    if (a.indexOf(u) !== -1) {
                        this.forward();
                        var P, O = ["==", "!=", "<=", ">=", "//", "**"], V = u + this.current();
                        switch (i.indexOf(O, V) !== -1 && (this.forward(),
                        u = V),
                        u) {
                        case "(":
                            P = A;
                            break;
                        case ")":
                            P = y;
                            break;
                        case "[":
                            P = S;
                            break;
                        case "]":
                            P = C;
                            break;
                        case "{":
                            P = M;
                            break;
                        case "}":
                            P = w;
                            break;
                        case ",":
                            P = E;
                            break;
                        case ":":
                            P = I;
                            break;
                        case "|":
                            P = k;
                            break;
                        default:
                            P = T
                        }
                        return t(P, u, r, o)
                    }
                    if (e = this._extractUntil(n + a),
                    e.match(/^[-+]?[0-9]+$/)) {
                        if ("." === this.current()) {
                            this.forward();
                            var B = this._extract(s);
                            return t(D, e + "." + B, r, o)
                        }
                        return t(F, e, r, o)
                    }
                    if (e.match(/^(true|false)$/))
                        return t(N, e, r, o);
                    if (e)
                        return t(R, e, r, o);
                    throw new Error("Unexpected value while parsing: " + e)
                }
                var U = this.tags.BLOCK_START.charAt(0) + this.tags.VARIABLE_START.charAt(0) + this.tags.COMMENT_START.charAt(0) + this.tags.COMMENT_END.charAt(0);
                if (this.is_finished())
                    return null;
                if ((e = this._extractString(this.tags.BLOCK_START + "-")) || (e = this._extractString(this.tags.BLOCK_START)))
                    return this.in_code = !0,
                    t(m, e, r, o);
                if (e = this._extractString(this.tags.VARIABLE_START))
                    return this.in_code = !0,
                    t(_, e, r, o);
                e = "";
                var G, z = !1;
                for (this._matches(this.tags.COMMENT_START) && (z = !0,
                e = this._extractString(this.tags.COMMENT_START)); null !== (G = this._extractUntil(U)); ) {
                    if (e += G,
                    (this._matches(this.tags.BLOCK_START) || this._matches(this.tags.VARIABLE_START) || this._matches(this.tags.COMMENT_START)) && !z) {
                        if (this.lstripBlocks && this._matches(this.tags.BLOCK_START) && this.colno > 0 && this.colno <= e.length) {
                            var H = e.slice(-this.colno);
                            if (/^\s+$/.test(H) && (e = e.slice(0, -this.colno),
                            !e.length))
                                return this.nextToken()
                        }
                        break
                    }
                    if (this._matches(this.tags.COMMENT_END)) {
                        if (!z)
                            throw new Error("unexpected end of comment");
                        e += this._extractString(this.tags.COMMENT_END);
                        break
                    }
                    e += this.current(),
                    this.forward()
                }
                if (null === G && z)
                    throw new Error("expected end of comment, got end of file");
                return t(z ? x : g, e, r, o)
            }
            ,
            e.prototype.parseString = function(t) {
                this.forward();
                for (var e = (this.lineno,
                this.colno,
                ""); !this.is_finished() && this.current() !== t; ) {
                    var i = this.current();
                    if ("\\" === i) {
                        switch (this.forward(),
                        this.current()) {
                        case "n":
                            e += "\n";
                            break;
                        case "t":
                            e += "\t";
                            break;
                        case "r":
                            e += "\r";
                            break;
                        default:
                            e += this.current()
                        }
                        this.forward()
                    } else
                        e += i,
                        this.forward()
                }
                return this.forward(),
                e
            }
            ,
            e.prototype._matches = function(t) {
                if (this.index + t.length > this.len)
                    return null;
                var e = this.str.slice(this.index, this.index + t.length);
                return e === t
            }
            ,
            e.prototype._extractString = function(t) {
                return this._matches(t) ? (this.index += t.length,
                t) : null
            }
            ,
            e.prototype._extractUntil = function(t) {
                return this._extractMatching(!0, t || "")
            }
            ,
            e.prototype._extract = function(t) {
                return this._extractMatching(!1, t)
            }
            ,
            e.prototype._extractMatching = function(t, e) {
                if (this.is_finished())
                    return null;
                var i = e.indexOf(this.current());
                if (t && i === -1 || !t && i !== -1) {
                    var n = this.current();
                    this.forward();
                    for (var r = e.indexOf(this.current()); (t && r === -1 || !t && r !== -1) && !this.is_finished(); )
                        n += this.current(),
                        this.forward(),
                        r = e.indexOf(this.current());
                    return n
                }
                return ""
            }
            ,
            e.prototype.is_finished = function() {
                return this.index >= this.len
            }
            ,
            e.prototype.forwardN = function(t) {
                for (var e = 0; e < t; e++)
                    this.forward()
            }
            ,
            e.prototype.forward = function() {
                this.index++,
                "\n" === this.previous() ? (this.lineno++,
                this.colno = 0) : this.colno++
            }
            ,
            e.prototype.back = function() {
                if (this.index--,
                "\n" === this.current()) {
                    this.lineno--;
                    var t = this.src.lastIndexOf("\n", this.index - 1);
                    t === -1 ? this.colno = this.index : this.colno = this.index - t
                } else
                    this.colno--
            }
            ,
            e.prototype.current = function() {
                return this.is_finished() ? "" : this.str.charAt(this.index)
            }
            ,
            e.prototype.previous = function() {
                return this.str.charAt(this.index - 1)
            }
            ,
            r.lexer = {
                lex: function(t, i) {
                    return new e(t,i)
                },
                TOKEN_STRING: p,
                TOKEN_WHITESPACE: f,
                TOKEN_DATA: g,
                TOKEN_BLOCK_START: m,
                TOKEN_BLOCK_END: v,
                TOKEN_VARIABLE_START: _,
                TOKEN_VARIABLE_END: b,
                TOKEN_COMMENT: x,
                TOKEN_LEFT_PAREN: A,
                TOKEN_RIGHT_PAREN: y,
                TOKEN_LEFT_BRACKET: S,
                TOKEN_RIGHT_BRACKET: C,
                TOKEN_LEFT_CURLY: M,
                TOKEN_RIGHT_CURLY: w,
                TOKEN_OPERATOR: T,
                TOKEN_COMMA: E,
                TOKEN_COLON: I,
                TOKEN_PIPE: k,
                TOKEN_INT: F,
                TOKEN_FLOAT: D,
                TOKEN_BOOLEAN: N,
                TOKEN_SYMBOL: R,
                TOKEN_SPECIAL: P,
                TOKEN_REGEX: L
            }
        }(),
        function() {
            "use strict";
            var t = r.lexer
              , e = r.nodes
              , i = r.object
              , n = r.lib
              , a = i.extend({
                init: function(t) {
                    this.tokens = t,
                    this.peeked = null,
                    this.breakOnBlocks = null,
                    this.dropLeadingWhitespace = !1,
                    this.extensions = []
                },
                nextToken: function(e) {
                    var i;
                    if (this.peeked) {
                        if (e || this.peeked.type !== t.TOKEN_WHITESPACE)
                            return i = this.peeked,
                            this.peeked = null,
                            i;
                        this.peeked = null
                    }
                    if (i = this.tokens.nextToken(),
                    !e)
                        for (; i && i.type === t.TOKEN_WHITESPACE; )
                            i = this.tokens.nextToken();
                    return i
                },
                peekToken: function() {
                    return this.peeked = this.peeked || this.nextToken(),
                    this.peeked
                },
                pushToken: function(t) {
                    if (this.peeked)
                        throw new Error("pushToken: can only push one token on between reads");
                    this.peeked = t
                },
                fail: function(t, e, i) {
                    if ((void 0 === e || void 0 === i) && this.peekToken()) {
                        var r = this.peekToken();
                        e = r.lineno,
                        i = r.colno
                    }
                    throw void 0 !== e && (e += 1),
                    void 0 !== i && (i += 1),
                    new n.TemplateError(t,e,i)
                },
                skip: function(t) {
                    var e = this.nextToken();
                    return !(!e || e.type !== t) || (this.pushToken(e),
                    !1)
                },
                expect: function(t) {
                    var e = this.nextToken();
                    return e.type !== t && this.fail("expected " + t + ", got " + e.type, e.lineno, e.colno),
                    e
                },
                skipValue: function(t, e) {
                    var i = this.nextToken();
                    return !(!i || i.type !== t || i.value !== e) || (this.pushToken(i),
                    !1)
                },
                skipWhitespace: function() {
                    return this.skip(t.TOKEN_WHITESPACE)
                },
                skipSymbol: function(e) {
                    return this.skipValue(t.TOKEN_SYMBOL, e)
                },
                advanceAfterBlockEnd: function(e) {
                    if (!e) {
                        var i = this.peekToken();
                        i || this.fail("unexpected end of file"),
                        i.type !== t.TOKEN_SYMBOL && this.fail("advanceAfterBlockEnd: expected symbol token or explicit name to be passed"),
                        e = this.nextToken().value
                    }
                    var i = this.nextToken();
                    i && i.type === t.TOKEN_BLOCK_END ? "-" === i.value.charAt(0) && (this.dropLeadingWhitespace = !0) : this.fail("expected block end in " + e + " statement")
                },
                advanceAfterVariableEnd: function() {
                    this.skip(t.TOKEN_VARIABLE_END) || this.fail("expected variable end")
                },
                parseFor: function() {
                    var i, n, r = this.peekToken();
                    this.skipSymbol("for") ? (i = new e.For(r.lineno,r.colno),
                    n = "endfor") : this.skipSymbol("asyncEach") ? (i = new e.AsyncEach(r.lineno,r.colno),
                    n = "endeach") : this.skipSymbol("asyncAll") ? (i = new e.AsyncAll(r.lineno,r.colno),
                    n = "endall") : this.fail("parseFor: expected for{Async}", r.lineno, r.colno),
                    i.name = this.parsePrimary(),
                    i.name instanceof e.Symbol || this.fail("parseFor: variable name expected for loop");
                    var a = this.peekToken().type;
                    if (a === t.TOKEN_COMMA) {
                        var s = i.name;
                        for (i.name = new e.Array(s.lineno,s.colno),
                        i.name.addChild(s); this.skip(t.TOKEN_COMMA); ) {
                            var o = this.parsePrimary();
                            i.name.addChild(o)
                        }
                    }
                    return this.skipSymbol("in") || this.fail('parseFor: expected "in" keyword for loop', r.lineno, r.colno),
                    i.arr = this.parseExpression(),
                    this.advanceAfterBlockEnd(r.value),
                    i.body = this.parseUntilBlocks(n, "else"),
                    this.skipSymbol("else") && (this.advanceAfterBlockEnd("else"),
                    i.else_ = this.parseUntilBlocks(n)),
                    this.advanceAfterBlockEnd(),
                    i
                },
                parseMacro: function() {
                    var t = this.peekToken();
                    this.skipSymbol("macro") || this.fail("expected macro");
                    var i = this.parsePrimary(!0)
                      , n = this.parseSignature()
                      , r = new e.Macro(t.lineno,t.colno,i,n);
                    return this.advanceAfterBlockEnd(t.value),
                    r.body = this.parseUntilBlocks("endmacro"),
                    this.advanceAfterBlockEnd(),
                    r
                },
                parseCall: function() {
                    var t = this.peekToken();
                    this.skipSymbol("call") || this.fail("expected call");
                    var i = this.parseSignature(!0) || new e.NodeList
                      , n = this.parsePrimary();
                    this.advanceAfterBlockEnd(t.value);
                    var r = this.parseUntilBlocks("endcall");
                    this.advanceAfterBlockEnd();
                    var a = new e.Symbol(t.lineno,t.colno,"caller")
                      , s = new e.Caller(t.lineno,t.colno,a,i,r)
                      , o = n.args.children;
                    o[o.length - 1]instanceof e.KeywordArgs || o.push(new e.KeywordArgs);
                    var u = o[o.length - 1];
                    return u.addChild(new e.Pair(t.lineno,t.colno,a,s)),
                    new e.Output(t.lineno,t.colno,[n])
                },
                parseWithContext: function() {
                    var t = this.peekToken()
                      , e = null;
                    return this.skipSymbol("with") ? e = !0 : this.skipSymbol("without") && (e = !1),
                    null !== e && (this.skipSymbol("context") || this.fail("parseFrom: expected context after with/without", t.lineno, t.colno)),
                    e
                },
                parseImport: function() {
                    var t = this.peekToken();
                    this.skipSymbol("import") || this.fail("parseImport: expected import", t.lineno, t.colno);
                    var i = this.parseExpression();
                    this.skipSymbol("as") || this.fail('parseImport: expected "as" keyword', t.lineno, t.colno);
                    var n = this.parsePrimary()
                      , r = this.parseWithContext()
                      , a = new e.Import(t.lineno,t.colno,i,n,r);
                    return this.advanceAfterBlockEnd(t.value),
                    a
                },
                parseFrom: function() {
                    var i = this.peekToken();
                    this.skipSymbol("from") || this.fail("parseFrom: expected from");
                    var n = this.parsePrimary();
                    this.skipSymbol("import") || this.fail("parseFrom: expected import", i.lineno, i.colno);
                    for (var r, a = new e.NodeList; ; ) {
                        var s = this.peekToken();
                        if (s.type === t.TOKEN_BLOCK_END) {
                            a.children.length || this.fail("parseFrom: Expected at least one import name", i.lineno, i.colno),
                            "-" === s.value.charAt(0) && (this.dropLeadingWhitespace = !0),
                            this.nextToken();
                            break
                        }
                        a.children.length > 0 && !this.skip(t.TOKEN_COMMA) && this.fail("parseFrom: expected comma", i.lineno, i.colno);
                        var o = this.parsePrimary();
                        if ("_" === o.value.charAt(0) && this.fail("parseFrom: names starting with an underscore cannot be imported", o.lineno, o.colno),
                        this.skipSymbol("as")) {
                            var u = this.parsePrimary();
                            a.addChild(new e.Pair(o.lineno,o.colno,o,u))
                        } else
                            a.addChild(o);
                        r = this.parseWithContext()
                    }
                    return new e.FromImport(i.lineno,i.colno,n,a,r)
                },
                parseBlock: function() {
                    var t = this.peekToken();
                    this.skipSymbol("block") || this.fail("parseBlock: expected block", t.lineno, t.colno);
                    var i = new e.Block(t.lineno,t.colno);
                    return i.name = this.parsePrimary(),
                    i.name instanceof e.Symbol || this.fail("parseBlock: variable name expected", t.lineno, t.colno),
                    this.advanceAfterBlockEnd(t.value),
                    i.body = this.parseUntilBlocks("endblock"),
                    this.peekToken() || this.fail("parseBlock: expected endblock, got end of file"),
                    this.advanceAfterBlockEnd(),
                    i
                },
                parseTemplateRef: function(t, e) {
                    var i = this.peekToken();
                    this.skipSymbol(t) || this.fail("parseTemplateRef: expected " + t);
                    var n = new e(i.lineno,i.colno);
                    return n.template = this.parseExpression(),
                    this.advanceAfterBlockEnd(i.value),
                    n
                },
                parseExtends: function() {
                    return this.parseTemplateRef("extends", e.Extends)
                },
                parseInclude: function() {
                    return this.parseTemplateRef("include", e.Include)
                },
                parseIf: function() {
                    var t, i = this.peekToken();
                    this.skipSymbol("if") || this.skipSymbol("elif") ? t = new e.If(i.lineno,i.colno) : this.skipSymbol("ifAsync") ? t = new e.IfAsync(i.lineno,i.colno) : this.fail("parseIf: expected if or elif", i.lineno, i.colno),
                    t.cond = this.parseExpression(),
                    this.advanceAfterBlockEnd(i.value),
                    t.body = this.parseUntilBlocks("elif", "else", "endif");
                    var n = this.peekToken();
                    switch (n && n.value) {
                    case "elif":
                        t.else_ = this.parseIf();
                        break;
                    case "else":
                        this.advanceAfterBlockEnd(),
                        t.else_ = this.parseUntilBlocks("endif"),
                        this.advanceAfterBlockEnd();
                        break;
                    case "endif":
                        t.else_ = null,
                        this.advanceAfterBlockEnd();
                        break;
                    default:
                        this.fail("parseIf: expected endif, else, or endif, got end of file")
                    }
                    return t
                },
                parseSet: function() {
                    var i = this.peekToken();
                    this.skipSymbol("set") || this.fail("parseSet: expected set", i.lineno, i.colno);
                    for (var n, r = new e.Set(i.lineno,i.colno,[]); (n = this.parsePrimary()) && (r.targets.push(n),
                    this.skip(t.TOKEN_COMMA)); )
                        ;
                    return this.skipValue(t.TOKEN_OPERATOR, "=") || this.fail("parseSet: expected = in set tag", i.lineno, i.colno),
                    r.value = this.parseExpression(),
                    this.advanceAfterBlockEnd(i.value),
                    r
                },
                parseStatement: function() {
                    var i, r = this.peekToken();
                    if (r.type !== t.TOKEN_SYMBOL && this.fail("tag name expected", r.lineno, r.colno),
                    this.breakOnBlocks && n.indexOf(this.breakOnBlocks, r.value) !== -1)
                        return null;
                    switch (r.value) {
                    case "raw":
                        return this.parseRaw();
                    case "if":
                    case "ifAsync":
                        return this.parseIf();
                    case "for":
                    case "asyncEach":
                    case "asyncAll":
                        return this.parseFor();
                    case "block":
                        return this.parseBlock();
                    case "extends":
                        return this.parseExtends();
                    case "include":
                        return this.parseInclude();
                    case "set":
                        return this.parseSet();
                    case "macro":
                        return this.parseMacro();
                    case "call":
                        return this.parseCall();
                    case "import":
                        return this.parseImport();
                    case "from":
                        return this.parseFrom();
                    default:
                        if (this.extensions.length)
                            for (var a = 0; a < this.extensions.length; a++) {
                                var s = this.extensions[a];
                                if (n.indexOf(s.tags || [], r.value) !== -1)
                                    return s.parse(this, e, t)
                            }
                        this.fail("unknown block tag: " + r.value, r.lineno, r.colno)
                    }
                    return i
                },
                parseRaw: function() {
                    this.advanceAfterBlockEnd();
                    for (var i = "", n = this.peekToken(); ; ) {
                        var r = this.nextToken(!0);
                        if (r || this.fail("expected endraw, got end of file"),
                        r.type === t.TOKEN_BLOCK_START) {
                            var a = null
                              , s = this.nextToken(!0);
                            if (s.type === t.TOKEN_WHITESPACE && (a = s,
                            s = this.nextToken()),
                            s.type === t.TOKEN_SYMBOL && "endraw" === s.value) {
                                this.advanceAfterBlockEnd(s.value);
                                break
                            }
                            i += r.value,
                            a && (i += a.value),
                            i += s.value
                        } else
                            i += r.type === t.TOKEN_STRING ? '"' + r.value + '"' : r.value
                    }
                    var o = new e.Output(n.lineno,n.colno,[new e.TemplateData(n.lineno,n.colno,i)]);
                    return o
                },
                parsePostfix: function(i) {
                    for (var n = this.peekToken(); n; ) {
                        if (n.type === t.TOKEN_LEFT_PAREN)
                            i = new e.FunCall(n.lineno,n.colno,i,this.parseSignature());
                        else if (n.type === t.TOKEN_LEFT_BRACKET) {
                            var r = this.parseAggregate();
                            r.children.length > 1 && this.fail("invalid index"),
                            i = new e.LookupVal(n.lineno,n.colno,i,r.children[0])
                        } else {
                            if (n.type !== t.TOKEN_OPERATOR || "." !== n.value)
                                break;
                            this.nextToken();
                            var a = this.nextToken();
                            a.type !== t.TOKEN_SYMBOL && this.fail("expected name as lookup value, got " + a.value, a.lineno, a.colno);
                            var r = new e.Literal(a.lineno,a.colno,a.value);
                            i = new e.LookupVal(n.lineno,n.colno,i,r)
                        }
                        n = this.peekToken()
                    }
                    return i
                },
                parseExpression: function() {
                    var t = this.parseInlineIf();
                    return t
                },
                parseInlineIf: function() {
                    var t = this.parseOr();
                    if (this.skipSymbol("if")) {
                        var i = this.parseOr()
                          , n = t;
                        t = new e.InlineIf(t.lineno,t.colno),
                        t.body = n,
                        t.cond = i,
                        this.skipSymbol("else") ? t.else_ = this.parseOr() : t.else_ = null
                    }
                    return t
                },
                parseOr: function() {
                    for (var t = this.parseAnd(); this.skipSymbol("or"); ) {
                        var i = this.parseAnd();
                        t = new e.Or(t.lineno,t.colno,t,i)
                    }
                    return t
                },
                parseAnd: function() {
                    for (var t = this.parseNot(); this.skipSymbol("and"); ) {
                        var i = this.parseNot();
                        t = new e.And(t.lineno,t.colno,t,i)
                    }
                    return t
                },
                parseNot: function() {
                    var t = this.peekToken();
                    return this.skipSymbol("not") ? new e.Not(t.lineno,t.colno,this.parseNot()) : this.parseIn()
                },
                parseIn: function() {
                    for (var i = this.parseCompare(); ; ) {
                        var n = this.nextToken();
                        if (!n)
                            break;
                        var r = n.type === t.TOKEN_SYMBOL && "not" === n.value;
                        if (r || this.pushToken(n),
                        !this.skipSymbol("in")) {
                            r && this.pushToken(n);
                            break
                        }
                        var a = this.parseCompare();
                        i = new e.In(i.lineno,i.colno,i,a),
                        r && (i = new e.Not(i.lineno,i.colno,i))
                    }
                    return i
                },
                parseCompare: function() {
                    for (var t = ["==", "!=", "<", ">", "<=", ">="], i = this.parseAdd(), r = []; ; ) {
                        var a = this.nextToken();
                        if (!a)
                            break;
                        if (n.indexOf(t, a.value) === -1) {
                            this.pushToken(a);
                            break
                        }
                        r.push(new e.CompareOperand(a.lineno,a.colno,this.parseAdd(),a.value))
                    }
                    return r.length ? new e.Compare(r[0].lineno,r[0].colno,i,r) : i
                },
                parseAdd: function() {
                    for (var i = this.parseSub(); this.skipValue(t.TOKEN_OPERATOR, "+"); ) {
                        var n = this.parseSub();
                        i = new e.Add(i.lineno,i.colno,i,n)
                    }
                    return i
                },
                parseSub: function() {
                    for (var i = this.parseMul(); this.skipValue(t.TOKEN_OPERATOR, "-"); ) {
                        var n = this.parseMul();
                        i = new e.Sub(i.lineno,i.colno,i,n)
                    }
                    return i
                },
                parseMul: function() {
                    for (var i = this.parseDiv(); this.skipValue(t.TOKEN_OPERATOR, "*"); ) {
                        var n = this.parseDiv();
                        i = new e.Mul(i.lineno,i.colno,i,n)
                    }
                    return i
                },
                parseDiv: function() {
                    for (var i = this.parseFloorDiv(); this.skipValue(t.TOKEN_OPERATOR, "/"); ) {
                        var n = this.parseFloorDiv();
                        i = new e.Div(i.lineno,i.colno,i,n)
                    }
                    return i
                },
                parseFloorDiv: function() {
                    for (var i = this.parseMod(); this.skipValue(t.TOKEN_OPERATOR, "//"); ) {
                        var n = this.parseMod();
                        i = new e.FloorDiv(i.lineno,i.colno,i,n)
                    }
                    return i
                },
                parseMod: function() {
                    for (var i = this.parsePow(); this.skipValue(t.TOKEN_OPERATOR, "%"); ) {
                        var n = this.parsePow();
                        i = new e.Mod(i.lineno,i.colno,i,n)
                    }
                    return i
                },
                parsePow: function() {
                    for (var i = this.parseUnary(); this.skipValue(t.TOKEN_OPERATOR, "**"); ) {
                        var n = this.parseUnary();
                        i = new e.Pow(i.lineno,i.colno,i,n)
                    }
                    return i
                },
                parseUnary: function(i) {
                    var n, r = this.peekToken();
                    return n = this.skipValue(t.TOKEN_OPERATOR, "-") ? new e.Neg(r.lineno,r.colno,this.parseUnary(!0)) : this.skipValue(t.TOKEN_OPERATOR, "+") ? new e.Pos(r.lineno,r.colno,this.parseUnary(!0)) : this.parsePrimary(),
                    i || (n = this.parseFilter(n)),
                    n
                },
                parsePrimary: function(i) {
                    var n = this.nextToken()
                      , r = null
                      , a = null;
                    return n ? n.type === t.TOKEN_STRING ? r = n.value : n.type === t.TOKEN_INT ? r = parseInt(n.value, 10) : n.type === t.TOKEN_FLOAT ? r = parseFloat(n.value) : n.type === t.TOKEN_BOOLEAN ? "true" === n.value ? r = !0 : "false" === n.value ? r = !1 : this.fail("invalid boolean: " + n.value, n.lineno, n.colno) : n.type === t.TOKEN_REGEX && (r = new RegExp(n.value.body,n.value.flags)) : this.fail("expected expression, got end of file"),
                    null !== r ? a = new e.Literal(n.lineno,n.colno,r) : n.type === t.TOKEN_SYMBOL ? (a = new e.Symbol(n.lineno,n.colno,n.value),
                    i || (a = this.parsePostfix(a))) : (this.pushToken(n),
                    a = this.parseAggregate()),
                    a ? a : void this.fail("unexpected token: " + n.value, n.lineno, n.colno)
                },
                parseFilter: function(i) {
                    for (; this.skip(t.TOKEN_PIPE); ) {
                        for (var n = this.expect(t.TOKEN_SYMBOL), r = n.value; this.skipValue(t.TOKEN_OPERATOR, "."); )
                            r += "." + this.expect(t.TOKEN_SYMBOL).value;
                        if (i = new e.Filter(n.lineno,n.colno,new e.Symbol(n.lineno,n.colno,r),new e.NodeList(n.lineno,n.colno,[i])),
                        this.peekToken().type === t.TOKEN_LEFT_PAREN) {
                            var a = this.parsePostfix(i);
                            i.args.children = i.args.children.concat(a.args.children)
                        }
                    }
                    return i
                },
                parseAggregate: function() {
                    var i, n = this.nextToken();
                    switch (n.type) {
                    case t.TOKEN_LEFT_PAREN:
                        i = new e.Group(n.lineno,n.colno);
                        break;
                    case t.TOKEN_LEFT_BRACKET:
                        i = new e.Array(n.lineno,n.colno);
                        break;
                    case t.TOKEN_LEFT_CURLY:
                        i = new e.Dict(n.lineno,n.colno);
                        break;
                    default:
                        return null
                    }
                    for (; ; ) {
                        var r = this.peekToken().type;
                        if (r === t.TOKEN_RIGHT_PAREN || r === t.TOKEN_RIGHT_BRACKET || r === t.TOKEN_RIGHT_CURLY) {
                            this.nextToken();
                            break
                        }
                        if (i.children.length > 0 && (this.skip(t.TOKEN_COMMA) || this.fail("parseAggregate: expected comma after expression", n.lineno, n.colno)),
                        i instanceof e.Dict) {
                            var a = this.parsePrimary();
                            this.skip(t.TOKEN_COLON) || this.fail("parseAggregate: expected colon after dict key", n.lineno, n.colno);
                            var s = this.parseExpression();
                            i.addChild(new e.Pair(a.lineno,a.colno,a,s))
                        } else {
                            var o = this.parseExpression();
                            i.addChild(o)
                        }
                    }
                    return i
                },
                parseSignature: function(i, n) {
                    var r = this.peekToken();
                    if (!n && r.type !== t.TOKEN_LEFT_PAREN) {
                        if (i)
                            return null;
                        this.fail("expected arguments", r.lineno, r.colno)
                    }
                    r.type === t.TOKEN_LEFT_PAREN && (r = this.nextToken());
                    for (var a = new e.NodeList(r.lineno,r.colno), s = new e.KeywordArgs(r.lineno,r.colno), o = !1; ; ) {
                        if (r = this.peekToken(),
                        !n && r.type === t.TOKEN_RIGHT_PAREN) {
                            this.nextToken();
                            break
                        }
                        if (n && r.type === t.TOKEN_BLOCK_END)
                            break;
                        if (o && !this.skip(t.TOKEN_COMMA))
                            this.fail("parseSignature: expected comma after expression", r.lineno, r.colno);
                        else {
                            var u = this.parseExpression();
                            this.skipValue(t.TOKEN_OPERATOR, "=") ? s.addChild(new e.Pair(u.lineno,u.colno,u,this.parseExpression())) : a.addChild(u)
                        }
                        o = !0
                    }
                    return s.children.length && a.addChild(s),
                    a
                },
                parseUntilBlocks: function() {
                    var t = this.breakOnBlocks;
                    this.breakOnBlocks = n.toArray(arguments);
                    var e = this.parse();
                    return this.breakOnBlocks = t,
                    e
                },
                parseNodes: function() {
                    for (var i, n = []; i = this.nextToken(); )
                        if (i.type === t.TOKEN_DATA) {
                            var r = i.value
                              , a = this.peekToken()
                              , s = a && a.value;
                            this.dropLeadingWhitespace && (r = r.replace(/^\s*/, ""),
                            this.dropLeadingWhitespace = !1),
                            a && a.type === t.TOKEN_BLOCK_START && "-" === s.charAt(s.length - 1) && (r = r.replace(/\s*$/, "")),
                            n.push(new e.Output(i.lineno,i.colno,[new e.TemplateData(i.lineno,i.colno,r)]))
                        } else if (i.type === t.TOKEN_BLOCK_START) {
                            var o = this.parseStatement();
                            if (!o)
                                break;
                            n.push(o)
                        } else if (i.type === t.TOKEN_VARIABLE_START) {
                            var u = this.parseExpression();
                            this.advanceAfterVariableEnd(),
                            n.push(new e.Output(i.lineno,i.colno,[u]))
                        } else
                            i.type !== t.TOKEN_COMMENT && this.fail("Unexpected token at top-level: " + i.type, i.lineno, i.colno);
                    return n
                },
                parse: function() {
                    return new e.NodeList(0,0,this.parseNodes())
                },
                parseAsRoot: function() {
                    return new e.Root(0,0,this.parseNodes())
                }
            });
            r.parser = {
                parse: function(e, i, n) {
                    var r = new a(t.lex(e, n));
                    return void 0 !== i && (r.extensions = i),
                    r.parseAsRoot()
                }
            }
        }(),
        function() {
            "use strict";
            function t() {
                return "hole_" + p++
            }
            function e(t, e) {
                for (var i = null, n = 0; n < t.length; n++) {
                    var r = e(t[n]);
                    r !== t[n] && (i || (i = t.slice()),
                    i[n] = r)
                }
                return i || t
            }
            function i(t, n, r) {
                if (!(t instanceof h.Node))
                    return t;
                if (!r) {
                    var a = n(t);
                    if (a && a !== t)
                        return a
                }
                if (t instanceof h.NodeList) {
                    var s = e(t.children, function(t) {
                        return i(t, n, r)
                    });
                    s !== t.children && (t = new h[t.typename](t.lineno,t.colno,s))
                } else if (t instanceof h.CallExtension) {
                    var o = i(t.args, n, r)
                      , u = e(t.contentArgs, function(t) {
                        return i(t, n, r)
                    });
                    o === t.args && u === t.contentArgs || (t = new h[t.typename](t.extName,t.prop,o,u))
                } else {
                    var l = t.fields.map(function(e) {
                        return t[e]
                    })
                      , c = e(l, function(t) {
                        return i(t, n, r)
                    });
                    c !== l && (t = new h[t.typename](t.lineno,t.colno),
                    c.forEach(function(e, i) {
                        t[t.fields[i]] = e
                    }))
                }
                return r ? n(t) || t : t
            }
            function n(t, e) {
                return i(t, e, !0)
            }
            function a(e, i, r) {
                var a = []
                  , s = n(r ? e[r] : e, function(e) {
                    if (e instanceof h.Block)
                        return e;
                    if (e instanceof h.Filter && d.indexOf(i, e.name.value) !== -1 || e instanceof h.CallExtensionAsync) {
                        var n = new h.Symbol(e.lineno,e.colno,t());
                        return a.push(new h.FilterAsync(e.lineno,e.colno,e.name,e.args,n)),
                        n
                    }
                });
                return r ? e[r] = s : e = s,
                a.length ? (a.push(e),
                new h.NodeList(e.lineno,e.colno,a)) : e
            }
            function s(t, e) {
                return n(t, function(t) {
                    return t instanceof h.Output ? a(t, e) : t instanceof h.For ? a(t, e, "arr") : t instanceof h.If ? a(t, e, "cond") : t instanceof h.CallExtension ? a(t, e, "args") : void 0
                })
            }
            function o(e) {
                return i(e, function(e) {
                    if (e instanceof h.Block) {
                        var n = !1
                          , r = t();
                        e.body = i(e.body, function(t) {
                            if (t instanceof h.FunCall && "super" === t.name.value)
                                return n = !0,
                                new h.Symbol(t.lineno,t.colno,r)
                        }),
                        n && e.body.children.unshift(new h.Super(0,0,e.name,new h.Symbol(0,0,r)))
                    }
                })
            }
            function u(t) {
                return n(t, function(t) {
                    if (t instanceof h.If || t instanceof h.For) {
                        var e = !1;
                        if (i(t, function(t) {
                            if (t instanceof h.FilterAsync || t instanceof h.IfAsync || t instanceof h.AsyncEach || t instanceof h.AsyncAll || t instanceof h.CallExtensionAsync)
                                return e = !0,
                                t
                        }),
                        e) {
                            if (t instanceof h.If)
                                return new h.IfAsync(t.lineno,t.colno,t.cond,t.body,t.else_);
                            if (t instanceof h.For)
                                return new h.AsyncEach(t.lineno,t.colno,t.arr,t.name,t.body,t.else_)
                        }
                    }
                })
            }
            function l(t, e) {
                return u(o(s(t, e)))
            }
            function c(t, e, i) {
                return l(t, e || [])
            }
            var h = r.nodes
              , d = r.lib
              , p = 0;
            r.transformer = {
                transform: c
            }
        }(),
        function() {
            "use strict";
            function t(t) {
                return function(e, i) {
                    this.compile(e.left, i),
                    this.emit(t),
                    this.compile(e.right, i)
                }
            }
            var e = r.lib
              , i = r.parser
              , n = r.transformer
              , a = r.nodes
              , s = r.object
              , o = r.runtime.Frame
              , u = {
                "==": "==",
                "!=": "!=",
                "<": "<",
                ">": ">",
                "<=": "<=",
                ">=": ">="
            }
              , l = s.extend({
                init: function(t) {
                    this.templateName = t,
                    this.codebuf = [],
                    this.lastId = 0,
                    this.buffer = null,
                    this.bufferStack = [],
                    this.isChild = !1,
                    this.scopeClosers = ""
                },
                fail: function(t, i, n) {
                    throw void 0 !== i && (i += 1),
                    void 0 !== n && (n += 1),
                    new e.TemplateError(t,i,n)
                },
                pushBufferId: function(t) {
                    this.bufferStack.push(this.buffer),
                    this.buffer = t,
                    this.emit("var " + this.buffer + ' = "";')
                },
                popBufferId: function() {
                    this.buffer = this.bufferStack.pop()
                },
                emit: function(t) {
                    this.codebuf.push(t)
                },
                emitLine: function(t) {
                    this.emit(t + "\n")
                },
                emitLines: function() {
                    e.each(e.toArray(arguments), function(t) {
                        this.emitLine(t)
                    }, this)
                },
                emitFuncBegin: function(t) {
                    this.buffer = "output",
                    this.scopeClosers = "",
                    this.emitLine("function " + t + "(env, context, frame, runtime, cb) {"),
                    this.emitLine("var lineno = null;"),
                    this.emitLine("var colno = null;"),
                    this.emitLine("var " + this.buffer + ' = "";'),
                    this.emitLine("try {")
                },
                emitFuncEnd: function(t) {
                    t || this.emitLine("cb(null, " + this.buffer + ");"),
                    this.closeScopeLevels(),
                    this.emitLine("} catch (e) {"),
                    this.emitLine("  cb(runtime.handleError(e, lineno, colno));"),
                    this.emitLine("}"),
                    this.emitLine("}"),
                    this.buffer = null
                },
                addScopeLevel: function() {
                    this.scopeClosers += "})"
                },
                closeScopeLevels: function() {
                    this.emitLine(this.scopeClosers + ";"),
                    this.scopeClosers = ""
                },
                withScopedSyntax: function(t) {
                    var e = this.scopeClosers;
                    this.scopeClosers = "",
                    t.call(this),
                    this.closeScopeLevels(),
                    this.scopeClosers = e
                },
                makeCallback: function(t) {
                    var e = this.tmpid();
                    return "function(" + e + (t ? "," + t : "") + ") {\nif(" + e + ") { cb(" + e + "); return; }"
                },
                tmpid: function() {
                    return this.lastId++,
                    "t_" + this.lastId
                },
                _templateName: function() {
                    return null == this.templateName ? "undefined" : JSON.stringify(this.templateName)
                },
                _bufferAppend: function(t) {
                    this.emit(this.buffer + " += runtime.suppressValue("),
                    t.call(this),
                    this.emit(", env.opts.autoescape);\n")
                },
                _compileChildren: function(t, e) {
                    for (var i = t.children, n = 0, r = i.length; n < r; n++)
                        this.compile(i[n], e)
                },
                _compileAggregate: function(t, e, i, n) {
                    i && this.emit(i);
                    for (var r = 0; r < t.children.length; r++)
                        r > 0 && this.emit(","),
                        this.compile(t.children[r], e);
                    n && this.emit(n)
                },
                _compileExpression: function(t, e) {
                    this.assertType(t, a.Literal, a.Symbol, a.Group, a.Array, a.Dict, a.FunCall, a.Caller, a.Filter, a.LookupVal, a.Compare, a.InlineIf, a.In, a.And, a.Or, a.Not, a.Add, a.Sub, a.Mul, a.Div, a.FloorDiv, a.Mod, a.Pow, a.Neg, a.Pos, a.Compare, a.NodeList),
                    this.compile(t, e)
                },
                assertType: function(t) {
                    for (var i = e.toArray(arguments).slice(1), n = !1, r = 0; r < i.length; r++)
                        t instanceof i[r] && (n = !0);
                    n || this.fail("assertType: invalid type: " + t.typename, t.lineno, t.colno)
                },
                compileCallExtension: function(t, i, n) {
                    var r = (t.extName,
                    t.args)
                      , s = t.contentArgs
                      , o = "boolean" != typeof t.autoescape || t.autoescape;
                    if (n || this.emit(this.buffer + " += runtime.suppressValue("),
                    this.emit('env.getExtension("' + t.extName + '")["' + t.prop + '"]('),
                    this.emit("context"),
                    (r || s) && this.emit(","),
                    r && (r instanceof a.NodeList || this.fail("compileCallExtension: arguments must be a NodeList, use `parser.parseSignature`"),
                    e.each(r.children, function(t, e) {
                        this._compileExpression(t, i),
                        (e !== r.children.length - 1 || s.length) && this.emit(",")
                    }, this)),
                    s.length && e.each(s, function(t, e) {
                        if (e > 0 && this.emit(","),
                        t) {
                            var n = this.tmpid();
                            this.emitLine("function(cb) {"),
                            this.emitLine("if(!cb) { cb = function(err) { if(err) { throw err; }}}"),
                            this.pushBufferId(n),
                            this.withScopedSyntax(function() {
                                this.compile(t, i),
                                this.emitLine("cb(null, " + n + ");")
                            }),
                            this.popBufferId(),
                            this.emitLine("return " + n + ";"),
                            this.emitLine("}")
                        } else
                            this.emit("null")
                    }, this),
                    n) {
                        var u = this.tmpid();
                        this.emitLine(", " + this.makeCallback(u)),
                        this.emitLine(this.buffer + " += runtime.suppressValue(" + u + ", " + o + " && env.opts.autoescape);"),
                        this.addScopeLevel()
                    } else
                        this.emit(")"),
                        this.emit(", " + o + " && env.opts.autoescape);\n")
                },
                compileCallExtensionAsync: function(t, e) {
                    this.compileCallExtension(t, e, !0)
                },
                compileNodeList: function(t, e) {
                    this._compileChildren(t, e)
                },
                compileLiteral: function(t, e) {
                    if ("string" == typeof t.value) {
                        var i = t.value.replace(/\\/g, "\\\\");
                        i = i.replace(/"/g, '\\"'),
                        i = i.replace(/\n/g, "\\n"),
                        i = i.replace(/\r/g, "\\r"),
                        i = i.replace(/\t/g, "\\t"),
                        this.emit('"' + i + '"')
                    } else
                        this.emit(t.value.toString())
                },
                compileSymbol: function(t, e) {
                    var i, n = t.value;
                    (i = e.lookup(n)) ? this.emit(i) : this.emit('runtime.contextOrFrameLookup(context, frame, "' + n + '")')
                },
                compileGroup: function(t, e) {
                    this._compileAggregate(t, e, "(", ")")
                },
                compileArray: function(t, e) {
                    this._compileAggregate(t, e, "[", "]")
                },
                compileDict: function(t, e) {
                    this._compileAggregate(t, e, "{", "}")
                },
                compilePair: function(t, e) {
                    var i = t.key
                      , n = t.value;
                    i instanceof a.Symbol ? i = new a.Literal(i.lineno,i.colno,i.value) : i instanceof a.Literal && "string" == typeof i.value || this.fail("compilePair: Dict keys must be strings or names", i.lineno, i.colno),
                    this.compile(i, e),
                    this.emit(": "),
                    this._compileExpression(n, e)
                },
                compileInlineIf: function(t, e) {
                    this.emit("("),
                    this.compile(t.cond, e),
                    this.emit("?"),
                    this.compile(t.body, e),
                    this.emit(":"),
                    null !== t.else_ ? this.compile(t.else_, e) : this.emit('""'),
                    this.emit(")")
                },
                compileIn: function(t, e) {
                    this.emit("("),
                    this.compile(t.right, e),
                    this.emit(".indexOf("),
                    this.compile(t.left, e),
                    this.emit(") !== -1)")
                },
                compileOr: t(" || "),
                compileAnd: t(" && "),
                compileAdd: t(" + "),
                compileSub: t(" - "),
                compileMul: t(" * "),
                compileDiv: t(" / "),
                compileMod: t(" % "),
                compileNot: function(t, e) {
                    this.emit("!"),
                    this.compile(t.target, e)
                },
                compileFloorDiv: function(t, e) {
                    this.emit("Math.floor("),
                    this.compile(t.left, e),
                    this.emit(" / "),
                    this.compile(t.right, e),
                    this.emit(")")
                },
                compilePow: function(t, e) {
                    this.emit("Math.pow("),
                    this.compile(t.left, e),
                    this.emit(", "),
                    this.compile(t.right, e),
                    this.emit(")")
                },
                compileNeg: function(t, e) {
                    this.emit("-"),
                    this.compile(t.target, e)
                },
                compilePos: function(t, e) {
                    this.emit("+"),
                    this.compile(t.target, e)
                },
                compileCompare: function(t, e) {
                    this.compile(t.expr, e);
                    for (var i = 0; i < t.ops.length; i++) {
                        var n = t.ops[i];
                        this.emit(" " + u[n.type] + " "),
                        this.compile(n.expr, e)
                    }
                },
                compileLookupVal: function(t, e) {
                    this.emit("runtime.memberLookup(("),
                    this._compileExpression(t.target, e),
                    this.emit("),"),
                    this._compileExpression(t.val, e),
                    this.emit(", env.opts.autoescape)")
                },
                _getNodeName: function(t) {
                    switch (t.typename) {
                    case "Symbol":
                        return t.value;
                    case "FunCall":
                        return "the return value of (" + this._getNodeName(t.name) + ")";
                    case "LookupVal":
                        return this._getNodeName(t.target) + '["' + this._getNodeName(t.val) + '"]';
                    case "Literal":
                        return t.value.toString().substr(0, 10);
                    default:
                        return "--expression--"
                    }
                },
                compileFunCall: function(t, e) {
                    this.emit("(lineno = " + t.lineno + ", colno = " + t.colno + ", "),
                    this.emit("runtime.callWrap("),
                    this._compileExpression(t.name, e),
                    this.emit(', "' + this._getNodeName(t.name).replace(/"/g, '\\"') + '", '),
                    this._compileAggregate(t.args, e, "[", "])"),
                    this.emit(")")
                },
                compileFilter: function(t, e) {
                    var i = t.name;
                    this.assertType(i, a.Symbol),
                    this.emit('env.getFilter("' + i.value + '").call(context, '),
                    this._compileAggregate(t.args, e),
                    this.emit(")")
                },
                compileFilterAsync: function(t, e) {
                    var i = t.name;
                    this.assertType(i, a.Symbol);
                    var n = t.symbol.value;
                    e.set(n, n),
                    this.emit('env.getFilter("' + i.value + '").call(context, '),
                    this._compileAggregate(t.args, e),
                    this.emitLine(", " + this.makeCallback(n)),
                    this.addScopeLevel()
                },
                compileKeywordArgs: function(t, i) {
                    var n = [];
                    e.each(t.children, function(t) {
                        n.push(t.key.value)
                    }),
                    this.emit("runtime.makeKeywordArgs("),
                    this.compileDict(t, i),
                    this.emit(")")
                },
                compileSet: function(t, i) {
                    var n = [];
                    e.each(t.targets, function(t) {
                        var e = t.value
                          , r = i.lookup(e);
                        null !== r && void 0 !== r || (r = this.tmpid(),
                        this.emitLine("var " + r + ";")),
                        n.push(r)
                    }, this),
                    this.emit(n.join(" = ") + " = "),
                    this._compileExpression(t.value, i),
                    this.emitLine(";"),
                    e.each(t.targets, function(t, e) {
                        var i = n[e]
                          , r = t.value;
                        this.emitLine('frame.set("' + r + '", ' + i + ", true);"),
                        this.emitLine("if(!frame.parent) {"),
                        this.emitLine('context.setVariable("' + r + '", ' + i + ");"),
                        "_" !== r.charAt(0) && this.emitLine('context.addExport("' + r + '");'),
                        this.emitLine("}")
                    }, this)
                },
                compileIf: function(t, e, i) {
                    this.emit("if("),
                    this._compileExpression(t.cond, e),
                    this.emitLine(") {"),
                    this.withScopedSyntax(function() {
                        this.compile(t.body, e),
                        i && this.emit("cb()")
                    }),
                    t.else_ ? (this.emitLine("}\nelse {"),
                    this.withScopedSyntax(function() {
                        this.compile(t.else_, e),
                        i && this.emit("cb()")
                    })) : i && (this.emitLine("}\nelse {"),
                    this.emit("cb()")),
                    this.emitLine("}")
                },
                compileIfAsync: function(t, e) {
                    this.emit("(function(cb) {"),
                    this.compileIf(t, e, !0),
                    this.emit("})(function() {"),
                    this.addScopeLevel()
                },
                emitLoopBindings: function(t, e, i, n) {
                    var r = {
                        index: i + " + 1",
                        index0: i,
                        revindex: n + " - " + i,
                        revindex0: n + " - " + i + " - 1",
                        first: i + " === 0",
                        last: i + " === " + n + " - 1",
                        length: n
                    };
                    for (var a in r)
                        this.emitLine('frame.set("loop.' + a + '", ' + r[a] + ");")
                },
                compileFor: function(t, e) {
                    var i = this.tmpid()
                      , n = this.tmpid()
                      , r = this.tmpid();
                    if (e = e.push(),
                    this.emitLine("frame = frame.push();"),
                    this.emit("var " + r + " = "),
                    this._compileExpression(t.arr, e),
                    this.emitLine(";"),
                    this.emit("if(" + r + ") {"),
                    t.name instanceof a.Array) {
                        this.emitLine("var " + i + ";"),
                        this.emitLine("if(runtime.isArray(" + r + ")) {"),
                        this.emitLine("var " + n + " = " + r + ".length;"),
                        this.emitLine("for(" + i + "=0; " + i + " < " + r + ".length; " + i + "++) {");
                        for (var s = 0; s < t.name.children.length; s++) {
                            var o = this.tmpid();
                            this.emitLine("var " + o + " = " + r + "[" + i + "][" + s + "]"),
                            this.emitLine('frame.set("' + t.name.children[s].value + '", ' + r + "[" + i + "][" + s + "]);"),
                            e.set(t.name.children[s].value, o)
                        }
                        this.emitLoopBindings(t, r, i, n),
                        this.withScopedSyntax(function() {
                            this.compile(t.body, e)
                        }),
                        this.emitLine("}"),
                        this.emitLine("} else {");
                        var u = t.name.children[0]
                          , l = t.name.children[1]
                          , c = this.tmpid()
                          , h = this.tmpid();
                        e.set(u.value, c),
                        e.set(l.value, h),
                        this.emitLine(i + " = -1;"),
                        this.emitLine("var " + n + " = runtime.keys(" + r + ").length;"),
                        this.emitLine("for(var " + c + " in " + r + ") {"),
                        this.emitLine(i + "++;"),
                        this.emitLine("var " + h + " = " + r + "[" + c + "];"),
                        this.emitLine('frame.set("' + u.value + '", ' + c + ");"),
                        this.emitLine('frame.set("' + l.value + '", ' + h + ");"),
                        this.emitLoopBindings(t, r, i, n),
                        this.withScopedSyntax(function() {
                            this.compile(t.body, e)
                        }),
                        this.emitLine("}"),
                        this.emitLine("}")
                    } else {
                        var h = this.tmpid();
                        e.set(t.name.value, h),
                        this.emitLine("var " + n + " = " + r + ".length;"),
                        this.emitLine("for(var " + i + "=0; " + i + " < " + r + ".length; " + i + "++) {"),
                        this.emitLine("var " + h + " = " + r + "[" + i + "];"),
                        this.emitLine('frame.set("' + t.name.value + '", ' + h + ");"),
                        this.emitLoopBindings(t, r, i, n),
                        this.withScopedSyntax(function() {
                            this.compile(t.body, e)
                        }),
                        this.emitLine("}")
                    }
                    this.emitLine("}"),
                    t.else_ && (this.emitLine("if (!" + n + ") {"),
                    this.compile(t.else_, e),
                    this.emitLine("}")),
                    this.emitLine("frame = frame.pop();")
                },
                _compileAsyncLoop: function(t, i, n) {
                    var r = this.tmpid()
                      , s = this.tmpid()
                      , o = this.tmpid()
                      , u = n ? "asyncAll" : "asyncEach";
                    if (i = i.push(),
                    this.emitLine("frame = frame.push();"),
                    this.emit("var " + o + " = "),
                    this._compileExpression(t.arr, i),
                    this.emitLine(";"),
                    t.name instanceof a.Array)
                        this.emit("runtime." + u + "(" + o + ", " + t.name.children.length + ", function("),
                        e.each(t.name.children, function(t) {
                            this.emit(t.value + ",")
                        }, this),
                        this.emit(r + "," + s + ",next) {"),
                        e.each(t.name.children, function(t) {
                            var e = t.value;
                            i.set(e, e),
                            this.emitLine('frame.set("' + e + '", ' + e + ");");
                        }, this);
                    else {
                        var l = t.name.value;
                        this.emitLine("runtime." + u + "(" + o + ", 1, function(" + l + ", " + r + ", " + s + ",next) {"),
                        this.emitLine('frame.set("' + l + '", ' + l + ");"),
                        i.set(l, l)
                    }
                    this.emitLoopBindings(t, o, r, s),
                    this.withScopedSyntax(function() {
                        var e;
                        n && (e = this.tmpid(),
                        this.pushBufferId(e)),
                        this.compile(t.body, i),
                        this.emitLine("next(" + r + (e ? "," + e : "") + ");"),
                        n && this.popBufferId()
                    });
                    var c = this.tmpid();
                    this.emitLine("}, " + this.makeCallback(c)),
                    this.addScopeLevel(),
                    n && this.emitLine(this.buffer + " += " + c + ";"),
                    t.else_ && (this.emitLine("if (!" + o + ".length) {"),
                    this.compile(t.else_, i),
                    this.emitLine("}")),
                    this.emitLine("frame = frame.pop();")
                },
                compileAsyncEach: function(t, e) {
                    this._compileAsyncLoop(t, e)
                },
                compileAsyncAll: function(t, e) {
                    this._compileAsyncLoop(t, e, !0)
                },
                _compileMacro: function(t, i) {
                    var n = []
                      , r = null
                      , s = "macro_" + this.tmpid();
                    e.each(t.args.children, function(e, i) {
                        i === t.args.children.length - 1 && e instanceof a.Dict ? r = e : (this.assertType(e, a.Symbol),
                        n.push(e))
                    }, this);
                    var o = e.map(n, function(t) {
                        return "l_" + t.value
                    });
                    o.push("kwargs");
                    var u = e.map(n, function(t) {
                        return '"' + t.value + '"'
                    })
                      , l = e.map(r && r.children || [], function(t) {
                        return '"' + t.key.value + '"'
                    });
                    i = i.push(),
                    this.emitLines("var " + s + " = runtime.makeMacro(", "[" + u.join(", ") + "], ", "[" + l.join(", ") + "], ", "function (" + o.join(", ") + ") {", "frame = frame.push();", "kwargs = kwargs || {};", 'if (kwargs.hasOwnProperty("caller")) {', 'frame.set("caller", kwargs.caller); }'),
                    e.each(n, function(t) {
                        this.emitLine('frame.set("' + t.value + '", l_' + t.value + ");"),
                        i.set(t.value, "l_" + t.value)
                    }, this),
                    r && e.each(r.children, function(t) {
                        var e = t.key.value;
                        this.emit('frame.set("' + e + '", kwargs.hasOwnProperty("' + e + '") ? kwargs["' + e + '"] : '),
                        this._compileExpression(t.value, i),
                        this.emitLine(");")
                    }, this);
                    var c = this.tmpid();
                    return this.pushBufferId(c),
                    this.withScopedSyntax(function() {
                        this.compile(t.body, i)
                    }),
                    i = i.pop(),
                    this.emitLine("frame = frame.pop();"),
                    this.emitLine("return new runtime.SafeString(" + c + ");"),
                    this.emitLine("});"),
                    this.popBufferId(),
                    s
                },
                compileMacro: function(t, e) {
                    var i = this._compileMacro(t, e)
                      , n = t.name.value;
                    e.set(n, i),
                    e.parent ? this.emitLine('frame.set("' + n + '", ' + i + ");") : ("_" !== t.name.value.charAt(0) && this.emitLine('context.addExport("' + n + '");'),
                    this.emitLine('context.setVariable("' + n + '", ' + i + ");"))
                },
                compileCaller: function(t, e) {
                    this.emit("(function (){");
                    var i = this._compileMacro(t, e);
                    this.emit("return " + i + ";})()")
                },
                compileImport: function(t, e) {
                    var i = this.tmpid()
                      , n = t.target.value;
                    this.emit("env.getTemplate("),
                    this._compileExpression(t.template, e),
                    this.emitLine(", false, " + this._templateName() + ", " + this.makeCallback(i)),
                    this.addScopeLevel(),
                    this.emitLine(i + ".getExported(" + (t.withContext ? "context.getVariables(), frame.push(), " : "") + this.makeCallback(i)),
                    this.addScopeLevel(),
                    e.set(n, i),
                    e.parent ? this.emitLine('frame.set("' + n + '", ' + i + ");") : this.emitLine('context.setVariable("' + n + '", ' + i + ");")
                },
                compileFromImport: function(t, i) {
                    var n = this.tmpid();
                    this.emit("env.getTemplate("),
                    this._compileExpression(t.template, i),
                    this.emitLine(", false, " + this._templateName() + ", " + this.makeCallback(n)),
                    this.addScopeLevel(),
                    this.emitLine(n + ".getExported(" + (t.withContext ? "context.getVariables(), frame.push(), " : "") + this.makeCallback(n)),
                    this.addScopeLevel(),
                    e.each(t.names.children, function(t) {
                        var e, r, s = this.tmpid();
                        t instanceof a.Pair ? (e = t.key.value,
                        r = t.value.value) : (e = t.value,
                        r = e),
                        this.emitLine("if(" + n + '.hasOwnProperty("' + e + '")) {'),
                        this.emitLine("var " + s + " = " + n + "." + e + ";"),
                        this.emitLine("} else {"),
                        this.emitLine("cb(new Error(\"cannot import '" + e + "'\")); return;"),
                        this.emitLine("}"),
                        i.set(r, s),
                        i.parent ? this.emitLine('frame.set("' + r + '", ' + s + ");") : this.emitLine('context.setVariable("' + r + '", ' + s + ");")
                    }, this)
                },
                compileBlock: function(t, e) {
                    if (!this.isChild) {
                        var i = this.tmpid();
                        this.emitLine('context.getBlock("' + t.name.value + '")(env, context, frame, runtime, ' + this.makeCallback(i)),
                        this.emitLine(this.buffer + " += " + i + ";"),
                        this.addScopeLevel()
                    }
                },
                compileSuper: function(t, e) {
                    var i = t.blockName.value
                      , n = t.symbol.value;
                    this.emitLine('context.getSuper(env, "' + i + '", b_' + i + ", frame, runtime, " + this.makeCallback(n)),
                    this.emitLine(n + " = runtime.markSafe(" + n + ");"),
                    this.addScopeLevel(),
                    e.set(n, n)
                },
                compileExtends: function(t, e) {
                    this.isChild && this.fail("compileExtends: cannot extend multiple times", t.template.lineno, t.template.colno);
                    var i = this.tmpid();
                    this.emit("env.getTemplate("),
                    this._compileExpression(t.template, e),
                    this.emitLine(", true, " + this._templateName() + ", " + this.makeCallback("parentTemplate")),
                    this.emitLine("for(var " + i + " in parentTemplate.blocks) {"),
                    this.emitLine("context.addBlock(" + i + ", parentTemplate.blocks[" + i + "]);"),
                    this.emitLine("}"),
                    this.addScopeLevel(),
                    this.isChild = !0
                },
                compileInclude: function(t, e) {
                    var i = this.tmpid()
                      , n = this.tmpid();
                    this.emit("env.getTemplate("),
                    this._compileExpression(t.template, e),
                    this.emitLine(", false, " + this._templateName() + ", " + this.makeCallback(i)),
                    this.addScopeLevel(),
                    this.emitLine(i + ".render(context.getVariables(), frame.push(), " + this.makeCallback(n)),
                    this.emitLine(this.buffer + " += " + n),
                    this.addScopeLevel()
                },
                compileTemplateData: function(t, e) {
                    this.compileLiteral(t, e)
                },
                compileOutput: function(t, e) {
                    for (var i = t.children, n = 0, r = i.length; n < r; n++)
                        i[n]instanceof a.TemplateData ? i[n].value && (this.emit(this.buffer + " += "),
                        this.compileLiteral(i[n], e),
                        this.emitLine(";")) : (this.emit(this.buffer + " += runtime.suppressValue("),
                        this.compile(i[n], e),
                        this.emit(", env.opts.autoescape);\n"))
                },
                compileRoot: function(t, e) {
                    e && this.fail("compileRoot: root node can't have frame"),
                    e = new o,
                    this.emitFuncBegin("root"),
                    this._compileChildren(t, e),
                    this.isChild && this.emitLine("parentTemplate.rootRenderFunc(env, context, frame, runtime, cb);"),
                    this.emitFuncEnd(this.isChild),
                    this.isChild = !1;
                    for (var i = t.findAll(a.Block), n = 0; n < i.length; n++) {
                        var r = i[n]
                          , s = r.name.value;
                        this.emitFuncBegin("b_" + s);
                        var u = new o;
                        this.compile(r.body, u),
                        this.emitFuncEnd()
                    }
                    this.emitLine("return {");
                    for (var n = 0; n < i.length; n++) {
                        var r = i[n]
                          , s = "b_" + r.name.value;
                        this.emitLine(s + ": " + s + ",")
                    }
                    this.emitLine("root: root\n};")
                },
                compile: function(t, e) {
                    var i = this["compile" + t.typename];
                    i ? i.call(this, t, e) : this.fail("compile: Cannot compile node: " + t.typename, t.lineno, t.colno)
                },
                getCode: function() {
                    return this.codebuf.join("")
                }
            });
            r.compiler = {
                compile: function(t, e, r, a, s) {
                    var o = new l(a);
                    if (r && r.length)
                        for (var u = 0; u < r.length; u++)
                            "preprocess"in r[u] && (t = r[u].preprocess(t, a));
                    return o.compile(n.transform(i.parse(t, r, s), e, a)),
                    o.getCode()
                },
                Compiler: l
            }
        }(),
        function() {
            "use strict";
            var t = r.lib
              , e = r.runtime
              , i = {
                abs: function(t) {
                    return Math.abs(t)
                },
                batch: function(t, e, i) {
                    for (var n = [], r = [], a = 0; a < t.length; a++)
                        a % e === 0 && r.length && (n.push(r),
                        r = []),
                        r.push(t[a]);
                    if (r.length) {
                        if (i)
                            for (var a = r.length; a < e; a++)
                                r.push(i);
                        n.push(r)
                    }
                    return n
                },
                capitalize: function(t) {
                    var i = t.toLowerCase();
                    return e.copySafeness(t, i.charAt(0).toUpperCase() + i.slice(1))
                },
                center: function(i, n) {
                    if (n = n || 80,
                    i.length >= n)
                        return i;
                    var r = n - i.length
                      , a = t.repeat(" ", r / 2 - r % 2)
                      , s = t.repeat(" ", r / 2);
                    return e.copySafeness(i, a + i + s)
                },
                "default": function(t, e) {
                    return t ? t : e
                },
                dictsort: function(e, i, n) {
                    if (!t.isObject(e))
                        throw new t.TemplateError("dictsort filter: val must be an object");
                    var r = [];
                    for (var a in e)
                        r.push([a, e[a]]);
                    var s;
                    if (void 0 === n || "key" === n)
                        s = 0;
                    else {
                        if ("value" !== n)
                            throw new t.TemplateError("dictsort filter: You can only sort by either key or value");
                        s = 1
                    }
                    return r.sort(function(e, n) {
                        var r = e[s]
                          , a = n[s];
                        return i || (t.isString(r) && (r = r.toUpperCase()),
                        t.isString(a) && (a = a.toUpperCase())),
                        r > a ? 1 : r === a ? 0 : -1
                    }),
                    r
                },
                escape: function(i) {
                    return "string" == typeof i || i instanceof e.SafeString ? t.escape(i) : i
                },
                safe: function(t) {
                    return e.markSafe(t)
                },
                first: function(t) {
                    return t[0]
                },
                groupby: function(e, i) {
                    return t.groupBy(e, i)
                },
                indent: function(i, n, r) {
                    n = n || 4;
                    for (var a = "", s = i.split("\n"), o = t.repeat(" ", n), u = 0; u < s.length; u++)
                        a += 0 !== u || r ? o + s[u] + "\n" : s[u] + "\n";
                    return e.copySafeness(i, a)
                },
                join: function(e, i, n) {
                    return i = i || "",
                    n && (e = t.map(e, function(t) {
                        return t[n]
                    })),
                    e.join(i)
                },
                last: function(t) {
                    return t[t.length - 1]
                },
                length: function(t) {
                    var i = t;
                    return t instanceof e.SafeString && (i = t.valueOf()),
                    void 0 !== i ? i.length : 0
                },
                list: function(e) {
                    if (t.isString(e))
                        return e.split("");
                    if (t.isObject(e)) {
                        var i = [];
                        if (Object.keys)
                            i = Object.keys(e);
                        else
                            for (var n in e)
                                i.push(n);
                        return t.map(i, function(t) {
                            return {
                                key: t,
                                value: e[t]
                            }
                        })
                    }
                    if (t.isArray(e))
                        return e;
                    throw new t.TemplateError("list filter: type not iterable")
                },
                lower: function(t) {
                    return t.toLowerCase()
                },
                random: function(t) {
                    return t[Math.floor(Math.random() * t.length)]
                },
                rejectattr: function(t, e) {
                    return t.filter(function(t) {
                        return !t[e]
                    })
                },
                selectattr: function(t, e) {
                    return t.filter(function(t) {
                        return !!t[e]
                    })
                },
                replace: function(t, i, n, r) {
                    if (i instanceof RegExp)
                        return t.replace(i, n);
                    var a = t
                      , s = a
                      , o = 1;
                    for (a = a.replace(i, n); s !== a && !(o >= r); )
                        s = a,
                        a = a.replace(i, n),
                        o++;
                    return e.copySafeness(t, a)
                },
                reverse: function(n) {
                    var r;
                    return r = t.isString(n) ? i.list(n) : t.map(n, function(t) {
                        return t
                    }),
                    r.reverse(),
                    t.isString(n) ? e.copySafeness(n, r.join("")) : r
                },
                round: function(t, e, i) {
                    e = e || 0;
                    var n, r = Math.pow(10, e);
                    return n = "ceil" === i ? Math.ceil : "floor" === i ? Math.floor : Math.round,
                    n(t * r) / r
                },
                slice: function(t, e, i) {
                    for (var n = Math.floor(t.length / e), r = t.length % e, a = 0, s = [], o = 0; o < e; o++) {
                        var u = a + o * n;
                        o < r && a++;
                        var l = a + (o + 1) * n
                          , c = t.slice(u, l);
                        i && o >= r && c.push(i),
                        s.push(c)
                    }
                    return s
                },
                sort: function(e, i, n, r) {
                    return e = t.map(e, function(t) {
                        return t
                    }),
                    e.sort(function(e, a) {
                        var s, o;
                        return r ? (s = e[r],
                        o = a[r]) : (s = e,
                        o = a),
                        !n && t.isString(s) && t.isString(o) && (s = s.toLowerCase(),
                        o = o.toLowerCase()),
                        s < o ? i ? 1 : -1 : s > o ? i ? -1 : 1 : 0
                    }),
                    e
                },
                string: function(t) {
                    return e.copySafeness(t, t)
                },
                title: function(t) {
                    for (var n = t.split(" "), r = 0; r < n.length; r++)
                        n[r] = i.capitalize(n[r]);
                    return e.copySafeness(t, n.join(" "))
                },
                trim: function(t) {
                    return e.copySafeness(t, t.replace(/^\s*|\s*$/g, ""))
                },
                truncate: function(t, i, n, r) {
                    var a = t;
                    if (i = i || 255,
                    t.length <= i)
                        return t;
                    if (n)
                        t = t.substring(0, i);
                    else {
                        var s = t.lastIndexOf(" ", i);
                        s === -1 && (s = i),
                        t = t.substring(0, s)
                    }
                    return t += void 0 !== r && null !== r ? r : "...",
                    e.copySafeness(a, t)
                },
                upper: function(t) {
                    return t.toUpperCase()
                },
                urlencode: function(e) {
                    var i = encodeURIComponent;
                    if (t.isString(e))
                        return i(e);
                    var n;
                    if (t.isArray(e))
                        n = e.map(function(t) {
                            return i(t[0]) + "=" + i(t[1])
                        });
                    else {
                        n = [];
                        for (var r in e)
                            e.hasOwnProperty(r) && n.push(i(r) + "=" + i(e[r]))
                    }
                    return n.join("&")
                },
                urlize: function(t, e, i) {
                    isNaN(e) && (e = 1 / 0);
                    var n = i === !0 ? ' rel="nofollow"' : ""
                      , r = /^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/
                      , a = /^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i
                      , s = /^https?:\/\/.*$/
                      , o = /^www\./
                      , u = /\.(?:org|net|com)(?:\:|\/|$)/
                      , l = t.split(/\s+/).filter(function(t) {
                        return t && t.length
                    }).map(function(t) {
                        var i = t.match(r)
                          , l = i && i[1] || t;
                        return s.test(l) ? '<a href="' + l + '"' + n + ">" + l.substr(0, e) + "</a>" : o.test(l) ? '<a href="http://' + l + '"' + n + ">" + l.substr(0, e) + "</a>" : a.test(l) ? '<a href="mailto:' + l + '">' + l + "</a>" : u.test(l) ? '<a href="http://' + l + '"' + n + ">" + l.substr(0, e) + "</a>" : t
                    });
                    return l.join(" ")
                },
                wordcount: function(t) {
                    var e = t ? t.match(/\w+/g) : null;
                    return e ? e.length : null
                },
                "float": function(t, e) {
                    var i = parseFloat(t);
                    return isNaN(i) ? e : i
                },
                "int": function(t, e) {
                    var i = parseInt(t, 10);
                    return isNaN(i) ? e : i
                }
            };
            i.d = i["default"],
            i.e = i.escape,
            r.filters = i
        }(),
        function() {
            "use strict";
            function t(t) {
                var e = -1;
                return {
                    current: null,
                    reset: function() {
                        e = -1,
                        this.current = null
                    },
                    next: function() {
                        return e++,
                        e >= t.length && (e = 0),
                        this.current = t[e],
                        this.current
                    }
                }
            }
            function e(t) {
                t = t || ",";
                var e = !0;
                return function() {
                    var i = e ? "" : t;
                    return e = !1,
                    i
                }
            }
            var i = {
                range: function(t, e, i) {
                    e ? i || (i = 1) : (e = t,
                    t = 0,
                    i = 1);
                    for (var n = [], r = t; r < e; r += i)
                        n.push(r);
                    return n
                },
                cycler: function() {
                    return t(Array.prototype.slice.call(arguments))
                },
                joiner: function(t) {
                    return e(t)
                }
            };
            r.globals = i
        }(),
        function() {
            "use strict";
            var t = r.path
              , e = r.object
              , i = r.lib
              , n = e.extend({
                on: function(t, e) {
                    this.listeners = this.listeners || {},
                    this.listeners[t] = this.listeners[t] || [],
                    this.listeners[t].push(e)
                },
                emit: function(t) {
                    var e = Array.prototype.slice.call(arguments, 1);
                    this.listeners && this.listeners[t] && i.each(this.listeners[t], function(t) {
                        t.apply(null, e)
                    })
                },
                resolve: function(e, i) {
                    return t.resolve(t.dirname(e), i)
                },
                isRelative: function(t) {
                    return 0 === t.indexOf("./") || 0 === t.indexOf("../")
                }
            });
            r.loader = n
        }(),
        function() {
            "use strict";
            var t = r.loader
              , e = t.extend({
                init: function(t, e) {
                    this.precompiled = window.nunjucksPrecompiled || {},
                    this.baseURL = t || "",
                    this.neverUpdate = e
                },
                getSource: function(t) {
                    if (this.precompiled[t])
                        return {
                            src: {
                                type: "code",
                                obj: this.precompiled[t]
                            },
                            path: t
                        };
                    var e = this.fetch(this.baseURL + "/" + t);
                    return e ? {
                        src: e,
                        path: t,
                        noCache: !this.neverUpdate
                    } : null
                },
                fetch: function(t, e) {
                    var i, n, r = !0;
                    return window.XMLHttpRequest ? i = new XMLHttpRequest : window.ActiveXObject && (i = new ActiveXObject("Microsoft.XMLHTTP")),
                    i.onreadystatechange = function() {
                        4 !== i.readyState || 0 !== i.status && 200 !== i.status || !r || (r = !1,
                        n = i.responseText)
                    }
                    ,
                    t += (t.indexOf("?") === -1 ? "?" : "&") + "s=" + (new Date).getTime(),
                    i.open("GET", t, !1),
                    i.send(),
                    n
                }
            });
            r["web-loaders"] = {
                WebLoader: e
            }
        }(),
        function() {
            "undefined" == typeof window || window !== this ? r.loaders = r["node-loaders"] : r.loaders = r["web-loaders"]
        }(),
        function() {
            "use strict";
            var t = r.path
              , e = r.lib
              , i = r.object
              , n = (r.lexer,
            r.compiler)
              , a = r.filters
              , s = r.loaders
              , o = r.runtime
              , u = r.globals
              , l = o.Frame
              , c = i.extend({
                init: function(t, i) {
                    var i = this.opts = i || {};
                    this.opts.dev = !!i.dev,
                    this.opts.autoescape = !!i.autoescape,
                    this.opts.trimBlocks = !!i.trimBlocks,
                    this.opts.lstripBlocks = !!i.lstripBlocks,
                    t ? this.loaders = e.isArray(t) ? t : [t] : s.FileSystemLoader ? this.loaders = [new s.FileSystemLoader("views")] : this.loaders = [new s.WebLoader("/views")],
                    this.initCache(),
                    this.filters = {},
                    this.asyncFilters = [],
                    this.extensions = {},
                    this.extensionsList = [];
                    for (var n in a)
                        this.addFilter(n, a[n])
                },
                initCache: function() {
                    e.each(this.loaders, function(t) {
                        t.cache = {},
                        "function" == typeof t.on && t.on("update", function(e) {
                            t.cache[e] = null
                        })
                    })
                },
                addExtension: function(t, e) {
                    e._name = t,
                    this.extensions[t] = e,
                    this.extensionsList.push(e)
                },
                getExtension: function(t) {
                    return this.extensions[t]
                },
                addGlobal: function(t, e) {
                    u[t] = e
                },
                addFilter: function(t, e, i) {
                    var n = e;
                    i && this.asyncFilters.push(t),
                    this.filters[t] = n
                },
                getFilter: function(t) {
                    if (!this.filters[t])
                        throw new Error("filter not found: " + t);
                    return this.filters[t]
                },
                resolveTemplate: function(t, e, i) {
                    var n = !(!t.isRelative || !e) && t.isRelative(i);
                    return n && t.resolve ? t.resolve(e, i) : i
                },
                getTemplate: function(t, i, n, r) {
                    var a = this
                      , s = null;
                    if (t && t.raw && (t = t.raw),
                    e.isFunction(n) && (r = n,
                    n = null,
                    i = i || !1),
                    e.isFunction(i) && (r = i,
                    i = !1),
                    "string" != typeof t)
                        throw new Error("template names must be a string: " + t);
                    for (var o = 0; o < this.loaders.length; o++) {
                        var u = this.resolveTemplate(this.loaders[o], n, t);
                        if (s = this.loaders[o].cache[u])
                            break
                    }
                    if (!s) {
                        var l;
                        return e.asyncIter(this.loaders, function(e, i, r, s) {
                            function o(t) {
                                t ? (t.loader = e,
                                s(t)) : r()
                            }
                            t = a.resolveTemplate(e, n, t),
                            e.async ? e.getSource(t, function(t, e) {
                                if (t)
                                    throw t;
                                o(e)
                            }) : o(e.getSource(t))
                        }, function(e) {
                            if (e) {
                                var n = new d(e.src,this,e.path,i);
                                e.noCache || (e.loader.cache[t] = n),
                                r ? r(null, n) : l = n
                            } else {
                                var a = new Error("template not found: " + t);
                                if (!r)
                                    throw a;
                                r(a)
                            }
                        }
                        .bind(this)),
                        l
                    }
                    return i && s.compile(),
                    r ? void r(null, s) : s
                },
                express: function(e) {
                    function i(e, i) {
                        if (this.name = e,
                        this.path = e,
                        this.defaultEngine = i.defaultEngine,
                        this.ext = t.extname(e),
                        !this.ext && !this.defaultEngine)
                            throw new Error("No default engine was specified and no extension was provided.");
                        this.ext || (this.name += this.ext = ("." !== this.defaultEngine[0] ? "." : "") + this.defaultEngine)
                    }
                    var n = this;
                    i.prototype.render = function(t, e) {
                        n.render(this.name, t, e)
                    }
                    ,
                    e.set("view", i)
                },
                render: function(t, i, n) {
                    e.isFunction(i) && (n = i,
                    i = null);
                    var r = null;
                    return this.getTemplate(t, function(t, e) {
                        if (t && n)
                            n(t);
                        else {
                            if (t)
                                throw t;
                            e.render(i, n || function(t, e) {
                                if (t)
                                    throw t;
                                r = e
                            }
                            )
                        }
                    }),
                    r
                },
                renderString: function(t, i, n, r) {
                    e.isFunction(n) && (r = n,
                    n = {}),
                    n = n || {};
                    var a = new d(t,this,n.path);
                    return a.render(i, r)
                }
            })
              , h = i.extend({
                init: function(t, e) {
                    this.ctx = t,
                    this.blocks = {},
                    this.exported = [];
                    for (var i in e)
                        this.addBlock(i, e[i])
                },
                lookup: function(t) {
                    return t in u && !(t in this.ctx) ? u[t] : this.ctx[t]
                },
                setVariable: function(t, e) {
                    this.ctx[t] = e
                },
                getVariables: function() {
                    return this.ctx
                },
                addBlock: function(t, e) {
                    this.blocks[t] = this.blocks[t] || [],
                    this.blocks[t].push(e)
                },
                getBlock: function(t) {
                    if (!this.blocks[t])
                        throw new Error('unknown block "' + t + '"');
                    return this.blocks[t][0]
                },
                getSuper: function(t, i, n, r, a, s) {
                    var o = e.indexOf(this.blocks[i] || [], n)
                      , u = this.blocks[i][o + 1]
                      , l = this;
                    if (o === -1 || !u)
                        throw new Error('no super block available for "' + i + '"');
                    u(t, l, r, a, s)
                },
                addExport: function(t) {
                    this.exported.push(t)
                },
                getExported: function() {
                    for (var t = {}, e = 0; e < this.exported.length; e++) {
                        var i = this.exported[e];
                        t[i] = this.ctx[i]
                    }
                    return t
                }
            })
              , d = i.extend({
                init: function(t, i, n, r) {
                    if (this.env = i || new c,
                    e.isObject(t))
                        switch (t.type) {
                        case "code":
                            this.tmplProps = t.obj;
                            break;
                        case "string":
                            this.tmplStr = t.obj
                        }
                    else {
                        if (!e.isString(t))
                            throw new Error("src must be a string or an object describing the source");
                        this.tmplStr = t
                    }
                    this.path = n,
                    r ? e.withPrettyErrors(this.path, this.env.dev, this._compile.bind(this)) : this.compiled = !1
                },
                render: function(t, i, n) {
                    return "function" == typeof t ? (n = t,
                    t = {}) : "function" == typeof i && (n = i,
                    i = null),
                    e.withPrettyErrors(this.path, this.env.dev, function() {
                        try {
                            this.compile()
                        } catch (e) {
                            if (n)
                                return n(e);
                            throw e
                        }
                        var r = new h(t || {},this.blocks)
                          , a = null;
                        return this.rootRenderFunc(this.env, r, i || new l, o, n || function(t, e) {
                            if (t)
                                throw t;
                            a = e
                        }
                        ),
                        a
                    }
                    .bind(this))
                },
                getExported: function(t, e, i) {
                    "function" == typeof t && (i = t,
                    t = {}),
                    "function" == typeof e && (i = e,
                    e = null);
                    try {
                        this.compile()
                    } catch (n) {
                        if (i)
                            return i(n);
                        throw n
                    }
                    var r = new h(t || {},this.blocks);
                    this.rootRenderFunc(this.env, r, e || new l, o, function() {
                        i(null, r.getExported())
                    })
                },
                compile: function() {
                    this.compiled || this._compile()
                },
                _compile: function() {
                    var t;
                    if (this.tmplProps)
                        t = this.tmplProps;
                    else {
                        var e = n.compile(this.tmplStr, this.env.asyncFilters, this.env.extensionsList, this.path, this.env.opts)
                          , i = new Function(e);
                        t = i()
                    }
                    this.blocks = this._getBlocks(t),
                    this.rootRenderFunc = t.root,
                    this.compiled = !0
                },
                _getBlocks: function(t) {
                    var e = {};
                    for (var i in t)
                        "b_" === i.slice(0, 2) && (e[i.slice(2)] = t[i]);
                    return e
                }
            });
            r.environment = {
                Environment: c,
                Template: d
            }
        }();
        var a, s = r.lib, o = r.environment, u = r.compiler, l = r.parser, c = r.lexer, h = r.runtime, d = r.loader, p = r.loaders, f = r.precompile;
        a = {},
        a.Environment = o.Environment,
        a.Template = o.Template,
        a.Loader = d,
        a.FileSystemLoader = p.FileSystemLoader,
        a.WebLoader = p.WebLoader,
        a.compiler = u,
        a.parser = l,
        a.lexer = c,
        a.runtime = h;
        var g;
        a.configure = function(t, e) {
            e = e || {},
            s.isObject(t) && (e = t,
            t = null);
            var i = "watch"in e && !e.watch
              , n = p.FileSystemLoader || p.WebLoader;
            return g = new o.Environment(new n(t,i),e),
            e && e.express && g.express(e.express),
            g
        }
        ,
        a.compile = function(t, e, i, n) {
            return g || a.configure(),
            new a.Template(t,e,i,n)
        }
        ,
        a.render = function(t, e, i) {
            return g || a.configure(),
            g.render(t, e, i)
        }
        ,
        a.renderString = function(t, e, i) {
            return g || a.configure(),
            g.renderString(t, e, i)
        }
        ,
        f && (a.precompile = f.precompile,
        a.precompileString = f.precompileString),
        a.require = function(t) {
            return r[t]
        }
        ,
        n = function() {
            return a
        }
        .call(e, i, e, t),
        !(void 0 !== n && (t.exports = n))
    }()
}
, function(t, e, i) {
    "use strict";
    var n, r = i(216), a = i(245), s = i(246);
    n = s.extend({
        model: a,
        url: "/i/categories",
        _immutableCollectionName: "categories",
        getTree: function() {
            var t = this.toJSON()
              , e = [];
            return r.each(t, function(t) {
                t.children.length && e.push({
                    children: t.children,
                    value: t.uid,
                    label: t.name
                })
            }),
            r.each(e, function(t) {
                var e = t.children.slice();
                r.each(e, function(e, i) {
                    if ("string" == typeof e) {
                        var n = this.get(e).toJSON()
                          , r = {
                            value: n.uid,
                            label: n.name
                        };
                        n.children.length && (r.children = n.children),
                        t.children.splice(i, 1, r)
                    }
                }
                .bind(this))
            }
            .bind(this)),
            e
        }
    }),
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(238);
    t.exports = n.extend({})
}
, function(t, e, i) {
    "use strict";
    var n, r = i(216), a = i(247);
    n = a.extend({}, {
        get: function(t) {
            t = r.extend({}, t);
            var e = this
              , i = new e;
            return t.allowPrefetching !== !1 ? (void 0 === this[this._immutableCollectionName] && (this[this._immutableCollectionName] = i),
            this[this._immutableCollectionName].fetch(t),
            this[this._immmutableCollectionName]) : i.fetch(t)
        }
    }),
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(234)
      , a = i(248);
    t.exports = r.Collection.extend({
        backend: a,
        constructor: function() {
            this.options = arguments[1] || {},
            r.Collection.apply(this, arguments)
        },
        at: function(t) {
            return t < 0 ? void 0 : r.Collection.prototype.at.call(this, t)
        },
        initialize: function() {
            this.options.backend && (this.backend = this.options.backend),
            this.backend && (this.__proto = {},
            n.each(this.backend, function(t, e) {
                "function" == typeof t ? (this[e] && (this.__proto[e] = this[e]),
                this[e] = t.bind(this)) : this[e] = t
            }
            .bind(this))),
            r.Collection.prototype.initialize.apply(this, arguments)
        },
        add: function() {
            var t = r.Collection.prototype.add.apply(this, arguments);
            return this.trigger("afterAdd", this.models),
            t
        },
        set: function() {
            var t = r.Collection.prototype.set.apply(this, arguments);
            return this.trigger("afterAdd", this.models),
            t
        },
        loadMore: function(t) {
            var e = this.options.offset || 0
              , i = this.options.count || 10;
            if (this.options.offset = e + i,
            !(this.options.maxOffset && this.options.offset >= this.options.maxOffset))
                return this.fetch(n.extend({}, {
                    remove: !1
                }, t))
        },
        decorateUri: function(t) {
            return this.options.cursor && (t = t.replace(/(cursor=.+?)(&|$)|[&](cursor=.+?)(&|$)/, "&"),
            t = t + "&cursor=" + this.options.cursor),
            t
        },
        url: function() {
            var t, e = n.result(this, "domain"), i = n.result(this, "endpoint"), r = e + i;
            return t = this.decorateUri(r)
        },
        sync: function(t, e, i) {
            var n = i.success
              , a = i.revision;
            return a === !0 && (a = Date.now()),
            i.success = function(t) {
                t.__skfbRevision = a,
                this.pendingRevision === a && (this.revision = this.pendingRevision,
                this.trigger("revision", this.revision)),
                (void 0 === a || this.revision <= a) && n(t)
            }
            .bind(this),
            r.Collection.prototype.sync.call(this, t, e, i)
        },
        fetch: function(t) {
            var e = t ? t.revision : Date.now()
              , i = r.Collection.prototype.fetch;
            return t = t || {},
            n.defaults(t, {
                remove: !1
            }),
            (!this.pendingRevision || e > this.pendingRevision) && (this.pendingRevision = e),
            this.trigger("revisionStart", e),
            i.apply(this, arguments)
        },
        reset: function(t, e) {
            if (this.options.continuous) {
                var i = "function" == typeof this.parse ? this.parse(t) : t;
                return this.refresh(i, e)
            }
            return r.Collection.prototype.reset.apply(this, arguments)
        },
        refresh: function(t, e) {
            var i;
            this.each(function(t) {
                t._remove = !0
            }),
            n.each(t, function(t) {
                i = this.get(t[this.model.prototype.idAttribute]),
                i ? (i.set(t),
                delete i._remove) : this.add(t)
            }
            .bind(this));
            var a = this.filter(function(t) {
                return t._remove
            });
            n.each(a, function(t) {
                this.remove(t)
            }
            .bind(this)),
            r.Collection.prototype.reset.call(this, n.map(t, function(t) {
                return this.get(t.uid)
            }
            .bind(this)), {
                silent: !0
            }),
            this.trigger("refresh", e)
        }
    })
}
, function(t, e) {
    "use strict";
    t.exports = {
        name: "internal",
        domain: "/i",
        parse: function(t) {
            return t.results
        }
    }
}
, function(t, e, i) {
    "use strict";
    var n, r = i(250), a = i(246);
    n = a.extend({
        model: r,
        _immutableCollectionName: "skills",
        url: "/i/skills"
    }),
    t.exports = n
}
, 245, function(t, e) {
    "use strict";
    t.exports = function(t, e, i) {
        return t && 0 !== t.images.length ? 1 === t.images.length ? t.images[0].url : t.images.reduce(function(t, n) {
            var r = Math.abs(e - t.width)
              , a = Math.abs(i - t.height)
              , s = r + a
              , o = Math.abs(e - n.width)
              , u = Math.abs(i - n.height)
              , l = o + u;
            return (t.width < e || t.height < i) && (s += e * i),
            (n.width < e || n.height < i) && (l += e * i),
            s < l ? t : n
        }).url : ""
    }
}
, function(t, e) {
    "use strict";
    var i = ["a", "e", "i", "o", "u", "h"]
      , n = function(t, e) {
        var n, r, a, s;
        t < 0 ? (n = "in ",
        r = "") : (n = "",
        r = " ago");
        var o = Math.abs(t);
        return 1 !== o ? (a = o.toString(),
        s = "s") : (a = i.indexOf(e[0]) !== -1 ? "an " : "a ",
        s = ""),
        n + a + " " + e + s + r
    }
      , r = {
        1e3: function(t) {
            return n(t, "second")
        },
        6e4: function(t) {
            return n(t, "minute")
        },
        36e5: function(t) {
            return n(t, "hour")
        },
        864e5: function(t) {
            return n(t, "day")
        },
        6048e5: function(t) {
            return n(t, "week")
        },
        24192e5: function(t) {
            return n(t, "month")
        },
        290304e5: function(t) {
            return n(t, "year")
        }
    };
    t.exports = {
        timeAgo: function(t) {
            var e = (new Date).getTime()
              , i = t.getTime()
              , n = e - i
              , a = null;
            Object.keys(r).forEach(function(t) {
                t = parseInt(t),
                (null === a || t > a && Math.floor(n / t) >= 1) && (a = t)
            });
            var s = Math.floor(n / a);
            return r[a](s)
        }
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(243)
      , r = i(254)
      , a = new RegExp("(\\s+|')","g")
      , s = new RegExp("^([^\\w@]*)((?:.|\r|\n)*?)((?:[^\\w._-]|&gt;|&lt;|&amp|&quot)*)$")
      , o = new RegExp("^https?://")
      , u = new RegExp("^\\S+@[a-zA-Z0-9._-]+\\.[a-zA-Z0-9._-]+$")
      , l = new RegExp("(^www\\.)|(\\.(com|net|org)$)")
      , c = new RegExp("(@[a-zA-Z0-9._-]+)")
      , h = {};
    h.underscorify = function(t) {
        return t.replace(/([A-Z])/g, "_$1").toLowerCase()
    }
    ,
    h.slugify = function(t) {
        return t.replace(/[^\w\s-]+/g, "").trim().toLowerCase().replace(/[-\s]+/g, "-")
    }
    ,
    h.urlize = function(t, e, i, r) {
        function h(t) {
            return t.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")
        }
        var d = Array.prototype.slice.call(arguments, 0);
        if (d.length && d[d.length - 1].__keywords) {
            var p = d.pop()
              , f = d[1]
              , g = d[2]
              , m = d[3];
            e = f || p.trim_url_limit,
            i = g || p.nofollow,
            r = m || p.target
        }
        null == i && (i = !0);
        var v = function(t) {
            return t = t.replace(/^(https?:\/\/)?(www\.)?/, ""),
            null == e ? t : t.length <= e ? t : t.substr(0, e) + "..."
        };
        "string" == typeof t && (t = h(t));
        var _ = t.split(a)
          , b = ["noopener", "noreferrer"]
          , x = r ? ' target="' + r + '"' : "";
        return i && b.push("nofollow"),
        n.runtime.markSafe(_.map(function(t) {
            var e = t.match(s);
            if (null === e)
                return t;
            e = e.slice(1);
            var i = e[0]
              , n = e[1]
              , r = e[2]
              , a = b.join(" ");
            return n.match(o) ? i + '<a href="' + n + '" rel="' + a + '"' + x + ">" + v(n) + "</a>" + r : n.match(u) && n.indexOf(":") === -1 ? i + '<a href="mailto:' + n + '">' + n + "</a>" + r : n.match(l) ? i + '<a href="http://' + n + '" rel="' + a + '"' + x + ">" + v(n) + "</a>" + r : n.match(c) ? i + '<a href="https://' + window.location.host + "/" + n.substring(1) + '" rel="' + a + '">' + v(n) + "</a>" + r : t
        }).join(""))
    }
    ,
    h.stripTags = function(t) {
        return n.runtime.markSafe(r.sanitize(t, {
            ALLOWED_TAGS: []
        }))
    }
    ,
    h.paragraphy = function(t) {
        var e = t.match(/.+/g);
        return e ? n.runtime.markSafe(e.map(function(t) {
            return "<p>" + t + "</p>"
        }).join("")) : t
    }
    ,
    h.pluralize = function(t, e, i) {
        return void 0 === e && (e = ""),
        void 0 === i && (i = "s"),
        1 === t ? e : i
    }
    ,
    h.findWithDelimiters = function(t, e, i) {
        return t.split(e).pop().split(i)[0]
    }
    ,
    t.exports = h
}
, function(t, e, i) {
    var n, r;
    !function(a, s) {
        "use strict";
        n = s,
        r = "function" == typeof n ? n.call(e, i, e, t) : n,
        !(void 0 !== r && (t.exports = r))
    }(this, function() {
        "use strict";
        var t = {};
        return t.sanitize = function(t, e) {
            var i = ["a", "abbr", "acronym", "address", "area", "article", "aside", "audio", "b", "bdi", "bdo", "big", "blink", "blockquote", "body", "br", "button", "canvas", "caption", "center", "cite", "code", "col", "colgroup", "content", "data", "datalist", "dd", "decorator", "del", "details", "dfn", "dir", "div", "dl", "dt", "element", "em", "fieldset", "figcaption", "figure", "font", "footer", "form", "h1", "h2", "h3", "h4", "h5", "h6", "head", "header", "hgroup", "hr", "html", "i", "img", "input", "ins", "kbd", "label", "legend", "li", "main", "map", "mark", "marquee", "menu", "menuitem", "meter", "nav", "nobr", "ol", "optgroup", "option", "output", "p", "pre", "progress", "q", "rp", "rt", "ruby", "s", "samp", "section", "select", "shadow", "small", "source", "spacer", "span", "strike", "strong", "style", "sub", "summary", "sup", "table", "tbody", "td", "template", "textarea", "tfoot", "th", "thead", "time", "tr", "track", "tt", "u", "ul", "var", "video", "wbr", "svg", "altglyph", "altglyphdef", "altglyphitem", "animatecolor", "animatemotion", "animatetransform", "circle", "clippath", "defs", "desc", "ellipse", "font", "g", "glyph", "glyphref", "hkern", "image", "line", "lineargradient", "marker", "mask", "metadata", "mpath", "path", "pattern", "polygon", "polyline", "radialgradient", "rect", "stop", "switch", "symbol", "text", "textpath", "title", "tref", "tspan", "view", "vkern", "math", "menclose", "merror", "mfenced", "mfrac", "mglyph", "mi", "mlabeledtr", "mmuliscripts", "mn", "mo", "mover", "mpadded", "mphantom", "mroot", "mrow", "ms", "mpspace", "msqrt", "mystyle", "msub", "msup", "msubsup", "mtable", "mtd", "mtext", "mtr", "munder", "munderover", "#text"]
              , n = !0
              , r = ["accept", "action", "align", "alt", "autocomplete", "bgcolor", "border", "checked", "cite", "class", "color", "cols", "colspan", "coords", "datetime", "default", "dir", "disabled", "download", "enctype", "for", "headers", "height", "hidden", "high", "href", "hreflang", "id", "ismap", "label", "lang", "list", "loop", "low", "max", "maxlength", "media", "method", "min", "multiple", "name", "novalidate", "open", "optimum", "pattern", "placeholder", "poster", "preload", "pubdate", "radiogroup", "readonly", "rel", "required", "rev", "reversed", "rows", "rowspan", "spellcheck", "scope", "selected", "shape", "size", "span", "srclang", "start", "src", "step", "style", "summary", "tabindex", "title", "type", "usemap", "valign", "value", "width", "xmlns", "accent-height", "accumulate", "additivive", "alignment-baseline", "ascent", "azimuth", "baseline-shift", "bias", "clip", "clip-path", "clip-rule", "color", "color-interpolation", "color-interpolation-filters", "color-profile", "color-rendering", "cx", "cy", "d", "dy", "dy", "direction", "display", "divisor", "dur", "elevation", "end", "fill", "fill-opacity", "fill-rule", "filter", "flood-color", "flood-opacity", "font-family", "font-size", "font-size-adjust", "font-stretch", "font-style", "font-variant", "front-weight", "image-rendering", "in", "in2", "k1", "k2", "k3", "k4", "kerning", "letter-spacing", "lighting-color", "local", "marker-end", "marker-mid", "marker-start", "max", "mask", "mode", "min", "operator", "opacity", "order", "overflow", "paint-order", "path", "points", "r", "rx", "ry", "radius", "restart", "scale", "seed", "shape-rendering", "stop-color", "stop-opacity", "stroke-dasharray", "stroke-dashoffset", "stroke-linecap", "stroke-linejoin", "stroke-miterlimit", "stroke-opacity", "stroke", "stroke-width", "transform", "text-anchor", "text-decoration", "text-rendering", "u1", "u2", "viewbox", "visibility", "word-spacing", "wrap", "writing-mode", "x", "x1", "x2", "y", "y1", "y2", "z", "accent", "accentunder", "bevelled", "close", "columnsalign", "columnlines", "columnspan", "denomalign", "depth", "display", "displaystyle", "fence", "frame", "largeop", "length", "linethickness", "lspace", "lquote", "mathbackground", "mathcolor", "mathsize", "mathvariant", "maxsize", "minsize", "movablelimits", "notation", "numalign", "open", "rowalign", "rowlines", "rowspacing", "rowspan", "rspace", "rquote", "scriptlevel", "scriptminsize", "scriptsizemultiplier", "selection", "separator", "separators", "stretchy", "subscriptshift", "supscriptshift", "symmetric", "voffset", "xlink:href", "xml:id", "xlink:title", "xml:space"]
              , a = !1
              , s = !1
              , o = !1
              , u = !0
              , l = !0
              , c = ["a", "abbr", "acronym", "address", "article", "aside", "b", "bdi", "bdo", "big", "blink", "blockquote", "caption", "center", "cite", "code", "col", "dd", "del", "details", "dfn", "dir", "div", "dl", "dt", "em", "figcaption", "figure", "footer", "h1", "h2", "h3", "h4", "h5", "h6", "header", "i", "ins", "kbd", "label", "legend", "li", "main", "mark", "marquee", "nav", "ol", "output", "p", "pre", "q", "rp", "rt", "ruby", "s", "samp", "section", "small", "span", "strike", "strong", "sub", "summary", "sup", "table", "tbody", "td", "tfoot", "th", "thead", "time", "tr", "tt", "u", "ul", "var"]
              , h = function(t) {
                t.ALLOWED_ATTR ? r = t.ALLOWED_ATTR : null,
                t.ALLOWED_TAGS ? i = t.ALLOWED_TAGS : null,
                t.ALLOW_DATA_ATTR ? n = t.ALLOW_DATA_ATTR : null,
                t.SAFE_FOR_JQUERY ? o = t.SAFE_FOR_JQUERY : null,
                t.WHOLE_DOCUMENT ? a = t.WHOLE_DOCUMENT : null,
                t.RETURN_DOM ? s = t.RETURN_DOM : null,
                t.SANITIZE_DOM ? u = t.SANITIZE_DOM : null,
                t.KEEP_CONTENT ? l = t.KEEP_CONTENT : null,
                t.ADD_ATTR ? r = r.concat(t.ADD_ATTR) : null,
                t.ADD_TAGS ? i = i.concat(t.ADD_TAGS) : null,
                l ? i.push("#text") : null
            }
              , d = function(t) {
                var e = document.implementation.createHTMLDocument("");
                e.body.parentNode.removeChild(e.body.parentNode.firstElementChild),
                e.body.outerHTML = t,
                null === e.body && (e.body.innerHTML = t);
                var i = a ? e.body.parentNode : e.body;
                if (!(e.body instanceof HTMLBodyElement && e.body instanceof HTMLHtmlElement)) {
                    var n = document.implementation.createHTMLDocument("");
                    i = a ? n.getElementsByTagName.call(e, "html")[0] : n.getElementsByTagName.call(e, "body")[0]
                }
                return i
            }
              , p = function(t) {
                return document.createNodeIterator(t, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT, function() {
                    return NodeFilter.FILTER_ACCEPT
                }, !1)
            }
              , f = function(t) {
                return !(t instanceof Text) && !!(t.children && !(t.children instanceof HTMLCollection) || t.attributes instanceof NodeList || "string" != typeof t.nodeName || "string" != typeof t.textContent || "number" != typeof t.nodeType || "number" != typeof t.COMMENT_NODE || "function" != typeof t.setAttribute || "function" != typeof t.cloneNode || "function" != typeof t.removeAttributeNode || "function" != typeof t.insertAdjacentHTML || "function" != typeof t.attributes.item)
            }
              , g = function(t) {
                if (f(t)) {
                    try {
                        t.parentNode.removeChild(t)
                    } catch (e) {
                        t.outerHTML = ""
                    }
                    return !0
                }
                if (t.nodeType === t.COMMENT_NODE || i.indexOf(t.nodeName.toLowerCase()) === -1) {
                    if (l && t.insertAdjacentHTML && t.nodeName.toLowerCase && c.indexOf(t.nodeName.toLowerCase()) !== -1)
                        try {
                            t.insertAdjacentHTML("AfterEnd", t.innerHTML)
                        } catch (e) {}
                    return t.parentNode.removeChild(t),
                    !0
                }
                return o && !t.firstElementChild && (t.textContent = t.textContent.replace(/</g, "&lt;")),
                !1
            }
              , m = function(t) {
                var e, i, a = /^(\w+script|data):/gi, s = t.cloneNode(!0);
                if (t.attributes)
                    for (var o = t.attributes.length - 1; o >= 0; o--)
                        e = s.attributes[o],
                        i = !1,
                        t.removeAttribute(t.attributes[o].name),
                        e instanceof Attr && (u && ("id" === e.name && window[e.value] && (i = !0),
                        "name" === e.name && document[e.value] && (i = !0)),
                        !(r.indexOf(e.name.toLowerCase()) > -1 || n && e.name.match(/^data-[\w-]+/i)) || e.value.replace(/[\x00-\x20]/g, "").match(a) && ("src" !== e.name || 0 !== e.value.indexOf("data:") || "IMG" !== e.ownerElement.nodeName) || i || t.setAttribute(e.name, e.value))
            }
              , v = function(t) {
                for (var e, i = p(t); e = i.nextNode(); )
                    g(e) || (e.content instanceof DocumentFragment && v(e.content),
                    m(e))
            };
            e ? h(e) : null;
            var _ = d(t);
            if ("undefined" == typeof _)
                return "";
            for (var b, x = p(_); b = x.nextNode(); )
                g(b) || (b.content instanceof DocumentFragment && v(b.content),
                m(b));
            return s ? _ : a ? _.outerHTML : _.innerHTML
        }
        ,
        t
    })
}
, , , function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(216)
      , a = i(258)
      , s = i(259)
      , o = [];
    t.exports = a.extend({
        parent: "body",
        events: r.extend({}, a.prototype.events, {
            "click .popup-overlay": "_close",
            'click [data-action="close"]': "_close"
        }),
        constructor: function() {
            this.onKeyDown = this.onKeyDown.bind(this),
            this.lazyResize = r.debounce(this.center, 50),
            this.resizeHandler = function() {
                n.each(o, function(t, e) {
                    e.lazyResize()
                })
            }
            .bind(this),
            a.prototype.constructor.apply(this, arguments)
        },
        initialize: function() {
            if (a.prototype.initialize.apply(this, arguments),
            this.options = r.defaults(this.options || {}, {
                cleanOnClose: !0
            }),
            n(this.options.el)[0] !== n(this.el)[0]) {
                if (!this.template)
                    throw new Error("You cannot use this class without specifying an element during instanciation");
                this.setElement(r.result(this, "template"))
            }
        },
        delegateEvents: function() {
            a.prototype.delegateEvents.apply(this, arguments),
            n(window).on("resize", this.resizeHandler),
            document.addEventListener("keydown", this.onKeyDown, !0)
        },
        undelegateEvents: function() {
            a.prototype.undelegateEvents.apply(this, arguments),
            n(window).off("resize", this.resizeHandler),
            document.removeEventListener("keydown", this.onKeyDown, !0)
        },
        open: function(t) {
            if (o.indexOf(this) !== -1)
                return this.show(),
                this.setElement(this.$el),
                this;
            o.unshift(this);
            var e = n(r.result(this, "parent"));
            return e.append(this.$el),
            this.setElement(this.$el),
            t ? this : (this.hide(),
            this.center(),
            window.requestAnimationFrame(function() {
                this.show()
            }
            .bind(this)),
            this.autofocus(),
            this.center(),
            this)
        },
        show: function() {
            this.$el.removeClass("hidden")
        },
        hide: function() {
            this.$el.addClass("hidden")
        },
        isHidden: function() {
            return this.$el.hasClass("hidden")
        },
        onKeyDown: function(t) {
            27 === t.keyCode && 0 !== o.length && (o[0].close(),
            t.stopImmediatePropagation(),
            t.stopPropagation())
        },
        _close: function(t, e) {
            return o.indexOf(this) === -1 ? this : this.$el.closest(".inline-popup").length > 0 ? this : ((this.options.cleanOnClose || e) && (s(this.$el, this.remove.bind(this)),
            o.indexOf(this) !== -1 && o.splice(o.indexOf(this), 1)),
            this.hide(),
            this)
        },
        close: function(t) {
            return this._close(null, t)
        },
        replaceWith: function(t) {
            return this.close(),
            t.open(),
            t
        },
        center: function() {
            var t = this.$(".popup")
              , e = this.$(".popup-overlay")
              , i = n(window).width()
              , r = n(window).height()
              , a = n(document).height()
              , s = t.width()
              , o = t.height()
              , u = n(document).scrollTop()
              , l = r / 2 - o / 2 + u
              , c = i / 2 - s / 2;
            o > r && (l += (o - r) / 2),
            e.width(i),
            e.height(a),
            t.css({
                left: c,
                top: l
            });
            var h = c + s / 2 + "px"
              , d = l + o / 2 + "px"
              , p = h + " " + d;
            document.getElementsByClassName("popup-container")[0].style.perspectiveOrigin = p
        },
        resize: function(t) {
            var e = this.$(".popup");
            return t.width && e.width(t.width),
            t.height && e.height(t.height),
            this
        },
        autofocus: function() {
            var t = window.scrollX
              , e = window.scrollY;
            this.$el.find(".form-input:visible").length > 0 ? (this.$el.find(".form-input").eq(0).focus(),
            window.scrollTo(t, e)) : (this.$el.find(".btn-primary, .submit").focus(),
            window.scrollTo(t, e))
        },
        remove: function() {
            return this.undelegateEvents(),
            a.prototype.remove.apply(this, arguments)
        }
    })
}
, , function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(216)
      , a = r.find({
        WebkitTransition: "webkitTransitionEnd",
        MozTransition: "transitionend",
        OTransition: "oTransitionEnd otransitionend",
        transition: "transitionend"
    }, function(t, e) {
        return e in document.body.style
    });
    t.exports = function(t, e) {
        setTimeout(function() {
            n(t).one(a, e)
        })
    }
}
, , function(t, e) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/layouts/popup.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    o += '<div class="popup-container',
                    n.contextOrFrameLookup(e, i, "popupNeedsLoading") && (o += " popup-loading"),
                    o += " ",
                    o += n.suppressValue(n.contextOrFrameLookup(e, i, "popupClass"), t.opts.autoescape),
                    o += '">\n\n    <div class="popup-overlay">\n    </div>\n\n    <form class="popup" method="post"',
                    n.contextOrFrameLookup(e, i, "allowAutocomplete") || (o += ' autocomplete="off"'),
                    o += " ",
                    n.contextOrFrameLookup(e, i, "popupAction") && (o += 'action="',
                    o += n.suppressValue(n.contextOrFrameLookup(e, i, "popupAction"), t.opts.autoescape),
                    o += '"'),
                    o += ">\n\n        ",
                    n.contextOrFrameLookup(e, i, "allowAutocomplete") || (o += "\n            ",
                    o += '\n            <input type="text" style="display:none" />\n            <input type="password" style="display:none" />\n        '),
                    o += '\n\n        <input type="hidden" name="csrfmiddlewaretoken" value="',
                    o += n.suppressValue(n.contextOrFrameLookup(e, i, "csrf_token"), t.opts.autoescape),
                    o += '" />\n\n        <header class="popup-header">\n\n            ',
                    e.getBlock("popup_header")(t, e, i, n, function(a, s) {
                        return a ? void r(a) : (o += s,
                        o += '\n\n            <div class="popup-actions">\n                ',
                        n.contextOrFrameLookup(e, i, "popupClosable") && (o += '\n                    <a class="popup-close" data-action="close">\n                        <i class="fa fa-times"></i>\n                    </a>\n                '),
                        o += '\n            </div>\n\n        </header>\n\n        <div class="popup-content">\n\n            <div class="popup-content-overlay"></div>\n\n            ',
                        void e.getBlock("popup_content")(t, e, i, n, function(a, s) {
                            return a ? void r(a) : (o += s,
                            o += '\n        </div>\n\n        <footer class="popup-footer">\n            ',
                            void e.getBlock("popup_footer")(t, e, i, n, function(t, e) {
                                return t ? void r(t) : (o += e,
                                o += "\n        </footer>\n\n    </form>\n\n</div>\n",
                                void r(null, o))
                            }))
                        }))
                    })
                } catch (u) {
                    r(n.handleError(u, a, s))
                }
            }
            function e(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    o += '\n                <div class="popup-title">\n                    ',
                    o += n.suppressValue(n.contextOrFrameLookup(e, i, "popupTitle"), t.opts.autoescape),
                    o += "\n                </div>\n            ",
                    r(null, o)
                } catch (u) {
                    r(n.handleError(u, a, s))
                }
            }
            function i(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    o += "\n            ",
                    r(null, o)
                } catch (u) {
                    r(n.handleError(u, a, s))
                }
            }
            function n(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    o += "\n            ",
                    r(null, o)
                } catch (u) {
                    r(n.handleError(u, a, s))
                }
            }
            return {
                b_popup_header: e,
                b_popup_content: i,
                b_popup_footer: n,
                root: t
            }
        }()
    }()
}
, , , , function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(266);
    t.exports = {
        isMaintenance: function() {
            return n('meta[property="skfb:maintenance"]').attr("content")
        },
        showPopup: function() {
            var t = 'Sketchfab is undergoing maintenance.<br>See: <a href="https://forum.sketchfab.com/t/sketchfab-operations/6678" target=_blank>Operations forum post</a>'
              , e = "An unknown error occurred. Please try again later. If the error persists, please contact support@sketchfab.com"
              , i = this.isMaintenance()
              , n = new r({
                title: i ? "Maintenance" : "Error",
                text: i ? t : e,
                buttons: {
                    ok: !0
                },
                safe: !0
            });
            return n.open().then(function() {
                n.close()
            }),
            n
        }
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(216)
      , a = i(241)
      , s = i(257);
    i(267),
    t.exports = s.extend({
        template: function() {
            return a.get("skfb_front/popups/message", {
                title: this.options.title,
                text: this.options.text,
                buttons: this.options.buttons,
                safe: this.options.safe,
                popupClass: this.options.popupClass,
                popupClosable: this.options.popupClosable
            })
        },
        events: r.extend({}, s.prototype.events, {
            "reset form": "cancel",
            "submit form": "continue"
        }),
        initialize: function() {
            s.prototype.initialize.apply(this, arguments),
            this.deferred = n.Deferred(),
            this.promise = this.deferred.promise()
        },
        "continue": function() {
            this.deferred.resolve()
        },
        cancel: function() {
            this.deferred.reject()
        },
        then: function() {
            return this.promise.then.apply(this, arguments)
        }
    })
}
, function(t, e, i) {
    i(261),
    function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/popups/message.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    t.getTemplate("skfb_front/layouts/popup.jinja", !0, "skfb_front/popups/message.jinja", function(a, s) {
                        if (a)
                            return void r(a);
                        for (var u in s.blocks)
                            e.addBlock(u, s.blocks[u]);
                        o += "\n\n";
                        var l;
                        if (l = n.contextOrFrameLookup(e, i, "title"),
                        i.set("popupTitle", l, !0),
                        i.parent || (e.setVariable("popupTitle", l),
                        e.addExport("popupTitle")),
                        o += "\n\n",
                        !n.contextOrFrameLookup(e, i, "popupClass")) {
                            o += "\n    ";
                            var c;
                            c = "popup-message",
                            i.set("popupClass", c, !0),
                            i.parent || (e.setVariable("popupClass", c),
                            e.addExport("popupClass")),
                            o += "\n"
                        }
                        o += "\n\n",
                        o += "\n\n",
                        o += "\n",
                        s.rootRenderFunc(t, e, i, n, r)
                    })
                } catch (u) {
                    r(n.handleError(u, a, s))
                }
            }
            function e(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    o += "\n\n    ",
                    n.contextOrFrameLookup(e, i, "safe") ? (o += "\n        ",
                    o += n.suppressValue(t.getFilter("safe").call(e, n.contextOrFrameLookup(e, i, "text")), t.opts.autoescape),
                    o += "\n    ") : (o += "\n        ",
                    o += n.suppressValue(n.contextOrFrameLookup(e, i, "text"), t.opts.autoescape),
                    o += "\n    "),
                    o += "\n\n",
                    r(null, o)
                } catch (u) {
                    r(n.handleError(u, a, s))
                }
            }
            function i(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    o += '\n    <div class="actions">\n\n        ',
                    o += "\n        ",
                    o += "\n\n        ",
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "cancel", t.opts.autoescape) && (o += '\n            <button class="button btn-medium btn-tertiary cancel',
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "cancelClass", t.opts.autoescape) && (o += " ",
                    o += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "cancelClass", t.opts.autoescape), t.opts.autoescape)),
                    o += '" type="reset">',
                    o += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "cancelLabel", t.opts.autoescape), "Cancel"), t.opts.autoescape),
                    o += "</button>\n        "),
                    o += "\n\n        ",
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "close", t.opts.autoescape) && (o += '\n            <button class="button btn-medium btn-tertiary',
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "cancelClass", t.opts.autoescape) && (o += " ",
                    o += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "closeClass", t.opts.autoescape), t.opts.autoescape)),
                    o += '" type="reset" data-action="close">',
                    o += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "closeLabel", t.opts.autoescape), "Close"), t.opts.autoescape),
                    o += "</button>\n        "),
                    o += "\n\n        ",
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "continue", t.opts.autoescape) && (o += '\n            <button class="button btn-medium btn-primary submit',
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "continueClass", t.opts.autoescape) && (o += " ",
                    o += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "continueClass", t.opts.autoescape), t.opts.autoescape)),
                    o += '" type="submit">',
                    o += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "continueLabel", t.opts.autoescape), "Continue"), t.opts.autoescape),
                    o += "</button>\n        "),
                    o += "\n\n        ",
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "ok", t.opts.autoescape) && (o += '\n            <button class="button btn-medium btn-primary submit',
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "okClass", t.opts.autoescape) && (o += " ",
                    o += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "okClass", t.opts.autoescape), t.opts.autoescape)),
                    o += '" type="submit">',
                    o += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "okLabel", t.opts.autoescape), "OK"), t.opts.autoescape),
                    o += "</button>\n        "),
                    o += "\n\n        ",
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "delete", t.opts.autoescape) && (o += '\n            <button class="button btn-medium btn-danger submit',
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "deleteClass", t.opts.autoescape) && (o += " ",
                    o += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "deleteClass", t.opts.autoescape), t.opts.autoescape)),
                    o += '" type="submit">',
                    o += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "deleteLabel", t.opts.autoescape), "Delete"), t.opts.autoescape),
                    o += "</button>\n        "),
                    o += "\n\n    </div>\n",
                    r(null, o)
                } catch (u) {
                    r(n.handleError(u, a, s))
                }
            }
            return {
                b_popup_content: e,
                b_popup_footer: i,
                root: t
            }
        }()
    }()
}
, , , , , , , , , function(t, e, i) {
    var n = i(220);
    /*! jQuery UI - v1.10.3 - 2013-05-03
	* http://jqueryui.com
	* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.effect.js, jquery.ui.accordion.js, jquery.ui.autocomplete.js, jquery.ui.button.js, jquery.ui.datepicker.js, jquery.ui.dialog.js, jquery.ui.effect-blind.js, jquery.ui.effect-bounce.js, jquery.ui.effect-clip.js, jquery.ui.effect-drop.js, jquery.ui.effect-explode.js, jquery.ui.effect-fade.js, jquery.ui.effect-fold.js, jquery.ui.effect-highlight.js, jquery.ui.effect-pulsate.js, jquery.ui.effect-scale.js, jquery.ui.effect-shake.js, jquery.ui.effect-slide.js, jquery.ui.effect-transfer.js, jquery.ui.menu.js, jquery.ui.position.js, jquery.ui.progressbar.js, jquery.ui.slider.js, jquery.ui.spinner.js, jquery.ui.tabs.js, jquery.ui.tooltip.js
	* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
    !function(t, e) {
        function i(e, i) {
            var r, a, s, o = e.nodeName.toLowerCase();
            return "area" === o ? (r = e.parentNode,
            a = r.name,
            !(!e.href || !a || "map" !== r.nodeName.toLowerCase()) && (s = t("img[usemap=#" + a + "]")[0],
            !!s && n(s))) : (/input|select|textarea|button|object/.test(o) ? !e.disabled : "a" === o ? e.href || i : i) && n(e)
        }
        function n(e) {
            return t.expr.filters.visible(e) && !t(e).parents().addBack().filter(function() {
                return "hidden" === t.css(this, "visibility")
            }).length
        }
        var r = 0
          , a = /^ui-id-\d+$/;
        t.ui = t.ui || {},
        t.extend(t.ui, {
            version: "1.10.3",
            keyCode: {
                BACKSPACE: 8,
                COMMA: 188,
                DELETE: 46,
                DOWN: 40,
                END: 35,
                ENTER: 13,
                ESCAPE: 27,
                HOME: 36,
                LEFT: 37,
                NUMPAD_ADD: 107,
                NUMPAD_DECIMAL: 110,
                NUMPAD_DIVIDE: 111,
                NUMPAD_ENTER: 108,
                NUMPAD_MULTIPLY: 106,
                NUMPAD_SUBTRACT: 109,
                PAGE_DOWN: 34,
                PAGE_UP: 33,
                PERIOD: 190,
                RIGHT: 39,
                SPACE: 32,
                TAB: 9,
                UP: 38
            }
        }),
        t.fn.extend({
            focus: function(e) {
                return function(i, n) {
                    return "number" == typeof i ? this.each(function() {
                        var e = this;
                        setTimeout(function() {
                            t(e).focus(),
                            n && n.call(e)
                        }, i)
                    }) : e.apply(this, arguments)
                }
            }(t.fn.focus),
            scrollParent: function() {
                var e;
                return e = t.ui.ie && /(static|relative)/.test(this.css("position")) || /absolute/.test(this.css("position")) ? this.parents().filter(function() {
                    return /(relative|absolute|fixed)/.test(t.css(this, "position")) && /(auto|scroll)/.test(t.css(this, "overflow") + t.css(this, "overflow-y") + t.css(this, "overflow-x"))
                }).eq(0) : this.parents().filter(function() {
                    return /(auto|scroll)/.test(t.css(this, "overflow") + t.css(this, "overflow-y") + t.css(this, "overflow-x"))
                }).eq(0),
                /fixed/.test(this.css("position")) || !e.length ? t(document) : e
            },
            zIndex: function(i) {
                if (i !== e)
                    return this.css("zIndex", i);
                if (this.length)
                    for (var n, r, a = t(this[0]); a.length && a[0] !== document; ) {
                        if (n = a.css("position"),
                        ("absolute" === n || "relative" === n || "fixed" === n) && (r = parseInt(a.css("zIndex"), 10),
                        !isNaN(r) && 0 !== r))
                            return r;
                        a = a.parent()
                    }
                return 0
            },
            uniqueId: function() {
                return this.each(function() {
                    this.id || (this.id = "ui-id-" + ++r)
                })
            },
            removeUniqueId: function() {
                return this.each(function() {
                    a.test(this.id) && t(this).removeAttr("id")
                })
            }
        }),
        t.extend(t.expr[":"], {
            data: t.expr.createPseudo ? t.expr.createPseudo(function(e) {
                return function(i) {
                    return !!t.data(i, e)
                }
            }) : function(e, i, n) {
                return !!t.data(e, n[3])
            }
            ,
            focusable: function(e) {
                return i(e, !isNaN(t.attr(e, "tabindex")))
            },
            tabbable: function(e) {
                var n = t.attr(e, "tabindex")
                  , r = isNaN(n);
                return (r || n >= 0) && i(e, !r)
            }
        }),
        t("<a>").outerWidth(1).jquery || t.each(["Width", "Height"], function(i, n) {
            function r(e, i, n, r) {
                return t.each(a, function() {
                    i -= parseFloat(t.css(e, "padding" + this)) || 0,
                    n && (i -= parseFloat(t.css(e, "border" + this + "Width")) || 0),
                    r && (i -= parseFloat(t.css(e, "margin" + this)) || 0)
                }),
                i
            }
            var a = "Width" === n ? ["Left", "Right"] : ["Top", "Bottom"]
              , s = n.toLowerCase()
              , o = {
                innerWidth: t.fn.innerWidth,
                innerHeight: t.fn.innerHeight,
                outerWidth: t.fn.outerWidth,
                outerHeight: t.fn.outerHeight
            };
            t.fn["inner" + n] = function(i) {
                return i === e ? o["inner" + n].call(this) : this.each(function() {
                    t(this).css(s, r(this, i) + "px")
                })
            }
            ,
            t.fn["outer" + n] = function(e, i) {
                return "number" != typeof e ? o["outer" + n].call(this, e) : this.each(function() {
                    t(this).css(s, r(this, e, !0, i) + "px")
                })
            }
        }),
        t.fn.addBack || (t.fn.addBack = function(t) {
            return this.add(null == t ? this.prevObject : this.prevObject.filter(t))
        }
        ),
        t("<a>").data("a-b", "a").removeData("a-b").data("a-b") && (t.fn.removeData = function(e) {
            return function(i) {
                return arguments.length ? e.call(this, t.camelCase(i)) : e.call(this)
            }
        }(t.fn.removeData)),
        t.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),
        t.support.selectstart = "onselectstart"in document.createElement("div"),
        t.fn.extend({
            disableSelection: function() {
                return this.bind((t.support.selectstart ? "selectstart" : "mousedown") + ".ui-disableSelection", function(t) {
                    t.preventDefault()
                })
            },
            enableSelection: function() {
                return this.unbind(".ui-disableSelection")
            }
        }),
        t.extend(t.ui, {
            plugin: {
                add: function(e, i, n) {
                    var r, a = t.ui[e].prototype;
                    for (r in n)
                        a.plugins[r] = a.plugins[r] || [],
                        a.plugins[r].push([i, n[r]])
                },
                call: function(t, e, i) {
                    var n, r = t.plugins[e];
                    if (r && t.element[0].parentNode && 11 !== t.element[0].parentNode.nodeType)
                        for (n = 0; n < r.length; n++)
                            t.options[r[n][0]] && r[n][1].apply(t.element, i)
                }
            },
            hasScroll: function(e, i) {
                if ("hidden" === t(e).css("overflow"))
                    return !1;
                var n = i && "left" === i ? "scrollLeft" : "scrollTop"
                  , r = !1;
                return e[n] > 0 || (e[n] = 1,
                r = e[n] > 0,
                e[n] = 0,
                r)
            }
        })
    }(n),
    function(t, e) {
        var i = 0
          , n = Array.prototype.slice
          , r = t.cleanData;
        t.cleanData = function(e) {
            for (var i, n = 0; null != (i = e[n]); n++)
                try {
                    t(i).triggerHandler("remove")
                } catch (a) {}
            r(e)
        }
        ,
        t.widget = function(e, i, n) {
            var r, a, s, o, u = {}, l = e.split(".")[0];
            e = e.split(".")[1],
            r = l + "-" + e,
            n || (n = i,
            i = t.Widget),
            t.expr[":"][r.toLowerCase()] = function(e) {
                return !!t.data(e, r)
            }
            ,
            t[l] = t[l] || {},
            a = t[l][e],
            s = t[l][e] = function(t, e) {
                return this._createWidget ? void (arguments.length && this._createWidget(t, e)) : new s(t,e)
            }
            ,
            t.extend(s, a, {
                version: n.version,
                _proto: t.extend({}, n),
                _childConstructors: []
            }),
            o = new i,
            o.options = t.widget.extend({}, o.options),
            t.each(n, function(e, n) {
                return t.isFunction(n) ? void (u[e] = function() {
                    var t = function() {
                        return i.prototype[e].apply(this, arguments)
                    }
                      , r = function(t) {
                        return i.prototype[e].apply(this, t)
                    };
                    return function() {
                        var e, i = this._super, a = this._superApply;
                        return this._super = t,
                        this._superApply = r,
                        e = n.apply(this, arguments),
                        this._super = i,
                        this._superApply = a,
                        e
                    }
                }()) : void (u[e] = n)
            }),
            s.prototype = t.widget.extend(o, {
                widgetEventPrefix: a ? o.widgetEventPrefix : e
            }, u, {
                constructor: s,
                namespace: l,
                widgetName: e,
                widgetFullName: r
            }),
            a ? (t.each(a._childConstructors, function(e, i) {
                var n = i.prototype;
                t.widget(n.namespace + "." + n.widgetName, s, i._proto)
            }),
            delete a._childConstructors) : i._childConstructors.push(s),
            t.widget.bridge(e, s)
        }
        ,
        t.widget.extend = function(i) {
            for (var r, a, s = n.call(arguments, 1), o = 0, u = s.length; o < u; o++)
                for (r in s[o])
                    a = s[o][r],
                    s[o].hasOwnProperty(r) && a !== e && (t.isPlainObject(a) ? i[r] = t.isPlainObject(i[r]) ? t.widget.extend({}, i[r], a) : t.widget.extend({}, a) : i[r] = a);
            return i
        }
        ,
        t.widget.bridge = function(i, r) {
            var a = r.prototype.widgetFullName || i;
            t.fn[i] = function(s) {
                var o = "string" == typeof s
                  , u = n.call(arguments, 1)
                  , l = this;
                return s = !o && u.length ? t.widget.extend.apply(null, [s].concat(u)) : s,
                o ? this.each(function() {
                    var n, r = t.data(this, a);
                    return r ? t.isFunction(r[s]) && "_" !== s.charAt(0) ? (n = r[s].apply(r, u),
                    n !== r && n !== e ? (l = n && n.jquery ? l.pushStack(n.get()) : n,
                    !1) : void 0) : t.error("no such method '" + s + "' for " + i + " widget instance") : t.error("cannot call methods on " + i + " prior to initialization; attempted to call method '" + s + "'")
                }) : this.each(function() {
                    var e = t.data(this, a);
                    e ? e.option(s || {})._init() : t.data(this, a, new r(s,this))
                }),
                l
            }
        }
        ,
        t.Widget = function() {}
        ,
        t.Widget._childConstructors = [],
        t.Widget.prototype = {
            widgetName: "widget",
            widgetEventPrefix: "",
            defaultElement: "<div>",
            options: {
                disabled: !1,
                create: null
            },
            _createWidget: function(e, n) {
                n = t(n || this.defaultElement || this)[0],
                this.element = t(n),
                this.uuid = i++,
                this.eventNamespace = "." + this.widgetName + this.uuid,
                this.options = t.widget.extend({}, this.options, this._getCreateOptions(), e),
                this.bindings = t(),
                this.hoverable = t(),
                this.focusable = t(),
                n !== this && (t.data(n, this.widgetFullName, this),
                this._on(!0, this.element, {
                    remove: function(t) {
                        t.target === n && this.destroy()
                    }
                }),
                this.document = t(n.style ? n.ownerDocument : n.document || n),
                this.window = t(this.document[0].defaultView || this.document[0].parentWindow)),
                this._create(),
                this._trigger("create", null, this._getCreateEventData()),
                this._init()
            },
            _getCreateOptions: t.noop,
            _getCreateEventData: t.noop,
            _create: t.noop,
            _init: t.noop,
            destroy: function() {
                this._destroy(),
                this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),
                this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled ui-state-disabled"),
                this.bindings.unbind(this.eventNamespace),
                this.hoverable.removeClass("ui-state-hover"),
                this.focusable.removeClass("ui-state-focus")
            },
            _destroy: t.noop,
            widget: function() {
                return this.element
            },
            option: function(i, n) {
                var r, a, s, o = i;
                if (0 === arguments.length)
                    return t.widget.extend({}, this.options);
                if ("string" == typeof i)
                    if (o = {},
                    r = i.split("."),
                    i = r.shift(),
                    r.length) {
                        for (a = o[i] = t.widget.extend({}, this.options[i]),
                        s = 0; s < r.length - 1; s++)
                            a[r[s]] = a[r[s]] || {},
                            a = a[r[s]];
                        if (i = r.pop(),
                        n === e)
                            return a[i] === e ? null : a[i];
                        a[i] = n
                    } else {
                        if (n === e)
                            return this.options[i] === e ? null : this.options[i];
                        o[i] = n
                    }
                return this._setOptions(o),
                this
            },
            _setOptions: function(t) {
                var e;
                for (e in t)
                    this._setOption(e, t[e]);
                return this
            },
            _setOption: function(t, e) {
                return this.options[t] = e,
                "disabled" === t && (this.widget().toggleClass(this.widgetFullName + "-disabled ui-state-disabled", !!e).attr("aria-disabled", e),
                this.hoverable.removeClass("ui-state-hover"),
                this.focusable.removeClass("ui-state-focus")),
                this
            },
            enable: function() {
                return this._setOption("disabled", !1)
            },
            disable: function() {
                return this._setOption("disabled", !0)
            },
            _on: function(e, i, n) {
                var r, a = this;
                "boolean" != typeof e && (n = i,
                i = e,
                e = !1),
                n ? (i = r = t(i),
                this.bindings = this.bindings.add(i)) : (n = i,
                i = this.element,
                r = this.widget()),
                t.each(n, function(n, s) {
                    function o() {
                        if (e || a.options.disabled !== !0 && !t(this).hasClass("ui-state-disabled"))
                            return ("string" == typeof s ? a[s] : s).apply(a, arguments)
                    }
                    "string" != typeof s && (o.guid = s.guid = s.guid || o.guid || t.guid++);
                    var u = n.match(/^(\w+)\s*(.*)$/)
                      , l = u[1] + a.eventNamespace
                      , c = u[2];
                    c ? r.delegate(c, l, o) : i.bind(l, o)
                })
            },
            _off: function(t, e) {
                e = (e || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace,
                t.unbind(e).undelegate(e)
            },
            _delay: function(t, e) {
                function i() {
                    return ("string" == typeof t ? n[t] : t).apply(n, arguments)
                }
                var n = this;
                return setTimeout(i, e || 0)
            },
            _hoverable: function(e) {
                this.hoverable = this.hoverable.add(e),
                this._on(e, {
                    mouseenter: function(e) {
                        t(e.currentTarget).addClass("ui-state-hover")
                    },
                    mouseleave: function(e) {
                        t(e.currentTarget).removeClass("ui-state-hover")
                    }
                })
            },
            _focusable: function(e) {
                this.focusable = this.focusable.add(e),
                this._on(e, {
                    focusin: function(e) {
                        t(e.currentTarget).addClass("ui-state-focus")
                    },
                    focusout: function(e) {
                        t(e.currentTarget).removeClass("ui-state-focus")
                    }
                })
            },
            _trigger: function(e, i, n) {
                var r, a, s = this.options[e];
                if (n = n || {},
                i = t.Event(i),
                i.type = (e === this.widgetEventPrefix ? e : this.widgetEventPrefix + e).toLowerCase(),
                i.target = this.element[0],
                a = i.originalEvent)
                    for (r in a)
                        r in i || (i[r] = a[r]);
                return this.element.trigger(i, n),
                !(t.isFunction(s) && s.apply(this.element[0], [i].concat(n)) === !1 || i.isDefaultPrevented())
            }
        },
        t.each({
            show: "fadeIn",
            hide: "fadeOut"
        }, function(e, i) {
            t.Widget.prototype["_" + e] = function(n, r, a) {
                "string" == typeof r && (r = {
                    effect: r
                });
                var s, o = r ? r === !0 || "number" == typeof r ? i : r.effect || i : e;
                r = r || {},
                "number" == typeof r && (r = {
                    duration: r
                }),
                s = !t.isEmptyObject(r),
                r.complete = a,
                r.delay && n.delay(r.delay),
                s && t.effects && t.effects.effect[o] ? n[e](r) : o !== e && n[o] ? n[o](r.duration, r.easing, a) : n.queue(function(i) {
                    t(this)[e](),
                    a && a.call(n[0]),
                    i()
                })
            }
        })
    }(n),
    function(t, e) {
        var i = !1;
        t(document).mouseup(function() {
            i = !1
        }),
        t.widget("ui.mouse", {
            version: "1.10.3",
            options: {
                cancel: "input,textarea,button,select,option",
                distance: 1,
                delay: 0
            },
            _mouseInit: function() {
                var e = this;
                this.element.bind("mousedown." + this.widgetName, function(t) {
                    return e._mouseDown(t)
                }).bind("click." + this.widgetName, function(i) {
                    if (!0 === t.data(i.target, e.widgetName + ".preventClickEvent"))
                        return t.removeData(i.target, e.widgetName + ".preventClickEvent"),
                        i.stopImmediatePropagation(),
                        !1
                }),
                this.started = !1
            },
            _mouseDestroy: function() {
                this.element.unbind("." + this.widgetName),
                this._mouseMoveDelegate && t(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate)
            },
            _mouseDown: function(e) {
                if (!i) {
                    this._mouseStarted && this._mouseUp(e),
                    this._mouseDownEvent = e;
                    var n = this
                      , r = 1 === e.which
                      , a = !("string" != typeof this.options.cancel || !e.target.nodeName) && t(e.target).closest(this.options.cancel).length;
                    return !(r && !a && this._mouseCapture(e)) || (this.mouseDelayMet = !this.options.delay,
                    this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function() {
                        n.mouseDelayMet = !0
                    }, this.options.delay)),
                    this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = this._mouseStart(e) !== !1,
                    !this._mouseStarted) ? (e.preventDefault(),
                    !0) : (!0 === t.data(e.target, this.widgetName + ".preventClickEvent") && t.removeData(e.target, this.widgetName + ".preventClickEvent"),
                    this._mouseMoveDelegate = function(t) {
                        return n._mouseMove(t)
                    }
                    ,
                    this._mouseUpDelegate = function(t) {
                        return n._mouseUp(t)
                    }
                    ,
                    t(document).bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate),
                    e.preventDefault(),
                    i = !0,
                    !0))
                }
            },
            _mouseMove: function(e) {
                return t.ui.ie && (!document.documentMode || document.documentMode < 9) && !e.button ? this._mouseUp(e) : this._mouseStarted ? (this._mouseDrag(e),
                e.preventDefault()) : (this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, e) !== !1,
                this._mouseStarted ? this._mouseDrag(e) : this._mouseUp(e)),
                !this._mouseStarted)
            },
            _mouseUp: function(e) {
                return t(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate),
                this._mouseStarted && (this._mouseStarted = !1,
                e.target === this._mouseDownEvent.target && t.data(e.target, this.widgetName + ".preventClickEvent", !0),
                this._mouseStop(e)),
                !1
            },
            _mouseDistanceMet: function(t) {
                return Math.max(Math.abs(this._mouseDownEvent.pageX - t.pageX), Math.abs(this._mouseDownEvent.pageY - t.pageY)) >= this.options.distance
            },
            _mouseDelayMet: function() {
                return this.mouseDelayMet
            },
            _mouseStart: function() {},
            _mouseDrag: function() {},
            _mouseStop: function() {},
            _mouseCapture: function() {
                return !0
            }
        })
    }(n),
    function(t, e) {
        t.widget("ui.draggable", t.ui.mouse, {
            version: "1.10.3",
            widgetEventPrefix: "drag",
            options: {
                addClasses: !0,
                appendTo: "parent",
                axis: !1,
                connectToSortable: !1,
                containment: !1,
                cursor: "auto",
                cursorAt: !1,
                grid: !1,
                handle: !1,
                helper: "original",
                iframeFix: !1,
                opacity: !1,
                refreshPositions: !1,
                revert: !1,
                revertDuration: 500,
                scope: "default",
                scroll: !0,
                scrollSensitivity: 20,
                scrollSpeed: 20,
                snap: !1,
                snapMode: "both",
                snapTolerance: 20,
                stack: !1,
                zIndex: !1,
                drag: null,
                start: null,
                stop: null
            },
            _create: function() {
                "original" !== this.options.helper || /^(?:r|a|f)/.test(this.element.css("position")) || (this.element[0].style.position = "relative"),
                this.options.addClasses && this.element.addClass("ui-draggable"),
                this.options.disabled && this.element.addClass("ui-draggable-disabled"),
                this._mouseInit()
            },
            _destroy: function() {
                this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),
                this._mouseDestroy()
            },
            _mouseCapture: function(e) {
                var i = this.options;
                return !(this.helper || i.disabled || t(e.target).closest(".ui-resizable-handle").length > 0) && (this.handle = this._getHandle(e),
                !!this.handle && (t(i.iframeFix === !0 ? "iframe" : i.iframeFix).each(function() {
                    t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({
                        width: this.offsetWidth + "px",
                        height: this.offsetHeight + "px",
                        position: "absolute",
                        opacity: "0.001",
                        zIndex: 1e3
                    }).css(t(this).offset()).appendTo("body")
                }),
                !0))
            },
            _mouseStart: function(e) {
                var i = this.options;
                return this.helper = this._createHelper(e),
                this.helper.addClass("ui-draggable-dragging"),
                this._cacheHelperProportions(),
                t.ui.ddmanager && (t.ui.ddmanager.current = this),
                this._cacheMargins(),
                this.cssPosition = this.helper.css("position"),
                this.scrollParent = this.helper.scrollParent(),
                this.offsetParent = this.helper.offsetParent(),
                this.offsetParentCssPosition = this.offsetParent.css("position"),
                this.offset = this.positionAbs = this.element.offset(),
                this.offset = {
                    top: this.offset.top - this.margins.top,
                    left: this.offset.left - this.margins.left
                },
                this.offset.scroll = !1,
                t.extend(this.offset, {
                    click: {
                        left: e.pageX - this.offset.left,
                        top: e.pageY - this.offset.top
                    },
                    parent: this._getParentOffset(),
                    relative: this._getRelativeOffset()
                }),
                this.originalPosition = this.position = this._generatePosition(e),
                this.originalPageX = e.pageX,
                this.originalPageY = e.pageY,
                i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt),
                this._setContainment(),
                this._trigger("start", e) === !1 ? (this._clear(),
                !1) : (this._cacheHelperProportions(),
                t.ui.ddmanager && !i.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e),
                this._mouseDrag(e, !0),
                t.ui.ddmanager && t.ui.ddmanager.dragStart(this, e),
                !0)
            },
            _mouseDrag: function(e, i) {
                if ("fixed" === this.offsetParentCssPosition && (this.offset.parent = this._getParentOffset()),
                this.position = this._generatePosition(e),
                this.positionAbs = this._convertPositionTo("absolute"),
                !i) {
                    var n = this._uiHash();
                    if (this._trigger("drag", e, n) === !1)
                        return this._mouseUp({}),
                        !1;
                    this.position = n.position
                }
                return this.options.axis && "y" === this.options.axis || (this.helper[0].style.left = this.position.left + "px"),
                this.options.axis && "x" === this.options.axis || (this.helper[0].style.top = this.position.top + "px"),
                t.ui.ddmanager && t.ui.ddmanager.drag(this, e),
                !1
            },
            _mouseStop: function(e) {
                var i = this
                  , n = !1;
                return t.ui.ddmanager && !this.options.dropBehaviour && (n = t.ui.ddmanager.drop(this, e)),
                this.dropped && (n = this.dropped,
                this.dropped = !1),
                !("original" === this.options.helper && !t.contains(this.element[0].ownerDocument, this.element[0])) && ("invalid" === this.options.revert && !n || "valid" === this.options.revert && n || this.options.revert === !0 || t.isFunction(this.options.revert) && this.options.revert.call(this.element, n) ? t(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function() {
                    i._trigger("stop", e) !== !1 && i._clear()
                }) : this._trigger("stop", e) !== !1 && this._clear(),
                !1)
            },
            _mouseUp: function(e) {
                return t("div.ui-draggable-iframeFix").each(function() {
                    this.parentNode.removeChild(this)
                }),
                t.ui.ddmanager && t.ui.ddmanager.dragStop(this, e),
                t.ui.mouse.prototype._mouseUp.call(this, e)
            },
            cancel: function() {
                return this.helper.is(".ui-draggable-dragging") ? this._mouseUp({}) : this._clear(),
                this
            },
            _getHandle: function(e) {
                return !this.options.handle || !!t(e.target).closest(this.element.find(this.options.handle)).length
            },
            _createHelper: function(e) {
                var i = this.options
                  , n = t.isFunction(i.helper) ? t(i.helper.apply(this.element[0], [e])) : "clone" === i.helper ? this.element.clone().removeAttr("id") : this.element;
                return n.parents("body").length || n.appendTo("parent" === i.appendTo ? this.element[0].parentNode : i.appendTo),
                n[0] === this.element[0] || /(fixed|absolute)/.test(n.css("position")) || n.css("position", "absolute"),
                n
            },
            _adjustOffsetFromHelper: function(e) {
                "string" == typeof e && (e = e.split(" ")),
                t.isArray(e) && (e = {
                    left: +e[0],
                    top: +e[1] || 0
                }),
                "left"in e && (this.offset.click.left = e.left + this.margins.left),
                "right"in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left),
                "top"in e && (this.offset.click.top = e.top + this.margins.top),
                "bottom"in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top)
            },
            _getParentOffset: function() {
                var e = this.offsetParent.offset();
                return "absolute" === this.cssPosition && this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(),
                e.top += this.scrollParent.scrollTop()),
                (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && "html" === this.offsetParent[0].tagName.toLowerCase() && t.ui.ie) && (e = {
                    top: 0,
                    left: 0
                }),
                {
                    top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                    left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
                }
            },
            _getRelativeOffset: function() {
                if ("relative" === this.cssPosition) {
                    var t = this.element.position();
                    return {
                        top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                        left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
                    }
                }
                return {
                    top: 0,
                    left: 0
                }
            },
            _cacheMargins: function() {
                this.margins = {
                    left: parseInt(this.element.css("marginLeft"), 10) || 0,
                    top: parseInt(this.element.css("marginTop"), 10) || 0,
                    right: parseInt(this.element.css("marginRight"), 10) || 0,
                    bottom: parseInt(this.element.css("marginBottom"), 10) || 0
                }
            },
            _cacheHelperProportions: function() {
                this.helperProportions = {
                    width: this.helper.outerWidth(),
                    height: this.helper.outerHeight()
                }
            },
            _setContainment: function() {
                var e, i, n, r = this.options;
                return r.containment ? "window" === r.containment ? void (this.containment = [t(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, t(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, t(window).scrollLeft() + t(window).width() - this.helperProportions.width - this.margins.left, t(window).scrollTop() + (t(window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]) : "document" === r.containment ? void (this.containment = [0, 0, t(document).width() - this.helperProportions.width - this.margins.left, (t(document).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]) : r.containment.constructor === Array ? void (this.containment = r.containment) : ("parent" === r.containment && (r.containment = this.helper[0].parentNode),
                i = t(r.containment),
                n = i[0],
                void (n && (e = "hidden" !== i.css("overflow"),
                this.containment = [(parseInt(i.css("borderLeftWidth"), 10) || 0) + (parseInt(i.css("paddingLeft"), 10) || 0), (parseInt(i.css("borderTopWidth"), 10) || 0) + (parseInt(i.css("paddingTop"), 10) || 0), (e ? Math.max(n.scrollWidth, n.offsetWidth) : n.offsetWidth) - (parseInt(i.css("borderRightWidth"), 10) || 0) - (parseInt(i.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (e ? Math.max(n.scrollHeight, n.offsetHeight) : n.offsetHeight) - (parseInt(i.css("borderBottomWidth"), 10) || 0) - (parseInt(i.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom],
                this.relative_container = i))) : void (this.containment = null)
            },
            _convertPositionTo: function(e, i) {
                i || (i = this.position);
                var n = "absolute" === e ? 1 : -1
                  , r = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent;
                return this.offset.scroll || (this.offset.scroll = {
                    top: r.scrollTop(),
                    left: r.scrollLeft()
                }),
                {
                    top: i.top + this.offset.relative.top * n + this.offset.parent.top * n - ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : this.offset.scroll.top) * n,
                    left: i.left + this.offset.relative.left * n + this.offset.parent.left * n - ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : this.offset.scroll.left) * n
                }
            },
            _generatePosition: function(e) {
                var i, n, r, a, s = this.options, o = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent, u = e.pageX, l = e.pageY;
                return this.offset.scroll || (this.offset.scroll = {
                    top: o.scrollTop(),
                    left: o.scrollLeft()
                }),
                this.originalPosition && (this.containment && (this.relative_container ? (n = this.relative_container.offset(),
                i = [this.containment[0] + n.left, this.containment[1] + n.top, this.containment[2] + n.left, this.containment[3] + n.top]) : i = this.containment,
                e.pageX - this.offset.click.left < i[0] && (u = i[0] + this.offset.click.left),
                e.pageY - this.offset.click.top < i[1] && (l = i[1] + this.offset.click.top),
                e.pageX - this.offset.click.left > i[2] && (u = i[2] + this.offset.click.left),
                e.pageY - this.offset.click.top > i[3] && (l = i[3] + this.offset.click.top)),
                s.grid && (r = s.grid[1] ? this.originalPageY + Math.round((l - this.originalPageY) / s.grid[1]) * s.grid[1] : this.originalPageY,
                l = i ? r - this.offset.click.top >= i[1] || r - this.offset.click.top > i[3] ? r : r - this.offset.click.top >= i[1] ? r - s.grid[1] : r + s.grid[1] : r,
                a = s.grid[0] ? this.originalPageX + Math.round((u - this.originalPageX) / s.grid[0]) * s.grid[0] : this.originalPageX,
                u = i ? a - this.offset.click.left >= i[0] || a - this.offset.click.left > i[2] ? a : a - this.offset.click.left >= i[0] ? a - s.grid[0] : a + s.grid[0] : a)),
                {
                    top: l - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : this.offset.scroll.top),
                    left: u - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : this.offset.scroll.left)
                }
            },
            _clear: function() {
                this.helper.removeClass("ui-draggable-dragging"),
                this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(),
                this.helper = null,
                this.cancelHelperRemoval = !1
            },
            _trigger: function(e, i, n) {
                return n = n || this._uiHash(),
                t.ui.plugin.call(this, e, [i, n]),
                "drag" === e && (this.positionAbs = this._convertPositionTo("absolute")),
                t.Widget.prototype._trigger.call(this, e, i, n)
            },
            plugins: {},
            _uiHash: function() {
                return {
                    helper: this.helper,
                    position: this.position,
                    originalPosition: this.originalPosition,
                    offset: this.positionAbs
                }
            }
        }),
        t.ui.plugin.add("draggable", "connectToSortable", {
            start: function(e, i) {
                var n = t(this).data("ui-draggable")
                  , r = n.options
                  , a = t.extend({}, i, {
                    item: n.element
                });
                n.sortables = [],
                t(r.connectToSortable).each(function() {
                    var i = t.data(this, "ui-sortable");
                    i && !i.options.disabled && (n.sortables.push({
                        instance: i,
                        shouldRevert: i.options.revert
                    }),
                    i.refreshPositions(),
                    i._trigger("activate", e, a))
                })
            },
            stop: function(e, i) {
                var n = t(this).data("ui-draggable")
                  , r = t.extend({}, i, {
                    item: n.element
                });
                t.each(n.sortables, function() {
                    this.instance.isOver ? (this.instance.isOver = 0,
                    n.cancelHelperRemoval = !0,
                    this.instance.cancelHelperRemoval = !1,
                    this.shouldRevert && (this.instance.options.revert = this.shouldRevert),
                    this.instance._mouseStop(e),
                    this.instance.options.helper = this.instance.options._helper,
                    "original" === n.options.helper && this.instance.currentItem.css({
                        top: "auto",
                        left: "auto"
                    })) : (this.instance.cancelHelperRemoval = !1,
                    this.instance._trigger("deactivate", e, r))
                })
            },
            drag: function(e, i) {
                var n = t(this).data("ui-draggable")
                  , r = this;
                t.each(n.sortables, function() {
                    var a = !1
                      , s = this;
                    this.instance.positionAbs = n.positionAbs,
                    this.instance.helperProportions = n.helperProportions,
                    this.instance.offset.click = n.offset.click,
                    this.instance._intersectsWith(this.instance.containerCache) && (a = !0,
                    t.each(n.sortables, function() {
                        return this.instance.positionAbs = n.positionAbs,
                        this.instance.helperProportions = n.helperProportions,
                        this.instance.offset.click = n.offset.click,
                        this !== s && this.instance._intersectsWith(this.instance.containerCache) && t.contains(s.instance.element[0], this.instance.element[0]) && (a = !1),
                        a
                    })),
                    a ? (this.instance.isOver || (this.instance.isOver = 1,
                    this.instance.currentItem = t(r).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item", !0),
                    this.instance.options._helper = this.instance.options.helper,
                    this.instance.options.helper = function() {
                        return i.helper[0]
                    }
                    ,
                    e.target = this.instance.currentItem[0],
                    this.instance._mouseCapture(e, !0),
                    this.instance._mouseStart(e, !0, !0),
                    this.instance.offset.click.top = n.offset.click.top,
                    this.instance.offset.click.left = n.offset.click.left,
                    this.instance.offset.parent.left -= n.offset.parent.left - this.instance.offset.parent.left,
                    this.instance.offset.parent.top -= n.offset.parent.top - this.instance.offset.parent.top,
                    n._trigger("toSortable", e),
                    n.dropped = this.instance.element,
                    n.currentItem = n.element,
                    this.instance.fromOutside = n),
                    this.instance.currentItem && this.instance._mouseDrag(e)) : this.instance.isOver && (this.instance.isOver = 0,
                    this.instance.cancelHelperRemoval = !0,
                    this.instance.options.revert = !1,
                    this.instance._trigger("out", e, this.instance._uiHash(this.instance)),
                    this.instance._mouseStop(e, !0),
                    this.instance.options.helper = this.instance.options._helper,
                    this.instance.currentItem.remove(),
                    this.instance.placeholder && this.instance.placeholder.remove(),
                    n._trigger("fromSortable", e),
                    n.dropped = !1)
                })
            }
        }),
        t.ui.plugin.add("draggable", "cursor", {
            start: function() {
                var e = t("body")
                  , i = t(this).data("ui-draggable").options;
                e.css("cursor") && (i._cursor = e.css("cursor")),
                e.css("cursor", i.cursor)
            },
            stop: function() {
                var e = t(this).data("ui-draggable").options;
                e._cursor && t("body").css("cursor", e._cursor)
            }
        }),
        t.ui.plugin.add("draggable", "opacity", {
            start: function(e, i) {
                var n = t(i.helper)
                  , r = t(this).data("ui-draggable").options;
                n.css("opacity") && (r._opacity = n.css("opacity")),
                n.css("opacity", r.opacity)
            },
            stop: function(e, i) {
                var n = t(this).data("ui-draggable").options;
                n._opacity && t(i.helper).css("opacity", n._opacity)
            }
        }),
        t.ui.plugin.add("draggable", "scroll", {
            start: function() {
                var e = t(this).data("ui-draggable");
                e.scrollParent[0] !== document && "HTML" !== e.scrollParent[0].tagName && (e.overflowOffset = e.scrollParent.offset())
            },
            drag: function(e) {
                var i = t(this).data("ui-draggable")
                  , n = i.options
                  , r = !1;
                i.scrollParent[0] !== document && "HTML" !== i.scrollParent[0].tagName ? (n.axis && "x" === n.axis || (i.overflowOffset.top + i.scrollParent[0].offsetHeight - e.pageY < n.scrollSensitivity ? i.scrollParent[0].scrollTop = r = i.scrollParent[0].scrollTop + n.scrollSpeed : e.pageY - i.overflowOffset.top < n.scrollSensitivity && (i.scrollParent[0].scrollTop = r = i.scrollParent[0].scrollTop - n.scrollSpeed)),
                n.axis && "y" === n.axis || (i.overflowOffset.left + i.scrollParent[0].offsetWidth - e.pageX < n.scrollSensitivity ? i.scrollParent[0].scrollLeft = r = i.scrollParent[0].scrollLeft + n.scrollSpeed : e.pageX - i.overflowOffset.left < n.scrollSensitivity && (i.scrollParent[0].scrollLeft = r = i.scrollParent[0].scrollLeft - n.scrollSpeed))) : (n.axis && "x" === n.axis || (e.pageY - t(document).scrollTop() < n.scrollSensitivity ? r = t(document).scrollTop(t(document).scrollTop() - n.scrollSpeed) : t(window).height() - (e.pageY - t(document).scrollTop()) < n.scrollSensitivity && (r = t(document).scrollTop(t(document).scrollTop() + n.scrollSpeed))),
                n.axis && "y" === n.axis || (e.pageX - t(document).scrollLeft() < n.scrollSensitivity ? r = t(document).scrollLeft(t(document).scrollLeft() - n.scrollSpeed) : t(window).width() - (e.pageX - t(document).scrollLeft()) < n.scrollSensitivity && (r = t(document).scrollLeft(t(document).scrollLeft() + n.scrollSpeed)))),
                r !== !1 && t.ui.ddmanager && !n.dropBehaviour && t.ui.ddmanager.prepareOffsets(i, e)
            }
        }),
        t.ui.plugin.add("draggable", "snap", {
            start: function() {
                var e = t(this).data("ui-draggable")
                  , i = e.options;
                e.snapElements = [],
                t(i.snap.constructor !== String ? i.snap.items || ":data(ui-draggable)" : i.snap).each(function() {
                    var i = t(this)
                      , n = i.offset();
                    this !== e.element[0] && e.snapElements.push({
                        item: this,
                        width: i.outerWidth(),
                        height: i.outerHeight(),
                        top: n.top,
                        left: n.left
                    })
                })
            },
            drag: function(e, i) {
                var n, r, a, s, o, u, l, c, h, d, p = t(this).data("ui-draggable"), f = p.options, g = f.snapTolerance, m = i.offset.left, v = m + p.helperProportions.width, _ = i.offset.top, b = _ + p.helperProportions.height;
                for (h = p.snapElements.length - 1; h >= 0; h--)
                    o = p.snapElements[h].left,
                    u = o + p.snapElements[h].width,
                    l = p.snapElements[h].top,
                    c = l + p.snapElements[h].height,
                    v < o - g || m > u + g || b < l - g || _ > c + g || !t.contains(p.snapElements[h].item.ownerDocument, p.snapElements[h].item) ? (p.snapElements[h].snapping && p.options.snap.release && p.options.snap.release.call(p.element, e, t.extend(p._uiHash(), {
                        snapItem: p.snapElements[h].item
                    })),
                    p.snapElements[h].snapping = !1) : ("inner" !== f.snapMode && (n = Math.abs(l - b) <= g,
                    r = Math.abs(c - _) <= g,
                    a = Math.abs(o - v) <= g,
                    s = Math.abs(u - m) <= g,
                    n && (i.position.top = p._convertPositionTo("relative", {
                        top: l - p.helperProportions.height,
                        left: 0
                    }).top - p.margins.top),
                    r && (i.position.top = p._convertPositionTo("relative", {
                        top: c,
                        left: 0
                    }).top - p.margins.top),
                    a && (i.position.left = p._convertPositionTo("relative", {
                        top: 0,
                        left: o - p.helperProportions.width
                    }).left - p.margins.left),
                    s && (i.position.left = p._convertPositionTo("relative", {
                        top: 0,
                        left: u
                    }).left - p.margins.left)),
                    d = n || r || a || s,
                    "outer" !== f.snapMode && (n = Math.abs(l - _) <= g,
                    r = Math.abs(c - b) <= g,
                    a = Math.abs(o - m) <= g,
                    s = Math.abs(u - v) <= g,
                    n && (i.position.top = p._convertPositionTo("relative", {
                        top: l,
                        left: 0
                    }).top - p.margins.top),
                    r && (i.position.top = p._convertPositionTo("relative", {
                        top: c - p.helperProportions.height,
                        left: 0
                    }).top - p.margins.top),
                    a && (i.position.left = p._convertPositionTo("relative", {
                        top: 0,
                        left: o
                    }).left - p.margins.left),
                    s && (i.position.left = p._convertPositionTo("relative", {
                        top: 0,
                        left: u - p.helperProportions.width
                    }).left - p.margins.left)),
                    !p.snapElements[h].snapping && (n || r || a || s || d) && p.options.snap.snap && p.options.snap.snap.call(p.element, e, t.extend(p._uiHash(), {
                        snapItem: p.snapElements[h].item
                    })),
                    p.snapElements[h].snapping = n || r || a || s || d)
            }
        }),
        t.ui.plugin.add("draggable", "stack", {
            start: function() {
                var e, i = this.data("ui-draggable").options, n = t.makeArray(t(i.stack)).sort(function(e, i) {
                    return (parseInt(t(e).css("zIndex"), 10) || 0) - (parseInt(t(i).css("zIndex"), 10) || 0)
                });
                n.length && (e = parseInt(t(n[0]).css("zIndex"), 10) || 0,
                t(n).each(function(i) {
                    t(this).css("zIndex", e + i)
                }),
                this.css("zIndex", e + n.length))
            }
        }),
        t.ui.plugin.add("draggable", "zIndex", {
            start: function(e, i) {
                var n = t(i.helper)
                  , r = t(this).data("ui-draggable").options;
                n.css("zIndex") && (r._zIndex = n.css("zIndex")),
                n.css("zIndex", r.zIndex)
            },
            stop: function(e, i) {
                var n = t(this).data("ui-draggable").options;
                n._zIndex && t(i.helper).css("zIndex", n._zIndex)
            }
        })
    }(n),
    function(t, e) {
        function i(t, e, i) {
            return t > e && t < e + i
        }
        t.widget("ui.droppable", {
            version: "1.10.3",
            widgetEventPrefix: "drop",
            options: {
                accept: "*",
                activeClass: !1,
                addClasses: !0,
                greedy: !1,
                hoverClass: !1,
                scope: "default",
                tolerance: "intersect",
                activate: null,
                deactivate: null,
                drop: null,
                out: null,
                over: null
            },
            _create: function() {
                var e = this.options
                  , i = e.accept;
                this.isover = !1,
                this.isout = !0,
                this.accept = t.isFunction(i) ? i : function(t) {
                    return t.is(i)
                }
                ,
                this.proportions = {
                    width: this.element[0].offsetWidth,
                    height: this.element[0].offsetHeight
                },
                t.ui.ddmanager.droppables[e.scope] = t.ui.ddmanager.droppables[e.scope] || [],
                t.ui.ddmanager.droppables[e.scope].push(this),
                e.addClasses && this.element.addClass("ui-droppable")
            },
            _destroy: function() {
                for (var e = 0, i = t.ui.ddmanager.droppables[this.options.scope]; e < i.length; e++)
                    i[e] === this && i.splice(e, 1);
                this.element.removeClass("ui-droppable ui-droppable-disabled")
            },
            _setOption: function(e, i) {
                "accept" === e && (this.accept = t.isFunction(i) ? i : function(t) {
                    return t.is(i)
                }
                ),
                t.Widget.prototype._setOption.apply(this, arguments)
            },
            _activate: function(e) {
                var i = t.ui.ddmanager.current;
                this.options.activeClass && this.element.addClass(this.options.activeClass),
                i && this._trigger("activate", e, this.ui(i))
            },
            _deactivate: function(e) {
                var i = t.ui.ddmanager.current;
                this.options.activeClass && this.element.removeClass(this.options.activeClass),
                i && this._trigger("deactivate", e, this.ui(i))
            },
            _over: function(e) {
                var i = t.ui.ddmanager.current;
                i && (i.currentItem || i.element)[0] !== this.element[0] && this.accept.call(this.element[0], i.currentItem || i.element) && (this.options.hoverClass && this.element.addClass(this.options.hoverClass),
                this._trigger("over", e, this.ui(i)))
            },
            _out: function(e) {
                var i = t.ui.ddmanager.current;
                i && (i.currentItem || i.element)[0] !== this.element[0] && this.accept.call(this.element[0], i.currentItem || i.element) && (this.options.hoverClass && this.element.removeClass(this.options.hoverClass),
                this._trigger("out", e, this.ui(i)))
            },
            _drop: function(e, i) {
                var n = i || t.ui.ddmanager.current
                  , r = !1;
                return !(!n || (n.currentItem || n.element)[0] === this.element[0]) && (this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function() {
                    var e = t.data(this, "ui-droppable");
                    if (e.options.greedy && !e.options.disabled && e.options.scope === n.options.scope && e.accept.call(e.element[0], n.currentItem || n.element) && t.ui.intersect(n, t.extend(e, {
                        offset: e.element.offset()
                    }), e.options.tolerance))
                        return r = !0,
                        !1
                }),
                !r && (!!this.accept.call(this.element[0], n.currentItem || n.element) && (this.options.activeClass && this.element.removeClass(this.options.activeClass),
                this.options.hoverClass && this.element.removeClass(this.options.hoverClass),
                this._trigger("drop", e, this.ui(n)),
                this.element)))
            },
            ui: function(t) {
                return {
                    draggable: t.currentItem || t.element,
                    helper: t.helper,
                    position: t.position,
                    offset: t.positionAbs
                }
            }
        }),
        t.ui.intersect = function(t, e, n) {
            if (!e.offset)
                return !1;
            var r, a, s = (t.positionAbs || t.position.absolute).left, o = s + t.helperProportions.width, u = (t.positionAbs || t.position.absolute).top, l = u + t.helperProportions.height, c = e.offset.left, h = c + e.proportions.width, d = e.offset.top, p = d + e.proportions.height;
            switch (n) {
            case "fit":
                return c <= s && o <= h && d <= u && l <= p;
            case "intersect":
                return c < s + t.helperProportions.width / 2 && o - t.helperProportions.width / 2 < h && d < u + t.helperProportions.height / 2 && l - t.helperProportions.height / 2 < p;
            case "pointer":
                return r = (t.positionAbs || t.position.absolute).left + (t.clickOffset || t.offset.click).left,
                a = (t.positionAbs || t.position.absolute).top + (t.clickOffset || t.offset.click).top,
                i(a, d, e.proportions.height) && i(r, c, e.proportions.width);
            case "touch":
                return (u >= d && u <= p || l >= d && l <= p || u < d && l > p) && (s >= c && s <= h || o >= c && o <= h || s < c && o > h);
            default:
                return !1
            }
        }
        ,
        t.ui.ddmanager = {
            current: null,
            droppables: {
                "default": []
            },
            prepareOffsets: function(e, i) {
                var n, r, a = t.ui.ddmanager.droppables[e.options.scope] || [], s = i ? i.type : null, o = (e.currentItem || e.element).find(":data(ui-droppable)").addBack();
                t: for (n = 0; n < a.length; n++)
                    if (!(a[n].options.disabled || e && !a[n].accept.call(a[n].element[0], e.currentItem || e.element))) {
                        for (r = 0; r < o.length; r++)
                            if (o[r] === a[n].element[0]) {
                                a[n].proportions.height = 0;
                                continue t
                            }
                        a[n].visible = "none" !== a[n].element.css("display"),
                        a[n].visible && ("mousedown" === s && a[n]._activate.call(a[n], i),
                        a[n].offset = a[n].element.offset(),
                        a[n].proportions = {
                            width: a[n].element[0].offsetWidth,
                            height: a[n].element[0].offsetHeight
                        })
                    }
            },
            drop: function(e, i) {
                var n = !1;
                return t.each((t.ui.ddmanager.droppables[e.options.scope] || []).slice(), function() {
                    this.options && (!this.options.disabled && this.visible && t.ui.intersect(e, this, this.options.tolerance) && (n = this._drop.call(this, i) || n),
                    !this.options.disabled && this.visible && this.accept.call(this.element[0], e.currentItem || e.element) && (this.isout = !0,
                    this.isover = !1,
                    this._deactivate.call(this, i)))
                }),
                n
            },
            dragStart: function(e, i) {
                e.element.parentsUntil("body").bind("scroll.droppable", function() {
                    e.options.refreshPositions || t.ui.ddmanager.prepareOffsets(e, i)
                })
            },
            drag: function(e, i) {
                e.options.refreshPositions && t.ui.ddmanager.prepareOffsets(e, i),
                t.each(t.ui.ddmanager.droppables[e.options.scope] || [], function() {
                    if (!this.options.disabled && !this.greedyChild && this.visible) {
                        var n, r, a, s = t.ui.intersect(e, this, this.options.tolerance), o = !s && this.isover ? "isout" : s && !this.isover ? "isover" : null;
                        o && (this.options.greedy && (r = this.options.scope,
                        a = this.element.parents(":data(ui-droppable)").filter(function() {
                            return t.data(this, "ui-droppable").options.scope === r
                        }),
                        a.length && (n = t.data(a[0], "ui-droppable"),
                        n.greedyChild = "isover" === o)),
                        n && "isover" === o && (n.isover = !1,
                        n.isout = !0,
                        n._out.call(n, i)),
                        this[o] = !0,
                        this["isout" === o ? "isover" : "isout"] = !1,
                        this["isover" === o ? "_over" : "_out"].call(this, i),
                        n && "isout" === o && (n.isout = !1,
                        n.isover = !0,
                        n._over.call(n, i)))
                    }
                })
            },
            dragStop: function(e, i) {
                e.element.parentsUntil("body").unbind("scroll.droppable"),
                e.options.refreshPositions || t.ui.ddmanager.prepareOffsets(e, i)
            }
        }
    }(n),
    function(t, e) {
        function i(t) {
            return parseInt(t, 10) || 0
        }
        function n(t) {
            return !isNaN(parseInt(t, 10))
        }
        t.widget("ui.resizable", t.ui.mouse, {
            version: "1.10.3",
            widgetEventPrefix: "resize",
            options: {
                alsoResize: !1,
                animate: !1,
                animateDuration: "slow",
                animateEasing: "swing",
                aspectRatio: !1,
                autoHide: !1,
                containment: !1,
                ghost: !1,
                grid: !1,
                handles: "e,s,se",
                helper: !1,
                maxHeight: null,
                maxWidth: null,
                minHeight: 10,
                minWidth: 10,
                zIndex: 90,
                resize: null,
                start: null,
                stop: null
            },
            _create: function() {
                var e, i, n, r, a, s = this, o = this.options;
                if (this.element.addClass("ui-resizable"),
                t.extend(this, {
                    _aspectRatio: !!o.aspectRatio,
                    aspectRatio: o.aspectRatio,
                    originalElement: this.element,
                    _proportionallyResizeElements: [],
                    _helper: o.helper || o.ghost || o.animate ? o.helper || "ui-resizable-helper" : null
                }),
                this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i) && (this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({
                    position: this.element.css("position"),
                    width: this.element.outerWidth(),
                    height: this.element.outerHeight(),
                    top: this.element.css("top"),
                    left: this.element.css("left")
                })),
                this.element = this.element.parent().data("ui-resizable", this.element.data("ui-resizable")),
                this.elementIsWrapper = !0,
                this.element.css({
                    marginLeft: this.originalElement.css("marginLeft"),
                    marginTop: this.originalElement.css("marginTop"),
                    marginRight: this.originalElement.css("marginRight"),
                    marginBottom: this.originalElement.css("marginBottom")
                }),
                this.originalElement.css({
                    marginLeft: 0,
                    marginTop: 0,
                    marginRight: 0,
                    marginBottom: 0
                }),
                this.originalResizeStyle = this.originalElement.css("resize"),
                this.originalElement.css("resize", "none"),
                this._proportionallyResizeElements.push(this.originalElement.css({
                    position: "static",
                    zoom: 1,
                    display: "block"
                })),
                this.originalElement.css({
                    margin: this.originalElement.css("margin")
                }),
                this._proportionallyResize()),
                this.handles = o.handles || (t(".ui-resizable-handle", this.element).length ? {
                    n: ".ui-resizable-n",
                    e: ".ui-resizable-e",
                    s: ".ui-resizable-s",
                    w: ".ui-resizable-w",
                    se: ".ui-resizable-se",
                    sw: ".ui-resizable-sw",
                    ne: ".ui-resizable-ne",
                    nw: ".ui-resizable-nw"
                } : "e,s,se"),
                this.handles.constructor === String)
                    for ("all" === this.handles && (this.handles = "n,e,s,w,se,sw,ne,nw"),
                    e = this.handles.split(","),
                    this.handles = {},
                    i = 0; i < e.length; i++)
                        n = t.trim(e[i]),
                        a = "ui-resizable-" + n,
                        r = t("<div class='ui-resizable-handle " + a + "'></div>"),
                        r.css({
                            zIndex: o.zIndex
                        }),
                        "se" === n && r.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),
                        this.handles[n] = ".ui-resizable-" + n,
                        this.element.append(r);
                this._renderAxis = function(e) {
                    var i, n, r, a;
                    e = e || this.element;
                    for (i in this.handles)
                        this.handles[i].constructor === String && (this.handles[i] = t(this.handles[i], this.element).show()),
                        this.elementIsWrapper && this.originalElement[0].nodeName.match(/textarea|input|select|button/i) && (n = t(this.handles[i], this.element),
                        a = /sw|ne|nw|se|n|s/.test(i) ? n.outerHeight() : n.outerWidth(),
                        r = ["padding", /ne|nw|n/.test(i) ? "Top" : /se|sw|s/.test(i) ? "Bottom" : /^e$/.test(i) ? "Right" : "Left"].join(""),
                        e.css(r, a),
                        this._proportionallyResize()),
                        t(this.handles[i]).length
                }
                ,
                this._renderAxis(this.element),
                this._handles = t(".ui-resizable-handle", this.element).disableSelection(),
                this._handles.mouseover(function() {
                    s.resizing || (this.className && (r = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),
                    s.axis = r && r[1] ? r[1] : "se")
                }),
                o.autoHide && (this._handles.hide(),
                t(this.element).addClass("ui-resizable-autohide").mouseenter(function() {
                    o.disabled || (t(this).removeClass("ui-resizable-autohide"),
                    s._handles.show())
                }).mouseleave(function() {
                    o.disabled || s.resizing || (t(this).addClass("ui-resizable-autohide"),
                    s._handles.hide())
                })),
                this._mouseInit()
            },
            _destroy: function() {
                this._mouseDestroy();
                var e, i = function(e) {
                    t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()
                };
                return this.elementIsWrapper && (i(this.element),
                e = this.element,
                this.originalElement.css({
                    position: e.css("position"),
                    width: e.outerWidth(),
                    height: e.outerHeight(),
                    top: e.css("top"),
                    left: e.css("left")
                }).insertAfter(e),
                e.remove()),
                this.originalElement.css("resize", this.originalResizeStyle),
                i(this.originalElement),
                this
            },
            _mouseCapture: function(e) {
                var i, n, r = !1;
                for (i in this.handles)
                    n = t(this.handles[i])[0],
                    (n === e.target || t.contains(n, e.target)) && (r = !0);
                return !this.options.disabled && r
            },
            _mouseStart: function(e) {
                var n, r, a, s = this.options, o = this.element.position(), u = this.element;
                return this.resizing = !0,
                /absolute/.test(u.css("position")) ? u.css({
                    position: "absolute",
                    top: u.css("top"),
                    left: u.css("left")
                }) : u.is(".ui-draggable") && u.css({
                    position: "absolute",
                    top: o.top,
                    left: o.left
                }),
                this._renderProxy(),
                n = i(this.helper.css("left")),
                r = i(this.helper.css("top")),
                s.containment && (n += t(s.containment).scrollLeft() || 0,
                r += t(s.containment).scrollTop() || 0),
                this.offset = this.helper.offset(),
                this.position = {
                    left: n,
                    top: r
                },
                this.size = this._helper ? {
                    width: u.outerWidth(),
                    height: u.outerHeight()
                } : {
                    width: u.width(),
                    height: u.height()
                },
                this.originalSize = this._helper ? {
                    width: u.outerWidth(),
                    height: u.outerHeight()
                } : {
                    width: u.width(),
                    height: u.height()
                },
                this.originalPosition = {
                    left: n,
                    top: r
                },
                this.sizeDiff = {
                    width: u.outerWidth() - u.width(),
                    height: u.outerHeight() - u.height()
                },
                this.originalMousePosition = {
                    left: e.pageX,
                    top: e.pageY
                },
                this.aspectRatio = "number" == typeof s.aspectRatio ? s.aspectRatio : this.originalSize.width / this.originalSize.height || 1,
                a = t(".ui-resizable-" + this.axis).css("cursor"),
                t("body").css("cursor", "auto" === a ? this.axis + "-resize" : a),
                u.addClass("ui-resizable-resizing"),
                this._propagate("start", e),
                !0
            },
            _mouseDrag: function(e) {
                var i, n = this.helper, r = {}, a = this.originalMousePosition, s = this.axis, o = this.position.top, u = this.position.left, l = this.size.width, c = this.size.height, h = e.pageX - a.left || 0, d = e.pageY - a.top || 0, p = this._change[s];
                return !!p && (i = p.apply(this, [e, h, d]),
                this._updateVirtualBoundaries(e.shiftKey),
                (this._aspectRatio || e.shiftKey) && (i = this._updateRatio(i, e)),
                i = this._respectSize(i, e),
                this._updateCache(i),
                this._propagate("resize", e),
                this.position.top !== o && (r.top = this.position.top + "px"),
                this.position.left !== u && (r.left = this.position.left + "px"),
                this.size.width !== l && (r.width = this.size.width + "px"),
                this.size.height !== c && (r.height = this.size.height + "px"),
                n.css(r),
                !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(),
                t.isEmptyObject(r) || this._trigger("resize", e, this.ui()),
                !1)
            },
            _mouseStop: function(e) {
                this.resizing = !1;
                var i, n, r, a, s, o, u, l = this.options, c = this;
                return this._helper && (i = this._proportionallyResizeElements,
                n = i.length && /textarea/i.test(i[0].nodeName),
                r = n && t.ui.hasScroll(i[0], "left") ? 0 : c.sizeDiff.height,
                a = n ? 0 : c.sizeDiff.width,
                s = {
                    width: c.helper.width() - a,
                    height: c.helper.height() - r
                },
                o = parseInt(c.element.css("left"), 10) + (c.position.left - c.originalPosition.left) || null,
                u = parseInt(c.element.css("top"), 10) + (c.position.top - c.originalPosition.top) || null,
                l.animate || this.element.css(t.extend(s, {
                    top: u,
                    left: o
                })),
                c.helper.height(c.size.height),
                c.helper.width(c.size.width),
                this._helper && !l.animate && this._proportionallyResize()),
                t("body").css("cursor", "auto"),
                this.element.removeClass("ui-resizable-resizing"),
                this._propagate("stop", e),
                this._helper && this.helper.remove(),
                !1
            },
            _updateVirtualBoundaries: function(t) {
                var e, i, r, a, s, o = this.options;
                s = {
                    minWidth: n(o.minWidth) ? o.minWidth : 0,
                    maxWidth: n(o.maxWidth) ? o.maxWidth : 1 / 0,
                    minHeight: n(o.minHeight) ? o.minHeight : 0,
                    maxHeight: n(o.maxHeight) ? o.maxHeight : 1 / 0
                },
                (this._aspectRatio || t) && (e = s.minHeight * this.aspectRatio,
                r = s.minWidth / this.aspectRatio,
                i = s.maxHeight * this.aspectRatio,
                a = s.maxWidth / this.aspectRatio,
                e > s.minWidth && (s.minWidth = e),
                r > s.minHeight && (s.minHeight = r),
                i < s.maxWidth && (s.maxWidth = i),
                a < s.maxHeight && (s.maxHeight = a)),
                this._vBoundaries = s
            },
            _updateCache: function(t) {
                this.offset = this.helper.offset(),
                n(t.left) && (this.position.left = t.left),
                n(t.top) && (this.position.top = t.top),
                n(t.height) && (this.size.height = t.height),
                n(t.width) && (this.size.width = t.width)
            },
            _updateRatio: function(t) {
                var e = this.position
                  , i = this.size
                  , r = this.axis;
                return n(t.height) ? t.width = t.height * this.aspectRatio : n(t.width) && (t.height = t.width / this.aspectRatio),
                "sw" === r && (t.left = e.left + (i.width - t.width),
                t.top = null),
                "nw" === r && (t.top = e.top + (i.height - t.height),
                t.left = e.left + (i.width - t.width)),
                t
            },
            _respectSize: function(t) {
                var e = this._vBoundaries
                  , i = this.axis
                  , r = n(t.width) && e.maxWidth && e.maxWidth < t.width
                  , a = n(t.height) && e.maxHeight && e.maxHeight < t.height
                  , s = n(t.width) && e.minWidth && e.minWidth > t.width
                  , o = n(t.height) && e.minHeight && e.minHeight > t.height
                  , u = this.originalPosition.left + this.originalSize.width
                  , l = this.position.top + this.size.height
                  , c = /sw|nw|w/.test(i)
                  , h = /nw|ne|n/.test(i);
                return s && (t.width = e.minWidth),
                o && (t.height = e.minHeight),
                r && (t.width = e.maxWidth),
                a && (t.height = e.maxHeight),
                s && c && (t.left = u - e.minWidth),
                r && c && (t.left = u - e.maxWidth),
                o && h && (t.top = l - e.minHeight),
                a && h && (t.top = l - e.maxHeight),
                t.width || t.height || t.left || !t.top ? t.width || t.height || t.top || !t.left || (t.left = null) : t.top = null,
                t
            },
            _proportionallyResize: function() {
                if (this._proportionallyResizeElements.length) {
                    var t, e, i, n, r, a = this.helper || this.element;
                    for (t = 0; t < this._proportionallyResizeElements.length; t++) {
                        if (r = this._proportionallyResizeElements[t],
                        !this.borderDif)
                            for (this.borderDif = [],
                            i = [r.css("borderTopWidth"), r.css("borderRightWidth"), r.css("borderBottomWidth"), r.css("borderLeftWidth")],
                            n = [r.css("paddingTop"), r.css("paddingRight"), r.css("paddingBottom"), r.css("paddingLeft")],
                            e = 0; e < i.length; e++)
                                this.borderDif[e] = (parseInt(i[e], 10) || 0) + (parseInt(n[e], 10) || 0);
                        r.css({
                            height: a.height() - this.borderDif[0] - this.borderDif[2] || 0,
                            width: a.width() - this.borderDif[1] - this.borderDif[3] || 0
                        })
                    }
                }
            },
            _renderProxy: function() {
                var e = this.element
                  , i = this.options;
                this.elementOffset = e.offset(),
                this._helper ? (this.helper = this.helper || t("<div style='overflow:hidden;'></div>"),
                this.helper.addClass(this._helper).css({
                    width: this.element.outerWidth() - 1,
                    height: this.element.outerHeight() - 1,
                    position: "absolute",
                    left: this.elementOffset.left + "px",
                    top: this.elementOffset.top + "px",
                    zIndex: ++i.zIndex
                }),
                this.helper.appendTo("body").disableSelection()) : this.helper = this.element
            },
            _change: {
                e: function(t, e) {
                    return {
                        width: this.originalSize.width + e
                    }
                },
                w: function(t, e) {
                    var i = this.originalSize
                      , n = this.originalPosition;
                    return {
                        left: n.left + e,
                        width: i.width - e
                    }
                },
                n: function(t, e, i) {
                    var n = this.originalSize
                      , r = this.originalPosition;
                    return {
                        top: r.top + i,
                        height: n.height - i
                    }
                },
                s: function(t, e, i) {
                    return {
                        height: this.originalSize.height + i
                    }
                },
                se: function(e, i, n) {
                    return t.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [e, i, n]))
                },
                sw: function(e, i, n) {
                    return t.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [e, i, n]))
                },
                ne: function(e, i, n) {
                    return t.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [e, i, n]))
                },
                nw: function(e, i, n) {
                    return t.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [e, i, n]))
                }
            },
            _propagate: function(e, i) {
                t.ui.plugin.call(this, e, [i, this.ui()]),
                "resize" !== e && this._trigger(e, i, this.ui())
            },
            plugins: {},
            ui: function() {
                return {
                    originalElement: this.originalElement,
                    element: this.element,
                    helper: this.helper,
                    position: this.position,
                    size: this.size,
                    originalSize: this.originalSize,
                    originalPosition: this.originalPosition
                }
            }
        }),
        t.ui.plugin.add("resizable", "animate", {
            stop: function(e) {
                var i = t(this).data("ui-resizable")
                  , n = i.options
                  , r = i._proportionallyResizeElements
                  , a = r.length && /textarea/i.test(r[0].nodeName)
                  , s = a && t.ui.hasScroll(r[0], "left") ? 0 : i.sizeDiff.height
                  , o = a ? 0 : i.sizeDiff.width
                  , u = {
                    width: i.size.width - o,
                    height: i.size.height - s
                }
                  , l = parseInt(i.element.css("left"), 10) + (i.position.left - i.originalPosition.left) || null
                  , c = parseInt(i.element.css("top"), 10) + (i.position.top - i.originalPosition.top) || null;
                i.element.animate(t.extend(u, c && l ? {
                    top: c,
                    left: l
                } : {}), {
                    duration: n.animateDuration,
                    easing: n.animateEasing,
                    step: function() {
                        var n = {
                            width: parseInt(i.element.css("width"), 10),
                            height: parseInt(i.element.css("height"), 10),
                            top: parseInt(i.element.css("top"), 10),
                            left: parseInt(i.element.css("left"), 10)
                        };
                        r && r.length && t(r[0]).css({
                            width: n.width,
                            height: n.height
                        }),
                        i._updateCache(n),
                        i._propagate("resize", e)
                    }
                })
            }
        }),
        t.ui.plugin.add("resizable", "containment", {
            start: function() {
                var e, n, r, a, s, o, u, l = t(this).data("ui-resizable"), c = l.options, h = l.element, d = c.containment, p = d instanceof t ? d.get(0) : /parent/.test(d) ? h.parent().get(0) : d;
                p && (l.containerElement = t(p),
                /document/.test(d) || d === document ? (l.containerOffset = {
                    left: 0,
                    top: 0
                },
                l.containerPosition = {
                    left: 0,
                    top: 0
                },
                l.parentData = {
                    element: t(document),
                    left: 0,
                    top: 0,
                    width: t(document).width(),
                    height: t(document).height() || document.body.parentNode.scrollHeight
                }) : (e = t(p),
                n = [],
                t(["Top", "Right", "Left", "Bottom"]).each(function(t, r) {
                    n[t] = i(e.css("padding" + r))
                }),
                l.containerOffset = e.offset(),
                l.containerPosition = e.position(),
                l.containerSize = {
                    height: e.innerHeight() - n[3],
                    width: e.innerWidth() - n[1]
                },
                r = l.containerOffset,
                a = l.containerSize.height,
                s = l.containerSize.width,
                o = t.ui.hasScroll(p, "left") ? p.scrollWidth : s,
                u = t.ui.hasScroll(p) ? p.scrollHeight : a,
                l.parentData = {
                    element: p,
                    left: r.left,
                    top: r.top,
                    width: o,
                    height: u
                }))
            },
            resize: function(e) {
                var i, n, r, a, s = t(this).data("ui-resizable"), o = s.options, u = s.containerOffset, l = s.position, c = s._aspectRatio || e.shiftKey, h = {
                    top: 0,
                    left: 0
                }, d = s.containerElement;
                d[0] !== document && /static/.test(d.css("position")) && (h = u),
                l.left < (s._helper ? u.left : 0) && (s.size.width = s.size.width + (s._helper ? s.position.left - u.left : s.position.left - h.left),
                c && (s.size.height = s.size.width / s.aspectRatio),
                s.position.left = o.helper ? u.left : 0),
                l.top < (s._helper ? u.top : 0) && (s.size.height = s.size.height + (s._helper ? s.position.top - u.top : s.position.top),
                c && (s.size.width = s.size.height * s.aspectRatio),
                s.position.top = s._helper ? u.top : 0),
                s.offset.left = s.parentData.left + s.position.left,
                s.offset.top = s.parentData.top + s.position.top,
                i = Math.abs((s._helper ? s.offset.left - h.left : s.offset.left - h.left) + s.sizeDiff.width),
                n = Math.abs((s._helper ? s.offset.top - h.top : s.offset.top - u.top) + s.sizeDiff.height),
                r = s.containerElement.get(0) === s.element.parent().get(0),
                a = /relative|absolute/.test(s.containerElement.css("position")),
                r && a && (i -= s.parentData.left),
                i + s.size.width >= s.parentData.width && (s.size.width = s.parentData.width - i,
                c && (s.size.height = s.size.width / s.aspectRatio)),
                n + s.size.height >= s.parentData.height && (s.size.height = s.parentData.height - n,
                c && (s.size.width = s.size.height * s.aspectRatio))
            },
            stop: function() {
                var e = t(this).data("ui-resizable")
                  , i = e.options
                  , n = e.containerOffset
                  , r = e.containerPosition
                  , a = e.containerElement
                  , s = t(e.helper)
                  , o = s.offset()
                  , u = s.outerWidth() - e.sizeDiff.width
                  , l = s.outerHeight() - e.sizeDiff.height;
                e._helper && !i.animate && /relative/.test(a.css("position")) && t(this).css({
                    left: o.left - r.left - n.left,
                    width: u,
                    height: l
                }),
                e._helper && !i.animate && /static/.test(a.css("position")) && t(this).css({
                    left: o.left - r.left - n.left,
                    width: u,
                    height: l
                })
            }
        }),
        t.ui.plugin.add("resizable", "alsoResize", {
            start: function() {
                var e = t(this).data("ui-resizable")
                  , i = e.options
                  , n = function(e) {
                    t(e).each(function() {
                        var e = t(this);
                        e.data("ui-resizable-alsoresize", {
                            width: parseInt(e.width(), 10),
                            height: parseInt(e.height(), 10),
                            left: parseInt(e.css("left"), 10),
                            top: parseInt(e.css("top"), 10)
                        })
                    })
                };
                "object" != typeof i.alsoResize || i.alsoResize.parentNode ? n(i.alsoResize) : i.alsoResize.length ? (i.alsoResize = i.alsoResize[0],
                n(i.alsoResize)) : t.each(i.alsoResize, function(t) {
                    n(t)
                })
            },
            resize: function(e, i) {
                var n = t(this).data("ui-resizable")
                  , r = n.options
                  , a = n.originalSize
                  , s = n.originalPosition
                  , o = {
                    height: n.size.height - a.height || 0,
                    width: n.size.width - a.width || 0,
                    top: n.position.top - s.top || 0,
                    left: n.position.left - s.left || 0
                }
                  , u = function(e, n) {
                    t(e).each(function() {
                        var e = t(this)
                          , r = t(this).data("ui-resizable-alsoresize")
                          , a = {}
                          , s = n && n.length ? n : e.parents(i.originalElement[0]).length ? ["width", "height"] : ["width", "height", "top", "left"];
                        t.each(s, function(t, e) {
                            var i = (r[e] || 0) + (o[e] || 0);
                            i && i >= 0 && (a[e] = i || null)
                        }),
                        e.css(a)
                    })
                };
                "object" != typeof r.alsoResize || r.alsoResize.nodeType ? u(r.alsoResize) : t.each(r.alsoResize, function(t, e) {
                    u(t, e)
                })
            },
            stop: function() {
                t(this).removeData("resizable-alsoresize")
            }
        }),
        t.ui.plugin.add("resizable", "ghost", {
            start: function() {
                var e = t(this).data("ui-resizable")
                  , i = e.options
                  , n = e.size;
                e.ghost = e.originalElement.clone(),
                e.ghost.css({
                    opacity: .25,
                    display: "block",
                    position: "relative",
                    height: n.height,
                    width: n.width,
                    margin: 0,
                    left: 0,
                    top: 0
                }).addClass("ui-resizable-ghost").addClass("string" == typeof i.ghost ? i.ghost : ""),
                e.ghost.appendTo(e.helper)
            },
            resize: function() {
                var e = t(this).data("ui-resizable");
                e.ghost && e.ghost.css({
                    position: "relative",
                    height: e.size.height,
                    width: e.size.width
                })
            },
            stop: function() {
                var e = t(this).data("ui-resizable");
                e.ghost && e.helper && e.helper.get(0).removeChild(e.ghost.get(0))
            }
        }),
        t.ui.plugin.add("resizable", "grid", {
            resize: function() {
                var e = t(this).data("ui-resizable")
                  , i = e.options
                  , n = e.size
                  , r = e.originalSize
                  , a = e.originalPosition
                  , s = e.axis
                  , o = "number" == typeof i.grid ? [i.grid, i.grid] : i.grid
                  , u = o[0] || 1
                  , l = o[1] || 1
                  , c = Math.round((n.width - r.width) / u) * u
                  , h = Math.round((n.height - r.height) / l) * l
                  , d = r.width + c
                  , p = r.height + h
                  , f = i.maxWidth && i.maxWidth < d
                  , g = i.maxHeight && i.maxHeight < p
                  , m = i.minWidth && i.minWidth > d
                  , v = i.minHeight && i.minHeight > p;
                i.grid = o,
                m && (d += u),
                v && (p += l),
                f && (d -= u),
                g && (p -= l),
                /^(se|s|e)$/.test(s) ? (e.size.width = d,
                e.size.height = p) : /^(ne)$/.test(s) ? (e.size.width = d,
                e.size.height = p,
                e.position.top = a.top - h) : /^(sw)$/.test(s) ? (e.size.width = d,
                e.size.height = p,
                e.position.left = a.left - c) : (e.size.width = d,
                e.size.height = p,
                e.position.top = a.top - h,
                e.position.left = a.left - c)
            }
        })
    }(n),
    function(t, e) {
        t.widget("ui.selectable", t.ui.mouse, {
            version: "1.10.3",
            options: {
                appendTo: "body",
                autoRefresh: !0,
                distance: 0,
                filter: "*",
                tolerance: "touch",
                selected: null,
                selecting: null,
                start: null,
                stop: null,
                unselected: null,
                unselecting: null
            },
            _create: function() {
                var e, i = this;
                this.element.addClass("ui-selectable"),
                this.dragged = !1,
                this.refresh = function() {
                    e = t(i.options.filter, i.element[0]),
                    e.addClass("ui-selectee"),
                    e.each(function() {
                        var e = t(this)
                          , i = e.offset();
                        t.data(this, "selectable-item", {
                            element: this,
                            $element: e,
                            left: i.left,
                            top: i.top,
                            right: i.left + e.outerWidth(),
                            bottom: i.top + e.outerHeight(),
                            startselected: !1,
                            selected: e.hasClass("ui-selected"),
                            selecting: e.hasClass("ui-selecting"),
                            unselecting: e.hasClass("ui-unselecting")
                        })
                    })
                }
                ,
                this.refresh(),
                this.selectees = e.addClass("ui-selectee"),
                this._mouseInit(),
                this.helper = t("<div class='ui-selectable-helper'></div>")
            },
            _destroy: function() {
                this.selectees.removeClass("ui-selectee").removeData("selectable-item"),
                this.element.removeClass("ui-selectable ui-selectable-disabled"),
                this._mouseDestroy()
            },
            _mouseStart: function(e) {
                var i = this
                  , n = this.options;
                this.opos = [e.pageX, e.pageY],
                this.options.disabled || (this.selectees = t(n.filter, this.element[0]),
                this._trigger("start", e),
                t(n.appendTo).append(this.helper),
                this.helper.css({
                    left: e.pageX,
                    top: e.pageY,
                    width: 0,
                    height: 0
                }),
                n.autoRefresh && this.refresh(),
                this.selectees.filter(".ui-selected").each(function() {
                    var n = t.data(this, "selectable-item");
                    n.startselected = !0,
                    e.metaKey || e.ctrlKey || (n.$element.removeClass("ui-selected"),
                    n.selected = !1,
                    n.$element.addClass("ui-unselecting"),
                    n.unselecting = !0,
                    i._trigger("unselecting", e, {
                        unselecting: n.element
                    }))
                }),
                t(e.target).parents().addBack().each(function() {
                    var n, r = t.data(this, "selectable-item");
                    if (r)
                        return n = !e.metaKey && !e.ctrlKey || !r.$element.hasClass("ui-selected"),
                        r.$element.removeClass(n ? "ui-unselecting" : "ui-selected").addClass(n ? "ui-selecting" : "ui-unselecting"),
                        r.unselecting = !n,
                        r.selecting = n,
                        r.selected = n,
                        n ? i._trigger("selecting", e, {
                            selecting: r.element
                        }) : i._trigger("unselecting", e, {
                            unselecting: r.element
                        }),
                        !1
                }))
            },
            _mouseDrag: function(e) {
                if (this.dragged = !0,
                !this.options.disabled) {
                    var i, n = this, r = this.options, a = this.opos[0], s = this.opos[1], o = e.pageX, u = e.pageY;
                    return a > o && (i = o,
                    o = a,
                    a = i),
                    s > u && (i = u,
                    u = s,
                    s = i),
                    this.helper.css({
                        left: a,
                        top: s,
                        width: o - a,
                        height: u - s
                    }),
                    this.selectees.each(function() {
                        var i = t.data(this, "selectable-item")
                          , l = !1;
                        i && i.element !== n.element[0] && ("touch" === r.tolerance ? l = !(i.left > o || i.right < a || i.top > u || i.bottom < s) : "fit" === r.tolerance && (l = i.left > a && i.right < o && i.top > s && i.bottom < u),
                        l ? (i.selected && (i.$element.removeClass("ui-selected"),
                        i.selected = !1),
                        i.unselecting && (i.$element.removeClass("ui-unselecting"),
                        i.unselecting = !1),
                        i.selecting || (i.$element.addClass("ui-selecting"),
                        i.selecting = !0,
                        n._trigger("selecting", e, {
                            selecting: i.element
                        }))) : (i.selecting && ((e.metaKey || e.ctrlKey) && i.startselected ? (i.$element.removeClass("ui-selecting"),
                        i.selecting = !1,
                        i.$element.addClass("ui-selected"),
                        i.selected = !0) : (i.$element.removeClass("ui-selecting"),
                        i.selecting = !1,
                        i.startselected && (i.$element.addClass("ui-unselecting"),
                        i.unselecting = !0),
                        n._trigger("unselecting", e, {
                            unselecting: i.element
                        }))),
                        i.selected && (e.metaKey || e.ctrlKey || i.startselected || (i.$element.removeClass("ui-selected"),
                        i.selected = !1,
                        i.$element.addClass("ui-unselecting"),
                        i.unselecting = !0,
                        n._trigger("unselecting", e, {
                            unselecting: i.element
                        })))))
                    }),
                    !1
                }
            },
            _mouseStop: function(e) {
                var i = this;
                return this.dragged = !1,
                t(".ui-unselecting", this.element[0]).each(function() {
                    var n = t.data(this, "selectable-item");
                    n.$element.removeClass("ui-unselecting"),
                    n.unselecting = !1,
                    n.startselected = !1,
                    i._trigger("unselected", e, {
                        unselected: n.element
                    })
                }),
                t(".ui-selecting", this.element[0]).each(function() {
                    var n = t.data(this, "selectable-item");
                    n.$element.removeClass("ui-selecting").addClass("ui-selected"),
                    n.selecting = !1,
                    n.selected = !0,
                    n.startselected = !0,
                    i._trigger("selected", e, {
                        selected: n.element
                    })
                }),
                this._trigger("stop", e),
                this.helper.remove(),
                !1
            }
        })
    }(n),
    function(t, e) {
        function i(t, e, i) {
            return t > e && t < e + i
        }
        function n(t) {
            return /left|right/.test(t.css("float")) || /inline|table-cell/.test(t.css("display"))
        }
        t.widget("ui.sortable", t.ui.mouse, {
            version: "1.10.3",
            widgetEventPrefix: "sort",
            ready: !1,
            options: {
                appendTo: "parent",
                axis: !1,
                connectWith: !1,
                containment: !1,
                cursor: "auto",
                cursorAt: !1,
                dropOnEmpty: !0,
                forcePlaceholderSize: !1,
                forceHelperSize: !1,
                grid: !1,
                handle: !1,
                helper: "original",
                items: "> *",
                opacity: !1,
                placeholder: !1,
                revert: !1,
                scroll: !0,
                scrollSensitivity: 20,
                scrollSpeed: 20,
                scope: "default",
                tolerance: "intersect",
                zIndex: 1e3,
                activate: null,
                beforeStop: null,
                change: null,
                deactivate: null,
                out: null,
                over: null,
                receive: null,
                remove: null,
                sort: null,
                start: null,
                stop: null,
                update: null
            },
            _create: function() {
                var t = this.options;
                this.containerCache = {},
                this.element.addClass("ui-sortable"),
                this.refresh(),
                this.floating = !!this.items.length && ("x" === t.axis || n(this.items[0].item)),
                this.offset = this.element.offset(),
                this._mouseInit(),
                this.ready = !0
            },
            _destroy: function() {
                this.element.removeClass("ui-sortable ui-sortable-disabled"),
                this._mouseDestroy();
                for (var t = this.items.length - 1; t >= 0; t--)
                    this.items[t].item.removeData(this.widgetName + "-item");
                return this
            },
            _setOption: function(e, i) {
                "disabled" === e ? (this.options[e] = i,
                this.widget().toggleClass("ui-sortable-disabled", !!i)) : t.Widget.prototype._setOption.apply(this, arguments)
            },
            _mouseCapture: function(e, i) {
                var n = null
                  , r = !1
                  , a = this;
                return !this.reverting && (!this.options.disabled && "static" !== this.options.type && (this._refreshItems(e),
                t(e.target).parents().each(function() {
                    if (t.data(this, a.widgetName + "-item") === a)
                        return n = t(this),
                        !1
                }),
                t.data(e.target, a.widgetName + "-item") === a && (n = t(e.target)),
                !!n && (!(this.options.handle && !i && (t(this.options.handle, n).find("*").addBack().each(function() {
                    this === e.target && (r = !0)
                }),
                !r)) && (this.currentItem = n,
                this._removeCurrentsFromItems(),
                !0))))
            },
            _mouseStart: function(e, i, n) {
                var r, a, s = this.options;
                if (this.currentContainer = this,
                this.refreshPositions(),
                this.helper = this._createHelper(e),
                this._cacheHelperProportions(),
                this._cacheMargins(),
                this.scrollParent = this.helper.scrollParent(),
                this.offset = this.currentItem.offset(),
                this.offset = {
                    top: this.offset.top - this.margins.top,
                    left: this.offset.left - this.margins.left
                },
                t.extend(this.offset, {
                    click: {
                        left: e.pageX - this.offset.left,
                        top: e.pageY - this.offset.top
                    },
                    parent: this._getParentOffset(),
                    relative: this._getRelativeOffset()
                }),
                this.helper.css("position", "absolute"),
                this.cssPosition = this.helper.css("position"),
                this.originalPosition = this._generatePosition(e),
                this.originalPageX = e.pageX,
                this.originalPageY = e.pageY,
                s.cursorAt && this._adjustOffsetFromHelper(s.cursorAt),
                this.domPosition = {
                    prev: this.currentItem.prev()[0],
                    parent: this.currentItem.parent()[0]
                },
                this.helper[0] !== this.currentItem[0] && this.currentItem.hide(),
                this._createPlaceholder(),
                s.containment && this._setContainment(),
                s.cursor && "auto" !== s.cursor && (a = this.document.find("body"),
                this.storedCursor = a.css("cursor"),
                a.css("cursor", s.cursor),
                this.storedStylesheet = t("<style>*{ cursor: " + s.cursor + " !important; }</style>").appendTo(a)),
                s.opacity && (this.helper.css("opacity") && (this._storedOpacity = this.helper.css("opacity")),
                this.helper.css("opacity", s.opacity)),
                s.zIndex && (this.helper.css("zIndex") && (this._storedZIndex = this.helper.css("zIndex")),
                this.helper.css("zIndex", s.zIndex)),
                this.scrollParent[0] !== document && "HTML" !== this.scrollParent[0].tagName && (this.overflowOffset = this.scrollParent.offset()),
                this._trigger("start", e, this._uiHash()),
                this._preserveHelperProportions || this._cacheHelperProportions(),
                !n)
                    for (r = this.containers.length - 1; r >= 0; r--)
                        this.containers[r]._trigger("activate", e, this._uiHash(this));
                return t.ui.ddmanager && (t.ui.ddmanager.current = this),
                t.ui.ddmanager && !s.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e),
                this.dragging = !0,
                this.helper.addClass("ui-sortable-helper"),
                this._mouseDrag(e),
                !0
            },
            _mouseDrag: function(e) {
                var i, n, r, a, s = this.options, o = !1;
                for (this.position = this._generatePosition(e),
                this.positionAbs = this._convertPositionTo("absolute"),
                this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs),
                this.options.scroll && (this.scrollParent[0] !== document && "HTML" !== this.scrollParent[0].tagName ? (this.overflowOffset.top + this.scrollParent[0].offsetHeight - e.pageY < s.scrollSensitivity ? this.scrollParent[0].scrollTop = o = this.scrollParent[0].scrollTop + s.scrollSpeed : e.pageY - this.overflowOffset.top < s.scrollSensitivity && (this.scrollParent[0].scrollTop = o = this.scrollParent[0].scrollTop - s.scrollSpeed),
                this.overflowOffset.left + this.scrollParent[0].offsetWidth - e.pageX < s.scrollSensitivity ? this.scrollParent[0].scrollLeft = o = this.scrollParent[0].scrollLeft + s.scrollSpeed : e.pageX - this.overflowOffset.left < s.scrollSensitivity && (this.scrollParent[0].scrollLeft = o = this.scrollParent[0].scrollLeft - s.scrollSpeed)) : (e.pageY - t(document).scrollTop() < s.scrollSensitivity ? o = t(document).scrollTop(t(document).scrollTop() - s.scrollSpeed) : t(window).height() - (e.pageY - t(document).scrollTop()) < s.scrollSensitivity && (o = t(document).scrollTop(t(document).scrollTop() + s.scrollSpeed)),
                e.pageX - t(document).scrollLeft() < s.scrollSensitivity ? o = t(document).scrollLeft(t(document).scrollLeft() - s.scrollSpeed) : t(window).width() - (e.pageX - t(document).scrollLeft()) < s.scrollSensitivity && (o = t(document).scrollLeft(t(document).scrollLeft() + s.scrollSpeed))),
                o !== !1 && t.ui.ddmanager && !s.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e)),
                this.positionAbs = this._convertPositionTo("absolute"),
                this.options.axis && "y" === this.options.axis || (this.helper[0].style.left = this.position.left + "px"),
                this.options.axis && "x" === this.options.axis || (this.helper[0].style.top = this.position.top + "px"),
                i = this.items.length - 1; i >= 0; i--)
                    if (n = this.items[i],
                    r = n.item[0],
                    a = this._intersectsWithPointer(n),
                    a && n.instance === this.currentContainer && !(r === this.currentItem[0] || this.placeholder[1 === a ? "next" : "prev"]()[0] === r || t.contains(this.placeholder[0], r) || "semi-dynamic" === this.options.type && t.contains(this.element[0], r))) {
                        if (this.direction = 1 === a ? "down" : "up",
                        "pointer" !== this.options.tolerance && !this._intersectsWithSides(n))
                            break;
                        this._rearrange(e, n),
                        this._trigger("change", e, this._uiHash());
                        break
                    }
                return this._contactContainers(e),
                t.ui.ddmanager && t.ui.ddmanager.drag(this, e),
                this._trigger("sort", e, this._uiHash()),
                this.lastPositionAbs = this.positionAbs,
                !1
            },
            _mouseStop: function(e, i) {
                if (e) {
                    if (t.ui.ddmanager && !this.options.dropBehaviour && t.ui.ddmanager.drop(this, e),
                    this.options.revert) {
                        var n = this
                          , r = this.placeholder.offset()
                          , a = this.options.axis
                          , s = {};
                        a && "x" !== a || (s.left = r.left - this.offset.parent.left - this.margins.left + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollLeft)),
                        a && "y" !== a || (s.top = r.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollTop)),
                        this.reverting = !0,
                        t(this.helper).animate(s, parseInt(this.options.revert, 10) || 500, function() {
                            n._clear(e)
                        })
                    } else
                        this._clear(e, i);
                    return !1
                }
            },
            cancel: function() {
                if (this.dragging) {
                    this._mouseUp({
                        target: null
                    }),
                    "original" === this.options.helper ? this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper") : this.currentItem.show();
                    for (var e = this.containers.length - 1; e >= 0; e--)
                        this.containers[e]._trigger("deactivate", null, this._uiHash(this)),
                        this.containers[e].containerCache.over && (this.containers[e]._trigger("out", null, this._uiHash(this)),
                        this.containers[e].containerCache.over = 0)
                }
                return this.placeholder && (this.placeholder[0].parentNode && this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
                "original" !== this.options.helper && this.helper && this.helper[0].parentNode && this.helper.remove(),
                t.extend(this, {
                    helper: null,
                    dragging: !1,
                    reverting: !1,
                    _noFinalSort: null
                }),
                this.domPosition.prev ? t(this.domPosition.prev).after(this.currentItem) : t(this.domPosition.parent).prepend(this.currentItem)),
                this
            },
            serialize: function(e) {
                var i = this._getItemsAsjQuery(e && e.connected)
                  , n = [];
                return e = e || {},
                t(i).each(function() {
                    var i = (t(e.item || this).attr(e.attribute || "id") || "").match(e.expression || /(.+)[\-=_](.+)/);
                    i && n.push((e.key || i[1] + "[]") + "=" + (e.key && e.expression ? i[1] : i[2]))
                }),
                !n.length && e.key && n.push(e.key + "="),
                n.join("&")
            },
            toArray: function(e) {
                var i = this._getItemsAsjQuery(e && e.connected)
                  , n = [];
                return e = e || {},
                i.each(function() {
                    n.push(t(e.item || this).attr(e.attribute || "id") || "")
                }),
                n
            },
            _intersectsWith: function(t) {
                var e = this.positionAbs.left
                  , i = e + this.helperProportions.width
                  , n = this.positionAbs.top
                  , r = n + this.helperProportions.height
                  , a = t.left
                  , s = a + t.width
                  , o = t.top
                  , u = o + t.height
                  , l = this.offset.click.top
                  , c = this.offset.click.left
                  , h = "x" === this.options.axis || n + l > o && n + l < u
                  , d = "y" === this.options.axis || e + c > a && e + c < s
                  , p = h && d;
                return "pointer" === this.options.tolerance || this.options.forcePointerForContainers || "pointer" !== this.options.tolerance && this.helperProportions[this.floating ? "width" : "height"] > t[this.floating ? "width" : "height"] ? p : a < e + this.helperProportions.width / 2 && i - this.helperProportions.width / 2 < s && o < n + this.helperProportions.height / 2 && r - this.helperProportions.height / 2 < u
            },
            _intersectsWithPointer: function(t) {
                var e = "x" === this.options.axis || i(this.positionAbs.top + this.offset.click.top, t.top, t.height)
                  , n = "y" === this.options.axis || i(this.positionAbs.left + this.offset.click.left, t.left, t.width)
                  , r = e && n
                  , a = this._getDragVerticalDirection()
                  , s = this._getDragHorizontalDirection();
                return !!r && (this.floating ? s && "right" === s || "down" === a ? 2 : 1 : a && ("down" === a ? 2 : 1))
            },
            _intersectsWithSides: function(t) {
                var e = i(this.positionAbs.top + this.offset.click.top, t.top + t.height / 2, t.height)
                  , n = i(this.positionAbs.left + this.offset.click.left, t.left + t.width / 2, t.width)
                  , r = this._getDragVerticalDirection()
                  , a = this._getDragHorizontalDirection();
                return this.floating && a ? "right" === a && n || "left" === a && !n : r && ("down" === r && e || "up" === r && !e)
            },
            _getDragVerticalDirection: function() {
                var t = this.positionAbs.top - this.lastPositionAbs.top;
                return 0 !== t && (t > 0 ? "down" : "up")
            },
            _getDragHorizontalDirection: function() {
                var t = this.positionAbs.left - this.lastPositionAbs.left;
                return 0 !== t && (t > 0 ? "right" : "left")
            },
            refresh: function(t) {
                return this._refreshItems(t),
                this.refreshPositions(),
                this
            },
            _connectWith: function() {
                var t = this.options;
                return t.connectWith.constructor === String ? [t.connectWith] : t.connectWith
            },
            _getItemsAsjQuery: function(e) {
                var i, n, r, a, s = [], o = [], u = this._connectWith();
                if (u && e)
                    for (i = u.length - 1; i >= 0; i--)
                        for (r = t(u[i]),
                        n = r.length - 1; n >= 0; n--)
                            a = t.data(r[n], this.widgetFullName),
                            a && a !== this && !a.options.disabled && o.push([t.isFunction(a.options.items) ? a.options.items.call(a.element) : t(a.options.items, a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), a]);
                for (o.push([t.isFunction(this.options.items) ? this.options.items.call(this.element, null, {
                    options: this.options,
                    item: this.currentItem
                }) : t(this.options.items, this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), this]),
                i = o.length - 1; i >= 0; i--)
                    o[i][0].each(function() {
                        s.push(this)
                    });
                return t(s)
            },
            _removeCurrentsFromItems: function() {
                var e = this.currentItem.find(":data(" + this.widgetName + "-item)");
                this.items = t.grep(this.items, function(t) {
                    for (var i = 0; i < e.length; i++)
                        if (e[i] === t.item[0])
                            return !1;
                    return !0
                })
            },
            _refreshItems: function(e) {
                this.items = [],
                this.containers = [this];
                var i, n, r, a, s, o, u, l, c = this.items, h = [[t.isFunction(this.options.items) ? this.options.items.call(this.element[0], e, {
                    item: this.currentItem
                }) : t(this.options.items, this.element), this]], d = this._connectWith();
                if (d && this.ready)
                    for (i = d.length - 1; i >= 0; i--)
                        for (r = t(d[i]),
                        n = r.length - 1; n >= 0; n--)
                            a = t.data(r[n], this.widgetFullName),
                            a && a !== this && !a.options.disabled && (h.push([t.isFunction(a.options.items) ? a.options.items.call(a.element[0], e, {
                                item: this.currentItem
                            }) : t(a.options.items, a.element), a]),
                            this.containers.push(a));
                for (i = h.length - 1; i >= 0; i--)
                    for (s = h[i][1],
                    o = h[i][0],
                    n = 0,
                    l = o.length; n < l; n++)
                        u = t(o[n]),
                        u.data(this.widgetName + "-item", s),
                        c.push({
                            item: u,
                            instance: s,
                            width: 0,
                            height: 0,
                            left: 0,
                            top: 0
                        })
            },
            refreshPositions: function(e) {
                this.offsetParent && this.helper && (this.offset.parent = this._getParentOffset());
                var i, n, r, a;
                for (i = this.items.length - 1; i >= 0; i--)
                    n = this.items[i],
                    n.instance !== this.currentContainer && this.currentContainer && n.item[0] !== this.currentItem[0] || (r = this.options.toleranceElement ? t(this.options.toleranceElement, n.item) : n.item,
                    e || (n.width = r.outerWidth(),
                    n.height = r.outerHeight()),
                    a = r.offset(),
                    n.left = a.left,
                    n.top = a.top);
                if (this.options.custom && this.options.custom.refreshContainers)
                    this.options.custom.refreshContainers.call(this);
                else
                    for (i = this.containers.length - 1; i >= 0; i--)
                        a = this.containers[i].element.offset(),
                        this.containers[i].containerCache.left = a.left,
                        this.containers[i].containerCache.top = a.top,
                        this.containers[i].containerCache.width = this.containers[i].element.outerWidth(),
                        this.containers[i].containerCache.height = this.containers[i].element.outerHeight();
                return this
            },
            _createPlaceholder: function(e) {
                e = e || this;
                var i, n = e.options;
                n.placeholder && n.placeholder.constructor !== String || (i = n.placeholder,
                n.placeholder = {
                    element: function() {
                        var n = e.currentItem[0].nodeName.toLowerCase()
                          , r = t("<" + n + ">", e.document[0]).addClass(i || e.currentItem[0].className + " ui-sortable-placeholder").removeClass("ui-sortable-helper");
                        return "tr" === n ? e.currentItem.children().each(function() {
                            t("<td>&#160;</td>", e.document[0]).attr("colspan", t(this).attr("colspan") || 1).appendTo(r)
                        }) : "img" === n && r.attr("src", e.currentItem.attr("src")),
                        i || r.css("visibility", "hidden"),
                        r
                    },
                    update: function(t, r) {
                        i && !n.forcePlaceholderSize || (r.height() || r.height(e.currentItem.innerHeight() - parseInt(e.currentItem.css("paddingTop") || 0, 10) - parseInt(e.currentItem.css("paddingBottom") || 0, 10)),
                        r.width() || r.width(e.currentItem.innerWidth() - parseInt(e.currentItem.css("paddingLeft") || 0, 10) - parseInt(e.currentItem.css("paddingRight") || 0, 10)))
                    }
                }),
                e.placeholder = t(n.placeholder.element.call(e.element, e.currentItem)),
                e.currentItem.after(e.placeholder),
                n.placeholder.update(e, e.placeholder)
            },
            _contactContainers: function(e) {
                var r, a, s, o, u, l, c, h, d, p, f = null, g = null;
                for (r = this.containers.length - 1; r >= 0; r--)
                    if (!t.contains(this.currentItem[0], this.containers[r].element[0]))
                        if (this._intersectsWith(this.containers[r].containerCache)) {
                            if (f && t.contains(this.containers[r].element[0], f.element[0]))
                                continue;
                            f = this.containers[r],
                            g = r
                        } else
                            this.containers[r].containerCache.over && (this.containers[r]._trigger("out", e, this._uiHash(this)),
                            this.containers[r].containerCache.over = 0);
                if (f)
                    if (1 === this.containers.length)
                        this.containers[g].containerCache.over || (this.containers[g]._trigger("over", e, this._uiHash(this)),
                        this.containers[g].containerCache.over = 1);
                    else {
                        for (s = 1e4,
                        o = null,
                        p = f.floating || n(this.currentItem),
                        u = p ? "left" : "top",
                        l = p ? "width" : "height",
                        c = this.positionAbs[u] + this.offset.click[u],
                        a = this.items.length - 1; a >= 0; a--)
                            t.contains(this.containers[g].element[0], this.items[a].item[0]) && this.items[a].item[0] !== this.currentItem[0] && (p && !i(this.positionAbs.top + this.offset.click.top, this.items[a].top, this.items[a].height) || (h = this.items[a].item.offset()[u],
                            d = !1,
                            Math.abs(h - c) > Math.abs(h + this.items[a][l] - c) && (d = !0,
                            h += this.items[a][l]),
                            Math.abs(h - c) < s && (s = Math.abs(h - c),
                            o = this.items[a],
                            this.direction = d ? "up" : "down")));
                        if (!o && !this.options.dropOnEmpty)
                            return;
                        if (this.currentContainer === this.containers[g])
                            return;
                        o ? this._rearrange(e, o, null, !0) : this._rearrange(e, null, this.containers[g].element, !0),
                        this._trigger("change", e, this._uiHash()),
                        this.containers[g]._trigger("change", e, this._uiHash(this)),
                        this.currentContainer = this.containers[g],
                        this.options.placeholder.update(this.currentContainer, this.placeholder),
                        this.containers[g]._trigger("over", e, this._uiHash(this)),
                        this.containers[g].containerCache.over = 1
                    }
            },
            _createHelper: function(e) {
                var i = this.options
                  , n = t.isFunction(i.helper) ? t(i.helper.apply(this.element[0], [e, this.currentItem])) : "clone" === i.helper ? this.currentItem.clone() : this.currentItem;
                return n.parents("body").length || t("parent" !== i.appendTo ? i.appendTo : this.currentItem[0].parentNode)[0].appendChild(n[0]),
                n[0] === this.currentItem[0] && (this._storedCSS = {
                    width: this.currentItem[0].style.width,
                    height: this.currentItem[0].style.height,
                    position: this.currentItem.css("position"),
                    top: this.currentItem.css("top"),
                    left: this.currentItem.css("left")
                }),
                n[0].style.width && !i.forceHelperSize || n.width(this.currentItem.width()),
                n[0].style.height && !i.forceHelperSize || n.height(this.currentItem.height()),
                n
            },
            _adjustOffsetFromHelper: function(e) {
                "string" == typeof e && (e = e.split(" ")),
                t.isArray(e) && (e = {
                    left: +e[0],
                    top: +e[1] || 0
                }),
                "left"in e && (this.offset.click.left = e.left + this.margins.left),
                "right"in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left),
                "top"in e && (this.offset.click.top = e.top + this.margins.top),
                "bottom"in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top)
            },
            _getParentOffset: function() {
                this.offsetParent = this.helper.offsetParent();
                var e = this.offsetParent.offset();
                return "absolute" === this.cssPosition && this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(),
                e.top += this.scrollParent.scrollTop()),
                (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && "html" === this.offsetParent[0].tagName.toLowerCase() && t.ui.ie) && (e = {
                    top: 0,
                    left: 0
                }),
                {
                    top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                    left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
                }
            },
            _getRelativeOffset: function() {
                if ("relative" === this.cssPosition) {
                    var t = this.currentItem.position();
                    return {
                        top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                        left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
                    }
                }
                return {
                    top: 0,
                    left: 0
                }
            },
            _cacheMargins: function() {
                this.margins = {
                    left: parseInt(this.currentItem.css("marginLeft"), 10) || 0,
                    top: parseInt(this.currentItem.css("marginTop"), 10) || 0
                }
            },
            _cacheHelperProportions: function() {
                this.helperProportions = {
                    width: this.helper.outerWidth(),
                    height: this.helper.outerHeight()
                }
            },
            _setContainment: function() {
                var e, i, n, r = this.options;
                "parent" === r.containment && (r.containment = this.helper[0].parentNode),
                "document" !== r.containment && "window" !== r.containment || (this.containment = [0 - this.offset.relative.left - this.offset.parent.left, 0 - this.offset.relative.top - this.offset.parent.top, t("document" === r.containment ? document : window).width() - this.helperProportions.width - this.margins.left, (t("document" === r.containment ? document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]),
                /^(document|window|parent)$/.test(r.containment) || (e = t(r.containment)[0],
                i = t(r.containment).offset(),
                n = "hidden" !== t(e).css("overflow"),
                this.containment = [i.left + (parseInt(t(e).css("borderLeftWidth"), 10) || 0) + (parseInt(t(e).css("paddingLeft"), 10) || 0) - this.margins.left, i.top + (parseInt(t(e).css("borderTopWidth"), 10) || 0) + (parseInt(t(e).css("paddingTop"), 10) || 0) - this.margins.top, i.left + (n ? Math.max(e.scrollWidth, e.offsetWidth) : e.offsetWidth) - (parseInt(t(e).css("borderLeftWidth"), 10) || 0) - (parseInt(t(e).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left, i.top + (n ? Math.max(e.scrollHeight, e.offsetHeight) : e.offsetHeight) - (parseInt(t(e).css("borderTopWidth"), 10) || 0) - (parseInt(t(e).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top])
            },
            _convertPositionTo: function(e, i) {
                i || (i = this.position);
                var n = "absolute" === e ? 1 : -1
                  , r = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent
                  , a = /(html|body)/i.test(r[0].tagName);
                return {
                    top: i.top + this.offset.relative.top * n + this.offset.parent.top * n - ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : a ? 0 : r.scrollTop()) * n,
                    left: i.left + this.offset.relative.left * n + this.offset.parent.left * n - ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : a ? 0 : r.scrollLeft()) * n
                }
            },
            _generatePosition: function(e) {
                var i, n, r = this.options, a = e.pageX, s = e.pageY, o = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent, u = /(html|body)/i.test(o[0].tagName);
                return "relative" !== this.cssPosition || this.scrollParent[0] !== document && this.scrollParent[0] !== this.offsetParent[0] || (this.offset.relative = this._getRelativeOffset()),
                this.originalPosition && (this.containment && (e.pageX - this.offset.click.left < this.containment[0] && (a = this.containment[0] + this.offset.click.left),
                e.pageY - this.offset.click.top < this.containment[1] && (s = this.containment[1] + this.offset.click.top),
                e.pageX - this.offset.click.left > this.containment[2] && (a = this.containment[2] + this.offset.click.left),
                e.pageY - this.offset.click.top > this.containment[3] && (s = this.containment[3] + this.offset.click.top)),
                r.grid && (i = this.originalPageY + Math.round((s - this.originalPageY) / r.grid[1]) * r.grid[1],
                s = this.containment ? i - this.offset.click.top >= this.containment[1] && i - this.offset.click.top <= this.containment[3] ? i : i - this.offset.click.top >= this.containment[1] ? i - r.grid[1] : i + r.grid[1] : i,
                n = this.originalPageX + Math.round((a - this.originalPageX) / r.grid[0]) * r.grid[0],
                a = this.containment ? n - this.offset.click.left >= this.containment[0] && n - this.offset.click.left <= this.containment[2] ? n : n - this.offset.click.left >= this.containment[0] ? n - r.grid[0] : n + r.grid[0] : n)),
                {
                    top: s - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : u ? 0 : o.scrollTop()),
                    left: a - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : u ? 0 : o.scrollLeft())
                }
            },
            _rearrange: function(t, e, i, n) {
                i ? i[0].appendChild(this.placeholder[0]) : e.item[0].parentNode.insertBefore(this.placeholder[0], "down" === this.direction ? e.item[0] : e.item[0].nextSibling),
                this.counter = this.counter ? ++this.counter : 1;
                var r = this.counter;
                this._delay(function() {
                    r === this.counter && this.refreshPositions(!n)
                })
            },
            _clear: function(t, e) {
                this.reverting = !1;
                var i, n = [];
                if (!this._noFinalSort && this.currentItem.parent().length && this.placeholder.before(this.currentItem),
                this._noFinalSort = null,
                this.helper[0] === this.currentItem[0]) {
                    for (i in this._storedCSS)
                        "auto" !== this._storedCSS[i] && "static" !== this._storedCSS[i] || (this._storedCSS[i] = "");
                    this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")
                } else
                    this.currentItem.show();
                for (this.fromOutside && !e && n.push(function(t) {
                    this._trigger("receive", t, this._uiHash(this.fromOutside))
                }),
                !this.fromOutside && this.domPosition.prev === this.currentItem.prev().not(".ui-sortable-helper")[0] && this.domPosition.parent === this.currentItem.parent()[0] || e || n.push(function(t) {
                    this._trigger("update", t, this._uiHash())
                }),
                this !== this.currentContainer && (e || (n.push(function(t) {
                    this._trigger("remove", t, this._uiHash())
                }),
                n.push(function(t) {
                    return function(e) {
                        t._trigger("receive", e, this._uiHash(this))
                    }
                }
                .call(this, this.currentContainer)),
                n.push(function(t) {
                    return function(e) {
                        t._trigger("update", e, this._uiHash(this))
                    }
                }
                .call(this, this.currentContainer)))),
                i = this.containers.length - 1; i >= 0; i--)
                    e || n.push(function(t) {
                        return function(e) {
                            t._trigger("deactivate", e, this._uiHash(this))
                        }
                    }
                    .call(this, this.containers[i])),
                    this.containers[i].containerCache.over && (n.push(function(t) {
                        return function(e) {
                            t._trigger("out", e, this._uiHash(this))
                        }
                    }
                    .call(this, this.containers[i])),
                    this.containers[i].containerCache.over = 0);
                if (this.storedCursor && (this.document.find("body").css("cursor", this.storedCursor),
                this.storedStylesheet.remove()),
                this._storedOpacity && this.helper.css("opacity", this._storedOpacity),
                this._storedZIndex && this.helper.css("zIndex", "auto" === this._storedZIndex ? "" : this._storedZIndex),
                this.dragging = !1,
                this.cancelHelperRemoval) {
                    if (!e) {
                        for (this._trigger("beforeStop", t, this._uiHash()),
                        i = 0; i < n.length; i++)
                            n[i].call(this, t);
                        this._trigger("stop", t, this._uiHash())
                    }
                    return this.fromOutside = !1,
                    !1
                }
                if (e || this._trigger("beforeStop", t, this._uiHash()),
                this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
                this.helper[0] !== this.currentItem[0] && this.helper.remove(),
                this.helper = null,
                !e) {
                    for (i = 0; i < n.length; i++)
                        n[i].call(this, t);
                    this._trigger("stop", t, this._uiHash())
                }
                return this.fromOutside = !1,
                !0
            },
            _trigger: function() {
                t.Widget.prototype._trigger.apply(this, arguments) === !1 && this.cancel()
            },
            _uiHash: function(e) {
                var i = e || this;
                return {
                    helper: i.helper,
                    placeholder: i.placeholder || t([]),
                    position: i.position,
                    originalPosition: i.originalPosition,
                    offset: i.positionAbs,
                    item: i.currentItem,
                    sender: e ? e.element : null
                }
            }
        })
    }(n),
    function(t, e) {
        var i = "ui-effects-";
        t.effects = {
            effect: {}
        },
        /*!
	 * jQuery Color Animations v2.1.2
	 * https://github.com/jquery/jquery-color
	 *
	 * Copyright 2013 jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 *
	 * Date: Wed Jan 16 08:47:09 2013 -0600
	 */
        function(t, e) {
            function i(t, e, i) {
                var n = h[e.type] || {};
                return null == t ? i || !e.def ? null : e.def : (t = n.floor ? ~~t : parseFloat(t),
                isNaN(t) ? e.def : n.mod ? (t + n.mod) % n.mod : 0 > t ? 0 : n.max < t ? n.max : t)
            }
            function n(e) {
                var i = l()
                  , n = i._rgba = [];
                return e = e.toLowerCase(),
                f(u, function(t, r) {
                    var a, s = r.re.exec(e), o = s && r.parse(s), u = r.space || "rgba";
                    if (o)
                        return a = i[u](o),
                        i[c[u].cache] = a[c[u].cache],
                        n = i._rgba = a._rgba,
                        !1
                }),
                n.length ? ("0,0,0,0" === n.join() && t.extend(n, a.transparent),
                i) : a[e]
            }
            function r(t, e, i) {
                return i = (i + 1) % 1,
                6 * i < 1 ? t + (e - t) * i * 6 : 2 * i < 1 ? e : 3 * i < 2 ? t + (e - t) * (2 / 3 - i) * 6 : t
            }
            var a, s = "backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor", o = /^([\-+])=\s*(\d+\.?\d*)/, u = [{
                re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                parse: function(t) {
                    return [t[1], t[2], t[3], t[4]]
                }
            }, {
                re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                parse: function(t) {
                    return [2.55 * t[1], 2.55 * t[2], 2.55 * t[3], t[4]]
                }
            }, {
                re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,
                parse: function(t) {
                    return [parseInt(t[1], 16), parseInt(t[2], 16), parseInt(t[3], 16)]
                }
            }, {
                re: /#([a-f0-9])([a-f0-9])([a-f0-9])/,
                parse: function(t) {
                    return [parseInt(t[1] + t[1], 16), parseInt(t[2] + t[2], 16), parseInt(t[3] + t[3], 16)]
                }
            }, {
                re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                space: "hsla",
                parse: function(t) {
                    return [t[1], t[2] / 100, t[3] / 100, t[4]]
                }
            }], l = t.Color = function(e, i, n, r) {
                return new t.Color.fn.parse(e,i,n,r)
            }
            , c = {
                rgba: {
                    props: {
                        red: {
                            idx: 0,
                            type: "byte"
                        },
                        green: {
                            idx: 1,
                            type: "byte"
                        },
                        blue: {
                            idx: 2,
                            type: "byte"
                        }
                    }
                },
                hsla: {
                    props: {
                        hue: {
                            idx: 0,
                            type: "degrees"
                        },
                        saturation: {
                            idx: 1,
                            type: "percent"
                        },
                        lightness: {
                            idx: 2,
                            type: "percent"
                        }
                    }
                }
            }, h = {
                "byte": {
                    floor: !0,
                    max: 255
                },
                percent: {
                    max: 1
                },
                degrees: {
                    mod: 360,
                    floor: !0
                }
            }, d = l.support = {}, p = t("<p>")[0], f = t.each;
            p.style.cssText = "background-color:rgba(1,1,1,.5)",
            d.rgba = p.style.backgroundColor.indexOf("rgba") > -1,
            f(c, function(t, e) {
                e.cache = "_" + t,
                e.props.alpha = {
                    idx: 3,
                    type: "percent",
                    def: 1
                }
            }),
            l.fn = t.extend(l.prototype, {
                parse: function(r, s, o, u) {
                    if (r === e)
                        return this._rgba = [null, null, null, null],
                        this;
                    (r.jquery || r.nodeType) && (r = t(r).css(s),
                    s = e);
                    var h = this
                      , d = t.type(r)
                      , p = this._rgba = [];
                    return s !== e && (r = [r, s, o, u],
                    d = "array"),
                    "string" === d ? this.parse(n(r) || a._default) : "array" === d ? (f(c.rgba.props, function(t, e) {
                        p[e.idx] = i(r[e.idx], e)
                    }),
                    this) : "object" === d ? (r instanceof l ? f(c, function(t, e) {
                        r[e.cache] && (h[e.cache] = r[e.cache].slice())
                    }) : f(c, function(e, n) {
                        var a = n.cache;
                        f(n.props, function(t, e) {
                            if (!h[a] && n.to) {
                                if ("alpha" === t || null == r[t])
                                    return;
                                h[a] = n.to(h._rgba)
                            }
                            h[a][e.idx] = i(r[t], e, !0)
                        }),
                        h[a] && t.inArray(null, h[a].slice(0, 3)) < 0 && (h[a][3] = 1,
                        n.from && (h._rgba = n.from(h[a])))
                    }),
                    this) : void 0
                },
                is: function(t) {
                    var e = l(t)
                      , i = !0
                      , n = this;
                    return f(c, function(t, r) {
                        var a, s = e[r.cache];
                        return s && (a = n[r.cache] || r.to && r.to(n._rgba) || [],
                        f(r.props, function(t, e) {
                            if (null != s[e.idx])
                                return i = s[e.idx] === a[e.idx]
                        })),
                        i
                    }),
                    i
                },
                _space: function() {
                    var t = []
                      , e = this;
                    return f(c, function(i, n) {
                        e[n.cache] && t.push(i)
                    }),
                    t.pop()
                },
                transition: function(t, e) {
                    var n = l(t)
                      , r = n._space()
                      , a = c[r]
                      , s = 0 === this.alpha() ? l("transparent") : this
                      , o = s[a.cache] || a.to(s._rgba)
                      , u = o.slice();
                    return n = n[a.cache],
                    f(a.props, function(t, r) {
                        var a = r.idx
                          , s = o[a]
                          , l = n[a]
                          , c = h[r.type] || {};
                        null !== l && (null === s ? u[a] = l : (c.mod && (l - s > c.mod / 2 ? s += c.mod : s - l > c.mod / 2 && (s -= c.mod)),
                        u[a] = i((l - s) * e + s, r)))
                    }),
                    this[r](u)
                },
                blend: function(e) {
                    if (1 === this._rgba[3])
                        return this;
                    var i = this._rgba.slice()
                      , n = i.pop()
                      , r = l(e)._rgba;
                    return l(t.map(i, function(t, e) {
                        return (1 - n) * r[e] + n * t
                    }))
                },
                toRgbaString: function() {
                    var e = "rgba("
                      , i = t.map(this._rgba, function(t, e) {
                        return null == t ? e > 2 ? 1 : 0 : t
                    });
                    return 1 === i[3] && (i.pop(),
                    e = "rgb("),
                    e + i.join() + ")"
                },
                toHslaString: function() {
                    var e = "hsla("
                      , i = t.map(this.hsla(), function(t, e) {
                        return null == t && (t = e > 2 ? 1 : 0),
                        e && e < 3 && (t = Math.round(100 * t) + "%"),
                        t
                    });
                    return 1 === i[3] && (i.pop(),
                    e = "hsl("),
                    e + i.join() + ")"
                },
                toHexString: function(e) {
                    var i = this._rgba.slice()
                      , n = i.pop();
                    return e && i.push(~~(255 * n)),
                    "#" + t.map(i, function(t) {
                        return t = (t || 0).toString(16),
                        1 === t.length ? "0" + t : t
                    }).join("")
                },
                toString: function() {
                    return 0 === this._rgba[3] ? "transparent" : this.toRgbaString()
                }
            }),
            l.fn.parse.prototype = l.fn,
            c.hsla.to = function(t) {
                if (null == t[0] || null == t[1] || null == t[2])
                    return [null, null, null, t[3]];
                var e, i, n = t[0] / 255, r = t[1] / 255, a = t[2] / 255, s = t[3], o = Math.max(n, r, a), u = Math.min(n, r, a), l = o - u, c = o + u, h = .5 * c;
                return e = u === o ? 0 : n === o ? 60 * (r - a) / l + 360 : r === o ? 60 * (a - n) / l + 120 : 60 * (n - r) / l + 240,
                i = 0 === l ? 0 : h <= .5 ? l / c : l / (2 - c),
                [Math.round(e) % 360, i, h, null == s ? 1 : s]
            }
            ,
            c.hsla.from = function(t) {
                if (null == t[0] || null == t[1] || null == t[2])
                    return [null, null, null, t[3]];
                var e = t[0] / 360
                  , i = t[1]
                  , n = t[2]
                  , a = t[3]
                  , s = n <= .5 ? n * (1 + i) : n + i - n * i
                  , o = 2 * n - s;
                return [Math.round(255 * r(o, s, e + 1 / 3)), Math.round(255 * r(o, s, e)), Math.round(255 * r(o, s, e - 1 / 3)), a]
            }
            ,
            f(c, function(n, r) {
                var a = r.props
                  , s = r.cache
                  , u = r.to
                  , c = r.from;
                l.fn[n] = function(n) {
                    if (u && !this[s] && (this[s] = u(this._rgba)),
                    n === e)
                        return this[s].slice();
                    var r, o = t.type(n), h = "array" === o || "object" === o ? n : arguments, d = this[s].slice();
                    return f(a, function(t, e) {
                        var n = h["object" === o ? t : e.idx];
                        null == n && (n = d[e.idx]),
                        d[e.idx] = i(n, e)
                    }),
                    c ? (r = l(c(d)),
                    r[s] = d,
                    r) : l(d)
                }
                ,
                f(a, function(e, i) {
                    l.fn[e] || (l.fn[e] = function(r) {
                        var a, s = t.type(r), u = "alpha" === e ? this._hsla ? "hsla" : "rgba" : n, l = this[u](), c = l[i.idx];
                        return "undefined" === s ? c : ("function" === s && (r = r.call(this, c),
                        s = t.type(r)),
                        null == r && i.empty ? this : ("string" === s && (a = o.exec(r),
                        a && (r = c + parseFloat(a[2]) * ("+" === a[1] ? 1 : -1))),
                        l[i.idx] = r,
                        this[u](l)))
                    }
                    )
                })
            }),
            l.hook = function(e) {
                var i = e.split(" ");
                f(i, function(e, i) {
                    t.cssHooks[i] = {
                        set: function(e, r) {
                            var a, s, o = "";
                            if ("transparent" !== r && ("string" !== t.type(r) || (a = n(r)))) {
                                if (r = l(a || r),
                                !d.rgba && 1 !== r._rgba[3]) {
                                    for (s = "backgroundColor" === i ? e.parentNode : e; ("" === o || "transparent" === o) && s && s.style; )
                                        try {
                                            o = t.css(s, "backgroundColor"),
                                            s = s.parentNode
                                        } catch (u) {}
                                    r = r.blend(o && "transparent" !== o ? o : "_default")
                                }
                                r = r.toRgbaString()
                            }
                            try {
                                e.style[i] = r
                            } catch (u) {}
                        }
                    },
                    t.fx.step[i] = function(e) {
                        e.colorInit || (e.start = l(e.elem, i),
                        e.end = l(e.end),
                        e.colorInit = !0),
                        t.cssHooks[i].set(e.elem, e.start.transition(e.end, e.pos))
                    }
                })
            }
            ,
            l.hook(s),
            t.cssHooks.borderColor = {
                expand: function(t) {
                    var e = {};
                    return f(["Top", "Right", "Bottom", "Left"], function(i, n) {
                        e["border" + n + "Color"] = t
                    }),
                    e
                }
            },
            a = t.Color.names = {
                aqua: "#00ffff",
                black: "#000000",
                blue: "#0000ff",
                fuchsia: "#ff00ff",
                gray: "#808080",
                green: "#008000",
                lime: "#00ff00",
                maroon: "#800000",
                navy: "#000080",
                olive: "#808000",
                purple: "#800080",
                red: "#ff0000",
                silver: "#c0c0c0",
                teal: "#008080",
                white: "#ffffff",
                yellow: "#ffff00",
                transparent: [null, null, null, 0],
                _default: "#ffffff"
            }
        }(n),
        function() {
            function i(e) {
                var i, n, r = e.ownerDocument.defaultView ? e.ownerDocument.defaultView.getComputedStyle(e, null) : e.currentStyle, a = {};
                if (r && r.length && r[0] && r[r[0]])
                    for (n = r.length; n--; )
                        i = r[n],
                        "string" == typeof r[i] && (a[t.camelCase(i)] = r[i]);
                else
                    for (i in r)
                        "string" == typeof r[i] && (a[i] = r[i]);
                return a
            }
            function r(e, i) {
                var n, r, a = {};
                for (n in i)
                    r = i[n],
                    e[n] !== r && (s[n] || !t.fx.step[n] && isNaN(parseFloat(r)) || (a[n] = r));
                return a
            }
            var a = ["add", "remove", "toggle"]
              , s = {
                border: 1,
                borderBottom: 1,
                borderColor: 1,
                borderLeft: 1,
                borderRight: 1,
                borderTop: 1,
                borderWidth: 1,
                margin: 1,
                padding: 1
            };
            t.each(["borderLeftStyle", "borderRightStyle", "borderBottomStyle", "borderTopStyle"], function(e, i) {
                t.fx.step[i] = function(t) {
                    ("none" !== t.end && !t.setAttr || 1 === t.pos && !t.setAttr) && (n.style(t.elem, i, t.end),
                    t.setAttr = !0)
                }
            }),
            t.fn.addBack || (t.fn.addBack = function(t) {
                return this.add(null == t ? this.prevObject : this.prevObject.filter(t))
            }
            ),
            t.effects.animateClass = function(e, n, s, o) {
                var u = t.speed(n, s, o);
                return this.queue(function() {
                    var n, s = t(this), o = s.attr("class") || "", l = u.children ? s.find("*").addBack() : s;
                    l = l.map(function() {
                        var e = t(this);
                        return {
                            el: e,
                            start: i(this)
                        }
                    }),
                    n = function() {
                        t.each(a, function(t, i) {
                            e[i] && s[i + "Class"](e[i])
                        })
                    }
                    ,
                    n(),
                    l = l.map(function() {
                        return this.end = i(this.el[0]),
                        this.diff = r(this.start, this.end),
                        this
                    }),
                    s.attr("class", o),
                    l = l.map(function() {
                        var e = this
                          , i = t.Deferred()
                          , n = t.extend({}, u, {
                            queue: !1,
                            complete: function() {
                                i.resolve(e)
                            }
                        });
                        return this.el.animate(this.diff, n),
                        i.promise()
                    }),
                    t.when.apply(t, l.get()).done(function() {
                        n(),
                        t.each(arguments, function() {
                            var e = this.el;
                            t.each(this.diff, function(t) {
                                e.css(t, "")
                            })
                        }),
                        u.complete.call(s[0])
                    })
                })
            }
            ,
            t.fn.extend({
                addClass: function(e) {
                    return function(i, n, r, a) {
                        return n ? t.effects.animateClass.call(this, {
                            add: i
                        }, n, r, a) : e.apply(this, arguments)
                    }
                }(t.fn.addClass),
                removeClass: function(e) {
                    return function(i, n, r, a) {
                        return arguments.length > 1 ? t.effects.animateClass.call(this, {
                            remove: i
                        }, n, r, a) : e.apply(this, arguments)
                    }
                }(t.fn.removeClass),
                toggleClass: function(i) {
                    return function(n, r, a, s, o) {
                        return "boolean" == typeof r || r === e ? a ? t.effects.animateClass.call(this, r ? {
                            add: n
                        } : {
                            remove: n
                        }, a, s, o) : i.apply(this, arguments) : t.effects.animateClass.call(this, {
                            toggle: n
                        }, r, a, s)
                    }
                }(t.fn.toggleClass),
                switchClass: function(e, i, n, r, a) {
                    return t.effects.animateClass.call(this, {
                        add: i,
                        remove: e
                    }, n, r, a)
                }
            })
        }(),
        function() {
            function n(e, i, n, r) {
                return t.isPlainObject(e) && (i = e,
                e = e.effect),
                e = {
                    effect: e
                },
                null == i && (i = {}),
                t.isFunction(i) && (r = i,
                n = null,
                i = {}),
                ("number" == typeof i || t.fx.speeds[i]) && (r = n,
                n = i,
                i = {}),
                t.isFunction(n) && (r = n,
                n = null),
                i && t.extend(e, i),
                n = n || i.duration,
                e.duration = t.fx.off ? 0 : "number" == typeof n ? n : n in t.fx.speeds ? t.fx.speeds[n] : t.fx.speeds._default,
                e.complete = r || i.complete,
                e
            }
            function r(e) {
                return !(e && "number" != typeof e && !t.fx.speeds[e]) || ("string" == typeof e && !t.effects.effect[e] || (!!t.isFunction(e) || "object" == typeof e && !e.effect))
            }
            t.extend(t.effects, {
                version: "1.10.3",
                save: function(t, e) {
                    for (var n = 0; n < e.length; n++)
                        null !== e[n] && t.data(i + e[n], t[0].style[e[n]])
                },
                restore: function(t, n) {
                    var r, a;
                    for (a = 0; a < n.length; a++)
                        null !== n[a] && (r = t.data(i + n[a]),
                        r === e && (r = ""),
                        t.css(n[a], r))
                },
                setMode: function(t, e) {
                    return "toggle" === e && (e = t.is(":hidden") ? "show" : "hide"),
                    e
                },
                getBaseline: function(t, e) {
                    var i, n;
                    switch (t[0]) {
                    case "top":
                        i = 0;
                        break;
                    case "middle":
                        i = .5;
                        break;
                    case "bottom":
                        i = 1;
                        break;
                    default:
                        i = t[0] / e.height
                    }
                    switch (t[1]) {
                    case "left":
                        n = 0;
                        break;
                    case "center":
                        n = .5;
                        break;
                    case "right":
                        n = 1;
                        break;
                    default:
                        n = t[1] / e.width
                    }
                    return {
                        x: n,
                        y: i
                    }
                },
                createWrapper: function(e) {
                    if (e.parent().is(".ui-effects-wrapper"))
                        return e.parent();
                    var i = {
                        width: e.outerWidth(!0),
                        height: e.outerHeight(!0),
                        "float": e.css("float")
                    }
                      , n = t("<div></div>").addClass("ui-effects-wrapper").css({
                        fontSize: "100%",
                        background: "transparent",
                        border: "none",
                        margin: 0,
                        padding: 0
                    })
                      , r = {
                        width: e.width(),
                        height: e.height()
                    }
                      , a = document.activeElement;
                    try {
                        a.id
                    } catch (s) {
                        a = document.body
                    }
                    return e.wrap(n),
                    (e[0] === a || t.contains(e[0], a)) && t(a).focus(),
                    n = e.parent(),
                    "static" === e.css("position") ? (n.css({
                        position: "relative"
                    }),
                    e.css({
                        position: "relative"
                    })) : (t.extend(i, {
                        position: e.css("position"),
                        zIndex: e.css("z-index")
                    }),
                    t.each(["top", "left", "bottom", "right"], function(t, n) {
                        i[n] = e.css(n),
                        isNaN(parseInt(i[n], 10)) && (i[n] = "auto")
                    }),
                    e.css({
                        position: "relative",
                        top: 0,
                        left: 0,
                        right: "auto",
                        bottom: "auto"
                    })),
                    e.css(r),
                    n.css(i).show()
                },
                removeWrapper: function(e) {
                    var i = document.activeElement;
                    return e.parent().is(".ui-effects-wrapper") && (e.parent().replaceWith(e),
                    (e[0] === i || t.contains(e[0], i)) && t(i).focus()),
                    e
                },
                setTransition: function(e, i, n, r) {
                    return r = r || {},
                    t.each(i, function(t, i) {
                        var a = e.cssUnit(i);
                        a[0] > 0 && (r[i] = a[0] * n + a[1])
                    }),
                    r
                }
            }),
            t.fn.extend({
                effect: function() {
                    function e(e) {
                        function n() {
                            t.isFunction(a) && a.call(r[0]),
                            t.isFunction(e) && e()
                        }
                        var r = t(this)
                          , a = i.complete
                          , o = i.mode;
                        (r.is(":hidden") ? "hide" === o : "show" === o) ? (r[o](),
                        n()) : s.call(r[0], i, n)
                    }
                    var i = n.apply(this, arguments)
                      , r = i.mode
                      , a = i.queue
                      , s = t.effects.effect[i.effect];
                    return t.fx.off || !s ? r ? this[r](i.duration, i.complete) : this.each(function() {
                        i.complete && i.complete.call(this)
                    }) : a === !1 ? this.each(e) : this.queue(a || "fx", e)
                },
                show: function(t) {
                    return function(e) {
                        if (r(e))
                            return t.apply(this, arguments);
                        var i = n.apply(this, arguments);
                        return i.mode = "show",
                        this.effect.call(this, i)
                    }
                }(t.fn.show),
                hide: function(t) {
                    return function(e) {
                        if (r(e))
                            return t.apply(this, arguments);
                        var i = n.apply(this, arguments);
                        return i.mode = "hide",
                        this.effect.call(this, i)
                    }
                }(t.fn.hide),
                toggle: function(t) {
                    return function(e) {
                        if (r(e) || "boolean" == typeof e)
                            return t.apply(this, arguments);
                        var i = n.apply(this, arguments);
                        return i.mode = "toggle",
                        this.effect.call(this, i)
                    }
                }(t.fn.toggle),
                cssUnit: function(e) {
                    var i = this.css(e)
                      , n = [];
                    return t.each(["em", "px", "%", "pt"], function(t, e) {
                        i.indexOf(e) > 0 && (n = [parseFloat(i), e])
                    }),
                    n
                }
            })
        }(),
        function() {
            var e = {};
            t.each(["Quad", "Cubic", "Quart", "Quint", "Expo"], function(t, i) {
                e[i] = function(e) {
                    return Math.pow(e, t + 2)
                }
            }),
            t.extend(e, {
                Sine: function(t) {
                    return 1 - Math.cos(t * Math.PI / 2)
                },
                Circ: function(t) {
                    return 1 - Math.sqrt(1 - t * t)
                },
                Elastic: function(t) {
                    return 0 === t || 1 === t ? t : -Math.pow(2, 8 * (t - 1)) * Math.sin((80 * (t - 1) - 7.5) * Math.PI / 15)
                },
                Back: function(t) {
                    return t * t * (3 * t - 2)
                },
                Bounce: function(t) {
                    for (var e, i = 4; t < ((e = Math.pow(2, --i)) - 1) / 11; )
                        ;
                    return 1 / Math.pow(4, 3 - i) - 7.5625 * Math.pow((3 * e - 2) / 22 - t, 2)
                }
            }),
            t.each(e, function(e, i) {
                t.easing["easeIn" + e] = i,
                t.easing["easeOut" + e] = function(t) {
                    return 1 - i(1 - t)
                }
                ,
                t.easing["easeInOut" + e] = function(t) {
                    return t < .5 ? i(2 * t) / 2 : 1 - i(t * -2 + 2) / 2
                }
            })
        }()
    }(n),
    function(t, e) {
        var i = 0
          , n = {}
          , r = {};
        n.height = n.paddingTop = n.paddingBottom = n.borderTopWidth = n.borderBottomWidth = "hide",
        r.height = r.paddingTop = r.paddingBottom = r.borderTopWidth = r.borderBottomWidth = "show",
        t.widget("ui.accordion", {
            version: "1.10.3",
            options: {
                active: 0,
                animate: {},
                collapsible: !1,
                event: "click",
                header: "> li > :first-child,> :not(li):even",
                heightStyle: "auto",
                icons: {
                    activeHeader: "ui-icon-triangle-1-s",
                    header: "ui-icon-triangle-1-e"
                },
                activate: null,
                beforeActivate: null
            },
            _create: function() {
                var e = this.options;
                this.prevShow = this.prevHide = t(),
                this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role", "tablist"),
                e.collapsible || e.active !== !1 && null != e.active || (e.active = 0),
                this._processPanels(),
                e.active < 0 && (e.active += this.headers.length),
                this._refresh()
            },
            _getCreateEventData: function() {
                return {
                    header: this.active,
                    panel: this.active.length ? this.active.next() : t(),
                    content: this.active.length ? this.active.next() : t()
                }
            },
            _createIcons: function() {
                var e = this.options.icons;
                e && (t("<span>").addClass("ui-accordion-header-icon ui-icon " + e.header).prependTo(this.headers),
                this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),
                this.headers.addClass("ui-accordion-icons"))
            },
            _destroyIcons: function() {
                this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()
            },
            _destroy: function() {
                var t;
                this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),
                this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function() {
                    /^ui-accordion/.test(this.id) && this.removeAttribute("id")
                }),
                this._destroyIcons(),
                t = this.headers.next().css("display", "").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function() {
                    /^ui-accordion/.test(this.id) && this.removeAttribute("id")
                }),
                "content" !== this.options.heightStyle && t.css("height", "")
            },
            _setOption: function(t, e) {
                return "active" === t ? void this._activate(e) : ("event" === t && (this.options.event && this._off(this.headers, this.options.event),
                this._setupEvents(e)),
                this._super(t, e),
                "collapsible" !== t || e || this.options.active !== !1 || this._activate(0),
                "icons" === t && (this._destroyIcons(),
                e && this._createIcons()),
                void ("disabled" === t && this.headers.add(this.headers.next()).toggleClass("ui-state-disabled", !!e)))
            },
            _keydown: function(e) {
                if (!e.altKey && !e.ctrlKey) {
                    var i = t.ui.keyCode
                      , n = this.headers.length
                      , r = this.headers.index(e.target)
                      , a = !1;
                    switch (e.keyCode) {
                    case i.RIGHT:
                    case i.DOWN:
                        a = this.headers[(r + 1) % n];
                        break;
                    case i.LEFT:
                    case i.UP:
                        a = this.headers[(r - 1 + n) % n];
                        break;
                    case i.SPACE:
                    case i.ENTER:
                        this._eventHandler(e);
                        break;
                    case i.HOME:
                        a = this.headers[0];
                        break;
                    case i.END:
                        a = this.headers[n - 1]
                    }
                    a && (t(e.target).attr("tabIndex", -1),
                    t(a).attr("tabIndex", 0),
                    a.focus(),
                    e.preventDefault())
                }
            },
            _panelKeyDown: function(e) {
                e.keyCode === t.ui.keyCode.UP && e.ctrlKey && t(e.currentTarget).prev().focus()
            },
            refresh: function() {
                var e = this.options;
                this._processPanels(),
                e.active === !1 && e.collapsible === !0 || !this.headers.length ? (e.active = !1,
                this.active = t()) : e.active === !1 ? this._activate(0) : this.active.length && !t.contains(this.element[0], this.active[0]) ? this.headers.length === this.headers.find(".ui-state-disabled").length ? (e.active = !1,
                this.active = t()) : this._activate(Math.max(0, e.active - 1)) : e.active = this.headers.index(this.active),
                this._destroyIcons(),
                this._refresh()
            },
            _processPanels: function() {
                this.headers = this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),
                this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()
            },
            _refresh: function() {
                var e, n = this.options, r = n.heightStyle, a = this.element.parent(), s = this.accordionId = "ui-accordion-" + (this.element.attr("id") || ++i);
                this.active = this._findActive(n.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),
                this.active.next().addClass("ui-accordion-content-active").show(),
                this.headers.attr("role", "tab").each(function(e) {
                    var i = t(this)
                      , n = i.attr("id")
                      , r = i.next()
                      , a = r.attr("id");
                    n || (n = s + "-header-" + e,
                    i.attr("id", n)),
                    a || (a = s + "-panel-" + e,
                    r.attr("id", a)),
                    i.attr("aria-controls", a),
                    r.attr("aria-labelledby", n)
                }).next().attr("role", "tabpanel"),
                this.headers.not(this.active).attr({
                    "aria-selected": "false",
                    tabIndex: -1
                }).next().attr({
                    "aria-expanded": "false",
                    "aria-hidden": "true"
                }).hide(),
                this.active.length ? this.active.attr({
                    "aria-selected": "true",
                    tabIndex: 0
                }).next().attr({
                    "aria-expanded": "true",
                    "aria-hidden": "false"
                }) : this.headers.eq(0).attr("tabIndex", 0),
                this._createIcons(),
                this._setupEvents(n.event),
                "fill" === r ? (e = a.height(),
                this.element.siblings(":visible").each(function() {
                    var i = t(this)
                      , n = i.css("position");
                    "absolute" !== n && "fixed" !== n && (e -= i.outerHeight(!0))
                }),
                this.headers.each(function() {
                    e -= t(this).outerHeight(!0)
                }),
                this.headers.next().each(function() {
                    t(this).height(Math.max(0, e - t(this).innerHeight() + t(this).height()))
                }).css("overflow", "auto")) : "auto" === r && (e = 0,
                this.headers.next().each(function() {
                    e = Math.max(e, t(this).css("height", "").height())
                }).height(e))
            },
            _activate: function(e) {
                var i = this._findActive(e)[0];
                i !== this.active[0] && (i = i || this.active[0],
                this._eventHandler({
                    target: i,
                    currentTarget: i,
                    preventDefault: t.noop
                }))
            },
            _findActive: function(e) {
                return "number" == typeof e ? this.headers.eq(e) : t()
            },
            _setupEvents: function(e) {
                var i = {
                    keydown: "_keydown"
                };
                e && t.each(e.split(" "), function(t, e) {
                    i[e] = "_eventHandler"
                }),
                this._off(this.headers.add(this.headers.next())),
                this._on(this.headers, i),
                this._on(this.headers.next(), {
                    keydown: "_panelKeyDown"
                }),
                this._hoverable(this.headers),
                this._focusable(this.headers)
            },
            _eventHandler: function(e) {
                var i = this.options
                  , n = this.active
                  , r = t(e.currentTarget)
                  , a = r[0] === n[0]
                  , s = a && i.collapsible
                  , o = s ? t() : r.next()
                  , u = n.next()
                  , l = {
                    oldHeader: n,
                    oldPanel: u,
                    newHeader: s ? t() : r,
                    newPanel: o
                };
                e.preventDefault(),
                a && !i.collapsible || this._trigger("beforeActivate", e, l) === !1 || (i.active = !s && this.headers.index(r),
                this.active = a ? t() : r,
                this._toggle(l),
                n.removeClass("ui-accordion-header-active ui-state-active"),
                i.icons && n.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),
                a || (r.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),
                i.icons && r.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),
                r.next().addClass("ui-accordion-content-active")))
            },
            _toggle: function(e) {
                var i = e.newPanel
                  , n = this.prevShow.length ? this.prevShow : e.oldPanel;
                this.prevShow.add(this.prevHide).stop(!0, !0),
                this.prevShow = i,
                this.prevHide = n,
                this.options.animate ? this._animate(i, n, e) : (n.hide(),
                i.show(),
                this._toggleComplete(e)),
                n.attr({
                    "aria-expanded": "false",
                    "aria-hidden": "true"
                }),
                n.prev().attr("aria-selected", "false"),
                i.length && n.length ? n.prev().attr("tabIndex", -1) : i.length && this.headers.filter(function() {
                    return 0 === t(this).attr("tabIndex")
                }).attr("tabIndex", -1),
                i.attr({
                    "aria-expanded": "true",
                    "aria-hidden": "false"
                }).prev().attr({
                    "aria-selected": "true",
                    tabIndex: 0
                })
            },
            _animate: function(t, e, i) {
                var a, s, o, u = this, l = 0, c = t.length && (!e.length || t.index() < e.index()), h = this.options.animate || {}, d = c && h.down || h, p = function() {
                    u._toggleComplete(i)
                };
                return "number" == typeof d && (o = d),
                "string" == typeof d && (s = d),
                s = s || d.easing || h.easing,
                o = o || d.duration || h.duration,
                e.length ? t.length ? (a = t.show().outerHeight(),
                e.animate(n, {
                    duration: o,
                    easing: s,
                    step: function(t, e) {
                        e.now = Math.round(t)
                    }
                }),
                void t.hide().animate(r, {
                    duration: o,
                    easing: s,
                    complete: p,
                    step: function(t, i) {
                        i.now = Math.round(t),
                        "height" !== i.prop ? l += i.now : "content" !== u.options.heightStyle && (i.now = Math.round(a - e.outerHeight() - l),
                        l = 0)
                    }
                })) : e.animate(n, o, s, p) : t.animate(r, o, s, p)
            },
            _toggleComplete: function(t) {
                var e = t.oldPanel;
                e.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),
                e.length && (e.parent()[0].className = e.parent()[0].className),
                this._trigger("activate", null, t)
            }
        })
    }(n),
    function(t, e) {
        var i = 0;
        t.widget("ui.autocomplete", {
            version: "1.10.3",
            defaultElement: "<input>",
            options: {
                appendTo: null,
                autoFocus: !1,
                delay: 300,
                minLength: 1,
                position: {
                    my: "left top",
                    at: "left bottom",
                    collision: "none"
                },
                source: null,
                change: null,
                close: null,
                focus: null,
                open: null,
                response: null,
                search: null,
                select: null
            },
            pending: 0,
            _create: function() {
                var e, i, n, r = this.element[0].nodeName.toLowerCase(), a = "textarea" === r, s = "input" === r;
                this.isMultiLine = !!a || !s && this.element.prop("isContentEditable"),
                this.valueMethod = this.element[a || s ? "val" : "text"],
                this.isNewMenu = !0,
                this.element.addClass("ui-autocomplete-input").attr("autocomplete", "off"),
                this._on(this.element, {
                    keydown: function(r) {
                        if (this.element.prop("readOnly"))
                            return e = !0,
                            n = !0,
                            void (i = !0);
                        e = !1,
                        n = !1,
                        i = !1;
                        var a = t.ui.keyCode;
                        switch (r.keyCode) {
                        case a.PAGE_UP:
                            e = !0,
                            this._move("previousPage", r);
                            break;
                        case a.PAGE_DOWN:
                            e = !0,
                            this._move("nextPage", r);
                            break;
                        case a.UP:
                            e = !0,
                            this._keyEvent("previous", r);
                            break;
                        case a.DOWN:
                            e = !0,
                            this._keyEvent("next", r);
                            break;
                        case a.ENTER:
                        case a.NUMPAD_ENTER:
                            this.menu.active && (e = !0,
                            r.preventDefault(),
                            this.menu.select(r));
                            break;
                        case a.TAB:
                            this.menu.active && this.menu.select(r);
                            break;
                        case a.ESCAPE:
                            this.menu.element.is(":visible") && (this._value(this.term),
                            this.close(r),
                            r.preventDefault());
                            break;
                        default:
                            i = !0,
                            this._searchTimeout(r)
                        }
                    },
                    keypress: function(n) {
                        if (e)
                            return e = !1,
                            void (this.isMultiLine && !this.menu.element.is(":visible") || n.preventDefault());
                        if (!i) {
                            var r = t.ui.keyCode;
                            switch (n.keyCode) {
                            case r.PAGE_UP:
                                this._move("previousPage", n);
                                break;
                            case r.PAGE_DOWN:
                                this._move("nextPage", n);
                                break;
                            case r.UP:
                                this._keyEvent("previous", n);
                                break;
                            case r.DOWN:
                                this._keyEvent("next", n)
                            }
                        }
                    },
                    input: function(t) {
                        return n ? (n = !1,
                        void t.preventDefault()) : void this._searchTimeout(t)
                    },
                    focus: function() {
                        this.selectedItem = null,
                        this.previous = this._value()
                    },
                    blur: function(t) {
                        return this.cancelBlur ? void delete this.cancelBlur : (clearTimeout(this.searching),
                        this.close(t),
                        void this._change(t))
                    }
                }),
                this._initSource(),
                this.menu = t("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({
                    role: null
                }).hide().data("ui-menu"),
                this._on(this.menu.element, {
                    mousedown: function(e) {
                        e.preventDefault(),
                        this.cancelBlur = !0,
                        this._delay(function() {
                            delete this.cancelBlur
                        });
                        var i = this.menu.element[0];
                        t(e.target).closest(".ui-menu-item").length || this._delay(function() {
                            var e = this;
                            this.document.one("mousedown", function(n) {
                                n.target === e.element[0] || n.target === i || t.contains(i, n.target) || e.close()
                            })
                        })
                    },
                    menufocus: function(e, i) {
                        if (this.isNewMenu && (this.isNewMenu = !1,
                        e.originalEvent && /^mouse/.test(e.originalEvent.type)))
                            return this.menu.blur(),
                            void this.document.one("mousemove", function() {
                                t(e.target).trigger(e.originalEvent)
                            });
                        var n = i.item.data("ui-autocomplete-item");
                        !1 !== this._trigger("focus", e, {
                            item: n
                        }) ? e.originalEvent && /^key/.test(e.originalEvent.type) && this._value(n.value) : this.liveRegion.text(n.value)
                    },
                    menuselect: function(t, e) {
                        var i = e.item.data("ui-autocomplete-item")
                          , n = this.previous;
                        this.element[0] !== this.document[0].activeElement && (this.element.focus(),
                        this.previous = n,
                        this._delay(function() {
                            this.previous = n,
                            this.selectedItem = i
                        })),
                        !1 !== this._trigger("select", t, {
                            item: i
                        }) && this._value(i.value),
                        this.term = this._value(),
                        this.close(t),
                        this.selectedItem = i
                    }
                }),
                this.liveRegion = t("<span>", {
                    role: "status",
                    "aria-live": "polite"
                }).addClass("ui-helper-hidden-accessible").insertBefore(this.element),
                this._on(this.window, {
                    beforeunload: function() {
                        this.element.removeAttr("autocomplete")
                    }
                })
            },
            _destroy: function() {
                clearTimeout(this.searching),
                this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),
                this.menu.element.remove(),
                this.liveRegion.remove()
            },
            _setOption: function(t, e) {
                this._super(t, e),
                "source" === t && this._initSource(),
                "appendTo" === t && this.menu.element.appendTo(this._appendTo()),
                "disabled" === t && e && this.xhr && this.xhr.abort()
            },
            _appendTo: function() {
                var e = this.options.appendTo;
                return e && (e = e.jquery || e.nodeType ? t(e) : this.document.find(e).eq(0)),
                e || (e = this.element.closest(".ui-front")),
                e.length || (e = this.document[0].body),
                e
            },
            _initSource: function() {
                var e, i, n = this;
                t.isArray(this.options.source) ? (e = this.options.source,
                this.source = function(i, n) {
                    n(t.ui.autocomplete.filter(e, i.term))
                }
                ) : "string" == typeof this.options.source ? (i = this.options.source,
                this.source = function(e, r) {
                    n.xhr && n.xhr.abort(),
                    n.xhr = t.ajax({
                        url: i,
                        data: e,
                        dataType: "json",
                        success: function(t) {
                            r(t)
                        },
                        error: function() {
                            r([])
                        }
                    })
                }
                ) : this.source = this.options.source
            },
            _searchTimeout: function(t) {
                clearTimeout(this.searching),
                this.searching = this._delay(function() {
                    this.term !== this._value() && (this.selectedItem = null,
                    this.search(null, t))
                }, this.options.delay)
            },
            search: function(t, e) {
                return t = null != t ? t : this._value(),
                this.term = this._value(),
                t.length < this.options.minLength ? this.close(e) : this._trigger("search", e) !== !1 ? this._search(t) : void 0
            },
            _search: function(t) {
                this.pending++,
                this.element.addClass("ui-autocomplete-loading"),
                this.cancelSearch = !1,
                this.source({
                    term: t
                }, this._response())
            },
            _response: function() {
                var t = this
                  , e = ++i;
                return function(n) {
                    e === i && t.__response(n),
                    t.pending--,
                    t.pending || t.element.removeClass("ui-autocomplete-loading")
                }
            },
            __response: function(t) {
                t && (t = this._normalize(t)),
                this._trigger("response", null, {
                    content: t
                }),
                !this.options.disabled && t && t.length && !this.cancelSearch ? (this._suggest(t),
                this._trigger("open")) : this._close()
            },
            close: function(t) {
                this.cancelSearch = !0,
                this._close(t)
            },
            _close: function(t) {
                this.menu.element.is(":visible") && (this.menu.element.hide(),
                this.menu.blur(),
                this.isNewMenu = !0,
                this._trigger("close", t))
            },
            _change: function(t) {
                this.previous !== this._value() && this._trigger("change", t, {
                    item: this.selectedItem
                })
            },
            _normalize: function(e) {
                return e.length && e[0].label && e[0].value ? e : t.map(e, function(e) {
                    return "string" == typeof e ? {
                        label: e,
                        value: e
                    } : t.extend({
                        label: e.label || e.value,
                        value: e.value || e.label
                    }, e)
                })
            },
            _suggest: function(e) {
                var i = this.menu.element.empty();
                this._renderMenu(i, e),
                this.isNewMenu = !0,
                this.menu.refresh(),
                i.show(),
                this._resizeMenu(),
                i.position(t.extend({
                    of: this.element
                }, this.options.position)),
                this.options.autoFocus && this.menu.next()
            },
            _resizeMenu: function() {
                var t = this.menu.element;
                t.outerWidth(Math.max(t.width("").outerWidth() + 1, this.element.outerWidth()))
            },
            _renderMenu: function(e, i) {
                var n = this;
                t.each(i, function(t, i) {
                    n._renderItemData(e, i)
                })
            },
            _renderItemData: function(t, e) {
                return this._renderItem(t, e).data("ui-autocomplete-item", e)
            },
            _renderItem: function(e, i) {
                return t("<li>").append(t("<a>").text(i.label)).appendTo(e)
            },
            _move: function(t, e) {
                return this.menu.element.is(":visible") ? this.menu.isFirstItem() && /^previous/.test(t) || this.menu.isLastItem() && /^next/.test(t) ? (this._value(this.term),
                void this.menu.blur()) : void this.menu[t](e) : void this.search(null, e)
            },
            widget: function() {
                return this.menu.element
            },
            _value: function() {
                return this.valueMethod.apply(this.element, arguments)
            },
            _keyEvent: function(t, e) {
                this.isMultiLine && !this.menu.element.is(":visible") || (this._move(t, e),
                e.preventDefault())
            }
        }),
        t.extend(t.ui.autocomplete, {
            escapeRegex: function(t) {
                return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
            },
            filter: function(e, i) {
                var n = new RegExp(t.ui.autocomplete.escapeRegex(i),"i");
                return t.grep(e, function(t) {
                    return n.test(t.label || t.value || t)
                })
            }
        }),
        t.widget("ui.autocomplete", t.ui.autocomplete, {
            options: {
                messages: {
                    noResults: "No search results.",
                    results: function(t) {
                        return t + (t > 1 ? " results are" : " result is") + " available, use up and down arrow keys to navigate."
                    }
                }
            },
            __response: function(t) {
                var e;
                this._superApply(arguments),
                this.options.disabled || this.cancelSearch || (e = t && t.length ? this.options.messages.results(t.length) : this.options.messages.noResults,
                this.liveRegion.text(e))
            }
        })
    }(n),
    function(t, e) {
        var i, n, r, a, s = "ui-button ui-widget ui-state-default ui-corner-all", o = "ui-state-hover ui-state-active ", u = "ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only", l = function() {
            var e = t(this);
            setTimeout(function() {
                e.find(":ui-button").button("refresh")
            }, 1)
        }, c = function(e) {
            var i = e.name
              , n = e.form
              , r = t([]);
            return i && (i = i.replace(/'/g, "\\'"),
            r = n ? t(n).find("[name='" + i + "']") : t("[name='" + i + "']", e.ownerDocument).filter(function() {
                return !this.form
            })),
            r
        };
        t.widget("ui.button", {
            version: "1.10.3",
            defaultElement: "<button>",
            options: {
                disabled: null,
                text: !0,
                label: null,
                icons: {
                    primary: null,
                    secondary: null
                }
            },
            _create: function() {
                this.element.closest("form").unbind("reset" + this.eventNamespace).bind("reset" + this.eventNamespace, l),
                "boolean" != typeof this.options.disabled ? this.options.disabled = !!this.element.prop("disabled") : this.element.prop("disabled", this.options.disabled),
                this._determineButtonType(),
                this.hasTitle = !!this.buttonElement.attr("title");
                var e = this
                  , o = this.options
                  , u = "checkbox" === this.type || "radio" === this.type
                  , h = u ? "" : "ui-state-active"
                  , d = "ui-state-focus";
                null === o.label && (o.label = "input" === this.type ? this.buttonElement.val() : this.buttonElement.html()),
                this._hoverable(this.buttonElement),
                this.buttonElement.addClass(s).attr("role", "button").bind("mouseenter" + this.eventNamespace, function() {
                    o.disabled || this === i && t(this).addClass("ui-state-active")
                }).bind("mouseleave" + this.eventNamespace, function() {
                    o.disabled || t(this).removeClass(h)
                }).bind("click" + this.eventNamespace, function(t) {
                    o.disabled && (t.preventDefault(),
                    t.stopImmediatePropagation())
                }),
                this.element.bind("focus" + this.eventNamespace, function() {
                    e.buttonElement.addClass(d)
                }).bind("blur" + this.eventNamespace, function() {
                    e.buttonElement.removeClass(d)
                }),
                u && (this.element.bind("change" + this.eventNamespace, function() {
                    a || e.refresh()
                }),
                this.buttonElement.bind("mousedown" + this.eventNamespace, function(t) {
                    o.disabled || (a = !1,
                    n = t.pageX,
                    r = t.pageY)
                }).bind("mouseup" + this.eventNamespace, function(t) {
                    o.disabled || n === t.pageX && r === t.pageY || (a = !0)
                })),
                "checkbox" === this.type ? this.buttonElement.bind("click" + this.eventNamespace, function() {
                    if (o.disabled || a)
                        return !1
                }) : "radio" === this.type ? this.buttonElement.bind("click" + this.eventNamespace, function() {
                    if (o.disabled || a)
                        return !1;
                    t(this).addClass("ui-state-active"),
                    e.buttonElement.attr("aria-pressed", "true");
                    var i = e.element[0];
                    c(i).not(i).map(function() {
                        return t(this).button("widget")[0]
                    }).removeClass("ui-state-active").attr("aria-pressed", "false")
                }) : (this.buttonElement.bind("mousedown" + this.eventNamespace, function() {
                    return !o.disabled && (t(this).addClass("ui-state-active"),
                    i = this,
                    void e.document.one("mouseup", function() {
                        i = null
                    }))
                }).bind("mouseup" + this.eventNamespace, function() {
                    return !o.disabled && void t(this).removeClass("ui-state-active")
                }).bind("keydown" + this.eventNamespace, function(e) {
                    return !o.disabled && void (e.keyCode !== t.ui.keyCode.SPACE && e.keyCode !== t.ui.keyCode.ENTER || t(this).addClass("ui-state-active"))
                }).bind("keyup" + this.eventNamespace + " blur" + this.eventNamespace, function() {
                    t(this).removeClass("ui-state-active")
                }),
                this.buttonElement.is("a") && this.buttonElement.keyup(function(e) {
                    e.keyCode === t.ui.keyCode.SPACE && t(this).click()
                })),
                this._setOption("disabled", o.disabled),
                this._resetButton()
            },
            _determineButtonType: function() {
                var t, e, i;
                this.element.is("[type=checkbox]") ? this.type = "checkbox" : this.element.is("[type=radio]") ? this.type = "radio" : this.element.is("input") ? this.type = "input" : this.type = "button",
                "checkbox" === this.type || "radio" === this.type ? (t = this.element.parents().last(),
                e = "label[for='" + this.element.attr("id") + "']",
                this.buttonElement = t.find(e),
                this.buttonElement.length || (t = t.length ? t.siblings() : this.element.siblings(),
                this.buttonElement = t.filter(e),
                this.buttonElement.length || (this.buttonElement = t.find(e))),
                this.element.addClass("ui-helper-hidden-accessible"),
                i = this.element.is(":checked"),
                i && this.buttonElement.addClass("ui-state-active"),
                this.buttonElement.prop("aria-pressed", i)) : this.buttonElement = this.element
            },
            widget: function() {
                return this.buttonElement
            },
            _destroy: function() {
                this.element.removeClass("ui-helper-hidden-accessible"),
                this.buttonElement.removeClass(s + " " + o + " " + u).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),
                this.hasTitle || this.buttonElement.removeAttr("title")
            },
            _setOption: function(t, e) {
                return this._super(t, e),
                "disabled" === t ? void (e ? this.element.prop("disabled", !0) : this.element.prop("disabled", !1)) : void this._resetButton()
            },
            refresh: function() {
                var e = this.element.is("input, button") ? this.element.is(":disabled") : this.element.hasClass("ui-button-disabled");
                e !== this.options.disabled && this._setOption("disabled", e),
                "radio" === this.type ? c(this.element[0]).each(function() {
                    t(this).is(":checked") ? t(this).button("widget").addClass("ui-state-active").attr("aria-pressed", "true") : t(this).button("widget").removeClass("ui-state-active").attr("aria-pressed", "false")
                }) : "checkbox" === this.type && (this.element.is(":checked") ? this.buttonElement.addClass("ui-state-active").attr("aria-pressed", "true") : this.buttonElement.removeClass("ui-state-active").attr("aria-pressed", "false"))
            },
            _resetButton: function() {
                if ("input" === this.type)
                    return void (this.options.label && this.element.val(this.options.label));
                var e = this.buttonElement.removeClass(u)
                  , i = t("<span></span>", this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text()
                  , n = this.options.icons
                  , r = n.primary && n.secondary
                  , a = [];
                n.primary || n.secondary ? (this.options.text && a.push("ui-button-text-icon" + (r ? "s" : n.primary ? "-primary" : "-secondary")),
                n.primary && e.prepend("<span class='ui-button-icon-primary ui-icon " + n.primary + "'></span>"),
                n.secondary && e.append("<span class='ui-button-icon-secondary ui-icon " + n.secondary + "'></span>"),
                this.options.text || (a.push(r ? "ui-button-icons-only" : "ui-button-icon-only"),
                this.hasTitle || e.attr("title", t.trim(i)))) : a.push("ui-button-text-only"),
                e.addClass(a.join(" "))
            }
        }),
        t.widget("ui.buttonset", {
            version: "1.10.3",
            options: {
                items: "button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"
            },
            _create: function() {
                this.element.addClass("ui-buttonset")
            },
            _init: function() {
                this.refresh()
            },
            _setOption: function(t, e) {
                "disabled" === t && this.buttons.button("option", t, e),
                this._super(t, e)
            },
            refresh: function() {
                var e = "rtl" === this.element.css("direction");
                this.buttons = this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function() {
                    return t(this).button("widget")[0]
                }).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e ? "ui-corner-right" : "ui-corner-left").end().filter(":last").addClass(e ? "ui-corner-left" : "ui-corner-right").end().end()
            },
            _destroy: function() {
                this.element.removeClass("ui-buttonset"),
                this.buttons.map(function() {
                    return t(this).button("widget")[0]
                }).removeClass("ui-corner-left ui-corner-right").end().button("destroy")
            }
        })
    }(n),
    function(t, e) {
        function i() {
            this._curInst = null,
            this._keyEvent = !1,
            this._disabledInputs = [],
            this._datepickerShowing = !1,
            this._inDialog = !1,
            this._mainDivId = "ui-datepicker-div",
            this._inlineClass = "ui-datepicker-inline",
            this._appendClass = "ui-datepicker-append",
            this._triggerClass = "ui-datepicker-trigger",
            this._dialogClass = "ui-datepicker-dialog",
            this._disableClass = "ui-datepicker-disabled",
            this._unselectableClass = "ui-datepicker-unselectable",
            this._currentClass = "ui-datepicker-current-day",
            this._dayOverClass = "ui-datepicker-days-cell-over",
            this.regional = [],
            this.regional[""] = {
                closeText: "Done",
                prevText: "Prev",
                nextText: "Next",
                currentText: "Today",
                monthNames: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
                monthNamesShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                dayNames: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
                dayNamesShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
                dayNamesMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"],
                weekHeader: "Wk",
                dateFormat: "mm/dd/yy",
                firstDay: 0,
                isRTL: !1,
                showMonthAfterYear: !1,
                yearSuffix: ""
            },
            this._defaults = {
                showOn: "focus",
                showAnim: "fadeIn",
                showOptions: {},
                defaultDate: null,
                appendText: "",
                buttonText: "...",
                buttonImage: "",
                buttonImageOnly: !1,
                hideIfNoPrevNext: !1,
                navigationAsDateFormat: !1,
                gotoCurrent: !1,
                changeMonth: !1,
                changeYear: !1,
                yearRange: "c-10:c+10",
                showOtherMonths: !1,
                selectOtherMonths: !1,
                showWeek: !1,
                calculateWeek: this.iso8601Week,
                shortYearCutoff: "+10",
                minDate: null,
                maxDate: null,
                duration: "fast",
                beforeShowDay: null,
                beforeShow: null,
                onSelect: null,
                onChangeMonthYear: null,
                onClose: null,
                numberOfMonths: 1,
                showCurrentAtPos: 0,
                stepMonths: 1,
                stepBigMonths: 12,
                altField: "",
                altFormat: "",
                constrainInput: !0,
                showButtonPanel: !1,
                autoSize: !1,
                disabled: !1
            },
            t.extend(this._defaults, this.regional[""]),
            this.dpDiv = n(t("<div id='" + this._mainDivId + "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))
        }
        function n(e) {
            var i = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
            return e.delegate(i, "mouseout", function() {
                t(this).removeClass("ui-state-hover"),
                this.className.indexOf("ui-datepicker-prev") !== -1 && t(this).removeClass("ui-datepicker-prev-hover"),
                this.className.indexOf("ui-datepicker-next") !== -1 && t(this).removeClass("ui-datepicker-next-hover")
            }).delegate(i, "mouseover", function() {
                t.datepicker._isDisabledDatepicker(a.inline ? e.parent()[0] : a.input[0]) || (t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),
                t(this).addClass("ui-state-hover"),
                this.className.indexOf("ui-datepicker-prev") !== -1 && t(this).addClass("ui-datepicker-prev-hover"),
                this.className.indexOf("ui-datepicker-next") !== -1 && t(this).addClass("ui-datepicker-next-hover"))
            })
        }
        function r(e, i) {
            t.extend(e, i);
            for (var n in i)
                null == i[n] && (e[n] = i[n]);
            return e
        }
        t.extend(t.ui, {
            datepicker: {
                version: "1.10.3"
            }
        });
        var a, s = "datepicker";
        t.extend(i.prototype, {
            markerClassName: "hasDatepicker",
            maxRows: 4,
            _widgetDatepicker: function() {
                return this.dpDiv
            },
            setDefaults: function(t) {
                return r(this._defaults, t || {}),
                this
            },
            _attachDatepicker: function(e, i) {
                var n, r, a;
                n = e.nodeName.toLowerCase(),
                r = "div" === n || "span" === n,
                e.id || (this.uuid += 1,
                e.id = "dp" + this.uuid),
                a = this._newInst(t(e), r),
                a.settings = t.extend({}, i || {}),
                "input" === n ? this._connectDatepicker(e, a) : r && this._inlineDatepicker(e, a)
            },
            _newInst: function(e, i) {
                var r = e[0].id.replace(/([^A-Za-z0-9_\-])/g, "\\\\$1");
                return {
                    id: r,
                    input: e,
                    selectedDay: 0,
                    selectedMonth: 0,
                    selectedYear: 0,
                    drawMonth: 0,
                    drawYear: 0,
                    inline: i,
                    dpDiv: i ? n(t("<div class='" + this._inlineClass + " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")) : this.dpDiv
                }
            },
            _connectDatepicker: function(e, i) {
                var n = t(e);
                i.append = t([]),
                i.trigger = t([]),
                n.hasClass(this.markerClassName) || (this._attachments(n, i),
                n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),
                this._autoSize(i),
                t.data(e, s, i),
                i.settings.disabled && this._disableDatepicker(e))
            },
            _attachments: function(e, i) {
                var n, r, a, s = this._get(i, "appendText"), o = this._get(i, "isRTL");
                i.append && i.append.remove(),
                s && (i.append = t("<span class='" + this._appendClass + "'>" + s + "</span>"),
                e[o ? "before" : "after"](i.append)),
                e.unbind("focus", this._showDatepicker),
                i.trigger && i.trigger.remove(),
                n = this._get(i, "showOn"),
                "focus" !== n && "both" !== n || e.focus(this._showDatepicker),
                "button" !== n && "both" !== n || (r = this._get(i, "buttonText"),
                a = this._get(i, "buttonImage"),
                i.trigger = t(this._get(i, "buttonImageOnly") ? t("<img/>").addClass(this._triggerClass).attr({
                    src: a,
                    alt: r,
                    title: r
                }) : t("<button type='button'></button>").addClass(this._triggerClass).html(a ? t("<img/>").attr({
                    src: a,
                    alt: r,
                    title: r
                }) : r)),
                e[o ? "before" : "after"](i.trigger),
                i.trigger.click(function() {
                    return t.datepicker._datepickerShowing && t.datepicker._lastInput === e[0] ? t.datepicker._hideDatepicker() : t.datepicker._datepickerShowing && t.datepicker._lastInput !== e[0] ? (t.datepicker._hideDatepicker(),
                    t.datepicker._showDatepicker(e[0])) : t.datepicker._showDatepicker(e[0]),
                    !1
                }))
            },
            _autoSize: function(t) {
                if (this._get(t, "autoSize") && !t.inline) {
                    var e, i, n, r, a = new Date(2009,11,20), s = this._get(t, "dateFormat");
                    s.match(/[DM]/) && (e = function(t) {
                        for (i = 0,
                        n = 0,
                        r = 0; r < t.length; r++)
                            t[r].length > i && (i = t[r].length,
                            n = r);
                        return n
                    }
                    ,
                    a.setMonth(e(this._get(t, s.match(/MM/) ? "monthNames" : "monthNamesShort"))),
                    a.setDate(e(this._get(t, s.match(/DD/) ? "dayNames" : "dayNamesShort")) + 20 - a.getDay())),
                    t.input.attr("size", this._formatDate(t, a).length)
                }
            },
            _inlineDatepicker: function(e, i) {
                var n = t(e);
                n.hasClass(this.markerClassName) || (n.addClass(this.markerClassName).append(i.dpDiv),
                t.data(e, s, i),
                this._setDate(i, this._getDefaultDate(i), !0),
                this._updateDatepicker(i),
                this._updateAlternate(i),
                i.settings.disabled && this._disableDatepicker(e),
                i.dpDiv.css("display", "block"))
            },
            _dialogDatepicker: function(e, i, n, a, o) {
                var u, l, c, h, d, p = this._dialogInst;
                return p || (this.uuid += 1,
                u = "dp" + this.uuid,
                this._dialogInput = t("<input type='text' id='" + u + "' style='position: absolute; top: -100px; width: 0px;'/>"),
                this._dialogInput.keydown(this._doKeyDown),
                t("body").append(this._dialogInput),
                p = this._dialogInst = this._newInst(this._dialogInput, !1),
                p.settings = {},
                t.data(this._dialogInput[0], s, p)),
                r(p.settings, a || {}),
                i = i && i.constructor === Date ? this._formatDate(p, i) : i,
                this._dialogInput.val(i),
                this._pos = o ? o.length ? o : [o.pageX, o.pageY] : null,
                this._pos || (l = document.documentElement.clientWidth,
                c = document.documentElement.clientHeight,
                h = document.documentElement.scrollLeft || document.body.scrollLeft,
                d = document.documentElement.scrollTop || document.body.scrollTop,
                this._pos = [l / 2 - 100 + h, c / 2 - 150 + d]),
                this._dialogInput.css("left", this._pos[0] + 20 + "px").css("top", this._pos[1] + "px"),
                p.settings.onSelect = n,
                this._inDialog = !0,
                this.dpDiv.addClass(this._dialogClass),
                this._showDatepicker(this._dialogInput[0]),
                t.blockUI && t.blockUI(this.dpDiv),
                t.data(this._dialogInput[0], s, p),
                this
            },
            _destroyDatepicker: function(e) {
                var i, n = t(e), r = t.data(e, s);
                n.hasClass(this.markerClassName) && (i = e.nodeName.toLowerCase(),
                t.removeData(e, s),
                "input" === i ? (r.append.remove(),
                r.trigger.remove(),
                n.removeClass(this.markerClassName).unbind("focus", this._showDatepicker).unbind("keydown", this._doKeyDown).unbind("keypress", this._doKeyPress).unbind("keyup", this._doKeyUp)) : "div" !== i && "span" !== i || n.removeClass(this.markerClassName).empty())
            },
            _enableDatepicker: function(e) {
                var i, n, r = t(e), a = t.data(e, s);
                r.hasClass(this.markerClassName) && (i = e.nodeName.toLowerCase(),
                "input" === i ? (e.disabled = !1,
                a.trigger.filter("button").each(function() {
                    this.disabled = !1
                }).end().filter("img").css({
                    opacity: "1.0",
                    cursor: ""
                })) : "div" !== i && "span" !== i || (n = r.children("." + this._inlineClass),
                n.children().removeClass("ui-state-disabled"),
                n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", !1)),
                this._disabledInputs = t.map(this._disabledInputs, function(t) {
                    return t === e ? null : t
                }))
            },
            _disableDatepicker: function(e) {
                var i, n, r = t(e), a = t.data(e, s);
                r.hasClass(this.markerClassName) && (i = e.nodeName.toLowerCase(),
                "input" === i ? (e.disabled = !0,
                a.trigger.filter("button").each(function() {
                    this.disabled = !0
                }).end().filter("img").css({
                    opacity: "0.5",
                    cursor: "default"
                })) : "div" !== i && "span" !== i || (n = r.children("." + this._inlineClass),
                n.children().addClass("ui-state-disabled"),
                n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", !0)),
                this._disabledInputs = t.map(this._disabledInputs, function(t) {
                    return t === e ? null : t
                }),
                this._disabledInputs[this._disabledInputs.length] = e)
            },
            _isDisabledDatepicker: function(t) {
                if (!t)
                    return !1;
                for (var e = 0; e < this._disabledInputs.length; e++)
                    if (this._disabledInputs[e] === t)
                        return !0;
                return !1
            },
            _getInst: function(e) {
                try {
                    return t.data(e, s)
                } catch (i) {
                    throw "Missing instance data for this datepicker"
                }
            },
            _optionDatepicker: function(i, n, a) {
                var s, o, u, l, c = this._getInst(i);
                return 2 === arguments.length && "string" == typeof n ? "defaults" === n ? t.extend({}, t.datepicker._defaults) : c ? "all" === n ? t.extend({}, c.settings) : this._get(c, n) : null : (s = n || {},
                "string" == typeof n && (s = {},
                s[n] = a),
                void (c && (this._curInst === c && this._hideDatepicker(),
                o = this._getDateDatepicker(i, !0),
                u = this._getMinMaxDate(c, "min"),
                l = this._getMinMaxDate(c, "max"),
                r(c.settings, s),
                null !== u && s.dateFormat !== e && s.minDate === e && (c.settings.minDate = this._formatDate(c, u)),
                null !== l && s.dateFormat !== e && s.maxDate === e && (c.settings.maxDate = this._formatDate(c, l)),
                "disabled"in s && (s.disabled ? this._disableDatepicker(i) : this._enableDatepicker(i)),
                this._attachments(t(i), c),
                this._autoSize(c),
                this._setDate(c, o),
                this._updateAlternate(c),
                this._updateDatepicker(c))))
            },
            _changeDatepicker: function(t, e, i) {
                this._optionDatepicker(t, e, i)
            },
            _refreshDatepicker: function(t) {
                var e = this._getInst(t);
                e && this._updateDatepicker(e)
            },
            _setDateDatepicker: function(t, e) {
                var i = this._getInst(t);
                i && (this._setDate(i, e),
                this._updateDatepicker(i),
                this._updateAlternate(i))
            },
            _getDateDatepicker: function(t, e) {
                var i = this._getInst(t);
                return i && !i.inline && this._setDateFromField(i, e),
                i ? this._getDate(i) : null
            },
            _doKeyDown: function(e) {
                var i, n, r, a = t.datepicker._getInst(e.target), s = !0, o = a.dpDiv.is(".ui-datepicker-rtl");
                if (a._keyEvent = !0,
                t.datepicker._datepickerShowing)
                    switch (e.keyCode) {
                    case 9:
                        t.datepicker._hideDatepicker(),
                        s = !1;
                        break;
                    case 13:
                        return r = t("td." + t.datepicker._dayOverClass + ":not(." + t.datepicker._currentClass + ")", a.dpDiv),
                        r[0] && t.datepicker._selectDay(e.target, a.selectedMonth, a.selectedYear, r[0]),
                        i = t.datepicker._get(a, "onSelect"),
                        i ? (n = t.datepicker._formatDate(a),
                        i.apply(a.input ? a.input[0] : null, [n, a])) : t.datepicker._hideDatepicker(),
                        !1;
                    case 27:
                        t.datepicker._hideDatepicker();
                        break;
                    case 33:
                        t.datepicker._adjustDate(e.target, e.ctrlKey ? -t.datepicker._get(a, "stepBigMonths") : -t.datepicker._get(a, "stepMonths"), "M");
                        break;
                    case 34:
                        t.datepicker._adjustDate(e.target, e.ctrlKey ? +t.datepicker._get(a, "stepBigMonths") : +t.datepicker._get(a, "stepMonths"), "M");
                        break;
                    case 35:
                        (e.ctrlKey || e.metaKey) && t.datepicker._clearDate(e.target),
                        s = e.ctrlKey || e.metaKey;
                        break;
                    case 36:
                        (e.ctrlKey || e.metaKey) && t.datepicker._gotoToday(e.target),
                        s = e.ctrlKey || e.metaKey;
                        break;
                    case 37:
                        (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, o ? 1 : -1, "D"),
                        s = e.ctrlKey || e.metaKey,
                        e.originalEvent.altKey && t.datepicker._adjustDate(e.target, e.ctrlKey ? -t.datepicker._get(a, "stepBigMonths") : -t.datepicker._get(a, "stepMonths"), "M");
                        break;
                    case 38:
                        (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, -7, "D"),
                        s = e.ctrlKey || e.metaKey;
                        break;
                    case 39:
                        (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, o ? -1 : 1, "D"),
                        s = e.ctrlKey || e.metaKey,
                        e.originalEvent.altKey && t.datepicker._adjustDate(e.target, e.ctrlKey ? +t.datepicker._get(a, "stepBigMonths") : +t.datepicker._get(a, "stepMonths"), "M");
                        break;
                    case 40:
                        (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, 7, "D"),
                        s = e.ctrlKey || e.metaKey;
                        break;
                    default:
                        s = !1
                    }
                else
                    36 === e.keyCode && e.ctrlKey ? t.datepicker._showDatepicker(this) : s = !1;
                s && (e.preventDefault(),
                e.stopPropagation())
            },
            _doKeyPress: function(e) {
                var i, n, r = t.datepicker._getInst(e.target);
                if (t.datepicker._get(r, "constrainInput"))
                    return i = t.datepicker._possibleChars(t.datepicker._get(r, "dateFormat")),
                    n = String.fromCharCode(null == e.charCode ? e.keyCode : e.charCode),
                    e.ctrlKey || e.metaKey || n < " " || !i || i.indexOf(n) > -1
            },
            _doKeyUp: function(e) {
                var i, n = t.datepicker._getInst(e.target);
                if (n.input.val() !== n.lastVal)
                    try {
                        i = t.datepicker.parseDate(t.datepicker._get(n, "dateFormat"), n.input ? n.input.val() : null, t.datepicker._getFormatConfig(n)),
                        i && (t.datepicker._setDateFromField(n),
                        t.datepicker._updateAlternate(n),
                        t.datepicker._updateDatepicker(n))
                    } catch (r) {}
                return !0
            },
            _showDatepicker: function(e) {
                if (e = e.target || e,
                "input" !== e.nodeName.toLowerCase() && (e = t("input", e.parentNode)[0]),
                !t.datepicker._isDisabledDatepicker(e) && t.datepicker._lastInput !== e) {
                    var i, n, a, s, o, u, l;
                    i = t.datepicker._getInst(e),
                    t.datepicker._curInst && t.datepicker._curInst !== i && (t.datepicker._curInst.dpDiv.stop(!0, !0),
                    i && t.datepicker._datepickerShowing && t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),
                    n = t.datepicker._get(i, "beforeShow"),
                    a = n ? n.apply(e, [e, i]) : {},
                    a !== !1 && (r(i.settings, a),
                    i.lastVal = null,
                    t.datepicker._lastInput = e,
                    t.datepicker._setDateFromField(i),
                    t.datepicker._inDialog && (e.value = ""),
                    t.datepicker._pos || (t.datepicker._pos = t.datepicker._findPos(e),
                    t.datepicker._pos[1] += e.offsetHeight),
                    s = !1,
                    t(e).parents().each(function() {
                        return s |= "fixed" === t(this).css("position"),
                        !s
                    }),
                    o = {
                        left: t.datepicker._pos[0],
                        top: t.datepicker._pos[1]
                    },
                    t.datepicker._pos = null,
                    i.dpDiv.empty(),
                    i.dpDiv.css({
                        position: "absolute",
                        display: "block",
                        top: "-1000px"
                    }),
                    t.datepicker._updateDatepicker(i),
                    o = t.datepicker._checkOffset(i, o, s),
                    i.dpDiv.css({
                        position: t.datepicker._inDialog && t.blockUI ? "static" : s ? "fixed" : "absolute",
                        display: "none",
                        left: o.left + "px",
                        top: o.top + "px"
                    }),
                    i.inline || (u = t.datepicker._get(i, "showAnim"),
                    l = t.datepicker._get(i, "duration"),
                    i.dpDiv.zIndex(t(e).zIndex() + 1),
                    t.datepicker._datepickerShowing = !0,
                    t.effects && t.effects.effect[u] ? i.dpDiv.show(u, t.datepicker._get(i, "showOptions"), l) : i.dpDiv[u || "show"](u ? l : null),
                    t.datepicker._shouldFocusInput(i) && i.input.focus(),
                    t.datepicker._curInst = i))
                }
            },
            _updateDatepicker: function(e) {
                this.maxRows = 4,
                a = e,
                e.dpDiv.empty().append(this._generateHTML(e)),
                this._attachHandlers(e),
                e.dpDiv.find("." + this._dayOverClass + " a").mouseover();
                var i, n = this._getNumberOfMonths(e), r = n[1], s = 17;
                e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),
                r > 1 && e.dpDiv.addClass("ui-datepicker-multi-" + r).css("width", s * r + "em"),
                e.dpDiv[(1 !== n[0] || 1 !== n[1] ? "add" : "remove") + "Class"]("ui-datepicker-multi"),
                e.dpDiv[(this._get(e, "isRTL") ? "add" : "remove") + "Class"]("ui-datepicker-rtl"),
                e === t.datepicker._curInst && t.datepicker._datepickerShowing && t.datepicker._shouldFocusInput(e) && e.input.focus(),
                e.yearshtml && (i = e.yearshtml,
                setTimeout(function() {
                    i === e.yearshtml && e.yearshtml && e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),
                    i = e.yearshtml = null
                }, 0))
            },
            _shouldFocusInput: function(t) {
                return t.input && t.input.is(":visible") && !t.input.is(":disabled") && !t.input.is(":focus")
            },
            _checkOffset: function(e, i, n) {
                var r = e.dpDiv.outerWidth()
                  , a = e.dpDiv.outerHeight()
                  , s = e.input ? e.input.outerWidth() : 0
                  , o = e.input ? e.input.outerHeight() : 0
                  , u = document.documentElement.clientWidth + (n ? 0 : t(document).scrollLeft())
                  , l = document.documentElement.clientHeight + (n ? 0 : t(document).scrollTop());
                return i.left -= this._get(e, "isRTL") ? r - s : 0,
                i.left -= n && i.left === e.input.offset().left ? t(document).scrollLeft() : 0,
                i.top -= n && i.top === e.input.offset().top + o ? t(document).scrollTop() : 0,
                i.left -= Math.min(i.left, i.left + r > u && u > r ? Math.abs(i.left + r - u) : 0),
                i.top -= Math.min(i.top, i.top + a > l && l > a ? Math.abs(a + o) : 0),
                i
            },
            _findPos: function(e) {
                for (var i, n = this._getInst(e), r = this._get(n, "isRTL"); e && ("hidden" === e.type || 1 !== e.nodeType || t.expr.filters.hidden(e)); )
                    e = e[r ? "previousSibling" : "nextSibling"];
                return i = t(e).offset(),
                [i.left, i.top]
            },
            _hideDatepicker: function(e) {
                var i, n, r, a, o = this._curInst;
                !o || e && o !== t.data(e, s) || this._datepickerShowing && (i = this._get(o, "showAnim"),
                n = this._get(o, "duration"),
                r = function() {
                    t.datepicker._tidyDialog(o)
                }
                ,
                t.effects && (t.effects.effect[i] || t.effects[i]) ? o.dpDiv.hide(i, t.datepicker._get(o, "showOptions"), n, r) : o.dpDiv["slideDown" === i ? "slideUp" : "fadeIn" === i ? "fadeOut" : "hide"](i ? n : null, r),
                i || r(),
                this._datepickerShowing = !1,
                a = this._get(o, "onClose"),
                a && a.apply(o.input ? o.input[0] : null, [o.input ? o.input.val() : "", o]),
                this._lastInput = null,
                this._inDialog && (this._dialogInput.css({
                    position: "absolute",
                    left: "0",
                    top: "-100px"
                }),
                t.blockUI && (t.unblockUI(),
                t("body").append(this.dpDiv))),
                this._inDialog = !1)
            },
            _tidyDialog: function(t) {
                t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")
            },
            _checkExternalClick: function(e) {
                if (t.datepicker._curInst) {
                    var i = t(e.target)
                      , n = t.datepicker._getInst(i[0]);
                    (i[0].id === t.datepicker._mainDivId || 0 !== i.parents("#" + t.datepicker._mainDivId).length || i.hasClass(t.datepicker.markerClassName) || i.closest("." + t.datepicker._triggerClass).length || !t.datepicker._datepickerShowing || t.datepicker._inDialog && t.blockUI) && (!i.hasClass(t.datepicker.markerClassName) || t.datepicker._curInst === n) || t.datepicker._hideDatepicker()
                }
            },
            _adjustDate: function(e, i, n) {
                var r = t(e)
                  , a = this._getInst(r[0]);
                this._isDisabledDatepicker(r[0]) || (this._adjustInstDate(a, i + ("M" === n ? this._get(a, "showCurrentAtPos") : 0), n),
                this._updateDatepicker(a))
            },
            _gotoToday: function(e) {
                var i, n = t(e), r = this._getInst(n[0]);
                this._get(r, "gotoCurrent") && r.currentDay ? (r.selectedDay = r.currentDay,
                r.drawMonth = r.selectedMonth = r.currentMonth,
                r.drawYear = r.selectedYear = r.currentYear) : (i = new Date,
                r.selectedDay = i.getDate(),
                r.drawMonth = r.selectedMonth = i.getMonth(),
                r.drawYear = r.selectedYear = i.getFullYear()),
                this._notifyChange(r),
                this._adjustDate(n)
            },
            _selectMonthYear: function(e, i, n) {
                var r = t(e)
                  , a = this._getInst(r[0]);
                a["selected" + ("M" === n ? "Month" : "Year")] = a["draw" + ("M" === n ? "Month" : "Year")] = parseInt(i.options[i.selectedIndex].value, 10),
                this._notifyChange(a),
                this._adjustDate(r)
            },
            _selectDay: function(e, i, n, r) {
                var a, s = t(e);
                t(r).hasClass(this._unselectableClass) || this._isDisabledDatepicker(s[0]) || (a = this._getInst(s[0]),
                a.selectedDay = a.currentDay = t("a", r).html(),
                a.selectedMonth = a.currentMonth = i,
                a.selectedYear = a.currentYear = n,
                this._selectDate(e, this._formatDate(a, a.currentDay, a.currentMonth, a.currentYear)))
            },
            _clearDate: function(e) {
                var i = t(e);
                this._selectDate(i, "")
            },
            _selectDate: function(e, i) {
                var n, r = t(e), a = this._getInst(r[0]);
                i = null != i ? i : this._formatDate(a),
                a.input && a.input.val(i),
                this._updateAlternate(a),
                n = this._get(a, "onSelect"),
                n ? n.apply(a.input ? a.input[0] : null, [i, a]) : a.input && a.input.trigger("change"),
                a.inline ? this._updateDatepicker(a) : (this._hideDatepicker(),
                this._lastInput = a.input[0],
                "object" != typeof a.input[0] && a.input.focus(),
                this._lastInput = null)
            },
            _updateAlternate: function(e) {
                var i, n, r, a = this._get(e, "altField");
                a && (i = this._get(e, "altFormat") || this._get(e, "dateFormat"),
                n = this._getDate(e),
                r = this.formatDate(i, n, this._getFormatConfig(e)),
                t(a).each(function() {
                    t(this).val(r)
                }))
            },
            noWeekends: function(t) {
                var e = t.getDay();
                return [e > 0 && e < 6, ""]
            },
            iso8601Week: function(t) {
                var e, i = new Date(t.getTime());
                return i.setDate(i.getDate() + 4 - (i.getDay() || 7)),
                e = i.getTime(),
                i.setMonth(0),
                i.setDate(1),
                Math.floor(Math.round((e - i) / 864e5) / 7) + 1
            },
            parseDate: function(e, i, n) {
                if (null == e || null == i)
                    throw "Invalid arguments";
                if (i = "object" == typeof i ? i.toString() : i + "",
                "" === i)
                    return null;
                var r, a, s, o, u = 0, l = (n ? n.shortYearCutoff : null) || this._defaults.shortYearCutoff, c = "string" != typeof l ? l : (new Date).getFullYear() % 100 + parseInt(l, 10), h = (n ? n.dayNamesShort : null) || this._defaults.dayNamesShort, d = (n ? n.dayNames : null) || this._defaults.dayNames, p = (n ? n.monthNamesShort : null) || this._defaults.monthNamesShort, f = (n ? n.monthNames : null) || this._defaults.monthNames, g = -1, m = -1, v = -1, _ = -1, b = !1, x = function(t) {
                    var i = r + 1 < e.length && e.charAt(r + 1) === t;
                    return i && r++,
                    i
                }, A = function(t) {
                    var e = x(t)
                      , n = "@" === t ? 14 : "!" === t ? 20 : "y" === t && e ? 4 : "o" === t ? 3 : 2
                      , r = new RegExp("^\\d{1," + n + "}")
                      , a = i.substring(u).match(r);
                    if (!a)
                        throw "Missing number at position " + u;
                    return u += a[0].length,
                    parseInt(a[0], 10)
                }, y = function(e, n, r) {
                    var a = -1
                      , s = t.map(x(e) ? r : n, function(t, e) {
                        return [[e, t]]
                    }).sort(function(t, e) {
                        return -(t[1].length - e[1].length)
                    });
                    if (t.each(s, function(t, e) {
                        var n = e[1];
                        if (i.substr(u, n.length).toLowerCase() === n.toLowerCase())
                            return a = e[0],
                            u += n.length,
                            !1
                    }),
                    a !== -1)
                        return a + 1;
                    throw "Unknown name at position " + u
                }, S = function() {
                    if (i.charAt(u) !== e.charAt(r))
                        throw "Unexpected literal at position " + u;
                    u++
                };
                for (r = 0; r < e.length; r++)
                    if (b)
                        "'" !== e.charAt(r) || x("'") ? S() : b = !1;
                    else
                        switch (e.charAt(r)) {
                        case "d":
                            v = A("d");
                            break;
                        case "D":
                            y("D", h, d);
                            break;
                        case "o":
                            _ = A("o");
                            break;
                        case "m":
                            m = A("m");
                            break;
                        case "M":
                            m = y("M", p, f);
                            break;
                        case "y":
                            g = A("y");
                            break;
                        case "@":
                            o = new Date(A("@")),
                            g = o.getFullYear(),
                            m = o.getMonth() + 1,
                            v = o.getDate();
                            break;
                        case "!":
                            o = new Date((A("!") - this._ticksTo1970) / 1e4),
                            g = o.getFullYear(),
                            m = o.getMonth() + 1,
                            v = o.getDate();
                            break;
                        case "'":
                            x("'") ? S() : b = !0;
                            break;
                        default:
                            S()
                        }
                if (u < i.length && (s = i.substr(u),
                !/^\s+/.test(s)))
                    throw "Extra/unparsed characters found in date: " + s;
                if (g === -1 ? g = (new Date).getFullYear() : g < 100 && (g += (new Date).getFullYear() - (new Date).getFullYear() % 100 + (g <= c ? 0 : -100)),
                _ > -1)
                    for (m = 1,
                    v = _; ; ) {
                        if (a = this._getDaysInMonth(g, m - 1),
                        v <= a)
                            break;
                        m++,
                        v -= a
                    }
                if (o = this._daylightSavingAdjust(new Date(g,m - 1,v)),
                o.getFullYear() !== g || o.getMonth() + 1 !== m || o.getDate() !== v)
                    throw "Invalid date";
                return o
            },
            ATOM: "yy-mm-dd",
            COOKIE: "D, dd M yy",
            ISO_8601: "yy-mm-dd",
            RFC_822: "D, d M y",
            RFC_850: "DD, dd-M-y",
            RFC_1036: "D, d M y",
            RFC_1123: "D, d M yy",
            RFC_2822: "D, d M yy",
            RSS: "D, d M y",
            TICKS: "!",
            TIMESTAMP: "@",
            W3C: "yy-mm-dd",
            _ticksTo1970: 24 * (718685 + Math.floor(492.5) - Math.floor(19.7) + Math.floor(4.925)) * 60 * 60 * 1e7,
            formatDate: function(t, e, i) {
                if (!e)
                    return "";
                var n, r = (i ? i.dayNamesShort : null) || this._defaults.dayNamesShort, a = (i ? i.dayNames : null) || this._defaults.dayNames, s = (i ? i.monthNamesShort : null) || this._defaults.monthNamesShort, o = (i ? i.monthNames : null) || this._defaults.monthNames, u = function(e) {
                    var i = n + 1 < t.length && t.charAt(n + 1) === e;
                    return i && n++,
                    i
                }, l = function(t, e, i) {
                    var n = "" + e;
                    if (u(t))
                        for (; n.length < i; )
                            n = "0" + n;
                    return n
                }, c = function(t, e, i, n) {
                    return u(t) ? n[e] : i[e]
                }, h = "", d = !1;
                if (e)
                    for (n = 0; n < t.length; n++)
                        if (d)
                            "'" !== t.charAt(n) || u("'") ? h += t.charAt(n) : d = !1;
                        else
                            switch (t.charAt(n)) {
                            case "d":
                                h += l("d", e.getDate(), 2);
                                break;
                            case "D":
                                h += c("D", e.getDay(), r, a);
                                break;
                            case "o":
                                h += l("o", Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime() - new Date(e.getFullYear(),0,0).getTime()) / 864e5), 3);
                                break;
                            case "m":
                                h += l("m", e.getMonth() + 1, 2);
                                break;
                            case "M":
                                h += c("M", e.getMonth(), s, o);
                                break;
                            case "y":
                                h += u("y") ? e.getFullYear() : (e.getYear() % 100 < 10 ? "0" : "") + e.getYear() % 100;
                                break;
                            case "@":
                                h += e.getTime();
                                break;
                            case "!":
                                h += 1e4 * e.getTime() + this._ticksTo1970;
                                break;
                            case "'":
                                u("'") ? h += "'" : d = !0;
                                break;
                            default:
                                h += t.charAt(n)
                            }
                return h
            },
            _possibleChars: function(t) {
                var e, i = "", n = !1, r = function(i) {
                    var n = e + 1 < t.length && t.charAt(e + 1) === i;
                    return n && e++,
                    n
                };
                for (e = 0; e < t.length; e++)
                    if (n)
                        "'" !== t.charAt(e) || r("'") ? i += t.charAt(e) : n = !1;
                    else
                        switch (t.charAt(e)) {
                        case "d":
                        case "m":
                        case "y":
                        case "@":
                            i += "0123456789";
                            break;
                        case "D":
                        case "M":
                            return null;
                        case "'":
                            r("'") ? i += "'" : n = !0;
                            break;
                        default:
                            i += t.charAt(e)
                        }
                return i
            },
            _get: function(t, i) {
                return t.settings[i] !== e ? t.settings[i] : this._defaults[i]
            },
            _setDateFromField: function(t, e) {
                if (t.input.val() !== t.lastVal) {
                    var i = this._get(t, "dateFormat")
                      , n = t.lastVal = t.input ? t.input.val() : null
                      , r = this._getDefaultDate(t)
                      , a = r
                      , s = this._getFormatConfig(t);
                    try {
                        a = this.parseDate(i, n, s) || r
                    } catch (o) {
                        n = e ? "" : n
                    }
                    t.selectedDay = a.getDate(),
                    t.drawMonth = t.selectedMonth = a.getMonth(),
                    t.drawYear = t.selectedYear = a.getFullYear(),
                    t.currentDay = n ? a.getDate() : 0,
                    t.currentMonth = n ? a.getMonth() : 0,
                    t.currentYear = n ? a.getFullYear() : 0,
                    this._adjustInstDate(t)
                }
            },
            _getDefaultDate: function(t) {
                return this._restrictMinMax(t, this._determineDate(t, this._get(t, "defaultDate"), new Date))
            },
            _determineDate: function(e, i, n) {
                var r = function(t) {
                    var e = new Date;
                    return e.setDate(e.getDate() + t),
                    e
                }
                  , a = function(i) {
                    try {
                        return t.datepicker.parseDate(t.datepicker._get(e, "dateFormat"), i, t.datepicker._getFormatConfig(e))
                    } catch (n) {}
                    for (var r = (i.toLowerCase().match(/^c/) ? t.datepicker._getDate(e) : null) || new Date, a = r.getFullYear(), s = r.getMonth(), o = r.getDate(), u = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g, l = u.exec(i); l; ) {
                        switch (l[2] || "d") {
                        case "d":
                        case "D":
                            o += parseInt(l[1], 10);
                            break;
                        case "w":
                        case "W":
                            o += 7 * parseInt(l[1], 10);
                            break;
                        case "m":
                        case "M":
                            s += parseInt(l[1], 10),
                            o = Math.min(o, t.datepicker._getDaysInMonth(a, s));
                            break;
                        case "y":
                        case "Y":
                            a += parseInt(l[1], 10),
                            o = Math.min(o, t.datepicker._getDaysInMonth(a, s))
                        }
                        l = u.exec(i)
                    }
                    return new Date(a,s,o)
                }
                  , s = null == i || "" === i ? n : "string" == typeof i ? a(i) : "number" == typeof i ? isNaN(i) ? n : r(i) : new Date(i.getTime());
                return s = s && "Invalid Date" === s.toString() ? n : s,
                s && (s.setHours(0),
                s.setMinutes(0),
                s.setSeconds(0),
                s.setMilliseconds(0)),
                this._daylightSavingAdjust(s)
            },
            _daylightSavingAdjust: function(t) {
                return t ? (t.setHours(t.getHours() > 12 ? t.getHours() + 2 : 0),
                t) : null
            },
            _setDate: function(t, e, i) {
                var n = !e
                  , r = t.selectedMonth
                  , a = t.selectedYear
                  , s = this._restrictMinMax(t, this._determineDate(t, e, new Date));
                t.selectedDay = t.currentDay = s.getDate(),
                t.drawMonth = t.selectedMonth = t.currentMonth = s.getMonth(),
                t.drawYear = t.selectedYear = t.currentYear = s.getFullYear(),
                r === t.selectedMonth && a === t.selectedYear || i || this._notifyChange(t),
                this._adjustInstDate(t),
                t.input && t.input.val(n ? "" : this._formatDate(t))
            },
            _getDate: function(t) {
                var e = !t.currentYear || t.input && "" === t.input.val() ? null : this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));
                return e
            },
            _attachHandlers: function(e) {
                var i = this._get(e, "stepMonths")
                  , n = "#" + e.id.replace(/\\\\/g, "\\");
                e.dpDiv.find("[data-handler]").map(function() {
                    var e = {
                        prev: function() {
                            t.datepicker._adjustDate(n, -i, "M")
                        },
                        next: function() {
                            t.datepicker._adjustDate(n, +i, "M")
                        },
                        hide: function() {
                            t.datepicker._hideDatepicker()
                        },
                        today: function() {
                            t.datepicker._gotoToday(n)
                        },
                        selectDay: function() {
                            return t.datepicker._selectDay(n, +this.getAttribute("data-month"), +this.getAttribute("data-year"), this),
                            !1
                        },
                        selectMonth: function() {
                            return t.datepicker._selectMonthYear(n, this, "M"),
                            !1
                        },
                        selectYear: function() {
                            return t.datepicker._selectMonthYear(n, this, "Y"),
                            !1
                        }
                    };
                    t(this).bind(this.getAttribute("data-event"), e[this.getAttribute("data-handler")])
                })
            },
            _generateHTML: function(t) {
                var e, i, n, r, a, s, o, u, l, c, h, d, p, f, g, m, v, _, b, x, A, y, S, C, M, w, T, E, I, k, F, D, N, R, P, L, O, V, B, U = new Date, G = this._daylightSavingAdjust(new Date(U.getFullYear(),U.getMonth(),U.getDate())), z = this._get(t, "isRTL"), H = this._get(t, "showButtonPanel"), j = this._get(t, "hideIfNoPrevNext"), W = this._get(t, "navigationAsDateFormat"), q = this._getNumberOfMonths(t), Y = this._get(t, "showCurrentAtPos"), Q = this._get(t, "stepMonths"), X = 1 !== q[0] || 1 !== q[1], K = this._daylightSavingAdjust(t.currentDay ? new Date(t.currentYear,t.currentMonth,t.currentDay) : new Date(9999,9,9)), J = this._getMinMaxDate(t, "min"), Z = this._getMinMaxDate(t, "max"), $ = t.drawMonth - Y, tt = t.drawYear;
                if ($ < 0 && ($ += 12,
                tt--),
                Z)
                    for (e = this._daylightSavingAdjust(new Date(Z.getFullYear(),Z.getMonth() - q[0] * q[1] + 1,Z.getDate())),
                    e = J && e < J ? J : e; this._daylightSavingAdjust(new Date(tt,$,1)) > e; )
                        $--,
                        $ < 0 && ($ = 11,
                        tt--);
                for (t.drawMonth = $,
                t.drawYear = tt,
                i = this._get(t, "prevText"),
                i = W ? this.formatDate(i, this._daylightSavingAdjust(new Date(tt,$ - Q,1)), this._getFormatConfig(t)) : i,
                n = this._canAdjustMonth(t, -1, tt, $) ? "<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='" + i + "'><span class='ui-icon ui-icon-circle-triangle-" + (z ? "e" : "w") + "'>" + i + "</span></a>" : j ? "" : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='" + i + "'><span class='ui-icon ui-icon-circle-triangle-" + (z ? "e" : "w") + "'>" + i + "</span></a>",
                r = this._get(t, "nextText"),
                r = W ? this.formatDate(r, this._daylightSavingAdjust(new Date(tt,$ + Q,1)), this._getFormatConfig(t)) : r,
                a = this._canAdjustMonth(t, 1, tt, $) ? "<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='" + r + "'><span class='ui-icon ui-icon-circle-triangle-" + (z ? "w" : "e") + "'>" + r + "</span></a>" : j ? "" : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='" + r + "'><span class='ui-icon ui-icon-circle-triangle-" + (z ? "w" : "e") + "'>" + r + "</span></a>",
                s = this._get(t, "currentText"),
                o = this._get(t, "gotoCurrent") && t.currentDay ? K : G,
                s = W ? this.formatDate(s, o, this._getFormatConfig(t)) : s,
                u = t.inline ? "" : "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" + this._get(t, "closeText") + "</button>",
                l = H ? "<div class='ui-datepicker-buttonpane ui-widget-content'>" + (z ? u : "") + (this._isInRange(t, o) ? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>" + s + "</button>" : "") + (z ? "" : u) + "</div>" : "",
                c = parseInt(this._get(t, "firstDay"), 10),
                c = isNaN(c) ? 0 : c,
                h = this._get(t, "showWeek"),
                d = this._get(t, "dayNames"),
                p = this._get(t, "dayNamesMin"),
                f = this._get(t, "monthNames"),
                g = this._get(t, "monthNamesShort"),
                m = this._get(t, "beforeShowDay"),
                v = this._get(t, "showOtherMonths"),
                _ = this._get(t, "selectOtherMonths"),
                b = this._getDefaultDate(t),
                x = "",
                y = 0; y < q[0]; y++) {
                    for (S = "",
                    this.maxRows = 4,
                    C = 0; C < q[1]; C++) {
                        if (M = this._daylightSavingAdjust(new Date(tt,$,t.selectedDay)),
                        w = " ui-corner-all",
                        T = "",
                        X) {
                            if (T += "<div class='ui-datepicker-group",
                            q[1] > 1)
                                switch (C) {
                                case 0:
                                    T += " ui-datepicker-group-first",
                                    w = " ui-corner-" + (z ? "right" : "left");
                                    break;
                                case q[1] - 1:
                                    T += " ui-datepicker-group-last",
                                    w = " ui-corner-" + (z ? "left" : "right");
                                    break;
                                default:
                                    T += " ui-datepicker-group-middle",
                                    w = ""
                                }
                            T += "'>"
                        }
                        for (T += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + w + "'>" + (/all|left/.test(w) && 0 === y ? z ? a : n : "") + (/all|right/.test(w) && 0 === y ? z ? n : a : "") + this._generateMonthYearHeader(t, $, tt, J, Z, y > 0 || C > 0, f, g) + "</div><table class='ui-datepicker-calendar'><thead><tr>",
                        E = h ? "<th class='ui-datepicker-week-col'>" + this._get(t, "weekHeader") + "</th>" : "",
                        A = 0; A < 7; A++)
                            I = (A + c) % 7,
                            E += "<th" + ((A + c + 6) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "") + "><span title='" + d[I] + "'>" + p[I] + "</span></th>";
                        for (T += E + "</tr></thead><tbody>",
                        k = this._getDaysInMonth(tt, $),
                        tt === t.selectedYear && $ === t.selectedMonth && (t.selectedDay = Math.min(t.selectedDay, k)),
                        F = (this._getFirstDayOfMonth(tt, $) - c + 7) % 7,
                        D = Math.ceil((F + k) / 7),
                        N = X && this.maxRows > D ? this.maxRows : D,
                        this.maxRows = N,
                        R = this._daylightSavingAdjust(new Date(tt,$,1 - F)),
                        P = 0; P < N; P++) {
                            for (T += "<tr>",
                            L = h ? "<td class='ui-datepicker-week-col'>" + this._get(t, "calculateWeek")(R) + "</td>" : "",
                            A = 0; A < 7; A++)
                                O = m ? m.apply(t.input ? t.input[0] : null, [R]) : [!0, ""],
                                V = R.getMonth() !== $,
                                B = V && !_ || !O[0] || J && R < J || Z && R > Z,
                                L += "<td class='" + ((A + c + 6) % 7 >= 5 ? " ui-datepicker-week-end" : "") + (V ? " ui-datepicker-other-month" : "") + (R.getTime() === M.getTime() && $ === t.selectedMonth && t._keyEvent || b.getTime() === R.getTime() && b.getTime() === M.getTime() ? " " + this._dayOverClass : "") + (B ? " " + this._unselectableClass + " ui-state-disabled" : "") + (V && !v ? "" : " " + O[1] + (R.getTime() === K.getTime() ? " " + this._currentClass : "") + (R.getTime() === G.getTime() ? " ui-datepicker-today" : "")) + "'" + (V && !v || !O[2] ? "" : " title='" + O[2].replace(/'/g, "&#39;") + "'") + (B ? "" : " data-handler='selectDay' data-event='click' data-month='" + R.getMonth() + "' data-year='" + R.getFullYear() + "'") + ">" + (V && !v ? "&#xa0;" : B ? "<span class='ui-state-default'>" + R.getDate() + "</span>" : "<a class='ui-state-default" + (R.getTime() === G.getTime() ? " ui-state-highlight" : "") + (R.getTime() === K.getTime() ? " ui-state-active" : "") + (V ? " ui-priority-secondary" : "") + "' href='#'>" + R.getDate() + "</a>") + "</td>",
                                R.setDate(R.getDate() + 1),
                                R = this._daylightSavingAdjust(R);
                            T += L + "</tr>"
                        }
                        $++,
                        $ > 11 && ($ = 0,
                        tt++),
                        T += "</tbody></table>" + (X ? "</div>" + (q[0] > 0 && C === q[1] - 1 ? "<div class='ui-datepicker-row-break'></div>" : "") : ""),
                        S += T
                    }
                    x += S
                }
                return x += l,
                t._keyEvent = !1,
                x
            },
            _generateMonthYearHeader: function(t, e, i, n, r, a, s, o) {
                var u, l, c, h, d, p, f, g, m = this._get(t, "changeMonth"), v = this._get(t, "changeYear"), _ = this._get(t, "showMonthAfterYear"), b = "<div class='ui-datepicker-title'>", x = "";
                if (a || !m)
                    x += "<span class='ui-datepicker-month'>" + s[e] + "</span>";
                else {
                    for (u = n && n.getFullYear() === i,
                    l = r && r.getFullYear() === i,
                    x += "<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",
                    c = 0; c < 12; c++)
                        (!u || c >= n.getMonth()) && (!l || c <= r.getMonth()) && (x += "<option value='" + c + "'" + (c === e ? " selected='selected'" : "") + ">" + o[c] + "</option>");
                    x += "</select>"
                }
                if (_ || (b += x + (!a && m && v ? "" : "&#xa0;")),
                !t.yearshtml)
                    if (t.yearshtml = "",
                    a || !v)
                        b += "<span class='ui-datepicker-year'>" + i + "</span>";
                    else {
                        for (h = this._get(t, "yearRange").split(":"),
                        d = (new Date).getFullYear(),
                        p = function(t) {
                            var e = t.match(/c[+\-].*/) ? i + parseInt(t.substring(1), 10) : t.match(/[+\-].*/) ? d + parseInt(t, 10) : parseInt(t, 10);
                            return isNaN(e) ? d : e
                        }
                        ,
                        f = p(h[0]),
                        g = Math.max(f, p(h[1] || "")),
                        f = n ? Math.max(f, n.getFullYear()) : f,
                        g = r ? Math.min(g, r.getFullYear()) : g,
                        t.yearshtml += "<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>"; f <= g; f++)
                            t.yearshtml += "<option value='" + f + "'" + (f === i ? " selected='selected'" : "") + ">" + f + "</option>";
                        t.yearshtml += "</select>",
                        b += t.yearshtml,
                        t.yearshtml = null
                    }
                return b += this._get(t, "yearSuffix"),
                _ && (b += (!a && m && v ? "" : "&#xa0;") + x),
                b += "</div>"
            },
            _adjustInstDate: function(t, e, i) {
                var n = t.drawYear + ("Y" === i ? e : 0)
                  , r = t.drawMonth + ("M" === i ? e : 0)
                  , a = Math.min(t.selectedDay, this._getDaysInMonth(n, r)) + ("D" === i ? e : 0)
                  , s = this._restrictMinMax(t, this._daylightSavingAdjust(new Date(n,r,a)));
                t.selectedDay = s.getDate(),
                t.drawMonth = t.selectedMonth = s.getMonth(),
                t.drawYear = t.selectedYear = s.getFullYear(),
                "M" !== i && "Y" !== i || this._notifyChange(t)
            },
            _restrictMinMax: function(t, e) {
                var i = this._getMinMaxDate(t, "min")
                  , n = this._getMinMaxDate(t, "max")
                  , r = i && e < i ? i : e;
                return n && r > n ? n : r
            },
            _notifyChange: function(t) {
                var e = this._get(t, "onChangeMonthYear");
                e && e.apply(t.input ? t.input[0] : null, [t.selectedYear, t.selectedMonth + 1, t])
            },
            _getNumberOfMonths: function(t) {
                var e = this._get(t, "numberOfMonths");
                return null == e ? [1, 1] : "number" == typeof e ? [1, e] : e
            },
            _getMinMaxDate: function(t, e) {
                return this._determineDate(t, this._get(t, e + "Date"), null)
            },
            _getDaysInMonth: function(t, e) {
                return 32 - this._daylightSavingAdjust(new Date(t,e,32)).getDate()
            },
            _getFirstDayOfMonth: function(t, e) {
                return new Date(t,e,1).getDay()
            },
            _canAdjustMonth: function(t, e, i, n) {
                var r = this._getNumberOfMonths(t)
                  , a = this._daylightSavingAdjust(new Date(i,n + (e < 0 ? e : r[0] * r[1]),1));
                return e < 0 && a.setDate(this._getDaysInMonth(a.getFullYear(), a.getMonth())),
                this._isInRange(t, a)
            },
            _isInRange: function(t, e) {
                var i, n, r = this._getMinMaxDate(t, "min"), a = this._getMinMaxDate(t, "max"), s = null, o = null, u = this._get(t, "yearRange");
                return u && (i = u.split(":"),
                n = (new Date).getFullYear(),
                s = parseInt(i[0], 10),
                o = parseInt(i[1], 10),
                i[0].match(/[+\-].*/) && (s += n),
                i[1].match(/[+\-].*/) && (o += n)),
                (!r || e.getTime() >= r.getTime()) && (!a || e.getTime() <= a.getTime()) && (!s || e.getFullYear() >= s) && (!o || e.getFullYear() <= o)
            },
            _getFormatConfig: function(t) {
                var e = this._get(t, "shortYearCutoff");
                return e = "string" != typeof e ? e : (new Date).getFullYear() % 100 + parseInt(e, 10),
                {
                    shortYearCutoff: e,
                    dayNamesShort: this._get(t, "dayNamesShort"),
                    dayNames: this._get(t, "dayNames"),
                    monthNamesShort: this._get(t, "monthNamesShort"),
                    monthNames: this._get(t, "monthNames")
                }
            },
            _formatDate: function(t, e, i, n) {
                e || (t.currentDay = t.selectedDay,
                t.currentMonth = t.selectedMonth,
                t.currentYear = t.selectedYear);
                var r = e ? "object" == typeof e ? e : this._daylightSavingAdjust(new Date(n,i,e)) : this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));
                return this.formatDate(this._get(t, "dateFormat"), r, this._getFormatConfig(t))
            }
        }),
        t.fn.datepicker = function(e) {
            if (!this.length)
                return this;
            t.datepicker.initialized || (t(document).mousedown(t.datepicker._checkExternalClick),
            t.datepicker.initialized = !0),
            0 === t("#" + t.datepicker._mainDivId).length && t("body").append(t.datepicker.dpDiv);
            var i = Array.prototype.slice.call(arguments, 1);
            return "string" != typeof e || "isDisabled" !== e && "getDate" !== e && "widget" !== e ? "option" === e && 2 === arguments.length && "string" == typeof arguments[1] ? t.datepicker["_" + e + "Datepicker"].apply(t.datepicker, [this[0]].concat(i)) : this.each(function() {
                "string" == typeof e ? t.datepicker["_" + e + "Datepicker"].apply(t.datepicker, [this].concat(i)) : t.datepicker._attachDatepicker(this, e)
            }) : t.datepicker["_" + e + "Datepicker"].apply(t.datepicker, [this[0]].concat(i))
        }
        ,
        t.datepicker = new i,
        t.datepicker.initialized = !1,
        t.datepicker.uuid = (new Date).getTime(),
        t.datepicker.version = "1.10.3"
    }(n),
    function(t, e) {
        var i = {
            buttons: !0,
            height: !0,
            maxHeight: !0,
            maxWidth: !0,
            minHeight: !0,
            minWidth: !0,
            width: !0
        }
          , n = {
            maxHeight: !0,
            maxWidth: !0,
            minHeight: !0,
            minWidth: !0
        };
        t.widget("ui.dialog", {
            version: "1.10.3",
            options: {
                appendTo: "body",
                autoOpen: !0,
                buttons: [],
                closeOnEscape: !0,
                closeText: "close",
                dialogClass: "",
                draggable: !0,
                hide: null,
                height: "auto",
                maxHeight: null,
                maxWidth: null,
                minHeight: 150,
                minWidth: 150,
                modal: !1,
                position: {
                    my: "center",
                    at: "center",
                    of: window,
                    collision: "fit",
                    using: function(e) {
                        var i = t(this).css(e).offset().top;
                        i < 0 && t(this).css("top", e.top - i)
                    }
                },
                resizable: !0,
                show: null,
                title: null,
                width: 300,
                beforeClose: null,
                close: null,
                drag: null,
                dragStart: null,
                dragStop: null,
                focus: null,
                open: null,
                resize: null,
                resizeStart: null,
                resizeStop: null
            },
            _create: function() {
                this.originalCss = {
                    display: this.element[0].style.display,
                    width: this.element[0].style.width,
                    minHeight: this.element[0].style.minHeight,
                    maxHeight: this.element[0].style.maxHeight,
                    height: this.element[0].style.height
                },
                this.originalPosition = {
                    parent: this.element.parent(),
                    index: this.element.parent().children().index(this.element)
                },
                this.originalTitle = this.element.attr("title"),
                this.options.title = this.options.title || this.originalTitle,
                this._createWrapper(),
                this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),
                this._createTitlebar(),
                this._createButtonPane(),
                this.options.draggable && t.fn.draggable && this._makeDraggable(),
                this.options.resizable && t.fn.resizable && this._makeResizable(),
                this._isOpen = !1
            },
            _init: function() {
                this.options.autoOpen && this.open()
            },
            _appendTo: function() {
                var e = this.options.appendTo;
                return e && (e.jquery || e.nodeType) ? t(e) : this.document.find(e || "body").eq(0)
            },
            _destroy: function() {
                var t, e = this.originalPosition;
                this._destroyOverlay(),
                this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),
                this.uiDialog.stop(!0, !0).remove(),
                this.originalTitle && this.element.attr("title", this.originalTitle),
                t = e.parent.children().eq(e.index),
                t.length && t[0] !== this.element[0] ? t.before(this.element) : e.parent.append(this.element)
            },
            widget: function() {
                return this.uiDialog
            },
            disable: t.noop,
            enable: t.noop,
            close: function(e) {
                var i = this;
                this._isOpen && this._trigger("beforeClose", e) !== !1 && (this._isOpen = !1,
                this._destroyOverlay(),
                this.opener.filter(":focusable").focus().length || t(this.document[0].activeElement).blur(),
                this._hide(this.uiDialog, this.options.hide, function() {
                    i._trigger("close", e)
                }))
            },
            isOpen: function() {
                return this._isOpen
            },
            moveToTop: function() {
                this._moveToTop()
            },
            _moveToTop: function(t, e) {
                var i = !!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;
                return i && !e && this._trigger("focus", t),
                i
            },
            open: function() {
                var e = this;
                return this._isOpen ? void (this._moveToTop() && this._focusTabbable()) : (this._isOpen = !0,
                this.opener = t(this.document[0].activeElement),
                this._size(),
                this._position(),
                this._createOverlay(),
                this._moveToTop(null, !0),
                this._show(this.uiDialog, this.options.show, function() {
                    e._focusTabbable(),
                    e._trigger("focus")
                }),
                void this._trigger("open"))
            },
            _focusTabbable: function() {
                var t = this.element.find("[autofocus]");
                t.length || (t = this.element.find(":tabbable")),
                t.length || (t = this.uiDialogButtonPane.find(":tabbable")),
                t.length || (t = this.uiDialogTitlebarClose.filter(":tabbable")),
                t.length || (t = this.uiDialog),
                t.eq(0).focus()
            },
            _keepFocus: function(e) {
                function i() {
                    var e = this.document[0].activeElement
                      , i = this.uiDialog[0] === e || t.contains(this.uiDialog[0], e);
                    i || this._focusTabbable()
                }
                e.preventDefault(),
                i.call(this),
                this._delay(i)
            },
            _createWrapper: function() {
                this.uiDialog = t("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front " + this.options.dialogClass).hide().attr({
                    tabIndex: -1,
                    role: "dialog"
                }).appendTo(this._appendTo()),
                this._on(this.uiDialog, {
                    keydown: function(e) {
                        if (this.options.closeOnEscape && !e.isDefaultPrevented() && e.keyCode && e.keyCode === t.ui.keyCode.ESCAPE)
                            return e.preventDefault(),
                            void this.close(e);
                        if (e.keyCode === t.ui.keyCode.TAB) {
                            var i = this.uiDialog.find(":tabbable")
                              , n = i.filter(":first")
                              , r = i.filter(":last");
                            e.target !== r[0] && e.target !== this.uiDialog[0] || e.shiftKey ? e.target !== n[0] && e.target !== this.uiDialog[0] || !e.shiftKey || (r.focus(1),
                            e.preventDefault()) : (n.focus(1),
                            e.preventDefault())
                        }
                    },
                    mousedown: function(t) {
                        this._moveToTop(t) && this._focusTabbable()
                    }
                }),
                this.element.find("[aria-describedby]").length || this.uiDialog.attr({
                    "aria-describedby": this.element.uniqueId().attr("id")
                })
            },
            _createTitlebar: function() {
                var e;
                this.uiDialogTitlebar = t("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),
                this._on(this.uiDialogTitlebar, {
                    mousedown: function(e) {
                        t(e.target).closest(".ui-dialog-titlebar-close") || this.uiDialog.focus()
                    }
                }),
                this.uiDialogTitlebarClose = t("<button></button>").button({
                    label: this.options.closeText,
                    icons: {
                        primary: "ui-icon-closethick"
                    },
                    text: !1
                }).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),
                this._on(this.uiDialogTitlebarClose, {
                    click: function(t) {
                        t.preventDefault(),
                        this.close(t)
                    }
                }),
                e = t("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),
                this._title(e),
                this.uiDialog.attr({
                    "aria-labelledby": e.attr("id")
                })
            },
            _title: function(t) {
                this.options.title || t.html("&#160;"),
                t.text(this.options.title)
            },
            _createButtonPane: function() {
                this.uiDialogButtonPane = t("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),
                this.uiButtonSet = t("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),
                this._createButtons()
            },
            _createButtons: function() {
                var e = this
                  , i = this.options.buttons;
                return this.uiDialogButtonPane.remove(),
                this.uiButtonSet.empty(),
                t.isEmptyObject(i) || t.isArray(i) && !i.length ? void this.uiDialog.removeClass("ui-dialog-buttons") : (t.each(i, function(i, n) {
                    var r, a;
                    n = t.isFunction(n) ? {
                        click: n,
                        text: i
                    } : n,
                    n = t.extend({
                        type: "button"
                    }, n),
                    r = n.click,
                    n.click = function() {
                        r.apply(e.element[0], arguments)
                    }
                    ,
                    a = {
                        icons: n.icons,
                        text: n.showText
                    },
                    delete n.icons,
                    delete n.showText,
                    t("<button></button>", n).button(a).appendTo(e.uiButtonSet)
                }),
                this.uiDialog.addClass("ui-dialog-buttons"),
                void this.uiDialogButtonPane.appendTo(this.uiDialog))
            },
            _makeDraggable: function() {
                function e(t) {
                    return {
                        position: t.position,
                        offset: t.offset
                    }
                }
                var i = this
                  , n = this.options;
                this.uiDialog.draggable({
                    cancel: ".ui-dialog-content, .ui-dialog-titlebar-close",
                    handle: ".ui-dialog-titlebar",
                    containment: "document",
                    start: function(n, r) {
                        t(this).addClass("ui-dialog-dragging"),
                        i._blockFrames(),
                        i._trigger("dragStart", n, e(r))
                    },
                    drag: function(t, n) {
                        i._trigger("drag", t, e(n))
                    },
                    stop: function(r, a) {
                        n.position = [a.position.left - i.document.scrollLeft(), a.position.top - i.document.scrollTop()],
                        t(this).removeClass("ui-dialog-dragging"),
                        i._unblockFrames(),
                        i._trigger("dragStop", r, e(a))
                    }
                })
            },
            _makeResizable: function() {
                function e(t) {
                    return {
                        originalPosition: t.originalPosition,
                        originalSize: t.originalSize,
                        position: t.position,
                        size: t.size
                    }
                }
                var i = this
                  , n = this.options
                  , r = n.resizable
                  , a = this.uiDialog.css("position")
                  , s = "string" == typeof r ? r : "n,e,s,w,se,sw,ne,nw";
                this.uiDialog.resizable({
                    cancel: ".ui-dialog-content",
                    containment: "document",
                    alsoResize: this.element,
                    maxWidth: n.maxWidth,
                    maxHeight: n.maxHeight,
                    minWidth: n.minWidth,
                    minHeight: this._minHeight(),
                    handles: s,
                    start: function(n, r) {
                        t(this).addClass("ui-dialog-resizing"),
                        i._blockFrames(),
                        i._trigger("resizeStart", n, e(r))
                    },
                    resize: function(t, n) {
                        i._trigger("resize", t, e(n))
                    },
                    stop: function(r, a) {
                        n.height = t(this).height(),
                        n.width = t(this).width(),
                        t(this).removeClass("ui-dialog-resizing"),
                        i._unblockFrames(),
                        i._trigger("resizeStop", r, e(a))
                    }
                }).css("position", a)
            },
            _minHeight: function() {
                var t = this.options;
                return "auto" === t.height ? t.minHeight : Math.min(t.minHeight, t.height)
            },
            _position: function() {
                var t = this.uiDialog.is(":visible");
                t || this.uiDialog.show(),
                this.uiDialog.position(this.options.position),
                t || this.uiDialog.hide()
            },
            _setOptions: function(e) {
                var r = this
                  , a = !1
                  , s = {};
                t.each(e, function(t, e) {
                    r._setOption(t, e),
                    t in i && (a = !0),
                    t in n && (s[t] = e)
                }),
                a && (this._size(),
                this._position()),
                this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", s)
            },
            _setOption: function(t, e) {
                var i, n, r = this.uiDialog;
                "dialogClass" === t && r.removeClass(this.options.dialogClass).addClass(e),
                "disabled" !== t && (this._super(t, e),
                "appendTo" === t && this.uiDialog.appendTo(this._appendTo()),
                "buttons" === t && this._createButtons(),
                "closeText" === t && this.uiDialogTitlebarClose.button({
                    label: "" + e
                }),
                "draggable" === t && (i = r.is(":data(ui-draggable)"),
                i && !e && r.draggable("destroy"),
                !i && e && this._makeDraggable()),
                "position" === t && this._position(),
                "resizable" === t && (n = r.is(":data(ui-resizable)"),
                n && !e && r.resizable("destroy"),
                n && "string" == typeof e && r.resizable("option", "handles", e),
                n || e === !1 || this._makeResizable()),
                "title" === t && this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))
            },
            _size: function() {
                var t, e, i, n = this.options;
                this.element.show().css({
                    width: "auto",
                    minHeight: 0,
                    maxHeight: "none",
                    height: 0
                }),
                n.minWidth > n.width && (n.width = n.minWidth),
                t = this.uiDialog.css({
                    height: "auto",
                    width: n.width
                }).outerHeight(),
                e = Math.max(0, n.minHeight - t),
                i = "number" == typeof n.maxHeight ? Math.max(0, n.maxHeight - t) : "none",
                "auto" === n.height ? this.element.css({
                    minHeight: e,
                    maxHeight: i,
                    height: "auto"
                }) : this.element.height(Math.max(0, n.height - t)),
                this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", "minHeight", this._minHeight())
            },
            _blockFrames: function() {
                this.iframeBlocks = this.document.find("iframe").map(function() {
                    var e = t(this);
                    return t("<div>").css({
                        position: "absolute",
                        width: e.outerWidth(),
                        height: e.outerHeight()
                    }).appendTo(e.parent()).offset(e.offset())[0]
                })
            },
            _unblockFrames: function() {
                this.iframeBlocks && (this.iframeBlocks.remove(),
                delete this.iframeBlocks)
            },
            _allowInteraction: function(e) {
                return !!t(e.target).closest(".ui-dialog").length || !!t(e.target).closest(".ui-datepicker").length
            },
            _createOverlay: function() {
                if (this.options.modal) {
                    var e = this
                      , i = this.widgetFullName;
                    t.ui.dialog.overlayInstances || this._delay(function() {
                        t.ui.dialog.overlayInstances && this.document.bind("focusin.dialog", function(n) {
                            e._allowInteraction(n) || (n.preventDefault(),
                            t(".ui-dialog:visible:last .ui-dialog-content").data(i)._focusTabbable())
                        })
                    }),
                    this.overlay = t("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),
                    this._on(this.overlay, {
                        mousedown: "_keepFocus"
                    }),
                    t.ui.dialog.overlayInstances++
                }
            },
            _destroyOverlay: function() {
                this.options.modal && this.overlay && (t.ui.dialog.overlayInstances--,
                t.ui.dialog.overlayInstances || this.document.unbind("focusin.dialog"),
                this.overlay.remove(),
                this.overlay = null)
            }
        }),
        t.ui.dialog.overlayInstances = 0,
        t.uiBackCompat !== !1 && t.widget("ui.dialog", t.ui.dialog, {
            _position: function() {
                var e, i = this.options.position, n = [], r = [0, 0];
                i ? (("string" == typeof i || "object" == typeof i && "0"in i) && (n = i.split ? i.split(" ") : [i[0], i[1]],
                1 === n.length && (n[1] = n[0]),
                t.each(["left", "top"], function(t, e) {
                    +n[t] === n[t] && (r[t] = n[t],
                    n[t] = e)
                }),
                i = {
                    my: n[0] + (r[0] < 0 ? r[0] : "+" + r[0]) + " " + n[1] + (r[1] < 0 ? r[1] : "+" + r[1]),
                    at: n.join(" ")
                }),
                i = t.extend({}, t.ui.dialog.prototype.options.position, i)) : i = t.ui.dialog.prototype.options.position,
                e = this.uiDialog.is(":visible"),
                e || this.uiDialog.show(),
                this.uiDialog.position(i),
                e || this.uiDialog.hide()
            }
        })
    }(n),
    function(t, e) {
        var i = /up|down|vertical/
          , n = /up|left|vertical|horizontal/;
        t.effects.effect.blind = function(e, r) {
            var a, s, o, u = t(this), l = ["position", "top", "bottom", "left", "right", "height", "width"], c = t.effects.setMode(u, e.mode || "hide"), h = e.direction || "up", d = i.test(h), p = d ? "height" : "width", f = d ? "top" : "left", g = n.test(h), m = {}, v = "show" === c;
            u.parent().is(".ui-effects-wrapper") ? t.effects.save(u.parent(), l) : t.effects.save(u, l),
            u.show(),
            a = t.effects.createWrapper(u).css({
                overflow: "hidden"
            }),
            s = a[p](),
            o = parseFloat(a.css(f)) || 0,
            m[p] = v ? s : 0,
            g || (u.css(d ? "bottom" : "right", 0).css(d ? "top" : "left", "auto").css({
                position: "absolute"
            }),
            m[f] = v ? o : s + o),
            v && (a.css(p, 0),
            g || a.css(f, o + s)),
            a.animate(m, {
                duration: e.duration,
                easing: e.easing,
                queue: !1,
                complete: function() {
                    "hide" === c && u.hide(),
                    t.effects.restore(u, l),
                    t.effects.removeWrapper(u),
                    r()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.bounce = function(e, i) {
            var n, r, a, s = t(this), o = ["position", "top", "bottom", "left", "right", "height", "width"], u = t.effects.setMode(s, e.mode || "effect"), l = "hide" === u, c = "show" === u, h = e.direction || "up", d = e.distance, p = e.times || 5, f = 2 * p + (c || l ? 1 : 0), g = e.duration / f, m = e.easing, v = "up" === h || "down" === h ? "top" : "left", _ = "up" === h || "left" === h, b = s.queue(), x = b.length;
            for ((c || l) && o.push("opacity"),
            t.effects.save(s, o),
            s.show(),
            t.effects.createWrapper(s),
            d || (d = s["top" === v ? "outerHeight" : "outerWidth"]() / 3),
            c && (a = {
                opacity: 1
            },
            a[v] = 0,
            s.css("opacity", 0).css(v, _ ? 2 * -d : 2 * d).animate(a, g, m)),
            l && (d /= Math.pow(2, p - 1)),
            a = {},
            a[v] = 0,
            n = 0; n < p; n++)
                r = {},
                r[v] = (_ ? "-=" : "+=") + d,
                s.animate(r, g, m).animate(a, g, m),
                d = l ? 2 * d : d / 2;
            l && (r = {
                opacity: 0
            },
            r[v] = (_ ? "-=" : "+=") + d,
            s.animate(r, g, m)),
            s.queue(function() {
                l && s.hide(),
                t.effects.restore(s, o),
                t.effects.removeWrapper(s),
                i()
            }),
            x > 1 && b.splice.apply(b, [1, 0].concat(b.splice(x, f + 1))),
            s.dequeue()
        }
    }(n),
    function(t, e) {
        t.effects.effect.clip = function(e, i) {
            var n, r, a, s = t(this), o = ["position", "top", "bottom", "left", "right", "height", "width"], u = t.effects.setMode(s, e.mode || "hide"), l = "show" === u, c = e.direction || "vertical", h = "vertical" === c, d = h ? "height" : "width", p = h ? "top" : "left", f = {};
            t.effects.save(s, o),
            s.show(),
            n = t.effects.createWrapper(s).css({
                overflow: "hidden"
            }),
            r = "IMG" === s[0].tagName ? n : s,
            a = r[d](),
            l && (r.css(d, 0),
            r.css(p, a / 2)),
            f[d] = l ? a : 0,
            f[p] = l ? 0 : a / 2,
            r.animate(f, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: function() {
                    l || s.hide(),
                    t.effects.restore(s, o),
                    t.effects.removeWrapper(s),
                    i()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.drop = function(e, i) {
            var n, r = t(this), a = ["position", "top", "bottom", "left", "right", "opacity", "height", "width"], s = t.effects.setMode(r, e.mode || "hide"), o = "show" === s, u = e.direction || "left", l = "up" === u || "down" === u ? "top" : "left", c = "up" === u || "left" === u ? "pos" : "neg", h = {
                opacity: o ? 1 : 0
            };
            t.effects.save(r, a),
            r.show(),
            t.effects.createWrapper(r),
            n = e.distance || r["top" === l ? "outerHeight" : "outerWidth"](!0) / 2,
            o && r.css("opacity", 0).css(l, "pos" === c ? -n : n),
            h[l] = (o ? "pos" === c ? "+=" : "-=" : "pos" === c ? "-=" : "+=") + n,
            r.animate(h, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: function() {
                    "hide" === s && r.hide(),
                    t.effects.restore(r, a),
                    t.effects.removeWrapper(r),
                    i()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.explode = function(e, i) {
            function n() {
                b.push(this),
                b.length === h * d && r()
            }
            function r() {
                p.css({
                    visibility: "visible"
                }),
                t(b).remove(),
                g || p.hide(),
                i()
            }
            var a, s, o, u, l, c, h = e.pieces ? Math.round(Math.sqrt(e.pieces)) : 3, d = h, p = t(this), f = t.effects.setMode(p, e.mode || "hide"), g = "show" === f, m = p.show().css("visibility", "hidden").offset(), v = Math.ceil(p.outerWidth() / d), _ = Math.ceil(p.outerHeight() / h), b = [];
            for (a = 0; a < h; a++)
                for (u = m.top + a * _,
                c = a - (h - 1) / 2,
                s = 0; s < d; s++)
                    o = m.left + s * v,
                    l = s - (d - 1) / 2,
                    p.clone().appendTo("body").wrap("<div></div>").css({
                        position: "absolute",
                        visibility: "visible",
                        left: -s * v,
                        top: -a * _
                    }).parent().addClass("ui-effects-explode").css({
                        position: "absolute",
                        overflow: "hidden",
                        width: v,
                        height: _,
                        left: o + (g ? l * v : 0),
                        top: u + (g ? c * _ : 0),
                        opacity: g ? 0 : 1
                    }).animate({
                        left: o + (g ? 0 : l * v),
                        top: u + (g ? 0 : c * _),
                        opacity: g ? 1 : 0
                    }, e.duration || 500, e.easing, n)
        }
    }(n),
    function(t, e) {
        t.effects.effect.fade = function(e, i) {
            var n = t(this)
              , r = t.effects.setMode(n, e.mode || "toggle");
            n.animate({
                opacity: r
            }, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: i
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.fold = function(e, i) {
            var n, r, a = t(this), s = ["position", "top", "bottom", "left", "right", "height", "width"], o = t.effects.setMode(a, e.mode || "hide"), u = "show" === o, l = "hide" === o, c = e.size || 15, h = /([0-9]+)%/.exec(c), d = !!e.horizFirst, p = u !== d, f = p ? ["width", "height"] : ["height", "width"], g = e.duration / 2, m = {}, v = {};
            t.effects.save(a, s),
            a.show(),
            n = t.effects.createWrapper(a).css({
                overflow: "hidden"
            }),
            r = p ? [n.width(), n.height()] : [n.height(), n.width()],
            h && (c = parseInt(h[1], 10) / 100 * r[l ? 0 : 1]),
            u && n.css(d ? {
                height: 0,
                width: c
            } : {
                height: c,
                width: 0
            }),
            m[f[0]] = u ? r[0] : c,
            v[f[1]] = u ? r[1] : 0,
            n.animate(m, g, e.easing).animate(v, g, e.easing, function() {
                l && a.hide(),
                t.effects.restore(a, s),
                t.effects.removeWrapper(a),
                i()
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.highlight = function(e, i) {
            var n = t(this)
              , r = ["backgroundImage", "backgroundColor", "opacity"]
              , a = t.effects.setMode(n, e.mode || "show")
              , s = {
                backgroundColor: n.css("backgroundColor")
            };
            "hide" === a && (s.opacity = 0),
            t.effects.save(n, r),
            n.show().css({
                backgroundImage: "none",
                backgroundColor: e.color || "#ffff99"
            }).animate(s, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: function() {
                    "hide" === a && n.hide(),
                    t.effects.restore(n, r),
                    i()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.pulsate = function(e, i) {
            var n, r = t(this), a = t.effects.setMode(r, e.mode || "show"), s = "show" === a, o = "hide" === a, u = s || "hide" === a, l = 2 * (e.times || 5) + (u ? 1 : 0), c = e.duration / l, h = 0, d = r.queue(), p = d.length;
            for (!s && r.is(":visible") || (r.css("opacity", 0).show(),
            h = 1),
            n = 1; n < l; n++)
                r.animate({
                    opacity: h
                }, c, e.easing),
                h = 1 - h;
            r.animate({
                opacity: h
            }, c, e.easing),
            r.queue(function() {
                o && r.hide(),
                i()
            }),
            p > 1 && d.splice.apply(d, [1, 0].concat(d.splice(p, l + 1))),
            r.dequeue()
        }
    }(n),
    function(t, e) {
        t.effects.effect.puff = function(e, i) {
            var n = t(this)
              , r = t.effects.setMode(n, e.mode || "hide")
              , a = "hide" === r
              , s = parseInt(e.percent, 10) || 150
              , o = s / 100
              , u = {
                height: n.height(),
                width: n.width(),
                outerHeight: n.outerHeight(),
                outerWidth: n.outerWidth()
            };
            t.extend(e, {
                effect: "scale",
                queue: !1,
                fade: !0,
                mode: r,
                complete: i,
                percent: a ? s : 100,
                from: a ? u : {
                    height: u.height * o,
                    width: u.width * o,
                    outerHeight: u.outerHeight * o,
                    outerWidth: u.outerWidth * o
                }
            }),
            n.effect(e)
        }
        ,
        t.effects.effect.scale = function(e, i) {
            var n = t(this)
              , r = t.extend(!0, {}, e)
              , a = t.effects.setMode(n, e.mode || "effect")
              , s = parseInt(e.percent, 10) || (0 === parseInt(e.percent, 10) ? 0 : "hide" === a ? 0 : 100)
              , o = e.direction || "both"
              , u = e.origin
              , l = {
                height: n.height(),
                width: n.width(),
                outerHeight: n.outerHeight(),
                outerWidth: n.outerWidth()
            }
              , c = {
                y: "horizontal" !== o ? s / 100 : 1,
                x: "vertical" !== o ? s / 100 : 1
            };
            r.effect = "size",
            r.queue = !1,
            r.complete = i,
            "effect" !== a && (r.origin = u || ["middle", "center"],
            r.restore = !0),
            r.from = e.from || ("show" === a ? {
                height: 0,
                width: 0,
                outerHeight: 0,
                outerWidth: 0
            } : l),
            r.to = {
                height: l.height * c.y,
                width: l.width * c.x,
                outerHeight: l.outerHeight * c.y,
                outerWidth: l.outerWidth * c.x
            },
            r.fade && ("show" === a && (r.from.opacity = 0,
            r.to.opacity = 1),
            "hide" === a && (r.from.opacity = 1,
            r.to.opacity = 0)),
            n.effect(r)
        }
        ,
        t.effects.effect.size = function(e, i) {
            var n, r, a, s = t(this), o = ["position", "top", "bottom", "left", "right", "width", "height", "overflow", "opacity"], u = ["position", "top", "bottom", "left", "right", "overflow", "opacity"], l = ["width", "height", "overflow"], c = ["fontSize"], h = ["borderTopWidth", "borderBottomWidth", "paddingTop", "paddingBottom"], d = ["borderLeftWidth", "borderRightWidth", "paddingLeft", "paddingRight"], p = t.effects.setMode(s, e.mode || "effect"), f = e.restore || "effect" !== p, g = e.scale || "both", m = e.origin || ["middle", "center"], v = s.css("position"), _ = f ? o : u, b = {
                height: 0,
                width: 0,
                outerHeight: 0,
                outerWidth: 0
            };
            "show" === p && s.show(),
            n = {
                height: s.height(),
                width: s.width(),
                outerHeight: s.outerHeight(),
                outerWidth: s.outerWidth()
            },
            "toggle" === e.mode && "show" === p ? (s.from = e.to || b,
            s.to = e.from || n) : (s.from = e.from || ("show" === p ? b : n),
            s.to = e.to || ("hide" === p ? b : n)),
            a = {
                from: {
                    y: s.from.height / n.height,
                    x: s.from.width / n.width
                },
                to: {
                    y: s.to.height / n.height,
                    x: s.to.width / n.width
                }
            },
            "box" !== g && "both" !== g || (a.from.y !== a.to.y && (_ = _.concat(h),
            s.from = t.effects.setTransition(s, h, a.from.y, s.from),
            s.to = t.effects.setTransition(s, h, a.to.y, s.to)),
            a.from.x !== a.to.x && (_ = _.concat(d),
            s.from = t.effects.setTransition(s, d, a.from.x, s.from),
            s.to = t.effects.setTransition(s, d, a.to.x, s.to))),
            "content" !== g && "both" !== g || a.from.y !== a.to.y && (_ = _.concat(c).concat(l),
            s.from = t.effects.setTransition(s, c, a.from.y, s.from),
            s.to = t.effects.setTransition(s, c, a.to.y, s.to)),
            t.effects.save(s, _),
            s.show(),
            t.effects.createWrapper(s),
            s.css("overflow", "hidden").css(s.from),
            m && (r = t.effects.getBaseline(m, n),
            s.from.top = (n.outerHeight - s.outerHeight()) * r.y,
            s.from.left = (n.outerWidth - s.outerWidth()) * r.x,
            s.to.top = (n.outerHeight - s.to.outerHeight) * r.y,
            s.to.left = (n.outerWidth - s.to.outerWidth) * r.x),
            s.css(s.from),
            "content" !== g && "both" !== g || (h = h.concat(["marginTop", "marginBottom"]).concat(c),
            d = d.concat(["marginLeft", "marginRight"]),
            l = o.concat(h).concat(d),
            s.find("*[width]").each(function() {
                var i = t(this)
                  , n = {
                    height: i.height(),
                    width: i.width(),
                    outerHeight: i.outerHeight(),
                    outerWidth: i.outerWidth()
                };
                f && t.effects.save(i, l),
                i.from = {
                    height: n.height * a.from.y,
                    width: n.width * a.from.x,
                    outerHeight: n.outerHeight * a.from.y,
                    outerWidth: n.outerWidth * a.from.x
                },
                i.to = {
                    height: n.height * a.to.y,
                    width: n.width * a.to.x,
                    outerHeight: n.height * a.to.y,
                    outerWidth: n.width * a.to.x
                },
                a.from.y !== a.to.y && (i.from = t.effects.setTransition(i, h, a.from.y, i.from),
                i.to = t.effects.setTransition(i, h, a.to.y, i.to)),
                a.from.x !== a.to.x && (i.from = t.effects.setTransition(i, d, a.from.x, i.from),
                i.to = t.effects.setTransition(i, d, a.to.x, i.to)),
                i.css(i.from),
                i.animate(i.to, e.duration, e.easing, function() {
                    f && t.effects.restore(i, l)
                })
            })),
            s.animate(s.to, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: function() {
                    0 === s.to.opacity && s.css("opacity", s.from.opacity),
                    "hide" === p && s.hide(),
                    t.effects.restore(s, _),
                    f || ("static" === v ? s.css({
                        position: "relative",
                        top: s.to.top,
                        left: s.to.left
                    }) : t.each(["top", "left"], function(t, e) {
                        s.css(e, function(e, i) {
                            var n = parseInt(i, 10)
                              , r = t ? s.to.left : s.to.top;
                            return "auto" === i ? r + "px" : n + r + "px"
                        })
                    })),
                    t.effects.removeWrapper(s),
                    i()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.shake = function(e, i) {
            var n, r = t(this), a = ["position", "top", "bottom", "left", "right", "height", "width"], s = t.effects.setMode(r, e.mode || "effect"), o = e.direction || "left", u = e.distance || 20, l = e.times || 3, c = 2 * l + 1, h = Math.round(e.duration / c), d = "up" === o || "down" === o ? "top" : "left", p = "up" === o || "left" === o, f = {}, g = {}, m = {}, v = r.queue(), _ = v.length;
            for (t.effects.save(r, a),
            r.show(),
            t.effects.createWrapper(r),
            f[d] = (p ? "-=" : "+=") + u,
            g[d] = (p ? "+=" : "-=") + 2 * u,
            m[d] = (p ? "-=" : "+=") + 2 * u,
            r.animate(f, h, e.easing),
            n = 1; n < l; n++)
                r.animate(g, h, e.easing).animate(m, h, e.easing);
            r.animate(g, h, e.easing).animate(f, h / 2, e.easing).queue(function() {
                "hide" === s && r.hide(),
                t.effects.restore(r, a),
                t.effects.removeWrapper(r),
                i()
            }),
            _ > 1 && v.splice.apply(v, [1, 0].concat(v.splice(_, c + 1))),
            r.dequeue()
        }
    }(n),
    function(t, e) {
        t.effects.effect.slide = function(e, i) {
            var n, r = t(this), a = ["position", "top", "bottom", "left", "right", "width", "height"], s = t.effects.setMode(r, e.mode || "show"), o = "show" === s, u = e.direction || "left", l = "up" === u || "down" === u ? "top" : "left", c = "up" === u || "left" === u, h = {};
            t.effects.save(r, a),
            r.show(),
            n = e.distance || r["top" === l ? "outerHeight" : "outerWidth"](!0),
            t.effects.createWrapper(r).css({
                overflow: "hidden"
            }),
            o && r.css(l, c ? isNaN(n) ? "-" + n : -n : n),
            h[l] = (o ? c ? "+=" : "-=" : c ? "-=" : "+=") + n,
            r.animate(h, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: function() {
                    "hide" === s && r.hide(),
                    t.effects.restore(r, a),
                    t.effects.removeWrapper(r),
                    i()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.transfer = function(e, i) {
            var n = t(this)
              , r = t(e.to)
              , a = "fixed" === r.css("position")
              , s = t("body")
              , o = a ? s.scrollTop() : 0
              , u = a ? s.scrollLeft() : 0
              , l = r.offset()
              , c = {
                top: l.top - o,
                left: l.left - u,
                height: r.innerHeight(),
                width: r.innerWidth()
            }
              , h = n.offset()
              , d = t("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({
                top: h.top - o,
                left: h.left - u,
                height: n.innerHeight(),
                width: n.innerWidth(),
                position: a ? "fixed" : "absolute"
            }).animate(c, e.duration, e.easing, function() {
                d.remove(),
                i()
            })
        }
    }(n),
    function(t, e) {
        t.widget("ui.menu", {
            version: "1.10.3",
            defaultElement: "<ul>",
            delay: 300,
            options: {
                icons: {
                    submenu: "ui-icon-carat-1-e"
                },
                menus: "ul",
                position: {
                    my: "left top",
                    at: "right top"
                },
                role: "menu",
                blur: null,
                focus: null,
                select: null
            },
            _create: function() {
                this.activeMenu = this.element,
                this.mouseHandled = !1,
                this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons", !!this.element.find(".ui-icon").length).attr({
                    role: this.options.role,
                    tabIndex: 0
                }).bind("click" + this.eventNamespace, t.proxy(function(t) {
                    this.options.disabled && t.preventDefault()
                }, this)),
                this.options.disabled && this.element.addClass("ui-state-disabled").attr("aria-disabled", "true"),
                this._on({
                    "mousedown .ui-menu-item > a": function(t) {
                        t.preventDefault()
                    },
                    "click .ui-state-disabled > a": function(t) {
                        t.preventDefault()
                    },
                    "click .ui-menu-item:has(a)": function(e) {
                        var i = t(e.target).closest(".ui-menu-item");
                        !this.mouseHandled && i.not(".ui-state-disabled").length && (this.mouseHandled = !0,
                        this.select(e),
                        i.has(".ui-menu").length ? this.expand(e) : this.element.is(":focus") || (this.element.trigger("focus", [!0]),
                        this.active && 1 === this.active.parents(".ui-menu").length && clearTimeout(this.timer)))
                    },
                    "mouseenter .ui-menu-item": function(e) {
                        var i = t(e.currentTarget);
                        i.siblings().children(".ui-state-active").removeClass("ui-state-active"),
                        this.focus(e, i)
                    },
                    mouseleave: "collapseAll",
                    "mouseleave .ui-menu": "collapseAll",
                    focus: function(t, e) {
                        var i = this.active || this.element.children(".ui-menu-item").eq(0);
                        e || this.focus(t, i)
                    },
                    blur: function(e) {
                        this._delay(function() {
                            t.contains(this.element[0], this.document[0].activeElement) || this.collapseAll(e)
                        })
                    },
                    keydown: "_keydown"
                }),
                this.refresh(),
                this._on(this.document, {
                    click: function(e) {
                        t(e.target).closest(".ui-menu").length || this.collapseAll(e),
                        this.mouseHandled = !1
                    }
                })
            },
            _destroy: function() {
                this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),
                this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function() {
                    var e = t(this);
                    e.data("ui-menu-submenu-carat") && e.remove()
                }),
                this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")
            },
            _keydown: function(e) {
                function i(t) {
                    return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
                }
                var n, r, a, s, o, u = !0;
                switch (e.keyCode) {
                case t.ui.keyCode.PAGE_UP:
                    this.previousPage(e);
                    break;
                case t.ui.keyCode.PAGE_DOWN:
                    this.nextPage(e);
                    break;
                case t.ui.keyCode.HOME:
                    this._move("first", "first", e);
                    break;
                case t.ui.keyCode.END:
                    this._move("last", "last", e);
                    break;
                case t.ui.keyCode.UP:
                    this.previous(e);
                    break;
                case t.ui.keyCode.DOWN:
                    this.next(e);
                    break;
                case t.ui.keyCode.LEFT:
                    this.collapse(e);
                    break;
                case t.ui.keyCode.RIGHT:
                    this.active && !this.active.is(".ui-state-disabled") && this.expand(e);
                    break;
                case t.ui.keyCode.ENTER:
                case t.ui.keyCode.SPACE:
                    this._activate(e);
                    break;
                case t.ui.keyCode.ESCAPE:
                    this.collapse(e);
                    break;
                default:
                    u = !1,
                    r = this.previousFilter || "",
                    a = String.fromCharCode(e.keyCode),
                    s = !1,
                    clearTimeout(this.filterTimer),
                    a === r ? s = !0 : a = r + a,
                    o = new RegExp("^" + i(a),"i"),
                    n = this.activeMenu.children(".ui-menu-item").filter(function() {
                        return o.test(t(this).children("a").text())
                    }),
                    n = s && n.index(this.active.next()) !== -1 ? this.active.nextAll(".ui-menu-item") : n,
                    n.length || (a = String.fromCharCode(e.keyCode),
                    o = new RegExp("^" + i(a),"i"),
                    n = this.activeMenu.children(".ui-menu-item").filter(function() {
                        return o.test(t(this).children("a").text())
                    })),
                    n.length ? (this.focus(e, n),
                    n.length > 1 ? (this.previousFilter = a,
                    this.filterTimer = this._delay(function() {
                        delete this.previousFilter
                    }, 1e3)) : delete this.previousFilter) : delete this.previousFilter
                }
                u && e.preventDefault()
            },
            _activate: function(t) {
                this.active.is(".ui-state-disabled") || (this.active.children("a[aria-haspopup='true']").length ? this.expand(t) : this.select(t))
            },
            refresh: function() {
                var e, i = this.options.icons.submenu, n = this.element.find(this.options.menus);
                n.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({
                    role: this.options.role,
                    "aria-hidden": "true",
                    "aria-expanded": "false"
                }).each(function() {
                    var e = t(this)
                      , n = e.prev("a")
                      , r = t("<span>").addClass("ui-menu-icon ui-icon " + i).data("ui-menu-submenu-carat", !0);
                    n.attr("aria-haspopup", "true").prepend(r),
                    e.attr("aria-labelledby", n.attr("id"))
                }),
                e = n.add(this.element),
                e.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role", "presentation").children("a").uniqueId().addClass("ui-corner-all").attr({
                    tabIndex: -1,
                    role: this._itemRole()
                }),
                e.children(":not(.ui-menu-item)").each(function() {
                    var e = t(this);
                    /[^\-\u2014\u2013\s]/.test(e.text()) || e.addClass("ui-widget-content ui-menu-divider")
                }),
                e.children(".ui-state-disabled").attr("aria-disabled", "true"),
                this.active && !t.contains(this.element[0], this.active[0]) && this.blur()
            },
            _itemRole: function() {
                return {
                    menu: "menuitem",
                    listbox: "option"
                }[this.options.role]
            },
            _setOption: function(t, e) {
                "icons" === t && this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),
                this._super(t, e)
            },
            focus: function(t, e) {
                var i, n;
                this.blur(t, t && "focus" === t.type),
                this._scrollIntoView(e),
                this.active = e.first(),
                n = this.active.children("a").addClass("ui-state-focus"),
                this.options.role && this.element.attr("aria-activedescendant", n.attr("id")),
                this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),
                t && "keydown" === t.type ? this._close() : this.timer = this._delay(function() {
                    this._close()
                }, this.delay),
                i = e.children(".ui-menu"),
                i.length && /^mouse/.test(t.type) && this._startOpening(i),
                this.activeMenu = e.parent(),
                this._trigger("focus", t, {
                    item: e
                })
            },
            _scrollIntoView: function(e) {
                var i, n, r, a, s, o;
                this._hasScroll() && (i = parseFloat(t.css(this.activeMenu[0], "borderTopWidth")) || 0,
                n = parseFloat(t.css(this.activeMenu[0], "paddingTop")) || 0,
                r = e.offset().top - this.activeMenu.offset().top - i - n,
                a = this.activeMenu.scrollTop(),
                s = this.activeMenu.height(),
                o = e.height(),
                r < 0 ? this.activeMenu.scrollTop(a + r) : r + o > s && this.activeMenu.scrollTop(a + r - s + o))
            },
            blur: function(t, e) {
                e || clearTimeout(this.timer),
                this.active && (this.active.children("a").removeClass("ui-state-focus"),
                this.active = null,
                this._trigger("blur", t, {
                    item: this.active
                }))
            },
            _startOpening: function(t) {
                clearTimeout(this.timer),
                "true" === t.attr("aria-hidden") && (this.timer = this._delay(function() {
                    this._close(),
                    this._open(t)
                }, this.delay))
            },
            _open: function(e) {
                var i = t.extend({
                    of: this.active
                }, this.options.position);
                clearTimeout(this.timer),
                this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden", "true"),
                e.show().removeAttr("aria-hidden").attr("aria-expanded", "true").position(i)
            },
            collapseAll: function(e, i) {
                clearTimeout(this.timer),
                this.timer = this._delay(function() {
                    var n = i ? this.element : t(e && e.target).closest(this.element.find(".ui-menu"));
                    n.length || (n = this.element),
                    this._close(n),
                    this.blur(e),
                    this.activeMenu = n
                }, this.delay)
            },
            _close: function(t) {
                t || (t = this.active ? this.active.parent() : this.element),
                t.find(".ui-menu").hide().attr("aria-hidden", "true").attr("aria-expanded", "false").end().find("a.ui-state-active").removeClass("ui-state-active")
            },
            collapse: function(t) {
                var e = this.active && this.active.parent().closest(".ui-menu-item", this.element);
                e && e.length && (this._close(),
                this.focus(t, e))
            },
            expand: function(t) {
                var e = this.active && this.active.children(".ui-menu ").children(".ui-menu-item").first();
                e && e.length && (this._open(e.parent()),
                this._delay(function() {
                    this.focus(t, e)
                }))
            },
            next: function(t) {
                this._move("next", "first", t)
            },
            previous: function(t) {
                this._move("prev", "last", t)
            },
            isFirstItem: function() {
                return this.active && !this.active.prevAll(".ui-menu-item").length
            },
            isLastItem: function() {
                return this.active && !this.active.nextAll(".ui-menu-item").length
            },
            _move: function(t, e, i) {
                var n;
                this.active && (n = "first" === t || "last" === t ? this.active["first" === t ? "prevAll" : "nextAll"](".ui-menu-item").eq(-1) : this.active[t + "All"](".ui-menu-item").eq(0)),
                n && n.length && this.active || (n = this.activeMenu.children(".ui-menu-item")[e]()),
                this.focus(i, n)
            },
            nextPage: function(e) {
                var i, n, r;
                return this.active ? void (this.isLastItem() || (this._hasScroll() ? (n = this.active.offset().top,
                r = this.element.height(),
                this.active.nextAll(".ui-menu-item").each(function() {
                    return i = t(this),
                    i.offset().top - n - r < 0
                }),
                this.focus(e, i)) : this.focus(e, this.activeMenu.children(".ui-menu-item")[this.active ? "last" : "first"]()))) : void this.next(e)
            },
            previousPage: function(e) {
                var i, n, r;
                return this.active ? void (this.isFirstItem() || (this._hasScroll() ? (n = this.active.offset().top,
                r = this.element.height(),
                this.active.prevAll(".ui-menu-item").each(function() {
                    return i = t(this),
                    i.offset().top - n + r > 0
                }),
                this.focus(e, i)) : this.focus(e, this.activeMenu.children(".ui-menu-item").first()))) : void this.next(e)
            },
            _hasScroll: function() {
                return this.element.outerHeight() < this.element.prop("scrollHeight")
            },
            select: function(e) {
                this.active = this.active || t(e.target).closest(".ui-menu-item");
                var i = {
                    item: this.active
                };
                this.active.has(".ui-menu").length || this.collapseAll(e, !0),
                this._trigger("select", e, i)
            }
        })
    }(n),
    function(t, e) {
        function i(t, e, i) {
            return [parseFloat(t[0]) * (p.test(t[0]) ? e / 100 : 1), parseFloat(t[1]) * (p.test(t[1]) ? i / 100 : 1)]
        }
        function n(e, i) {
            return parseInt(t.css(e, i), 10) || 0
        }
        function r(e) {
            var i = e[0];
            return 9 === i.nodeType ? {
                width: e.width(),
                height: e.height(),
                offset: {
                    top: 0,
                    left: 0
                }
            } : t.isWindow(i) ? {
                width: e.width(),
                height: e.height(),
                offset: {
                    top: e.scrollTop(),
                    left: e.scrollLeft()
                }
            } : i.preventDefault ? {
                width: 0,
                height: 0,
                offset: {
                    top: i.pageY,
                    left: i.pageX
                }
            } : {
                width: e.outerWidth(),
                height: e.outerHeight(),
                offset: e.offset()
            }
        }
        t.ui = t.ui || {};
        var a, s = Math.max, o = Math.abs, u = Math.round, l = /left|center|right/, c = /top|center|bottom/, h = /[\+\-]\d+(\.[\d]+)?%?/, d = /^\w+/, p = /%$/, f = t.fn.position;
        t.position = {
            scrollbarWidth: function() {
                if (a !== e)
                    return a;
                var i, n, r = t("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"), s = r.children()[0];
                return t("body").append(r),
                i = s.offsetWidth,
                r.css("overflow", "scroll"),
                n = s.offsetWidth,
                i === n && (n = r[0].clientWidth),
                r.remove(),
                a = i - n
            },
            getScrollInfo: function(e) {
                var i = e.isWindow ? "" : e.element.css("overflow-x")
                  , n = e.isWindow ? "" : e.element.css("overflow-y")
                  , r = "scroll" === i || "auto" === i && e.width < e.element[0].scrollWidth
                  , a = "scroll" === n || "auto" === n && e.height < e.element[0].scrollHeight;
                return {
                    width: a ? t.position.scrollbarWidth() : 0,
                    height: r ? t.position.scrollbarWidth() : 0
                }
            },
            getWithinInfo: function(e) {
                var i = t(e || window)
                  , n = t.isWindow(i[0]);
                return {
                    element: i,
                    isWindow: n,
                    offset: i.offset() || {
                        left: 0,
                        top: 0
                    },
                    scrollLeft: i.scrollLeft(),
                    scrollTop: i.scrollTop(),
                    width: n ? i.width() : i.outerWidth(),
                    height: n ? i.height() : i.outerHeight()
                }
            }
        },
        t.fn.position = function(e) {
            if (!e || !e.of)
                return f.apply(this, arguments);
            e = t.extend({}, e);
            var a, p, g, m, v, _, b = t(e.of), x = t.position.getWithinInfo(e.within), A = t.position.getScrollInfo(x), y = (e.collision || "flip").split(" "), S = {};
            return _ = r(b),
            b[0].preventDefault && (e.at = "left top"),
            p = _.width,
            g = _.height,
            m = _.offset,
            v = t.extend({}, m),
            t.each(["my", "at"], function() {
                var t, i, n = (e[this] || "").split(" ");
                1 === n.length && (n = l.test(n[0]) ? n.concat(["center"]) : c.test(n[0]) ? ["center"].concat(n) : ["center", "center"]),
                n[0] = l.test(n[0]) ? n[0] : "center",
                n[1] = c.test(n[1]) ? n[1] : "center",
                t = h.exec(n[0]),
                i = h.exec(n[1]),
                S[this] = [t ? t[0] : 0, i ? i[0] : 0],
                e[this] = [d.exec(n[0])[0], d.exec(n[1])[0]]
            }),
            1 === y.length && (y[1] = y[0]),
            "right" === e.at[0] ? v.left += p : "center" === e.at[0] && (v.left += p / 2),
            "bottom" === e.at[1] ? v.top += g : "center" === e.at[1] && (v.top += g / 2),
            a = i(S.at, p, g),
            v.left += a[0],
            v.top += a[1],
            this.each(function() {
                var r, l, c = t(this), h = c.outerWidth(), d = c.outerHeight(), f = n(this, "marginLeft"), _ = n(this, "marginTop"), C = h + f + n(this, "marginRight") + A.width, M = d + _ + n(this, "marginBottom") + A.height, w = t.extend({}, v), T = i(S.my, c.outerWidth(), c.outerHeight());
                "right" === e.my[0] ? w.left -= h : "center" === e.my[0] && (w.left -= h / 2),
                "bottom" === e.my[1] ? w.top -= d : "center" === e.my[1] && (w.top -= d / 2),
                w.left += T[0],
                w.top += T[1],
                t.support.offsetFractions || (w.left = u(w.left),
                w.top = u(w.top)),
                r = {
                    marginLeft: f,
                    marginTop: _
                },
                t.each(["left", "top"], function(i, n) {
                    t.ui.position[y[i]] && t.ui.position[y[i]][n](w, {
                        targetWidth: p,
                        targetHeight: g,
                        elemWidth: h,
                        elemHeight: d,
                        collisionPosition: r,
                        collisionWidth: C,
                        collisionHeight: M,
                        offset: [a[0] + T[0], a[1] + T[1]],
                        my: e.my,
                        at: e.at,
                        within: x,
                        elem: c
                    })
                }),
                e.using && (l = function(t) {
                    var i = m.left - w.left
                      , n = i + p - h
                      , r = m.top - w.top
                      , a = r + g - d
                      , u = {
                        target: {
                            element: b,
                            left: m.left,
                            top: m.top,
                            width: p,
                            height: g
                        },
                        element: {
                            element: c,
                            left: w.left,
                            top: w.top,
                            width: h,
                            height: d
                        },
                        horizontal: n < 0 ? "left" : i > 0 ? "right" : "center",
                        vertical: a < 0 ? "top" : r > 0 ? "bottom" : "middle"
                    };
                    p < h && o(i + n) < p && (u.horizontal = "center"),
                    g < d && o(r + a) < g && (u.vertical = "middle"),
                    s(o(i), o(n)) > s(o(r), o(a)) ? u.important = "horizontal" : u.important = "vertical",
                    e.using.call(this, t, u)
                }
                ),
                c.offset(t.extend(w, {
                    using: l
                }))
            })
        }
        ,
        t.ui.position = {
            fit: {
                left: function(t, e) {
                    var i, n = e.within, r = n.isWindow ? n.scrollLeft : n.offset.left, a = n.width, o = t.left - e.collisionPosition.marginLeft, u = r - o, l = o + e.collisionWidth - a - r;
                    e.collisionWidth > a ? u > 0 && l <= 0 ? (i = t.left + u + e.collisionWidth - a - r,
                    t.left += u - i) : l > 0 && u <= 0 ? t.left = r : u > l ? t.left = r + a - e.collisionWidth : t.left = r : u > 0 ? t.left += u : l > 0 ? t.left -= l : t.left = s(t.left - o, t.left)
                },
                top: function(t, e) {
                    var i, n = e.within, r = n.isWindow ? n.scrollTop : n.offset.top, a = e.within.height, o = t.top - e.collisionPosition.marginTop, u = r - o, l = o + e.collisionHeight - a - r;
                    e.collisionHeight > a ? u > 0 && l <= 0 ? (i = t.top + u + e.collisionHeight - a - r,
                    t.top += u - i) : l > 0 && u <= 0 ? t.top = r : u > l ? t.top = r + a - e.collisionHeight : t.top = r : u > 0 ? t.top += u : l > 0 ? t.top -= l : t.top = s(t.top - o, t.top)
                }
            },
            flip: {
                left: function(t, e) {
                    var i, n, r = e.within, a = r.offset.left + r.scrollLeft, s = r.width, u = r.isWindow ? r.scrollLeft : r.offset.left, l = t.left - e.collisionPosition.marginLeft, c = l - u, h = l + e.collisionWidth - s - u, d = "left" === e.my[0] ? -e.elemWidth : "right" === e.my[0] ? e.elemWidth : 0, p = "left" === e.at[0] ? e.targetWidth : "right" === e.at[0] ? -e.targetWidth : 0, f = -2 * e.offset[0];
                    c < 0 ? (i = t.left + d + p + f + e.collisionWidth - s - a,
                    (i < 0 || i < o(c)) && (t.left += d + p + f)) : h > 0 && (n = t.left - e.collisionPosition.marginLeft + d + p + f - u,
                    (n > 0 || o(n) < h) && (t.left += d + p + f))
                },
                top: function(t, e) {
                    var i, n, r = e.within, a = r.offset.top + r.scrollTop, s = r.height, u = r.isWindow ? r.scrollTop : r.offset.top, l = t.top - e.collisionPosition.marginTop, c = l - u, h = l + e.collisionHeight - s - u, d = "top" === e.my[1], p = d ? -e.elemHeight : "bottom" === e.my[1] ? e.elemHeight : 0, f = "top" === e.at[1] ? e.targetHeight : "bottom" === e.at[1] ? -e.targetHeight : 0, g = -2 * e.offset[1];
                    c < 0 ? (n = t.top + p + f + g + e.collisionHeight - s - a,
                    t.top + p + f + g > c && (n < 0 || n < o(c)) && (t.top += p + f + g)) : h > 0 && (i = t.top - e.collisionPosition.marginTop + p + f + g - u,
                    t.top + p + f + g > h && (i > 0 || o(i) < h) && (t.top += p + f + g))
                }
            },
            flipfit: {
                left: function() {
                    t.ui.position.flip.left.apply(this, arguments),
                    t.ui.position.fit.left.apply(this, arguments)
                },
                top: function() {
                    t.ui.position.flip.top.apply(this, arguments),
                    t.ui.position.fit.top.apply(this, arguments)
                }
            }
        },
        function() {
            var e, i, n, r, a, s = document.getElementsByTagName("body")[0], o = document.createElement("div");
            e = document.createElement(s ? "div" : "body"),
            n = {
                visibility: "hidden",
                width: 0,
                height: 0,
                border: 0,
                margin: 0,
                background: "none"
            },
            s && t.extend(n, {
                position: "absolute",
                left: "-1000px",
                top: "-1000px"
            });
            for (a in n)
                e.style[a] = n[a];
            e.appendChild(o),
            i = s || document.documentElement,
            i.insertBefore(e, i.firstChild),
            o.style.cssText = "position: absolute; left: 10.7432222px;",
            r = t(o).offset().left,
            t.support.offsetFractions = r > 10 && r < 11,
            e.innerHTML = "",
            i.removeChild(e)
        }()
    }(n),
    function(t, e) {
        t.widget("ui.progressbar", {
            version: "1.10.3",
            options: {
                max: 100,
                value: 0,
                change: null,
                complete: null
            },
            min: 0,
            _create: function() {
                this.oldValue = this.options.value = this._constrainedValue(),
                this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({
                    role: "progressbar",
                    "aria-valuemin": this.min
                }),
                this.valueDiv = t("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),
                this._refreshValue()
            },
            _destroy: function() {
                this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),
                this.valueDiv.remove()
            },
            value: function(t) {
                return t === e ? this.options.value : (this.options.value = this._constrainedValue(t),
                void this._refreshValue())
            },
            _constrainedValue: function(t) {
                return t === e && (t = this.options.value),
                this.indeterminate = t === !1,
                "number" != typeof t && (t = 0),
                !this.indeterminate && Math.min(this.options.max, Math.max(this.min, t))
            },
            _setOptions: function(t) {
                var e = t.value;
                delete t.value,
                this._super(t),
                this.options.value = this._constrainedValue(e),
                this._refreshValue()
            },
            _setOption: function(t, e) {
                "max" === t && (e = Math.max(this.min, e)),
                this._super(t, e)
            },
            _percentage: function() {
                return this.indeterminate ? 100 : 100 * (this.options.value - this.min) / (this.options.max - this.min)
            },
            _refreshValue: function() {
                var e = this.options.value
                  , i = this._percentage();
                this.valueDiv.toggle(this.indeterminate || e > this.min).toggleClass("ui-corner-right", e === this.options.max).width(i.toFixed(0) + "%"),
                this.element.toggleClass("ui-progressbar-indeterminate", this.indeterminate),
                this.indeterminate ? (this.element.removeAttr("aria-valuenow"),
                this.overlayDiv || (this.overlayDiv = t("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))) : (this.element.attr({
                    "aria-valuemax": this.options.max,
                    "aria-valuenow": e
                }),
                this.overlayDiv && (this.overlayDiv.remove(),
                this.overlayDiv = null)),
                this.oldValue !== e && (this.oldValue = e,
                this._trigger("change")),
                e === this.options.max && this._trigger("complete")
            }
        })
    }(n),
    function(t, e) {
        var i = 5;
        t.widget("ui.slider", t.ui.mouse, {
            version: "1.10.3",
            widgetEventPrefix: "slide",
            options: {
                animate: !1,
                distance: 0,
                max: 100,
                min: 0,
                orientation: "horizontal",
                range: !1,
                step: 1,
                value: 0,
                values: null,
                change: null,
                slide: null,
                start: null,
                stop: null
            },
            _create: function() {
                this._keySliding = !1,
                this._mouseSliding = !1,
                this._animateOff = !0,
                this._handleIndex = null,
                this._detectOrientation(),
                this._mouseInit(),
                this.element.addClass("ui-slider ui-slider-" + this.orientation + " ui-widget ui-widget-content ui-corner-all"),
                this._refresh(),
                this._setOption("disabled", this.options.disabled),
                this._animateOff = !1
            },
            _refresh: function() {
                this._createRange(),
                this._createHandles(),
                this._setupEvents(),
                this._refreshValue()
            },
            _createHandles: function() {
                var e, i, n = this.options, r = this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"), a = "<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>", s = [];
                for (i = n.values && n.values.length || 1,
                r.length > i && (r.slice(i).remove(),
                r = r.slice(0, i)),
                e = r.length; e < i; e++)
                    s.push(a);
                this.handles = r.add(t(s.join("")).appendTo(this.element)),
                this.handle = this.handles.eq(0),
                this.handles.each(function(e) {
                    t(this).data("ui-slider-handle-index", e)
                })
            },
            _createRange: function() {
                var e = this.options
                  , i = "";
                e.range ? (e.range === !0 && (e.values ? e.values.length && 2 !== e.values.length ? e.values = [e.values[0], e.values[0]] : t.isArray(e.values) && (e.values = e.values.slice(0)) : e.values = [this._valueMin(), this._valueMin()]),
                this.range && this.range.length ? this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({
                    left: "",
                    bottom: ""
                }) : (this.range = t("<div></div>").appendTo(this.element),
                i = "ui-slider-range ui-widget-header ui-corner-all"),
                this.range.addClass(i + ("min" === e.range || "max" === e.range ? " ui-slider-range-" + e.range : ""))) : this.range = t([])
            },
            _setupEvents: function() {
                var t = this.handles.add(this.range).filter("a");
                this._off(t),
                this._on(t, this._handleEvents),
                this._hoverable(t),
                this._focusable(t)
            },
            _destroy: function() {
                this.handles.remove(),
                this.range.remove(),
                this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),
                this._mouseDestroy()
            },
            _mouseCapture: function(e) {
                var i, n, r, a, s, o, u, l, c = this, h = this.options;
                return !h.disabled && (this.elementSize = {
                    width: this.element.outerWidth(),
                    height: this.element.outerHeight()
                },
                this.elementOffset = this.element.offset(),
                i = {
                    x: e.pageX,
                    y: e.pageY
                },
                n = this._normValueFromMouse(i),
                r = this._valueMax() - this._valueMin() + 1,
                this.handles.each(function(e) {
                    var i = Math.abs(n - c.values(e));
                    (r > i || r === i && (e === c._lastChangedValue || c.values(e) === h.min)) && (r = i,
                    a = t(this),
                    s = e)
                }),
                o = this._start(e, s),
                o !== !1 && (this._mouseSliding = !0,
                this._handleIndex = s,
                a.addClass("ui-state-active").focus(),
                u = a.offset(),
                l = !t(e.target).parents().addBack().is(".ui-slider-handle"),
                this._clickOffset = l ? {
                    left: 0,
                    top: 0
                } : {
                    left: e.pageX - u.left - a.width() / 2,
                    top: e.pageY - u.top - a.height() / 2 - (parseInt(a.css("borderTopWidth"), 10) || 0) - (parseInt(a.css("borderBottomWidth"), 10) || 0) + (parseInt(a.css("marginTop"), 10) || 0)
                },
                this.handles.hasClass("ui-state-hover") || this._slide(e, s, n),
                this._animateOff = !0,
                !0))
            },
            _mouseStart: function() {
                return !0
            },
            _mouseDrag: function(t) {
                var e = {
                    x: t.pageX,
                    y: t.pageY
                }
                  , i = this._normValueFromMouse(e);
                return this._slide(t, this._handleIndex, i),
                !1
            },
            _mouseStop: function(t) {
                return this.handles.removeClass("ui-state-active"),
                this._mouseSliding = !1,
                this._stop(t, this._handleIndex),
                this._change(t, this._handleIndex),
                this._handleIndex = null,
                this._clickOffset = null,
                this._animateOff = !1,
                !1
            },
            _detectOrientation: function() {
                this.orientation = "vertical" === this.options.orientation ? "vertical" : "horizontal"
            },
            _normValueFromMouse: function(t) {
                var e, i, n, r, a;
                return "horizontal" === this.orientation ? (e = this.elementSize.width,
                i = t.x - this.elementOffset.left - (this._clickOffset ? this._clickOffset.left : 0)) : (e = this.elementSize.height,
                i = t.y - this.elementOffset.top - (this._clickOffset ? this._clickOffset.top : 0)),
                n = i / e,
                n > 1 && (n = 1),
                n < 0 && (n = 0),
                "vertical" === this.orientation && (n = 1 - n),
                r = this._valueMax() - this._valueMin(),
                a = this._valueMin() + n * r,
                this._trimAlignValue(a)
            },
            _start: function(t, e) {
                var i = {
                    handle: this.handles[e],
                    value: this.value()
                };
                return this.options.values && this.options.values.length && (i.value = this.values(e),
                i.values = this.values()),
                this._trigger("start", t, i)
            },
            _slide: function(t, e, i) {
                var n, r, a;
                this.options.values && this.options.values.length ? (n = this.values(e ? 0 : 1),
                2 === this.options.values.length && this.options.range === !0 && (0 === e && i > n || 1 === e && i < n) && (i = n),
                i !== this.values(e) && (r = this.values(),
                r[e] = i,
                a = this._trigger("slide", t, {
                    handle: this.handles[e],
                    value: i,
                    values: r
                }),
                n = this.values(e ? 0 : 1),
                a !== !1 && this.values(e, i, !0))) : i !== this.value() && (a = this._trigger("slide", t, {
                    handle: this.handles[e],
                    value: i
                }),
                a !== !1 && this.value(i))
            },
            _stop: function(t, e) {
                var i = {
                    handle: this.handles[e],
                    value: this.value()
                };
                this.options.values && this.options.values.length && (i.value = this.values(e),
                i.values = this.values()),
                this._trigger("stop", t, i)
            },
            _change: function(t, e) {
                if (!this._keySliding && !this._mouseSliding) {
                    var i = {
                        handle: this.handles[e],
                        value: this.value()
                    };
                    this.options.values && this.options.values.length && (i.value = this.values(e),
                    i.values = this.values()),
                    this._lastChangedValue = e,
                    this._trigger("change", t, i)
                }
            },
            value: function(t) {
                return arguments.length ? (this.options.value = this._trimAlignValue(t),
                this._refreshValue(),
                void this._change(null, 0)) : this._value()
            },
            values: function(e, i) {
                var n, r, a;
                if (arguments.length > 1)
                    return this.options.values[e] = this._trimAlignValue(i),
                    this._refreshValue(),
                    void this._change(null, e);
                if (!arguments.length)
                    return this._values();
                if (!t.isArray(arguments[0]))
                    return this.options.values && this.options.values.length ? this._values(e) : this.value();
                for (n = this.options.values,
                r = arguments[0],
                a = 0; a < n.length; a += 1)
                    n[a] = this._trimAlignValue(r[a]),
                    this._change(null, a);
                this._refreshValue()
            },
            _setOption: function(e, i) {
                var n, r = 0;
                switch ("range" === e && this.options.range === !0 && ("min" === i ? (this.options.value = this._values(0),
                this.options.values = null) : "max" === i && (this.options.value = this._values(this.options.values.length - 1),
                this.options.values = null)),
                t.isArray(this.options.values) && (r = this.options.values.length),
                t.Widget.prototype._setOption.apply(this, arguments),
                e) {
                case "orientation":
                    this._detectOrientation(),
                    this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-" + this.orientation),
                    this._refreshValue();
                    break;
                case "value":
                    this._animateOff = !0,
                    this._refreshValue(),
                    this._change(null, 0),
                    this._animateOff = !1;
                    break;
                case "values":
                    for (this._animateOff = !0,
                    this._refreshValue(),
                    n = 0; n < r; n += 1)
                        this._change(null, n);
                    this._animateOff = !1;
                    break;
                case "min":
                case "max":
                    this._animateOff = !0,
                    this._refreshValue(),
                    this._animateOff = !1;
                    break;
                case "range":
                    this._animateOff = !0,
                    this._refresh(),
                    this._animateOff = !1
                }
            },
            _value: function() {
                var t = this.options.value;
                return t = this._trimAlignValue(t)
            },
            _values: function(t) {
                var e, i, n;
                if (arguments.length)
                    return e = this.options.values[t],
                    e = this._trimAlignValue(e);
                if (this.options.values && this.options.values.length) {
                    for (i = this.options.values.slice(),
                    n = 0; n < i.length; n += 1)
                        i[n] = this._trimAlignValue(i[n]);
                    return i
                }
                return []
            },
            _trimAlignValue: function(t) {
                if (t <= this._valueMin())
                    return this._valueMin();
                if (t >= this._valueMax())
                    return this._valueMax();
                var e = this.options.step > 0 ? this.options.step : 1
                  , i = (t - this._valueMin()) % e
                  , n = t - i;
                return 2 * Math.abs(i) >= e && (n += i > 0 ? e : -e),
                parseFloat(n.toFixed(5))
            },
            _valueMin: function() {
                return this.options.min
            },
            _valueMax: function() {
                return this.options.max
            },
            _refreshValue: function() {
                var e, i, n, r, a, s = this.options.range, o = this.options, u = this, l = !this._animateOff && o.animate, c = {};
                this.options.values && this.options.values.length ? this.handles.each(function(n) {
                    i = (u.values(n) - u._valueMin()) / (u._valueMax() - u._valueMin()) * 100,
                    c["horizontal" === u.orientation ? "left" : "bottom"] = i + "%",
                    t(this).stop(1, 1)[l ? "animate" : "css"](c, o.animate),
                    u.options.range === !0 && ("horizontal" === u.orientation ? (0 === n && u.range.stop(1, 1)[l ? "animate" : "css"]({
                        left: i + "%"
                    }, o.animate),
                    1 === n && u.range[l ? "animate" : "css"]({
                        width: i - e + "%"
                    }, {
                        queue: !1,
                        duration: o.animate
                    })) : (0 === n && u.range.stop(1, 1)[l ? "animate" : "css"]({
                        bottom: i + "%"
                    }, o.animate),
                    1 === n && u.range[l ? "animate" : "css"]({
                        height: i - e + "%"
                    }, {
                        queue: !1,
                        duration: o.animate
                    }))),
                    e = i
                }) : (n = this.value(),
                r = this._valueMin(),
                a = this._valueMax(),
                i = a !== r ? (n - r) / (a - r) * 100 : 0,
                c["horizontal" === this.orientation ? "left" : "bottom"] = i + "%",
                this.handle.stop(1, 1)[l ? "animate" : "css"](c, o.animate),
                "min" === s && "horizontal" === this.orientation && this.range.stop(1, 1)[l ? "animate" : "css"]({
                    width: i + "%"
                }, o.animate),
                "max" === s && "horizontal" === this.orientation && this.range[l ? "animate" : "css"]({
                    width: 100 - i + "%"
                }, {
                    queue: !1,
                    duration: o.animate
                }),
                "min" === s && "vertical" === this.orientation && this.range.stop(1, 1)[l ? "animate" : "css"]({
                    height: i + "%"
                }, o.animate),
                "max" === s && "vertical" === this.orientation && this.range[l ? "animate" : "css"]({
                    height: 100 - i + "%"
                }, {
                    queue: !1,
                    duration: o.animate
                }))
            },
            _handleEvents: {
                keydown: function(e) {
                    var n, r, a, s, o = t(e.target).data("ui-slider-handle-index");
                    switch (e.keyCode) {
                    case t.ui.keyCode.HOME:
                    case t.ui.keyCode.END:
                    case t.ui.keyCode.PAGE_UP:
                    case t.ui.keyCode.PAGE_DOWN:
                    case t.ui.keyCode.UP:
                    case t.ui.keyCode.RIGHT:
                    case t.ui.keyCode.DOWN:
                    case t.ui.keyCode.LEFT:
                        if (e.preventDefault(),
                        !this._keySliding && (this._keySliding = !0,
                        t(e.target).addClass("ui-state-active"),
                        n = this._start(e, o),
                        n === !1))
                            return
                    }
                    switch (s = this.options.step,
                    r = a = this.options.values && this.options.values.length ? this.values(o) : this.value(),
                    e.keyCode) {
                    case t.ui.keyCode.HOME:
                        a = this._valueMin();
                        break;
                    case t.ui.keyCode.END:
                        a = this._valueMax();
                        break;
                    case t.ui.keyCode.PAGE_UP:
                        a = this._trimAlignValue(r + (this._valueMax() - this._valueMin()) / i);
                        break;
                    case t.ui.keyCode.PAGE_DOWN:
                        a = this._trimAlignValue(r - (this._valueMax() - this._valueMin()) / i);
                        break;
                    case t.ui.keyCode.UP:
                    case t.ui.keyCode.RIGHT:
                        if (r === this._valueMax())
                            return;
                        a = this._trimAlignValue(r + s);
                        break;
                    case t.ui.keyCode.DOWN:
                    case t.ui.keyCode.LEFT:
                        if (r === this._valueMin())
                            return;
                        a = this._trimAlignValue(r - s)
                    }
                    this._slide(e, o, a)
                },
                click: function(t) {
                    t.preventDefault()
                },
                keyup: function(e) {
                    var i = t(e.target).data("ui-slider-handle-index");
                    this._keySliding && (this._keySliding = !1,
                    this._stop(e, i),
                    this._change(e, i),
                    t(e.target).removeClass("ui-state-active"))
                }
            }
        })
    }(n),
    function(t) {
        function e(t) {
            return function() {
                var e = this.element.val();
                t.apply(this, arguments),
                this._refresh(),
                e !== this.element.val() && this._trigger("change")
            }
        }
        t.widget("ui.spinner", {
            version: "1.10.3",
            defaultElement: "<input>",
            widgetEventPrefix: "spin",
            options: {
                culture: null,
                icons: {
                    down: "ui-icon-triangle-1-s",
                    up: "ui-icon-triangle-1-n"
                },
                incremental: !0,
                max: null,
                min: null,
                numberFormat: null,
                page: 10,
                step: 1,
                change: null,
                spin: null,
                start: null,
                stop: null
            },
            _create: function() {
                this._setOption("max", this.options.max),
                this._setOption("min", this.options.min),
                this._setOption("step", this.options.step),
                this._value(this.element.val(), !0),
                this._draw(),
                this._on(this._events),
                this._refresh(),
                this._on(this.window, {
                    beforeunload: function() {
                        this.element.removeAttr("autocomplete")
                    }
                })
            },
            _getCreateOptions: function() {
                var e = {}
                  , i = this.element;
                return t.each(["min", "max", "step"], function(t, n) {
                    var r = i.attr(n);
                    void 0 !== r && r.length && (e[n] = r)
                }),
                e
            },
            _events: {
                keydown: function(t) {
                    this._start(t) && this._keydown(t) && t.preventDefault()
                },
                keyup: "_stop",
                focus: function() {
                    this.previous = this.element.val()
                },
                blur: function(t) {
                    return this.cancelBlur ? void delete this.cancelBlur : (this._stop(),
                    this._refresh(),
                    void (this.previous !== this.element.val() && this._trigger("change", t)))
                },
                mousewheel: function(t, e) {
                    if (e) {
                        if (!this.spinning && !this._start(t))
                            return !1;
                        this._spin((e > 0 ? 1 : -1) * this.options.step, t),
                        clearTimeout(this.mousewheelTimer),
                        this.mousewheelTimer = this._delay(function() {
                            this.spinning && this._stop(t)
                        }, 100),
                        t.preventDefault()
                    }
                },
                "mousedown .ui-spinner-button": function(e) {
                    function i() {
                        var t = this.element[0] === this.document[0].activeElement;
                        t || (this.element.focus(),
                        this.previous = n,
                        this._delay(function() {
                            this.previous = n
                        }))
                    }
                    var n;
                    n = this.element[0] === this.document[0].activeElement ? this.previous : this.element.val(),
                    e.preventDefault(),
                    i.call(this),
                    this.cancelBlur = !0,
                    this._delay(function() {
                        delete this.cancelBlur,
                        i.call(this)
                    }),
                    this._start(e) !== !1 && this._repeat(null, t(e.currentTarget).hasClass("ui-spinner-up") ? 1 : -1, e)
                },
                "mouseup .ui-spinner-button": "_stop",
                "mouseenter .ui-spinner-button": function(e) {
                    if (t(e.currentTarget).hasClass("ui-state-active"))
                        return this._start(e) !== !1 && void this._repeat(null, t(e.currentTarget).hasClass("ui-spinner-up") ? 1 : -1, e)
                },
                "mouseleave .ui-spinner-button": "_stop"
            },
            _draw: function() {
                var t = this.uiSpinner = this.element.addClass("ui-spinner-input").attr("autocomplete", "off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());
                this.element.attr("role", "spinbutton"),
                this.buttons = t.find(".ui-spinner-button").attr("tabIndex", -1).button().removeClass("ui-corner-all"),
                this.buttons.height() > Math.ceil(.5 * t.height()) && t.height() > 0 && t.height(t.height()),
                this.options.disabled && this.disable()
            },
            _keydown: function(e) {
                var i = this.options
                  , n = t.ui.keyCode;
                switch (e.keyCode) {
                case n.UP:
                    return this._repeat(null, 1, e),
                    !0;
                case n.DOWN:
                    return this._repeat(null, -1, e),
                    !0;
                case n.PAGE_UP:
                    return this._repeat(null, i.page, e),
                    !0;
                case n.PAGE_DOWN:
                    return this._repeat(null, -i.page, e),
                    !0
                }
                return !1
            },
            _uiSpinnerHtml: function() {
                return "<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"
            },
            _buttonHtml: function() {
                return "<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon " + this.options.icons.up + "'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon " + this.options.icons.down + "'>&#9660;</span></a>"
            },
            _start: function(t) {
                return !(!this.spinning && this._trigger("start", t) === !1) && (this.counter || (this.counter = 1),
                this.spinning = !0,
                !0)
            },
            _repeat: function(t, e, i) {
                t = t || 500,
                clearTimeout(this.timer),
                this.timer = this._delay(function() {
                    this._repeat(40, e, i)
                }, t),
                this._spin(e * this.options.step, i)
            },
            _spin: function(t, e) {
                var i = this.value() || 0;
                this.counter || (this.counter = 1),
                i = this._adjustValue(i + t * this._increment(this.counter)),
                this.spinning && this._trigger("spin", e, {
                    value: i
                }) === !1 || (this._value(i),
                this.counter++)
            },
            _increment: function(e) {
                var i = this.options.incremental;
                return i ? t.isFunction(i) ? i(e) : Math.floor(e * e * e / 5e4 - e * e / 500 + 17 * e / 200 + 1) : 1
            },
            _precision: function() {
                var t = this._precisionOf(this.options.step);
                return null !== this.options.min && (t = Math.max(t, this._precisionOf(this.options.min))),
                t
            },
            _precisionOf: function(t) {
                var e = t.toString()
                  , i = e.indexOf(".");
                return i === -1 ? 0 : e.length - i - 1
            },
            _adjustValue: function(t) {
                var e, i, n = this.options;
                return e = null !== n.min ? n.min : 0,
                i = t - e,
                i = Math.round(i / n.step) * n.step,
                t = e + i,
                t = parseFloat(t.toFixed(this._precision())),
                null !== n.max && t > n.max ? n.max : null !== n.min && t < n.min ? n.min : t
            },
            _stop: function(t) {
                this.spinning && (clearTimeout(this.timer),
                clearTimeout(this.mousewheelTimer),
                this.counter = 0,
                this.spinning = !1,
                this._trigger("stop", t))
            },
            _setOption: function(t, e) {
                if ("culture" === t || "numberFormat" === t) {
                    var i = this._parse(this.element.val());
                    return this.options[t] = e,
                    void this.element.val(this._format(i))
                }
                "max" !== t && "min" !== t && "step" !== t || "string" == typeof e && (e = this._parse(e)),
                "icons" === t && (this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(e.up),
                this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(e.down)),
                this._super(t, e),
                "disabled" === t && (e ? (this.element.prop("disabled", !0),
                this.buttons.button("disable")) : (this.element.prop("disabled", !1),
                this.buttons.button("enable")))
            },
            _setOptions: e(function(t) {
                this._super(t),
                this._value(this.element.val())
            }),
            _parse: function(t) {
                return "string" == typeof t && "" !== t && (t = window.Globalize && this.options.numberFormat ? Globalize.parseFloat(t, 10, this.options.culture) : +t),
                "" === t || isNaN(t) ? null : t
            },
            _format: function(t) {
                return "" === t ? "" : window.Globalize && this.options.numberFormat ? Globalize.format(t, this.options.numberFormat, this.options.culture) : t
            },
            _refresh: function() {
                this.element.attr({
                    "aria-valuemin": this.options.min,
                    "aria-valuemax": this.options.max,
                    "aria-valuenow": this._parse(this.element.val())
                })
            },
            _value: function(t, e) {
                var i;
                "" !== t && (i = this._parse(t),
                null !== i && (e || (i = this._adjustValue(i)),
                t = this._format(i))),
                this.element.val(t),
                this._refresh()
            },
            _destroy: function() {
                this.element.removeClass("ui-spinner-input").prop("disabled", !1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),
                this.uiSpinner.replaceWith(this.element)
            },
            stepUp: e(function(t) {
                this._stepUp(t)
            }),
            _stepUp: function(t) {
                this._start() && (this._spin((t || 1) * this.options.step),
                this._stop())
            },
            stepDown: e(function(t) {
                this._stepDown(t)
            }),
            _stepDown: function(t) {
                this._start() && (this._spin((t || 1) * -this.options.step),
                this._stop())
            },
            pageUp: e(function(t) {
                this._stepUp((t || 1) * this.options.page)
            }),
            pageDown: e(function(t) {
                this._stepDown((t || 1) * this.options.page)
            }),
            value: function(t) {
                return arguments.length ? void e(this._value).call(this, t) : this._parse(this.element.val());
            },
            widget: function() {
                return this.uiSpinner
            }
        })
    }(n),
    function(t, e) {
        function i() {
            return ++r
        }
        function n(t) {
            return t.hash.length > 1 && decodeURIComponent(t.href.replace(a, "")) === decodeURIComponent(location.href.replace(a, ""))
        }
        var r = 0
          , a = /#.*$/;
        t.widget("ui.tabs", {
            version: "1.10.3",
            delay: 300,
            options: {
                active: null,
                collapsible: !1,
                event: "click",
                heightStyle: "content",
                hide: null,
                show: null,
                activate: null,
                beforeActivate: null,
                beforeLoad: null,
                load: null
            },
            _create: function() {
                var e = this
                  , i = this.options;
                this.running = !1,
                this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible", i.collapsible).delegate(".ui-tabs-nav > li", "mousedown" + this.eventNamespace, function(e) {
                    t(this).is(".ui-state-disabled") && e.preventDefault()
                }).delegate(".ui-tabs-anchor", "focus" + this.eventNamespace, function() {
                    t(this).closest("li").is(".ui-state-disabled") && this.blur()
                }),
                this._processTabs(),
                i.active = this._initialActive(),
                t.isArray(i.disabled) && (i.disabled = t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"), function(t) {
                    return e.tabs.index(t)
                }))).sort()),
                this.options.active !== !1 && this.anchors.length ? this.active = this._findActive(i.active) : this.active = t(),
                this._refresh(),
                this.active.length && this.load(i.active)
            },
            _initialActive: function() {
                var e = this.options.active
                  , i = this.options.collapsible
                  , n = location.hash.substring(1);
                return null === e && (n && this.tabs.each(function(i, r) {
                    if (t(r).attr("aria-controls") === n)
                        return e = i,
                        !1
                }),
                null === e && (e = this.tabs.index(this.tabs.filter(".ui-tabs-active"))),
                null !== e && e !== -1 || (e = !!this.tabs.length && 0)),
                e !== !1 && (e = this.tabs.index(this.tabs.eq(e)),
                e === -1 && (e = !i && 0)),
                !i && e === !1 && this.anchors.length && (e = 0),
                e
            },
            _getCreateEventData: function() {
                return {
                    tab: this.active,
                    panel: this.active.length ? this._getPanelForTab(this.active) : t()
                }
            },
            _tabKeydown: function(e) {
                var i = t(this.document[0].activeElement).closest("li")
                  , n = this.tabs.index(i)
                  , r = !0;
                if (!this._handlePageNav(e)) {
                    switch (e.keyCode) {
                    case t.ui.keyCode.RIGHT:
                    case t.ui.keyCode.DOWN:
                        n++;
                        break;
                    case t.ui.keyCode.UP:
                    case t.ui.keyCode.LEFT:
                        r = !1,
                        n--;
                        break;
                    case t.ui.keyCode.END:
                        n = this.anchors.length - 1;
                        break;
                    case t.ui.keyCode.HOME:
                        n = 0;
                        break;
                    case t.ui.keyCode.SPACE:
                        return e.preventDefault(),
                        clearTimeout(this.activating),
                        void this._activate(n);
                    case t.ui.keyCode.ENTER:
                        return e.preventDefault(),
                        clearTimeout(this.activating),
                        void this._activate(n !== this.options.active && n);
                    default:
                        return
                    }
                    e.preventDefault(),
                    clearTimeout(this.activating),
                    n = this._focusNextTab(n, r),
                    e.ctrlKey || (i.attr("aria-selected", "false"),
                    this.tabs.eq(n).attr("aria-selected", "true"),
                    this.activating = this._delay(function() {
                        this.option("active", n)
                    }, this.delay))
                }
            },
            _panelKeydown: function(e) {
                this._handlePageNav(e) || e.ctrlKey && e.keyCode === t.ui.keyCode.UP && (e.preventDefault(),
                this.active.focus())
            },
            _handlePageNav: function(e) {
                return e.altKey && e.keyCode === t.ui.keyCode.PAGE_UP ? (this._activate(this._focusNextTab(this.options.active - 1, !1)),
                !0) : e.altKey && e.keyCode === t.ui.keyCode.PAGE_DOWN ? (this._activate(this._focusNextTab(this.options.active + 1, !0)),
                !0) : void 0
            },
            _findNextTab: function(e, i) {
                function n() {
                    return e > r && (e = 0),
                    e < 0 && (e = r),
                    e
                }
                for (var r = this.tabs.length - 1; t.inArray(n(), this.options.disabled) !== -1; )
                    e = i ? e + 1 : e - 1;
                return e
            },
            _focusNextTab: function(t, e) {
                return t = this._findNextTab(t, e),
                this.tabs.eq(t).focus(),
                t
            },
            _setOption: function(t, e) {
                return "active" === t ? void this._activate(e) : "disabled" === t ? void this._setupDisabled(e) : (this._super(t, e),
                "collapsible" === t && (this.element.toggleClass("ui-tabs-collapsible", e),
                e || this.options.active !== !1 || this._activate(0)),
                "event" === t && this._setupEvents(e),
                void ("heightStyle" === t && this._setupHeightStyle(e)))
            },
            _tabId: function(t) {
                return t.attr("aria-controls") || "ui-tabs-" + i()
            },
            _sanitizeSelector: function(t) {
                return t ? t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g, "\\$&") : ""
            },
            refresh: function() {
                var e = this.options
                  , i = this.tablist.children(":has(a[href])");
                e.disabled = t.map(i.filter(".ui-state-disabled"), function(t) {
                    return i.index(t)
                }),
                this._processTabs(),
                e.active !== !1 && this.anchors.length ? this.active.length && !t.contains(this.tablist[0], this.active[0]) ? this.tabs.length === e.disabled.length ? (e.active = !1,
                this.active = t()) : this._activate(this._findNextTab(Math.max(0, e.active - 1), !1)) : e.active = this.tabs.index(this.active) : (e.active = !1,
                this.active = t()),
                this._refresh()
            },
            _refresh: function() {
                this._setupDisabled(this.options.disabled),
                this._setupEvents(this.options.event),
                this._setupHeightStyle(this.options.heightStyle),
                this.tabs.not(this.active).attr({
                    "aria-selected": "false",
                    tabIndex: -1
                }),
                this.panels.not(this._getPanelForTab(this.active)).hide().attr({
                    "aria-expanded": "false",
                    "aria-hidden": "true"
                }),
                this.active.length ? (this.active.addClass("ui-tabs-active ui-state-active").attr({
                    "aria-selected": "true",
                    tabIndex: 0
                }),
                this._getPanelForTab(this.active).show().attr({
                    "aria-expanded": "true",
                    "aria-hidden": "false"
                })) : this.tabs.eq(0).attr("tabIndex", 0)
            },
            _processTabs: function() {
                var e = this;
                this.tablist = this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role", "tablist"),
                this.tabs = this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({
                    role: "tab",
                    tabIndex: -1
                }),
                this.anchors = this.tabs.map(function() {
                    return t("a", this)[0]
                }).addClass("ui-tabs-anchor").attr({
                    role: "presentation",
                    tabIndex: -1
                }),
                this.panels = t(),
                this.anchors.each(function(i, r) {
                    var a, s, o, u = t(r).uniqueId().attr("id"), l = t(r).closest("li"), c = l.attr("aria-controls");
                    n(r) ? (a = r.hash,
                    s = e.element.find(e._sanitizeSelector(a))) : (o = e._tabId(l),
                    a = "#" + o,
                    s = e.element.find(a),
                    s.length || (s = e._createPanel(o),
                    s.insertAfter(e.panels[i - 1] || e.tablist)),
                    s.attr("aria-live", "polite")),
                    s.length && (e.panels = e.panels.add(s)),
                    c && l.data("ui-tabs-aria-controls", c),
                    l.attr({
                        "aria-controls": a.substring(1),
                        "aria-labelledby": u
                    }),
                    s.attr("aria-labelledby", u)
                }),
                this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role", "tabpanel")
            },
            _getList: function() {
                return this.element.find("ol,ul").eq(0)
            },
            _createPanel: function(e) {
                return t("<div>").attr("id", e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy", !0)
            },
            _setupDisabled: function(e) {
                t.isArray(e) && (e.length ? e.length === this.anchors.length && (e = !0) : e = !1);
                for (var i, n = 0; i = this.tabs[n]; n++)
                    e === !0 || t.inArray(n, e) !== -1 ? t(i).addClass("ui-state-disabled").attr("aria-disabled", "true") : t(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");
                this.options.disabled = e
            },
            _setupEvents: function(e) {
                var i = {
                    click: function(t) {
                        t.preventDefault()
                    }
                };
                e && t.each(e.split(" "), function(t, e) {
                    i[e] = "_eventHandler"
                }),
                this._off(this.anchors.add(this.tabs).add(this.panels)),
                this._on(this.anchors, i),
                this._on(this.tabs, {
                    keydown: "_tabKeydown"
                }),
                this._on(this.panels, {
                    keydown: "_panelKeydown"
                }),
                this._focusable(this.tabs),
                this._hoverable(this.tabs)
            },
            _setupHeightStyle: function(e) {
                var i, n = this.element.parent();
                "fill" === e ? (i = n.height(),
                i -= this.element.outerHeight() - this.element.height(),
                this.element.siblings(":visible").each(function() {
                    var e = t(this)
                      , n = e.css("position");
                    "absolute" !== n && "fixed" !== n && (i -= e.outerHeight(!0))
                }),
                this.element.children().not(this.panels).each(function() {
                    i -= t(this).outerHeight(!0)
                }),
                this.panels.each(function() {
                    t(this).height(Math.max(0, i - t(this).innerHeight() + t(this).height()))
                }).css("overflow", "auto")) : "auto" === e && (i = 0,
                this.panels.each(function() {
                    i = Math.max(i, t(this).height("").height())
                }).height(i))
            },
            _eventHandler: function(e) {
                var i = this.options
                  , n = this.active
                  , r = t(e.currentTarget)
                  , a = r.closest("li")
                  , s = a[0] === n[0]
                  , o = s && i.collapsible
                  , u = o ? t() : this._getPanelForTab(a)
                  , l = n.length ? this._getPanelForTab(n) : t()
                  , c = {
                    oldTab: n,
                    oldPanel: l,
                    newTab: o ? t() : a,
                    newPanel: u
                };
                e.preventDefault(),
                a.hasClass("ui-state-disabled") || a.hasClass("ui-tabs-loading") || this.running || s && !i.collapsible || this._trigger("beforeActivate", e, c) === !1 || (i.active = !o && this.tabs.index(a),
                this.active = s ? t() : a,
                this.xhr && this.xhr.abort(),
                l.length || u.length || t.error("jQuery UI Tabs: Mismatching fragment identifier."),
                u.length && this.load(this.tabs.index(a), e),
                this._toggle(e, c))
            },
            _toggle: function(e, i) {
                function n() {
                    a.running = !1,
                    a._trigger("activate", e, i)
                }
                function r() {
                    i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),
                    s.length && a.options.show ? a._show(s, a.options.show, n) : (s.show(),
                    n())
                }
                var a = this
                  , s = i.newPanel
                  , o = i.oldPanel;
                this.running = !0,
                o.length && this.options.hide ? this._hide(o, this.options.hide, function() {
                    i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),
                    r()
                }) : (i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),
                o.hide(),
                r()),
                o.attr({
                    "aria-expanded": "false",
                    "aria-hidden": "true"
                }),
                i.oldTab.attr("aria-selected", "false"),
                s.length && o.length ? i.oldTab.attr("tabIndex", -1) : s.length && this.tabs.filter(function() {
                    return 0 === t(this).attr("tabIndex")
                }).attr("tabIndex", -1),
                s.attr({
                    "aria-expanded": "true",
                    "aria-hidden": "false"
                }),
                i.newTab.attr({
                    "aria-selected": "true",
                    tabIndex: 0
                })
            },
            _activate: function(e) {
                var i, n = this._findActive(e);
                n[0] !== this.active[0] && (n.length || (n = this.active),
                i = n.find(".ui-tabs-anchor")[0],
                this._eventHandler({
                    target: i,
                    currentTarget: i,
                    preventDefault: t.noop
                }))
            },
            _findActive: function(e) {
                return e === !1 ? t() : this.tabs.eq(e)
            },
            _getIndex: function(t) {
                return "string" == typeof t && (t = this.anchors.index(this.anchors.filter("[href$='" + t + "']"))),
                t
            },
            _destroy: function() {
                this.xhr && this.xhr.abort(),
                this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),
                this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),
                this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),
                this.tabs.add(this.panels).each(function() {
                    t.data(this, "ui-tabs-destroy") ? t(this).remove() : t(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")
                }),
                this.tabs.each(function() {
                    var e = t(this)
                      , i = e.data("ui-tabs-aria-controls");
                    i ? e.attr("aria-controls", i).removeData("ui-tabs-aria-controls") : e.removeAttr("aria-controls")
                }),
                this.panels.show(),
                "content" !== this.options.heightStyle && this.panels.css("height", "")
            },
            enable: function(i) {
                var n = this.options.disabled;
                n !== !1 && (i === e ? n = !1 : (i = this._getIndex(i),
                n = t.isArray(n) ? t.map(n, function(t) {
                    return t !== i ? t : null
                }) : t.map(this.tabs, function(t, e) {
                    return e !== i ? e : null
                })),
                this._setupDisabled(n))
            },
            disable: function(i) {
                var n = this.options.disabled;
                if (n !== !0) {
                    if (i === e)
                        n = !0;
                    else {
                        if (i = this._getIndex(i),
                        t.inArray(i, n) !== -1)
                            return;
                        n = t.isArray(n) ? t.merge([i], n).sort() : [i]
                    }
                    this._setupDisabled(n)
                }
            },
            load: function(e, i) {
                e = this._getIndex(e);
                var r = this
                  , a = this.tabs.eq(e)
                  , s = a.find(".ui-tabs-anchor")
                  , o = this._getPanelForTab(a)
                  , u = {
                    tab: a,
                    panel: o
                };
                n(s[0]) || (this.xhr = t.ajax(this._ajaxSettings(s, i, u)),
                this.xhr && "canceled" !== this.xhr.statusText && (a.addClass("ui-tabs-loading"),
                o.attr("aria-busy", "true"),
                this.xhr.success(function(t) {
                    setTimeout(function() {
                        o.html(t),
                        r._trigger("load", i, u)
                    }, 1)
                }).complete(function(t, e) {
                    setTimeout(function() {
                        "abort" === e && r.panels.stop(!1, !0),
                        a.removeClass("ui-tabs-loading"),
                        o.removeAttr("aria-busy"),
                        t === r.xhr && delete r.xhr
                    }, 1)
                })))
            },
            _ajaxSettings: function(e, i, n) {
                var r = this;
                return {
                    url: e.attr("href"),
                    beforeSend: function(e, a) {
                        return r._trigger("beforeLoad", i, t.extend({
                            jqXHR: e,
                            ajaxSettings: a
                        }, n))
                    }
                }
            },
            _getPanelForTab: function(e) {
                var i = t(e).attr("aria-controls");
                return this.element.find(this._sanitizeSelector("#" + i))
            }
        })
    }(n),
    function(t) {
        function e(e, i) {
            var n = (e.attr("aria-describedby") || "").split(/\s+/);
            n.push(i),
            e.data("ui-tooltip-id", i).attr("aria-describedby", t.trim(n.join(" ")))
        }
        function i(e) {
            var i = e.data("ui-tooltip-id")
              , n = (e.attr("aria-describedby") || "").split(/\s+/)
              , r = t.inArray(i, n);
            r !== -1 && n.splice(r, 1),
            e.removeData("ui-tooltip-id"),
            n = t.trim(n.join(" ")),
            n ? e.attr("aria-describedby", n) : e.removeAttr("aria-describedby")
        }
        var n = 0;
        t.widget("ui.tooltip", {
            version: "1.10.3",
            options: {
                content: function() {
                    var e = t(this).attr("title") || "";
                    return t("<a>").text(e).html()
                },
                hide: !0,
                items: "[title]:not([disabled])",
                position: {
                    my: "left top+15",
                    at: "left bottom",
                    collision: "flipfit flip"
                },
                show: !0,
                tooltipClass: null,
                track: !1,
                close: null,
                open: null
            },
            _create: function() {
                this._on({
                    mouseover: "open",
                    focusin: "open"
                }),
                this.tooltips = {},
                this.parents = {},
                this.options.disabled && this._disable()
            },
            _setOption: function(e, i) {
                var n = this;
                return "disabled" === e ? (this[i ? "_disable" : "_enable"](),
                void (this.options[e] = i)) : (this._super(e, i),
                void ("content" === e && t.each(this.tooltips, function(t, e) {
                    n._updateContent(e)
                })))
            },
            _disable: function() {
                var e = this;
                t.each(this.tooltips, function(i, n) {
                    var r = t.Event("blur");
                    r.target = r.currentTarget = n[0],
                    e.close(r, !0)
                }),
                this.element.find(this.options.items).addBack().each(function() {
                    var e = t(this);
                    e.is("[title]") && e.data("ui-tooltip-title", e.attr("title")).attr("title", "")
                })
            },
            _enable: function() {
                this.element.find(this.options.items).addBack().each(function() {
                    var e = t(this);
                    e.data("ui-tooltip-title") && e.attr("title", e.data("ui-tooltip-title"))
                })
            },
            open: function(e) {
                var i = this
                  , n = t(e ? e.target : this.element).closest(this.options.items);
                n.length && !n.data("ui-tooltip-id") && (n.attr("title") && n.data("ui-tooltip-title", n.attr("title")),
                n.data("ui-tooltip-open", !0),
                e && "mouseover" === e.type && n.parents().each(function() {
                    var e, n = t(this);
                    n.data("ui-tooltip-open") && (e = t.Event("blur"),
                    e.target = e.currentTarget = this,
                    i.close(e, !0)),
                    n.attr("title") && (n.uniqueId(),
                    i.parents[this.id] = {
                        element: this,
                        title: n.attr("title")
                    },
                    n.attr("title", ""))
                }),
                this._updateContent(n, e))
            },
            _updateContent: function(t, e) {
                var i, n = this.options.content, r = this, a = e ? e.type : null;
                return "string" == typeof n ? this._open(e, t, n) : (i = n.call(t[0], function(i) {
                    t.data("ui-tooltip-open") && r._delay(function() {
                        e && (e.type = a),
                        this._open(e, t, i)
                    })
                }),
                void (i && this._open(e, t, i)))
            },
            _open: function(i, n, r) {
                function a(t) {
                    l.of = t,
                    s.is(":hidden") || s.position(l)
                }
                var s, o, u, l = t.extend({}, this.options.position);
                if (r) {
                    if (s = this._find(n),
                    s.length)
                        return void s.find(".ui-tooltip-content").html(r);
                    n.is("[title]") && (i && "mouseover" === i.type ? n.attr("title", "") : n.removeAttr("title")),
                    s = this._tooltip(n),
                    e(n, s.attr("id")),
                    s.find(".ui-tooltip-content").html(r),
                    this.options.track && i && /^mouse/.test(i.type) ? (this._on(this.document, {
                        mousemove: a
                    }),
                    a(i)) : s.position(t.extend({
                        of: n
                    }, this.options.position)),
                    s.hide(),
                    this._show(s, this.options.show),
                    this.options.show && this.options.show.delay && (u = this.delayedShow = setInterval(function() {
                        s.is(":visible") && (a(l.of),
                        clearInterval(u))
                    }, t.fx.interval)),
                    this._trigger("open", i, {
                        tooltip: s
                    }),
                    o = {
                        keyup: function(e) {
                            if (e.keyCode === t.ui.keyCode.ESCAPE) {
                                var i = t.Event(e);
                                i.currentTarget = n[0],
                                this.close(i, !0)
                            }
                        },
                        remove: function() {
                            this._removeTooltip(s)
                        }
                    },
                    i && "mouseover" !== i.type || (o.mouseleave = "close"),
                    i && "focusin" !== i.type || (o.focusout = "close"),
                    this._on(!0, n, o)
                }
            },
            close: function(e) {
                var n = this
                  , r = t(e ? e.currentTarget : this.element)
                  , a = this._find(r);
                this.closing || (clearInterval(this.delayedShow),
                r.data("ui-tooltip-title") && r.attr("title", r.data("ui-tooltip-title")),
                i(r),
                a.stop(!0),
                this._hide(a, this.options.hide, function() {
                    n._removeTooltip(t(this))
                }),
                r.removeData("ui-tooltip-open"),
                this._off(r, "mouseleave focusout keyup"),
                r[0] !== this.element[0] && this._off(r, "remove"),
                this._off(this.document, "mousemove"),
                e && "mouseleave" === e.type && t.each(this.parents, function(e, i) {
                    t(i.element).attr("title", i.title),
                    delete n.parents[e]
                }),
                this.closing = !0,
                this._trigger("close", e, {
                    tooltip: a
                }),
                this.closing = !1)
            },
            _tooltip: function(e) {
                var i = "ui-tooltip-" + n++
                  , r = t("<div>").attr({
                    id: i,
                    role: "tooltip"
                }).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content " + (this.options.tooltipClass || ""));
                return t("<div>").addClass("ui-tooltip-content").appendTo(r),
                r.appendTo(this.document[0].body),
                this.tooltips[i] = e,
                r
            },
            _find: function(e) {
                var i = e.data("ui-tooltip-id");
                return i ? t("#" + i) : t()
            },
            _removeTooltip: function(t) {
                t.remove(),
                delete this.tooltips[t.attr("id")]
            },
            _destroy: function() {
                var e = this;
                t.each(this.tooltips, function(i, n) {
                    var r = t.Event("blur");
                    r.target = r.currentTarget = n[0],
                    e.close(r, !0),
                    t("#" + i).remove(),
                    n.data("ui-tooltip-title") && (n.attr("title", n.data("ui-tooltip-title")),
                    n.removeData("ui-tooltip-title"))
                })
            }
        })
    }(n)
}
, , , , , , , function(t, e, i) {
    var n;
    /*! Hammer.JS - v2.0.4 - 2015-03-02
	 * http://hammerjs.github.io/
	 *
	 * Copyright (c) 2015 Jorik Tangelder;
	 * Licensed under the MIT license */
    !function(r, a, s, o) {
        "use strict";
        function u(t, e, i) {
            return setTimeout(f(t, i), e)
        }
        function l(t, e, i) {
            return !!Array.isArray(t) && (c(t, i[e], i),
            !0)
        }
        function c(t, e, i) {
            var n;
            if (t)
                if (t.forEach)
                    t.forEach(e, i);
                else if (t.length !== o)
                    for (n = 0; n < t.length; )
                        e.call(i, t[n], n, t),
                        n++;
                else
                    for (n in t)
                        t.hasOwnProperty(n) && e.call(i, t[n], n, t)
        }
        function h(t, e, i) {
            for (var n = Object.keys(e), r = 0; r < n.length; )
                (!i || i && t[n[r]] === o) && (t[n[r]] = e[n[r]]),
                r++;
            return t
        }
        function d(t, e) {
            return h(t, e, !0)
        }
        function p(t, e, i) {
            var n, r = e.prototype;
            n = t.prototype = Object.create(r),
            n.constructor = t,
            n._super = r,
            i && h(n, i)
        }
        function f(t, e) {
            return function() {
                return t.apply(e, arguments)
            }
        }
        function g(t, e) {
            return typeof t == ft ? t.apply(e ? e[0] || o : o, e) : t
        }
        function m(t, e) {
            return t === o ? e : t
        }
        function v(t, e, i) {
            c(A(e), function(e) {
                t.addEventListener(e, i, !1)
            })
        }
        function _(t, e, i) {
            c(A(e), function(e) {
                t.removeEventListener(e, i, !1)
            })
        }
        function b(t, e) {
            for (; t; ) {
                if (t == e)
                    return !0;
                t = t.parentNode
            }
            return !1
        }
        function x(t, e) {
            return t.indexOf(e) > -1
        }
        function A(t) {
            return t.trim().split(/\s+/g)
        }
        function y(t, e, i) {
            if (t.indexOf && !i)
                return t.indexOf(e);
            for (var n = 0; n < t.length; ) {
                if (i && t[n][i] == e || !i && t[n] === e)
                    return n;
                n++
            }
            return -1
        }
        function S(t) {
            return Array.prototype.slice.call(t, 0)
        }
        function C(t, e, i) {
            for (var n = [], r = [], a = 0; a < t.length; ) {
                var s = e ? t[a][e] : t[a];
                y(r, s) < 0 && n.push(t[a]),
                r[a] = s,
                a++
            }
            return i && (n = e ? n.sort(function(t, i) {
                return t[e] > i[e]
            }) : n.sort()),
            n
        }
        function M(t, e) {
            for (var i, n, r = e[0].toUpperCase() + e.slice(1), a = 0; a < dt.length; ) {
                if (i = dt[a],
                n = i ? i + r : e,
                n in t)
                    return n;
                a++
            }
            return o
        }
        function w() {
            return _t++
        }
        function T(t) {
            var e = t.ownerDocument || t;
            return e.defaultView || e.parentWindow || r
        }
        function E(t, e) {
            var i = this;
            this.manager = t,
            this.callback = e,
            this.element = t.element,
            this.target = t.options.inputTarget,
            this.domHandler = function(e) {
                g(t.options.enable, [t]) && i.handler(e)
            }
            ,
            this.init()
        }
        function I(t) {
            var e, i = t.options.inputClass;
            return new (e = i ? i : At ? H : yt ? q : xt ? Q : z)(t,k)
        }
        function k(t, e, i) {
            var n = i.pointers.length
              , r = i.changedPointers.length
              , a = e & Et && n - r === 0
              , s = e & (kt | Ft) && n - r === 0;
            i.isFirst = !!a,
            i.isFinal = !!s,
            a && (t.session = {}),
            i.eventType = e,
            F(t, i),
            t.emit("hammer.input", i),
            t.recognize(i),
            t.session.prevInput = i
        }
        function F(t, e) {
            var i = t.session
              , n = e.pointers
              , r = n.length;
            i.firstInput || (i.firstInput = R(e)),
            r > 1 && !i.firstMultiple ? i.firstMultiple = R(e) : 1 === r && (i.firstMultiple = !1);
            var a = i.firstInput
              , s = i.firstMultiple
              , o = s ? s.center : a.center
              , u = e.center = P(n);
            e.timeStamp = vt(),
            e.deltaTime = e.timeStamp - a.timeStamp,
            e.angle = B(o, u),
            e.distance = V(o, u),
            D(i, e),
            e.offsetDirection = O(e.deltaX, e.deltaY),
            e.scale = s ? G(s.pointers, n) : 1,
            e.rotation = s ? U(s.pointers, n) : 0,
            N(i, e);
            var l = t.element;
            b(e.srcEvent.target, l) && (l = e.srcEvent.target),
            e.target = l
        }
        function D(t, e) {
            var i = e.center
              , n = t.offsetDelta || {}
              , r = t.prevDelta || {}
              , a = t.prevInput || {};
            e.eventType !== Et && a.eventType !== kt || (r = t.prevDelta = {
                x: a.deltaX || 0,
                y: a.deltaY || 0
            },
            n = t.offsetDelta = {
                x: i.x,
                y: i.y
            }),
            e.deltaX = r.x + (i.x - n.x),
            e.deltaY = r.y + (i.y - n.y)
        }
        function N(t, e) {
            var i, n, r, a, s = t.lastInterval || e, u = e.timeStamp - s.timeStamp;
            if (e.eventType != Ft && (u > Tt || s.velocity === o)) {
                var l = s.deltaX - e.deltaX
                  , c = s.deltaY - e.deltaY
                  , h = L(u, l, c);
                n = h.x,
                r = h.y,
                i = mt(h.x) > mt(h.y) ? h.x : h.y,
                a = O(l, c),
                t.lastInterval = e
            } else
                i = s.velocity,
                n = s.velocityX,
                r = s.velocityY,
                a = s.direction;
            e.velocity = i,
            e.velocityX = n,
            e.velocityY = r,
            e.direction = a
        }
        function R(t) {
            for (var e = [], i = 0; i < t.pointers.length; )
                e[i] = {
                    clientX: gt(t.pointers[i].clientX),
                    clientY: gt(t.pointers[i].clientY)
                },
                i++;
            return {
                timeStamp: vt(),
                pointers: e,
                center: P(e),
                deltaX: t.deltaX,
                deltaY: t.deltaY
            }
        }
        function P(t) {
            var e = t.length;
            if (1 === e)
                return {
                    x: gt(t[0].clientX),
                    y: gt(t[0].clientY)
                };
            for (var i = 0, n = 0, r = 0; r < e; )
                i += t[r].clientX,
                n += t[r].clientY,
                r++;
            return {
                x: gt(i / e),
                y: gt(n / e)
            }
        }
        function L(t, e, i) {
            return {
                x: e / t || 0,
                y: i / t || 0
            }
        }
        function O(t, e) {
            return t === e ? Dt : mt(t) >= mt(e) ? t > 0 ? Nt : Rt : e > 0 ? Pt : Lt
        }
        function V(t, e, i) {
            i || (i = Ut);
            var n = e[i[0]] - t[i[0]]
              , r = e[i[1]] - t[i[1]];
            return Math.sqrt(n * n + r * r)
        }
        function B(t, e, i) {
            i || (i = Ut);
            var n = e[i[0]] - t[i[0]]
              , r = e[i[1]] - t[i[1]];
            return 180 * Math.atan2(r, n) / Math.PI
        }
        function U(t, e) {
            return B(e[1], e[0], Gt) - B(t[1], t[0], Gt)
        }
        function G(t, e) {
            return V(e[0], e[1], Gt) / V(t[0], t[1], Gt)
        }
        function z() {
            this.evEl = Ht,
            this.evWin = jt,
            this.allow = !0,
            this.pressed = !1,
            E.apply(this, arguments)
        }
        function H() {
            this.evEl = Yt,
            this.evWin = Qt,
            E.apply(this, arguments),
            this.store = this.manager.session.pointerEvents = []
        }
        function j() {
            this.evTarget = Kt,
            this.evWin = Jt,
            this.started = !1,
            E.apply(this, arguments)
        }
        function W(t, e) {
            var i = S(t.touches)
              , n = S(t.changedTouches);
            return e & (kt | Ft) && (i = C(i.concat(n), "identifier", !0)),
            [i, n]
        }
        function q() {
            this.evTarget = $t,
            this.targetIds = {},
            E.apply(this, arguments)
        }
        function Y(t, e) {
            var i = S(t.touches)
              , n = this.targetIds;
            if (e & (Et | It) && 1 === i.length)
                return n[i[0].identifier] = !0,
                [i, i];
            var r, a, s = S(t.changedTouches), o = [], u = this.target;
            if (a = i.filter(function(t) {
                return b(t.target, u)
            }),
            e === Et)
                for (r = 0; r < a.length; )
                    n[a[r].identifier] = !0,
                    r++;
            for (r = 0; r < s.length; )
                n[s[r].identifier] && o.push(s[r]),
                e & (kt | Ft) && delete n[s[r].identifier],
                r++;
            return o.length ? [C(a.concat(o), "identifier", !0), o] : void 0
        }
        function Q() {
            E.apply(this, arguments);
            var t = f(this.handler, this);
            this.touch = new q(this.manager,t),
            this.mouse = new z(this.manager,t)
        }
        function X(t, e) {
            this.manager = t,
            this.set(e)
        }
        function K(t) {
            if (x(t, ae))
                return ae;
            var e = x(t, se)
              , i = x(t, oe);
            return e && i ? se + " " + oe : e || i ? e ? se : oe : x(t, re) ? re : ne
        }
        function J(t) {
            this.id = w(),
            this.manager = null,
            this.options = d(t || {}, this.defaults),
            this.options.enable = m(this.options.enable, !0),
            this.state = ue,
            this.simultaneous = {},
            this.requireFail = []
        }
        function Z(t) {
            return t & pe ? "cancel" : t & he ? "end" : t & ce ? "move" : t & le ? "start" : ""
        }
        function $(t) {
            return t == Lt ? "down" : t == Pt ? "up" : t == Nt ? "left" : t == Rt ? "right" : ""
        }
        function tt(t, e) {
            var i = e.manager;
            return i ? i.get(t) : t
        }
        function et() {
            J.apply(this, arguments)
        }
        function it() {
            et.apply(this, arguments),
            this.pX = null,
            this.pY = null
        }
        function nt() {
            et.apply(this, arguments)
        }
        function rt() {
            J.apply(this, arguments),
            this._timer = null,
            this._input = null
        }
        function at() {
            et.apply(this, arguments)
        }
        function st() {
            et.apply(this, arguments)
        }
        function ot() {
            J.apply(this, arguments),
            this.pTime = !1,
            this.pCenter = !1,
            this._timer = null,
            this._input = null,
            this.count = 0
        }
        function ut(t, e) {
            return e = e || {},
            e.recognizers = m(e.recognizers, ut.defaults.preset),
            new lt(t,e)
        }
        function lt(t, e) {
            e = e || {},
            this.options = d(e, ut.defaults),
            this.options.inputTarget = this.options.inputTarget || t,
            this.handlers = {},
            this.session = {},
            this.recognizers = [],
            this.element = t,
            this.input = I(this),
            this.touchAction = new X(this,this.options.touchAction),
            ct(this, !0),
            c(e.recognizers, function(t) {
                var e = this.add(new t[0](t[1]));
                t[2] && e.recognizeWith(t[2]),
                t[3] && e.requireFailure(t[3])
            }, this)
        }
        function ct(t, e) {
            var i = t.element;
            i.style && c(t.options.cssProps, function(t, n) {
                i.style[M(i.style, n)] = e ? t : ""
            })
        }
        function ht(t, e) {
            var i = a.createEvent("Event");
            i.initEvent(t, !0, !0),
            i.gesture = e,
            e.target.dispatchEvent(i)
        }
        var dt = ["", "webkit", "moz", "MS", "ms", "o"]
          , pt = a.createElement("div")
          , ft = "function"
          , gt = Math.round
          , mt = Math.abs
          , vt = Date.now
          , _t = 1
          , bt = /mobile|tablet|ip(ad|hone|od)|android/i
          , xt = "ontouchstart"in r
          , At = M(r, "PointerEvent") !== o
          , yt = xt && bt.test(navigator.userAgent)
          , St = "touch"
          , Ct = "pen"
          , Mt = "mouse"
          , wt = "kinect"
          , Tt = 25
          , Et = 1
          , It = 2
          , kt = 4
          , Ft = 8
          , Dt = 1
          , Nt = 2
          , Rt = 4
          , Pt = 8
          , Lt = 16
          , Ot = Nt | Rt
          , Vt = Pt | Lt
          , Bt = Ot | Vt
          , Ut = ["x", "y"]
          , Gt = ["clientX", "clientY"];
        E.prototype = {
            handler: function() {},
            init: function() {
                this.evEl && v(this.element, this.evEl, this.domHandler),
                this.evTarget && v(this.target, this.evTarget, this.domHandler),
                this.evWin && v(T(this.element), this.evWin, this.domHandler)
            },
            destroy: function() {
                this.evEl && _(this.element, this.evEl, this.domHandler),
                this.evTarget && _(this.target, this.evTarget, this.domHandler),
                this.evWin && _(T(this.element), this.evWin, this.domHandler)
            }
        };
        var zt = {
            mousedown: Et,
            mousemove: It,
            mouseup: kt
        }
          , Ht = "mousedown"
          , jt = "mousemove mouseup";
        p(z, E, {
            handler: function(t) {
                var e = zt[t.type];
                e & Et && 0 === t.button && (this.pressed = !0),
                e & It && 1 !== t.which && (e = kt),
                this.pressed && this.allow && (e & kt && (this.pressed = !1),
                this.callback(this.manager, e, {
                    pointers: [t],
                    changedPointers: [t],
                    pointerType: Mt,
                    srcEvent: t
                }))
            }
        });
        var Wt = {
            pointerdown: Et,
            pointermove: It,
            pointerup: kt,
            pointercancel: Ft,
            pointerout: Ft
        }
          , qt = {
            2: St,
            3: Ct,
            4: Mt,
            5: wt
        }
          , Yt = "pointerdown"
          , Qt = "pointermove pointerup pointercancel";
        r.MSPointerEvent && !r.PointerEvent && (Yt = "MSPointerDown",
        Qt = "MSPointerMove MSPointerUp MSPointerCancel"),
        p(H, E, {
            handler: function(t) {
                var e = this.store
                  , i = !1
                  , n = t.type.toLowerCase().replace("ms", "")
                  , r = Wt[n]
                  , a = qt[t.pointerType] || t.pointerType
                  , s = a == St
                  , o = y(e, t.pointerId, "pointerId");
                r & Et && (0 === t.button || s) ? o < 0 && (e.push(t),
                o = e.length - 1) : r & (kt | Ft) && (i = !0),
                o < 0 || (e[o] = t,
                this.callback(this.manager, r, {
                    pointers: e,
                    changedPointers: [t],
                    pointerType: a,
                    srcEvent: t
                }),
                i && e.splice(o, 1))
            }
        });
        var Xt = {
            touchstart: Et,
            touchmove: It,
            touchend: kt,
            touchcancel: Ft
        }
          , Kt = "touchstart"
          , Jt = "touchstart touchmove touchend touchcancel";
        p(j, E, {
            handler: function(t) {
                var e = Xt[t.type];
                if (e === Et && (this.started = !0),
                this.started) {
                    var i = W.call(this, t, e);
                    e & (kt | Ft) && i[0].length - i[1].length === 0 && (this.started = !1),
                    this.callback(this.manager, e, {
                        pointers: i[0],
                        changedPointers: i[1],
                        pointerType: St,
                        srcEvent: t
                    })
                }
            }
        });
        var Zt = {
            touchstart: Et,
            touchmove: It,
            touchend: kt,
            touchcancel: Ft
        }
          , $t = "touchstart touchmove touchend touchcancel";
        p(q, E, {
            handler: function(t) {
                var e = Zt[t.type]
                  , i = Y.call(this, t, e);
                i && this.callback(this.manager, e, {
                    pointers: i[0],
                    changedPointers: i[1],
                    pointerType: St,
                    srcEvent: t
                })
            }
        }),
        p(Q, E, {
            handler: function(t, e, i) {
                var n = i.pointerType == St
                  , r = i.pointerType == Mt;
                if (n)
                    this.mouse.allow = !1;
                else if (r && !this.mouse.allow)
                    return;
                e & (kt | Ft) && (this.mouse.allow = !0),
                this.callback(t, e, i)
            },
            destroy: function() {
                this.touch.destroy(),
                this.mouse.destroy()
            }
        });
        var te = M(pt.style, "touchAction")
          , ee = te !== o
          , ie = "compute"
          , ne = "auto"
          , re = "manipulation"
          , ae = "none"
          , se = "pan-x"
          , oe = "pan-y";
        X.prototype = {
            set: function(t) {
                t == ie && (t = this.compute()),
                ee && this.manager.element.style && (this.manager.element.style[te] = t),
                this.actions = t.toLowerCase().trim()
            },
            update: function() {
                this.set(this.manager.options.touchAction)
            },
            compute: function() {
                var t = [];
                return c(this.manager.recognizers, function(e) {
                    g(e.options.enable, [e]) && (t = t.concat(e.getTouchAction()))
                }),
                K(t.join(" "))
            },
            preventDefaults: function(t) {
                if (!ee) {
                    var e = t.srcEvent
                      , i = t.offsetDirection;
                    if (this.manager.session.prevented)
                        return void e.preventDefault();
                    var n = this.actions
                      , r = x(n, ae)
                      , a = x(n, oe)
                      , s = x(n, se);
                    return r || a && i & Ot || s && i & Vt ? this.preventSrc(e) : void 0
                }
            },
            preventSrc: function(t) {
                this.manager.session.prevented = !0,
                t.preventDefault()
            }
        };
        var ue = 1
          , le = 2
          , ce = 4
          , he = 8
          , de = he
          , pe = 16
          , fe = 32;
        J.prototype = {
            defaults: {},
            set: function(t) {
                return h(this.options, t),
                this.manager && this.manager.touchAction.update(),
                this
            },
            recognizeWith: function(t) {
                if (l(t, "recognizeWith", this))
                    return this;
                var e = this.simultaneous;
                return t = tt(t, this),
                e[t.id] || (e[t.id] = t,
                t.recognizeWith(this)),
                this
            },
            dropRecognizeWith: function(t) {
                return l(t, "dropRecognizeWith", this) ? this : (t = tt(t, this),
                delete this.simultaneous[t.id],
                this)
            },
            requireFailure: function(t) {
                if (l(t, "requireFailure", this))
                    return this;
                var e = this.requireFail;
                return t = tt(t, this),
                y(e, t) === -1 && (e.push(t),
                t.requireFailure(this)),
                this
            },
            dropRequireFailure: function(t) {
                if (l(t, "dropRequireFailure", this))
                    return this;
                t = tt(t, this);
                var e = y(this.requireFail, t);
                return e > -1 && this.requireFail.splice(e, 1),
                this
            },
            hasRequireFailures: function() {
                return this.requireFail.length > 0
            },
            canRecognizeWith: function(t) {
                return !!this.simultaneous[t.id]
            },
            emit: function(t) {
                function e(e) {
                    i.manager.emit(i.options.event + (e ? Z(n) : ""), t)
                }
                var i = this
                  , n = this.state;
                n < he && e(!0),
                e(),
                n >= he && e(!0)
            },
            tryEmit: function(t) {
                return this.canEmit() ? this.emit(t) : void (this.state = fe)
            },
            canEmit: function() {
                for (var t = 0; t < this.requireFail.length; ) {
                    if (!(this.requireFail[t].state & (fe | ue)))
                        return !1;
                    t++
                }
                return !0
            },
            recognize: function(t) {
                var e = h({}, t);
                return g(this.options.enable, [this, e]) ? (this.state & (de | pe | fe) && (this.state = ue),
                this.state = this.process(e),
                void (this.state & (le | ce | he | pe) && this.tryEmit(e))) : (this.reset(),
                void (this.state = fe))
            },
            process: function(t) {},
            getTouchAction: function() {},
            reset: function() {}
        },
        p(et, J, {
            defaults: {
                pointers: 1
            },
            attrTest: function(t) {
                var e = this.options.pointers;
                return 0 === e || t.pointers.length === e
            },
            process: function(t) {
                var e = this.state
                  , i = t.eventType
                  , n = e & (le | ce)
                  , r = this.attrTest(t);
                return n && (i & Ft || !r) ? e | pe : n || r ? i & kt ? e | he : e & le ? e | ce : le : fe
            }
        }),
        p(it, et, {
            defaults: {
                event: "pan",
                threshold: 10,
                pointers: 1,
                direction: Bt
            },
            getTouchAction: function() {
                var t = this.options.direction
                  , e = [];
                return t & Ot && e.push(oe),
                t & Vt && e.push(se),
                e
            },
            directionTest: function(t) {
                var e = this.options
                  , i = !0
                  , n = t.distance
                  , r = t.direction
                  , a = t.deltaX
                  , s = t.deltaY;
                return r & e.direction || (e.direction & Ot ? (r = 0 === a ? Dt : a < 0 ? Nt : Rt,
                i = a != this.pX,
                n = Math.abs(t.deltaX)) : (r = 0 === s ? Dt : s < 0 ? Pt : Lt,
                i = s != this.pY,
                n = Math.abs(t.deltaY))),
                t.direction = r,
                i && n > e.threshold && r & e.direction
            },
            attrTest: function(t) {
                return et.prototype.attrTest.call(this, t) && (this.state & le || !(this.state & le) && this.directionTest(t))
            },
            emit: function(t) {
                this.pX = t.deltaX,
                this.pY = t.deltaY;
                var e = $(t.direction);
                e && this.manager.emit(this.options.event + e, t),
                this._super.emit.call(this, t)
            }
        }),
        p(nt, et, {
            defaults: {
                event: "pinch",
                threshold: 0,
                pointers: 2
            },
            getTouchAction: function() {
                return [ae]
            },
            attrTest: function(t) {
                return this._super.attrTest.call(this, t) && (Math.abs(t.scale - 1) > this.options.threshold || this.state & le)
            },
            emit: function(t) {
                if (this._super.emit.call(this, t),
                1 !== t.scale) {
                    var e = t.scale < 1 ? "in" : "out";
                    this.manager.emit(this.options.event + e, t)
                }
            }
        }),
        p(rt, J, {
            defaults: {
                event: "press",
                pointers: 1,
                time: 500,
                threshold: 5
            },
            getTouchAction: function() {
                return [ne]
            },
            process: function(t) {
                var e = this.options
                  , i = t.pointers.length === e.pointers
                  , n = t.distance < e.threshold
                  , r = t.deltaTime > e.time;
                if (this._input = t,
                !n || !i || t.eventType & (kt | Ft) && !r)
                    this.reset();
                else if (t.eventType & Et)
                    this.reset(),
                    this._timer = u(function() {
                        this.state = de,
                        this.tryEmit()
                    }, e.time, this);
                else if (t.eventType & kt)
                    return de;
                return fe
            },
            reset: function() {
                clearTimeout(this._timer)
            },
            emit: function(t) {
                this.state === de && (t && t.eventType & kt ? this.manager.emit(this.options.event + "up", t) : (this._input.timeStamp = vt(),
                this.manager.emit(this.options.event, this._input)))
            }
        }),
        p(at, et, {
            defaults: {
                event: "rotate",
                threshold: 0,
                pointers: 2
            },
            getTouchAction: function() {
                return [ae]
            },
            attrTest: function(t) {
                return this._super.attrTest.call(this, t) && (Math.abs(t.rotation) > this.options.threshold || this.state & le)
            }
        }),
        p(st, et, {
            defaults: {
                event: "swipe",
                threshold: 10,
                velocity: .65,
                direction: Ot | Vt,
                pointers: 1
            },
            getTouchAction: function() {
                return it.prototype.getTouchAction.call(this)
            },
            attrTest: function(t) {
                var e, i = this.options.direction;
                return i & (Ot | Vt) ? e = t.velocity : i & Ot ? e = t.velocityX : i & Vt && (e = t.velocityY),
                this._super.attrTest.call(this, t) && i & t.direction && t.distance > this.options.threshold && mt(e) > this.options.velocity && t.eventType & kt
            },
            emit: function(t) {
                var e = $(t.direction);
                e && this.manager.emit(this.options.event + e, t),
                this.manager.emit(this.options.event, t)
            }
        }),
        p(ot, J, {
            defaults: {
                event: "tap",
                pointers: 1,
                taps: 1,
                interval: 300,
                time: 250,
                threshold: 2,
                posThreshold: 10
            },
            getTouchAction: function() {
                return [re]
            },
            process: function(t) {
                var e = this.options
                  , i = t.pointers.length === e.pointers
                  , n = t.distance < e.threshold
                  , r = t.deltaTime < e.time;
                if (this.reset(),
                t.eventType & Et && 0 === this.count)
                    return this.failTimeout();
                if (n && r && i) {
                    if (t.eventType != kt)
                        return this.failTimeout();
                    var a = !this.pTime || t.timeStamp - this.pTime < e.interval
                      , s = !this.pCenter || V(this.pCenter, t.center) < e.posThreshold;
                    this.pTime = t.timeStamp,
                    this.pCenter = t.center,
                    s && a ? this.count += 1 : this.count = 1,
                    this._input = t;
                    var o = this.count % e.taps;
                    if (0 === o)
                        return this.hasRequireFailures() ? (this._timer = u(function() {
                            this.state = de,
                            this.tryEmit()
                        }, e.interval, this),
                        le) : de
                }
                return fe
            },
            failTimeout: function() {
                return this._timer = u(function() {
                    this.state = fe
                }, this.options.interval, this),
                fe
            },
            reset: function() {
                clearTimeout(this._timer)
            },
            emit: function() {
                this.state == de && (this._input.tapCount = this.count,
                this.manager.emit(this.options.event, this._input))
            }
        }),
        ut.VERSION = "2.0.4",
        ut.defaults = {
            domEvents: !1,
            touchAction: ie,
            enable: !0,
            inputTarget: null,
            inputClass: null,
            preset: [[at, {
                enable: !1
            }], [nt, {
                enable: !1
            }, ["rotate"]], [st, {
                direction: Ot
            }], [it, {
                direction: Ot
            }, ["swipe"]], [ot], [ot, {
                event: "doubletap",
                taps: 2
            }, ["tap"]], [rt]],
            cssProps: {
                userSelect: "none",
                touchSelect: "none",
                touchCallout: "none",
                contentZooming: "none",
                userDrag: "none",
                tapHighlightColor: "rgba(0,0,0,0)"
            }
        };
        var ge = 1
          , me = 2;
        lt.prototype = {
            set: function(t) {
                return h(this.options, t),
                t.touchAction && this.touchAction.update(),
                t.inputTarget && (this.input.destroy(),
                this.input.target = t.inputTarget,
                this.input.init()),
                this
            },
            stop: function(t) {
                this.session.stopped = t ? me : ge
            },
            recognize: function(t) {
                var e = this.session;
                if (!e.stopped) {
                    this.touchAction.preventDefaults(t);
                    var i, n = this.recognizers, r = e.curRecognizer;
                    (!r || r && r.state & de) && (r = e.curRecognizer = null);
                    for (var a = 0; a < n.length; )
                        i = n[a],
                        e.stopped === me || r && i != r && !i.canRecognizeWith(r) ? i.reset() : i.recognize(t),
                        !r && i.state & (le | ce | he) && (r = e.curRecognizer = i),
                        a++
                }
            },
            get: function(t) {
                if (t instanceof J)
                    return t;
                for (var e = this.recognizers, i = 0; i < e.length; i++)
                    if (e[i].options.event == t)
                        return e[i];
                return null
            },
            add: function(t) {
                if (l(t, "add", this))
                    return this;
                var e = this.get(t.options.event);
                return e && this.remove(e),
                this.recognizers.push(t),
                t.manager = this,
                this.touchAction.update(),
                t
            },
            remove: function(t) {
                if (l(t, "remove", this))
                    return this;
                var e = this.recognizers;
                return t = this.get(t),
                e.splice(y(e, t), 1),
                this.touchAction.update(),
                this
            },
            on: function(t, e) {
                var i = this.handlers;
                return c(A(t), function(t) {
                    i[t] = i[t] || [],
                    i[t].push(e)
                }),
                this
            },
            off: function(t, e) {
                var i = this.handlers;
                return c(A(t), function(t) {
                    e ? i[t].splice(y(i[t], e), 1) : delete i[t]
                }),
                this
            },
            emit: function(t, e) {
                this.options.domEvents && ht(t, e);
                var i = this.handlers[t] && this.handlers[t].slice();
                if (i && i.length) {
                    e.type = t,
                    e.preventDefault = function() {
                        e.srcEvent.preventDefault()
                    }
                    ;
                    for (var n = 0; n < i.length; )
                        i[n](e),
                        n++
                }
            },
            destroy: function() {
                this.element && ct(this, !1),
                this.handlers = {},
                this.session = {},
                this.input.destroy(),
                this.element = null
            }
        },
        h(ut, {
            INPUT_START: Et,
            INPUT_MOVE: It,
            INPUT_END: kt,
            INPUT_CANCEL: Ft,
            STATE_POSSIBLE: ue,
            STATE_BEGAN: le,
            STATE_CHANGED: ce,
            STATE_ENDED: he,
            STATE_RECOGNIZED: de,
            STATE_CANCELLED: pe,
            STATE_FAILED: fe,
            DIRECTION_NONE: Dt,
            DIRECTION_LEFT: Nt,
            DIRECTION_RIGHT: Rt,
            DIRECTION_UP: Pt,
            DIRECTION_DOWN: Lt,
            DIRECTION_HORIZONTAL: Ot,
            DIRECTION_VERTICAL: Vt,
            DIRECTION_ALL: Bt,
            Manager: lt,
            Input: E,
            TouchAction: X,
            TouchInput: q,
            MouseInput: z,
            PointerEventInput: H,
            TouchMouseInput: Q,
            SingleTouchInput: j,
            Recognizer: J,
            AttrRecognizer: et,
            Tap: ot,
            Pan: it,
            Swipe: st,
            Pinch: nt,
            Rotate: at,
            Press: rt,
            on: v,
            off: _,
            each: c,
            merge: d,
            extend: h,
            inherit: p,
            bindFn: f,
            prefixed: M
        }),
        "function" == ft && i(284) ? (n = function() {
            return ut
        }
        .call(e, i, e, t),
        !(n !== o && (t.exports = n))) : "undefined" != typeof t && t.exports ? t.exports = ut : r[s] = ut
    }(window, document, "Hammer")
}
, function(t, e) {
    (function(e) {
        t.exports = e
    }
    ).call(e, {})
}
, function(t, e, i) {
    var n, r, a;
    /**
	 * isMobile.js v0.4.0
	 *
	 * A simple library to detect Apple phones and tablets,
	 * Android phones and tablets, other mobile devices (like blackberry, mini-opera and windows phone),
	 * and any kind of seven inch device, via user agent sniffing.
	 *
	 * @author: Kai Mallea (kmallea@gmail.com)
	 *
	 * @license: http://creativecommons.org/publicdomain/zero/1.0/
	 */
    !function(i) {
        var s = /iPhone/i
          , o = /iPod/i
          , u = /iPad/i
          , l = /(?=.*\bAndroid\b)(?=.*\bMobile\b)/i
          , c = /Android/i
          , h = /(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i
          , d = /(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i
          , p = /IEMobile/i
          , f = /(?=.*\bWindows\b)(?=.*\bARM\b)/i
          , g = /BlackBerry/i
          , m = /BB10/i
          , v = /Opera Mini/i
          , _ = /(CriOS|Chrome)(?=.*\bMobile\b)/i
          , b = /(?=.*\bFirefox\b)(?=.*\bMobile\b)/i
          , x = new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i")
          , A = function(t, e) {
            return t.test(e)
        }
          , y = function(t) {
            var e = t || navigator.userAgent
              , i = e.split("[FBAN");
            if ("undefined" != typeof i[1] && (e = i[0]),
            i = e.split("Twitter"),
            "undefined" != typeof i[1] && (e = i[0]),
            this.apple = {
                phone: A(s, e),
                ipod: A(o, e),
                tablet: !A(s, e) && A(u, e),
                device: A(s, e) || A(o, e) || A(u, e)
            },
            this.amazon = {
                phone: A(h, e),
                tablet: !A(h, e) && A(d, e),
                device: A(h, e) || A(d, e)
            },
            this.android = {
                phone: A(h, e) || A(l, e),
                tablet: !A(h, e) && !A(l, e) && (A(d, e) || A(c, e)),
                device: A(h, e) || A(d, e) || A(l, e) || A(c, e)
            },
            this.windows = {
                phone: A(p, e),
                tablet: A(f, e),
                device: A(p, e) || A(f, e)
            },
            this.other = {
                blackberry: A(g, e),
                blackberry10: A(m, e),
                opera: A(v, e),
                firefox: A(b, e),
                chrome: A(_, e),
                device: A(g, e) || A(m, e) || A(v, e) || A(b, e) || A(_, e)
            },
            this.seven_inch = A(x, e),
            this.any = this.apple.device || this.android.device || this.windows.device || this.other.device || this.seven_inch,
            this.phone = this.apple.phone || this.android.phone || this.windows.phone,
            this.tablet = this.apple.tablet || this.android.tablet || this.windows.tablet,
            "undefined" == typeof window)
                return this
        }
          , S = function() {
            var t = new y;
            return t.Class = y,
            t
        };
        "undefined" != typeof t && t.exports && "undefined" == typeof window ? t.exports = y : "undefined" != typeof t && t.exports && "undefined" != typeof window ? t.exports = S() : (r = [],
        n = i.isMobile = S(),
        a = "function" == typeof n ? n.apply(e, r) : n,
        !(void 0 !== a && (t.exports = a)))
    }(this)
}
, , , , , , function(t, e, i) {
    i(292),
    function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/user.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    t.getTemplate("skfb_front/macros/buttons.jinja", !1, "skfb_front/macros/user.jinja", function(u, l) {
                        return u ? void r(u) : void l.getExported(function(u, l) {
                            if (u)
                                return void r(u);
                            if (!l.hasOwnProperty("follow_button"))
                                return void r(new Error("cannot import 'follow_button'"));
                            var c = l.follow_button;
                            e.setVariable("follow_button", c),
                            o += "\n\n";
                            var h = n.makeMacro(["authUser", "user"], ["options"], function(r, a, s) {
                                i = i.push(),
                                s = s || {},
                                s.hasOwnProperty("caller") && i.set("caller", s.caller),
                                i.set("authUser", r),
                                i.set("user", a),
                                i.set("options", s.hasOwnProperty("options") ? s.options : {});
                                var o = "";
                                if (o += '\n\n    <a class="user-name" href="',
                                o += n.suppressValue(n.memberLookup(a, "profileUrl", t.opts.autoescape), t.opts.autoescape),
                                o += '"',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "target", t.opts.autoescape) && (o += ' target="',
                                o += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "target", t.opts.autoescape), t.opts.autoescape),
                                o += '"'),
                                o += '>\n\n        <div class="wrapper ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSummary", t.opts.autoescape) && (o += 'js-summary-trigger" data-user-summary-anchor=".user-summary-anchor.avatar[data-user=\'',
                                o += n.suppressValue(n.memberLookup(a, "uid", t.opts.autoescape), t.opts.autoescape),
                                o += "']"),
                                o += '" data-user="',
                                o += n.suppressValue(n.memberLookup(a, "uid", t.opts.autoescape), t.opts.autoescape),
                                o += '">\n            <data itemprop="url" value="',
                                o += n.suppressValue(n.memberLookup(a, "profileUrl", t.opts.autoescape), t.opts.autoescape),
                                o += '"></data>\n            ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withAvatar", t.opts.autoescape)) {
                                    if (o += '\n                <div class="avatar ',
                                    n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSummary", t.opts.autoescape) && (o += "user-summary-anchor"),
                                    o += '" data-user="',
                                    o += n.suppressValue(n.memberLookup(a, "uid", t.opts.autoescape), t.opts.autoescape),
                                    o += '">\n                    ',
                                    n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "avatarWidth", t.opts.autoescape)) {
                                        o += "\n                        ";
                                        var u;
                                        u = n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "avatarWidth", t.opts.autoescape),
                                        i.set("avatarWidth", u, !0),
                                        i.parent || (e.setVariable("avatarWidth", u),
                                        e.addExport("avatarWidth")),
                                        o += "\n                    "
                                    } else {
                                        o += "\n                        ";
                                        var l;
                                        l = 20,
                                        i.set("avatarWidth", l, !0),
                                        i.parent || (e.setVariable("avatarWidth", l),
                                        e.addExport("avatarWidth")),
                                        o += "\n                    "
                                    }
                                    if (o += "\n                    ",
                                    n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "avatarHeight", t.opts.autoescape)) {
                                        o += "\n                        ";
                                        var c;
                                        c = n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "avatarHeight", t.opts.autoescape),
                                        i.set("avatarHeight", c, !0),
                                        i.parent || (e.setVariable("avatarHeight", c),
                                        e.addExport("avatarHeight")),
                                        o += "\n                    "
                                    } else {
                                        o += "\n                        ";
                                        var h;
                                        h = n.contextOrFrameLookup(e, i, "avatarWidth"),
                                        i.set("avatarHeight", h, !0),
                                        i.parent || (e.setVariable("avatarHeight", h),
                                        e.addExport("avatarHeight")),
                                        o += "\n                    "
                                    }
                                    o += "\n                    ",
                                    o += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(a, "avatars", t.opts.autoescape), n.contextOrFrameLookup(e, i, "avatarWidth"), n.contextOrFrameLookup(e, i, "avatarHeight")), t.opts.autoescape),
                                    o += "\n                </div>\n            "
                                }
                                return o += '\n\n            <div class="text">\n                ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "by", t.opts.autoescape) && (o += "by"),
                                o += '\n                <div class="username-wrapper" itemprop="name" title="',
                                o += n.suppressValue(n.memberLookup(a, "displayName", t.opts.autoescape), t.opts.autoescape),
                                o += '">',
                                o += n.suppressValue(n.memberLookup(a, "displayName", t.opts.autoescape), t.opts.autoescape),
                                o += "</div>\n            </div>\n            ",
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withoutBadge", t.opts.autoescape) || (o += "\n                ",
                                "pro" == n.memberLookup(a, "account", t.opts.autoescape) ? o += '\n                    <span class="flag flag-pro">Pro</span>\n                ' : "biz" == n.memberLookup(a, "account", t.opts.autoescape) && (o += '\n                    <span class="flag flag-biz">Pro</span>\n                '),
                                o += "\n            "),
                                o += "\n\n        </div>\n\n    </a>\n\n",
                                i = i.pop(),
                                new n.SafeString(o)
                            });
                            e.addExport("user_name"),
                            e.setVariable("user_name", h),
                            o += "\n\n\n";
                            var d = n.makeMacro(["avatars"], ["options"], function(r, a) {
                                i = i.push(),
                                a = a || {},
                                a.hasOwnProperty("caller") && i.set("caller", a.caller),
                                i.set("avatars", r),
                                i.set("options", a.hasOwnProperty("options") ? a.options : {});
                                var s = "";
                                s += "\n\n    ";
                                var o;
                                return o = t.getFilter("merge").call(e, {
                                    size: 32,
                                    expand: !1
                                }, n.contextOrFrameLookup(e, i, "options")),
                                i.set("options", o, !0),
                                i.parent || (e.setVariable("options", o),
                                e.addExport("options")),
                                s += "\n    ",
                                s += n.suppressValue(t.getFilter("image_container").call(e, r, n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "size", t.opts.autoescape), n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "size", t.opts.autoescape), n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "expand", t.opts.autoescape)), t.opts.autoescape),
                                s += "\n\n",
                                i = i.pop(),
                                new n.SafeString(s)
                            });
                            e.addExport("user_avatar"),
                            e.setVariable("user_avatar", d),
                            o += "\n\n\n",
                            o += "\n";
                            var p = n.makeMacro(["authUser", "user"], ["options"], function(r, a, s) {
                                i = i.push(),
                                s = s || {},
                                s.hasOwnProperty("caller") && i.set("caller", s.caller),
                                i.set("authUser", r),
                                i.set("user", a),
                                i.set("options", s.hasOwnProperty("options") ? s.options : {});
                                var o = "";
                                return (n.memberLookup(a, "city", t.opts.autoescape) || n.memberLookup(a, "country", t.opts.autoescape)) && (n.memberLookup(a, "city", t.opts.autoescape) && (n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "microData", t.opts.autoescape) && (o += '<data itemprop="addressLocality">'),
                                o += n.suppressValue(n.memberLookup(a, "city", t.opts.autoescape), t.opts.autoescape),
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "microData", t.opts.autoescape) && (o += "</data>"),
                                n.memberLookup(a, "country", t.opts.autoescape) && (o += ",")),
                                o += " ",
                                n.memberLookup(a, "country", t.opts.autoescape) && (n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "microData", t.opts.autoescape) && (o += '<data itemprop="addressCountry">'),
                                o += n.suppressValue(n.memberLookup(a, "country", t.opts.autoescape), t.opts.autoescape),
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "microData", t.opts.autoescape) && (o += "</data>"))),
                                i = i.pop(),
                                new n.SafeString(o)
                            });
                            e.addExport("user_location_plaintext"),
                            e.setVariable("user_location_plaintext", p),
                            o += "\n\n";
                            var f = n.makeMacro(["authUser", "user"], ["options"], function(r, o, u) {
                                i = i.push(),
                                u = u || {},
                                u.hasOwnProperty("caller") && i.set("caller", u.caller),
                                i.set("authUser", r),
                                i.set("user", o),
                                i.set("options", u.hasOwnProperty("options") ? u.options : {});
                                var l = "";
                                if (l += "\n\n    ",
                                "" != (a = 56,
                                s = 31,
                                n.callWrap(p, "user_location_plaintext", [r, o, n.contextOrFrameLookup(e, i, "options")]))) {
                                    l += "\n\n        ";
                                    var c;
                                    c = t.getFilter("merge").call(e, {
                                        microData: !0
                                    }, n.contextOrFrameLookup(e, i, "options")),
                                    i.set("options", c, !0),
                                    i.parent || (e.setVariable("options", c),
                                    e.addExport("options")),
                                    l += '\n\n        <i class="fa fa-map-marker"></i>\n        <data itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">\n            <data itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">\n            ',
                                    l += n.suppressValue((a = 63,
                                    s = 36,
                                    n.callWrap(p, "user_location_plaintext", [r, o, n.contextOrFrameLookup(e, i, "options")])), t.opts.autoescape),
                                    l += "\n            </data>\n        </data>\n    "
                                }
                                return l += "\n\n",
                                i = i.pop(),
                                new n.SafeString(l)
                            });
                            e.addExport("user_location"),
                            e.setVariable("user_location", f),
                            o += "\n\n";
                            var g = n.makeMacro(["authUser", "user"], ["options"], function(r, o, u) {
                                i = i.push(),
                                u = u || {},
                                u.hasOwnProperty("caller") && i.set("caller", u.caller),
                                i.set("authUser", r),
                                i.set("user", o),
                                i.set("options", u.hasOwnProperty("options") ? u.options : {});
                                var l = "";
                                return l += '\n\n    <div class="user-smallcard" data-link="',
                                l += n.suppressValue(n.memberLookup(o, "profileUrl", t.opts.autoescape), t.opts.autoescape),
                                l += '">\n\n        <div class="card-user-avatar ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSummary", t.opts.autoescape) && (l += "js-summary-trigger"),
                                l += '" data-user="',
                                l += n.suppressValue(n.memberLookup(o, "uid", t.opts.autoescape), t.opts.autoescape),
                                l += '">\n            ',
                                l += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(o, "avatars", t.opts.autoescape), 60, 60), t.opts.autoescape),
                                l += '\n        </div>\n\n        <div class="card-user-meta">\n            <div class="card-user-name">\n                ',
                                l += n.suppressValue((a = 80,
                                s = 26,
                                n.callWrap(h, "user_name", [r, o])), t.opts.autoescape),
                                l += '\n            </div>\n            <div class="card-user-stats">\n                <div class="smallcard-user-follower-count">\n                    ',
                                l += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(o, "followerCount", t.opts.autoescape), 0), t.opts.autoescape),
                                l += ' Followers\n                </div>\n                <div class="smallcard-user-model-count">\n                    ',
                                l += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(o, "modelCount", t.opts.autoescape), 0), t.opts.autoescape),
                                l += " Models\n                </div>\n            </div>\n        </div>\n\n    </div>\n\n",
                                i = i.pop(),
                                new n.SafeString(l)
                            });
                            e.addExport("user_smallcard"),
                            e.setVariable("user_smallcard", g),
                            o += "\n\n";
                            var m = n.makeMacro(["authUser", "user"], ["options"], function(r, o, u) {
                                i = i.push(),
                                u = u || {},
                                u.hasOwnProperty("caller") && i.set("caller", u.caller),
                                i.set("authUser", r),
                                i.set("user", o),
                                i.set("options", u.hasOwnProperty("options") ? u.options : {});
                                var l = "";
                                l += "\n\n    ";
                                var d;
                                if (d = t.getFilter("merge").call(e, {
                                    withSkills: !0,
                                    withRelated: !0
                                }, n.contextOrFrameLookup(e, i, "options")),
                                i.set("options", d, !0),
                                i.parent || (e.setVariable("options", d),
                                e.addExport("options")),
                                l += '\n\n    <div class="card-user" data-link="',
                                l += n.suppressValue(n.memberLookup(o, "profileUrl", t.opts.autoescape), t.opts.autoescape),
                                l += '">\n\n        <div class="card-user-avatar ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSummary", t.opts.autoescape) && (l += "js-summary-trigger"),
                                l += '" data-user="',
                                l += n.suppressValue(n.memberLookup(o, "uid", t.opts.autoescape), t.opts.autoescape),
                                l += '">\n            ',
                                l += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(o, "avatars", t.opts.autoescape), 90, 90, !1, !1, !0), t.opts.autoescape),
                                l += '\n        </div>\n        <div class="card-user-meta">\n            <div class="card-user-name">\n                ',
                                l += n.suppressValue((a = 107,
                                s = 26,
                                n.callWrap(h, "user_name", [r, o])), t.opts.autoescape),
                                l += '\n            </div>\n            <div class="card-user-location">\n                ',
                                (n.memberLookup(o, "city", t.opts.autoescape) || n.memberLookup(o, "country", t.opts.autoescape)) && (l += "\n                    ",
                                l += n.suppressValue((a = 111,
                                s = 34,
                                n.callWrap(f, "user_location", [r, o])), t.opts.autoescape),
                                l += "\n                "),
                                l += '\n            </div>\n            <div class="card-user-stats">\n                ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withFollow", t.opts.autoescape) && n.memberLookup(r, "uid", t.opts.autoescape) != n.memberLookup(o, "uid", t.opts.autoescape) && (l += "\n                    ",
                                l += n.suppressValue((a = 116,
                                s = 34,
                                n.callWrap(c, "follow_button", [r, o])), t.opts.autoescape),
                                l += "\n                "),
                                l += '\n                <div class="card-user-metrics-container">\n                    <div class="card-user-follower-count help">\n                        <span>',
                                l += n.suppressValue(n.memberLookup(o, "followerCount", t.opts.autoescape), t.opts.autoescape),
                                l += '</span>\n                        <div class="tooltip tooltip-up">Followers</div>\n                    </div>\n                    <div class="card-user-model-count help">\n                        ',
                                l += n.suppressValue(n.memberLookup(o, "modelCount", t.opts.autoescape), t.opts.autoescape),
                                l += '\n                        <div class="tooltip tooltip-up">Models</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSkills", t.opts.autoescape)) {
                                    l += '\n            <div class="card-user-skills">\n                <ul class="item-list list-monoline list-static"><!--\n                    ',
                                    i = i.push();
                                    var p = n.memberLookup(o, "skills", t.opts.autoescape);
                                    if (p)
                                        for (var g = p.length, m = 0; m < p.length; m++) {
                                            var v = p[m];
                                            i.set("skill", v),
                                            i.set("loop.index", m + 1),
                                            i.set("loop.index0", m),
                                            i.set("loop.revindex", g - m),
                                            i.set("loop.revindex0", g - m - 1),
                                            i.set("loop.first", 0 === m),
                                            i.set("loop.last", m === g - 1),
                                            i.set("loop.length", g),
                                            l += '\n                        --><li class="item">',
                                            l += n.suppressValue(n.memberLookup(v, "name", t.opts.autoescape), t.opts.autoescape),
                                            l += "</li><!--\n                    "
                                        }
                                    i = i.pop(),
                                    l += "\n                --></ul>\n            </div>\n        "
                                }
                                if (l += "\n\n        ",
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withRelated", t.opts.autoescape)) {
                                    if (l += '\n            <div class="card-user-examples">\n                <a class="overlay btn-container" href="',
                                    l += n.suppressValue(n.memberLookup(o, "profileUrl", t.opts.autoescape), t.opts.autoescape),
                                    l += '">\n                    <div class="button btn-small btn-primary">View full profile</div>\n                </a>\n\n                <ul class="card-user-models"><!--\n                    ',
                                    n.memberLookup(o, "thumbnails", t.opts.autoescape)) {
                                        l += "\n                        ",
                                        i = i.push();
                                        var _ = t.getFilter("fill_null").call(e, t.getFilter("first_n").call(e, n.memberLookup(o, "thumbnails", t.opts.autoescape), 3), 3);
                                        if (_)
                                            for (var b = _.length, x = 0; x < _.length; x++) {
                                                var A = _[x];
                                                i.set("thumb", A),
                                                i.set("loop.index", x + 1),
                                                i.set("loop.index0", x),
                                                i.set("loop.revindex", b - x),
                                                i.set("loop.revindex0", b - x - 1),
                                                i.set("loop.first", 0 === x),
                                                i.set("loop.last", x === b - 1),
                                                i.set("loop.length", b),
                                                l += "\n                            --><li>",
                                                l += n.suppressValue(t.getFilter("image_container").call(e, A, 153, 88, !0, !1, !0), t.opts.autoescape),
                                                l += "</li><!--\n                        "
                                            }
                                        i = i.pop(),
                                        l += "\n                    "
                                    }
                                    l += "\n                --></ul>\n\n            </div>\n        "
                                }
                                return l += "\n\n    </div>\n\n",
                                i = i.pop(),
                                new n.SafeString(l)
                            });
                            e.addExport("user_card"),
                            e.setVariable("user_card", m),
                            o += "\n\n";
                            var v = n.makeMacro(["authUser", "user"], ["options"], function(r, o, u) {
                                i = i.push(),
                                u = u || {},
                                u.hasOwnProperty("caller") && i.set("caller", u.caller),
                                i.set("authUser", r),
                                i.set("user", o),
                                i.set("options", u.hasOwnProperty("options") ? u.options : {});
                                var l = "";
                                l += '\n\n    <div class="user">\n        <a href="/',
                                l += n.suppressValue(n.memberLookup(o, "username", t.opts.autoescape), t.opts.autoescape),
                                l += '">\n        ',
                                l += n.suppressValue((a = 166,
                                s = 20,
                                n.callWrap(d, "user_avatar", [n.memberLookup(o, "avatars", t.opts.autoescape), {
                                    size: 104
                                }])), t.opts.autoescape),
                                l += '\n        </a>\n        <div class="info">\n            <p class="name" title="',
                                l += n.suppressValue(n.memberLookup(o, "displayName", t.opts.autoescape), t.opts.autoescape),
                                l += '"><a href="/',
                                l += n.suppressValue(n.memberLookup(o, "username", t.opts.autoescape), t.opts.autoescape),
                                l += '">',
                                l += n.suppressValue(n.memberLookup(o, "displayName", t.opts.autoescape), t.opts.autoescape),
                                l += '</a></p>\n            <p class="tagline" title="',
                                l += n.suppressValue(n.memberLookup(o, "tagline", t.opts.autoescape), t.opts.autoescape),
                                l += '"><a href="/',
                                l += n.suppressValue(n.memberLookup(o, "username", t.opts.autoescape), t.opts.autoescape),
                                l += '">',
                                l += n.suppressValue(n.memberLookup(o, "tagline", t.opts.autoescape), t.opts.autoescape),
                                l += "</a></p>\n            ",
                                0 != n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "followButton", t.opts.autoescape) && n.memberLookup(r, "uid", t.opts.autoescape) != n.memberLookup(o, "uid", t.opts.autoescape) && (l += '\n                <div class="follow-wrapper">\n                    ',
                                l += n.suppressValue((a = 173,
                                s = 34,
                                n.callWrap(c, "follow_button", [r, o])), t.opts.autoescape),
                                l += '\n                    <p class="follow-count"><a href="/',
                                l += n.suppressValue(n.memberLookup(o, "username", t.opts.autoescape), t.opts.autoescape),
                                l += '/followers"><span>',
                                l += n.suppressValue(n.memberLookup(o, "followerCount", t.opts.autoescape), t.opts.autoescape),
                                l += "</span> followers</a></p>\n                </div>\n            "),
                                l += '\n        </div>\n    </div>\n    <div class="models">',
                                i = i.push();
                                var h = t.getFilter("first_n").call(e, n.memberLookup(o, "thumbnails", t.opts.autoescape), 3);
                                if (h)
                                    for (var p = h.length, f = 0; f < h.length; f++) {
                                        var g = h[f];
                                        i.set("thumb", g),
                                        i.set("loop.index", f + 1),
                                        i.set("loop.index0", f),
                                        i.set("loop.revindex", p - f),
                                        i.set("loop.revindex0", p - f - 1),
                                        i.set("loop.first", 0 === f),
                                        i.set("loop.last", f === p - 1),
                                        i.set("loop.length", p),
                                        l += '\n            <a href="',
                                        l += n.suppressValue(n.memberLookup(g, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                        l += '">\n                ',
                                        l += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(g, "thumbnail", t.opts.autoescape), 133, 88, !1), t.opts.autoescape),
                                        l += "\n            </a>\n        "
                                    }
                                return i = i.pop(),
                                l += '\n    </div>\n    <div class="stats">\n        <p class="model-count">',
                                l += n.suppressValue(n.memberLookup(o, "modelCount", t.opts.autoescape), t.opts.autoescape),
                                l += " model",
                                l += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(o, "modelCount", t.opts.autoescape)), t.opts.autoescape),
                                l += '</p>\n        <p class="view-count">',
                                l += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(n.memberLookup(o, "stats", t.opts.autoescape), "view_count", t.opts.autoescape)), t.opts.autoescape),
                                l += " view",
                                l += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(n.memberLookup(o, "stats", t.opts.autoescape), "view_count", t.opts.autoescape)), t.opts.autoescape),
                                l += '</p>\n        <p class="like-count">',
                                l += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(n.memberLookup(o, "stats", t.opts.autoescape), "like_count", t.opts.autoescape)), t.opts.autoescape),
                                l += " like",
                                l += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(n.memberLookup(o, "stats", t.opts.autoescape), "like_count", t.opts.autoescape)), t.opts.autoescape),
                                l += "</p>\n    </div>\n\n",
                                i = i.pop(),
                                new n.SafeString(l)
                            });
                            e.addExport("user_summary"),
                            e.setVariable("user_summary", v),
                            o += "\n\n";
                            var _ = n.makeMacro(["authUser", "followSuggestion", "cloaked"], ["options"], function(r, o, u, l) {
                                i = i.push(),
                                l = l || {},
                                l.hasOwnProperty("caller") && i.set("caller", l.caller),
                                i.set("authUser", r),
                                i.set("followSuggestion", o),
                                i.set("cloaked", u),
                                i.set("options", l.hasOwnProperty("options") ? l.options : {});
                                var h = "";
                                return h += "\n\n\n    ",
                                h += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(o, "avatars", t.opts.autoescape), 64, 64), t.opts.autoescape),
                                h += '\n\n    <div class="info">\n        <p class="name">',
                                h += n.suppressValue(n.memberLookup(o, "displayName", t.opts.autoescape), t.opts.autoescape),
                                h += '</p>\n        <p class="stats">',
                                h += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(o, "followerCount", t.opts.autoescape)), t.opts.autoescape),
                                h += " follower",
                                h += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(o, "followerCount", t.opts.autoescape)), t.opts.autoescape),
                                h += ", ",
                                h += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(o, "modelCount", t.opts.autoescape)), t.opts.autoescape),
                                h += " model",
                                h += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(o, "modelCount", t.opts.autoescape)), t.opts.autoescape),
                                h += " </p>\n    </div>\n\n    ",
                                n.memberLookup(r, "uid", t.opts.autoescape) != n.memberLookup(o, "uid", t.opts.autoescape) && (h += "\n        ",
                                h += n.suppressValue((a = 205,
                                s = 22,
                                n.callWrap(c, "follow_button", [r, o])), t.opts.autoescape),
                                h += "\n    "),
                                h += "\n\n",
                                i = i.pop(),
                                new n.SafeString(h)
                            });
                            e.addExport("follow_suggestion_large"),
                            e.setVariable("follow_suggestion_large", _),
                            o += "\n\n";
                            var b = n.makeMacro(["authUser", "followSuggestion", "cloaked"], ["options"], function(r, o, u, l) {
                                i = i.push(),
                                l = l || {},
                                l.hasOwnProperty("caller") && i.set("caller", l.caller),
                                i.set("authUser", r),
                                i.set("followSuggestion", o),
                                i.set("cloaked", u),
                                i.set("options", l.hasOwnProperty("options") ? l.options : {});
                                var h = "";
                                return h += '\n\n    <span class="js-summary-trigger avatar-container" data-user="',
                                h += n.suppressValue(n.memberLookup(n.memberLookup(o, "user", t.opts.autoescape), "uid", t.opts.autoescape), t.opts.autoescape),
                                h += '">\n        ',
                                h += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(n.memberLookup(o, "user", t.opts.autoescape), "avatars", t.opts.autoescape), 64, 64), t.opts.autoescape),
                                h += '\n    </span>\n\n    <div class="info">\n        <p class="name js-summary-trigger" data-user="',
                                h += n.suppressValue(n.memberLookup(n.memberLookup(o, "user", t.opts.autoescape), "uid", t.opts.autoescape), t.opts.autoescape),
                                h += '" data-user-summary-anchor=".avatar-container[data-user=\'',
                                h += n.suppressValue(n.memberLookup(n.memberLookup(o, "user", t.opts.autoescape), "uid", t.opts.autoescape), t.opts.autoescape),
                                h += "']\">",
                                h += n.suppressValue(n.memberLookup(n.memberLookup(o, "user", t.opts.autoescape), "displayName", t.opts.autoescape), t.opts.autoescape),
                                h += '</p>\n        <p class="stats">',
                                h += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(n.memberLookup(o, "user", t.opts.autoescape), "followerCount", t.opts.autoescape)), t.opts.autoescape),
                                h += " follower",
                                h += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(n.memberLookup(o, "user", t.opts.autoescape), "followerCount", t.opts.autoescape)), t.opts.autoescape),
                                h += ", ",
                                h += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(n.memberLookup(o, "user", t.opts.autoescape), "modelCount", t.opts.autoescape)), t.opts.autoescape),
                                h += " model",
                                h += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(n.memberLookup(o, "user", t.opts.autoescape), "modelCount", t.opts.autoescape)), t.opts.autoescape),
                                h += " </p>\n    </div>\n\n    ",
                                n.memberLookup(r, "uid", t.opts.autoescape) != n.memberLookup(n.memberLookup(o, "user", t.opts.autoescape), "uid", t.opts.autoescape) && (h += "\n        ",
                                h += n.suppressValue((a = 222,
                                s = 22,
                                n.callWrap(c, "follow_button", [r, n.memberLookup(o, "user", t.opts.autoescape)])), t.opts.autoescape),
                                h += "\n    "),
                                h += '\n\n    <div class="reason">\n        <p>',
                                h += n.suppressValue(t.getFilter("print_suggestion_verb").call(e, n.memberLookup(o, "verb", t.opts.autoescape), n.memberLookup(o, "user", t.opts.autoescape)), t.opts.autoescape),
                                h += " ",
                                h += n.suppressValue(t.getFilter("print_suggestion_target").call(e, n.memberLookup(o, "target", t.opts.autoescape), n.memberLookup(o, "verb", t.opts.autoescape)), t.opts.autoescape),
                                h += "</p>\n    </div>\n\n",
                                i = i.pop(),
                                new n.SafeString(h)
                            });
                            e.addExport("follow_suggestion_reason"),
                            e.setVariable("follow_suggestion_reason", b),
                            o += "\n\n";
                            var x = n.makeMacro(["authUser", "followSuggestion", "cloaked"], ["options"], function(r, o, u, l) {
                                i = i.push(),
                                l = l || {},
                                l.hasOwnProperty("caller") && i.set("caller", l.caller),
                                i.set("authUser", r),
                                i.set("followSuggestion", o),
                                i.set("cloaked", u),
                                i.set("options", l.hasOwnProperty("options") ? l.options : {});
                                var d = "";
                                return d += '\n\n    <li class="follow-item',
                                u && (d += " cloaked"),
                                d += '" data-user="',
                                d += n.suppressValue(n.memberLookup(o, "uid", t.opts.autoescape), t.opts.autoescape),
                                d += '">\n\n        ',
                                d += n.suppressValue((a = 235,
                                s = 18,
                                n.callWrap(h, "user_name", [r, o, n.makeKeywordArgs({
                                    options: {
                                        withAvatar: !0,
                                        withSummary: n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSummary", t.opts.autoescape),
                                        avatarHeight: 32,
                                        avatarWidth: 32
                                    }
                                })])), t.opts.autoescape),
                                d += "\n\n        ",
                                n.memberLookup(r, "uid", t.opts.autoescape) != n.memberLookup(o, "uid", t.opts.autoescape) && (d += "\n\n            ",
                                d += n.suppressValue((a = 244,
                                s = 26,
                                n.callWrap(c, "follow_button", [n.contextOrFrameLookup(e, i, "user"), o])), t.opts.autoescape),
                                d += "\n\n        "),
                                d += "\n\n    </li>\n\n",
                                i = i.pop(),
                                new n.SafeString(d)
                            });
                            e.addExport("follow_suggestion"),
                            e.setVariable("follow_suggestion", x),
                            o += "\n\n";
                            var A = n.makeMacro(["authUser", "followSuggestions"], ["options"], function(r, o, u) {
                                i = i.push(),
                                u = u || {},
                                u.hasOwnProperty("caller") && i.set("caller", u.caller),
                                i.set("authUser", r),
                                i.set("followSuggestions", o),
                                i.set("options", u.hasOwnProperty("options") ? u.options : {});
                                var l = "";
                                l += '\n\n    <div class="sidebar-box suggested-follow',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "container_class", t.opts.autoescape) && (l += " ",
                                l += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "container_class", t.opts.autoescape), t.opts.autoescape)),
                                l += '">\n        <h5 class="sidebar-title">',
                                l += n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "title", t.opts.autoescape) ? n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "title", t.opts.autoescape), t.opts.autoescape) : "Who to follow ",
                                l += "</h5>\n        <ul>\n\n            ";
                                var c;
                                if (c = t.getFilter("length").call(e, o),
                                i.set("suggestionsCount", c, !0),
                                i.parent || (e.setVariable("suggestionsCount", c),
                                e.addExport("suggestionsCount")),
                                l += "\n\n            ",
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "maxSuggestions", t.opts.autoescape)) {
                                    l += "\n                ";
                                    var h;
                                    h = n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "maxSuggestions", t.opts.autoescape),
                                    i.set("max", h, !0),
                                    i.parent || (e.setVariable("max", h),
                                    e.addExport("max")),
                                    l += "\n            "
                                } else {
                                    l += "\n                ";
                                    var d;
                                    d = n.contextOrFrameLookup(e, i, "suggestionsCount"),
                                    i.set("max", d, !0),
                                    i.parent || (e.setVariable("max", d),
                                    e.addExport("max")),
                                    l += "\n            "
                                }
                                l += "\n\n            ",
                                i = i.push();
                                var p = o;
                                if (p)
                                    for (var f = p.length, g = 0; g < p.length; g++) {
                                        var m = p[g];
                                        i.set("following", m),
                                        i.set("loop.index", g + 1),
                                        i.set("loop.index0", g),
                                        i.set("loop.revindex", f - g),
                                        i.set("loop.revindex0", f - g - 1),
                                        i.set("loop.first", 0 === g),
                                        i.set("loop.last", g === f - 1),
                                        i.set("loop.length", f),
                                        l += "\n\n                ",
                                        l += n.suppressValue((a = 268,
                                        s = 34,
                                        n.callWrap(x, "follow_suggestion", [r, m, n.memberLookup(n.contextOrFrameLookup(e, i, "loop"), "index", t.opts.autoescape) > n.contextOrFrameLookup(e, i, "max"), n.contextOrFrameLookup(e, i, "options")])), t.opts.autoescape),
                                        l += "\n\n            "
                                    }
                                return i = i.pop(),
                                l += '\n        </ul>\n\n        <a href="#" class="show-more" data-action="show-more"><i class="icon fa fa-plus"></i> Show More</i></a>\n\n    </div>\n\n',
                                i = i.pop(),
                                new n.SafeString(l)
                            });
                            e.addExport("follow_suggestions"),
                            e.setVariable("follow_suggestions", A),
                            o += "\n",
                            r(null, o)
                        })
                    })
                } catch (u) {
                    r(n.handleError(u, a, s))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e, i) {
    i(293),
    function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/buttons.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    t.getTemplate("skfb_front/macros/popovers.jinja", !1, "skfb_front/macros/buttons.jinja", function(u, l) {
                        return u ? void r(u) : void l.getExported(function(u, l) {
                            if (u)
                                return void r(u);
                            if (!l.hasOwnProperty("share_popover"))
                                return void r(new Error("cannot import 'share_popover'"));
                            var c = l.share_popover;
                            e.setVariable("share_popover", c),
                            o += "\n\n";
                            var h = n.makeMacro(["authUser", "user"], ["options"], function(e, r, a) {
                                i = i.push(),
                                a = a || {},
                                a.hasOwnProperty("caller") && i.set("caller", a.caller),
                                i.set("authUser", e),
                                i.set("user", r),
                                i.set("options", a.hasOwnProperty("options") ? a.options : {});
                                var s = "";
                                return s += '\n\n    <span class="toggle-button follow-button btn-loading" data-action="follow" data-user="',
                                s += n.suppressValue(n.memberLookup(r, "uid", t.opts.autoescape), t.opts.autoescape),
                                s += '">\n        <a class="button btn-primary toggle btn-disabled">\n            <i class="icon fa fa-plus"></i>\n            Follow\n        </a>\n        <a class="button btn-important untoggle">\n            <span class="toggled">\n                Following\n            </span>\n            <span class="untoggled">\n                Unfollow\n            </span>\n        </a>\n    </span>\n\n',
                                i = i.pop(),
                                new n.SafeString(s)
                            });
                            e.addExport("follow_button"),
                            e.setVariable("follow_button", h),
                            o += "\n\n";
                            var d = n.makeMacro(["authUser"], ["options"], function(r, o) {
                                i = i.push(),
                                o = o || {},
                                o.hasOwnProperty("caller") && i.set("caller", o.caller),
                                i.set("authUser", r),
                                i.set("options", o.hasOwnProperty("options") ? o.options : {});
                                var u = "";
                                return u += '\n\n    <div class="button btn-medium btn-secondary btn-loading like like-button popover-container btn-disabled" data-action="like-model">\n        <i class="icon fa fa-star"></i>\n        Like\n        ',
                                n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover", t.opts.autoescape), "display", t.opts.autoescape) && (u += "\n            ",
                                u += n.suppressValue((a = 27,
                                s = 26,
                                n.callWrap(c, "share_popover", [{
                                    "class": n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover", t.opts.autoescape), "arrow", t.opts.autoescape)
                                }])), t.opts.autoescape),
                                u += "\n        "),
                                u += "\n    </div>\n\n",
                                i = i.pop(),
                                new n.SafeString(u)
                            });
                            e.addExport("like_button"),
                            e.setVariable("like_button", d),
                            o += "\n\n";
                            var p = n.makeMacro(["authUser"], ["options"], function(r, o) {
                                i = i.push(),
                                o = o || {},
                                o.hasOwnProperty("caller") && i.set("caller", o.caller),
                                i.set("authUser", r),
                                i.set("options", o.hasOwnProperty("options") ? o.options : {});
                                var u = "";
                                return u += '\n\n    <div class="help like-button star-like-button btn-loading popover-container',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "buttonClass", t.opts.autoescape) && (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "buttonClass", t.opts.autoescape), t.opts.autoescape)),
                                u += '" data-action="like-model">\n        ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count", t.opts.autoescape) && n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count", t.opts.autoescape), "display", t.opts.autoescape) && (u += '\n            <span class="count">',
                                u += n.suppressValue(n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count", t.opts.autoescape), "like", t.opts.autoescape), t.opts.autoescape),
                                u += "</span>\n        "),
                                u += '\n        <span class="tooltip liked-content',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass", t.opts.autoescape) ? (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass", t.opts.autoescape), t.opts.autoescape)) : u += " tooltip-down",
                                u += '">Like</span>\n        <span class="tooltip unliked-content',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass", t.opts.autoescape) ? (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass", t.opts.autoescape), t.opts.autoescape)) : u += " tooltip-down",
                                u += '">Unlike</span>\n        ',
                                n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover", t.opts.autoescape), "display", t.opts.autoescape) && (u += "\n            ",
                                u += n.suppressValue((a = 42,
                                s = 26,
                                n.callWrap(c, "share_popover", [{
                                    "class": n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover", t.opts.autoescape), "arrow", t.opts.autoescape)
                                }])), t.opts.autoescape),
                                u += "\n        "),
                                u += "\n    </div>\n\n",
                                i = i.pop(),
                                new n.SafeString(u)
                            });
                            e.addExport("star_like_button"),
                            e.setVariable("star_like_button", p),
                            o += "\n\n\n";
                            var f = n.makeMacro(["authUser"], ["options"], function(r, o) {
                                i = i.push(),
                                o = o || {},
                                o.hasOwnProperty("caller") && i.set("caller", o.caller),
                                i.set("authUser", r),
                                i.set("options", o.hasOwnProperty("options") ? o.options : {});
                                var u = "";
                                return u += '\n\n    <div class="help subscribe-button count-subscribe-button btn-loading popover-container',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "buttonClass", t.opts.autoescape) && (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "buttonClass", t.opts.autoescape), t.opts.autoescape)),
                                u += '" data-action="subscribe-collection">\n        ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count", t.opts.autoescape) && n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count", t.opts.autoescape), "display", t.opts.autoescape) && (u += '\n            <span class="count">',
                                u += n.suppressValue(n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count", t.opts.autoescape), "subscribe", t.opts.autoescape), t.opts.autoescape),
                                u += "</span>\n        "),
                                u += '\n        <span class="tooltip subscribed-content',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass", t.opts.autoescape) ? (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass", t.opts.autoescape), t.opts.autoescape)) : u += " tooltip-down",
                                u += '">Subscribe</span>\n        <span class="tooltip unsubscribed-content',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass", t.opts.autoescape) ? (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass", t.opts.autoescape), t.opts.autoescape)) : u += " tooltip-down",
                                u += '">Unsubscribe</span>\n        ',
                                n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover", t.opts.autoescape), "display", t.opts.autoescape) && (u += "\n            ",
                                u += n.suppressValue((a = 58,
                                s = 26,
                                n.callWrap(c, "share_popover", [{
                                    "class": n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover", t.opts.autoescape), "arrow", t.opts.autoescape)
                                }])), t.opts.autoescape),
                                u += "\n        "),
                                u += "\n    </div>\n\n",
                                i = i.pop(),
                                new n.SafeString(u)
                            });
                            e.addExport("subscribe_button_count"),
                            e.setVariable("subscribe_button_count", f),
                            o += "\n\n";
                            var g = n.makeMacro(["collection"], [], function(e, r) {
                                i = i.push(),
                                r = r || {},
                                r.hasOwnProperty("caller") && i.set("caller", r.caller),
                                i.set("collection", e);
                                var a = "";
                                return a += '\n\n    <span class="toggle-button addto-button" data-collection="',
                                a += n.suppressValue(n.memberLookup(e, "uid", t.opts.autoescape), t.opts.autoescape),
                                a += '">\n        <a class="button btn-small btn-primary toggle">\n            Add\n        </a>\n        <a class="button btn-small btn-important untoggle">\n            <span class="toggled">\n                Added\n            </span>\n            <span class="untoggled">\n                Remove\n            </span>\n        </a>\n    </span>\n\n',
                                i = i.pop(),
                                new n.SafeString(a)
                            });
                            e.addExport("add_to_collection_button"),
                            e.setVariable("add_to_collection_button", g),
                            o += "\n\n";
                            var m = n.makeMacro(["collection"], [], function(e, r) {
                                i = i.push(),
                                r = r || {},
                                r.hasOwnProperty("caller") && i.set("caller", r.caller),
                                i.set("collection", e);
                                var a = "";
                                return a += '\n\n    <span class="toggle-button subscribe-collection-button btn-loading" data-action="subscribe-collection" data-collection="',
                                a += n.suppressValue(n.memberLookup(e, "uid", t.opts.autoescape), t.opts.autoescape),
                                a += '">\n        <div class="subscribe">\n            <a class="button btn-medium btn-primary btn-disabled toggle">\n                <i class="icon fa fa-rss"></i>\n                Subscribe\n            </a>\n            <a class="button btn-medium btn-important untoggle">\n                <i class="icon icon-fixed-left fa fa-rss"></i>\n                <span class="toggled">\n                    Subscribed\n                </span>\n                <span class="untoggled">\n                    Unsubscribe\n                </span>\n            </a>\n        </div>\n    </span>\n\n',
                                i = i.pop(),
                                new n.SafeString(a)
                            });
                            e.addExport("subscribe_button"),
                            e.setVariable("subscribe_button", m),
                            o += "\n\n";
                            var v = n.makeMacro([], [], function(t) {
                                i = i.push(),
                                t = t || {},
                                t.hasOwnProperty("caller") && i.set("caller", t.caller);
                                var e = "";
                                return e += '\n\n    <a class="button btn-medium btn-secondary" data-action="open-collection-popup">\n        <div class="add-to">\n            <i class="icon fa fa-plus"></i>\n            Add to\n        </div>\n    </a>\n\n',
                                i = i.pop(),
                                new n.SafeString(e)
                            });
                            e.addExport("add_to_open_popup"),
                            e.setVariable("add_to_open_popup", v),
                            o += "\n",
                            r(null, o)
                        })
                    })
                } catch (u) {
                    r(n.handleError(u, a, s))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/popovers.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    var u = n.makeMacro([], ["options"], function(r) {
                        i = i.push(),
                        r = r || {},
                        r.hasOwnProperty("caller") && i.set("caller", r.caller),
                        i.set("options", r.hasOwnProperty("options") ? r.options : {});
                        var a = "";
                        return a += '\n\n    <div class="popover share-popover hidden',
                        n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "class", t.opts.autoescape) && (a += " ",
                        a += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "class", t.opts.autoescape), t.opts.autoescape)),
                        a += '">\n        <p>Thanks!</p>\n        <p>Also share?</p>\n\n        <a data-action="share-on-twitter" class="icon fa fa-twitter"></a>\n        <a data-action="share-on-google-plus" class="icon fa fa-google-plus"></a>\n        <a data-action="share-on-facebook" class="icon fa fa-facebook"></a>\n        <a data-action="share-on-pinterest" class="icon fa fa-pinterest"></a>\n    </div>\n\n',
                        i = i.pop(),
                        new n.SafeString(a)
                    });
                    e.addExport("share_popover"),
                    e.setVariable("share_popover", u),
                    o += "\n",
                    r(null, o)
                } catch (l) {
                    r(n.handleError(l, a, s))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(234)
      , r = i(220)
      , a = i(216)
      , s = i(235)
      , o = i(233)
      , u = i(238)
      , l = i(384)
      , c = i(385);
    t.exports = u.extend(a.extend({}, c, {
        defaults: {
            collections: {}
        },
        initialize: function() {
            u.prototype.initialize.apply(this, arguments),
            this.on("change:isPrivate", function() {
                this.get("isPrivate") || this.set("password", "")
            }
            .bind(this)),
            this.maxFailCount = 5
        },
        url: function() {
            return this.isNew() ? "/i/models" : "/i/models/" + this.get("uid")
        },
        like: function() {
            return o.authenticate(function(t) {
                return this.set({
                    likeCount: this.get("likeCount") + 1
                }),
                t.addLike(this.get("uid"), !0),
                n.ajax({
                    type: "POST",
                    url: a.result(this, "url") + "/likes",
                    cacheBusting: !1
                })
            }
            .bind(this))
        },
        unlike: function() {
            return o.authenticate(function(t) {
                return this.set({
                    likeCount: this.get("likeCount") - 1
                }),
                t.addLike(this.get("uid"), !1),
                n.ajax({
                    type: "DELETE",
                    url: a.result(this, "url") + "/likes"
                })
            }
            .bind(this))
        },
        hit: function() {
            var t = o.me();
            if (t.isAuthenticated()) {
                var e = this.get("user") && t.get("uid") === this.get("user").uid
                  , i = t.get("isStaff");
                if (e || i)
                    return s.resolve()
            }
            return n.ajax({
                type: "POST",
                url: a.result(this, "url") + "/views",
                cacheBusting: !1
            })
        },
        hitDownload: function() {
            return n.ajax({
                type: "POST",
                url: a.result(this, "url") + "/download",
                cacheBusting: !1
            })
        },
        isPublished: function() {
            return (this.get("isPublished") || !!this.get("publishedAt")) && !this.get("isDeleted")
        },
        publish: function() {
            return this.set("isPublished", !0),
            this.set("publishedAt", new Date),
            n.ajax({
                type: "PATCH",
                url: a.result(this, "url"),
                data: {
                    isPublished: !0
                },
                cacheBusting: !1
            })
        },
        getDownloadStatus: function() {
            return n.ajax({
                type: "GET",
                url: a.result(this, "url") + "/download",
                allowPrefetching: !1
            }).then(function(t, e, i) {
                return r.Deferred().resolve(t, e, i)
            })
        },
        getRelatedContent: function() {
            return n.ajax({
                type: "GET",
                url: a.result(this, "url") + "/related",
                allowPrefetching: !1
            }).then(function(t, e, i) {
                return r.Deferred().resolve(t, e, i)
            })
        },
        pollRelatedContent: function() {
            var t = !0;
            return l["while"](function() {
                return t
            }, function() {
                return new s(function(e) {
                    this.getRelatedContent().then(function(i, n, r) {
                        return 202 === r.status ? s.delay(5e3).then(e) : (t = !1,
                        e(i))
                    })
                }
                .bind(this))
            }
            .bind(this))["catch"](function() {
                t = !1
            })
        },
        getLikeUsers: function() {
            return n.ajax({
                type: "GET",
                url: a.result(this, "url") + "/liked_by",
                allowPrefetching: !0
            }).then(function(t) {
                return t
            })
        },
        sharing: function() {
            return n.ajax({
                type: "GET",
                url: a.result(this, "url") + "/sharing"
            }).then(function(t) {
                return this.set("sharing", t),
                s.resolve(t)
            }
            .bind(this))
        },
        toJSON: function() {
            var t = u.prototype.toJSON.apply(this, arguments);
            return t.categories && (t.categories = t.categories.map(function(t) {
                return "object" == typeof t ? t.uid : t
            })),
            t
        },
        addCollection: function(t, e) {
            var i = {};
            i[t] = e,
            this.addCollections(i)
        },
        addCollections: function(t) {
            var e = a.clone(this.get("collections"));
            a.extend(e, t),
            this.set("collections", e)
        },
        isInflated: function() {
            var t = Object.keys(this.attributes);
            return t.indexOf("description") > -1 && t.indexOf("tags") > -1
        },
        isInCollection: function(t) {
            return !!this.get("collections")[t]
        },
        getCollections: function(t) {
            var e = [];
            return a.each(t, function(t) {
                t in this.get("collections") || e.push(t)
            }
            .bind(this)),
            new s(function(t, i) {
                e.length > 0 ? n.ajax({
                    type: "GET",
                    url: "/i/models/" + this.id + "/collections?uid=" + e.join("&uid=")
                }).then(function(e) {
                    this.addCollections(e.results),
                    t()
                }
                .bind(this), i) : (this.trigger("change:collections"),
                t())
            }
            .bind(this))
        }
    }))
}
, function(t, e, i) {
    "use strict";
    var n = i(235);
    t.exports = {
        "while": function(t, e) {
            return new n(function(i, r) {
                var a = function(s) {
                    return t() ? n.cast(e()).then(a)["catch"](r) : i(s)
                };
                setTimeout(a, 0)
            }
            ).cancellable()
        }
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(216)
      , a = i(234)
      , s = i(384);
    t.exports = {
        status: function() {
            return void 0 === this.get("status") ? this.pollStatus() : n.resolve(this.get("status"))
        },
        pollStatus: function() {
            return new n(function(t, e) {
                a.ajax({
                    type: "GET",
                    url: r.result(this, "url") + "/status",
                    allowPrefetching: !1
                }).then(function(e) {
                    var i = {
                        PENDING: 0,
                        PROCESSING: 1,
                        SUCCEEDED: 2,
                        FAILED: 3
                    }[e.processing.toUpperCase()];
                    this.set("status", e),
                    this.set("processingStatus", i),
                    t(e)
                }
                .bind(this), e)
            }
            .bind(this))
        },
        checkStatus: function() {
            return this.pollStatus().then(function(t) {
                return ["SUCCEEDED", "FAILED"].indexOf(t.processing.toUpperCase()) !== -1 ? n.resolve(t) : n.reject(t)
            }
            .bind(this), function() {
                return this.maxFailCount <= 0 ? n.resolve({
                    processing: "FAILED",
                    error: "The server failed to answer in time"
                }) : (this.maxFailCount -= 1,
                n.reject("Server responded with an error"))
            }
            .bind(this))
        },
        checkStatusAndRetry: function() {
            var t = !0;
            return s["while"](function() {
                return t
            }, function() {
                return new n(function(e) {
                    this.checkStatus().then(function(i) {
                        t = !1,
                        e(i)
                    })["catch"](function() {
                        return n.delay(2e3).then(function() {
                            e()
                        })
                    })
                }
                .bind(this))
            }
            .bind(this))["catch"](function() {
                t = !1
            })
        }
    }
}
, function(t, e) {
    "use strict";
    t.exports = function(t, e) {
        var i, n, r = t.length, a = e.length, s = [];
        if (!r)
            return a;
        if (!a)
            return r;
        for (i = 0; i <= r; i++)
            s[i] = [i];
        for (n = 0; n <= a; n++)
            s[0][n] = n;
        for (n = 1; n <= a; n++)
            for (i = 1; i <= r; i++)
                t[i - 1] === e[n - 1] ? s[i][n] = s[i - 1][n - 1] : s[i][n] = Math.min(s[i - 1][n], s[i][n - 1], s[i - 1][n - 1]) + 1;
        return s[r][a]
    }
}
, function(t, e) {
    "use strict";
    t.exports = function(t) {
        return t = t.substring(t.lastIndexOf("/") + 1),
        t = t.split("."),
        t = t[t.length > 1 ? t.length - 2 : t.length - 1],
        t.split("_").pop().toLowerCase()
    }
}
, , , , , , , function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(216);
    t.exports = {
        handleLazyLoading: function(t) {
            t = t || {},
            r.defaults(t, {
                onBeforeLoad: function() {},
                onAfterLoad: function() {}
            });
            var e = function() {
                this.$(".lazyload").each(function() {
                    var e = n(this)
                      , i = e.attr("data-uri")
                      , r = new Image;
                    r.classList.add("lazyloaded"),
                    r.onload = r.onerror = function() {
                        var i, n = e.width();
                        if (i = r.naturalWidth > n ? r.naturalHeight * (n / r.naturalWidth) : r.naturalHeight,
                        t.onBeforeLoad(i),
                        e.is(":visible")) {
                            var a = function() {
                                e.append(r),
                                e.addClass("loaded").one("transitionend webkittransitionend moztransitionend", function() {
                                    e.replaceWith(r),
                                    t.onAfterLoad()
                                })
                            }
                            .bind(this);
                            i !== e.outerHeight() ? e.css("min-height", i).one("transitionend webkittransitionend moztransitionend", a) : a()
                        } else
                            e.replaceWith(r),
                            t.onAfterLoad()
                    }
                    ,
                    r.src = i
                })
            }
            .bind(this);
            "complete" === document.readyState ? e() : n(window).load(e)
        }
    }
}
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n, r = i(425), a = [{
        type: "VERTEX_SHADER",
        text: ["attribute vec3 aPosition;", "void main() {", "gl_Position = vec4(aPosition, 1.0);", "}"].join("\n")
    }, {
        type: "FRAGMENT_SHADER",
        text: ["precision mediump float;", "varying vec3 vColor;", "void main() {", "gl_FragColor = vec4(vColor, 1.0);", "}"].join("\n")
    }, {
        type: "FRAGMENT_SHADER",
        text: ["precision mediump float;", "varying vec3 vColor;", "void f(in vec3 a, out vec3 b) {", "b = 2.0 * a;", "}", "void main() {", "vec3 color;", "f(vColor, color);", "gl_FragColor = vec4(color, 1.0);", "}"].join("\n")
    }], s = function(t, e, i) {
        var n = e;
        "string" == typeof n && (n = t[e]);
        var r = t.createShader(n);
        return t.shaderSource(r, i),
        t.compileShader(r),
        !(!t.getShaderParameter(r, t.COMPILE_STATUS) && !t.isContextLost()) || (console.warn("Could't compile shader " + i),
        console.warn(t.getShaderInfoLog(r)),
        console.warn("You may want to consider a browser that fully supports WebGL."),
        !1)
    };
    t.exports = function() {
        if (void 0 !== n)
            return n;
        if (n = !1,
        r())
            return !1;
        for (var t = ["webgl", "experimental-webgl"], e = {
            antialias: !1
        }, i = null, o = 0; o < t.length && !(i = document.createElement("canvas").getContext(t[o], e)); o++)
            ;
        return !!i && (n = a.every(function(t) {
            return s(i, t.type, t.text)
        }))
    }
}
, function(t, e) {
    "use strict";
    t.exports = function() {
        var t = window.navigator.userAgent
          , e = t.indexOf("MSIE ")
          , i = t.indexOf("Trident/");
        return (e >= 0 || i >= 0) && (document.all && !window.atob)
    }
}
, , , , , , , , function(t, e, i) {
    i(292),
    i(291),
    i(434),
    function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/model.jinja"] = function() {
            function t(t, e, n, r, a) {
                var s = null
                  , o = null
                  , u = "";
                try {
                    t.getTemplate("skfb_front/macros/buttons.jinja", !1, "skfb_front/macros/model.jinja", function(l, c) {
                        return l ? void a(l) : void c.getExported(function(l, c) {
                            if (l)
                                return void a(l);
                            if (!c.hasOwnProperty("star_like_button"))
                                return void a(new Error("cannot import 'star_like_button'"));
                            var h = c.star_like_button;
                            e.setVariable("star_like_button", h),
                            u += "\n",
                            t.getTemplate("skfb_front/macros/user.jinja", !1, "skfb_front/macros/model.jinja", function(l, c) {
                                return l ? void a(l) : void c.getExported(function(l, c) {
                                    if (l)
                                        return void a(l);
                                    if (!c.hasOwnProperty("user_name"))
                                        return void a(new Error("cannot import 'user_name'"));
                                    var d = c.user_name;
                                    e.setVariable("user_name", d),
                                    u += "\n",
                                    t.getTemplate("skfb_front/macros/utils.jinja", !1, "skfb_front/macros/model.jinja", function(l, c) {
                                        return l ? void a(l) : void c.getExported(function(l, c) {
                                            if (l)
                                                return void a(l);
                                            if (!c.hasOwnProperty("humanize_count"))
                                                return void a(new Error("cannot import 'humanize_count'"));
                                            var p = c.humanize_count;
                                            e.setVariable("humanize_count", p),
                                            u += "\n\n\n";
                                            var f = r.makeMacro(["authUser", "model"], ["options"], function(i, a, s) {
                                                n = n.push(),
                                                s = s || {},
                                                s.hasOwnProperty("caller") && n.set("caller", s.caller),
                                                n.set("authUser", i),
                                                n.set("model", a),
                                                n.set("options", s.hasOwnProperty("options") ? s.options : {});
                                                var o = "";
                                                o += "\n\n    ";
                                                var u;
                                                return u = t.getFilter("merge").call(e, {
                                                    clickable: !0,
                                                    withStaffpickFlag: !0,
                                                    withStaffpickLink: !1,
                                                    withRestrictedFlag: !0
                                                }, r.contextOrFrameLookup(e, n, "options")),
                                                n.set("options", u, !0),
                                                n.parent || (e.setVariable("options", u),
                                                e.addExport("options")),
                                                o += '\n\n    <span class="model-name">\n\n        ',
                                                r.memberLookup(a, "isProtected", t.opts.autoescape) ? o += '\n            <i class="fa fa-lock protected"></i>\n        ' : r.memberLookup(a, "isPrivate", t.opts.autoescape) && (o += '\n            <i class="fa fa-lock private"></i>\n        '),
                                                o += "\n\n        ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "clickable", t.opts.autoescape) ? (o += '\n            <a class="label" href="',
                                                o += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                o += '"',
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "target", t.opts.autoescape) && (o += ' target="',
                                                o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "target", t.opts.autoescape), t.opts.autoescape),
                                                o += '"'),
                                                o += ' title="',
                                                o += r.suppressValue(r.memberLookup(a, "name", t.opts.autoescape), t.opts.autoescape),
                                                o += '">',
                                                o += r.suppressValue(r.memberLookup(a, "name", t.opts.autoescape), t.opts.autoescape),
                                                o += "</a>\n        ") : (o += '\n            <span class="label">',
                                                o += r.suppressValue(r.memberLookup(a, "name", t.opts.autoescape), t.opts.autoescape),
                                                o += "</span>\n        "),
                                                o += "\n\n        ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withStaffpickLink", t.opts.autoescape) && r.memberLookup(a, "staffpickedAt", t.opts.autoescape) ? o += '\n            <meta itemprop="award" content="Staff Pick" />\n            <a href="/models/staffpicks" class="flag-staffpicked" title="See all staff picks"></a>\n        ' : r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withStaffpickFlag", t.opts.autoescape) && r.memberLookup(a, "staffpickedAt", t.opts.autoescape) && (o += '\n            <meta itemprop="award" content="Staff Pick" />\n            <span class="flag-staffpicked" title="Staff Picks"></span>\n        '),
                                                o += "\n\n        ",
                                                o += "\n        ",
                                                (r.memberLookup(a, "isRestricted", t.opts.autoescape) || r.memberLookup(a, "isAdult", t.opts.autoescape)) && (o += "\n            ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withRestrictedFlag", t.opts.autoescape) && (o += '\n                <a href="https://help.sketchfab.com/hc/en-us/articles/214867883-Age-Restricted-Content" class="flag-restricted small" title="Age-restricted content">Age<strong>&#43;</strong></a>\n            '),
                                                o += "\n        "),
                                                o += "\n\n    </span>\n\n",
                                                n = n.pop(),
                                                new r.SafeString(o)
                                            });
                                            e.addExport("model_name"),
                                            e.setVariable("model_name", f),
                                            u += "\n\n";
                                            var g = r.makeMacro(["authUser", "model"], ["options"], function(i, a, s) {
                                                n = n.push(),
                                                s = s || {},
                                                s.hasOwnProperty("caller") && n.set("caller", s.caller),
                                                n.set("authUser", i),
                                                n.set("model", a),
                                                n.set("options", s.hasOwnProperty("options") ? s.options : {});
                                                var o = "";
                                                return o += '\n\n    <ul class="hover-menu quicksettings corner',
                                                "up" == r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "direction", t.opts.autoescape) && (o += " hover-menu-up"),
                                                "left" == r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "direction", t.opts.autoescape) && (o += " hover-menu-left"),
                                                o += '">\n\n        ',
                                                2 == r.memberLookup(a, "processingStatus", t.opts.autoescape) && (o += "\n            ",
                                                r.memberLookup(a, "publishedAt", t.opts.autoescape) || (o += '\n                <li><a data-action="publish">Publish</a></li>\n                <li class="separator"></li>\n            '),
                                                o += '\n\n            <li><a data-action="open-settings-popup">Properties</a></li>\n            <li><a href="',
                                                o += r.suppressValue(r.memberLookup(a, "editorUrl", t.opts.autoescape), t.opts.autoescape),
                                                o += '" data-action="settings3d-button">3D settings</a></li>\n            <li><a href="',
                                                o += r.suppressValue(t.getFilter("query_string").call(e, r.memberLookup(a, "editorUrl", t.opts.autoescape), {
                                                    tab: "annotations"
                                                }), t.opts.autoescape),
                                                o += '" data-action="open-editor-annotations">Annotations</a></li>\n\n            ',
                                                r.memberLookup(a, "publishedAt", t.opts.autoescape) && (o += '\n                <li><a data-action="open-collection-popup">Add to collection</a></li>\n            '),
                                                o += '\n\n            <li class="separator"></li>\n\n        '),
                                                o += "\n\n        ",
                                                r.memberLookup(a, "processingStatus", t.opts.autoescape) > 1 && (o += '\n            <li><a data-action="open-reupload-popup">Re-upload</a></li>\n        '),
                                                o += '\n        <li><a data-action="delete-model">Delete</a></li>\n        <li><a data-action="report-issue">Report an issue</a></li>\n\n    </ul>\n\n',
                                                n = n.pop(),
                                                new r.SafeString(o)
                                            });
                                            e.addExport("model_quicksettings"),
                                            e.setVariable("model_quicksettings", g),
                                            u += "\n\n";
                                            var m = r.makeMacro(["authUser", "model"], ["options"], function(i, a, s) {
                                                n = n.push(),
                                                s = s || {},
                                                s.hasOwnProperty("caller") && n.set("caller", s.caller),
                                                n.set("authUser", i),
                                                n.set("model", a),
                                                n.set("options", s.hasOwnProperty("options") ? s.options : {});
                                                var o = "";
                                                return o += '\n\n    <ul class="hover-menu quicksettings corner',
                                                "up" == r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "direction", t.opts.autoescape) && (o += " hover-menu-up"),
                                                "left" == r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "direction", t.opts.autoescape) && (o += " hover-menu-left"),
                                                o += '">\n        <li><a data-action="remove-model">Remove</a></li>\n    </ul>\n\n',
                                                n = n.pop(),
                                                new r.SafeString(o)
                                            });
                                            e.addExport("collection_quicksettings"),
                                            e.setVariable("collection_quicksettings", m),
                                            u += "\n\n";
                                            var v = r.makeMacro([], [], function(t) {
                                                n = n.push(),
                                                t = t || {},
                                                t.hasOwnProperty("caller") && n.set("caller", t.caller);
                                                var e = "";
                                                return e += '\n\n    <a class="model-card-preview" data-action="open-preview">\n        <i class="fa fa-search"></i>\n    </a>\n\n',
                                                n = n.pop(),
                                                new r.SafeString(e)
                                            });
                                            e.addExport("preview_link"),
                                            e.setVariable("preview_link", v),
                                            u += "\n\n";
                                            var _ = r.makeMacro(["authUser", "model"], ["options"], function(i, a, u) {
                                                n = n.push(),
                                                u = u || {},
                                                u.hasOwnProperty("caller") && n.set("caller", u.caller),
                                                n.set("authUser", i),
                                                n.set("model", a),
                                                n.set("options", u.hasOwnProperty("options") ? u.options : {});
                                                var l = "";
                                                l += "\n\n    ";
                                                var c;
                                                return c = t.getFilter("merge").call(e, {
                                                    withAvatars: !0,
                                                    withUser: !0,
                                                    withDate: !1,
                                                    withQuickSettings: !1,
                                                    withStaffpickFlag: !0,
                                                    withStaffpickLink: !1,
                                                    deferImages: !1
                                                }, r.contextOrFrameLookup(e, n, "options")),
                                                n.set("options", c, !0),
                                                n.parent || (e.setVariable("options", c),
                                                e.addExport("options")),
                                                l += "\n\n    ",
                                                l += "\n\n    ",
                                                a = t.getFilter("merge").call(e, {
                                                    user: r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "user", t.opts.autoescape)
                                                }, a),
                                                n.set("model", a, !0),
                                                n.parent || (e.setVariable("model", a),
                                                e.addExport("model")),
                                                l += "\n\n    ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "wrapMetaType", t.opts.autoescape) && (l += '\n\n    <data itemscope itemtype="http://schema.org/BlogPosting">\n\n    <meta itemprop="headline" content="',
                                                l += r.suppressValue(r.memberLookup(a, "name", t.opts.autoescape), t.opts.autoescape),
                                                l += '" />\n    <meta itemprop="image" content="',
                                                l += r.suppressValue(t.getFilter("best_fit").call(e, r.memberLookup(a, "thumbnails", t.opts.autoescape), 1024, 768), t.opts.autoescape),
                                                l += '" />\n    <meta itemprop="datepublished" content="',
                                                l += r.suppressValue(r.memberLookup(a, "publishedAt", t.opts.autoescape), t.opts.autoescape),
                                                l += '" />\n    <meta itemprop="description" content="',
                                                l += r.suppressValue(r.memberLookup(a, "description", t.opts.autoescape), t.opts.autoescape),
                                                l += '" />\n\n    '),
                                                l += '\n\n    <div class="model-card" itemprop="',
                                                l += r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "wrapMetaType", t.opts.autoescape) ? " associatedMedia " : " owns ",
                                                l += '" itemscope itemtype="http://schema.org/MediaObject">\n\n        <meta itemprop="commentCount" content="',
                                                l += r.suppressValue(r.memberLookup(a, "commentCount", t.opts.autoescape), t.opts.autoescape),
                                                l += '" />\n        <meta itemprop="contentSize" content="',
                                                l += r.suppressValue(t.getFilter("humanize_number").call(e, t.getFilter("default").call(e, r.memberLookup(a, "archiveSize", t.opts.autoescape), 0)), t.opts.autoescape),
                                                l += 'B" />\n        <meta itemprop="isBasedOnUrl" content="',
                                                l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                l += '/editor" />\n        <meta itemprop="embedUrl" content="',
                                                l += r.suppressValue(r.memberLookup(a, "embedUrl", t.opts.autoescape), t.opts.autoescape),
                                                l += '" />\n        <meta itemprop="name" content="',
                                                l += r.suppressValue(r.memberLookup(a, "name", t.opts.autoescape), t.opts.autoescape),
                                                l += '" />\n\n        <div class="model-card-thumbnail">\n\n            ',
                                                l += r.suppressValue(t.getFilter("image_container").call(e, r.memberLookup(a, "thumbnails", t.opts.autoescape), 500, 313, !0, !1, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "deferImages", t.opts.autoescape), r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "initialLoading", t.opts.autoescape)), t.opts.autoescape),
                                                l += '\n            <div class="model-card-overlay"></div>\n\n            <a class="model-card-filter" href="',
                                                l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                l += '"></a>\n\n            ',
                                                3 != r.memberLookup(a, "processingStatus", t.opts.autoescape) && (l += "\n                ",
                                                l += r.suppressValue((s = 128,
                                                o = 29,
                                                r.callWrap(v, "preview_link", [])), t.opts.autoescape),
                                                l += "\n            "),
                                                l += "\n\n            ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withQuickSettings", t.opts.autoescape) && (l += "\n                ",
                                                r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withQuickSettings", t.opts.autoescape), "collectionItem", t.opts.autoescape) ? (l += '\n                    <div class="model-card-settings" data-action>\n                        <i class="fa fa-cog"></i>\n                        ',
                                                l += r.suppressValue((s = 135,
                                                o = 49,
                                                r.callWrap(m, "collection_quicksettings", [i, a])), t.opts.autoescape),
                                                l += "\n                    </div>\n                ") : (l += "\n                    ",
                                                r.memberLookup(i, "uid", t.opts.autoescape) == r.memberLookup(r.memberLookup(a, "user", t.opts.autoescape), "uid", t.opts.autoescape) && (l += "\n                        ",
                                                l += '\n                        <div class="model-card-settings" data-action>\n                            <i class="fa fa-cog"></i>\n                            ',
                                                l += r.suppressValue((s = 142,
                                                o = 48,
                                                r.callWrap(g, "model_quicksettings", [i, a])), t.opts.autoescape),
                                                l += "\n                        </div>\n                    "),
                                                l += "\n                "),
                                                l += "\n            "),
                                                l += "\n\n            ",
                                                r.memberLookup(a, "publishedAt", t.opts.autoescape) && (l += '\n            <div class="model-card-information">\n                <div class="model-card-left-extra">\n                    <div class="model-card-stats">\n                        <span class="model-card-views">',
                                                l += r.suppressValue(t.getFilter("humanize_number").call(e, r.memberLookup(a, "viewCount", t.opts.autoescape)), t.opts.autoescape),
                                                l += "</span>\n                    </div>\n\n                    ",
                                                l += r.suppressValue((s = 155,
                                                o = 37,
                                                r.callWrap(h, "star_like_button", [i, r.makeKeywordArgs({
                                                    options: {
                                                        count: {
                                                            display: !0,
                                                            like: (s = 158,
                                                            o = 50,
                                                            r.callWrap(p, "humanize_count", [r.memberLookup(a, "likeCount", t.opts.autoescape)]))
                                                        },
                                                        popover: {
                                                            display: !0,
                                                            arrow: "down-arrow middle-arrow"
                                                        },
                                                        buttonClass: "model-card-like-button model-card-stats",
                                                        tooltipClass: "tooltip-up"
                                                    }
                                                })])), t.opts.autoescape),
                                                l += '\n                </div>\n\n                <div class="model-card-right-extra">\n\n                    ',
                                                r.memberLookup(a, "animationCount", t.opts.autoescape) > 0 && (l += '\n                        <div class="model-card-stats animation-stat">\n                            <span title="Model has ',
                                                l += r.suppressValue(r.memberLookup(a, "animationCount", t.opts.autoescape), t.opts.autoescape),
                                                l += " animation",
                                                l += r.suppressValue(t.getFilter("pluralize").call(e, r.memberLookup(a, "animationCount", t.opts.autoescape)), t.opts.autoescape),
                                                l += '" class="model-card-animations">',
                                                l += r.suppressValue(r.memberLookup(a, "animationCount", t.opts.autoescape), t.opts.autoescape),
                                                l += "</span>\n                        </div>\n                    "),
                                                l += "\n\n                    ",
                                                r.memberLookup(a, "isDownloadable", t.opts.autoescape) && r.memberLookup(a, "downloadCount", t.opts.autoescape) > 0 && (l += '\n                        <div class="model-card-stats download-start">\n                            <span class="model-card-downloads">',
                                                l += r.suppressValue(t.getFilter("humanize_number").call(e, r.memberLookup(a, "downloadCount", t.opts.autoescape)), t.opts.autoescape),
                                                l += "</span>\n                        </div>\n                    "),
                                                l += "\n\n                    ",
                                                r.memberLookup(a, "commentCount", t.opts.autoescape) > 0 && (l += '\n                        <div class="model-card-stats comments-stat">\n                            <a class="model-card-comments" itemprop="discussionUrl" href="',
                                                l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                l += '#comments" data-action="goto-comments">',
                                                l += r.suppressValue(t.getFilter("humanize_number").call(e, r.memberLookup(a, "commentCount", t.opts.autoescape)), t.opts.autoescape),
                                                l += "</a>\n                        </div>\n                    "),
                                                l += "\n                </div>\n            </div>\n            "),
                                                l += '\n\n        </div>\n\n        <div class="model-card-meta',
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withUser", t.opts.autoescape) && (l += " model-card-with-user"),
                                                l += '">\n\n            <div class="model-card-name">\n                ',
                                                l += r.suppressValue((s = 197,
                                                o = 27,
                                                r.callWrap(f, "model_name", [i, a, {
                                                    withStaffpickFlag: r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withStaffpickFlag", t.opts.autoescape),
                                                    withStaffpickLink: r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withStaffpickLink", t.opts.autoescape)
                                                }])), t.opts.autoescape),
                                                l += '\n            </div>\n\n            <div class="model-card-extra">\n\n                ',
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withUser", t.opts.autoescape) && (l += '\n                    <div class="model-card-user" itemscope itemtype="http://schema.org/Person" itemprop="author">\n                        ',
                                                l += r.suppressValue((s = 207,
                                                o = 34,
                                                r.callWrap(d, "user_name", [i, r.memberLookup(a, "user", t.opts.autoescape), {
                                                    withAvatar: r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withAvatars", t.opts.autoescape),
                                                    avatarWidth: 34,
                                                    by: !0,
                                                    withSummary: !0
                                                }])), t.opts.autoescape),
                                                l += "\n                    </div>\n                "),
                                                l += "\n\n                ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withDate", t.opts.autoescape) && (l += "\n                    ",
                                                r.memberLookup(a, "publishedAt", t.opts.autoescape) ? (l += '\n                        <div class="model-card-date">\n                            ',
                                                l += r.suppressValue(t.getFilter("time_ago").call(e, r.memberLookup(a, "publishedAt", t.opts.autoescape)), t.opts.autoescape),
                                                l += "\n                        </div>\n                    ") : (l += "\n                        <div>\n                            ",
                                                l += 0 == r.memberLookup(a, "processingStatus", t.opts.autoescape) ? '\n                                <span class="flag-draft">Pending</span>\n                            ' : 1 == r.memberLookup(a, "processingStatus", t.opts.autoescape) ? '\n                                <span class="flag-draft">Processing</span>\n                            ' : 2 == r.memberLookup(a, "processingStatus", t.opts.autoescape) ? '\n                                <span class="flag-draft">Draft</span>\n                            ' : '\n                                <span class="flag-error">Error</span>\n                            ',
                                                l += "\n                        </div>\n                    "),
                                                l += "\n                "),
                                                l += "\n\n            </div>\n\n        </div>\n\n    </div>\n\n\n    ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "wrapMetaType", t.opts.autoescape) && (l += "\n    </data>\n    "),
                                                l += "\n\n",
                                                n = n.pop(),
                                                new r.SafeString(l)
                                            });
                                            e.addExport("model_card"),
                                            e.setVariable("model_card", _),
                                            u += "\n\n";
                                            var b = r.makeMacro(["authUser", "model"], ["options"], function(i, a, u) {
                                                n = n.push(),
                                                u = u || {},
                                                u.hasOwnProperty("caller") && n.set("caller", u.caller),
                                                n.set("authUser", i),
                                                n.set("model", a),
                                                n.set("options", u.hasOwnProperty("options") ? u.options : {});
                                                var l = "";
                                                return l += '\n\n    <meta itemprop="commentCount" content="',
                                                l += r.suppressValue(r.memberLookup(a, "commentCount", t.opts.autoescape), t.opts.autoescape),
                                                l += '" />\n    <meta itemprop="contentSize" content="',
                                                l += r.suppressValue(t.getFilter("humanize_number").call(e, t.getFilter("default").call(e, r.memberLookup(a, "archiveSize", t.opts.autoescape), 0)), t.opts.autoescape),
                                                l += 'B" />\n    <meta itemprop="discussionUrl" content="',
                                                l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                l += '#comments" />\n    <meta itemprop="isBasedOnUrl" content="',
                                                l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                l += '/editor" />\n\n    <div class="model-smallcard" data-link="',
                                                l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                l += '">\n\n        <a class="thumbnail" itemprop="url" href="',
                                                l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                l += '">\n            ',
                                                l += r.suppressValue(t.getFilter("image_container").call(e, r.memberLookup(a, "thumbnails", t.opts.autoescape), 125, 80), t.opts.autoescape),
                                                l += '\n        </a>\n\n        <div class="meta">\n            <div class="name" itemprop="name">\n                ',
                                                l += r.suppressValue((s = 259,
                                                o = 27,
                                                r.callWrap(f, "model_name", [i, a])), t.opts.autoescape),
                                                l += '\n            </div>\n\n            <div class="stats">\n                ',
                                                r.memberLookup(a, "commentCount", t.opts.autoescape) > 0 && (l += '\n                    <a class="model-card-comments" href="',
                                                l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                l += '#comments">\n                        ',
                                                l += r.suppressValue(t.getFilter("humanize_number").call(e, r.memberLookup(a, "commentCount", t.opts.autoescape)), t.opts.autoescape),
                                                l += "\n                    </a>\n                "),
                                                l += '\n                <div class="views">\n                    ',
                                                l += r.suppressValue(t.getFilter("humanize_number").call(e, r.memberLookup(a, "viewCount", t.opts.autoescape)), t.opts.autoescape),
                                                l += "\n                </div>\n\n                ",
                                                l += r.suppressValue((s = 272,
                                                o = 33,
                                                r.callWrap(h, "star_like_button", [i, r.makeKeywordArgs({
                                                    options: {
                                                        count: {
                                                            display: !0,
                                                            like: (s = 275,
                                                            o = 46,
                                                            r.callWrap(p, "humanize_count", [r.memberLookup(a, "likeCount", t.opts.autoescape)]))
                                                        },
                                                        popover: {
                                                            display: !0,
                                                            arrow: "down-arrow middle-arrow"
                                                        },
                                                        buttonClass: "model-card-like-button model-subscribe",
                                                        tooltipClass: "tooltip-up"
                                                    }
                                                })])), t.opts.autoescape),
                                                l += "\n\n            </div>\n        </div>\n\n    </div>\n\n",
                                                n = n.pop(),
                                                new r.SafeString(l)
                                            });
                                            e.addExport("model_smallcard"),
                                            e.setVariable("model_smallcard", b),
                                            u += "\n\n\n";
                                            var x = r.makeMacro(["authUser", "model"], ["options"], function(i, a, u) {
                                                n = n.push(),
                                                u = u || {},
                                                u.hasOwnProperty("caller") && n.set("caller", u.caller),
                                                n.set("authUser", i),
                                                n.set("model", a),
                                                n.set("options", u.hasOwnProperty("options") ? u.options : {});
                                                var l = "";
                                                return l += '\n\n    <div class="model-uploadcard">\n\n        <h3 class="filename">\n            <a href="',
                                                l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                l += '">',
                                                l += r.memberLookup(a, "name", t.opts.autoescape) ? r.suppressValue((s = 301,
                                                o = 31,
                                                r.callWrap(f, "model_name", [i, a, {
                                                    withStaffpickFlag: !1
                                                }])), t.opts.autoescape) : r.suppressValue(t.getFilter("default").call(e, r.memberLookup(a, "originalFileName", t.opts.autoescape), "No file name"), t.opts.autoescape),
                                                l += '</a>\n        </h3>\n        <div class="meta">',
                                                r.memberLookup(a, "name", t.opts.autoescape) && (l += '<span class="original-filename">\n                    ',
                                                l += r.suppressValue(t.getFilter("default").call(e, r.memberLookup(a, "originalFileName", t.opts.autoescape), "No file name"), t.opts.autoescape),
                                                l += "\n                </span>"),
                                                r.memberLookup(a, "processedAt", t.opts.autoescape) ? (l += '\n                <span class="date" title="',
                                                l += r.suppressValue(r.memberLookup(a, "processedAt", t.opts.autoescape), t.opts.autoescape),
                                                l += '">',
                                                l += r.suppressValue(t.getFilter("time_ago").call(e, r.memberLookup(a, "processedAt", t.opts.autoescape)), t.opts.autoescape),
                                                l += "</span>\n            ") : (l += '\n                <span class="date" title="',
                                                l += r.suppressValue(r.memberLookup(a, "createdAt", t.opts.autoescape), t.opts.autoescape),
                                                l += '">',
                                                l += r.suppressValue(t.getFilter("time_ago").call(e, r.memberLookup(a, "createdAt", t.opts.autoescape)), t.opts.autoescape),
                                                l += "</span>\n            "),
                                                l += '\n        </div>\n\n        <div class="status">',
                                                0 == r.memberLookup(a, "processingStatus", t.opts.autoescape) ? l += '<div class="help">\n                    <i class="icon spinner-small-slow"></i>\n                    <div class="tooltip tooltip-down">Pending</div>\n                </div>' : 1 == r.memberLookup(a, "processingStatus", t.opts.autoescape) ? l += '<div class="help">\n                    <i class="icon spinner-small"></i>\n                    <div class="tooltip tooltip-down">Processing</div>\n                </div>' : 2 == r.memberLookup(a, "processingStatus", t.opts.autoescape) ? r.memberLookup(a, "isPublished", t.opts.autoescape) ? l += '<div class="help">\n                        <i class="icon fa fa-check"></i>\n                        <div class="tooltip tooltip-down">Published</div>\n                    </div>' : (l += '<a href="/models/',
                                                l += r.suppressValue(r.memberLookup(a, "uid", t.opts.autoescape), t.opts.autoescape),
                                                l += '/edit" class="button btn-tertiary btn-medium btn-edit" data-action="edit">\n                        3D Settings\n                    </a>\n                    <button type="button" class="button btn-primary btn-medium" data-action="publish">\n                        Publish\n                    </button>') : 3 == r.memberLookup(a, "processingStatus", t.opts.autoescape) && (l += '<div class="help">\n                    <i class="icon fa fa-times"></i>\n                    <div class="tooltip tooltip-down">Error</div>\n                </div>'),
                                                l += '</div>\n\n        <div class="model-uploadcard-settings">\n            <div class="button btn-medium btn-tertiary"',
                                                r.memberLookup(a, "processingStatus", t.opts.autoescape) < 2 && (l += " disabled"),
                                                l += '>\n                <i class="fa fa-cog"></i>\n                ',
                                                l += r.suppressValue((s = 368,
                                                o = 36,
                                                r.callWrap(g, "model_quicksettings", [i, a, {
                                                    direction: "left"
                                                }])), t.opts.autoescape),
                                                l += "\n            </div>\n        </div>\n\n    </div>\n\n",
                                                n = n.pop(),
                                                new r.SafeString(l)
                                            });
                                            e.addExport("model_uploadcard"),
                                            e.setVariable("model_uploadcard", x),
                                            u += "\n\n\n";
                                            var A = r.makeMacro(["authUser"], ["options"], function(i, a) {
                                                n = n.push(),
                                                a = a || {},
                                                a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                n.set("authUser", i),
                                                n.set("options", a.hasOwnProperty("options") ? a.options : {});
                                                var s = "";
                                                return s += '\n\n    <div class="annotation" data-hotspot="',
                                                s += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "hotspotIndex", t.opts.autoescape), t.opts.autoescape),
                                                s += '">\n\n        <div class="tooltip">\n\n            ',
                                                s += r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "editMode", t.opts.autoescape) ? '\n                <form class="tooltip-content padded">\n                    <div class="edition">\n                            <input class="title" placeholder="Title *" maxlength="64" required>\n                            <textarea class="description" placeholder="Description" maxlength="256" rows="2"></textarea>\n                    </div>\n                    <div class="render tooltip-content padded">\n                        <div class="title"></div>\n                        <div class="description markdown-rendered-content inversed"></div>\n                    </div>\n                    <div class="meta">\n                        <button type="submit" class="submit button btn-small">OK</button>\n                        <i class="fa fa-eye activate-render"></i>\n                        <i class="fa fa-pencil activate-edition selected"></i>\n                    </div>\n                </form>\n            ' : '\n\n                <div class="tooltip-content">\n                    <a href="#" class="more">+ more info</a>\n                    <div class="title"></div>\n                    <div class="description markdown-rendered-content inversed"></div>\n                </div>\n\n            ',
                                                s += "\n\n        </div>\n\n    </div>\n\n",
                                                n = n.pop(),
                                                new r.SafeString(s)
                                            });
                                            e.addExport("model_hotspot"),
                                            e.setVariable("model_hotspot", A),
                                            u += "\n\n\n";
                                            var y = r.makeMacro([], ["options"], function(i) {
                                                n = n.push(),
                                                i = i || {},
                                                i.hasOwnProperty("caller") && n.set("caller", i.caller),
                                                n.set("options", i.hasOwnProperty("options") ? i.options : {});
                                                var a = "";
                                                a += "\n\n";
                                                var u;
                                                u = 30,
                                                n.set("width_before", u, !0),
                                                n.parent || (e.setVariable("width_before", u),
                                                e.addExport("width_before")),
                                                a += "\n";
                                                var l;
                                                l = 960,
                                                n.set("width_next", l, !0),
                                                n.parent || (e.setVariable("width_next", l),
                                                e.addExport("width_next")),
                                                a += '\n\n<div class="annotation vr visible" data-hotspot="',
                                                a += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "hotspotIndex", t.opts.autoescape), t.opts.autoescape),
                                                a += '" style="width:',
                                                a += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "widthContent", t.opts.autoescape), t.opts.autoescape),
                                                a += 'px;height:576px;position:absolute;top:30px;left:30px;">\n\n    <div class="tooltip visible" style="width:',
                                                a += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "widthContent", t.opts.autoescape), t.opts.autoescape),
                                                a += 'px;border-radius:30px;left:0;">\n        <div class="tooltip-content" style="width:',
                                                a += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "widthContent", t.opts.autoescape), t.opts.autoescape),
                                                a += 'px;height:576px;border-radius:30px;display:flex;flex-direction:column;">\n\n            <div class="title" style="font-size:48px;line-height:1.5;padding:10px 80px 0 80px;">',
                                                a += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "title", t.opts.autoescape), t.opts.autoescape),
                                                a += "</div>",
                                                n = n.push();
                                                var c = (s = 428,
                                                o = 32,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "range"), "range", [0, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "column", t.opts.autoescape)]));
                                                if (c)
                                                    for (var h = c.length, d = 0; d < c.length; d++) {
                                                        var p = c[d];
                                                        n.set("column", p),
                                                        n.set("loop.index", d + 1),
                                                        n.set("loop.index0", d),
                                                        n.set("loop.revindex", h - d),
                                                        n.set("loop.revindex0", h - d - 1),
                                                        n.set("loop.first", 0 === d),
                                                        n.set("loop.last", d === h - 1),
                                                        n.set("loop.length", h),
                                                        r.contextOrFrameLookup(e, n, "width_before") > 30 && (a += '<div class="fa fa-arrow-left" style="font-size:40px;position:absolute;top:250px;left:',
                                                        a += r.suppressValue(r.contextOrFrameLookup(e, n, "width_before"), t.opts.autoescape),
                                                        a += 'px"></div>');
                                                        var f;
                                                        f = r.contextOrFrameLookup(e, n, "width_before") + 1024,
                                                        n.set("width_before", f, !0),
                                                        n.parent || (e.setVariable("width_before", f),
                                                        e.addExport("width_before"))
                                                    }
                                                n = n.pop(),
                                                a += '<div class="description" style="column-gap:180px;column-count:',
                                                a += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "column", t.opts.autoescape), t.opts.autoescape),
                                                a += ';font-size:36px;width:100%;line-height:1.5;padding:10px 80px 0 80px;">',
                                                a += r.suppressValue(t.getFilter("safe").call(e, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "description", t.opts.autoescape)), t.opts.autoescape),
                                                a += "</div>",
                                                n = n.push();
                                                var g = (s = 437,
                                                o = 32,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "range"), "range", [1, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "column", t.opts.autoescape)]));
                                                if (g)
                                                    for (var m = g.length, v = 0; v < g.length; v++) {
                                                        var _ = g[v];
                                                        n.set("column", _),
                                                        n.set("loop.index", v + 1),
                                                        n.set("loop.index0", v),
                                                        n.set("loop.revindex", m - v),
                                                        n.set("loop.revindex0", m - v - 1),
                                                        n.set("loop.first", 0 === v),
                                                        n.set("loop.last", v === m - 1),
                                                        n.set("loop.length", m),
                                                        a += '<div class="fa fa-arrow-right" style="font-size:40px;position:absolute;top:250px;left:',
                                                        a += r.suppressValue(r.contextOrFrameLookup(e, n, "width_next"), t.opts.autoescape),
                                                        a += 'px"></div>\n                ';
                                                        var b;
                                                        b = r.contextOrFrameLookup(e, n, "width_next") + 1024,
                                                        n.set("width_next", b, !0),
                                                        n.parent || (e.setVariable("width_next", b),
                                                        e.addExport("width_next"))
                                                    }
                                                n = n.pop(),
                                                a += '<div class="footer" style="text-align:left;font-size:36px;justify-content:space-around;bottom:15px;left:0;position:absolute;margin:20px 0 20px 0;">',
                                                n = n.push();
                                                var x = (s = 443,
                                                o = 40,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "range"), "range", [0, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "column", t.opts.autoescape)]));
                                                if (x)
                                                    for (var A = x.length, y = 0; y < x.length; y++) {
                                                        var S = x[y];
                                                        n.set("column", S),
                                                        n.set("loop.index", y + 1),
                                                        n.set("loop.index0", y),
                                                        n.set("loop.revindex", A - y),
                                                        n.set("loop.revindex0", A - y - 1),
                                                        n.set("loop.first", 0 === y),
                                                        n.set("loop.last", y === A - 1),
                                                        n.set("loop.length", A),
                                                        a += '<div class="containter-button" style="width:1024px;display:inline-block;text-align:center;">\n                            <button id="prevButton" class="button" style="background:#444444;">Prev</button>\n                            <button id="closeButton" class="button" style="background:#444444;">Close annotation</button>\n                            <button id="nextButton" class="button" style="background:#444444;">Next</button>\n                        </div>'
                                                    }
                                                return n = n.pop(),
                                                a += "</div>\n\n        </div>\n    </div>\n</div>\n\n",
                                                n = n.pop(),
                                                new r.SafeString(a)
                                            });
                                            e.addExport("model_hotspot_vr"),
                                            e.setVariable("model_hotspot_vr", y),
                                            u += "\n\n";
                                            var S = r.makeMacro(["src"], ["options"], function(i, a) {
                                                n = n.push(),
                                                a = a || {},
                                                a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                n.set("src", i),
                                                n.set("options", a.hasOwnProperty("options") ? a.options : {});
                                                var s = "";
                                                return s += "<iframe",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "class", t.opts.autoescape) && (s += ' class="',
                                                s += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "class", t.opts.autoescape), t.opts.autoescape),
                                                s += '"'),
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "width", t.opts.autoescape) && (s += ' width="',
                                                s += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "width", t.opts.autoescape), t.opts.autoescape),
                                                s += '"'),
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "height", t.opts.autoescape) && (s += ' height="',
                                                s += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "height", t.opts.autoescape), t.opts.autoescape),
                                                s += '"'),
                                                s += ' src="',
                                                s += r.suppressValue(i, t.opts.autoescape),
                                                s += '" frameborder="0" allowvr allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" onmousewheel=""></iframe>',
                                                n = n.pop(),
                                                new r.SafeString(s)
                                            });
                                            e.addExport("model_iframe"),
                                            e.setVariable("model_iframe", S),
                                            u += "\n\n";
                                            var C = r.makeMacro(["relatedByAlgo"], [], function(i, a) {
                                                n = n.push(),
                                                a = a || {},
                                                a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                n.set("relatedByAlgo", i);
                                                var u = "";
                                                u += '\n    <h5 class="sidebar-title">Suggested models</h5>\n    <ul class="related-algo ',
                                                i || (u += "spinner"),
                                                u += '">',
                                                n = n.push();
                                                var l = i;
                                                if (l)
                                                    for (var c = l.length, h = 0; h < l.length; h++) {
                                                        var d = l[h];
                                                        n.set("model", d),
                                                        n.set("loop.index", h + 1),
                                                        n.set("loop.index0", h),
                                                        n.set("loop.revindex", c - h),
                                                        n.set("loop.revindex0", c - h - 1),
                                                        n.set("loop.first", 0 === h),
                                                        n.set("loop.last", h === c - 1),
                                                        n.set("loop.length", c),
                                                        u += r.suppressValue((s = 464,
                                                        o = 36,
                                                        r.callWrap(r.contextOrFrameLookup(e, n, "model_related_algo_item"), "model_related_algo_item", [d])), t.opts.autoescape)
                                                    }
                                                return n = n.pop(),
                                                u += "</ul>\n",
                                                n = n.pop(),
                                                new r.SafeString(u)
                                            });
                                            e.addExport("model_related_algo"),
                                            e.setVariable("model_related_algo", C),
                                            u += "\n\n";
                                            var M = r.makeMacro(["item"], [], function(i, a) {
                                                n = n.push(),
                                                a = a || {},
                                                a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                n.set("item", i);
                                                var u = "";
                                                return u += '\n    <li itemprop="workExample" itemscope itemtype="http://schema.org/MediaObject" data-uid="',
                                                u += r.suppressValue(r.memberLookup(i, "uid", t.opts.autoescape), t.opts.autoescape),
                                                u += '">',
                                                u += r.suppressValue((s = 470,
                                                o = 120,
                                                r.callWrap(b, "model_smallcard", [r.contextOrFrameLookup(e, n, "authUser"), i])), t.opts.autoescape),
                                                u += "</li>\n",
                                                n = n.pop(),
                                                new r.SafeString(u)
                                            });
                                            e.addExport("model_related_algo_item"),
                                            e.setVariable("model_related_algo_item", M),
                                            u += "\n\n";
                                            var w = r.makeMacro(["license"], ["options"], function(a, s) {
                                                n = n.push(),
                                                s = s || {},
                                                s.hasOwnProperty("caller") && n.set("caller", s.caller),
                                                n.set("license", a),
                                                n.set("options", s.hasOwnProperty("options") ? s.options : {});
                                                var o = "";
                                                o += "\n\n    ";
                                                var u;
                                                u = t.getFilter("default").call(e, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "icon_size", t.opts.autoescape), 20),
                                                n.set("icon_size", u, !0),
                                                n.parent || (e.setVariable("icon_size", u),
                                                e.addExport("icon_size")),
                                                o += "\n\n    ";
                                                var l;
                                                if (l = {
                                                    "http://creativecommons.org/licenses/by/4.0/": {
                                                        clauses: ["by"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/licenses/by-sa/4.0/": {
                                                        clauses: ["by", "sa"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/licenses/by-nd/4.0/": {
                                                        clauses: ["by", "nd"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/licenses/by-nc/4.0/": {
                                                        clauses: ["by", "nc"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/licenses/by-nc-sa/4.0/": {
                                                        clauses: ["by", "nc", "sa"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/licenses/by-nc-nd/4.0/": {
                                                        clauses: ["by", "nc", "nd"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/publicdomain/zero/1.0/": {
                                                        clauses: ["zero"],
                                                        label: "Public Domain"
                                                    }
                                                },
                                                n.set("all_licenses", l, !0),
                                                n.parent || (e.setVariable("all_licenses", l),
                                                e.addExport("all_licenses")),
                                                o += "\n\n    ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "all_licenses"), r.memberLookup(a, "url", t.opts.autoescape), t.opts.autoescape)) {
                                                    o += '\n\n        <a href="',
                                                    o += r.suppressValue(r.memberLookup(a, "url", t.opts.autoescape), t.opts.autoescape),
                                                    o += '" rel="license" itemprop="license" class="help" target="_blank">\n            ',
                                                    n = n.push();
                                                    var c = r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e, n, "all_licenses"), r.memberLookup(a, "url", t.opts.autoescape), t.opts.autoescape), "clauses", t.opts.autoescape);
                                                    if (c)
                                                        for (var h = c.length, d = 0; d < c.length; d++) {
                                                            var p = c[d];
                                                            n.set("clause", p),
                                                            n.set("loop.index", d + 1),
                                                            n.set("loop.index0", d),
                                                            n.set("loop.revindex", h - d),
                                                            n.set("loop.revindex0", h - d - 1),
                                                            n.set("loop.first", 0 === d),
                                                            n.set("loop.last", d === h - 1),
                                                            n.set("loop.length", h),
                                                            o += "\n                ",
                                                            "by" == p ? (o += '\n                    <img src="',
                                                            o += r.suppressValue(i(435), t.opts.autoescape),
                                                            o += '" width="',
                                                            o += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            o += '" height="',
                                                            o += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            o += '" class="icon" />\n                ') : "nc" == p ? (o += '\n                    <img src="',
                                                            o += r.suppressValue(i(436), t.opts.autoescape),
                                                            o += '" width="',
                                                            o += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            o += '" height="',
                                                            o += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            o += '" class="icon" />\n                ') : "sa" == p ? (o += '\n                    <img src="',
                                                            o += r.suppressValue(i(437), t.opts.autoescape),
                                                            o += '" width="',
                                                            o += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            o += '" height="',
                                                            o += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            o += '" class="icon" />\n                ') : "nd" == p && (o += '\n                    <img src="',
                                                            o += r.suppressValue(i(438), t.opts.autoescape),
                                                            o += '" width="',
                                                            o += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            o += '" height="',
                                                            o += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            o += '" class="icon" />\n                '),
                                                            o += "\n            "
                                                        }
                                                    n = n.pop(),
                                                    o += "\n\n            ",
                                                    o += r.suppressValue(r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e, n, "all_licenses"), r.memberLookup(a, "url", t.opts.autoescape), t.opts.autoescape), "label", t.opts.autoescape), t.opts.autoescape),
                                                    o += '\n\n            <span class="tooltip tooltip-right">',
                                                    o += r.suppressValue(r.memberLookup(a, "fullname", t.opts.autoescape), t.opts.autoescape),
                                                    o += "</span>\n        </a>\n\n    "
                                                } else
                                                    o += "\n\n        <span>All rights reserved</span>\n\n    ";
                                                return o += "\n\n",
                                                n = n.pop(),
                                                new r.SafeString(o)
                                            });
                                            e.addExport("model_license"),
                                            e.setVariable("model_license", w);
                                            var T = r.makeMacro(["model"], ["options"], function(i, a) {
                                                n = n.push(),
                                                a = a || {},
                                                a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                n.set("model", i),
                                                n.set("options", a.hasOwnProperty("options") ? a.options : {});
                                                var s = "";
                                                return r.memberLookup(i, "isProtected", t.opts.autoescape) ? (s += "\n        ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withIcons", t.opts.autoescape) && (s += '<i class="icon fa fa-lock protected"></i> '),
                                                s += '\n        <span class="label">Only people with password and link will have access</span>\n    ') : r.memberLookup(i, "isPrivate", t.opts.autoescape) ? (s += "\n        ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withIcons", t.opts.autoescape) && (s += '<i class="icon fa fa-lock private"></i> '),
                                                s += '\n        <span class="label">Only people with link will have access</span>\n    ') : (s += "\n        ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withIcons", t.opts.autoescape) && (s += '<i class="icon fa fa-globe"></i> '),
                                                s += '\n        <span class="label">Everyone will have access</span>\n    '),
                                                n = n.pop(),
                                                new r.SafeString(s)
                                            });
                                            e.addExport("model_draft_privacy_description"),
                                            e.setVariable("model_draft_privacy_description", T),
                                            a(null, u)
                                        })
                                    })
                                })
                            })
                        })
                    })
                } catch (l) {
                    a(r.handleError(l, s, o))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/utils.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    var u = n.makeMacro(["number"], [], function(r, a) {
                        i = i.push(),
                        a = a || {},
                        a.hasOwnProperty("caller") && i.set("caller", a.caller),
                        i.set("number", r);
                        var s = "";
                        return s += "\n    ",
                        s += n.suppressValue(t.getFilter("humanize_number").call(e, r), t.opts.autoescape),
                        s += "\n",
                        i = i.pop(),
                        new n.SafeString(s)
                    });
                    e.addExport("humanize_count"),
                    e.setVariable("humanize_count", u),
                    o += "\n\n";
                    var l = n.makeMacro(["host", "type", "uid"], ["options"], function(r, a, s, o) {
                        i = i.push(),
                        o = o || {},
                        o.hasOwnProperty("caller") && i.set("caller", o.caller),
                        i.set("host", r),
                        i.set("type", a),
                        i.set("uid", s),
                        i.set("options", o.hasOwnProperty("options") ? o.options : {});
                        var u = "";
                        u += "\n    ";
                        var l;
                        if (l = r + "/requests/new?type=report_abuse&utm_campaign=report_abuse&utm_source=website&" + a + "=" + s,
                        i.set("link", l, !0),
                        i.parent || (e.setVariable("link", l),
                        e.addExport("link")),
                        u += "\n\n    ",
                        n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "subject", t.opts.autoescape)) {
                            u += "\n        ";
                            var c;
                            c = "&report_string=" + t.getFilter("urlencode").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "subject", t.opts.autoescape)),
                            i.set("label", c, !0),
                            i.parent || (e.setVariable("label", c),
                            e.addExport("label")),
                            u += "\n    "
                        }
                        return u += '\n\n    <a href="',
                        u += n.suppressValue(n.contextOrFrameLookup(e, i, "link"), t.opts.autoescape),
                        u += n.suppressValue(n.contextOrFrameLookup(e, i, "label"), t.opts.autoescape),
                        u += '" class="report-link" target="_blank">\n        ',
                        u += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "text", t.opts.autoescape), "Report abuse"), t.opts.autoescape),
                        u += "\n    </a>\n",
                        i = i.pop(),
                        new n.SafeString(u)
                    });
                    e.addExport("report_link"),
                    e.setVariable("report_link", l),
                    o += "\n",
                    r(null, o)
                } catch (c) {
                    r(n.handleError(c, a, s))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e, i) {
    t.exports = i.p + "by-7813b5794d8ba96aec20acb7f14ff76a.svg"
}
, function(t, e, i) {
    t.exports = i.p + "nc-e378f908a7f49e2a3812c0d4e70333dd.svg"
}
, function(t, e, i) {
    t.exports = i.p + "sa-978acd9d54dfd3c39cd92e8acfe1fe7e.svg"
}
, function(t, e, i) {
    t.exports = i.p + "nd-7966b830678388d28550a10805a754db.svg"
}
, , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(450)
      , r = i(247)
      , a = i(239);
    t.exports = r.extend({
        comparator: "order",
        model: n,
        url: function() {
            var t = this.options.filters.get("modelUID")
              , e = t ? "/i/models/" + t + "/hotspots" : "/i/hotspots";
            return e + a.craft("?", {
                offset: this.options.offset
            })
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(234)
      , a = i(220)
      , s = i(238)
      , o = "/i/hotspots";
    t.exports = s.extend({
        defaults: function() {
            return {
                name: "",
                content: "",
                position: [0, 0, 0],
                eye: [0, 0, 0],
                target: [0, 0, 0],
                uidImage: void 0,
                imageFile: void 0,
                preview: "",
                hovered: !0,
                lastComputedScenePosition: [0, 0, 0],
                geometryUid: -1,
                indices: [-1, -1, -1],
                barycentricWeights: [0, 0, 0],
                localPosition: [0, 0, 0]
            }
        },
        url: function() {
            return this.isNew() ? o : o + "/" + this.get("uid")
        },
        remove: function() {
            return n.resolve(r.ajax({
                type: "DELETE",
                url: this.url()
            }))
        },
        appendArray: function(t, e, i) {
            for (var n = 0, r = i.length; n < r; ++n)
                t.append(e, i[n])
        },
        save: function(t, e) {
            null != t && "object" != typeof t || (e = t);
            var i = this.isNew()
              , r = new FormData
              , s = this.get("imageFile");
            void 0 === this.get("uidImage") && s && r.append("imageFile", s),
            r.append("model", e.modelUID),
            r.append("name", this.get("name"));
            var o = this.get("content").raw;
            r.append("content", null !== o ? o : ""),
            this.appendArray(r, "eye", this.get("eye")),
            this.appendArray(r, "target", this.get("target")),
            this.appendArray(r, "position", this.get("position"));
            var u = this
              , l = a.ajax({
                type: i ? "POST" : "PATCH",
                url: this.url(),
                data: r,
                cache: !1,
                contentType: !1,
                processData: !1,
                success: function(t) {
                    i && (u.set("uid", t.uid),
                    t.images.length > 0 && u.set("uidImage", t.images[0].uid))
                },
                error: function(t) {
                    console.error(t.stack)
                }
            });
            return n.resolve(l)
        },
        _validate: function(t, e) {
            return e = e || {},
            e.validate = !0,
            s.prototype._validate.call(this, t, e)
        },
        validate: function(t) {
            var e = t.eye
              , i = t.target
              , n = i[0] - e[0]
              , r = i[1] - e[1]
              , a = i[2] - e[2]
              , s = Math.sqrt(n * n + r * r + a * a);
            if (s <= 1e-8)
                return i[0] = t.position[0],
                i[1] = t.position[1],
                i[2] = t.position[2],
                !1;
            if (s <= .001) {
                var o = .01 / s;
                i[0] = e[0] + n * o,
                i[1] = e[1] + r * o,
                i[2] = e[2] + a * o
            }
            return !1
        }
    })
}
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(t, e, i) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/logo.jinja"] = function() {
            function t(t, e, n, r, a) {
                var s = null
                  , o = null
                  , u = "";
                try {
                    var l = r.makeMacro([], ["headerStyle"], function(a) {
                        n = n.push(),
                        a = a || {},
                        a.hasOwnProperty("caller") && n.set("caller", a.caller),
                        n.set("headerStyle", a.hasOwnProperty("headerStyle") ? a.headerStyle : "normal");
                        var s = "";
                        return s += '\n<div class="logo">\n    <a class="link" href="/">\n        ',
                        "inverted" == r.contextOrFrameLookup(e, n, "headerStyle") ? (s += '\n        <img src="',
                        s += r.suppressValue(i(556), t.opts.autoescape),
                        s += '" width="121" height="30" class="visual" alt="Sketchfab">\n        ') : (s += '\n        <img src="',
                        s += r.suppressValue(i(557), t.opts.autoescape),
                        s += '" width="121" height="30" class="visual" alt="Sketchfab">\n        '),
                        s += "\n    </a>\n</div>\n",
                        n = n.pop(),
                        new r.SafeString(s)
                    });
                    e.addExport("header_logo"),
                    e.setVariable("header_logo", l),
                    u += "\n\n\n";
                    var c = r.makeMacro([], [], function(i) {
                        n = n.push(),
                        i = i || {},
                        i.hasOwnProperty("caller") && n.set("caller", i.caller);
                        var a = "";
                        return a += '\n<div class="logo">\n    <a href="/">\n        ',
                        a += r.suppressValue((s = 16,
                        o = 13,
                        r.callWrap(r.contextOrFrameLookup(e, n, "logo"), "logo", [96, 20])), t.opts.autoescape),
                        a += "\n    </a>\n</div>\n",
                        n = n.pop(),
                        new r.SafeString(a)
                    });
                    e.addExport("responsive_header_logo"),
                    e.setVariable("responsive_header_logo", c),
                    u += "\n\n\n";
                    var h = r.makeMacro(["width", "height"], ["options"], function(i, a, s) {
                        n = n.push(),
                        s = s || {},
                        s.hasOwnProperty("caller") && n.set("caller", s.caller),
                        n.set("width", i),
                        n.set("height", a),
                        n.set("options", s.hasOwnProperty("options") ? s.options : {});
                        var o = "";
                        o += "\n\n    ";
                        var u;
                        if (u = t.getFilter("merge").call(e, {
                            brand: !0,
                            color: "#555555"
                        }, r.contextOrFrameLookup(e, n, "options")),
                        n.set("options", u, !0),
                        n.parent || (e.setVariable("options", u),
                        e.addExport("options")),
                        o += "\n\n    ",
                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "brand", t.opts.autoescape)) {
                            o += "\n        ";
                            var l;
                            l = 121,
                            n.set("view_width", l, !0),
                            n.parent || (e.setVariable("view_width", l),
                            e.addExport("view_width")),
                            o += "\n    "
                        } else {
                            o += "\n        ";
                            var c;
                            c = 25,
                            n.set("view_width", c, !0),
                            n.parent || (e.setVariable("view_width", c),
                            e.addExport("view_width")),
                            o += "\n    "
                        }
                        return o += '\n\n    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\n         x="0" y="0" width="',
                        o += r.suppressValue(i, t.opts.autoescape),
                        o += '" height="',
                        o += r.suppressValue(a, t.opts.autoescape),
                        o += '"\n         viewBox="0 0 ',
                        o += r.suppressValue(r.contextOrFrameLookup(e, n, "view_width"), t.opts.autoescape),
                        o += ' 25"\n         enable-background="new 0 0 ',
                        o += r.suppressValue(r.contextOrFrameLookup(e, n, "view_width"), t.opts.autoescape),
                        o += ' 25">\n\n        ',
                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "brand", t.opts.autoescape) && (o += '\n            <g id="logo-text">\n                <path fill="',
                        o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color", t.opts.autoescape), t.opts.autoescape),
                        o += '"\n                    d="M36.471,7.719c-1.526,0-2.289,0.504-2.289,1.512c0,0.448,0.189,0.791,0.567,1.029\n                       c0.378,0.238,1.263,0.582,2.656,1.029c1.393,0.448,2.37,0.956,2.93,1.522c0.56,0.567,0.84,1.438,0.84,2.615\n                       c0,1.498-0.455,2.632-1.365,3.401c-0.911,0.771-2.1,1.155-3.57,1.155c-1.092,0-2.429-0.168-4.011-0.504l-0.756-0.147l0.294-2.247\n                       c1.876,0.253,3.311,0.379,4.305,0.379c1.484,0,2.226-0.616,2.226-1.849c0-0.447-0.171-0.798-0.515-1.05s-1.025-0.525-2.047-0.819\n                       c-1.624-0.462-2.769-1.011-3.434-1.648s-0.998-1.522-0.998-2.657c0-1.428,0.434-2.492,1.302-3.192c0.868-0.7,2.058-1.05,3.57-1.05\n                       c1.036,0,2.352,0.14,3.948,0.42l0.756,0.147L40.65,8.056C38.676,7.832,37.283,7.719,36.471,7.719z"\n                />\n                <path fill="',
                        o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color", t.opts.autoescape), t.opts.autoescape),
                        o += '"\n                    d="M46.068,19.731h-2.814v-14.7h2.814v8.358l1.071-0.189l2.079-3.969h3.15l-2.73,4.977l2.877,5.523h-3.171\n                       l-2.121-4.095l-1.155,0.188V19.731z"\n                />\n                <path fill="',
                        o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color", t.opts.autoescape), t.opts.autoescape),
                        o += '"\n                    d="M56.705,17.075c0.329,0.287,0.801,0.431,1.417,0.431c1.302,0,2.464-0.042,3.486-0.126l0.589-0.063\n                       l0.041,2.079c-1.61,0.392-3.066,0.588-4.368,0.588c-1.582,0-2.73-0.42-3.444-1.26c-0.714-0.84-1.071-2.205-1.071-4.095\n                       c0-3.766,1.547-5.649,4.641-5.649c3.052,0,4.578,1.582,4.578,4.746l-0.209,1.953H56.19C56.204,16.322,56.375,16.788,56.705,17.075z\n                       M59.802,13.536c0-0.84-0.133-1.424-0.399-1.753c-0.266-0.329-0.732-0.493-1.396-0.493c-0.666,0-1.134,0.171-1.407,0.514\n                       c-0.273,0.343-0.417,0.921-0.431,1.732H59.802z"\n                />\n                <path fill="',
                        o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color", t.opts.autoescape), t.opts.autoescape),
                        o += '"\n                    d="M70.407,11.625h-2.583v4.305c0,0.42,0.011,0.718,0.031,0.893c0.021,0.175,0.098,0.325,0.231,0.451\n                       c0.133,0.126,0.339,0.189,0.619,0.189l1.596-0.042l0.126,2.246c-0.938,0.211-1.651,0.315-2.142,0.315\n                       c-1.26,0-2.121-0.283-2.583-0.851c-0.462-0.566-0.693-1.613-0.693-3.14v-4.368h-1.238V9.231h1.238V6.312h2.814v2.919h2.583V11.625z"\n                />\n                <path fill="',
                        o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color", t.opts.autoescape), t.opts.autoescape),
                        o += '"\n                    d="M76.161,8.979c0.729,0,1.659,0.112,2.794,0.336l0.566,0.126l-0.084,2.226\n                       c-1.106-0.112-1.925-0.168-2.457-0.168c-0.966,0-1.606,0.207-1.921,0.62c-0.315,0.413-0.473,1.193-0.473,2.341\n                       c0,1.148,0.157,1.937,0.473,2.363c0.314,0.427,0.962,0.641,1.942,0.641l2.436-0.168l0.084,2.246\n                       c-1.498,0.295-2.639,0.441-3.423,0.441c-1.554,0-2.671-0.438-3.35-1.312s-1.019-2.278-1.019-4.211c0-1.932,0.35-3.328,1.05-4.189\n                       S74.607,8.979,76.161,8.979z"\n                />\n                <path fill="',
                        o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color", t.opts.autoescape), t.opts.autoescape),
                        o += '"\n                    d="M84.414,19.731H81.6v-14.7h2.814v4.704c0.966-0.504,1.834-0.756,2.604-0.756c1.4,0,2.366,0.413,2.898,1.239\n                       c0.531,0.826,0.798,2.1,0.798,3.822v5.691h-2.814v-5.628c0-0.882-0.104-1.536-0.314-1.963s-0.63-0.641-1.26-0.641\n                       c-0.546,0-1.093,0.084-1.639,0.252l-0.272,0.084V19.731z"\n                />\n                <path fill="',
                        o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color", t.opts.autoescape), t.opts.autoescape),
                        o += '"\n                    d="M96.531,11.625v8.106h-2.814v-8.106h-1.134V9.231h1.134V8.77c0-1.512,0.224-2.555,0.672-3.129\n                       s1.246-0.861,2.395-0.861c0.504,0,1.155,0.07,1.953,0.21l0.44,0.063l-0.042,2.289c-0.616-0.028-1.134-0.042-1.554-0.042\n                       s-0.7,0.112-0.84,0.336c-0.141,0.224-0.21,0.609-0.21,1.155v0.441h2.541v2.394H96.531z"\n                />\n                <path fill="',
                        o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color", t.opts.autoescape), t.opts.autoescape),
                        o += '"\n                    d="M108.753,12.507v4.368c0.028,0.337,0.084,0.571,0.168,0.704s0.259,0.228,0.525,0.283l-0.084,2.121\n                       c-0.714,0-1.285-0.049-1.712-0.146c-0.427-0.099-0.857-0.295-1.291-0.589c-1.008,0.49-2.037,0.735-3.087,0.735\n                       c-2.171,0-3.255-1.147-3.255-3.444c0-1.119,0.301-1.914,0.902-2.383c0.603-0.469,1.526-0.746,2.772-0.83l2.247-0.168v-0.651\n                       c0-0.434-0.099-0.731-0.294-0.893c-0.196-0.161-0.512-0.241-0.945-0.241l-3.948,0.168l-0.084-1.953\n                       c1.498-0.406,2.923-0.609,4.273-0.609c1.352,0,2.324,0.28,2.919,0.84C108.456,10.379,108.753,11.276,108.753,12.507z\n                       M104.028,15.279c-0.784,0.07-1.176,0.49-1.176,1.26c0,0.771,0.343,1.155,1.028,1.155c0.532,0,1.113-0.084,1.743-0.252l0.315-0.084\n                       v-2.247L104.028,15.279z"\n                />\n                <path fill="',
                        o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color", t.opts.autoescape), t.opts.autoescape),
                        o += '"\n                    d="M116.522,8.979c1.47,0,2.545,0.402,3.224,1.208s1.019,2.244,1.019,4.316c0,2.071-0.392,3.503-1.176,4.294\n                       s-2.136,1.187-4.053,1.187c-0.603,0-1.701-0.07-3.298-0.21l-0.798-0.084V5.031h2.814v4.515\n                       C115.15,9.168,115.906,8.979,116.522,8.979z M115.536,17.464c0.938,0,1.567-0.228,1.89-0.683s0.482-1.271,0.482-2.447\n                       c0-1.89-0.588-2.834-1.764-2.834c-0.56,0-1.092,0.07-1.596,0.21l-0.294,0.063v5.607C114.898,17.436,115.325,17.464,115.536,17.464z"\n                />\n            </g>\n        '),
                        o += '\n\n        <g>\n            <path fill="#FFFFFF"\n                  d="M12.5,0.833C6.056,0.833,0.834,6.057,0.834,12.5S6.056,24.167,12.5,24.167S24.167,18.943,24.167,12.5\n                     S18.944,0.833,12.5,0.833z" />\n        </g>\n\n        <g id="logo-circle">\n            <path fill="#1CAAD9"\n                d="M12.5-0.029C5.596-0.029,0,5.568,0,12.472c0,6.904,5.596,12.501,12.5,12.501s12.5-5.597,12.5-12.501\n                   C25.001,5.568,19.405-0.029,12.5-0.029z M11.414,19.911L6.025,16.8v-6.276l5.389,2.911V19.911z M12.374,11.958l-6.376-3.38\n                   l6.376-3.682l6.377,3.682L12.374,11.958z M18.755,16.812l-5.369,3.1v-6.452l5.369-2.901V16.812z"\n            />\n        </g>\n\n    </svg>\n\n',
                        n = n.pop(),
                        new r.SafeString(o)
                    });
                    e.addExport("logo"),
                    e.setVariable("logo", h),
                    u += "\n",
                    a(null, u)
                } catch (d) {
                    a(r.handleError(d, s, o))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e, i) {
    t.exports = i.p + "sketchfab-logo-white-4d9d00172d9b1361ee0b185a6aa1d1ff.png"
}
, function(t, e, i) {
    t.exports = i.p + "sketchfab-logo-8bc6696c7ed7369e1acaee4ec5168169.png"
}
, , , , , , , , , , function(t, e, i) {
    i(292),
    i(433),
    i(293),
    i(291),
    i(555),
    function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/viewer.jinja"] = function() {
            function t(t, e, n, r, a) {
                var s = null
                  , o = null
                  , u = "";
                try {
                    t.getTemplate("skfb_front/macros/buttons.jinja", !1, "skfb_front/macros/viewer.jinja", function(l, c) {
                        return l ? void a(l) : void c.getExported(function(l, c) {
                            if (l)
                                return void a(l);
                            if (!c.hasOwnProperty("star_like_button"))
                                return void a(new Error("cannot import 'star_like_button'"));
                            var h = c.star_like_button;
                            e.setVariable("star_like_button", h),
                            u += "\n",
                            t.getTemplate("skfb_front/macros/model.jinja", !1, "skfb_front/macros/viewer.jinja", function(l, c) {
                                return l ? void a(l) : void c.getExported(function(l, c) {
                                    if (l)
                                        return void a(l);
                                    if (!c.hasOwnProperty("model_name"))
                                        return void a(new Error("cannot import 'model_name'"));
                                    var h = c.model_name;
                                    e.setVariable("model_name", h),
                                    u += "\n",
                                    t.getTemplate("skfb_front/macros/popovers.jinja", !1, "skfb_front/macros/viewer.jinja", function(l, c) {
                                        return l ? void a(l) : void c.getExported(function(l, c) {
                                            if (l)
                                                return void a(l);
                                            if (!c.hasOwnProperty("share_popover"))
                                                return void a(new Error("cannot import 'share_popover'"));
                                            var d = c.share_popover;
                                            e.setVariable("share_popover", d),
                                            u += "\n",
                                            t.getTemplate("skfb_front/macros/user.jinja", !1, "skfb_front/macros/viewer.jinja", function(l, c) {
                                                return l ? void a(l) : void c.getExported(function(l, c) {
                                                    if (l)
                                                        return void a(l);
                                                    if (!c.hasOwnProperty("user_name"))
                                                        return void a(new Error("cannot import 'user_name'"));
                                                    var d = c.user_name;
                                                    e.setVariable("user_name", d),
                                                    u += "\n",
                                                    t.getTemplate("skfb_front/macros/user.jinja", !1, "skfb_front/macros/viewer.jinja", function(l, c) {
                                                        return l ? void a(l) : void c.getExported(function(l, c) {
                                                            if (l)
                                                                return void a(l);
                                                            if (!c.hasOwnProperty("user_avatar"))
                                                                return void a(new Error("cannot import 'user_avatar'"));
                                                            var d = c.user_avatar;
                                                            e.setVariable("user_avatar", d),
                                                            u += "\n",
                                                            t.getTemplate("skfb_front/macros/logo.jinja", !1, "skfb_front/macros/viewer.jinja", function(l, c) {
                                                                return l ? void a(l) : void c.getExported(function(l, c) {
                                                                    if (l)
                                                                        return void a(l);
                                                                    if (!c.hasOwnProperty("logo"))
                                                                        return void a(new Error("cannot import 'logo'"));
                                                                    var p = c.logo;
                                                                    e.setVariable("logo", p),
                                                                    u += "\n\n\n";
                                                                    var f = r.makeMacro(["authUser", "model"], ["options"], function(i, a, u) {
                                                                        n = n.push(),
                                                                        u = u || {},
                                                                        u.hasOwnProperty("caller") && n.set("caller", u.caller),
                                                                        n.set("authUser", i),
                                                                        n.set("model", a),
                                                                        n.set("options", u.hasOwnProperty("options") ? u.options : {});
                                                                        var l = "";
                                                                        return l += '\n\n    <div class="titlebar">\n\n        <div class="summary">\n            ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showInfos", t.opts.autoescape) && (l += '\n                <div class="avatar">\n                    <a target="_blank" href="/models/',
                                                                        l += r.suppressValue(r.memberLookup(a, "uid", t.opts.autoescape), t.opts.autoescape),
                                                                        l += '">',
                                                                        l += r.suppressValue((s = 15,
                                                                        o = 78,
                                                                        r.callWrap(d, "user_avatar", [r.memberLookup(r.memberLookup(a, "user", t.opts.autoescape), "avatars", t.opts.autoescape), {
                                                                            size: 32
                                                                        }])), t.opts.autoescape),
                                                                        l += '</a>\n                </div>\n                <div class="model-info">\n                    <h1 class="title">',
                                                                        l += r.suppressValue((s = 18,
                                                                        o = 49,
                                                                        r.callWrap(h, "model_name", [i, a, {
                                                                            target: "_blank",
                                                                            withRestrictedFlag: !1
                                                                        }])), t.opts.autoescape),
                                                                        l += '</h1>\n                    <h2>by <a target="_blank" href="/models/',
                                                                        l += r.suppressValue(r.memberLookup(a, "uid", t.opts.autoescape), t.opts.autoescape),
                                                                        l += '">',
                                                                        l += r.suppressValue(r.memberLookup(r.memberLookup(a, "user", t.opts.autoescape), "displayName", t.opts.autoescape), t.opts.autoescape),
                                                                        l += "</a></h2>\n                </div>\n            "),
                                                                        l += '\n        </div>\n\n        <div class="actions">\n\n            ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showInfos", t.opts.autoescape) && (l += '\n                <a class="help tooltip tooltip-down share" data-title="Share" data-action="open-share-overlay">\n                    <i class="custom-icons icon-ion-android-share-alt-icon"></i>\n                </a>\n            '),
                                                                        l += "\n\n            ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "allowStops", t.opts.autoescape) && (l += '\n                <a class="help tooltip tooltip-down close hidden" data-title="Stop" data-action="stop">\n                    <i class="custom-icons icon-ion-close-round-icon"></i>\n                </a>\n            '),
                                                                        l += "\n\n        </div>\n\n    </div>\n\n",
                                                                        n = n.pop(),
                                                                        new r.SafeString(l)
                                                                    });
                                                                    e.addExport("viewer_infos"),
                                                                    e.setVariable("viewer_infos", f),
                                                                    u += "\n\n";
                                                                    var g = r.makeMacro(["authUser", "model"], ["options"], function(i, a, u) {
                                                                        n = n.push(),
                                                                        u = u || {},
                                                                        u.hasOwnProperty("caller") && n.set("caller", u.caller),
                                                                        n.set("authUser", i),
                                                                        n.set("model", a),
                                                                        n.set("options", u.hasOwnProperty("options") ? u.options : {});
                                                                        var l = "";
                                                                        return l += '\n    <div class="viewer',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "transparent", t.opts.autoescape) && (l += " transparent"),
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "isStarted", t.opts.autoescape) && (l += " started"),
                                                                        l += '">\n\n        ',
                                                                        l += r.suppressValue((s = 47,
                                                                        o = 21,
                                                                        r.callWrap(f, "viewer_infos", [i, a, r.contextOrFrameLookup(e, n, "options")])), t.opts.autoescape),
                                                                        l += '\n\n        <div class="landing" data-action="start">\n\n            <div class="preview">\n                ',
                                                                        l += r.suppressValue(t.getFilter("image_container").call(e, r.memberLookup(a, "thumbnails", t.opts.autoescape), 1024, 768, !0, !0), t.opts.autoescape),
                                                                        l += '\n            </div>\n\n            <div class="start-button">\n                <button class="play">\n                    <i class="fa fa-play"></i>\n                    <span class="label">3D</span>\n                </button>\n            </div>\n\n            ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showWatermark", t.opts.autoescape) && (l += '\n                <div class="watermark">\n                    <a data-action="watermark" href="',
                                                                        l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                                        l += '" title="View on Sketchfab" target="_blank"></a>\n                </div>\n            '),
                                                                        l += '\n\n        </div>\n\n        <div class="overlays">\n            ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "restricted", t.opts.autoescape) && (l += '\n                <div class="overlay restricted">\n                    <div>\n                        <h3 class="heading">Age-restricted content</h3>\n                        <p>\n                            This 3D scene contains age-restricted content.<br/>\n                            You need to enable age-restricted content to view this.\n                        </p>\n                        <button type="submit" class="button btn-input btn-primary submit" data-action="allowRestricted">Enable age-restricted content</button>\n                        ',
                                                                        l += r.suppressValue((s = 80,
                                                                        o = 29,
                                                                        r.callWrap(p, "logo", [121, 25, {
                                                                            color: "#ffffff"
                                                                        }])), t.opts.autoescape),
                                                                        l += "\n                    </div>\n                </div>\n            "),
                                                                        l += '\n            <div class="overlay help hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <ul class="tabs">\n                        <li class="active"><a href="#" data-target="basic">Navigation basics</a></li>\n                        <li><a href="#" data-target="all">All controls</a></li>\n                    </ul>\n                    <div class="tabs-container">\n                        <div class="tab active" data-tab="basic">\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-refresh"></i>\n                                </div>\n                                <div>\n                                    <b>Orbit around</b>\n                                    <div>\n                                        Left click + drag or<br>\n                                        One finger drag (touch)\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-search-plus"></i>\n                                </div>\n                                <div>\n                                    <b>Zoom</b>\n                                    <div>\n                                        Double click on model<br>\n                                        or scroll anywhere or<br>\n                                        Pinch (touch)\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-arrows"></i>\n                                </div>\n                                <div>\n                                    <b>Pan</b>\n                                    <div>\n                                        Right click + drag or<br />\n                                        Two fingers drag (touch)\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="tab" data-tab="all">\n                            <div>\n                                <div class="section">\n                                    <h2>Orbit navigation</h2>\n                                    <b>Move camera:</b> 1 finger drag or Left Mouse Button<br>\n                                    <b>Pan:</b> 2-finger drag or Right Mouse Button or <kbd>SHIFT</kbd>+ Left Mouse Button<br>\n                                    <b>Zoom on object:</b> Double-tap or Double-click on object<br>\n                                    <b>Zoom out:</b> Double-tap or Double-click on background<br>\n                                    <b>Zoom:</b> Pinch in/out or Mousewheel or <kbd>CTRL</kbd> + Left Mouse Button<br>\n                                </div>\n                                <div class="section">\n                                    <h2>First-person navigation</h2>\n                                    <b>Move:</b> <kbd>?</kbd>,<kbd>?</kbd>,<kbd>?</kbd>,<kbd>?</kbd> (or <kbd>W</kbd>,<kbd>A</kbd>,<kbd>S</kbd>,<kbd>D</kbd>)<br>\n                                    <b>Look around:</b> 1-finger drag or Left Mouse Button<br>\n                                    <b>Adjust speed:</b> Mousewheel<br>\n                                </div>\n                                <div class="section rendering-shortcuts"></div>\n                                <div class="section">\n                                    <h2>Lighting</h2>\n                                    <b>Rotate lighting:</b> 3-finger drag or <kbd>ALT</kbd> + Left Mouse Button<br>\n                                    <b>Rotate env. only:</b> <kbd>ALT</kbd> + <kbd>SHIFT</kbd> + Left Mouse Button<br>\n                                </div>\n                                <div class="section annotation-shortcuts"></div>\n                                <div class="section animation-shortcuts"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="action">\n                        <button class="button" data-action="reset-camera">Reset camera view</button>\n                    </div>\n\n                </div>\n            </div>\n            <div class="overlay share hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <div class="share-link">\n                        <div class="text-field">\n                            <label>Link</label>\n                            <input type="text" class="text" value="" readonly>\n                            <button data-clipboard-target=".text-field .text">copy</button>\n                        </div>\n                    </div>\n                    <div class="share-social">\n                        <a data-action="share-on-facebook" target="_blank"><i class="fa fa-facebook"></i></a>\n                        <a data-action="share-on-twitter" target="_blank"><i class="fa fa-twitter"></i></a>\n                        <a data-action="share-on-reddit" target="_blank"><i class="fa fa-reddit"></i></a>\n                        <a data-action="share-on-tumblr" target="_blank"><i class="fa fa-tumblr"></i></a>\n                        <a data-action="share-on-google-plus" target="_blank"><i class="fa fa-google-plus"></i></a>\n                        <a data-action="share-on-linkedin" target="_blank"><i class="fa fa-linkedin"></i></a>\n                        <a data-action="share-on-pinterest" target="_blank"><i class="fa fa-pinterest"></i></a>\n                        <a class="share-mail" target="_blank"><i class="fa fa-envelope"></i></a>\n                    </div>\n                    <div class="share-embed">\n                        <a class="button" href="" target="_blank">\n                            <i class="fa fa-code"></i> Embed\n                        </a>\n                    </div>\n                </div>\n            </div>\n            <div class="overlay hotspots-overlay hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <h4 class="hotspot-title"></h4>\n                    <div class="hotspot-content markdown-rendered-content"></div>\n                </div>\n            </div>\n            <div class="overlay helper-vr-overlay hidden">\n                <i class="custom-icons icon-ion-close-round-icon close"></i>\n                <div class="inner custom-scrollbar">\n                     <div class="header-helper">\n                        To view this model in virtual reality:\n                    </div>\n                    <div class="content-helper">\n                        <div class="row-helper">\n                            <div class="content-row">\n                                <div class="image"><i class="fa fa-mobile"></i></div>\n                                <div class="text">\n                                    <div class="title">on mobile phone</div>\n                                    <div>with Cardboard or similar</div>\n                                </div>\n                            </div>\n                            <ul class="info">\n                                <li>On your mobile, open this link: <a class="url" target="_blank" href="#"></a></li>\n                                <li>Press the VR icon</li>\n                                <li>Insert your mobile in a Cardboard headset</li>\n                            </ul>\n                        </div>\n                        <div class="row-helper">\n                            <div class="content-row">\n                                <div class="image"><i class="fa fa-desktop"></i></div>\n                                <div class="text">\n                                    <div class="title">on desktop PC <span class="flag-info">BETA</span></div>\n                                    <div>with a VR headset</div>\n                                </div>\n                            </div>\n                            <ul class="info">\n                                <li><a target="_blank" href="https://webvr.info/">Get a WebVR-compatible browser</a></li>\n                                <li>Enable WebVR</li>\n                                <li>Open this model</li>\n                                <li>Click on the VR icon</li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div class="footer-helper">\n                        <a target="_blank" href="https://help.sketchfab.com/hc/en-us/articles/204777439-Mobile-VR-and-Desktop-WebVR?utm_source=website&utm_campaign=vr_hints">\n                        More info on Virtual reality.\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="webgl">\n\n            <canvas class="canvas" data-modelUid="',
                                                                        l += r.suppressValue(r.memberLookup(a, "uid", t.opts.autoescape), t.opts.autoescape),
                                                                        l += '" data-action="create-hotspot">\n            </canvas>\n\n            <div class="loading-container">\n                <div class="secondary-progress">\n                    <div class="secondary-progress-percentage"></div>\n                    <div class="secondary-progress-display"></div>\n                </div>\n                <div class="main-progress">\n                    <img src="',
                                                                        l += r.suppressValue(t.getFilter("best_fit").call(e, r.memberLookup(a, "thumbnails", t.opts.autoescape), 50, 50), t.opts.autoescape),
                                                                        l += '" class="loading-thumbnail" />\n                    <div class="main-progress-wrapper">\n                        <div class="main-progress-percentage loading-percentage">0%</div>\n                        <p>Loading 3D model</p>\n                        <progress class="main-progress-display" value="0" max="1"></progress>\n                    </div>\n                </div>\n            </div>\n\n            <div class="hotspots"></div>\n\n            <div class="gui">\n\n                <div class="animation-not-supported hidden">\n                    <a href="#" class="close"></a>\n                    <p>Model is too heavy for your device and can not be rendered properly</p>\n                </div>\n\n                ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showControls", t.opts.autoescape) && r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showAnnotations", t.opts.autoescape) && (l += '\n                    <div class="hotspot-controls-responsive">\n                        <div data-title="Previous Annotation" data-action="prev-annotation">\n                            <div class="icon fa fa-caret-left"></div>\n                        </div>\n                        <div data-title="Next Annotation" data-action="next-annotation">\n                            <div class="icon fa fa-caret-right"></div>\n                        </div>\n                    </div>\n                '),
                                                                        l += '\n\n                <div class="controls">\n\n                    ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showWatermark", t.opts.autoescape) && (l += '\n                        <div class="watermark">\n                            <a data-action="watermark" href="',
                                                                        l += r.suppressValue(r.memberLookup(a, "viewerUrl", t.opts.autoescape), t.opts.autoescape),
                                                                        l += '" title="View on Sketchfab" target="_blank"></a>\n                        </div>\n                    '),
                                                                        l += "\n\n                    ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showControls", t.opts.autoescape) && (l += "\n\n                        ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showAnimations", t.opts.autoescape) && (l += '\n                            <div class="animation-controls widget">\n                                <div class="timeline">\n                                    <div class="timeline-wrapper">\n                                        <div class="track">\n                                            <div class="bar">\n                                            </div>\n                                            <div class="knob">\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <a href="#" class="control play fa"></a>\n                                <a href="#" class="control next fa"></a>\n                                <div class="animation-timer control progress help" data-unit="time">00:00.00</div>\n                                <div class="animation-list control has-menu">\n                                    <p class="animation-name"></p>\n                                    <div class="control-menu list">\n                                        <p class="static-pose animation-item" data-uid="-1">Static Pose</p>\n                                        <ul></ul>\n                                    </div>\n                                </div>\n                            </div>\n                        '),
                                                                        l += "\n\n                        ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showAnnotations", t.opts.autoescape) && (l += '\n                            <div class="hotspot-controls widget">\n\n                                <div data-title="Previous Annotation" data-action="prev-annotation">\n                                    <div class="icon fa fa-caret-left"></div>\n                                </div>\n\n                                <div class="hotspot-name default has-menu" data-action="toggle-annotation-list">\n                                    Select an annotation\n                                </div>\n\n                                <div data-title="Next Annotation" data-action="next-annotation">\n                                    <div class="icon fa fa-caret-right"></div>\n                                </div>\n\n                                <div class="list hotspots-list has-menu"></div>\n\n                            </div>\n                        '),
                                                                        l += '\n\n                        <div class="spacer"></div>\n\n                        ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showGeneralControls", t.opts.autoescape) && (l += '\n                            <div class="general-controls widget">\n\n                                ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showHelp", t.opts.autoescape) && (l += '\n                                    <a href="#" class="control tooltip help" data-title="Help">\n                                        <i class="fa fa-question"></i>\n                                    </a>\n                                '),
                                                                        l += "\n                                ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showSettings", t.opts.autoescape) && (l += '\n                                    <a href="#" class="control tooltip settings has-menu" data-title="Settings">\n                                        <i class="fa fa-gear"></i>\n                                        <div class="control-menu settings-menu">\n                                            <div class="control-menu-wrapper">\n                                                <div class="control-menu-list"></div>\n                                                <div class="control-menu-pane"></div>\n                                            </div>\n                                        </div>\n                                        <span class="control-badge"></span>\n                                    </a>\n                                '),
                                                                        l += "\n                                ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showVr", t.opts.autoescape) && (l += '\n                                    <a href="#" class="control tooltip vr" data-title="View in VR">\n                                        <i class="custom-icons icon-vr-icon"></i>\n                                    </a>\n                                '),
                                                                        l += "\n                                ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showFullScreen", t.opts.autoescape) && (l += '\n                                    <a href="#" class="control tooltip tooltip-right-bound fullscreen" data-title="Fullscreen">\n                                        <i class="custom-icons icon-fullscreen-icon"></i>\n                                    </a>\n                                '),
                                                                        l += "\n                            </div>\n                        "),
                                                                        l += "\n                    "),
                                                                        l += "\n                </div>\n\n                ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "allowSnapshots", t.opts.autoescape) && (l += '\n                    <div class="snapshot-guides">\n                    </div>\n                    <div class="snapshot widget">\n                        <a class="button help">\n                            <span class="normal"><i class="icon fa fa-camera"></i> Save view</span>\n                            <span class="progress"><i class="icon fa fa-camera"></i> Saving&hellip;</span>\n                            <span class="success"><i class="icon fa fa-check"></i>Saved</span>\n                            <div class="tooltip tooltip-right">Save thumbnail and initial camera view</div>\n                        </a>\n                        <div class="img-container invisible"></div>\n                    </div>\n                    <div class="snapshot-flash">\n                    </div>\n                '),
                                                                        l += '\n\n                <div class="viewer-hint widget disabled">\n                    <div class="viewer-movehint">\n                        <i class="icon"></i>\n                        <span class="label">\n                            click &amp; hold<br>\n                            to rotate\n                        </span>\n                    </div>\n                </div>\n\n            </div>\n\n        </div>\n\n        <div class="osd widget">\n            <div class="osd-content">\n            </div>\n        </div>\n\n        <div class="fallback" style="display: none">\n\n            <div class="fallback-viewport">\n                <img src="" alt="" class="fallback-sprite">\n            </div>\n\n            <div class="fallback-warning">\n                <div class="inner">\n                    For compatibility reasons, 3D is not available (<a href="https://help.sketchfab.com/hc/en-us/articles/203059088-Compatibility?utm_source=website&amp;utm_campaign=error_fallback" target="_blank">see requirements</a>).<br>\n                    You are seeing a 360&deg; image instead.\n                </div>\n            </div>\n\n            <div class="fallback-error fallback-error-loading">\n                <div class="inner">\n                    <p>Connection error. Please try again.</p>\n                </div>\n            </div>\n\n            <div class="fallback-error fallback-error-nofallback">\n                <div class="inner">\n                    <p>Sorry, the model can\'t be displayed.</p>\n                    <p>Please check out <a href="https://help.sketchfab.com/hc/en-us/articles/203059088-Compatibility?utm_source=website&utm_campaign=error_fallback" target="_blank">our FAQ</a> to learn how to fix this issue.</p>\n                </div>\n            </div>\n\n            <div class="progress-bar">\n                <div class="progress-bar-percentage"></div>\n                <div class="progress-bar-display"></div>\n            </div>\n\n            <div class="progress-circle">\n                <div class="progress-circle-percentage loading-percentage"></div>\n                <svg class="progress-circle-display" version="1.1">\n                    <path class="progress-circle-path" fill="none" stroke="#1caad9" stroke-width="6" />\n                </svg>\n            </div>\n\n            ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showControls", t.opts.autoescape) && (l += '\n                <div class="controls">\n                    <div class="control control-fullscreen" data-title="Toggle Fullscreen" data-action="fullscreen">\n                        <div class="icon custom-icons icon-fullscreen-icon"></div>\n                    </div>\n                </div>\n            '),
                                                                        l += "\n\n        </div>\n\n    </div>\n\n",
                                                                        n = n.pop(),
                                                                        new r.SafeString(l)
                                                                    });
                                                                    e.addExport("viewer"),
                                                                    e.setVariable("viewer", g),
                                                                    u += "\n\n";
                                                                    var m = r.makeMacro(["mode"], [], function(t, e) {
                                                                        n = n.push(),
                                                                        e = e || {},
                                                                        e.hasOwnProperty("caller") && n.set("caller", e.caller),
                                                                        n.set("mode", t);
                                                                        var i = "";
                                                                        return i += "\n\n    ",
                                                                        "orbit" == t && (i += '\n\n        <div class="viewer-mode-help">\n            <h2>Orbit mode</h2>\n            <ul class="help-shortcuts">\n                <li class="mouse-left">Rotate</li>\n                <li class="mouse-wheel">Zoom <small class="hint">also works with CTRL+left click</small></li>\n                <li class="mouse-right">Pan <small class="hint">also works with SHIFT+left click</small></li>\n            </ul>\n        </div>\n\n    '),
                                                                        i += "\n\n    ",
                                                                        "fps" == t && (i += '\n\n        <div class="viewer-mode-help">\n            <h2>First person mode</h2>\n            <ul class="help-shortcuts">\n                <li class="mouse-left">Look around</li>\n                <li class="mouse-wheel">Walking speed</li>\n                <li class="kbd-wasd">Walk <small class="hint">also works with arrows or Z,Q,S,D</small></li>\n            </ul>\n        </div\n\n    '),
                                                                        i += "\n\n",
                                                                        n = n.pop(),
                                                                        new r.SafeString(i)
                                                                    });
                                                                    e.addExport("help_viewer_mode"),
                                                                    e.setVariable("help_viewer_mode", m),
                                                                    u += "\n\n";
                                                                    var v = r.makeMacro(["hotspots"], [], function(i, a) {
                                                                        n = n.push(),
                                                                        a = a || {},
                                                                        a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                                        n.set("hotspots", i);
                                                                        var s = "";
                                                                        s += '\n<a href="#" data-action="toggle-autopilot" class="stopped"></a>\n<ul>\n    ',
                                                                        n = n.push();
                                                                        var o = i;
                                                                        if (o)
                                                                            for (var u = o.length, l = 0; l < o.length; l++) {
                                                                                var c = o[l];
                                                                                n.set("hotspot", c),
                                                                                n.set("loop.index", l + 1),
                                                                                n.set("loop.index0", l),
                                                                                n.set("loop.revindex", u - l),
                                                                                n.set("loop.revindex0", u - l - 1),
                                                                                n.set("loop.first", 0 === l),
                                                                                n.set("loop.last", l === u - 1),
                                                                                n.set("loop.length", u),
                                                                                s += '\n        <li class="link"><a data-hotspot-target="',
                                                                                s += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "loop"), "index0", t.opts.autoescape), t.opts.autoescape),
                                                                                s += '" title="',
                                                                                s += r.suppressValue(r.memberLookup(c, "name", t.opts.autoescape), t.opts.autoescape),
                                                                                s += '"><span class="index">',
                                                                                s += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "loop"), "index", t.opts.autoescape), t.opts.autoescape),
                                                                                s += "</span> ",
                                                                                s += r.suppressValue(r.memberLookup(c, "name", t.opts.autoescape), t.opts.autoescape),
                                                                                s += "</a></li>\n    "
                                                                            }
                                                                        return n = n.pop(),
                                                                        s += "\n</ul>\n",
                                                                        n = n.pop(),
                                                                        new r.SafeString(s)
                                                                    });
                                                                    e.addExport("hotspots_list"),
                                                                    e.setVariable("hotspots_list", v),
                                                                    u += "\n\n";
                                                                    var _ = r.makeMacro(["hasFullscreen"], [], function(e, a) {
                                                                        n = n.push(),
                                                                        a = a || {},
                                                                        a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                                        n.set("hasFullscreen", e);
                                                                        var s = "";
                                                                        return s += '\n\n    <div class="vr-mode-help">\n        ',
                                                                        s += '\n        <img src="',
                                                                        s += r.suppressValue(i(568), t.opts.autoescape),
                                                                        s += '" width="96" height="116" alt="Place your landscape oriented phone in front of lenses">\n\n        <p>\n            ',
                                                                        s += e ? '\n                <button class="button btn-textified" data-action="fullscreen">Switch to fullscreen</button><br>\n                then place your phone into your Cardboard viewer\n            ' : "\n                Place your phone into your Cardboard viewer\n            ",
                                                                        s += "\n        </p>\n    </div>\n\n",
                                                                        n = n.pop(),
                                                                        new r.SafeString(s)
                                                                    });
                                                                    e.addExport("help_vr_mode"),
                                                                    e.setVariable("help_vr_mode", _),
                                                                    u += "\n",
                                                                    a(null, u)
                                                                })
                                                            })
                                                        })
                                                    })
                                                })
                                            })
                                        })
                                    })
                                })
                            })
                        })
                    })
                } catch (l) {
                    a(r.handleError(l, s, o))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e, i) {
    t.exports = i.p + "cardboard-instructions-3559e10f564c87ffc582505a3919b0ad.svg"
}
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(t, e) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/vrMenu.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    var u = n.makeMacro([], ["options"], function(r) {
                        i = i.push(),
                        r = r || {},
                        r.hasOwnProperty("caller") && i.set("caller", r.caller),
                        i.set("options", r.hasOwnProperty("options") ? r.options : {});
                        var a = "";
                        return a += '\n\n<div style="width:700px;">',
                        n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "hasModelAnnotations", t.opts.autoescape) && (a += '<div class="vr-menu-row">\n            <button id="vrPrevButton" class="vr-button vr-button-small"><i class="fa fa-arrow-left"></i></button>\n            <span class="vr-localize-icon"><i class="fa fa-map-marker"></i></span>\n            <button id="vrNextButton" class="vr-button vr-button-small"><i class="fa fa-arrow-right" aria-hidden="true"></i></button>\n        </div>'),
                        a += '<button id="vrHomeButton" class="vr-button">Home</button>\n    <button id="vrHelpButton" class="vr-button">Help</button>\n    <button id="vrExitButton" class="vr-button vr-round-button"><i  class="fa fa-times"></i></button>\n</div>\n',
                        i = i.pop(),
                        new n.SafeString(a)
                    });
                    e.addExport("panel"),
                    e.setVariable("panel", u),
                    o += "\n",
                    r(null, o)
                } catch (l) {
                    r(n.handleError(l, a, s))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(t, e) {
    "use strict";
    var i = !1
      , n = function(t) {
        return void 0 !== t && (i = t),
        i
    };
    t.exports = n
}
, , function(t, e, i) {
    "use strict";
    var n = i(1194)
      , r = i(1517)
      , a = i(1524)
      , s = i(1563)
      , o = i(1582)
      , u = i(1585)
      , l = i(1588)
      , c = i(1592)
      , h = i(1602)
      , d = i(1606)
      , p = i(1620)
      , f = i(1627)
      , g = i(1633)
      , m = i(1646)
      , v = i(1661)
      , _ = i(1671);
    t.exports = [n, r, a, s, o, u, l, c, h, d, p, f, g, m, v, _]
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1196)
      , a = i(1491)
      , s = {
        FeatureName: "animation",
        ModelType: r,
        ViewListType: [a]
    };
    t.exports = n.create(s)
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = function(t) {
        this._views = [],
        t && (this._name = t.FeatureName,
        this._modelName = t.ModelName,
        this._modelType = t.ModelType,
        this._viewListType = t.ViewListType.slice(0))
    };
    r.prototype = {
        getName: function() {
            return this._name
        },
        getModel: function() {
            return this._model
        },
        addView: function(t) {
            t && this._views.push(t)
        },
        init: function(t) {
            if (this._model || (this._model = t.getModelByName(this._modelName)),
            !this._model) {
                var e = this._modelType;
                this._model = new e,
                this._model.init && this._model.init(t)
            }
            var i = function(e) {
                var i = new e({
                    model: this._model,
                    context: t
                });
                this.addView(i)
            };
            this._viewListType.forEach(function(t) {
                i.call(this, t)
            }, this),
            t.addFeature(this)
        }
    },
    r.create = function(t) {
        var e = function() {
            r.call(this, e)
        };
        return e.prototype = n.extend({}, r.prototype),
        n.extend(e, t),
        e.getName = function() {
            return t.FeatureName
        }
        ,
        e
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(234)
      , a = i(1197)
      , s = i(1191)
      , o = i(1465)
      , u = r.Model.extend({
        defaults: function() {
            var t = this.getResourceManager().getOrCreateAnimationCollection().resource;
            return s() || t.remove(t.where({
                isEnabled: !1
            })),
            {
                animations: t,
                currentUID: "-1",
                speed: 1,
                autoplay: !0,
                playing: !0,
                cycleMode: "one",
                fps: -1,
                progress: 0
            }
        },
        getName: function() {
            return "Animation"
        },
        getResourceManager: function() {
            return this._resourceManager || a.instance
        },
        getAnimationByUID: function(t) {
            return this.get("animations").find(function(e) {
                return e.get("uid") === t
            })
        },
        getCurrentAnimation: function() {
            return this.getAnimationByUID(this.get("currentUID"))
        },
        getEnabledAnimationsCount: function() {
            return this.get("animations").where({
                isEnabled: !0
            }).length
        },
        getFirstEnabledAnimation: function() {
            for (var t = this.get("animations"), e = t.length, i = 0; i < e; ++i) {
                var n = t.at(i);
                if (n && n.get("isEnabled"))
                    return n
            }
        },
        init: function(t) {
            this._viewer = t.getViewer();
            var e = t.getModel().get("options")
              , i = e.animation;
            if (i && i.order) {
                this.set("speed", i.speed),
                this.set("cycleMode", i.cycleMode),
                this.set("autoplay", i.autoplay),
                this.set("playing", o().animationAutoplay);
                var r = this.get("animations")
                  , a = n.invert(i.order);
                r.forEach(function(t) {
                    t.set("order", parseInt(a[t.get("uid")], 10))
                }),
                r.sort()
            }
        },
        getJSON: function() {
            return {
                order: this.get("animations").pluck("uid"),
                speed: this.get("speed"),
                cycleMode: this.get("cycleMode"),
                autoplay: "-1" !== this.get("currentUID")
            }
        }
    });
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(1198)
      , a = i(216)
      , s = i(1458)
      , o = i(1464)
      , u = i(1468)
      , l = i(1469)
      , c = i(1472)
      , h = i(449)
      , d = i(1473)
      , p = i(1481)
      , f = i(1484)
      , g = i(1487)
      , m = i(1488)
      , v = i(1489)
      , _ = r.osg
      , b = function(t) {
        t = this.computeURL(t);
        var e = new _.Image;
        return e.setURL(t),
        n.resolve(e)
    }
      , x = []
      , A = function(t) {
        return function() {
            var e = this.getJSON()
              , i = e.UniqueID
              , r = new _.BufferArray(_.BufferArray[e.Type]);
            r.setItemSize(e.ItemSize),
            r.setElements(x);
            var a = r.getInstanceID();
            if (t[a] = {},
            e.Array) {
                var s = Object.keys(e.Array)[0]
                  , o = e.Array[s];
                o.Elements ? t[a].inlined = o.Elements : (t[a].vb = o,
                t[a].type = s)
            } else
                t[a].inlined = e.Elements;
            var u = n.defer();
            return void 0 !== i && (this._identifierMap[i] = u.promise),
            u.resolve(r),
            u.promise
        }
    }
      , y = function(t) {
        return function(e, i) {
            return e = i.currentAnimationUID ? i.currentAnimationUID : this.computeURL(e),
            t.getBinaryArray(e, i).getPromise()
        }
    }
      , S = function(t, e) {
        this.resource = t,
        this.promise = e
    }
      , C = function(t) {
        if (!t) {
            if (C.instance)
                return C.instance;
            C.instance = this
        }
        return this._maps = {},
        this._resourceLoader = new s,
        this
    };
    C.Entry = S,
    C.prototype = {
        setModelUID: function(t) {
            this._modelUID = t
        },
        setStateContextOSG: function(t) {
            this._state = t
        },
        getInstance: function() {
            return C.instance
        },
        register: function(t, e) {
            this._maps[t] = e
        },
        exist: function(t) {
            var e = this._maps[t];
            return e
        },
        hashTextureOptions: function(t) {
            var e = a.chain(t).pick(o.getValidOptions()).values().value()
              , i = e.join("");
            return i
        },
        getOrCreateAnimationCollection: function() {
            var t = "animationCollection"
              , e = this.exist(t);
            if (e)
                return e;
            var i = new v([],{
                filters: new m({
                    modelUID: this._modelUID
                })
            });
            return e = new S(i,n.resolve(i.fetch())),
            this.register(t, e),
            e
        },
        getOrCreateHotspotCollection: function() {
            var t = "hotspotCollection"
              , e = this.exist(t);
            if (e)
                return e;
            var i = new h([],{
                filters: new c({
                    modelUID: this._modelUID
                })
            });
            return e = new S(i,n.resolve(i.fetch())),
            this.register(t, e),
            e
        },
        getOrCreateImageCollection: function() {
            var t = "imageCollection"
              , e = this.exist(t);
            if (e)
                return e;
            var i = new l([],{
                filters: new u({
                    modelUID: this._modelUID
                })
            });
            return e = new S(i,n.resolve(i.fetch())),
            this.register(t, e),
            e.promise.then(function() {
                i.forEach(function(t) {
                    0 === t.getImages().length && i.remove(t)
                })
            }),
            e
        },
        getOrCreateTextureProxy: function(t, e) {
            var i = this.hashTextureOptions(e)
              , r = [t, i].join("")
              , a = this.exist(r);
            if (a)
                return a;
            var s = this.getOrCreateImageCollection();
            if (s && s.resource) {
                var u = s.resource.get(t);
                if (u) {
                    var l = new f;
                    return l.setImageProxy(u),
                    o.setOptions(e, l),
                    a = new S(l,n.resolve(l)),
                    this.register(r, a),
                    a
                }
            }
        },
        getOrCreateImage: function(t, e) {
            var i = this._resourceLoader.getImage(t, e)
              , n = i.getPromise()
              , r = ["image", t].join("")
              , a = this.exist(r);
            return a ? a : (a = new S(null,n),
            n.then(function(t) {
                e && (t._alphaInR = "A" === e.format),
                a.image = t
            }),
            this.register(r, a),
            a)
        },
        getOrCreateTexture: function(t, e) {
            var i = function(t) {
                !this._state || t._textureObject && !t.isDirty() || this._state.applyTextureAttribute(0, t)
            }
            .bind(this)
              , r = o.createValidOptions(e)
              , a = this.hashTextureOptions(r)
              , s = [t, a].join("")
              , u = this.exist(s)
              , l = !!(e && e.transferToGPU && this._state);
            if (u)
                return l && (u.promise.isFulfilled() ? i(u.texture) : u._bindToGPU = !0),
                u;
            r.cubemap = e && e.cubemap;
            var c = r.cubemap ? new g : new f;
            c.setTextureSize(1, 1),
            o.setOptions(r, c),
            e && void 0 !== e.convertNPOT && (c._convertNPOT = e.convertNPOT);
            var h = this._resourceLoader.getImage(t, e)
              , d = h.getPromise()
              , p = n.defer()
              , m = p.promise;
            u = new S(c,m),
            u.texture = c,
            u._bindToGPU = l;
            var v = this;
            return d.then(function(t) {
                if (r.cubemap)
                    for (var e = 0; e < 6; e++) {
                        var n = _.Texture.TEXTURE_CUBE_MAP_POSITIVE_X + e;
                        c.setImage(n, t[n], "RGBA")
                    }
                else
                    c.setImage(t);
                c.dirty(),
                u._bindToGPU && i(c),
                p.resolve(c)
            })["catch"](function() {
                v.register(s, void 0),
                p.reject(c)
            }).done(),
            this.register(s, u),
            u
        },
        getOrCreateModel: function(t, e) {
            var i = t
              , r = this.exist(i);
            if (r)
                return r;
            var s = e && e.node ? e.node : new _.Node
              , o = a.clone(e) || {};
            o.readImageURL = b,
            o.readBinaryArrayURL = y(this._resourceLoader),
            o.bufferMap = {},
            o.readBufferArray = A(o.bufferMap),
            _.time("Download " + t.split("/").pop() + " (Async)");
            var u = this._resourceLoader.getModel(t, o)
              , l = u.getPromise()
              , c = n.defer()
              , h = c.promise;
            r = new S(s,h),
            r.node = s;
            var d = n.defer();
            r.texturesReadyToload = d.promise;
            var p = t.split("/");
            p.length = p.length - 1,
            p.length <= 0 && _.error("getOrCreateModel: can't find prefix to load subdata");
            var f = p.join("/") + "/";
            return o.prefixURL = f,
            this._loadModel(l, t, o, c, s, d),
            this.register(i, r),
            r
        },
        _loadModel: function(t, e, i, n, r, a) {
            var s = function(t) {
                _.error("getOrCreateModel error : " + t),
                _.error(t.stack)
            }
              , o = e.split("/").pop();
            t.then(function(t) {
                _.timeEnd("Download " + o + " (Async)"),
                _.time("JSONparse " + o);
                var e = JSON.parse(t);
                _.timeEnd("JSONparse " + o),
                _.time("parseSceneGraph " + o + " (Async)");
                var r = p.parse(e, i, n.promise);
                return r
            }).then(function(t) {
                _.timeEnd("parseSceneGraph " + o + " (Async)"),
                _.time("DownloadAndLoadBuffer " + o + " (Async)");
                var e = d.postParse(t, this._resourceLoader, i);
                a.resolve(),
                e.then(function() {
                    _.timeEnd("DownloadAndLoadBuffer " + o + " (Async)"),
                    r.addChild(t),
                    n.resolve(r)
                })["catch"](s)
            }
            .bind(this))["catch"](s)
        },
        run: function() {
            this._resourceLoader.run()
        }
    },
    new C,
    t.exports = C
}
, function(t, e, i) {
    "use strict";
    var n = i(1199)
      , r = i(1201)
      , a = i(1324)
      , s = i(1339)
      , o = i(1345)
      , u = i(1368)
      , l = i(1430)
      , c = i(1377)
      , h = i(1444)
      , d = i(1454)
      , p = i(1455)
      , f = i(1456)
      , g = n;
    g.osg = r,
    g.osgAnimation = a,
    g.osgDB = s,
    g.osgGA = o,
    g.osgUtil = u,
    g.osgViewer = l,
    g.osgShader = c,
    g.osgShadow = h,
    g.osgText = d,
    g.osgWrappers = p,
    g.osgPlugins = f;
    var m = ["osg", "osgAnimation", "osgDB", "osgGA", "osgUtil", "osgViewer", "osgShader", "osgShadow", "osgText", "osgWrappers", "osgPlugins"];
    g.globalify = function() {
        m.forEach(function(t) {
            window[t] = g[t]
        })
    }
    ,
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(1200);
    t.exports = {
        name: n.name,
        version: n.version,
        author: n.author
    }
}
, function(t, e) {
    t.exports = {
        devDependencies: {
            chai: "^3.5.0",
            "grunt-contrib-connect": "~0.9",
            "grunt-documentation": "*",
            "grunt-jsbeautifier": "^0.2.10",
            "grunt-mocha": "^1.0.2",
            "grunt-release": "^0.10.0",
            mocha: "^2.5.3",
            "webpack-strip-block": "0.0.1",
            "grunt-plato": "~0.2.1"
        },
        peerDependencies: {
            grunt: ">=0.4.0"
        },
        dependencies: {
            "gl-matrix": "^2.3.2",
            "grunt-lib-phantomjs": "^1.0.2",
            "webpack-dev-server": "^1.7.0",
            webpack: "^1.7.3",
            "raw-loader": "^0.5.1",
            path: "^0.11.14",
            leapjs: "^0.6.4",
            "json-loader": "^0.5.4",
            jquery: "^2.1.3",
            hammerjs: "^2.0.4",
            "grunt-webpack": "^1.0.8",
            "grunt-shell": "*",
            "grunt-git": "*",
            "grunt-eslint": "^17.1.0",
            "grunt-copy-to": "0.0.12",
            "grunt-contrib-uglify": "*",
            "grunt-contrib-jshint": "*",
            "grunt-contrib-copy": "*",
            "grunt-contrib-clean": "*",
            grunt: "> 1.0.0",
            glob: "*",
            extend: "*",
            "eslint-plugin-private-variables": "^0.1.2",
            eslint: "^1.3.1"
        },
        contributors: ["Paul Cheyrou-Lagrze <tuan.kuranes@gmail.com>", "Jordi Torres <jtorresfabra@gmail.com>", "Matt Fontaine <tehqin@gmail.com>", "Stephane Ginier <stephane.ginier@gmail.com>"],
        version: "0.2.7",
        author: "Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)",
        license: "MIT",
        description: "OpenSceneGraph implementation in javascript",
        repository: {
            url: "git@github.com:cedricpinson/osgjs.git",
            type: "git"
        },
        name: "OpenSceneGraph"
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1202)
      , r = i(1258)
      , a = i(1259)
      , s = i(1242)
      , o = i(1211)
      , u = i(1225)
      , l = i(1243)
      , c = i(1260)
      , h = i(1262)
      , d = i(1233)
      , p = i(1231)
      , f = i(1263)
      , g = i(1264)
      , m = i(1261)
      , v = i(1267)
      , _ = i(1268)
      , b = i(1290)
      , x = i(1254)
      , A = i(1245)
      , y = i(1246)
      , S = i(1291)
      , C = i(1273)
      , M = i(1292)
      , w = i(1234)
      , T = i(1240)
      , E = i(1239)
      , I = i(1293)
      , k = i(1294)
      , F = i(1300)
      , D = i(1301)
      , N = i(1269)
      , R = i(1302)
      , P = i(1274)
      , L = i(1227)
      , O = i(1255)
      , V = i(1213)
      , B = i(1303)
      , U = i(1230)
      , G = i(1247)
      , z = i(1209)
      , H = i(1229)
      , j = i(1207)
      , W = i(1210)
      , q = i(1275)
      , Y = i(1265)
      , Q = i(1266)
      , X = i(1305)
      , K = i(1244)
      , J = i(1306)
      , Z = i(1248)
      , $ = i(1307)
      , tt = i(1271)
      , et = i(1270)
      , it = i(1272)
      , nt = i(1311)
      , rt = i(1312)
      , at = i(1313)
      , st = i(1314)
      , ot = i(1228)
      , ut = i(1205)
      , lt = i(1226)
      , ct = i(1237)
      , ht = i(1315)
      , dt = i(1208)
      , pt = i(1295)
      , ft = i(1238)
      , gt = i(1316)
      , mt = i(1203)
      , vt = i(1317)
      , _t = i(1319)
      , bt = i(1309)
      , xt = i(1321)
      , At = i(1204)
      , yt = i(1322)
      , St = i(1232)
      , Ct = i(1206)
      , Mt = i(1323)
      , wt = i(1235)
      , Tt = {};
    Tt.AutoTransform = n,
    Tt.BillboardAttribute = r,
    Tt.BlendColor = a,
    Tt.BlendFunc = s,
    Tt.BoundingBox = o,
    Tt.BoundingSphere = u,
    Tt.BufferArray = l,
    Tt.ColorMask = h,
    Tt.Camera = c,
    Tt.ColorMask = h,
    Tt.ComputeBoundsVisitor = d,
    mt.objectMix(Tt, p),
    Tt.CullFace = f,
    Tt.CullingSet = g,
    Tt.CullSettings = m,
    Tt.CullStack = v,
    Tt.CullVisitor = _,
    Tt.Depth = b,
    Tt.DrawArrayLengths = x,
    Tt.DrawArrays = A,
    Tt.DrawElements = y,
    Tt.EllipsoidModel = S,
    Tt.WGS_84_RADIUS_EQUATOR = S.WGS_84_RADIUS_EQUATOR,
    Tt.WGS_84_RADIUS_POLAR = S.WGS_84_RADIUS_POLAR,
    Tt.FrameBufferObject = C,
    Tt.FrameStamp = M,
    Tt.Geometry = w,
    Tt.GLObject = T,
    Tt.Image = E,
    Tt.ImageStream = I,
    Tt.KdTree = k,
    Tt.KdTreeBuilder = F,
    Tt.Light = D,
    Tt.LightSource = N,
    Tt.LineWidth = R,
    Tt.Lod = P,
    Tt.Map = L,
    Tt.Material = O,
    mt.objectMix(Tt, V),
    Tt.Matrix = B,
    Tt.MatrixTransform = G,
    Tt.MatrixMemoryPool = U,
    Tt.Node = z,
    Tt.NodeVisitor = H,
    mt.objectMix(Tt, j),
    Tt.Object = W,
    Tt.PagedLOD = q,
    Tt.Plane = Q,
    Tt.Polytope = Y,
    Tt.PrimitiveSet = K,
    Tt.PrimitiveFunctor = X,
    Tt.Program = J,
    Tt.Projection = Z,
    Tt.Quat = $,
    Tt.RenderBin = tt,
    Tt.RenderLeaf = et,
    Tt.RenderStage = it,
    Tt.Shader = nt,
    mt.objectMix(Tt, rt),
    Tt.Stack = at,
    Tt.State = st,
    Tt.StateAttribute = ot,
    Tt.StateGraph = ut,
    Tt.StateSet = lt,
    Tt.Scissor = yt,
    Tt.Texture = ct,
    Tt.TextureCubeMap = ht,
    Tt.Transform = dt,
    Tt.TriangleIndexFunctor = pt,
    Tt.Uniform = ft,
    Tt.UpdateVisitor = gt,
    mt.objectMix(Tt, mt),
    Tt.Vec2 = vt,
    Tt.Vec3 = _t,
    Tt.Vec4 = bt,
    Tt.Viewport = xt;
    var Et = i(1212);
    Tt.vec2 = Et.vec2,
    Tt.vec3 = Et.vec3,
    Tt.vec4 = Et.vec4,
    Tt.quat = Et.quat,
    Tt.mat4 = Et.mat4,
    Tt.memoryPools = At.memoryPools,
    Tt.Transform.RELATIVE_RF = St.RELATIVE_RF,
    Tt.Transform.ABSOLUTE_RF = St.ABSOLUTE_RF,
    Tt.Timer = Ct,
    Tt.TimerGPU = Mt,
    Tt.WebGLCaps = wt,
    t.exports = Tt
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1208)
      , a = i(1212).vec3
      , s = i(1212).vec4
      , o = i(1212).quat
      , u = i(1212).mat4
      , l = i(1229)
      , c = i(1232)
      , h = i(1209)
      , d = function() {
        r.call(this),
        this._matrix = u.create(),
        this._position = a.create(),
        this._matrixDirty = !0,
        this._scale = a.fromValues(1, 1, 1),
        this._minimumScale = 0,
        this._maximumScale = Number.MAX_VALUE,
        this._rotation = o.create(),
        this._pivotPoint = a.create(),
        this._autoScaleToScreen = !1,
        this._autoRotateToScreen = !1,
        this._cachedMatrix = u.create(),
        this._firstTimeToInitEyePoint = !0,
        this._autoScaleTransitionWidthRatio = .25,
        this._billboardAttribute = void 0,
        this._previousWidth = 0,
        this._previousHeight = 0,
        this._previousProjection = u.create(),
        this._previousModelView = u.create(),
        this._previousPosition = a.create()
    };
    d.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getMatrix: function() {
            return this._matrix
        },
        setMatrix: function(t) {
            this._matrix = t,
            this.dirtyBound()
        },
        setPosition: function(t) {
            this._position = t,
            this._matrixDirty = !0,
            this.dirtyBound()
        },
        getPosition: function() {
            return this._position
        },
        setRotation: function(t) {
            this._rotation = t,
            this._matrixDirty = !0,
            this.dirtyBound()
        },
        getRotation: function() {
            return this._rotation
        },
        setScale: function(t) {
            this.setScaleFromvec3(a.fromValues(t, t, t))
        },
        setScaleFromvec3: function(t) {
            this._scale = t,
            this._matrixDirty = !0,
            this.dirtyBound()
        },
        getScale: function() {
            return this._scale
        },
        setMinimumScale: function(t) {
            this._minimumScale = t
        },
        getMinimumScale: function() {
            return this._minimumScale
        },
        setMaximumScale: function(t) {
            this._maximumScale = t
        },
        getMaximumScale: function() {
            return this._maximumScale
        },
        setAutoScaleToScreen: function(t) {
            this._autoScaleToScreen = t,
            this._matrixDirty = !0
        },
        getAutoScaleToScreen: function() {
            return this._autoScaleToScreen
        },
        setAutoRotateToScreen: function(t) {
            this._autoRotateToScreen = t
        },
        getAutoRotateToScreen: function() {
            return this._autoRotateToScreen
        },
        setAutoScaleTransitionWidthRatio: function(t) {
            this._autoScaleTransitionWidthRatio = t
        },
        getAutoScaleTransitionWidthRatio: function() {
            return this._autoScaleTransitionWidthRatio
        },
        computeLocalToWorldMatrix: function(t) {
            this._matrixDirty && this.computeMatrix(),
            this.referenceFrame === c.RELATIVE_RF ? u.mul(t, t, this._matrix) : u.copy(t, this._matrix)
        },
        computeMatrix: function() {
            var t = a.create()
              , e = u.create();
            return function() {
                this._matrixDirty && (u.fromQuat(this._matrix, this._rotation),
                u.fromTranslation(e, this._position),
                u.mul(this._matrix, e, this._matrix),
                u.scale(this._matrix, this._matrix, this._scale),
                u.translate(this._matrix, this._matrix, a.neg(t, this._pivotPoint)),
                this._matrixDirty = !1)
            }
        }(),
        computeWorldToLocalMatrix: function() {
            var t = a.create()
              , e = o.create()
              , i = a.create()
              , n = u.create();
            return function(r) {
                return (0 !== this.scale[0] || 0 !== this.scale[1] || 0 !== this.scale[2]) && (i[0] = 1 / this._scale[0],
                i[1] = 1 / this._scale[1],
                i[2] = 1 / this._scale[2],
                this.referenceFrame === c.RELATIVE_RF ? (u.fromTranslation(n, a.neg(t, this._position)),
                u.mul(r, n, r),
                o.zeroRotation(this._rotation) || (u.fromQuat(n, o.invert(e, this._rotation)),
                u.mul(r, n, r)),
                u.fromScaling(n, i),
                u.mul(r, n, r),
                u.fromTranslation(n, this._pivotPoint),
                u.mul(r, n, r)) : (u.fromQuat(this._matrix, o.invert(e, this._rotation)),
                u.translate(r, r, a.neg(t, this._position)),
                u.fromScaling(n, i),
                u.mul(r, n, r),
                u.fromTranslation(n, this._pivotPoint),
                u.mul(r, n, r)),
                !0)
            }
        }(),
        computeBound: function() {
            var t = u.create();
            return function(e) {
                return this._autoScaleToScreen && this._firstTimeToInitEyePoint ? e : (h.prototype.computeBound.call(this, e),
                e.valid() ? (u.identity(t),
                this.computeLocalToWorldMatrix(t),
                e.transformMat4(e, t),
                e) : e)
            }
        }(),
        accept: function() {
            return function(t) {
                if (t.getVisitorType() === l.CULL_VISITOR) {
                    var e = t.getViewport().width()
                      , i = t.getViewport().height()
                      , n = t.getCurrentProjectionMatrix()
                      , r = t.getCurrentModelViewMatrix()
                      , c = this._position
                      , d = this._firstTimeToInitEyePoint;
                    if (this._firstTimeToInitEyePoint || (e !== this._previousWidth || i !== this._previousHeight ? d = !0 : u.exactEquals(n, this._previousProjection) && u.exactEquals(r, this._previousModelView) ? a.exactEquals(c, this._previousPosition) || (d = !0) : d = !0),
                    this._firstTimeToInitEyePoint = !1,
                    d) {
                        if (this._autoScaleToScreen) {
                            var p = t.getViewport()
                              , f = this.computePixelSizeVector(p, n, r)
                              , g = s.fromValues(this._position[0], this._position[1], this._position[2], 1)
                              , m = s.dot(g, f);
                            m = .48 / m;
                            var v = 1 / m;
                            if (this._autoScaleTransitionWidthRatio > 0) {
                                var _, b, x;
                                if (this._minimumScale > 0) {
                                    var A = this._minimumScale
                                      , y = this._maximumScale < Number.MAX_VALUE ? this._minimumScale + (this._maximumScale - this._minimumScale) * this._autoScaleTransitionWidthRatio : this._minimumScale * (1 + this._autoScaleTransitionWidthRatio);
                                    _ = 1 / (4 * (y - A)),
                                    b = 1 - 2 * _ * y,
                                    x = A + b * b / (4 * _);
                                    var S = -b / (2 * _);
                                    v < S ? v = this._minimumScale : v < y && (v = x + b * v + _ * (v * v))
                                }
                                if (this._maximumScale < Number.MAX_VALUE) {
                                    var C = this._maximumScale
                                      , M = this._minimumScale > 0 ? this._maximumScale + (this._minimumScale - this._maximumScale) * this._autoScaleTransitionWidthRatio : this._maximumScale * (1 - this._autoScaleTransitionWidthRatio);
                                    _ = 1 / (4 * (M - C)),
                                    b = 1 - 2 * _ * M,
                                    x = C + b * b / (4 * _);
                                    var w = -b / (2 * _);
                                    v > w ? v = this._maximumScale : v > M && (v = x + b * v + _ * (v * v))
                                }
                            }
                            this.setScale(v)
                        }
                        if (this._autoRotateToScreen) {
                            var T = o.create();
                            u.getRotation(T, r),
                            this.setRotation(o.invert(T, T))
                        }
                        this._previousWidth = e,
                        this._previousHeight = i,
                        a.copy(this._previousPosition, c),
                        u.copy(this._previousProjection, n),
                        u.copy(this._previousModelView, r)
                    }
                }
                h.prototype.accept.call(this, t)
            }
        }(),
        computePixelSizeVector: function() {
            var t = a.create()
              , e = a.create();
            return function(i, n, r) {
                var o = n[0] * i.width() * .5
                  , u = n[8] * i.width() * .5 + n[11] * i.width() * .5;
                a.set(t, r[0] * o + r[2] * u, r[4] * o + r[6] * u, r[8] * o + r[10] * u);
                var l = n[5] * i.height() * .5
                  , c = n[9] * i.height() * .5 + n[11] * i.height() * .5;
                a.set(e, r[1] * l + r[2] * c, r[5] * l + r[6] * c, r[9] * l + r[10] * c);
                var h = n[11]
                  , d = n[15]
                  , p = s.fromValues(r[2] * h, r[6] * h, r[10] * h, r[14] * h + r[15] * d)
                  , f = .7071067811 / Math.sqrt(a.sqrLen(t) + a.sqrLen(e));
                return s.scale(p, p, f),
                p
            }
        }()
    }), "osg", "AutoTransform"),
    n.setTypeID(d),
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(1204)
      , r = i(1205)
      , a = i(1206)
      , s = i(1207);
    window.Object.keys(r);
    var o = {};
    o.init = function() {
        var t = i(1205);
        n.memoryPools.stateGraph = new n.OsgObjectMemoryPool(t).grow(50)
    }
    ,
    o.isArray = function(t) {
        return s.log("isArray is deprecated, use instead Array.isArray"),
        Array.isArray(t)
    }
    ,
    o.extend = function() {
        var t, e, i, n, r = window.Object.prototype.toString, a = window.Object.prototype.hasOwnProperty, s = function(t) {
            return "[object Function]" === r.call(t)
        }, u = o.isArray, l = function(t) {
            if (!t || "[object Object]" !== r.call(t) || t.nodeType || t.setInterval)
                return !1;
            if (t.constructor && !a.call(t, "constructor") && !a.call(t.constructor.prototype, "isPrototypeOf"))
                return !1;
            var e;
            for (e in t)
                ;
            return void 0 === e || a.call(t, e)
        }, c = arguments[0] || {}, h = 1, d = arguments.length, p = !1;
        for ("boolean" == typeof c && (p = c,
        c = arguments[1] || {},
        h = 2),
        "object" == typeof c || s(c) || (c = {}),
        d === h && (c = this,
        --h); h < d; h++)
            if (null !== (t = arguments[h]))
                for (e in t)
                    if (i = c[e],
                    n = t[e],
                    c !== n)
                        if (p && n && (l(n) || u(n))) {
                            var f = i && (l(i) || u(i)) ? i : u(n) ? [] : {};
                            c[e] = o.extend(p, f, n)
                        } else
                            void 0 !== n && (c[e] = n);
        return c
    }
    ,
    o.objectInherit = function(t) {
        function e() {}
        e.prototype = t;
        for (var i = new e, n = 1; n < arguments.length; n++)
            o.objectMix(i, arguments[n], !1);
        return i
    }
    ,
    o.objectInehrit = function() {
        console.warn("please use objectInherit instead of objectInehrit")
    }
    ,
    o.objectMix = function(t, e, i) {
        for (var n in e)
            i && t[n] || (t[n] = e[n]);
        return t
    }
    ,
    o.objectType = {},
    o.objectType.type = 0,
    o.objectType.generate = function(t) {
        var e = o.objectType.type;
        return o.objectType[e] = t,
        o.objectType[t] = e,
        o.objectType.type += 1,
        e
    }
    ,
    o.objectLibraryClass = function(t, e, i) {
        t.className = function() {
            return i
        }
        ,
        t.libraryName = function() {
            return e
        }
        ;
        var n = e + "::" + i;
        return t.libraryClassName = function() {
            return n
        }
        ,
        t
    }
    ,
    o.setTypeID = function(t) {
        var e = t.prototype.libraryClassName()
          , i = o.objectType.generate(e)
          , n = function() {
            return i
        };
        t.typeID = t.prototype.typeID = i,
        t.getTypeID = t.prototype.getTypeID = n
    }
    ,
    o.createPrototypeClass = function(t, e, i, n) {
        t.prototype = e,
        e.constructor = t,
        o.objectLibraryClass(e, i, n),
        o.setTypeID(t)
    }
    ,
    o.Float32Array = "undefined" != typeof Float32Array ? Float32Array : null,
    o.Int32Array = "undefined" != typeof Int32Array ? Int32Array : null,
    o.Uint8Array = "undefined" != typeof Uint8Array ? Uint8Array : null,
    o.Uint16Array = "undefined" != typeof Uint16Array ? Uint16Array : null,
    o.Uint32Array = "undefined" != typeof Uint32Array ? Uint32Array : null;
    var u = {};
    o.time = (s.console.time || function(t) {
        u[t] = a.instance().tick()
    }
    ).bind(s.console),
    o.timeEnd = (s.console.timeEnd || function(t) {
        if (void 0 !== u[t]) {
            var e = a.instance().deltaM(u[t], a.instance().tick());
            s.debug(t + ": " + e + "ms"),
            u[t] = void 0
        }
    }
    ).bind(s.console),
    o.timeStamp = (s.console.timeStamp || s.console.markTimeline || function() {}
    ).bind(s.console),
    o.profile = (s.console.profile || function() {}
    ).bind(s.console),
    o.profileEnd = (s.console.profileEnd || function() {}
    ).bind(s.console),
    t.exports = o
}
, function(t, e) {
    "use strict";
    var i = {};
    i.memoryPools = {},
    i.OsgObjectMemoryPool = function(t) {
        return {
            _memPool: [],
            reset: function() {
                return this._memPool = [],
                this
            },
            put: function(t) {
                this._memPool.push(t)
            },
            get: function() {
                return this._memPool.length > 0 ? this._memPool.pop() : (this.grow(),
                this.get())
            },
            grow: function(e) {
                var i;
                i = void 0 === e ? this._memPool.length > 0 ? 2 * this._memPool.length : 20 : e;
                for (var n = this._memPool.length; n++ < i; )
                    this._memPool.push(new t);
                return this
            }
        }
    }
    ,
    i.OsgArrayMemoryPool = function() {
        return {
            _mempoolofPools: [],
            reset: function() {
                return this._memPoolofPools = {},
                this
            },
            put: function(t) {
                this._memPoolofPools[t.length] || (this._memPoolofPools[t.length] = []),
                this._memPoolofPools[t.length].push(t)
            },
            get: function(t) {
                if (this._memPoolofPools[t]) {
                    if (this._memPoolofPools.length > 0)
                        return this._memPool.pop()
                } else
                    this._memPoolofPools[t] = [];
                return this.grow(t),
                this.get()
            },
            grow: function(t, e) {
                void 0 === e && (e = this._memPool.length > 0 ? 2 * this._memPool.length : 5);
                for (var i = this._memPool.length; i++ < e; )
                    this._memPool.push(new Array(t));
                return this
            }
        }
    }
    ,
    i.OsgObjectMemoryStack = function(t) {
        return {
            _current: 0,
            _memPool: [new t],
            reset: function() {
                return this._current = 0,
                this
            },
            get: function() {
                var e = this._memPool[this._current++];
                return this._current >= this._memPool.length && this._memPool.push(new t),
                e
            }
        }
    }
    ,
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1204)
      , r = function() {
        this.depth = 0,
        this.children = {},
        this.children.keys = [],
        this.leafs = [],
        this.stateset = void 0,
        this.parent = void 0
    };
    r.prototype = {
        clean: function() {
            this.leafs.length = 0,
            this.stateset = void 0,
            this.parent = void 0,
            this.depth = 0;
            for (var t, e, i = this.children, r = i.keys, a = 0, s = r.length; a < s; a++)
                e = r[a],
                t = i[e],
                t.clean(),
                n.memoryPools.stateGraph.put(t);
            this.children = {},
            r.length = 0,
            this.children.keys = r
        },
        getStateSet: function() {
            return this.stateset
        },
        findOrInsert: function(t) {
            var e, i = t.getInstanceID(), r = this.children;
            return r[i] ? e = r[i] : (e = n.memoryPools.stateGraph.get(),
            e.parent = this,
            e.depth = this.depth + 1,
            e.stateset = t,
            r[i] = e,
            r.keys.push(i)),
            e
        }
    },
    r.moveStateGraph = function(t, e, i) {
        var n, r, a = [], s = i, o = e;
        if (s !== o && void 0 !== s)
            if (void 0 !== o) {
                if (o.parent === s.parent)
                    return void 0 !== o.stateset && t.popStateSet(),
                    void (void 0 !== s.stateset && t.pushStateSet(s.stateset));
                for (; o.depth > s.depth; )
                    void 0 !== o.stateset && t.popStateSet(),
                    o = o.parent;
                for (a = []; s.depth > o.depth; )
                    void 0 !== s.stateset && a.push(s.stateset),
                    s = s.parent;
                for (; o !== s; )
                    void 0 !== o.stateset && t.popStateSet(),
                    o = o.parent,
                    void 0 !== s.stateset && a.push(s.stateset),
                    s = s.parent;
                for (n = a.length - 1,
                r = 0; n >= r; --n)
                    t.pushStateSet(a[n])
            } else {
                do
                    void 0 !== s.stateset && a.push(s.stateset),
                    s = s.parent;
                while (s);for (n = a.length - 1,
                r = 0; n >= r; --n)
                    t.pushStateSet(a[n])
            }
    }
    ,
    t.exports = r
}
, function(t, e) {
    "use strict";
    var i = function() {
        var t = window || global;
        if (void 0 === t.performance)
            return function() {
                return Date.now()
            }
            ;
        var e = t.performance.now || t.performance.mozNow || t.performance.msNow || t.performance.oNow || t.performance.webkitNow || function() {
            return Date.now()
        }
        ;
        return function() {
            return e.apply(t.performance, arguments)
        }
    }()
      , n = function() {};
    n.instance = function() {
        return n._instance || (n._instance = new n),
        n._instance
    }
    ,
    n.prototype = {
        deltaS: function(t, e) {
            return (e - t) / 1e3
        },
        deltaM: function(t, e) {
            return e - t
        },
        tick: function() {
            return i()
        }
    },
    t.exports = n
}
, function(t, e) {
    "use strict";
    function i(t, e) {
        o.console && (o.console[t](e),
        o.traceLogCall && "error" !== t && console.trace())
    }
    function n(t, e, i) {
        o.console && (o.console.groupCollapsed && o.console.groupCollapsed(e),
        o.console[t](i),
        o.traceLogCall && "error" !== t && console.trace(),
        o.console.groupEnd && o.console.groupEnd())
    }
    function r(t, e) {
        return e ? [t.slice(0, 4), t.slice(4, 8), t.slice(8, 12), t.slice(12, 16)] : [[t[0], t[4], t[8], t[12]], [t[1], t[5], t[9], t[13]], [t[2], t[6], t[10], t[14]], [t[3], t[7], t[11], t[15]]]
    }
    function a(t, e) {
        o.console.table && i("table", r(t, e))
    }
    function s(t, e, i) {
        o.console.table && n("table", t, r(e, i))
    }
    var o = {};
    o.DEBUG = 0,
    o.INFO = 1,
    o.NOTICE = o.LOG = 2,
    o.WARN = 3,
    o.ERROR = 4,
    o.console = window.console;
    for (var u = ["log", "info", "warn", "error", "debug"], l = {}, c = 0; c < u.length; ++c) {
        var h = u[c];
        l[h] = i.bind(o, h),
        l[h + "Fold"] = n.bind(o, h),
        l[h + "Matrix"] = a.bind(o),
        l[h + "MatrixFold"] = s.bind(o)
    }
    var d = function(t, e) {
        void 0 === this.console || t || this.console.assert(t, e)
    };
    o.assert = d,
    o.setNotifyLevel = function(t) {
        for (var e = function() {}, i = 0; i < u.length; ++i) {
            var n = u[i]
              , r = t > o[n.toUpperCase()];
            o[n] = r ? e : l[n],
            o[n + "Fold"] = r ? e : l[n + "Fold"],
            o[n + "Matrix"] = r ? e : l[n + "Matrix"],
            o[n + "MatrixFold"] = r ? e : l[n + "MatrixFold"]
        }
        o.notice = o.log,
        o.noticeFold = o.logFold,
        o.noticeMatrix = o.logMatrix,
        o.noticeMatrixFold = o.logMatrixFold
    }
    ,
    o.setNotifyLevel(o.NOTICE),
    o.reportWebGLError = !1,
    o.setConsole = function(t) {
        o.console = t
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1209)
      , a = i(1212).mat4
      , s = i(1232)
      , o = function() {
        r.call(this),
        this.referenceFrame = s.RELATIVE_RF
    };
    o.prototype = n.objectInherit(r.prototype, {
        setReferenceFrame: function(t) {
            this.referenceFrame = t
        },
        getReferenceFrame: function() {
            return this.referenceFrame
        },
        computeBoundingSphere: function() {
            var t = a.create();
            return function(e) {
                return r.prototype.computeBoundingSphere.call(this, e),
                e.valid() ? (a.identity(t),
                this.computeLocalToWorldMatrix(t),
                e.transformMat4(e, t),
                e) : e
            }
        }()
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1210)
      , a = i(1211)
      , s = i(1225)
      , o = i(1226)
      , u = i(1229)
      , l = i(1207)
      , c = i(1212).mat4
      , h = i(1230)
      , d = i(1231)
      , p = i(1232)
      , f = function() {
        r.call(this),
        this.children = [],
        this._parents = [],
        this.nodeMask = -1,
        this._boundingSphere = new s,
        this._boundingSphereComputed = !1,
        this._boundingBox = new a,
        this._boundingBoxComputed = !1,
        this._updateCallbacks = [],
        this._cullCallback = void 0,
        this._cullingActive = !0,
        this._numChildrenWithCullingDisabled = 0,
        this._numChildrenRequiringUpdateTraversal = 0,
        this._tmpBox = new a
    };
    f._reservedMatrixStack = new h;
    var g = function() {
        var t = f._reservedMatrixStack.get.bind(f._reservedMatrixStack);
        return c.identity(t)
    };
    f.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getOrCreateStateSet: function() {
            return this.stateset || this.setStateSet(new o),
            this.stateset
        },
        getStateSet: function() {
            return this.stateset
        },
        accept: function(t) {
            t.validNodeMask(this) && (t.pushOntoNodePath(this),
            t.apply(this),
            t.popFromNodePath())
        },
        dirtyBound: function() {
            if (this._boundingSphereComputed === !0 || this._boundingBoxComputed === !0) {
                this._boundingSphereComputed = !1,
                this._boundingBoxComputed = !1;
                for (var t = this._parents, e = 0, i = t.length; e < i; e++)
                    t[e].dirtyBound()
            }
        },
        setNodeMask: function(t) {
            this.nodeMask = t
        },
        getNodeMask: function() {
            return this.nodeMask
        },
        setStateSet: function(t) {
            if (this.stateset !== t) {
                var e = 0;
                this.stateset && (this.stateset.requiresUpdateTraversal() && e--,
                this.stateset.removeParent(this)),
                t && (t.addParent(this),
                t.requiresUpdateTraversal() && ++e),
                0 !== e && this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal() + e),
                this.stateset = t
            }
        },
        _updateNumChildrenRequeringUpdateTraversal: function(t) {
            if (0 === this._numChildrenRequiringUpdateTraversal && this._parents.length)
                for (var e = 0, i = this._parents.length; e < i; e++) {
                    var n = this._parents[e]
                      , r = n.getNumChildrenRequiringUpdateTraversal();
                    n.setNumChildrenRequiringUpdateTraversal(r + t)
                }
        },
        setNumChildrenRequiringUpdateTraversal: function(t) {
            if (this._numChildrenRequiringUpdateTraversal !== t) {
                if (!this._updateCallbacks.length && this._parents.length) {
                    var e = 0;
                    if (this._numChildrenRequiringUpdateTraversal > 0 && --e,
                    t > 0 && ++e,
                    0 !== e)
                        for (var i = this._parents, n = 0, r = i.length; n < r; n++) {
                            var a = i[n]
                              , s = a.getNumChildrenRequiringUpdateTraversal();
                            a.setNumChildrenRequiringUpdateTraversal(s + e)
                        }
                }
                this._numChildrenRequiringUpdateTraversal = t
            }
        },
        getNumChildrenRequiringUpdateTraversal: function() {
            return this._numChildrenRequiringUpdateTraversal
        },
        setUpdateCallback: function(t) {
            if (l.warn("deprecated use instead addUpdateCallback/removeUpdateCallback"),
            t !== this._updateCallbacks[0] && t) {
                var e = Boolean(this._updateCallbacks.length);
                this._updateCallbacks.length ? this._updateCallbacks[0] = t : this.addUpdateCallback(t),
                e || this._updateNumChildrenRequeringUpdateTraversal(1)
            }
        },
        getUpdateCallback: function() {
            return this._updateCallbacks[0]
        },
        addUpdateCallback: function(t) {
            var e = Boolean(this._updateCallbacks.length);
            this._updateCallbacks.push(t),
            e || this._updateNumChildrenRequeringUpdateTraversal(1)
        },
        removeUpdateCallback: function(t) {
            var e = this._updateCallbacks.indexOf(t);
            e !== -1 && (this._updateCallbacks.splice(e, 1),
            this._updateCallbacks.length || this._updateNumChildrenRequeringUpdateTraversal(-1))
        },
        getUpdateCallbackList: function() {
            return this._updateCallbacks
        },
        setCullCallback: function(t) {
            this._cullCallback = t
        },
        getCullCallback: function() {
            return this._cullCallback
        },
        hasChild: function(t) {
            for (var e = 0, i = this.children.length; e < i; e++)
                if (this.children[e] === t)
                    return !0;
            return !1
        },
        addChild: function(t) {
            if (this.children.indexOf(t) === -1)
                return this.children.push(t),
                t.addParent(this),
                this.dirtyBound(),
                (t.getNumChildrenRequiringUpdateTraversal() > 0 || t.getUpdateCallbackList().length) && this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal() + 1),
                t
        },
        getChildren: function() {
            return this.children
        },
        getNumChildren: function() {
            return this.children.length
        },
        getChild: function(t) {
            return this.children[t]
        },
        getParents: function() {
            return this._parents
        },
        addParent: function(t) {
            this._parents.push(t)
        },
        removeParent: function(t) {
            var e = this._parents.indexOf(t);
            e !== -1 && this._parents.splice(e, 1)
        },
        removeChildren: function() {
            var t = this.children
              , e = t.length;
            if (e) {
                for (var i = 0, n = 0; n < e; n++) {
                    var r = t[n];
                    r.removeParent(this),
                    (r.getNumChildrenRequiringUpdateTraversal() > 0 || r.getUpdateCallbackList().length) && ++i
                }
                t.length = 0,
                i && this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal() - i),
                this.dirtyBound()
            }
        },
        removeChild: function(t) {
            var e = this.children
              , i = e.indexOf(t);
            i !== -1 && (t.removeParent(this),
            e.splice(i, 1),
            (t.getNumChildrenRequiringUpdateTraversal() > 0 || t.getUpdateCallbackList().length) && this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal() - 1))
        },
        traverse: function(t) {
            for (var e = this.children, i = 0, n = e.length; i < n; i++) {
                var r = e[i];
                r.accept(t)
            }
        },
        ascend: function(t) {
            for (var e = this._parents, i = 0, n = e.length; i < n; i++) {
                var r = e[i];
                r.accept(t)
            }
        },
        getBoundingBox: function() {
            return this._boundingBoxComputed || (this.computeBoundingBox(this._boundingBox),
            this._boundingBoxComputed = !0),
            this._boundingBox
        },
        computeBoundingBox: function(t) {
            var e = i(1233)
              , n = e.instance = e.instance || new e;
            return n.setNodeMaskOverride(-1),
            n.reset(),
            n.apply(this),
            t.copy(n.getBoundingBox()),
            t
        },
        getBoundingSphere: function() {
            return this.getBound()
        },
        getBound: function() {
            return this._boundingSphereComputed || (this.computeBoundingSphere(this._boundingSphere),
            this._boundingSphereComputed = !0),
            this._boundingSphere
        },
        computeBoundingSphere: function(t) {
            var e = this.children
              , i = e.length;
            if (t.init(),
            0 === i)
                return t;
            var n, r, a = this._tmpBox;
            for (a.init(),
            r = 0; r < i; r++)
                n = e[r],
                n.referenceFrame !== p.ABSOLUTE_RF && a.expandByBoundingSphere(n.getBound());
            if (!a.valid())
                return t;
            for (t.set(a.center(t.center()), 0),
            r = 0; r < i; r++)
                n = e[r],
                n.referenceFrame !== p.ABSOLUTE_RF && t.expandRadiusBySphere(n.getBound());
            return t
        },
        getWorldMatrices: function() {
            var t = function() {
                this.nodePaths = [],
                this.halt = void 0,
                u.call(this, u.TRAVERSE_PARENTS)
            };
            t.prototype = n.objectInherit(u.prototype, {
                reset: function() {
                    this.nodePath.length = 0,
                    this.nodePaths.length = 0
                },
                apply: function(t) {
                    0 === t._parents.length || t === this.halt || t.referenceFrame === p.ABSOLUTE_RF ? this.nodePaths.push(this.nodePath.slice(0)) : this.traverse(t)
                }
            });
            var e = new t;
            return e.setNodeMaskOverride(-1),
            function(t, i) {
                e.reset(),
                e.halt = t,
                this.accept(e);
                for (var n = [], r = i || c.create, a = 0, s = e.nodePaths.length; a < s; a++) {
                    var o = e.nodePaths[a]
                      , u = r();
                    0 !== o.length && d.computeLocalToWorld(o, !0, u),
                    n.push(u)
                }
                return n
            }
        }(),
        getWorldMatrix: function(t, e) {
            var i = this.getWorldMatrices(t, g);
            return 0 === i.length ? c.identity(e) : c.copy(e, i[0]),
            f._reservedMatrixStack.reset(),
            e
        },
        setCullingActive: function(t) {
            if (this._cullingActive !== t) {
                if (0 === this._numChildrenWithCullingDisabled && this._parents.length > 0) {
                    var e = 0;
                    if (this._cullingActive || --e,
                    t || ++e,
                    0 !== e)
                        for (var i = 0, n = this._parents.length; i < n; i++)
                            this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled() + e)
                }
                this._cullingActive = t
            }
        },
        getCullingActive: function() {
            return this._cullingActive
        },
        isCullingActive: function() {
            return 0 === this._numChildrenWithCullingDisabled && this._cullingActive && this.getBound().valid()
        },
        setNumChildrenWithCullingDisabled: function(t) {
            if (this._numChildrenWithCullingDisabled !== t) {
                if (this._cullingActive && this._parents.length > 0) {
                    var e = 0;
                    if (this._numChildrenWithCullingDisabled > 0 && --e,
                    t > 0 && ++e,
                    0 !== e)
                        for (var i = 0, n = this._parents.length; i < n; i++)
                            this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled() + e)
                }
                this._numChildrenWithCullingDisabled = t
            }
        },
        getNumChildrenWithCullingDisabled: function() {
            return this._numChildrenWithCullingDisabled
        },
        releaseGLObjects: function() {
            void 0 !== this.stateset && this.stateset.releaseGLObjects()
        }
    }), "osg", "Node"),
    n.setTypeID(f),
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = function() {
        this._name = void 0,
        this._userdata = void 0,
        this._instanceID = r.getInstanceID()
    };
    r.prototype = n.objectLibraryClass({
        cloneType: function() {
            var t = this.constructor;
            return new t
        },
        getInstanceID: function() {
            return this._instanceID
        },
        setName: function(t) {
            this._name = t
        },
        getName: function() {
            return this._name
        },
        setUserData: function(t) {
            this._userdata = t
        },
        getUserData: function() {
            return this._userdata
        }
    }, "osg", "Object");
    var a = 0;
    r.getInstanceID = function() {
        return a += 1
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1203)
      , a = i(1212).vec3
      , s = i(1212).mat4
      , o = function() {
        this._min = a.create(),
        this._max = a.create(),
        this.init()
    };
    o.prototype = r.objectLibraryClass({
        init: function() {
            a.copy(this._min, a.INFINITY),
            a.copy(this._max, a.NEGATIVE_INFINITY)
        },
        copy: function(t) {
            var e = this._min
              , i = t._min;
            e[0] = i[0],
            e[1] = i[1],
            e[2] = i[2];
            var n = this._max
              , r = t._max;
            n[0] = r[0],
            n[1] = r[1],
            n[2] = r[2]
        },
        valid: function() {
            return this._max[0] >= this._min[0] && this._max[1] >= this._min[1] && this._max[2] >= this._min[2]
        },
        expandByBoundingSphere: function(t) {
            if (t.valid()) {
                var e = this._max
                  , i = this._min
                  , n = t._radius
                  , r = t._center[0]
                  , a = t._center[1]
                  , s = t._center[2];
                i[0] = Math.min(i[0], r - n),
                i[1] = Math.min(i[1], a - n),
                i[2] = Math.min(i[2], s - n),
                e[0] = Math.max(e[0], r + n),
                e[1] = Math.max(e[1], a + n),
                e[2] = Math.max(e[2], s + n)
            }
        },
        expandBySphere: function(t) {
            return n.log("BoundingBox.expandBySphere is deprecated, use instead BoundBox.expandByBoundingSphere"),
            this.expandByBoundingSphere(t)
        },
        expandByvec3: function(t) {
            var e = this._min
              , i = this._max;
            e[0] = Math.min(e[0], t[0]),
            e[1] = Math.min(e[1], t[1]),
            e[2] = Math.min(e[2], t[2]),
            i[0] = Math.max(i[0], t[0]),
            i[1] = Math.max(i[1], t[1]),
            i[2] = Math.max(i[2], t[2])
        },
        expandByBoundingBox: function(t) {
            if (t.valid()) {
                var e = this._min
                  , i = this._max
                  , n = t._min
                  , r = t._max;
                n[0] < e[0] && (e[0] = n[0]),
                r[0] > i[0] && (i[0] = r[0]),
                n[1] < e[1] && (e[1] = n[1]),
                r[1] > i[1] && (i[1] = r[1]),
                n[2] < e[2] && (e[2] = n[2]),
                r[2] > i[2] && (i[2] = r[2])
            }
        },
        center: function(t) {
            var e = this._min
              , i = this._max;
            return t[0] = .5 * (e[0] + i[0]),
            t[1] = .5 * (e[1] + i[1]),
            t[2] = .5 * (e[2] + i[2]),
            t
        },
        radius: function() {
            return Math.sqrt(this.radius2())
        },
        radius2: function() {
            var t = this._min
              , e = this._max
              , i = e[0] - t[0]
              , n = e[1] - t[1]
              , r = e[2] - t[2];
            return .25 * (i * i + n * n + r * r)
        },
        getMin: function() {
            return this._min
        },
        getMax: function() {
            return this._max
        },
        setMin: function(t) {
            return a.copy(this._min, t),
            this
        },
        setMax: function(t) {
            return a.copy(this._max, t),
            this
        },
        xMax: function() {
            return this._max[0]
        },
        yMax: function() {
            return this._max[1]
        },
        zMax: function() {
            return this._max[2]
        },
        xMin: function() {
            return this._min[0]
        },
        yMin: function() {
            return this._min[1]
        },
        zMin: function() {
            return this._min[2]
        },
        corner: function(t, e) {
            return 1 & t ? e[0] = this._max[0] : e[0] = this._min[0],
            2 & t ? e[1] = this._max[1] : e[1] = this._min[1],
            4 & t ? e[2] = this._max[2] : e[2] = this._min[2],
            e
        },
        transformMat4: function() {
            var t = a.create()
              , e = a.create();
            return function(i, n) {
                var r = this.getMin()
                  , o = this.getMax();
                s.getTranslation(t, n),
                a.copy(e, t);
                for (var u = 0; u < 3; ++u)
                    for (var l = 4 * u, c = r[u], h = o[u], d = 0; d < 3; ++d) {
                        var p = n[l + d]
                          , f = p * h
                          , g = p * c;
                        f < g ? (t[d] += f,
                        e[d] += g) : (t[d] += g,
                        e[d] += f)
                    }
                var m = i.getMax()
                  , v = i.getMin();
                return m[0] = e[0],
                m[1] = e[1],
                m[2] = e[2],
                v[0] = t[0],
                v[1] = t[1],
                v[2] = t[2],
                i
            }
        }()
    }, "osg", "BoundingBox"),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1213)
      , r = i(1214)
      , a = i(1224);
    r.glMatrix.setMatrixArrayType(a.ArrayType),
    r.glMatrix.EPSILON = 1e-9;
    var s = r.vec2
      , o = r.vec3
      , u = r.vec4
      , l = r.mat4
      , c = r.quat;
    o.create32 = function() {
        return new Float32Array(3)
    }
    ,
    o.create64 = function() {
        return new Float64Array(3)
    }
    ,
    o.fromValues32 = function(t, e, i) {
        var n = new Float32Array(3);
        return n[0] = t,
        n[1] = e,
        n[2] = i,
        n
    }
    ,
    o.fromValues64 = function(t, e, i) {
        var n = new Float64Array(3);
        return n[0] = t,
        n[1] = e,
        n[2] = i,
        n
    }
    ,
    o.init = function(t) {
        return o.set(t, 0, 0, 0)
    }
    ,
    o.transformMat4R = function(t, e, i) {
        t[0] = i[0] * e[0] + i[1] * e[1] + i[2] * e[2],
        t[1] = i[4] * e[0] + i[5] * e[1] + i[6] * e[2],
        t[2] = i[8] * e[0] + i[9] * e[1] + i[10] * e[2]
    }
    ,
    o.valid = function(t) {
        return !n.isNaN(t[0]) && (!n.isNaN(t[1]) && !n.isNaN(t[2]))
    }
    ,
    o.neg = o.negate,
    o.ZERO = o.create(),
    o.ONE = o.fromValues(1, 1, 1),
    o.INFINITY = o.fromValues(1 / 0, 1 / 0, 1 / 0),
    o.NEGATIVE_INFINITY = o.fromValues(-(1 / 0), -(1 / 0), -(1 / 0)),
    s.create32 = function() {
        return new Float32Array(2)
    }
    ,
    s.create64 = function() {
        return new Float64Array(2)
    }
    ,
    s.fromValues32 = function(t, e) {
        var i = new Float32Array(2);
        return i[0] = t,
        i[1] = e,
        i
    }
    ,
    s.fromValues64 = function(t, e) {
        var i = new Float64Array(2);
        return i[0] = t,
        i[1] = e,
        i
    }
    ,
    s.init = function(t) {
        return s.set(t, 0, 0)
    }
    ,
    s.valid = function(t) {
        return !n.isNaN(t[0]) && !n.isNaN(t[1])
    }
    ,
    s.ZERO = s.create(),
    s.ONE = s.fromValues(1, 1),
    s.INFINITY = s.fromValues(1 / 0, 1 / 0),
    s.NEGATIVE_INFINITY = s.fromValues(-(1 / 0), -(1 / 0)),
    u.create32 = function() {
        return new Float32Array(4)
    }
    ,
    u.create64 = function() {
        return new Float64Array(4)
    }
    ,
    u.fromValues32 = function(t, e, i, n) {
        var r = new Float32Array(4);
        return r[0] = t,
        r[1] = e,
        r[2] = i,
        r[3] = n,
        r
    }
    ,
    u.fromValues64 = function(t, e, i, n) {
        var r = new Float64Array(4);
        return r[0] = t,
        r[1] = e,
        r[2] = i,
        r[3] = n,
        r
    }
    ,
    u.init = function(t) {
        return u.set(t, 0, 0, 0, 0)
    }
    ,
    u.valid = function(t) {
        return !n.isNaN(t[0]) && (!n.isNaN(t[1]) && (!n.isNaN(t[2]) && !n.isNaN(t[3])))
    }
    ,
    u.neg = u.negate,
    u.ZERO = u.create(),
    u.ONE = u.fromValues(1, 1, 1, 1),
    u.INFINITY = u.fromValues(1 / 0, 1 / 0, 1 / 0, 1 / 0),
    u.NEGATIVE_INFINITY = u.fromValues(-(1 / 0), -(1 / 0), -(1 / 0), -(1 / 0)),
    c.IDENTITY = c.create(),
    c.zeroRotation = function(t) {
        return 0 === t[0] && 0 === t[1] && 0 === t[2] && 1 === t[3]
    }
    ,
    c.create32 = function() {
        var t = new Float32Array(4);
        return t[3] = 1,
        t
    }
    ,
    c.create64 = function() {
        var t = new Float64Array(4);
        return t[3] = 1,
        t
    }
    ,
    c.fromValues32 = u.fromValues32,
    c.fromValues64 = u.fromValues64,
    c.init = c.identity,
    c.nlerp = function(t, e, i, n) {
        var r, a, s, o, u = e[0], l = e[1], c = e[2], h = e[3], d = i[0], p = i[1], f = i[2], g = i[3], m = u * d + l * p + c * f + h * g, v = 1 - n;
        m < 0 ? (r = u * v - d * n,
        a = l * v - p * n,
        s = c * v - f * n,
        o = h * v - g * n) : (r = u * v + d * n,
        a = l * v + p * n,
        s = c * v + f * n,
        o = h * v + g * n);
        var _ = 1 / Math.sqrt(r * r + a * a + s * s + o * o);
        return t[0] = r * _,
        t[1] = a * _,
        t[2] = s * _,
        t[3] = o * _,
        t
    }
    ,
    l.IDENTITY = l.create(),
    l.create32 = function() {
        var t = new Float32Array(16);
        return t[0] = t[5] = t[10] = t[15] = 1,
        t
    }
    ,
    l.create64 = function() {
        var t = new Float64Array(16);
        return t[0] = t[5] = t[10] = t[15] = 1,
        t
    }
    ,
    l.setTranslation = function(t, e) {
        return t[12] = e[0],
        t[13] = e[1],
        t[14] = e[2],
        t
    }
    ,
    l.getFrustum = function(t, e) {
        var i, n, r = 0, a = 0, s = 0, o = 0;
        if (0 !== e[3] || 0 !== e[7] || e[11] !== -1 || 0 !== e[15])
            return !1;
        var u = e[14] / (e[10] - 1)
          , l = e[14] / (1 + e[10]);
        return a = u * (e[8] - 1) / e[0],
        r = u * (1 + e[8]) / e[0],
        s = u * (1 + e[9]) / e[5],
        o = u * (e[9] - 1) / e[5],
        i = u,
        n = l,
        t.left = a,
        t.right = r,
        t.top = s,
        t.bottom = o,
        t.zNear = i,
        t.zFar = n,
        !0
    }
    ,
    l.getPerspective = function() {
        var t = {
            right: 0,
            left: 0,
            top: 0,
            bottom: 0,
            zNear: 0,
            zFar: 0
        };
        return function(e, i) {
            var n = l.getFrustum(t, i);
            return n && (e.fovy = 180 / Math.PI * (Math.atan(t.top / t.zNear) - Math.atan(t.bottom / t.zNear)),
            e.aspectRatio = (t.right - t.left) / (t.top - t.bottom)),
            e.zNear = t.zNear,
            e.zFar = t.zFar,
            e
        }
    }(),
    l.getLookAt = function() {
        var t = l.create()
          , e = o.create()
          , i = o.fromValues(0, 1, 0)
          , n = o.fromValues(0, 0, -1);
        return function(r, a, s, u, c) {
            var h = void 0 !== c ? c : 1;
            l.invert(t, u),
            o.transformMat4(r, e, t),
            o.transformMat4R(s, i, u),
            o.transformMat4R(a, n, u),
            o.normalize(a, a),
            o.add(a, o.scale(e, a, h), r)
        }
    }(),
    l.getFrustumPlanes = function() {
        var t = l.create();
        return function(e, i, n, r) {
            l.mul(t, i, n);
            var a = !!r
              , s = e[0];
            s[0] = t[3] - t[0],
            s[1] = t[7] - t[4],
            s[2] = t[11] - t[8],
            s[3] = t[15] - t[12];
            var o = e[1];
            o[0] = t[3] + t[0],
            o[1] = t[7] + t[4],
            o[2] = t[11] + t[8],
            o[3] = t[15] + t[12];
            var u = e[2];
            u[0] = t[3] + t[1],
            u[1] = t[7] + t[5],
            u[2] = t[11] + t[9],
            u[3] = t[15] + t[13];
            var c = e[3];
            c[0] = t[3] - t[1],
            c[1] = t[7] - t[5],
            c[2] = t[11] - t[9],
            c[3] = t[15] - t[13];
            var h = 4;
            if (a) {
                h = 6;
                var d = e[4];
                d[0] = t[3] - t[2],
                d[1] = t[7] - t[6],
                d[2] = t[11] - t[10],
                d[3] = t[15] - t[14];
                var p = e[5];
                p[0] = t[3] + t[2],
                p[1] = t[7] + t[6],
                p[2] = t[11] + t[10],
                p[3] = t[15] + t[14]
            }
            for (var f = 0; f < h; f++) {
                var g = e[f]
                  , m = 1 / Math.sqrt(g[0] * g[0] + g[1] * g[1] + g[2] * g[2]);
                g[0] *= m,
                g[1] *= m,
                g[2] *= m,
                g[3] *= m
            }
        }
    }(),
    l.infiniteFrustum = function(t, e, i, n, r, a) {
        var s = 2 * a / (i - e)
          , o = 2 * a / (r - n)
          , u = (i + e) / (i - e)
          , l = (r + n) / (r - n)
          , c = -1;
        return t[0] = s,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = o,
        t[6] = 0,
        t[7] = 0,
        t[8] = u,
        t[9] = l,
        t[10] = c,
        t[11] = -1,
        t[12] = 0,
        t[13] = 0,
        t[14] = -2 * a,
        t[15] = 0,
        t
    }
    ,
    l.lookAtDirection = function() {
        var t = o.create()
          , e = o.create()
          , i = o.create();
        return function(n, r, a, s) {
            var u = a;
            return o.cross(t, u, s),
            o.normalize(t, t),
            o.cross(e, t, u),
            o.normalize(e, e),
            n[0] = t[0],
            n[1] = e[0],
            n[2] = -u[0],
            n[3] = 0,
            n[4] = t[1],
            n[5] = e[1],
            n[6] = -u[1],
            n[7] = 0,
            n[8] = t[2],
            n[9] = e[2],
            n[10] = -u[2],
            n[11] = 0,
            n[12] = 0,
            n[13] = 0,
            n[14] = 0,
            n[15] = 1,
            l.translate(n, n, o.neg(i, r))
        }
    }(),
    l.getScale = function() {
        var t = o.create()
          , e = o.create()
          , i = o.create();
        return function(n, r) {
            return t[0] = r[0],
            t[1] = r[4],
            t[2] = r[8],
            e[0] = r[1],
            e[1] = r[5],
            e[2] = r[9],
            i[0] = r[2],
            i[1] = r[6],
            i[2] = r[10],
            n[0] = o.length(t),
            n[1] = o.length(e),
            n[2] = o.length(i),
            n
        }
    }(),
    l.getSqrScale = function() {
        var t = o.create()
          , e = o.create()
          , i = o.create();
        return function(n, r) {
            return t[0] = r[0],
            t[1] = r[4],
            t[2] = r[8],
            e[0] = r[1],
            e[1] = r[5],
            e[2] = r[9],
            i[0] = r[2],
            i[1] = r[6],
            i[2] = r[10],
            n[0] = o.sqrLen(t),
            n[1] = o.sqrLen(e),
            n[2] = o.sqrLen(i),
            n
        }
    }();
    var h = l.rotate;
    l.rotate = function(t, e, i, n) {
        return h(t, e, i, n) || l.identity(t)
    }
    ;
    var d = l.fromRotation;
    l.fromRotation = function(t, e, i) {
        return d(t, e, i) || l.identity(t)
    }
    ,
    t.exports = r
}
, function(t, e) {
    "use strict";
    var i = function(t, e, i) {
        return Math.min(i, Math.max(e, t))
    }
      , n = function(t, e, n) {
        var r = i((n - t) / (e - t), 0, 1);
        return r * r * (3 - 2 * r)
    }
      , r = function(t) {
        return t !== t
    };
    t.exports = {
        clamp: i,
        smoothStep: n,
        isNaN: r
    }
}
, function(t, e, i) {
    e.glMatrix = i(1215),
    e.mat2 = i(1216),
    e.mat2d = i(1217),
    e.mat3 = i(1218),
    e.mat4 = i(1219),
    e.quat = i(1220),
    e.vec2 = i(1223),
    e.vec3 = i(1221),
    e.vec4 = i(1222)
}
, function(t, e) {
    var i = {};
    i.EPSILON = 1e-6,
    i.ARRAY_TYPE = "undefined" != typeof Float32Array ? Float32Array : Array,
    i.RANDOM = Math.random,
    i.ENABLE_SIMD = !1,
    i.SIMD_AVAILABLE = i.ARRAY_TYPE === Float32Array && "SIMD"in this,
    i.USE_SIMD = i.ENABLE_SIMD && i.SIMD_AVAILABLE,
    i.setMatrixArrayType = function(t) {
        i.ARRAY_TYPE = t
    }
    ;
    var n = Math.PI / 180;
    i.toRadian = function(t) {
        return t * n
    }
    ,
    i.equals = function(t, e) {
        return Math.abs(t - e) <= i.EPSILON * Math.max(1, Math.abs(t), Math.abs(e))
    }
    ,
    t.exports = i
}
, function(t, e, i) {
    var n = i(1215)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(4);
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(4);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        e
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t
    }
    ,
    r.identity = function(t) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t
    }
    ,
    r.fromValues = function(t, e, i, r) {
        var a = new n.ARRAY_TYPE(4);
        return a[0] = t,
        a[1] = e,
        a[2] = i,
        a[3] = r,
        a
    }
    ,
    r.set = function(t, e, i, n, r) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t[3] = r,
        t
    }
    ,
    r.transpose = function(t, e) {
        if (t === e) {
            var i = e[1];
            t[1] = e[2],
            t[2] = i
        } else
            t[0] = e[0],
            t[1] = e[2],
            t[2] = e[1],
            t[3] = e[3];
        return t
    }
    ,
    r.invert = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = i * a - r * n;
        return s ? (s = 1 / s,
        t[0] = a * s,
        t[1] = -n * s,
        t[2] = -r * s,
        t[3] = i * s,
        t) : null
    }
    ,
    r.adjoint = function(t, e) {
        var i = e[0];
        return t[0] = e[3],
        t[1] = -e[1],
        t[2] = -e[2],
        t[3] = i,
        t
    }
    ,
    r.determinant = function(t) {
        return t[0] * t[3] - t[2] * t[1]
    }
    ,
    r.multiply = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = i[0]
          , u = i[1]
          , l = i[2]
          , c = i[3];
        return t[0] = n * o + a * u,
        t[1] = r * o + s * u,
        t[2] = n * l + a * c,
        t[3] = r * l + s * c,
        t
    }
    ,
    r.mul = r.multiply,
    r.rotate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = Math.sin(i)
          , u = Math.cos(i);
        return t[0] = n * u + a * o,
        t[1] = r * u + s * o,
        t[2] = n * -o + a * u,
        t[3] = r * -o + s * u,
        t
    }
    ,
    r.scale = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = i[0]
          , u = i[1];
        return t[0] = n * o,
        t[1] = r * o,
        t[2] = a * u,
        t[3] = s * u,
        t
    }
    ,
    r.fromRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = n,
        t[1] = i,
        t[2] = -i,
        t[3] = n,
        t
    }
    ,
    r.fromScaling = function(t, e) {
        return t[0] = e[0],
        t[1] = 0,
        t[2] = 0,
        t[3] = e[1],
        t
    }
    ,
    r.str = function(t) {
        return "mat2(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ")"
    }
    ,
    r.frob = function(t) {
        return Math.sqrt(Math.pow(t[0], 2) + Math.pow(t[1], 2) + Math.pow(t[2], 2) + Math.pow(t[3], 2))
    }
    ,
    r.LDU = function(t, e, i, n) {
        return t[2] = n[2] / n[0],
        i[0] = n[0],
        i[1] = n[1],
        i[3] = n[3] - t[2] * i[1],
        [t, e, i]
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t[3] = e[3] + i[3],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t[3] = e[3] - i[3],
        t
    }
    ,
    r.sub = r.subtract,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = t[3]
          , o = e[0]
          , u = e[1]
          , l = e[2]
          , c = e[3];
        return Math.abs(i - o) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(o)) && Math.abs(r - u) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(u)) && Math.abs(a - l) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(l)) && Math.abs(s - c) <= n.EPSILON * Math.max(1, Math.abs(s), Math.abs(c))
    }
    ,
    r.multiplyScalar = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t[3] = e[3] * i,
        t
    }
    ,
    r.multiplyScalarAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t[3] = e[3] + i[3] * n,
        t
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(1215)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(6);
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t[4] = 0,
        t[5] = 0,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(6);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        e[4] = t[4],
        e[5] = t[5],
        e
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[4] = e[4],
        t[5] = e[5],
        t
    }
    ,
    r.identity = function(t) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t[4] = 0,
        t[5] = 0,
        t
    }
    ,
    r.fromValues = function(t, e, i, r, a, s) {
        var o = new n.ARRAY_TYPE(6);
        return o[0] = t,
        o[1] = e,
        o[2] = i,
        o[3] = r,
        o[4] = a,
        o[5] = s,
        o
    }
    ,
    r.set = function(t, e, i, n, r, a, s) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t[3] = r,
        t[4] = a,
        t[5] = s,
        t
    }
    ,
    r.invert = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , u = i * a - n * r;
        return u ? (u = 1 / u,
        t[0] = a * u,
        t[1] = -n * u,
        t[2] = -r * u,
        t[3] = i * u,
        t[4] = (r * o - a * s) * u,
        t[5] = (n * s - i * o) * u,
        t) : null
    }
    ,
    r.determinant = function(t) {
        return t[0] * t[3] - t[1] * t[2]
    }
    ,
    r.multiply = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , u = e[5]
          , l = i[0]
          , c = i[1]
          , h = i[2]
          , d = i[3]
          , p = i[4]
          , f = i[5];
        return t[0] = n * l + a * c,
        t[1] = r * l + s * c,
        t[2] = n * h + a * d,
        t[3] = r * h + s * d,
        t[4] = n * p + a * f + o,
        t[5] = r * p + s * f + u,
        t
    }
    ,
    r.mul = r.multiply,
    r.rotate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , u = e[5]
          , l = Math.sin(i)
          , c = Math.cos(i);
        return t[0] = n * c + a * l,
        t[1] = r * c + s * l,
        t[2] = n * -l + a * c,
        t[3] = r * -l + s * c,
        t[4] = o,
        t[5] = u,
        t
    }
    ,
    r.scale = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , u = e[5]
          , l = i[0]
          , c = i[1];
        return t[0] = n * l,
        t[1] = r * l,
        t[2] = a * c,
        t[3] = s * c,
        t[4] = o,
        t[5] = u,
        t
    }
    ,
    r.translate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , u = e[5]
          , l = i[0]
          , c = i[1];
        return t[0] = n,
        t[1] = r,
        t[2] = a,
        t[3] = s,
        t[4] = n * l + a * c + o,
        t[5] = r * l + s * c + u,
        t
    }
    ,
    r.fromRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = n,
        t[1] = i,
        t[2] = -i,
        t[3] = n,
        t[4] = 0,
        t[5] = 0,
        t
    }
    ,
    r.fromScaling = function(t, e) {
        return t[0] = e[0],
        t[1] = 0,
        t[2] = 0,
        t[3] = e[1],
        t[4] = 0,
        t[5] = 0,
        t
    }
    ,
    r.fromTranslation = function(t, e) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t[4] = e[0],
        t[5] = e[1],
        t
    }
    ,
    r.str = function(t) {
        return "mat2d(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ", " + t[4] + ", " + t[5] + ")"
    }
    ,
    r.frob = function(t) {
        return Math.sqrt(Math.pow(t[0], 2) + Math.pow(t[1], 2) + Math.pow(t[2], 2) + Math.pow(t[3], 2) + Math.pow(t[4], 2) + Math.pow(t[5], 2) + 1)
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t[3] = e[3] + i[3],
        t[4] = e[4] + i[4],
        t[5] = e[5] + i[5],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t[3] = e[3] - i[3],
        t[4] = e[4] - i[4],
        t[5] = e[5] - i[5],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiplyScalar = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t[3] = e[3] * i,
        t[4] = e[4] * i,
        t[5] = e[5] * i,
        t
    }
    ,
    r.multiplyScalarAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t[3] = e[3] + i[3] * n,
        t[4] = e[4] + i[4] * n,
        t[5] = e[5] + i[5] * n,
        t
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3] && t[4] === e[4] && t[5] === e[5]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = t[3]
          , o = t[4]
          , u = t[5]
          , l = e[0]
          , c = e[1]
          , h = e[2]
          , d = e[3]
          , p = e[4]
          , f = e[5];
        return Math.abs(i - l) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(l)) && Math.abs(r - c) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(c)) && Math.abs(a - h) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(h)) && Math.abs(s - d) <= n.EPSILON * Math.max(1, Math.abs(s), Math.abs(d)) && Math.abs(o - p) <= n.EPSILON * Math.max(1, Math.abs(o), Math.abs(p)) && Math.abs(u - f) <= n.EPSILON * Math.max(1, Math.abs(u), Math.abs(f))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(1215)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(9);
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 1,
        t[5] = 0,
        t[6] = 0,
        t[7] = 0,
        t[8] = 1,
        t
    }
    ,
    r.fromMat4 = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[4],
        t[4] = e[5],
        t[5] = e[6],
        t[6] = e[8],
        t[7] = e[9],
        t[8] = e[10],
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(9);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        e[4] = t[4],
        e[5] = t[5],
        e[6] = t[6],
        e[7] = t[7],
        e[8] = t[8],
        e
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[4] = e[4],
        t[5] = e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[8] = e[8],
        t
    }
    ,
    r.fromValues = function(t, e, i, r, a, s, o, u, l) {
        var c = new n.ARRAY_TYPE(9);
        return c[0] = t,
        c[1] = e,
        c[2] = i,
        c[3] = r,
        c[4] = a,
        c[5] = s,
        c[6] = o,
        c[7] = u,
        c[8] = l,
        c
    }
    ,
    r.set = function(t, e, i, n, r, a, s, o, u, l) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t[3] = r,
        t[4] = a,
        t[5] = s,
        t[6] = o,
        t[7] = u,
        t[8] = l,
        t
    }
    ,
    r.identity = function(t) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 1,
        t[5] = 0,
        t[6] = 0,
        t[7] = 0,
        t[8] = 1,
        t
    }
    ,
    r.transpose = function(t, e) {
        if (t === e) {
            var i = e[1]
              , n = e[2]
              , r = e[5];
            t[1] = e[3],
            t[2] = e[6],
            t[3] = i,
            t[5] = e[7],
            t[6] = n,
            t[7] = r
        } else
            t[0] = e[0],
            t[1] = e[3],
            t[2] = e[6],
            t[3] = e[1],
            t[4] = e[4],
            t[5] = e[7],
            t[6] = e[2],
            t[7] = e[5],
            t[8] = e[8];
        return t
    }
    ,
    r.invert = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , u = e[6]
          , l = e[7]
          , c = e[8]
          , h = c * s - o * l
          , d = -c * a + o * u
          , p = l * a - s * u
          , f = i * h + n * d + r * p;
        return f ? (f = 1 / f,
        t[0] = h * f,
        t[1] = (-c * n + r * l) * f,
        t[2] = (o * n - r * s) * f,
        t[3] = d * f,
        t[4] = (c * i - r * u) * f,
        t[5] = (-o * i + r * a) * f,
        t[6] = p * f,
        t[7] = (-l * i + n * u) * f,
        t[8] = (s * i - n * a) * f,
        t) : null
    }
    ,
    r.adjoint = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , u = e[6]
          , l = e[7]
          , c = e[8];
        return t[0] = s * c - o * l,
        t[1] = r * l - n * c,
        t[2] = n * o - r * s,
        t[3] = o * u - a * c,
        t[4] = i * c - r * u,
        t[5] = r * a - i * o,
        t[6] = a * l - s * u,
        t[7] = n * u - i * l,
        t[8] = i * s - n * a,
        t
    }
    ,
    r.determinant = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2]
          , r = t[3]
          , a = t[4]
          , s = t[5]
          , o = t[6]
          , u = t[7]
          , l = t[8];
        return e * (l * a - s * u) + i * (-l * r + s * o) + n * (u * r - a * o)
    }
    ,
    r.multiply = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , u = e[5]
          , l = e[6]
          , c = e[7]
          , h = e[8]
          , d = i[0]
          , p = i[1]
          , f = i[2]
          , g = i[3]
          , m = i[4]
          , v = i[5]
          , _ = i[6]
          , b = i[7]
          , x = i[8];
        return t[0] = d * n + p * s + f * l,
        t[1] = d * r + p * o + f * c,
        t[2] = d * a + p * u + f * h,
        t[3] = g * n + m * s + v * l,
        t[4] = g * r + m * o + v * c,
        t[5] = g * a + m * u + v * h,
        t[6] = _ * n + b * s + x * l,
        t[7] = _ * r + b * o + x * c,
        t[8] = _ * a + b * u + x * h,
        t
    }
    ,
    r.mul = r.multiply,
    r.translate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , u = e[5]
          , l = e[6]
          , c = e[7]
          , h = e[8]
          , d = i[0]
          , p = i[1];
        return t[0] = n,
        t[1] = r,
        t[2] = a,
        t[3] = s,
        t[4] = o,
        t[5] = u,
        t[6] = d * n + p * s + l,
        t[7] = d * r + p * o + c,
        t[8] = d * a + p * u + h,
        t
    }
    ,
    r.rotate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , u = e[5]
          , l = e[6]
          , c = e[7]
          , h = e[8]
          , d = Math.sin(i)
          , p = Math.cos(i);
        return t[0] = p * n + d * s,
        t[1] = p * r + d * o,
        t[2] = p * a + d * u,
        t[3] = p * s - d * n,
        t[4] = p * o - d * r,
        t[5] = p * u - d * a,
        t[6] = l,
        t[7] = c,
        t[8] = h,
        t
    }
    ,
    r.scale = function(t, e, i) {
        var n = i[0]
          , r = i[1];
        return t[0] = n * e[0],
        t[1] = n * e[1],
        t[2] = n * e[2],
        t[3] = r * e[3],
        t[4] = r * e[4],
        t[5] = r * e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[8] = e[8],
        t
    }
    ,
    r.fromTranslation = function(t, e) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 1,
        t[5] = 0,
        t[6] = e[0],
        t[7] = e[1],
        t[8] = 1,
        t
    }
    ,
    r.fromRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = n,
        t[1] = i,
        t[2] = 0,
        t[3] = -i,
        t[4] = n,
        t[5] = 0,
        t[6] = 0,
        t[7] = 0,
        t[8] = 1,
        t
    }
    ,
    r.fromScaling = function(t, e) {
        return t[0] = e[0],
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = e[1],
        t[5] = 0,
        t[6] = 0,
        t[7] = 0,
        t[8] = 1,
        t
    }
    ,
    r.fromMat2d = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = 0,
        t[3] = e[2],
        t[4] = e[3],
        t[5] = 0,
        t[6] = e[4],
        t[7] = e[5],
        t[8] = 1,
        t
    }
    ,
    r.fromQuat = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = i + i
          , o = n + n
          , u = r + r
          , l = i * s
          , c = n * s
          , h = n * o
          , d = r * s
          , p = r * o
          , f = r * u
          , g = a * s
          , m = a * o
          , v = a * u;
        return t[0] = 1 - h - f,
        t[3] = c - v,
        t[6] = d + m,
        t[1] = c + v,
        t[4] = 1 - l - f,
        t[7] = p - g,
        t[2] = d - m,
        t[5] = p + g,
        t[8] = 1 - l - h,
        t
    }
    ,
    r.normalFromMat4 = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , u = e[6]
          , l = e[7]
          , c = e[8]
          , h = e[9]
          , d = e[10]
          , p = e[11]
          , f = e[12]
          , g = e[13]
          , m = e[14]
          , v = e[15]
          , _ = i * o - n * s
          , b = i * u - r * s
          , x = i * l - a * s
          , A = n * u - r * o
          , y = n * l - a * o
          , S = r * l - a * u
          , C = c * g - h * f
          , M = c * m - d * f
          , w = c * v - p * f
          , T = h * m - d * g
          , E = h * v - p * g
          , I = d * v - p * m
          , k = _ * I - b * E + x * T + A * w - y * M + S * C;
        return k ? (k = 1 / k,
        t[0] = (o * I - u * E + l * T) * k,
        t[1] = (u * w - s * I - l * M) * k,
        t[2] = (s * E - o * w + l * C) * k,
        t[3] = (r * E - n * I - a * T) * k,
        t[4] = (i * I - r * w + a * M) * k,
        t[5] = (n * w - i * E - a * C) * k,
        t[6] = (g * S - m * y + v * A) * k,
        t[7] = (m * x - f * S - v * b) * k,
        t[8] = (f * y - g * x + v * _) * k,
        t) : null
    }
    ,
    r.str = function(t) {
        return "mat3(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ", " + t[4] + ", " + t[5] + ", " + t[6] + ", " + t[7] + ", " + t[8] + ")"
    }
    ,
    r.frob = function(t) {
        return Math.sqrt(Math.pow(t[0], 2) + Math.pow(t[1], 2) + Math.pow(t[2], 2) + Math.pow(t[3], 2) + Math.pow(t[4], 2) + Math.pow(t[5], 2) + Math.pow(t[6], 2) + Math.pow(t[7], 2) + Math.pow(t[8], 2))
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t[3] = e[3] + i[3],
        t[4] = e[4] + i[4],
        t[5] = e[5] + i[5],
        t[6] = e[6] + i[6],
        t[7] = e[7] + i[7],
        t[8] = e[8] + i[8],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t[3] = e[3] - i[3],
        t[4] = e[4] - i[4],
        t[5] = e[5] - i[5],
        t[6] = e[6] - i[6],
        t[7] = e[7] - i[7],
        t[8] = e[8] - i[8],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiplyScalar = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t[3] = e[3] * i,
        t[4] = e[4] * i,
        t[5] = e[5] * i,
        t[6] = e[6] * i,
        t[7] = e[7] * i,
        t[8] = e[8] * i,
        t
    }
    ,
    r.multiplyScalarAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t[3] = e[3] + i[3] * n,
        t[4] = e[4] + i[4] * n,
        t[5] = e[5] + i[5] * n,
        t[6] = e[6] + i[6] * n,
        t[7] = e[7] + i[7] * n,
        t[8] = e[8] + i[8] * n,
        t
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3] && t[4] === e[4] && t[5] === e[5] && t[6] === e[6] && t[7] === e[7] && t[8] === e[8]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = t[3]
          , o = t[4]
          , u = t[5]
          , l = t[6]
          , c = t[7]
          , h = t[8]
          , d = e[0]
          , p = e[1]
          , f = e[2]
          , g = e[3]
          , m = e[4]
          , v = e[5]
          , _ = t[6]
          , b = e[7]
          , x = e[8];
        return Math.abs(i - d) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(d)) && Math.abs(r - p) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(p)) && Math.abs(a - f) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(f)) && Math.abs(s - g) <= n.EPSILON * Math.max(1, Math.abs(s), Math.abs(g)) && Math.abs(o - m) <= n.EPSILON * Math.max(1, Math.abs(o), Math.abs(m)) && Math.abs(u - v) <= n.EPSILON * Math.max(1, Math.abs(u), Math.abs(v)) && Math.abs(l - _) <= n.EPSILON * Math.max(1, Math.abs(l), Math.abs(_)) && Math.abs(c - b) <= n.EPSILON * Math.max(1, Math.abs(c), Math.abs(b)) && Math.abs(h - x) <= n.EPSILON * Math.max(1, Math.abs(h), Math.abs(x))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(1215)
      , r = {
        scalar: {},
        SIMD: {}
    };
    r.create = function() {
        var t = new n.ARRAY_TYPE(16);
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = 1,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = 1,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(16);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        e[4] = t[4],
        e[5] = t[5],
        e[6] = t[6],
        e[7] = t[7],
        e[8] = t[8],
        e[9] = t[9],
        e[10] = t[10],
        e[11] = t[11],
        e[12] = t[12],
        e[13] = t[13],
        e[14] = t[14],
        e[15] = t[15],
        e
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[4] = e[4],
        t[5] = e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[8] = e[8],
        t[9] = e[9],
        t[10] = e[10],
        t[11] = e[11],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15],
        t
    }
    ,
    r.fromValues = function(t, e, i, r, a, s, o, u, l, c, h, d, p, f, g, m) {
        var v = new n.ARRAY_TYPE(16);
        return v[0] = t,
        v[1] = e,
        v[2] = i,
        v[3] = r,
        v[4] = a,
        v[5] = s,
        v[6] = o,
        v[7] = u,
        v[8] = l,
        v[9] = c,
        v[10] = h,
        v[11] = d,
        v[12] = p,
        v[13] = f,
        v[14] = g,
        v[15] = m,
        v
    }
    ,
    r.set = function(t, e, i, n, r, a, s, o, u, l, c, h, d, p, f, g, m) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t[3] = r,
        t[4] = a,
        t[5] = s,
        t[6] = o,
        t[7] = u,
        t[8] = l,
        t[9] = c,
        t[10] = h,
        t[11] = d,
        t[12] = p,
        t[13] = f,
        t[14] = g,
        t[15] = m,
        t
    }
    ,
    r.identity = function(t) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = 1,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = 1,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.scalar.transpose = function(t, e) {
        if (t === e) {
            var i = e[1]
              , n = e[2]
              , r = e[3]
              , a = e[6]
              , s = e[7]
              , o = e[11];
            t[1] = e[4],
            t[2] = e[8],
            t[3] = e[12],
            t[4] = i,
            t[6] = e[9],
            t[7] = e[13],
            t[8] = n,
            t[9] = a,
            t[11] = e[14],
            t[12] = r,
            t[13] = s,
            t[14] = o
        } else
            t[0] = e[0],
            t[1] = e[4],
            t[2] = e[8],
            t[3] = e[12],
            t[4] = e[1],
            t[5] = e[5],
            t[6] = e[9],
            t[7] = e[13],
            t[8] = e[2],
            t[9] = e[6],
            t[10] = e[10],
            t[11] = e[14],
            t[12] = e[3],
            t[13] = e[7],
            t[14] = e[11],
            t[15] = e[15];
        return t
    }
    ,
    r.SIMD.transpose = function(t, e) {
        var i, n, r, a, s, o, u, l, c, h;
        return i = SIMD.Float32x4.load(e, 0),
        n = SIMD.Float32x4.load(e, 4),
        r = SIMD.Float32x4.load(e, 8),
        a = SIMD.Float32x4.load(e, 12),
        s = SIMD.Float32x4.shuffle(i, n, 0, 1, 4, 5),
        o = SIMD.Float32x4.shuffle(r, a, 0, 1, 4, 5),
        u = SIMD.Float32x4.shuffle(s, o, 0, 2, 4, 6),
        l = SIMD.Float32x4.shuffle(s, o, 1, 3, 5, 7),
        SIMD.Float32x4.store(t, 0, u),
        SIMD.Float32x4.store(t, 4, l),
        s = SIMD.Float32x4.shuffle(i, n, 2, 3, 6, 7),
        o = SIMD.Float32x4.shuffle(r, a, 2, 3, 6, 7),
        c = SIMD.Float32x4.shuffle(s, o, 0, 2, 4, 6),
        h = SIMD.Float32x4.shuffle(s, o, 1, 3, 5, 7),
        SIMD.Float32x4.store(t, 8, c),
        SIMD.Float32x4.store(t, 12, h),
        t
    }
    ,
    r.transpose = n.USE_SIMD ? r.SIMD.transpose : r.scalar.transpose,
    r.scalar.invert = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , u = e[6]
          , l = e[7]
          , c = e[8]
          , h = e[9]
          , d = e[10]
          , p = e[11]
          , f = e[12]
          , g = e[13]
          , m = e[14]
          , v = e[15]
          , _ = i * o - n * s
          , b = i * u - r * s
          , x = i * l - a * s
          , A = n * u - r * o
          , y = n * l - a * o
          , S = r * l - a * u
          , C = c * g - h * f
          , M = c * m - d * f
          , w = c * v - p * f
          , T = h * m - d * g
          , E = h * v - p * g
          , I = d * v - p * m
          , k = _ * I - b * E + x * T + A * w - y * M + S * C;
        return k ? (k = 1 / k,
        t[0] = (o * I - u * E + l * T) * k,
        t[1] = (r * E - n * I - a * T) * k,
        t[2] = (g * S - m * y + v * A) * k,
        t[3] = (d * y - h * S - p * A) * k,
        t[4] = (u * w - s * I - l * M) * k,
        t[5] = (i * I - r * w + a * M) * k,
        t[6] = (m * x - f * S - v * b) * k,
        t[7] = (c * S - d * x + p * b) * k,
        t[8] = (s * E - o * w + l * C) * k,
        t[9] = (n * w - i * E - a * C) * k,
        t[10] = (f * y - g * x + v * _) * k,
        t[11] = (h * x - c * y - p * _) * k,
        t[12] = (o * M - s * T - u * C) * k,
        t[13] = (i * T - n * M + r * C) * k,
        t[14] = (g * b - f * A - m * _) * k,
        t[15] = (c * A - h * b + d * _) * k,
        t) : null
    }
    ,
    r.SIMD.invert = function(t, e) {
        var i, n, r, a, s, o, u, l, c, h, d = SIMD.Float32x4.load(e, 0), p = SIMD.Float32x4.load(e, 4), f = SIMD.Float32x4.load(e, 8), g = SIMD.Float32x4.load(e, 12);
        return s = SIMD.Float32x4.shuffle(d, p, 0, 1, 4, 5),
        n = SIMD.Float32x4.shuffle(f, g, 0, 1, 4, 5),
        i = SIMD.Float32x4.shuffle(s, n, 0, 2, 4, 6),
        n = SIMD.Float32x4.shuffle(n, s, 1, 3, 5, 7),
        s = SIMD.Float32x4.shuffle(d, p, 2, 3, 6, 7),
        a = SIMD.Float32x4.shuffle(f, g, 2, 3, 6, 7),
        r = SIMD.Float32x4.shuffle(s, a, 0, 2, 4, 6),
        a = SIMD.Float32x4.shuffle(a, s, 1, 3, 5, 7),
        s = SIMD.Float32x4.mul(r, a),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        o = SIMD.Float32x4.mul(n, s),
        u = SIMD.Float32x4.mul(i, s),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        o = SIMD.Float32x4.sub(SIMD.Float32x4.mul(n, s), o),
        u = SIMD.Float32x4.sub(SIMD.Float32x4.mul(i, s), u),
        u = SIMD.Float32x4.swizzle(u, 2, 3, 0, 1),
        s = SIMD.Float32x4.mul(n, r),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        o = SIMD.Float32x4.add(SIMD.Float32x4.mul(a, s), o),
        c = SIMD.Float32x4.mul(i, s),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        o = SIMD.Float32x4.sub(o, SIMD.Float32x4.mul(a, s)),
        c = SIMD.Float32x4.sub(SIMD.Float32x4.mul(i, s), c),
        c = SIMD.Float32x4.swizzle(c, 2, 3, 0, 1),
        s = SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n, 2, 3, 0, 1), a),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        r = SIMD.Float32x4.swizzle(r, 2, 3, 0, 1),
        o = SIMD.Float32x4.add(SIMD.Float32x4.mul(r, s), o),
        l = SIMD.Float32x4.mul(i, s),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        o = SIMD.Float32x4.sub(o, SIMD.Float32x4.mul(r, s)),
        l = SIMD.Float32x4.sub(SIMD.Float32x4.mul(i, s), l),
        l = SIMD.Float32x4.swizzle(l, 2, 3, 0, 1),
        s = SIMD.Float32x4.mul(i, n),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        l = SIMD.Float32x4.add(SIMD.Float32x4.mul(a, s), l),
        c = SIMD.Float32x4.sub(SIMD.Float32x4.mul(r, s), c),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        l = SIMD.Float32x4.sub(SIMD.Float32x4.mul(a, s), l),
        c = SIMD.Float32x4.sub(c, SIMD.Float32x4.mul(r, s)),
        s = SIMD.Float32x4.mul(i, a),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        u = SIMD.Float32x4.sub(u, SIMD.Float32x4.mul(r, s)),
        l = SIMD.Float32x4.add(SIMD.Float32x4.mul(n, s), l),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        u = SIMD.Float32x4.add(SIMD.Float32x4.mul(r, s), u),
        l = SIMD.Float32x4.sub(l, SIMD.Float32x4.mul(n, s)),
        s = SIMD.Float32x4.mul(i, r),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        u = SIMD.Float32x4.add(SIMD.Float32x4.mul(a, s), u),
        c = SIMD.Float32x4.sub(c, SIMD.Float32x4.mul(n, s)),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        u = SIMD.Float32x4.sub(u, SIMD.Float32x4.mul(a, s)),
        c = SIMD.Float32x4.add(SIMD.Float32x4.mul(n, s), c),
        h = SIMD.Float32x4.mul(i, o),
        h = SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h, 2, 3, 0, 1), h),
        h = SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h, 1, 0, 3, 2), h),
        s = SIMD.Float32x4.reciprocalApproximation(h),
        h = SIMD.Float32x4.sub(SIMD.Float32x4.add(s, s), SIMD.Float32x4.mul(h, SIMD.Float32x4.mul(s, s))),
        (h = SIMD.Float32x4.swizzle(h, 0, 0, 0, 0)) ? (SIMD.Float32x4.store(t, 0, SIMD.Float32x4.mul(h, o)),
        SIMD.Float32x4.store(t, 4, SIMD.Float32x4.mul(h, u)),
        SIMD.Float32x4.store(t, 8, SIMD.Float32x4.mul(h, l)),
        SIMD.Float32x4.store(t, 12, SIMD.Float32x4.mul(h, c)),
        t) : null
    }
    ,
    r.invert = n.USE_SIMD ? r.SIMD.invert : r.scalar.invert,
    r.scalar.adjoint = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , u = e[6]
          , l = e[7]
          , c = e[8]
          , h = e[9]
          , d = e[10]
          , p = e[11]
          , f = e[12]
          , g = e[13]
          , m = e[14]
          , v = e[15];
        return t[0] = o * (d * v - p * m) - h * (u * v - l * m) + g * (u * p - l * d),
        t[1] = -(n * (d * v - p * m) - h * (r * v - a * m) + g * (r * p - a * d)),
        t[2] = n * (u * v - l * m) - o * (r * v - a * m) + g * (r * l - a * u),
        t[3] = -(n * (u * p - l * d) - o * (r * p - a * d) + h * (r * l - a * u)),
        t[4] = -(s * (d * v - p * m) - c * (u * v - l * m) + f * (u * p - l * d)),
        t[5] = i * (d * v - p * m) - c * (r * v - a * m) + f * (r * p - a * d),
        t[6] = -(i * (u * v - l * m) - s * (r * v - a * m) + f * (r * l - a * u)),
        t[7] = i * (u * p - l * d) - s * (r * p - a * d) + c * (r * l - a * u),
        t[8] = s * (h * v - p * g) - c * (o * v - l * g) + f * (o * p - l * h),
        t[9] = -(i * (h * v - p * g) - c * (n * v - a * g) + f * (n * p - a * h)),
        t[10] = i * (o * v - l * g) - s * (n * v - a * g) + f * (n * l - a * o),
        t[11] = -(i * (o * p - l * h) - s * (n * p - a * h) + c * (n * l - a * o)),
        t[12] = -(s * (h * m - d * g) - c * (o * m - u * g) + f * (o * d - u * h)),
        t[13] = i * (h * m - d * g) - c * (n * m - r * g) + f * (n * d - r * h),
        t[14] = -(i * (o * m - u * g) - s * (n * m - r * g) + f * (n * u - r * o)),
        t[15] = i * (o * d - u * h) - s * (n * d - r * h) + c * (n * u - r * o),
        t
    }
    ,
    r.SIMD.adjoint = function(t, e) {
        var i, n, r, a, s, o, u, l, c, h, d, p, f, i = SIMD.Float32x4.load(e, 0), n = SIMD.Float32x4.load(e, 4), r = SIMD.Float32x4.load(e, 8), a = SIMD.Float32x4.load(e, 12);
        return c = SIMD.Float32x4.shuffle(i, n, 0, 1, 4, 5),
        o = SIMD.Float32x4.shuffle(r, a, 0, 1, 4, 5),
        s = SIMD.Float32x4.shuffle(c, o, 0, 2, 4, 6),
        o = SIMD.Float32x4.shuffle(o, c, 1, 3, 5, 7),
        c = SIMD.Float32x4.shuffle(i, n, 2, 3, 6, 7),
        l = SIMD.Float32x4.shuffle(r, a, 2, 3, 6, 7),
        u = SIMD.Float32x4.shuffle(c, l, 0, 2, 4, 6),
        l = SIMD.Float32x4.shuffle(l, c, 1, 3, 5, 7),
        c = SIMD.Float32x4.mul(u, l),
        c = SIMD.Float32x4.swizzle(c, 1, 0, 3, 2),
        h = SIMD.Float32x4.mul(o, c),
        d = SIMD.Float32x4.mul(s, c),
        c = SIMD.Float32x4.swizzle(c, 2, 3, 0, 1),
        h = SIMD.Float32x4.sub(SIMD.Float32x4.mul(o, c), h),
        d = SIMD.Float32x4.sub(SIMD.Float32x4.mul(s, c), d),
        d = SIMD.Float32x4.swizzle(d, 2, 3, 0, 1),
        c = SIMD.Float32x4.mul(o, u),
        c = SIMD.Float32x4.swizzle(c, 1, 0, 3, 2),
        h = SIMD.Float32x4.add(SIMD.Float32x4.mul(l, c), h),
        f = SIMD.Float32x4.mul(s, c),
        c = SIMD.Float32x4.swizzle(c, 2, 3, 0, 1),
        h = SIMD.Float32x4.sub(h, SIMD.Float32x4.mul(l, c)),
        f = SIMD.Float32x4.sub(SIMD.Float32x4.mul(s, c), f),
        f = SIMD.Float32x4.swizzle(f, 2, 3, 0, 1),
        c = SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o, 2, 3, 0, 1), l),
        c = SIMD.Float32x4.swizzle(c, 1, 0, 3, 2),
        u = SIMD.Float32x4.swizzle(u, 2, 3, 0, 1),
        h = SIMD.Float32x4.add(SIMD.Float32x4.mul(u, c), h),
        p = SIMD.Float32x4.mul(s, c),
        c = SIMD.Float32x4.swizzle(c, 2, 3, 0, 1),
        h = SIMD.Float32x4.sub(h, SIMD.Float32x4.mul(u, c)),
        p = SIMD.Float32x4.sub(SIMD.Float32x4.mul(s, c), p),
        p = SIMD.Float32x4.swizzle(p, 2, 3, 0, 1),
        c = SIMD.Float32x4.mul(s, o),
        c = SIMD.Float32x4.swizzle(c, 1, 0, 3, 2),
        p = SIMD.Float32x4.add(SIMD.Float32x4.mul(l, c), p),
        f = SIMD.Float32x4.sub(SIMD.Float32x4.mul(u, c), f),
        c = SIMD.Float32x4.swizzle(c, 2, 3, 0, 1),
        p = SIMD.Float32x4.sub(SIMD.Float32x4.mul(l, c), p),
        f = SIMD.Float32x4.sub(f, SIMD.Float32x4.mul(u, c)),
        c = SIMD.Float32x4.mul(s, l),
        c = SIMD.Float32x4.swizzle(c, 1, 0, 3, 2),
        d = SIMD.Float32x4.sub(d, SIMD.Float32x4.mul(u, c)),
        p = SIMD.Float32x4.add(SIMD.Float32x4.mul(o, c), p),
        c = SIMD.Float32x4.swizzle(c, 2, 3, 0, 1),
        d = SIMD.Float32x4.add(SIMD.Float32x4.mul(u, c), d),
        p = SIMD.Float32x4.sub(p, SIMD.Float32x4.mul(o, c)),
        c = SIMD.Float32x4.mul(s, u),
        c = SIMD.Float32x4.swizzle(c, 1, 0, 3, 2),
        d = SIMD.Float32x4.add(SIMD.Float32x4.mul(l, c), d),
        f = SIMD.Float32x4.sub(f, SIMD.Float32x4.mul(o, c)),
        c = SIMD.Float32x4.swizzle(c, 2, 3, 0, 1),
        d = SIMD.Float32x4.sub(d, SIMD.Float32x4.mul(l, c)),
        f = SIMD.Float32x4.add(SIMD.Float32x4.mul(o, c), f),
        SIMD.Float32x4.store(t, 0, h),
        SIMD.Float32x4.store(t, 4, d),
        SIMD.Float32x4.store(t, 8, p),
        SIMD.Float32x4.store(t, 12, f),
        t
    }
    ,
    r.adjoint = n.USE_SIMD ? r.SIMD.adjoint : r.scalar.adjoint,
    r.determinant = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2]
          , r = t[3]
          , a = t[4]
          , s = t[5]
          , o = t[6]
          , u = t[7]
          , l = t[8]
          , c = t[9]
          , h = t[10]
          , d = t[11]
          , p = t[12]
          , f = t[13]
          , g = t[14]
          , m = t[15]
          , v = e * s - i * a
          , _ = e * o - n * a
          , b = e * u - r * a
          , x = i * o - n * s
          , A = i * u - r * s
          , y = n * u - r * o
          , S = l * f - c * p
          , C = l * g - h * p
          , M = l * m - d * p
          , w = c * g - h * f
          , T = c * m - d * f
          , E = h * m - d * g;
        return v * E - _ * T + b * w + x * M - A * C + y * S
    }
    ,
    r.SIMD.multiply = function(t, e, i) {
        var n = SIMD.Float32x4.load(e, 0)
          , r = SIMD.Float32x4.load(e, 4)
          , a = SIMD.Float32x4.load(e, 8)
          , s = SIMD.Float32x4.load(e, 12)
          , o = SIMD.Float32x4.load(i, 0)
          , u = SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o, 0, 0, 0, 0), n), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o, 1, 1, 1, 1), r), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o, 2, 2, 2, 2), a), SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o, 3, 3, 3, 3), s))));
        SIMD.Float32x4.store(t, 0, u);
        var l = SIMD.Float32x4.load(i, 4)
          , c = SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l, 0, 0, 0, 0), n), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l, 1, 1, 1, 1), r), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l, 2, 2, 2, 2), a), SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l, 3, 3, 3, 3), s))));
        SIMD.Float32x4.store(t, 4, c);
        var h = SIMD.Float32x4.load(i, 8)
          , d = SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h, 0, 0, 0, 0), n), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h, 1, 1, 1, 1), r), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h, 2, 2, 2, 2), a), SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h, 3, 3, 3, 3), s))));
        SIMD.Float32x4.store(t, 8, d);
        var p = SIMD.Float32x4.load(i, 12)
          , f = SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p, 0, 0, 0, 0), n), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p, 1, 1, 1, 1), r), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p, 2, 2, 2, 2), a), SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p, 3, 3, 3, 3), s))));
        return SIMD.Float32x4.store(t, 12, f),
        t
    }
    ,
    r.scalar.multiply = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , u = e[5]
          , l = e[6]
          , c = e[7]
          , h = e[8]
          , d = e[9]
          , p = e[10]
          , f = e[11]
          , g = e[12]
          , m = e[13]
          , v = e[14]
          , _ = e[15]
          , b = i[0]
          , x = i[1]
          , A = i[2]
          , y = i[3];
        return t[0] = b * n + x * o + A * h + y * g,
        t[1] = b * r + x * u + A * d + y * m,
        t[2] = b * a + x * l + A * p + y * v,
        t[3] = b * s + x * c + A * f + y * _,
        b = i[4],
        x = i[5],
        A = i[6],
        y = i[7],
        t[4] = b * n + x * o + A * h + y * g,
        t[5] = b * r + x * u + A * d + y * m,
        t[6] = b * a + x * l + A * p + y * v,
        t[7] = b * s + x * c + A * f + y * _,
        b = i[8],
        x = i[9],
        A = i[10],
        y = i[11],
        t[8] = b * n + x * o + A * h + y * g,
        t[9] = b * r + x * u + A * d + y * m,
        t[10] = b * a + x * l + A * p + y * v,
        t[11] = b * s + x * c + A * f + y * _,
        b = i[12],
        x = i[13],
        A = i[14],
        y = i[15],
        t[12] = b * n + x * o + A * h + y * g,
        t[13] = b * r + x * u + A * d + y * m,
        t[14] = b * a + x * l + A * p + y * v,
        t[15] = b * s + x * c + A * f + y * _,
        t
    }
    ,
    r.multiply = n.USE_SIMD ? r.SIMD.multiply : r.scalar.multiply,
    r.mul = r.multiply,
    r.scalar.translate = function(t, e, i) {
        var n, r, a, s, o, u, l, c, h, d, p, f, g = i[0], m = i[1], v = i[2];
        return e === t ? (t[12] = e[0] * g + e[4] * m + e[8] * v + e[12],
        t[13] = e[1] * g + e[5] * m + e[9] * v + e[13],
        t[14] = e[2] * g + e[6] * m + e[10] * v + e[14],
        t[15] = e[3] * g + e[7] * m + e[11] * v + e[15]) : (n = e[0],
        r = e[1],
        a = e[2],
        s = e[3],
        o = e[4],
        u = e[5],
        l = e[6],
        c = e[7],
        h = e[8],
        d = e[9],
        p = e[10],
        f = e[11],
        t[0] = n,
        t[1] = r,
        t[2] = a,
        t[3] = s,
        t[4] = o,
        t[5] = u,
        t[6] = l,
        t[7] = c,
        t[8] = h,
        t[9] = d,
        t[10] = p,
        t[11] = f,
        t[12] = n * g + o * m + h * v + e[12],
        t[13] = r * g + u * m + d * v + e[13],
        t[14] = a * g + l * m + p * v + e[14],
        t[15] = s * g + c * m + f * v + e[15]),
        t
    }
    ,
    r.SIMD.translate = function(t, e, i) {
        var n = SIMD.Float32x4.load(e, 0)
          , r = SIMD.Float32x4.load(e, 4)
          , a = SIMD.Float32x4.load(e, 8)
          , s = SIMD.Float32x4.load(e, 12)
          , o = SIMD.Float32x4(i[0], i[1], i[2], 0);
        e !== t && (t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[4] = e[4],
        t[5] = e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[8] = e[8],
        t[9] = e[9],
        t[10] = e[10],
        t[11] = e[11]),
        n = SIMD.Float32x4.mul(n, SIMD.Float32x4.swizzle(o, 0, 0, 0, 0)),
        r = SIMD.Float32x4.mul(r, SIMD.Float32x4.swizzle(o, 1, 1, 1, 1)),
        a = SIMD.Float32x4.mul(a, SIMD.Float32x4.swizzle(o, 2, 2, 2, 2));
        var u = SIMD.Float32x4.add(n, SIMD.Float32x4.add(r, SIMD.Float32x4.add(a, s)));
        return SIMD.Float32x4.store(t, 12, u),
        t
    }
    ,
    r.translate = n.USE_SIMD ? r.SIMD.translate : r.scalar.translate,
    r.scalar.scale = function(t, e, i) {
        var n = i[0]
          , r = i[1]
          , a = i[2];
        return t[0] = e[0] * n,
        t[1] = e[1] * n,
        t[2] = e[2] * n,
        t[3] = e[3] * n,
        t[4] = e[4] * r,
        t[5] = e[5] * r,
        t[6] = e[6] * r,
        t[7] = e[7] * r,
        t[8] = e[8] * a,
        t[9] = e[9] * a,
        t[10] = e[10] * a,
        t[11] = e[11] * a,
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15],
        t
    }
    ,
    r.SIMD.scale = function(t, e, i) {
        var n, r, a, s = SIMD.Float32x4(i[0], i[1], i[2], 0);
        return n = SIMD.Float32x4.load(e, 0),
        SIMD.Float32x4.store(t, 0, SIMD.Float32x4.mul(n, SIMD.Float32x4.swizzle(s, 0, 0, 0, 0))),
        r = SIMD.Float32x4.load(e, 4),
        SIMD.Float32x4.store(t, 4, SIMD.Float32x4.mul(r, SIMD.Float32x4.swizzle(s, 1, 1, 1, 1))),
        a = SIMD.Float32x4.load(e, 8),
        SIMD.Float32x4.store(t, 8, SIMD.Float32x4.mul(a, SIMD.Float32x4.swizzle(s, 2, 2, 2, 2))),
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15],
        t
    }
    ,
    r.scale = n.USE_SIMD ? r.SIMD.scale : r.scalar.scale,
    r.rotate = function(t, e, i, r) {
        var a, s, o, u, l, c, h, d, p, f, g, m, v, _, b, x, A, y, S, C, M, w, T, E, I = r[0], k = r[1], F = r[2], D = Math.sqrt(I * I + k * k + F * F);
        return Math.abs(D) < n.EPSILON ? null : (D = 1 / D,
        I *= D,
        k *= D,
        F *= D,
        a = Math.sin(i),
        s = Math.cos(i),
        o = 1 - s,
        u = e[0],
        l = e[1],
        c = e[2],
        h = e[3],
        d = e[4],
        p = e[5],
        f = e[6],
        g = e[7],
        m = e[8],
        v = e[9],
        _ = e[10],
        b = e[11],
        x = I * I * o + s,
        A = k * I * o + F * a,
        y = F * I * o - k * a,
        S = I * k * o - F * a,
        C = k * k * o + s,
        M = F * k * o + I * a,
        w = I * F * o + k * a,
        T = k * F * o - I * a,
        E = F * F * o + s,
        t[0] = u * x + d * A + m * y,
        t[1] = l * x + p * A + v * y,
        t[2] = c * x + f * A + _ * y,
        t[3] = h * x + g * A + b * y,
        t[4] = u * S + d * C + m * M,
        t[5] = l * S + p * C + v * M,
        t[6] = c * S + f * C + _ * M,
        t[7] = h * S + g * C + b * M,
        t[8] = u * w + d * T + m * E,
        t[9] = l * w + p * T + v * E,
        t[10] = c * w + f * T + _ * E,
        t[11] = h * w + g * T + b * E,
        e !== t && (t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]),
        t)
    }
    ,
    r.scalar.rotateX = function(t, e, i) {
        var n = Math.sin(i)
          , r = Math.cos(i)
          , a = e[4]
          , s = e[5]
          , o = e[6]
          , u = e[7]
          , l = e[8]
          , c = e[9]
          , h = e[10]
          , d = e[11];
        return e !== t && (t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]),
        t[4] = a * r + l * n,
        t[5] = s * r + c * n,
        t[6] = o * r + h * n,
        t[7] = u * r + d * n,
        t[8] = l * r - a * n,
        t[9] = c * r - s * n,
        t[10] = h * r - o * n,
        t[11] = d * r - u * n,
        t
    }
    ,
    r.SIMD.rotateX = function(t, e, i) {
        var n = SIMD.Float32x4.splat(Math.sin(i))
          , r = SIMD.Float32x4.splat(Math.cos(i));
        e !== t && (t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]);
        var a = SIMD.Float32x4.load(e, 4)
          , s = SIMD.Float32x4.load(e, 8);
        return SIMD.Float32x4.store(t, 4, SIMD.Float32x4.add(SIMD.Float32x4.mul(a, r), SIMD.Float32x4.mul(s, n))),
        SIMD.Float32x4.store(t, 8, SIMD.Float32x4.sub(SIMD.Float32x4.mul(s, r), SIMD.Float32x4.mul(a, n))),
        t
    }
    ,
    r.rotateX = n.USE_SIMD ? r.SIMD.rotateX : r.scalar.rotateX,
    r.scalar.rotateY = function(t, e, i) {
        var n = Math.sin(i)
          , r = Math.cos(i)
          , a = e[0]
          , s = e[1]
          , o = e[2]
          , u = e[3]
          , l = e[8]
          , c = e[9]
          , h = e[10]
          , d = e[11];
        return e !== t && (t[4] = e[4],
        t[5] = e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]),
        t[0] = a * r - l * n,
        t[1] = s * r - c * n,
        t[2] = o * r - h * n,
        t[3] = u * r - d * n,
        t[8] = a * n + l * r,
        t[9] = s * n + c * r,
        t[10] = o * n + h * r,
        t[11] = u * n + d * r,
        t
    }
    ,
    r.SIMD.rotateY = function(t, e, i) {
        var n = SIMD.Float32x4.splat(Math.sin(i))
          , r = SIMD.Float32x4.splat(Math.cos(i));
        e !== t && (t[4] = e[4],
        t[5] = e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]);
        var a = SIMD.Float32x4.load(e, 0)
          , s = SIMD.Float32x4.load(e, 8);
        return SIMD.Float32x4.store(t, 0, SIMD.Float32x4.sub(SIMD.Float32x4.mul(a, r), SIMD.Float32x4.mul(s, n))),
        SIMD.Float32x4.store(t, 8, SIMD.Float32x4.add(SIMD.Float32x4.mul(a, n), SIMD.Float32x4.mul(s, r))),
        t
    }
    ,
    r.rotateY = n.USE_SIMD ? r.SIMD.rotateY : r.scalar.rotateY,
    r.scalar.rotateZ = function(t, e, i) {
        var n = Math.sin(i)
          , r = Math.cos(i)
          , a = e[0]
          , s = e[1]
          , o = e[2]
          , u = e[3]
          , l = e[4]
          , c = e[5]
          , h = e[6]
          , d = e[7];
        return e !== t && (t[8] = e[8],
        t[9] = e[9],
        t[10] = e[10],
        t[11] = e[11],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]),
        t[0] = a * r + l * n,
        t[1] = s * r + c * n,
        t[2] = o * r + h * n,
        t[3] = u * r + d * n,
        t[4] = l * r - a * n,
        t[5] = c * r - s * n,
        t[6] = h * r - o * n,
        t[7] = d * r - u * n,
        t
    }
    ,
    r.SIMD.rotateZ = function(t, e, i) {
        var n = SIMD.Float32x4.splat(Math.sin(i))
          , r = SIMD.Float32x4.splat(Math.cos(i));
        e !== t && (t[8] = e[8],
        t[9] = e[9],
        t[10] = e[10],
        t[11] = e[11],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]);
        var a = SIMD.Float32x4.load(e, 0)
          , s = SIMD.Float32x4.load(e, 4);
        return SIMD.Float32x4.store(t, 0, SIMD.Float32x4.add(SIMD.Float32x4.mul(a, r), SIMD.Float32x4.mul(s, n))),
        SIMD.Float32x4.store(t, 4, SIMD.Float32x4.sub(SIMD.Float32x4.mul(s, r), SIMD.Float32x4.mul(a, n))),
        t
    }
    ,
    r.rotateZ = n.USE_SIMD ? r.SIMD.rotateZ : r.scalar.rotateZ,
    r.fromTranslation = function(t, e) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = 1,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = 1,
        t[11] = 0,
        t[12] = e[0],
        t[13] = e[1],
        t[14] = e[2],
        t[15] = 1,
        t
    }
    ,
    r.fromScaling = function(t, e) {
        return t[0] = e[0],
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = e[1],
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = e[2],
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.fromRotation = function(t, e, i) {
        var r, a, s, o = i[0], u = i[1], l = i[2], c = Math.sqrt(o * o + u * u + l * l);
        return Math.abs(c) < n.EPSILON ? null : (c = 1 / c,
        o *= c,
        u *= c,
        l *= c,
        r = Math.sin(e),
        a = Math.cos(e),
        s = 1 - a,
        t[0] = o * o * s + a,
        t[1] = u * o * s + l * r,
        t[2] = l * o * s - u * r,
        t[3] = 0,
        t[4] = o * u * s - l * r,
        t[5] = u * u * s + a,
        t[6] = l * u * s + o * r,
        t[7] = 0,
        t[8] = o * l * s + u * r,
        t[9] = u * l * s - o * r,
        t[10] = l * l * s + a,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t)
    }
    ,
    r.fromXRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = n,
        t[6] = i,
        t[7] = 0,
        t[8] = 0,
        t[9] = -i,
        t[10] = n,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.fromYRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = n,
        t[1] = 0,
        t[2] = -i,
        t[3] = 0,
        t[4] = 0,
        t[5] = 1,
        t[6] = 0,
        t[7] = 0,
        t[8] = i,
        t[9] = 0,
        t[10] = n,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.fromZRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = n,
        t[1] = i,
        t[2] = 0,
        t[3] = 0,
        t[4] = -i,
        t[5] = n,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = 1,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.fromRotationTranslation = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = n + n
          , u = r + r
          , l = a + a
          , c = n * o
          , h = n * u
          , d = n * l
          , p = r * u
          , f = r * l
          , g = a * l
          , m = s * o
          , v = s * u
          , _ = s * l;
        return t[0] = 1 - (p + g),
        t[1] = h + _,
        t[2] = d - v,
        t[3] = 0,
        t[4] = h - _,
        t[5] = 1 - (c + g),
        t[6] = f + m,
        t[7] = 0,
        t[8] = d + v,
        t[9] = f - m,
        t[10] = 1 - (c + p),
        t[11] = 0,
        t[12] = i[0],
        t[13] = i[1],
        t[14] = i[2],
        t[15] = 1,
        t
    }
    ,
    r.getTranslation = function(t, e) {
        return t[0] = e[12],
        t[1] = e[13],
        t[2] = e[14],
        t
    }
    ,
    r.getRotation = function(t, e) {
        var i = e[0] + e[5] + e[10]
          , n = 0;
        return i > 0 ? (n = 2 * Math.sqrt(i + 1),
        t[3] = .25 * n,
        t[0] = (e[6] - e[9]) / n,
        t[1] = (e[8] - e[2]) / n,
        t[2] = (e[1] - e[4]) / n) : e[0] > e[5] & e[0] > e[10] ? (n = 2 * Math.sqrt(1 + e[0] - e[5] - e[10]),
        t[3] = (e[6] - e[9]) / n,
        t[0] = .25 * n,
        t[1] = (e[1] + e[4]) / n,
        t[2] = (e[8] + e[2]) / n) : e[5] > e[10] ? (n = 2 * Math.sqrt(1 + e[5] - e[0] - e[10]),
        t[3] = (e[8] - e[2]) / n,
        t[0] = (e[1] + e[4]) / n,
        t[1] = .25 * n,
        t[2] = (e[6] + e[9]) / n) : (n = 2 * Math.sqrt(1 + e[10] - e[0] - e[5]),
        t[3] = (e[1] - e[4]) / n,
        t[0] = (e[8] + e[2]) / n,
        t[1] = (e[6] + e[9]) / n,
        t[2] = .25 * n),
        t
    }
    ,
    r.fromRotationTranslationScale = function(t, e, i, n) {
        var r = e[0]
          , a = e[1]
          , s = e[2]
          , o = e[3]
          , u = r + r
          , l = a + a
          , c = s + s
          , h = r * u
          , d = r * l
          , p = r * c
          , f = a * l
          , g = a * c
          , m = s * c
          , v = o * u
          , _ = o * l
          , b = o * c
          , x = n[0]
          , A = n[1]
          , y = n[2];
        return t[0] = (1 - (f + m)) * x,
        t[1] = (d + b) * x,
        t[2] = (p - _) * x,
        t[3] = 0,
        t[4] = (d - b) * A,
        t[5] = (1 - (h + m)) * A,
        t[6] = (g + v) * A,
        t[7] = 0,
        t[8] = (p + _) * y,
        t[9] = (g - v) * y,
        t[10] = (1 - (h + f)) * y,
        t[11] = 0,
        t[12] = i[0],
        t[13] = i[1],
        t[14] = i[2],
        t[15] = 1,
        t
    }
    ,
    r.fromRotationTranslationScaleOrigin = function(t, e, i, n, r) {
        var a = e[0]
          , s = e[1]
          , o = e[2]
          , u = e[3]
          , l = a + a
          , c = s + s
          , h = o + o
          , d = a * l
          , p = a * c
          , f = a * h
          , g = s * c
          , m = s * h
          , v = o * h
          , _ = u * l
          , b = u * c
          , x = u * h
          , A = n[0]
          , y = n[1]
          , S = n[2]
          , C = r[0]
          , M = r[1]
          , w = r[2];
        return t[0] = (1 - (g + v)) * A,
        t[1] = (p + x) * A,
        t[2] = (f - b) * A,
        t[3] = 0,
        t[4] = (p - x) * y,
        t[5] = (1 - (d + v)) * y,
        t[6] = (m + _) * y,
        t[7] = 0,
        t[8] = (f + b) * S,
        t[9] = (m - _) * S,
        t[10] = (1 - (d + g)) * S,
        t[11] = 0,
        t[12] = i[0] + C - (t[0] * C + t[4] * M + t[8] * w),
        t[13] = i[1] + M - (t[1] * C + t[5] * M + t[9] * w),
        t[14] = i[2] + w - (t[2] * C + t[6] * M + t[10] * w),
        t[15] = 1,
        t
    }
    ,
    r.fromQuat = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = i + i
          , o = n + n
          , u = r + r
          , l = i * s
          , c = n * s
          , h = n * o
          , d = r * s
          , p = r * o
          , f = r * u
          , g = a * s
          , m = a * o
          , v = a * u;
        return t[0] = 1 - h - f,
        t[1] = c + v,
        t[2] = d - m,
        t[3] = 0,
        t[4] = c - v,
        t[5] = 1 - l - f,
        t[6] = p + g,
        t[7] = 0,
        t[8] = d + m,
        t[9] = p - g,
        t[10] = 1 - l - h,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.frustum = function(t, e, i, n, r, a, s) {
        var o = 1 / (i - e)
          , u = 1 / (r - n)
          , l = 1 / (a - s);
        return t[0] = 2 * a * o,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = 2 * a * u,
        t[6] = 0,
        t[7] = 0,
        t[8] = (i + e) * o,
        t[9] = (r + n) * u,
        t[10] = (s + a) * l,
        t[11] = -1,
        t[12] = 0,
        t[13] = 0,
        t[14] = s * a * 2 * l,
        t[15] = 0,
        t
    }
    ,
    r.perspective = function(t, e, i, n, r) {
        var a = 1 / Math.tan(e / 2)
          , s = 1 / (n - r);
        return t[0] = a / i,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = a,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = (r + n) * s,
        t[11] = -1,
        t[12] = 0,
        t[13] = 0,
        t[14] = 2 * r * n * s,
        t[15] = 0,
        t
    }
    ,
    r.perspectiveFromFieldOfView = function(t, e, i, n) {
        var r = Math.tan(e.upDegrees * Math.PI / 180)
          , a = Math.tan(e.downDegrees * Math.PI / 180)
          , s = Math.tan(e.leftDegrees * Math.PI / 180)
          , o = Math.tan(e.rightDegrees * Math.PI / 180)
          , u = 2 / (s + o)
          , l = 2 / (r + a);
        return t[0] = u,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = l,
        t[6] = 0,
        t[7] = 0,
        t[8] = -((s - o) * u * .5),
        t[9] = (r - a) * l * .5,
        t[10] = n / (i - n),
        t[11] = -1,
        t[12] = 0,
        t[13] = 0,
        t[14] = n * i / (i - n),
        t[15] = 0,
        t
    }
    ,
    r.ortho = function(t, e, i, n, r, a, s) {
        var o = 1 / (e - i)
          , u = 1 / (n - r)
          , l = 1 / (a - s);
        return t[0] = -2 * o,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = -2 * u,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = 2 * l,
        t[11] = 0,
        t[12] = (e + i) * o,
        t[13] = (r + n) * u,
        t[14] = (s + a) * l,
        t[15] = 1,
        t
    }
    ,
    r.lookAt = function(t, e, i, a) {
        var s, o, u, l, c, h, d, p, f, g, m = e[0], v = e[1], _ = e[2], b = a[0], x = a[1], A = a[2], y = i[0], S = i[1], C = i[2];
        return Math.abs(m - y) < n.EPSILON && Math.abs(v - S) < n.EPSILON && Math.abs(_ - C) < n.EPSILON ? r.identity(t) : (d = m - y,
        p = v - S,
        f = _ - C,
        g = 1 / Math.sqrt(d * d + p * p + f * f),
        d *= g,
        p *= g,
        f *= g,
        s = x * f - A * p,
        o = A * d - b * f,
        u = b * p - x * d,
        g = Math.sqrt(s * s + o * o + u * u),
        g ? (g = 1 / g,
        s *= g,
        o *= g,
        u *= g) : (s = 0,
        o = 0,
        u = 0),
        l = p * u - f * o,
        c = f * s - d * u,
        h = d * o - p * s,
        g = Math.sqrt(l * l + c * c + h * h),
        g ? (g = 1 / g,
        l *= g,
        c *= g,
        h *= g) : (l = 0,
        c = 0,
        h = 0),
        t[0] = s,
        t[1] = l,
        t[2] = d,
        t[3] = 0,
        t[4] = o,
        t[5] = c,
        t[6] = p,
        t[7] = 0,
        t[8] = u,
        t[9] = h,
        t[10] = f,
        t[11] = 0,
        t[12] = -(s * m + o * v + u * _),
        t[13] = -(l * m + c * v + h * _),
        t[14] = -(d * m + p * v + f * _),
        t[15] = 1,
        t)
    }
    ,
    r.str = function(t) {
        return "mat4(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ", " + t[4] + ", " + t[5] + ", " + t[6] + ", " + t[7] + ", " + t[8] + ", " + t[9] + ", " + t[10] + ", " + t[11] + ", " + t[12] + ", " + t[13] + ", " + t[14] + ", " + t[15] + ")"
    }
    ,
    r.frob = function(t) {
        return Math.sqrt(Math.pow(t[0], 2) + Math.pow(t[1], 2) + Math.pow(t[2], 2) + Math.pow(t[3], 2) + Math.pow(t[4], 2) + Math.pow(t[5], 2) + Math.pow(t[6], 2) + Math.pow(t[7], 2) + Math.pow(t[8], 2) + Math.pow(t[9], 2) + Math.pow(t[10], 2) + Math.pow(t[11], 2) + Math.pow(t[12], 2) + Math.pow(t[13], 2) + Math.pow(t[14], 2) + Math.pow(t[15], 2))
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t[3] = e[3] + i[3],
        t[4] = e[4] + i[4],
        t[5] = e[5] + i[5],
        t[6] = e[6] + i[6],
        t[7] = e[7] + i[7],
        t[8] = e[8] + i[8],
        t[9] = e[9] + i[9],
        t[10] = e[10] + i[10],
        t[11] = e[11] + i[11],
        t[12] = e[12] + i[12],
        t[13] = e[13] + i[13],
        t[14] = e[14] + i[14],
        t[15] = e[15] + i[15],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t[3] = e[3] - i[3],
        t[4] = e[4] - i[4],
        t[5] = e[5] - i[5],
        t[6] = e[6] - i[6],
        t[7] = e[7] - i[7],
        t[8] = e[8] - i[8],
        t[9] = e[9] - i[9],
        t[10] = e[10] - i[10],
        t[11] = e[11] - i[11],
        t[12] = e[12] - i[12],
        t[13] = e[13] - i[13],
        t[14] = e[14] - i[14],
        t[15] = e[15] - i[15],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiplyScalar = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t[3] = e[3] * i,
        t[4] = e[4] * i,
        t[5] = e[5] * i,
        t[6] = e[6] * i,
        t[7] = e[7] * i,
        t[8] = e[8] * i,
        t[9] = e[9] * i,
        t[10] = e[10] * i,
        t[11] = e[11] * i,
        t[12] = e[12] * i,
        t[13] = e[13] * i,
        t[14] = e[14] * i,
        t[15] = e[15] * i,
        t
    }
    ,
    r.multiplyScalarAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t[3] = e[3] + i[3] * n,
        t[4] = e[4] + i[4] * n,
        t[5] = e[5] + i[5] * n,
        t[6] = e[6] + i[6] * n,
        t[7] = e[7] + i[7] * n,
        t[8] = e[8] + i[8] * n,
        t[9] = e[9] + i[9] * n,
        t[10] = e[10] + i[10] * n,
        t[11] = e[11] + i[11] * n,
        t[12] = e[12] + i[12] * n,
        t[13] = e[13] + i[13] * n,
        t[14] = e[14] + i[14] * n,
        t[15] = e[15] + i[15] * n,
        t
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3] && t[4] === e[4] && t[5] === e[5] && t[6] === e[6] && t[7] === e[7] && t[8] === e[8] && t[9] === e[9] && t[10] === e[10] && t[11] === e[11] && t[12] === e[12] && t[13] === e[13] && t[14] === e[14] && t[15] === e[15]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = t[3]
          , o = t[4]
          , u = t[5]
          , l = t[6]
          , c = t[7]
          , h = t[8]
          , d = t[9]
          , p = t[10]
          , f = t[11]
          , g = t[12]
          , m = t[13]
          , v = t[14]
          , _ = t[15]
          , b = e[0]
          , x = e[1]
          , A = e[2]
          , y = e[3]
          , S = e[4]
          , C = e[5]
          , M = e[6]
          , w = e[7]
          , T = e[8]
          , E = e[9]
          , I = e[10]
          , k = e[11]
          , F = e[12]
          , D = e[13]
          , N = e[14]
          , R = e[15];
        return Math.abs(i - b) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(b)) && Math.abs(r - x) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(x)) && Math.abs(a - A) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(A)) && Math.abs(s - y) <= n.EPSILON * Math.max(1, Math.abs(s), Math.abs(y)) && Math.abs(o - S) <= n.EPSILON * Math.max(1, Math.abs(o), Math.abs(S)) && Math.abs(u - C) <= n.EPSILON * Math.max(1, Math.abs(u), Math.abs(C)) && Math.abs(l - M) <= n.EPSILON * Math.max(1, Math.abs(l), Math.abs(M)) && Math.abs(c - w) <= n.EPSILON * Math.max(1, Math.abs(c), Math.abs(w)) && Math.abs(h - T) <= n.EPSILON * Math.max(1, Math.abs(h), Math.abs(T)) && Math.abs(d - E) <= n.EPSILON * Math.max(1, Math.abs(d), Math.abs(E)) && Math.abs(p - I) <= n.EPSILON * Math.max(1, Math.abs(p), Math.abs(I)) && Math.abs(f - k) <= n.EPSILON * Math.max(1, Math.abs(f), Math.abs(k)) && Math.abs(g - F) <= n.EPSILON * Math.max(1, Math.abs(g), Math.abs(F)) && Math.abs(m - D) <= n.EPSILON * Math.max(1, Math.abs(m), Math.abs(D)) && Math.abs(v - N) <= n.EPSILON * Math.max(1, Math.abs(v), Math.abs(N)) && Math.abs(_ - R) <= n.EPSILON * Math.max(1, Math.abs(_), Math.abs(R))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(1215)
      , r = i(1218)
      , a = i(1221)
      , s = i(1222)
      , o = {};
    o.create = function() {
        var t = new n.ARRAY_TYPE(4);
        return t[0] = 0,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t
    }
    ,
    o.rotationTo = function() {
        var t = a.create()
          , e = a.fromValues(1, 0, 0)
          , i = a.fromValues(0, 1, 0);
        return function(n, r, s) {
            var u = a.dot(r, s);
            return u < -.999999 ? (a.cross(t, e, r),
            a.length(t) < 1e-6 && a.cross(t, i, r),
            a.normalize(t, t),
            o.setAxisAngle(n, t, Math.PI),
            n) : u > .999999 ? (n[0] = 0,
            n[1] = 0,
            n[2] = 0,
            n[3] = 1,
            n) : (a.cross(t, r, s),
            n[0] = t[0],
            n[1] = t[1],
            n[2] = t[2],
            n[3] = 1 + u,
            o.normalize(n, n))
        }
    }(),
    o.setAxes = function() {
        var t = r.create();
        return function(e, i, n, r) {
            return t[0] = n[0],
            t[3] = n[1],
            t[6] = n[2],
            t[1] = r[0],
            t[4] = r[1],
            t[7] = r[2],
            t[2] = -i[0],
            t[5] = -i[1],
            t[8] = -i[2],
            o.normalize(e, o.fromMat3(e, t))
        }
    }(),
    o.clone = s.clone,
    o.fromValues = s.fromValues,
    o.copy = s.copy,
    o.set = s.set,
    o.identity = function(t) {
        return t[0] = 0,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t
    }
    ,
    o.setAxisAngle = function(t, e, i) {
        i = .5 * i;
        var n = Math.sin(i);
        return t[0] = n * e[0],
        t[1] = n * e[1],
        t[2] = n * e[2],
        t[3] = Math.cos(i),
        t
    }
    ,
    o.getAxisAngle = function(t, e) {
        var i = 2 * Math.acos(e[3])
          , n = Math.sin(i / 2);
        return 0 != n ? (t[0] = e[0] / n,
        t[1] = e[1] / n,
        t[2] = e[2] / n) : (t[0] = 1,
        t[1] = 0,
        t[2] = 0),
        i
    }
    ,
    o.add = s.add,
    o.multiply = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = i[0]
          , u = i[1]
          , l = i[2]
          , c = i[3];
        return t[0] = n * c + s * o + r * l - a * u,
        t[1] = r * c + s * u + a * o - n * l,
        t[2] = a * c + s * l + n * u - r * o,
        t[3] = s * c - n * o - r * u - a * l,
        t
    }
    ,
    o.mul = o.multiply,
    o.scale = s.scale,
    o.rotateX = function(t, e, i) {
        i *= .5;
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = Math.sin(i)
          , u = Math.cos(i);
        return t[0] = n * u + s * o,
        t[1] = r * u + a * o,
        t[2] = a * u - r * o,
        t[3] = s * u - n * o,
        t
    }
    ,
    o.rotateY = function(t, e, i) {
        i *= .5;
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = Math.sin(i)
          , u = Math.cos(i);
        return t[0] = n * u - a * o,
        t[1] = r * u + s * o,
        t[2] = a * u + n * o,
        t[3] = s * u - r * o,
        t
    }
    ,
    o.rotateZ = function(t, e, i) {
        i *= .5;
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = Math.sin(i)
          , u = Math.cos(i);
        return t[0] = n * u + r * o,
        t[1] = r * u - n * o,
        t[2] = a * u + s * o,
        t[3] = s * u - a * o,
        t
    }
    ,
    o.calculateW = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2];
        return t[0] = i,
        t[1] = n,
        t[2] = r,
        t[3] = Math.sqrt(Math.abs(1 - i * i - n * n - r * r)),
        t
    }
    ,
    o.dot = s.dot,
    o.lerp = s.lerp,
    o.slerp = function(t, e, i, n) {
        var r, a, s, o, u, l = e[0], c = e[1], h = e[2], d = e[3], p = i[0], f = i[1], g = i[2], m = i[3];
        return a = l * p + c * f + h * g + d * m,
        a < 0 && (a = -a,
        p = -p,
        f = -f,
        g = -g,
        m = -m),
        1 - a > 1e-6 ? (r = Math.acos(a),
        s = Math.sin(r),
        o = Math.sin((1 - n) * r) / s,
        u = Math.sin(n * r) / s) : (o = 1 - n,
        u = n),
        t[0] = o * l + u * p,
        t[1] = o * c + u * f,
        t[2] = o * h + u * g,
        t[3] = o * d + u * m,
        t
    }
    ,
    o.sqlerp = function() {
        var t = o.create()
          , e = o.create();
        return function(i, n, r, a, s, u) {
            return o.slerp(t, n, s, u),
            o.slerp(e, r, a, u),
            o.slerp(i, t, e, 2 * u * (1 - u)),
            i
        }
    }(),
    o.invert = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = i * i + n * n + r * r + a * a
          , o = s ? 1 / s : 0;
        return t[0] = -i * o,
        t[1] = -n * o,
        t[2] = -r * o,
        t[3] = a * o,
        t
    }
    ,
    o.conjugate = function(t, e) {
        return t[0] = -e[0],
        t[1] = -e[1],
        t[2] = -e[2],
        t[3] = e[3],
        t
    }
    ,
    o.length = s.length,
    o.len = o.length,
    o.squaredLength = s.squaredLength,
    o.sqrLen = o.squaredLength,
    o.normalize = s.normalize,
    o.fromMat3 = function(t, e) {
        var i, n = e[0] + e[4] + e[8];
        if (n > 0)
            i = Math.sqrt(n + 1),
            t[3] = .5 * i,
            i = .5 / i,
            t[0] = (e[5] - e[7]) * i,
            t[1] = (e[6] - e[2]) * i,
            t[2] = (e[1] - e[3]) * i;
        else {
            var r = 0;
            e[4] > e[0] && (r = 1),
            e[8] > e[3 * r + r] && (r = 2);
            var a = (r + 1) % 3
              , s = (r + 2) % 3;
            i = Math.sqrt(e[3 * r + r] - e[3 * a + a] - e[3 * s + s] + 1),
            t[r] = .5 * i,
            i = .5 / i,
            t[3] = (e[3 * a + s] - e[3 * s + a]) * i,
            t[a] = (e[3 * a + r] + e[3 * r + a]) * i,
            t[s] = (e[3 * s + r] + e[3 * r + s]) * i
        }
        return t
    }
    ,
    o.str = function(t) {
        return "quat(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ")"
    }
    ,
    o.exactEquals = s.exactEquals,
    o.equals = s.equals,
    t.exports = o
}
, function(t, e, i) {
    var n = i(1215)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(3);
        return t[0] = 0,
        t[1] = 0,
        t[2] = 0,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(3);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e
    }
    ,
    r.fromValues = function(t, e, i) {
        var r = new n.ARRAY_TYPE(3);
        return r[0] = t,
        r[1] = e,
        r[2] = i,
        r
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t
    }
    ,
    r.set = function(t, e, i, n) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiply = function(t, e, i) {
        return t[0] = e[0] * i[0],
        t[1] = e[1] * i[1],
        t[2] = e[2] * i[2],
        t
    }
    ,
    r.mul = r.multiply,
    r.divide = function(t, e, i) {
        return t[0] = e[0] / i[0],
        t[1] = e[1] / i[1],
        t[2] = e[2] / i[2],
        t
    }
    ,
    r.div = r.divide,
    r.ceil = function(t, e) {
        return t[0] = Math.ceil(e[0]),
        t[1] = Math.ceil(e[1]),
        t[2] = Math.ceil(e[2]),
        t
    }
    ,
    r.floor = function(t, e) {
        return t[0] = Math.floor(e[0]),
        t[1] = Math.floor(e[1]),
        t[2] = Math.floor(e[2]),
        t
    }
    ,
    r.min = function(t, e, i) {
        return t[0] = Math.min(e[0], i[0]),
        t[1] = Math.min(e[1], i[1]),
        t[2] = Math.min(e[2], i[2]),
        t
    }
    ,
    r.max = function(t, e, i) {
        return t[0] = Math.max(e[0], i[0]),
        t[1] = Math.max(e[1], i[1]),
        t[2] = Math.max(e[2], i[2]),
        t
    }
    ,
    r.round = function(t, e) {
        return t[0] = Math.round(e[0]),
        t[1] = Math.round(e[1]),
        t[2] = Math.round(e[2]),
        t
    }
    ,
    r.scale = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t
    }
    ,
    r.scaleAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t
    }
    ,
    r.distance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1]
          , r = e[2] - t[2];
        return Math.sqrt(i * i + n * n + r * r)
    }
    ,
    r.dist = r.distance,
    r.squaredDistance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1]
          , r = e[2] - t[2];
        return i * i + n * n + r * r
    }
    ,
    r.sqrDist = r.squaredDistance,
    r.length = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2];
        return Math.sqrt(e * e + i * i + n * n)
    }
    ,
    r.len = r.length,
    r.squaredLength = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2];
        return e * e + i * i + n * n
    }
    ,
    r.sqrLen = r.squaredLength,
    r.negate = function(t, e) {
        return t[0] = -e[0],
        t[1] = -e[1],
        t[2] = -e[2],
        t
    }
    ,
    r.inverse = function(t, e) {
        return t[0] = 1 / e[0],
        t[1] = 1 / e[1],
        t[2] = 1 / e[2],
        t
    }
    ,
    r.normalize = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = i * i + n * n + r * r;
        return a > 0 && (a = 1 / Math.sqrt(a),
        t[0] = e[0] * a,
        t[1] = e[1] * a,
        t[2] = e[2] * a),
        t
    }
    ,
    r.dot = function(t, e) {
        return t[0] * e[0] + t[1] * e[1] + t[2] * e[2]
    }
    ,
    r.cross = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = i[0]
          , o = i[1]
          , u = i[2];
        return t[0] = r * u - a * o,
        t[1] = a * s - n * u,
        t[2] = n * o - r * s,
        t
    }
    ,
    r.lerp = function(t, e, i, n) {
        var r = e[0]
          , a = e[1]
          , s = e[2];
        return t[0] = r + n * (i[0] - r),
        t[1] = a + n * (i[1] - a),
        t[2] = s + n * (i[2] - s),
        t
    }
    ,
    r.hermite = function(t, e, i, n, r, a) {
        var s = a * a
          , o = s * (2 * a - 3) + 1
          , u = s * (a - 2) + a
          , l = s * (a - 1)
          , c = s * (3 - 2 * a);
        return t[0] = e[0] * o + i[0] * u + n[0] * l + r[0] * c,
        t[1] = e[1] * o + i[1] * u + n[1] * l + r[1] * c,
        t[2] = e[2] * o + i[2] * u + n[2] * l + r[2] * c,
        t
    }
    ,
    r.bezier = function(t, e, i, n, r, a) {
        var s = 1 - a
          , o = s * s
          , u = a * a
          , l = o * s
          , c = 3 * a * o
          , h = 3 * u * s
          , d = u * a;
        return t[0] = e[0] * l + i[0] * c + n[0] * h + r[0] * d,
        t[1] = e[1] * l + i[1] * c + n[1] * h + r[1] * d,
        t[2] = e[2] * l + i[2] * c + n[2] * h + r[2] * d,
        t
    }
    ,
    r.random = function(t, e) {
        e = e || 1;
        var i = 2 * n.RANDOM() * Math.PI
          , r = 2 * n.RANDOM() - 1
          , a = Math.sqrt(1 - r * r) * e;
        return t[0] = Math.cos(i) * a,
        t[1] = Math.sin(i) * a,
        t[2] = r * e,
        t
    }
    ,
    r.transformMat4 = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = i[3] * n + i[7] * r + i[11] * a + i[15];
        return s = s || 1,
        t[0] = (i[0] * n + i[4] * r + i[8] * a + i[12]) / s,
        t[1] = (i[1] * n + i[5] * r + i[9] * a + i[13]) / s,
        t[2] = (i[2] * n + i[6] * r + i[10] * a + i[14]) / s,
        t
    }
    ,
    r.transformMat3 = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2];
        return t[0] = n * i[0] + r * i[3] + a * i[6],
        t[1] = n * i[1] + r * i[4] + a * i[7],
        t[2] = n * i[2] + r * i[5] + a * i[8],
        t
    }
    ,
    r.transformQuat = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = i[0]
          , o = i[1]
          , u = i[2]
          , l = i[3]
          , c = l * n + o * a - u * r
          , h = l * r + u * n - s * a
          , d = l * a + s * r - o * n
          , p = -s * n - o * r - u * a;
        return t[0] = c * l + p * -s + h * -u - d * -o,
        t[1] = h * l + p * -o + d * -s - c * -u,
        t[2] = d * l + p * -u + c * -o - h * -s,
        t
    }
    ,
    r.rotateX = function(t, e, i, n) {
        var r = []
          , a = [];
        return r[0] = e[0] - i[0],
        r[1] = e[1] - i[1],
        r[2] = e[2] - i[2],
        a[0] = r[0],
        a[1] = r[1] * Math.cos(n) - r[2] * Math.sin(n),
        a[2] = r[1] * Math.sin(n) + r[2] * Math.cos(n),
        t[0] = a[0] + i[0],
        t[1] = a[1] + i[1],
        t[2] = a[2] + i[2],
        t
    }
    ,
    r.rotateY = function(t, e, i, n) {
        var r = []
          , a = [];
        return r[0] = e[0] - i[0],
        r[1] = e[1] - i[1],
        r[2] = e[2] - i[2],
        a[0] = r[2] * Math.sin(n) + r[0] * Math.cos(n),
        a[1] = r[1],
        a[2] = r[2] * Math.cos(n) - r[0] * Math.sin(n),
        t[0] = a[0] + i[0],
        t[1] = a[1] + i[1],
        t[2] = a[2] + i[2],
        t
    }
    ,
    r.rotateZ = function(t, e, i, n) {
        var r = []
          , a = [];
        return r[0] = e[0] - i[0],
        r[1] = e[1] - i[1],
        r[2] = e[2] - i[2],
        a[0] = r[0] * Math.cos(n) - r[1] * Math.sin(n),
        a[1] = r[0] * Math.sin(n) + r[1] * Math.cos(n),
        a[2] = r[2],
        t[0] = a[0] + i[0],
        t[1] = a[1] + i[1],
        t[2] = a[2] + i[2],
        t
    }
    ,
    r.forEach = function() {
        var t = r.create();
        return function(e, i, n, r, a, s) {
            var o, u;
            for (i || (i = 3),
            n || (n = 0),
            u = r ? Math.min(r * i + n, e.length) : e.length,
            o = n; o < u; o += i)
                t[0] = e[o],
                t[1] = e[o + 1],
                t[2] = e[o + 2],
                a(t, t, s),
                e[o] = t[0],
                e[o + 1] = t[1],
                e[o + 2] = t[2];
            return e
        }
    }(),
    r.angle = function(t, e) {
        var i = r.fromValues(t[0], t[1], t[2])
          , n = r.fromValues(e[0], e[1], e[2]);
        r.normalize(i, i),
        r.normalize(n, n);
        var a = r.dot(i, n);
        return a > 1 ? 0 : Math.acos(a)
    }
    ,
    r.str = function(t) {
        return "vec3(" + t[0] + ", " + t[1] + ", " + t[2] + ")"
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = e[0]
          , o = e[1]
          , u = e[2];
        return Math.abs(i - s) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(s)) && Math.abs(r - o) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(o)) && Math.abs(a - u) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(u))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(1215)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(4);
        return t[0] = 0,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(4);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        e
    }
    ,
    r.fromValues = function(t, e, i, r) {
        var a = new n.ARRAY_TYPE(4);
        return a[0] = t,
        a[1] = e,
        a[2] = i,
        a[3] = r,
        a
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t
    }
    ,
    r.set = function(t, e, i, n, r) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t[3] = r,
        t
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t[3] = e[3] + i[3],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t[3] = e[3] - i[3],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiply = function(t, e, i) {
        return t[0] = e[0] * i[0],
        t[1] = e[1] * i[1],
        t[2] = e[2] * i[2],
        t[3] = e[3] * i[3],
        t
    }
    ,
    r.mul = r.multiply,
    r.divide = function(t, e, i) {
        return t[0] = e[0] / i[0],
        t[1] = e[1] / i[1],
        t[2] = e[2] / i[2],
        t[3] = e[3] / i[3],
        t
    }
    ,
    r.div = r.divide,
    r.ceil = function(t, e) {
        return t[0] = Math.ceil(e[0]),
        t[1] = Math.ceil(e[1]),
        t[2] = Math.ceil(e[2]),
        t[3] = Math.ceil(e[3]),
        t
    }
    ,
    r.floor = function(t, e) {
        return t[0] = Math.floor(e[0]),
        t[1] = Math.floor(e[1]),
        t[2] = Math.floor(e[2]),
        t[3] = Math.floor(e[3]),
        t
    }
    ,
    r.min = function(t, e, i) {
        return t[0] = Math.min(e[0], i[0]),
        t[1] = Math.min(e[1], i[1]),
        t[2] = Math.min(e[2], i[2]),
        t[3] = Math.min(e[3], i[3]),
        t
    }
    ,
    r.max = function(t, e, i) {
        return t[0] = Math.max(e[0], i[0]),
        t[1] = Math.max(e[1], i[1]),
        t[2] = Math.max(e[2], i[2]),
        t[3] = Math.max(e[3], i[3]),
        t
    }
    ,
    r.round = function(t, e) {
        return t[0] = Math.round(e[0]),
        t[1] = Math.round(e[1]),
        t[2] = Math.round(e[2]),
        t[3] = Math.round(e[3]),
        t
    }
    ,
    r.scale = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t[3] = e[3] * i,
        t
    }
    ,
    r.scaleAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t[3] = e[3] + i[3] * n,
        t
    }
    ,
    r.distance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1]
          , r = e[2] - t[2]
          , a = e[3] - t[3];
        return Math.sqrt(i * i + n * n + r * r + a * a)
    }
    ,
    r.dist = r.distance,
    r.squaredDistance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1]
          , r = e[2] - t[2]
          , a = e[3] - t[3];
        return i * i + n * n + r * r + a * a
    }
    ,
    r.sqrDist = r.squaredDistance,
    r.length = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2]
          , r = t[3];
        return Math.sqrt(e * e + i * i + n * n + r * r)
    }
    ,
    r.len = r.length,
    r.squaredLength = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2]
          , r = t[3];
        return e * e + i * i + n * n + r * r
    }
    ,
    r.sqrLen = r.squaredLength,
    r.negate = function(t, e) {
        return t[0] = -e[0],
        t[1] = -e[1],
        t[2] = -e[2],
        t[3] = -e[3],
        t
    }
    ,
    r.inverse = function(t, e) {
        return t[0] = 1 / e[0],
        t[1] = 1 / e[1],
        t[2] = 1 / e[2],
        t[3] = 1 / e[3],
        t
    }
    ,
    r.normalize = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = i * i + n * n + r * r + a * a;
        return s > 0 && (s = 1 / Math.sqrt(s),
        t[0] = i * s,
        t[1] = n * s,
        t[2] = r * s,
        t[3] = a * s),
        t
    }
    ,
    r.dot = function(t, e) {
        return t[0] * e[0] + t[1] * e[1] + t[2] * e[2] + t[3] * e[3]
    }
    ,
    r.lerp = function(t, e, i, n) {
        var r = e[0]
          , a = e[1]
          , s = e[2]
          , o = e[3];
        return t[0] = r + n * (i[0] - r),
        t[1] = a + n * (i[1] - a),
        t[2] = s + n * (i[2] - s),
        t[3] = o + n * (i[3] - o),
        t
    }
    ,
    r.random = function(t, e) {
        return e = e || 1,
        t[0] = n.RANDOM(),
        t[1] = n.RANDOM(),
        t[2] = n.RANDOM(),
        t[3] = n.RANDOM(),
        r.normalize(t, t),
        r.scale(t, t, e),
        t
    }
    ,
    r.transformMat4 = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3];
        return t[0] = i[0] * n + i[4] * r + i[8] * a + i[12] * s,
        t[1] = i[1] * n + i[5] * r + i[9] * a + i[13] * s,
        t[2] = i[2] * n + i[6] * r + i[10] * a + i[14] * s,
        t[3] = i[3] * n + i[7] * r + i[11] * a + i[15] * s,
        t
    }
    ,
    r.transformQuat = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = i[0]
          , o = i[1]
          , u = i[2]
          , l = i[3]
          , c = l * n + o * a - u * r
          , h = l * r + u * n - s * a
          , d = l * a + s * r - o * n
          , p = -s * n - o * r - u * a;
        return t[0] = c * l + p * -s + h * -u - d * -o,
        t[1] = h * l + p * -o + d * -s - c * -u,
        t[2] = d * l + p * -u + c * -o - h * -s,
        t[3] = e[3],
        t
    }
    ,
    r.forEach = function() {
        var t = r.create();
        return function(e, i, n, r, a, s) {
            var o, u;
            for (i || (i = 4),
            n || (n = 0),
            u = r ? Math.min(r * i + n, e.length) : e.length,
            o = n; o < u; o += i)
                t[0] = e[o],
                t[1] = e[o + 1],
                t[2] = e[o + 2],
                t[3] = e[o + 3],
                a(t, t, s),
                e[o] = t[0],
                e[o + 1] = t[1],
                e[o + 2] = t[2],
                e[o + 3] = t[3];
            return e
        }
    }(),
    r.str = function(t) {
        return "vec4(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ")"
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = t[3]
          , o = e[0]
          , u = e[1]
          , l = e[2]
          , c = e[3];
        return Math.abs(i - o) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(o)) && Math.abs(r - u) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(u)) && Math.abs(a - l) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(l)) && Math.abs(s - c) <= n.EPSILON * Math.max(1, Math.abs(s), Math.abs(c))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(1215)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(2);
        return t[0] = 0,
        t[1] = 0,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(2);
        return e[0] = t[0],
        e[1] = t[1],
        e
    }
    ,
    r.fromValues = function(t, e) {
        var i = new n.ARRAY_TYPE(2);
        return i[0] = t,
        i[1] = e,
        i
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t
    }
    ,
    r.set = function(t, e, i) {
        return t[0] = e,
        t[1] = i,
        t
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiply = function(t, e, i) {
        return t[0] = e[0] * i[0],
        t[1] = e[1] * i[1],
        t
    }
    ,
    r.mul = r.multiply,
    r.divide = function(t, e, i) {
        return t[0] = e[0] / i[0],
        t[1] = e[1] / i[1],
        t
    }
    ,
    r.div = r.divide,
    r.ceil = function(t, e) {
        return t[0] = Math.ceil(e[0]),
        t[1] = Math.ceil(e[1]),
        t
    }
    ,
    r.floor = function(t, e) {
        return t[0] = Math.floor(e[0]),
        t[1] = Math.floor(e[1]),
        t
    }
    ,
    r.min = function(t, e, i) {
        return t[0] = Math.min(e[0], i[0]),
        t[1] = Math.min(e[1], i[1]),
        t
    }
    ,
    r.max = function(t, e, i) {
        return t[0] = Math.max(e[0], i[0]),
        t[1] = Math.max(e[1], i[1]),
        t
    }
    ,
    r.round = function(t, e) {
        return t[0] = Math.round(e[0]),
        t[1] = Math.round(e[1]),
        t
    }
    ,
    r.scale = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t
    }
    ,
    r.scaleAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t
    }
    ,
    r.distance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1];
        return Math.sqrt(i * i + n * n)
    }
    ,
    r.dist = r.distance,
    r.squaredDistance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1];
        return i * i + n * n
    }
    ,
    r.sqrDist = r.squaredDistance,
    r.length = function(t) {
        var e = t[0]
          , i = t[1];
        return Math.sqrt(e * e + i * i)
    }
    ,
    r.len = r.length,
    r.squaredLength = function(t) {
        var e = t[0]
          , i = t[1];
        return e * e + i * i
    }
    ,
    r.sqrLen = r.squaredLength,
    r.negate = function(t, e) {
        return t[0] = -e[0],
        t[1] = -e[1],
        t
    }
    ,
    r.inverse = function(t, e) {
        return t[0] = 1 / e[0],
        t[1] = 1 / e[1],
        t
    }
    ,
    r.normalize = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = i * i + n * n;
        return r > 0 && (r = 1 / Math.sqrt(r),
        t[0] = e[0] * r,
        t[1] = e[1] * r),
        t
    }
    ,
    r.dot = function(t, e) {
        return t[0] * e[0] + t[1] * e[1]
    }
    ,
    r.cross = function(t, e, i) {
        var n = e[0] * i[1] - e[1] * i[0];
        return t[0] = t[1] = 0,
        t[2] = n,
        t
    }
    ,
    r.lerp = function(t, e, i, n) {
        var r = e[0]
          , a = e[1];
        return t[0] = r + n * (i[0] - r),
        t[1] = a + n * (i[1] - a),
        t
    }
    ,
    r.random = function(t, e) {
        e = e || 1;
        var i = 2 * n.RANDOM() * Math.PI;
        return t[0] = Math.cos(i) * e,
        t[1] = Math.sin(i) * e,
        t
    }
    ,
    r.transformMat2 = function(t, e, i) {
        var n = e[0]
          , r = e[1];
        return t[0] = i[0] * n + i[2] * r,
        t[1] = i[1] * n + i[3] * r,
        t
    }
    ,
    r.transformMat2d = function(t, e, i) {
        var n = e[0]
          , r = e[1];
        return t[0] = i[0] * n + i[2] * r + i[4],
        t[1] = i[1] * n + i[3] * r + i[5],
        t
    }
    ,
    r.transformMat3 = function(t, e, i) {
        var n = e[0]
          , r = e[1];
        return t[0] = i[0] * n + i[3] * r + i[6],
        t[1] = i[1] * n + i[4] * r + i[7],
        t
    }
    ,
    r.transformMat4 = function(t, e, i) {
        var n = e[0]
          , r = e[1];
        return t[0] = i[0] * n + i[4] * r + i[12],
        t[1] = i[1] * n + i[5] * r + i[13],
        t
    }
    ,
    r.forEach = function() {
        var t = r.create();
        return function(e, i, n, r, a, s) {
            var o, u;
            for (i || (i = 2),
            n || (n = 0),
            u = r ? Math.min(r * i + n, e.length) : e.length,
            o = n; o < u; o += i)
                t[0] = e[o],
                t[1] = e[o + 1],
                a(t, t, s),
                e[o] = t[0],
                e[o + 1] = t[1];
            return e
        }
    }(),
    r.str = function(t) {
        return "vec2(" + t[0] + ", " + t[1] + ")"
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = e[0]
          , s = e[1];
        return Math.abs(i - a) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(a)) && Math.abs(r - s) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(s))
    }
    ,
    t.exports = r
}
, function(t, e) {
    "use strict";
    t.exports = {
        ArrayType: Float64Array
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1211)
      , r = i(1207)
      , a = i(1212).vec3
      , s = i(1212).mat4
      , o = function() {
        this._center = a.create(),
        this._radius = -1
    };
    o.prototype = {
        init: function() {
            a.init(this._center),
            this._radius = -1
        },
        valid: function() {
            return this._radius >= 0
        },
        set: function(t, e) {
            this._center = t,
            this._radius = e
        },
        center: function() {
            return this._center
        },
        radius: function() {
            return this._radius
        },
        radius2: function() {
            return this._radius * this._radius
        },
        expandByBoundingBox: function() {
            var t = a.create()
              , e = new n;
            return function(i) {
                if (i.valid())
                    if (this.valid()) {
                        a.copy(e._min, i._min),
                        a.copy(e._max, i._max);
                        for (var n = 0; n < 8; n++)
                            a.sub(t, i.corner(n, t), this._center),
                            a.normalize(t, t),
                            a.scaleAndAdd(t, this._center, t, -this._radius),
                            e.expandByvec3(t);
                        e.center(this._center),
                        this._radius = e.radius()
                    } else
                        i.center(this._center),
                        this._radius = i.radius()
            }
        }(),
        expandByBox: function(t) {
            return r.log("BoundingSphere.expandByBox is deprecated, use instead BoundingSphere.expandByBoundingBox"),
            this.expandByBoundingBox(t)
        },
        expandByvec3: function() {
            var t = a.create();
            return function(e) {
                if (this.valid()) {
                    a.sub(t, e, this.center(t));
                    var i = a.length(t);
                    if (i > this.radius()) {
                        var n = .5 * (i - this.radius());
                        this._center[0] += t[0] * (n / i),
                        this._center[1] += t[1] * (n / i),
                        this._center[2] += t[2] * (n / i),
                        this._radius += n
                    }
                } else
                    this._center[0] = e[0],
                    this._center[1] = e[1],
                    this._center[2] = e[2],
                    this._radius = 0
            }
        }(),
        expandRadiusBySphere: function(t) {
            if (t.valid())
                if (this.valid()) {
                    var e = a.distance(this._center, t._center) + t._radius;
                    e > this._radius && (this._radius = e)
                } else
                    a.copy(this._center, t._center),
                    this._radius = t._radius
        },
        expandBy: function(t) {
            r.log("BoundingSphere.expandBy is deprecated, use instead BoundingSphere.expandByBoundingSphere"),
            this.expandByBoundingSphere(t)
        },
        expandByBoundingSphere: function(t) {
            if (t.valid()) {
                if (!this.valid())
                    return this._center[0] = t._center[0],
                    this._center[1] = t._center[1],
                    this._center[2] = t._center[2],
                    void (this._radius = t.radius());
                var e = a.distance(t.center(), this.center());
                if (!(e + t.radius() <= this.radius())) {
                    if (e + this.radius() <= t.radius())
                        return this._center[0] = t._center[0],
                        this._center[1] = t._center[1],
                        this._center[2] = t._center[2],
                        void (this._radius = t._radius);
                    var i = .5 * (this.radius() + e + t.radius())
                      , n = (i - this.radius()) / e;
                    this._center[0] += (t._center[0] - this._center[0]) * n,
                    this._center[1] += (t._center[1] - this._center[1]) * n,
                    this._center[2] += (t._center[2] - this._center[2]) * n,
                    this._radius = i
                }
            }
        },
        contains: function(t) {
            return !!this.valid() && a.sqrDist(this.center(), t) <= this.radius2()
        },
        intersects: function(t) {
            if (!this.valid() || !t.valid())
                return !1;
            var e = this.radius() + t.radius();
            return a.sqrDist(t.center(), this.center()) <= e * e
        },
        transformMat4: function() {
            var t = a.create();
            return function(e, i) {
                if (!this.valid())
                    return e;
                e._center !== this._center && (a.copy(e._center, this._center),
                e._radius = this._radius);
                var n = e._center
                  , r = e._radius;
                s.getSqrScale(t, i);
                var o = Math.sqrt(Math.max(Math.max(t[0], t[1]), t[2]));
                return r *= o,
                e._radius = r,
                a.transformMat4(n, n, i),
                e
            }
        }()
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1227)
      , r = i(1207)
      , a = i(1210)
      , s = i(1228)
      , o = i(1203)
      , u = function() {
        a.call(this),
        this._parents = [],
        this.attributeMap = new n,
        this.textureAttributeMapList = [],
        this._binName = void 0,
        this._binNumber = 0,
        this._shaderGeneratorPair = null,
        this._updateCallbackList = [],
        this.uniforms = new n,
        this._drawID = -1
    };
    u.AttributePair = function(t, e) {
        this._object = t,
        this._value = e
    }
    ,
    u.AttributePair.prototype = {
        getShaderGeneratorName: function() {
            return this._object
        },
        getAttribute: function() {
            return this._object
        },
        getUniform: function() {
            return this._object
        },
        getValue: function() {
            return this._value
        }
    },
    u.prototype = o.objectLibraryClass(o.objectInherit(a.prototype, {
        setDrawID: function(t) {
            this._drawID = t
        },
        getDrawID: function() {
            return this._drawID
        },
        getAttributePair: function(t, e) {
            return new u.AttributePair(t,e)
        },
        addUniform: function(t, e) {
            var i = void 0 !== e ? e : s.ON
              , n = t.getName();
            this.uniforms[n] = this.getAttributePair(t, i),
            this.uniforms.dirty()
        },
        addParent: function(t) {
            this._parents.push(t)
        },
        removeParent: function(t) {
            var e = this._parents.indexOf(t);
            e !== -1 && this._parents.splice(e, 1)
        },
        removeUniform: function(t) {
            this.uniforms.remove(t.getName())
        },
        removeUniformByName: function(t) {
            this.uniforms.remove(t)
        },
        getUniform: function(t) {
            var e = this.uniforms;
            if (e[t])
                return e[t].getAttribute()
        },
        getUniformList: function() {
            return this.uniforms
        },
        setTextureAttributeAndModes: function(t, e, i) {
            var n = void 0 !== i ? i : s.ON;
            this._setTextureAttribute(t, this.getAttributePair(e, n))
        },
        setTextureAttributeAndMode: function(t, e, i) {
            r.log("StateSet.setTextureAttributeAndMode is deprecated, insteady use setTextureAttributeAndModes"),
            this.setTextureAttributeAndModes(t, e, i)
        },
        getNumTextureAttributeLists: function() {
            return this.textureAttributeMapList.length
        },
        getTextureAttribute: function(t, e) {
            if (void 0 !== this.textureAttributeMapList[t]) {
                var i = this.textureAttributeMapList[t];
                if (void 0 !== i[e])
                    return i[e].getAttribute()
            }
        },
        removeTextureAttribute: function(t, e) {
            if (void 0 !== this.textureAttributeMapList[t]) {
                var i = this.textureAttributeMapList[t];
                void 0 !== i[e] && (i.remove(e),
                this.textureAttributeMapList[t].dirty())
            }
        },
        getAttribute: function(t) {
            if (void 0 !== this.attributeMap[t])
                return this.attributeMap[t].getAttribute()
        },
        setAttributeAndModes: function(t, e) {
            var i = void 0 !== e ? e : s.ON;
            this._setAttribute(this.getAttributePair(t, i))
        },
        setAttributeAndMode: function(t, e) {
            r.log("StateSet.setAttributeAndMode is deprecated, insteady use setAttributeAndModes"),
            this.setAttributeAndModes(t, e)
        },
        setAttribute: function(t, e) {
            var i = void 0 !== e ? e : s.ON;
            this._setAttribute(this.getAttributePair(t, i))
        },
        removeAttribute: function(t) {
            void 0 !== this.attributeMap[t] && (delete this.attributeMap[t],
            this.attributeMap.dirty())
        },
        setRenderingHint: function(t) {
            "OPAQUE_BIN" === t ? this.setRenderBinDetails(0, "RenderBin") : "TRANSPARENT_BIN" === t ? this.setRenderBinDetails(10, "DepthSortedBin") : this.setRenderBinDetails(0, "")
        },
        getUpdateCallbackList: function() {
            return this._updateCallbackList
        },
        removeUpdateCallback: function(t) {
            var e = this._updateCallbackList.indexOf(t);
            if (e !== -1 && (this._updateCallbackList.splice(e, 1),
            0 === this._updateCallbackList.length))
                for (var i = this._parents, n = 0, r = i.length; n < r; n++) {
                    var a = i[n];
                    a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal() - 1)
                }
        },
        requiresUpdateTraversal: function() {
            return !!this._updateCallbackList.length
        },
        addUpdateCallback: function(t) {
            var e = Boolean(this._updateCallbackList.length);
            if (this._updateCallbackList.push(t),
            !e)
                for (var i = this._parents, n = 0, r = i.length; n < r; n++) {
                    var a = i[n];
                    a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal() + 1)
                }
        },
        hasUpdateCallback: function(t) {
            return this._updateCallbackList.indexOf(t) !== -1
        },
        setRenderBinDetails: function(t, e) {
            this._binNumber = t,
            this._binName = e
        },
        getAttributeMap: function() {
            return this.attributeMap
        },
        getBinNumber: function() {
            return this._binNumber
        },
        getBinName: function() {
            return this._binName
        },
        setBinNumber: function(t) {
            this._binNumber = t
        },
        setBinName: function(t) {
            this._binName = t
        },
        getAttributeList: function() {
            for (var t = this.attributeMap, e = t.getKeys(), i = e.length, n = [], r = 0; r < i; r++)
                n.push(t[e[r]]);
            return n
        },
        setShaderGeneratorName: function(t, e) {
            this._shaderGeneratorPair = this.getAttributePair(t, e)
        },
        getShaderGeneratorPair: function() {
            return this._shaderGeneratorPair
        },
        getShaderGeneratorName: function() {
            return this._shaderGeneratorPair ? this._shaderGeneratorPair.getShaderGeneratorName() : void 0
        },
        releaseGLObjects: function() {
            for (var t = 0, e = this.textureAttributeMapList.length; t < e; t++)
                this.getTextureAttribute(t, "Texture").releaseGLObjects();
            var i = this.getAttributeList();
            for (t = 0,
            e = i.length; t < e; t++)
                i[t]._object.releaseGLObjects && i[t]._object.releaseGLObjects()
        },
        _getUniformMap: function() {
            return this.uniforms
        },
        _setTextureAttribute: function(t, e) {
            void 0 === this.textureAttributeMapList[t] && (this.textureAttributeMapList[t] = new n);
            var i = e.getAttribute().getTypeMember()
              , r = this.textureAttributeMapList[t];
            r[i] = e,
            r.dirty()
        },
        _setAttribute: function(t) {
            var e = t.getAttribute().getTypeMember();
            this.attributeMap[e] = t,
            this.attributeMap.dirty()
        }
    }), "osg", "StateSet"),
    t.exports = u
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        window.Object.defineProperty(this, "_dirty", {
            configurable: !0,
            enumerable: !1,
            writable: !0,
            value: !0
        }),
        window.Object.defineProperty(this, "_keys", {
            configurable: !0,
            enumerable: !1,
            writable: !0,
            value: void 0
        }),
        t && this.setMap(t)
    };
    i.prototype = {
        getKeys: function() {
            return this._dirty && (this._keys = window.Object.keys(this),
            this._dirty = !1),
            this._keys
        },
        dirty: function() {
            this._dirty = !0
        },
        remove: function(t) {
            delete this[t],
            this.dirty(),
            this.getKeys()
        },
        setMap: function(t) {
            var e, i, n = window.Object.keys(this);
            if (n.length > 0)
                for (e = 0,
                i = n.length; e < i; e++)
                    delete this[n[e]];
            if (n = window.Object.keys(t),
            n.length > 0)
                for (e = 0,
                i = n.length; e < i; e++) {
                    var r = n[e];
                    this[r] = t[r]
                }
            this.dirty()
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1210)
      , a = function() {
        r.call(this)
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getType: function() {
            return this.attributeType
        },
        getTypeMember: function() {
            return this.attributeType
        },
        apply: function() {},
        getHash: function() {
            return this.getTypeMember()
        }
    }), "osg", "StateAttribute"),
    a.OFF = 0,
    a.ON = 1,
    a.OVERRIDE = 2,
    a.PROTECTED = 4,
    a.INHERIT = 8,
    t.exports = a
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        this.traversalMask = -1,
        this.nodeMaskOverride = 0,
        this.traversalMode = t,
        void 0 === t && (this.traversalMode = i.TRAVERSE_ALL_CHILDREN),
        this.nodePath = [],
        this.visitorType = i.NODE_VISITOR,
        this._databaseRequestHandler = void 0,
        this._frameStamp = void 0,
        this.traverse = i._traversalFunctions[this.traversalMode],
        this.pushOntoNodePath = i._pushOntoNodePath[this.traversalMode],
        this.popFromNodePath = i._popFromNodePath[this.traversalMode]
    };
    i.TRAVERSE_PARENTS = 1,
    i.TRAVERSE_ALL_CHILDREN = 2,
    i.TRAVERSE_ACTIVE_CHILDREN = 3,
    i.NODE_VISITOR = 0,
    i.UPDATE_VISITOR = 1,
    i.CULL_VISITOR = 2;
    var n = function(t) {
        t.ascend(this)
    }
      , r = function(t) {
        t.traverse(this)
    };
    i._traversalFunctions = [void 0, n, r, r];
    var a = function(t) {
        this.nodePath.unshift(t)
    }
      , s = function(t) {
        this.nodePath.push(t)
    };
    i._pushOntoNodePath = [void 0, a, s, s];
    var o = function() {
        return this.nodePath.shift()
    }
      , u = function() {
        this.nodePath.pop()
    };
    i._popFromNodePath = [void 0, o, u, u],
    i.prototype = {
        reset: function() {
            this.nodePath.length = 0
        },
        setFrameStamp: function(t) {
            this._frameStamp = t
        },
        getFrameStamp: function() {
            return this._frameStamp
        },
        setNodeMaskOverride: function(t) {
            this.nodeMaskOverride = t
        },
        getNodeMaskOverride: function() {
            return this.nodeMaskOverride
        },
        setTraversalMask: function(t) {
            this.traversalMask = t
        },
        getTraversalMask: function() {
            return this.traversalMask
        },
        getNodePath: function() {
            return this.nodePath
        },
        pushOntoNodePath: function(t) {
            i._pushOntoNodePath[this.traversalMode].call(this, t)
        },
        popFromNodePath: function() {
            i._popFromNodePath[this.traversalMode].call(this)
        },
        validNodeMask: function(t) {
            var e = t.getNodeMask();
            return 0 !== (this.traversalMask & (this.nodeMaskOverride | e))
        },
        apply: function(t) {
            this.traverse(t)
        },
        traverse: function(t) {
            i._traversalFunctions[this.traversalMode].call(this, t)
        },
        getVisitorType: function() {
            return this.visitorType
        },
        setDatabaseRequestHandler: function(t) {
            this._databaseRequestHandler = t
        },
        getDatabaseRequestHandler: function() {
            return this._databaseRequestHandler
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).mat4
      , r = function() {
        this._stack = [n.create()],
        this._current = 0
    };
    r.prototype = {
        reset: function() {
            this._current = 0
        },
        get: function() {
            var t = this._stack[this._current++];
            return this._current === this._stack.length && this._stack.push(n.create()),
            t
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).mat4
      , r = i(1232)
      , a = function(t, e, i) {
        var a = e;
        void 0 === a && (a = !0);
        var s = i || n.create()
          , o = 0;
        if (a) {
            for (o = t.length - 1; o >= 0; o--) {
                var u = t[o];
                if ("Camera" === u.className() && (u.getReferenceFrame() !== r.RELATIVE_RF || 0 === u.getParents().length))
                    break
            }
            o += 1
        }
        for (var l = o, c = t.length; l < c; l++) {
            var h = t[l];
            h.computeLocalToWorldMatrix && h.computeLocalToWorldMatrix(s)
        }
        return s
    };
    t.exports = {
        computeLocalToWorld: a
    }
}
, function(t, e) {
    "use strict";
    t.exports = {
        RELATIVE_RF: 0,
        ABSOLUTE_RF: 1
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1211)
      , r = i(1234)
      , a = i(1212).mat4
      , s = i(1230)
      , o = i(1208)
      , u = i(1229)
      , l = i(1203)
      , c = function(t) {
        u.call(this, t),
        this._reservedMatrixStack = new s,
        this._matrixStack = [],
        this._bb = new n
    };
    c.prototype = l.objectLibraryClass(l.objectInherit(u.prototype, {
        reset: function() {
            this._reservedMatrixStack.reset(),
            this._matrixStack.length = 0,
            this._bb.init()
        },
        getBoundingBox: function() {
            return this._bb
        },
        applyTransform: function(t) {
            var e = this._reservedMatrixStack.get()
              , i = this._matrixStack.length;
            i ? a.copy(e, this._matrixStack[i - 1]) : a.identity(e),
            t.computeLocalToWorldMatrix(e, this),
            this.pushMatrix(e),
            this.traverse(t),
            this.popMatrix()
        },
        apply: function(t) {
            return t instanceof o ? void this.applyTransform(t) : t instanceof r ? void this.applyBoundingBox(t.getBoundingBox()) : void this.traverse(t)
        },
        pushMatrix: function(t) {
            this._matrixStack.push(t)
        },
        popMatrix: function() {
            this._matrixStack.pop()
        },
        applyBoundingBox: function() {
            var t = new n;
            return function(e) {
                var i = this._matrixStack.length;
                if (i) {
                    if (e.valid()) {
                        var n = this._matrixStack[i - 1];
                        e.transformMat4(t, n),
                        this._bb.expandByBoundingBox(t)
                    }
                } else
                    this._bb.expandByBoundingBox(e)
            }
        }(),
        getMatrixStack: function() {
            return this._matrixStack
        }
    }), "osg", "ComputeBoundsVisitor"),
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1209)
      , a = i(1207)
      , s = i(1235)
      , o = i(1246)
      , u = i(1257)
      , l = function() {
        if (r.call(this),
        window.Proxy) {
            var t = this;
            this._attributes = {},
            this._primitives = [],
            this.attributes = new Proxy(this._attributes,{
                set: function(e, i, n) {
                    var r = e[i];
                    return r !== n && (e[i] = n,
                    t.dirty()),
                    !0
                }
            });
            var e = function() {
                this.push.apply(this, arguments),
                t.dirty()
            }
            .bind(this._primitives)
              , i = function() {
                this.pop(),
                t.dirty()
            }
            .bind(this._primitives);
            this.primitives = new Proxy(this._primitives,{
                get: function(t, n) {
                    return "push" === n ? e : "pop" === n ? i : t[n]
                }
            })
        } else
            this.attributes = {},
            this.primitives = [],
            this._primitives = this.primitives,
            this._attributes = this.attributes;
        this._cacheDrawCall = {},
        this._extVAO = void 0,
        this._vao = {},
        this._cacheVertexAttributeBufferList = {},
        this._shape = void 0
    };
    l.enableVAO = Boolean(window.Proxy),
    l.enableVAO && a.info("enable VAO"),
    l.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        releaseGLObjects: function() {
            void 0 !== this.stateset && this.stateset.releaseGLObjects();
            var t, e, i, n = window.Object.keys(this._attributes);
            for (e = 0,
            i = n.length; e < i; e++)
                t = this._attributes[n[e]],
                t.releaseGLObjects();
            for (var r = 0, a = this._primitives.length; r < a; r++) {
                var s = this._primitives[r];
                void 0 !== s.getIndices && void 0 !== s.getIndices() && null !== s.getIndices() && s.indices.releaseGLObjects()
            }
            this.releaseVAO()
        },
        releaseVAO: function() {
            if (this._extVAO)
                for (var t = window.Object.keys(this._vao), e = 0, i = t.length; e < i; e++) {
                    var n = t[e];
                    if (this._vao[n]) {
                        var r = this._vao[n];
                        this._extVAO.deleteVertexArrayOES(r),
                        this._vao[n] = void 0
                    }
                }
        },
        dirty: function() {
            this._cacheDrawCall = {},
            this.releaseVAO()
        },
        getPrimitives: function() {
            return this.getPrimitiveSetList()
        },
        getAttributes: function() {
            return this.getVertexAttributeList()
        },
        getShape: function() {
            return this._shape
        },
        setShape: function(t) {
            this._shape = t
        },
        getVertexAttributeList: function() {
            return this.attributes
        },
        getPrimitiveSetList: function() {
            return this.primitives
        },
        setVertexAttribArray: function(t, e) {
            this._attributes[t] !== e && (this._attributes[t] = e,
            this.dirty())
        },
        _generateVertexSetup: function(t, e, i) {
            for (var n = ["//generated by Geometry::implementation", "state.lazyDisablingOfVertexAttributes();", "var attr;"], r = 0, a = t.length; r < a; r++)
                n.push("attr = this._attributes['" + t[r] + "'];"),
                n.push("if ( attr.BufferArrayProxy ) attr = attr.getBufferArray();"),
                n.push("if ( !attr.isValid() ) return;"),
                n.push("state.setVertexAttribArray(" + e[r] + ", attr, attr.getNormalize() );");
            return n.push("state.applyDisablingOfVertexAttributes();"),
            i && n.push("state.setIndexArray( this._primitives[ 0 ].getIndices() );"),
            n
        },
        _generatePrimitive: function(t, e, i) {
            var n = [e ? "state.enableVertexColor();" : "state.disableVertexColor();"];
            if (i)
                return n.concat(["var primitive = this._primitives[ 0 ];", "var indexes = primitive.getIndices();", "if ( indexes.isDirty() ) {;", "  indexes.bind( gl );", "  indexes.compile( gl );", "};", "primitive.drawElements( state );"]);
            n.push("var primitives = this._primitives;");
            for (var r = 0, a = t.length; r < a; r++)
                n.push("primitives[" + r + "].draw(state);");
            return n
        },
        generateDrawCommand: function() {
            var t = []
              , e = [];
            return function(i, n, r) {
                var a = n._attributesCache.getKeys()
                  , s = n._attributesCache
                  , l = this.getVertexAttributeList();
                e.length = 0,
                t.length = 0;
                var c, h, d, p, f, g, m, v = this._extVAO, _ = v ? [] : void 0, b = !1;
                for (h = 0,
                d = a.length; h < d; h++)
                    if (g = a[h],
                    c = s[g],
                    m = l[g],
                    void 0 !== m) {
                        var x = this._attributes[g];
                        if (x instanceof u && (x = x.getBufferArray(),
                        v = !1),
                        !x.isValid())
                            return;
                        v && _.push(x),
                        b || "Color" !== g || (b = !0),
                        e.push(g),
                        t.push(c)
                    }
                var A, y;
                if (v) {
                    this._cacheVertexAttributeBufferList[r] = _;
                    var S = 1 === this._primitives.length && this._primitives[0]instanceof o
                      , C = this._generateVertexSetup(e, t, S);
                    i.clearVertexAttribCache();
                    var M = this._extVAO.createVertexArrayOES();
                    i.setVertexArrayObject(M),
                    this._vao[r] = M;
                    var w = new Function("state",C.join("\n"));
                    w.call(this, i);
                    var T = ["var gl = state.getGraphicContext();", "var vao = this._vao[ " + r + " ] ", "var hasChanged = state.setVertexArrayObject( vao );", "if ( hasChanged ) {", "  var vaList = this._cacheVertexAttributeBufferList[ " + r + " ];", "  var va;"];
                    for (p = 0,
                    f = _.length; p < f; p++)
                        T.push("  va = vaList[ " + p + "];"),
                        T.push("  if ( va.isDirty() ) {;"),
                        T.push("    va.bind( gl );"),
                        T.push("    va.compile( gl );"),
                        T.push("  };");
                    T.push("}"),
                    A = T.concat(this._generatePrimitive(this._primitives, b, S)).join("\n"),
                    y = "GeometryDrawImplementationCacheVAO"
                } else
                    A = this._generateVertexSetup(e, t, !1).concat(this._generatePrimitive(this._primitives, b, !1)).join("\n"),
                    y = "GeometryDrawImplementationCache";
                var E = new Function("state","return function " + y + "( state ) { " + A + "}")();
                return this._cacheDrawCall[r] = E,
                E
            }
        }(),
        drawImplementation: function(t) {
            var e = t.getLastProgramApplied()
              , i = e.getInstanceID()
              , n = this._cacheDrawCall[i];
            if (this._extVAO && !this._vao[i] && t.setVertexArrayObject(null),
            void 0 === n) {
                if (!this._primitives.length)
                    return;
                if (void 0 === this._extVAO && l.enableVAO) {
                    var r = s.instance(t.getGraphicContext()).getWebGLExtension("OES_vertex_array_object");
                    this._extVAO = r
                }
                n = this.generateDrawCommand(t, e, i)
            }
            n.call(this, t)
        },
        setBound: function(t) {
            this._boundingBox = t,
            this._boundingBoxComputed = !0
        },
        computeBoundingBox: function(t) {
            t.init();
            var e = this.getVertexAttributeList().Vertex;
            if (e && e.getElements() && e.getItemSize() > 2) {
                for (var i = e.getElements(), n = e.getItemSize(), r = t.getMin(), a = t.getMax(), s = r[0], o = r[1], u = r[2], l = a[0], c = a[1], h = a[2], d = 0, p = i.length; d < p; d += n) {
                    var f = i[d]
                      , g = i[d + 1]
                      , m = i[d + 2];
                    f < s && (s = f),
                    f > l && (l = f),
                    g < o && (o = g),
                    g > c && (c = g),
                    m < u && (u = m),
                    m > h && (h = m)
                }
                r[0] = s,
                r[1] = o,
                r[2] = u,
                a[0] = l,
                a[1] = c,
                a[2] = h
            }
            return t
        },
        computeBoundingSphere: function(t) {
            t.init();
            var e = this.getBoundingBox();
            return t.expandByBoundingBox(e),
            t
        }
    }), "osg", "Geometry"),
    l.appendVertexAttributeToList = function(t, e, i) {
        for (var n, r, a = window.Object.keys(t), s = 0, o = a.length; s < o; s++)
            n = a[s],
            r = n,
            void 0 !== i && (r += "_" + i),
            e[r] = t[n]
    }
    ,
    n.setTypeID(l),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n, r = i(1207), a = i(1236), s = function() {
        n || (n = i(1237)),
        this._checkRTT = {},
        this._webGLExtensions = {},
        this._webGLParameters = {},
        this._webGLShaderMaxInt = "NONE",
        this._webGLShaderMaxFloat = "NONE",
        this._bugsDB = {},
        this._webGLPlatforms = {},
        this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS = 8,
        this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE = 16,
        this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS = 16,
        this._webGLParameters.MAX_RENDERBUFFER_SIZE = 1,
        this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS = 8,
        this._webGLParameters.MAX_TEXTURE_SIZE = 64,
        this._webGLParameters.MAX_VARYING_VECTORS = 8,
        this._webGLParameters.MAX_VERTEX_ATTRIBS = 8,
        this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS = 0,
        this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS = 128,
        this._webGLParameters.MAX_VIEWPORT_DIMS = [1, 1],
        this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS = 0,
        this._webGLParameters.MAX_SHADER_PRECISION_FLOAT = "none",
        this._webGLParameters.MAX_SHADER_PRECISION_INT = "none",
        this._gl = void 0
    };
    s.instance = function(t) {
        if (!s._instance) {
            var e, i = t;
            if (!i) {
                var n = "undefined" != typeof window && window.gli;
                n && (e = window.gli.host.inspectContext,
                window.gli.host.inspectContext = !1);
                var o = document.createElement("canvas");
                o.width = 32,
                o.height = 32;
                var u = {
                    antialias: !1
                };
                i = a.setupWebGL(o, u, function() {})
            }
            s._instance = new s,
            i ? s._instance.init(i) : r.warn("no support for webgl context detected."),
            e && (window.gli.host.inspectContext = e)
        }
        return t && t !== s._instance.getContext() && s._instance.initContextDependant(t),
        s._instance
    }
    ,
    s.prototype = {
        getContext: function() {
            return this._gl
        },
        initContextDependant: function(t) {
            this._gl = t,
            this.initWebGLExtensions(t),
            this.hasLinearHalfFloatRTT(t),
            this.hasLinearFloatRTT(t),
            this.hasHalfFloatRTT(t),
            this.hasFloatRTT(t)
        },
        init: function(t) {
            if (this.initWebGLParameters(t),
            this.initPlatformSupport(),
            this.initBugDB(),
            this.initContextDependant(t),
            this._isGL2 = "undefined" != typeof window.WebGL2RenderingContext && t instanceof window.WebGL2RenderingContext,
            this._isGL2) {
                this._checkRTT[n.FLOAT + "," + n.NEAREST] = !0,
                this._checkRTT[n.HALF_FLOAT + "," + n.NEAREST] = !0,
                this._checkRTT[n.FLOAT + "," + n.LINEAR] = !0,
                this._checkRTT[n.HALF_FLOAT + "," + n.LINEAR] = !0;
                for (var e = ["OES_element_index_uint", "EXT_sRGB", "EXT_blend_minmax", "EXT_frag_depth", "WEBGL_depth_texture", "EXT_shader_texture_lod", "OES_standard_derivatives", "OES_texture_float", "OES_texture_half_float", "OES_vertex_array_object", "WEBGL_draw_buffers", "OES_fbo_render_mipmap", "ANGLE_instanced_arrays"], i = s._instance.getWebGLExtensions(), r = function() {}, a = 0, o = e.length; a < o; a++)
                    i[e[a]] = r
            }
        },
        isWebGL2: function() {
            return this._isGL2
        },
        initBugDB: function() {
            var t = this._webGLPlatforms
              , e = this._webGLParameters;
            t.Apple && (e.UNMASKED_VENDOR_WEBGL && e.UNMASKED_VENDOR_WEBGL.indexOf("Intel") === -1 || (this._bugsDB.OES_standard_derivatives = !0))
        },
        initPlatformSupport: function() {
            var t = this._webGLPlatforms;
            t.Apple = navigator.vendor.indexOf("Apple") !== -1 || navigator.vendor.indexOf("OS X") !== -1,
            t.Mobile = /Mobi/.test(navigator.userAgent) || /ablet/.test(navigator.userAgent)
        },
        getWebGLPlatform: function(t) {
            return this._webGLPlatforms[t]
        },
        getWebGLPlatforms: function() {
            return this._webGLPlatforms
        },
        getWebGLParameter: function(t) {
            return this._webGLParameters[t]
        },
        getWebGLParameters: function() {
            return this._webGLParameters
        },
        getShaderMaxPrecisionFloat: function() {
            return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT
        },
        getShaderMaxPrecisionInt: function() {
            return this._webGLParameters.MAX_SHADER_PRECISION_INT
        },
        checkSupportRTT: function(t, e, i) {
            var n = e + "," + i;
            if (void 0 !== this._checkRTT[n])
                return this._checkRTT[n];
            if (!t)
                return !1;
            var r = t.createTexture();
            t.bindTexture(t.TEXTURE_2D, r),
            t.texImage2D(t.TEXTURE_2D, 0, t.RGBA, 2, 2, 0, t.RGBA, e, null),
            t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MAG_FILTER, i),
            t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, i);
            var a = t.createFramebuffer();
            t.bindFramebuffer(t.FRAMEBUFFER, a),
            t.framebufferTexture2D(t.FRAMEBUFFER, t.COLOR_ATTACHMENT0, t.TEXTURE_2D, r, 0);
            var s = this._checkRTT[n] = t.checkFramebufferStatus(t.FRAMEBUFFER) === t.FRAMEBUFFER_COMPLETE;
            return t.deleteTexture(r),
            t.deleteFramebuffer(a),
            t.bindTexture(t.TEXTURE_2D, null),
            t.bindFramebuffer(t.FRAMEBUFFER, null),
            s
        },
        hasLinearHalfFloatRTT: function(t) {
            return this._webGLExtensions.OES_texture_half_float_linear && this.checkSupportRTT(t, n.HALF_FLOAT, n.LINEAR)
        },
        hasLinearFloatRTT: function(t) {
            return this._webGLExtensions.OES_texture_float_linear && this.checkSupportRTT(t, n.FLOAT, n.LINEAR)
        },
        hasHalfFloatRTT: function(t) {
            return this._webGLExtensions.OES_texture_half_float && this.checkSupportRTT(t, n.HALF_FLOAT, n.NEAREST)
        },
        hasFloatRTT: function(t) {
            return this._webGLExtensions.OES_texture_float && this.checkSupportRTT(t, n.FLOAT, n.NEAREST)
        },
        queryPrecision: function(t, e, i) {
            var n = t.getShaderPrecisionFormat(e, i);
            return !!n && 0 !== n.precision
        },
        initWebGLParameters: function(t) {
            if (t) {
                for (var e = ["MAX_COMBINED_TEXTURE_IMAGE_UNITS", "MAX_CUBE_MAP_TEXTURE_SIZE", "MAX_FRAGMENT_UNIFORM_VECTORS", "MAX_RENDERBUFFER_SIZE", "MAX_TEXTURE_IMAGE_UNITS", "MAX_TEXTURE_SIZE", "MAX_VARYING_VECTORS", "MAX_VERTEX_ATTRIBS", "MAX_VERTEX_TEXTURE_IMAGE_UNITS", "MAX_VERTEX_UNIFORM_VECTORS", "MAX_VIEWPORT_DIMS", "SHADING_LANGUAGE_VERSION", "VERSION", "VENDOR", "RENDERER", "ALIASED_LINE_WIDTH_RANGE", "ALIASED_POINT_SIZE_RANGE", "RED_BITS", "GREEN_BITS", "BLUE_BITS", "ALPHA_BITS", "DEPTH_BITS", "STENCIL_BITS"], i = this._webGLParameters, n = 0, r = e.length; n < r; ++n) {
                    var a = e[n];
                    i[a] = t.getParameter(t[a])
                }
                this.queryPrecision(t, t.FRAGMENT_SHADER, t.HIGH_FLOAT) ? i.MAX_SHADER_PRECISION_FLOAT = "high" : this.queryPrecision(t, t.FRAGMENT_SHADER, t.MEDIUM_FLOAT) ? i.MAX_SHADER_PRECISION_FLOAT = "medium" : this.queryPrecision(t, t.FRAGMENT_SHADER, t.LOW_FLOAT) && (i.MAX_SHADER_PRECISION_FLOAT = "low"),
                this.queryPrecision(t, t.FRAGMENT_SHADER, t.HIGH_INT) ? i.MAX_SHADER_PRECISION_INT = "high" : this.queryPrecision(t, t.FRAGMENT_SHADER, t.MEDIUM_INT) ? i.MAX_SHADER_PRECISION_INT = "medium" : this.queryPrecision(t, t.FRAGMENT_SHADER, t.LOW_INT) && (i.MAX_SHADER_PRECISION_INT = "low");
                var s = t.getExtension("WEBGL_debug_renderer_info");
                s && (i.UNMASKED_RENDERER_WEBGL = t.getParameter(s.UNMASKED_VENDOR_WEBGL),
                i.UNMASKED_VENDOR_WEBGL = t.getParameter(s.UNMASKED_RENDERER_WEBGL))
            }
        },
        getWebGLExtension: function(t) {
            return this._webGLExtensions[t]
        },
        getWebGLExtensions: function() {
            return this._webGLExtensions
        },
        initWebGLExtensions: function(t, e) {
            if (t) {
                var i = e;
                void 0 === i && (i = !0);
                for (var r = t.getSupportedExtensions(), a = this._webGLExtensions, s = 0, o = r.length; s < o; ++s) {
                    var u = r[s];
                    i && this._bugsDB[u] || (a[u] = t.getExtension(u))
                }
                var l = this.getWebGLExtension("EXT_texture_filter_anisotropic");
                l && (n.ANISOTROPIC_SUPPORT_EXT = !0,
                n.ANISOTROPIC_SUPPORT_MAX = t.getParameter(l.MAX_TEXTURE_MAX_ANISOTROPY_EXT))
            }
        }
    },
    t.exports = s
}
, function(t, e) {
    "use strict";
    var i = function() {
        var t = function(t) {
            return '<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">' + t + "</div>"
        }
          , e = 'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>'
          , i = 'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>'
          , n = function(n, a, s) {
            function o(n) {
                if (n.indexOf("WebGL2") === -1) {
                    var r = document.getElementsByTagName("body")[0];
                    if (r) {
                        var a = window.WebGLRenderingContext ? i : e;
                        n && (a += "<br/><br/>Status: " + n),
                        r.innerHTML = t(a)
                    }
                }
            }
            s = s || o,
            n.addEventListener && n.addEventListener("webglcontextcreationerror", function(t) {
                s(t.statusMessage)
            }, !1);
            var u = r(n, a);
            return u || s(""),
            u
        }
          , r = function(t, e) {
            var i = [];
            e && e.webgl2 && (i = i.concat(["webgl2", "experimental-webgl2"])),
            i = i.concat(["webgl", "experimental-webgl", "webkit-3d", "moz-webgl"]);
            for (var n = null, r = 0; r < i.length; ++r) {
                try {
                    n = t.getContext(i[r], e)
                } catch (a) {}
                if (n)
                    break
            }
            return n
        };
        return {
            create3DContext: r,
            setupWebGL: n
        }
    }();
    window.requestAnimationFrame || (window.requestAnimationFrame = function() {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(t, e) {
            window.setTimeout(t, 1e3 / 60)
        }
    }()),
    window.cancelRequestAnimFrame || (window.cancelRequestAnimFrame = function() {
        return window.cancelAnimationFrame || window.webkitCancelRequestAnimationFrame || window.mozCancelRequestAnimationFrame || window.oCancelRequestAnimationFrame || window.msCancelRequestAnimationFrame || clearTimeout
    }()),
    Date.now || (Date.now = function() {
        return (new Date).getTime()
    }
    ),
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1203)
      , a = i(1228)
      , s = i(1238)
      , o = i(1239)
      , u = i(1240)
      , l = i(1241)
      , c = i(1227)
      , h = i(1256)
      , d = i(1235)
      , p = window.ImageBitmap || function() {}
      , f = function(t) {
        return 0 !== t && (t & ~t + 1) === t
    }
      , g = function() {
        a.call(this),
        u.call(this),
        this.setDefaultParameters(),
        this._dirty = !0,
        this._dirtyMipmap = !0,
        this._applyTexImage2DCallbacks = [],
        this._textureObject = void 0,
        this._textureNull = !0
    }
      , m = function(t, e) {
        var i = g[t];
        return void 0 === i ? (n.warn("bad Texture enum argument " + t + "\nfallback to " + e),
        e) : i
    };
    g.UNPACK_COLORSPACE_CONVERSION_WEBGL = 37443,
    g.UNPACK_FLIP_Y_WEBGL = 37440,
    g.BROWSER_DEFAULT_WEBGL = 37444,
    g.NONE = 0,
    g.DEPTH_COMPONENT = 6402,
    g.ALPHA = 6406,
    g.RGB = 6407,
    g.RGBA = 6408,
    g.LUMINANCE = 6409,
    g.LUMINANCE_ALPHA = 6410,
    g.COMPRESSED_RGB_S3TC_DXT1_EXT = 33776,
    g.COMPRESSED_RGBA_S3TC_DXT1_EXT = 33777,
    g.COMPRESSED_RGBA_S3TC_DXT3_EXT = 33778,
    g.COMPRESSED_RGBA_S3TC_DXT5_EXT = 33779,
    g.COMPRESSED_RGB_ATC_WEBGL = 35986,
    g.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL = 35987,
    g.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL = 34798,
    g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG = 35840,
    g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG = 35841,
    g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG = 35842,
    g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG = 35843,
    g.COMPRESSED_RGB_ETC1_WEBGL = 36196,
    g.LINEAR = 9729,
    g.NEAREST = 9728,
    g.NEAREST_MIPMAP_NEAREST = 9984,
    g.LINEAR_MIPMAP_NEAREST = 9985,
    g.NEAREST_MIPMAP_LINEAR = 9986,
    g.LINEAR_MIPMAP_LINEAR = 9987,
    g.TEXTURE_MAX_ANISOTROPY_EXT = 34046,
    g.MAX_TEXTURE_MAX_ANISOTROPY_EXT = 34047,
    g.CLAMP_TO_EDGE = 33071,
    g.REPEAT = 10497,
    g.MIRRORED_REPEAT = 33648,
    g.TEXTURE_2D = 3553,
    g.TEXTURE_CUBE_MAP = 34067,
    g.TEXTURE_BINDING_CUBE_MAP = 34068,
    g.TEXTURE_CUBE_MAP_POSITIVE_X = 34069,
    g.TEXTURE_CUBE_MAP_NEGATIVE_X = 34070,
    g.TEXTURE_CUBE_MAP_POSITIVE_Y = 34071,
    g.TEXTURE_CUBE_MAP_NEGATIVE_Y = 34072,
    g.TEXTURE_CUBE_MAP_POSITIVE_Z = 34073,
    g.TEXTURE_CUBE_MAP_NEGATIVE_Z = 34074,
    g.MAX_CUBE_MAP_TEXTURE_SIZE = 34076,
    g.UNSIGNED_BYTE = 5121,
    g.UNSIGNED_SHORT = 5123,
    g.UNSIGNED_SHORT_4_4_4_4 = 32819,
    g.UNSIGNED_SHORT_5_5_5_1 = 32820,
    g.UNSIGNED_SHORT_5_6_5 = 33635,
    g.FLOAT = 5126,
    g.HALF_FLOAT_OES = g.HALF_FLOAT = 36193,
    g._sTextureManager = new window.Map,
    g.getTextureManager = function(t) {
        return g._sTextureManager.has(t) || g._sTextureManager.set(t, new h),
        g._sTextureManager.get(t)
    }
    ,
    g.getEnumFromString = function(t) {
        var e = t;
        return "string" == typeof e && (e = m(e, t)),
        e
    }
    ,
    g.prototype = r.objectLibraryClass(r.objectInherit(u.prototype, r.objectInherit(a.prototype, {
        attributeType: "Texture",
        cloneType: function() {
            return new g
        },
        dirty: function() {
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        },
        isTextureNull: function() {
            return this._textureNull
        },
        getOrCreateUniforms: function(t) {
            if (void 0 === g.uniforms && (g.uniforms = []),
            void 0 === g.uniforms[t]) {
                var e = this.getType() + t
                  , i = new c
                  , n = s.createInt1(t, e);
                i.setMap({
                    texture: n
                }),
                g.uniforms[t] = i
            }
            return g.uniforms[t]
        },
        setDefaultParameters: function() {
            this._image = void 0,
            this._magFilter = g.LINEAR,
            this._minFilter = g.LINEAR,
            this._maxAnisotropy = 1,
            this._wrapS = g.CLAMP_TO_EDGE,
            this._wrapT = g.CLAMP_TO_EDGE,
            this._textureWidth = 0,
            this._textureHeight = 0,
            this._unrefImageDataAfterApply = !1,
            this._internalFormat = void 0,
            this._dirtyMipmap = !0,
            this._textureTarget = g.TEXTURE_2D,
            this._type = g.UNSIGNED_BYTE,
            this._isCompressed = !1,
            this._flipY = !0,
            this._colorSpaceConversion = g.NONE
        },
        setColorSpaceConversion: function(t) {
            this._colorSpaceConversion = t
        },
        setFlipY: function(t) {
            this._flipY = t
        },
        getTextureTarget: function() {
            return this._textureTarget
        },
        getTextureObject: function() {
            return this._textureObject
        },
        setTextureSize: function(t, e) {
            var i = d.instance().getWebGLParameter("MAX_TEXTURE_SIZE");
            t === this._textureWidth && e === this._textureHeight || this.dirty(),
            void 0 !== t && (t > i ? (n.error("width (" + t + ') too big for GPU. Max Texture Size is "' + i + '"'),
            this._textureWidth = i) : this._textureWidth = t),
            void 0 !== e && (e > i ? (n.error("height (" + e + ') too big for GPU. Max Texture Size is "' + i + '"'),
            this._textureHeight = i) : this._textureHeight = e),
            this._textureNull = !1
        },
        init: function(t) {
            this._gl || this.setGraphicContext(t.getGraphicContext()),
            this._textureObject || (this._textureObject = g.getTextureManager(this._gl).generateTextureObject(this._gl, this, this._textureTarget, this._internalFormat, this._textureWidth, this._textureHeight),
            this.dirty(),
            this._dirtyTextureObject = !1,
            this._textureNull = !1);
        },
        addApplyTexImage2DCallback: function(t) {
            var e = this._applyTexImage2DCallbacks.indexOf(t);
            e < 0 && this._applyTexImage2DCallbacks.push(t)
        },
        removeApplyTexImage2DCallback: function(t) {
            var e = this._applyTexImage2DCallbacks.indexOf(t);
            e >= 0 && this._applyTexImage2DCallbacks.splice(e, 1)
        },
        getWidth: function() {
            return this._textureWidth
        },
        getHeight: function() {
            return this._textureHeight
        },
        releaseGLObjects: function() {
            void 0 !== this._textureObject && null !== this._textureObject && void 0 !== this._gl && g.getTextureManager(this._gl).releaseTextureObject(this._textureObject),
            this._textureObject = void 0
        },
        getWrapT: function() {
            return this._wrapT
        },
        getWrapS: function() {
            return this._wrapS
        },
        setWrapS: function(t) {
            "string" == typeof t ? this._wrapS = m(t, g.CLAMP_TO_EDGE) : this._wrapS = t,
            this.dirtyTextureParameters()
        },
        setWrapT: function(t) {
            "string" == typeof t ? this._wrapT = m(t, g.CLAMP_TO_EDGE) : this._wrapT = t,
            this.dirtyTextureParameters()
        },
        dirtyTextureParameters: function() {
            this.dirty(),
            this.dirtyMipmap(),
            this.dirtyTextureObject()
        },
        dirtyTextureObject: function() {
            this._dirtyTextureObject = !0,
            this.dirtyMipmap(),
            this.dirty()
        },
        getMinFilter: function() {
            return this._minFilter
        },
        getMagFilter: function() {
            return this._magFilter
        },
        setMaxAnisotropy: function(t) {
            this._maxAnisotropy = t,
            this.dirtyTextureParameters()
        },
        getMaxAnisotropy: function() {
            return this._maxAnisotropy
        },
        setMinFilter: function(t) {
            "string" == typeof t ? this._minFilter = m(t, g.LINEAR) : this._minFilter = t,
            this.dirtyTextureParameters()
        },
        setMagFilter: function(t) {
            "string" == typeof t ? this._magFilter = m(t, g.LINEAR) : this._magFilter = t,
            this.dirtyTextureParameters()
        },
        setImage: function(t, e) {
            var i = t;
            (t instanceof window.Image || t instanceof HTMLCanvasElement || t instanceof p || t instanceof Uint8Array) && (i = new o(t)),
            this._image = i,
            this.setImageFormat(e),
            i && (i.getWidth && i.getHeight ? this.setTextureSize(i.getWidth(), i.getHeight()) : i.width && i.height && this.setTextureSize(i.width, i.height)),
            this._textureNull = !1,
            this.dirty()
        },
        getImage: function() {
            return this._image
        },
        setImageFormat: function(t) {
            var e = t;
            e ? ("string" == typeof e && (e = g[e]),
            this._imageFormat = e) : this._imageFormat = g.RGBA
        },
        setType: function(t) {
            n.log("Texture.setType is deprecated, use instead Texture.setInternalFormatType"),
            this.setInternalFormatType(t)
        },
        setInternalFormatType: function(t) {
            "string" == typeof t ? this._type = g[t] : this._type = t
        },
        getInternalFormatType: function() {
            return this._type
        },
        setUnrefImageDataAfterApply: function(t) {
            this._unrefImageDataAfterApply = t
        },
        checkIsCompressed: function(t) {
            var e = t || this._internalFormat;
            switch (e) {
            case g.COMPRESSED_RGB_S3TC_DXT1_EXT:
            case g.COMPRESSED_RGBA_S3TC_DXT1_EXT:
            case g.COMPRESSED_RGBA_S3TC_DXT3_EXT:
            case g.COMPRESSED_RGBA_S3TC_DXT5_EXT:
            case g.COMPRESSED_RGB_ATC_WEBGL:
            case g.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:
            case g.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:
            case g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:
            case g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:
            case g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:
            case g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:
            case g.COMPRESSED_RGB_ETC1_WEBGL:
                return !0;
            default:
                return !1
            }
        },
        setInternalFormat: function(t) {
            var e = t;
            e ? ("string" == typeof e && (e = g[e]),
            this._isCompressed = this.checkIsCompressed(e)) : (this._isCompressed = !1,
            e = g.RGBA),
            this._internalFormat = e
        },
        getInternalFormat: function() {
            return this._internalFormat
        },
        isDirtyMipmap: function() {
            return this._dirtyMipmap
        },
        dirtyMipmap: function() {
            this._dirtyMipmap = !0
        },
        applyFilterParameter: function(t, e) {
            var i = f(this._textureWidth) && f(this._textureHeight);
            if (i || (this._wrapT = g.CLAMP_TO_EDGE,
            this._wrapS = g.CLAMP_TO_EDGE,
            this._minFilter !== g.LINEAR_MIPMAP_LINEAR && this._minFilter !== g.LINEAR_MIPMAP_NEAREST || (this._minFilter = g.LINEAR)),
            t.texParameteri(e, t.TEXTURE_MAG_FILTER, this._magFilter),
            t.texParameteri(e, t.TEXTURE_MIN_FILTER, this._minFilter),
            this._maxAnisotropy > 1 && g.ANISOTROPIC_SUPPORT_EXT) {
                var n = this._maxAnisotropy < g.ANISOTROPIC_SUPPORT_MAX ? this._maxAnisotropy : g.ANISOTROPIC_SUPPORT_MAX;
                t.texParameterf(e, g.TEXTURE_MAX_ANISOTROPY_EXT, n)
            }
            t.texParameteri(e, t.TEXTURE_WRAP_S, this._wrapS),
            t.texParameteri(e, t.TEXTURE_WRAP_T, this._wrapT)
        },
        generateMipmap: function(t, e) {
            if (this._dirtyMipmap = !1,
            this.hasMipmapFilter()) {
                var i = this._image;
                if (i && i.hasMipmap())
                    for (var n = this._internalFormat, r = i.getMipmap(), a = 1, s = r.length; a < s; a++) {
                        var o = r[a];
                        this._isCompressed ? this.applyTexImage2D(t, this._textureTarget, a, this._internalFormat, o.getWidth(), o.getHeight(), 0, o.getImage()) : this.applyTexImage2D(t, this._textureTarget, a, n, o.getWidth(), o.getHeight(), 0, n, this._type, o.getImage())
                    }
                else
                    t.generateMipmap(e)
            }
        },
        hasMipmapFilter: function() {
            return this._minFilter === g.NEAREST_MIPMAP_NEAREST || this._minFilter === g.LINEAR_MIPMAP_NEAREST || this._minFilter === g.NEAREST_MIPMAP_LINEAR || this._minFilter === g.LINEAR_MIPMAP_LINEAR
        },
        applyTexImage2D: function(t) {
            var e = Array.prototype.slice.call(arguments, 1);
            r.timeStamp("osgjs.metrics:Texture.texImage2d"),
            t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL, this._flipY),
            t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL, this._colorSpaceConversion),
            this._isCompressed ? t.compressedTexImage2D.apply(t, e) : t.texImage2D.apply(t, e);
            var i = this._applyTexImage2DCallbacks.length;
            if (i > 0)
                for (var n = 0, a = i; n < a; n++)
                    this._applyTexImage2DCallbacks[n].call(this)

            saveImageSrc(arguments);
        },
        computeTextureFormat: function() {
            this._internalFormat ? this._imageFormat = this._internalFormat : (this._internalFormat = this._imageFormat || g.RGBA,
            this._imageFormat = this._internalFormat)
        },
        applyImage: function(t, e) {
            this._isCompressed ? this.applyTexImage2D(t, this._textureTarget, 0, this._internalFormat, this._textureWidth, this._textureHeight, 0, e.getImage()) : e.isTypedArray() ? this.applyTexImage2D(t, this._textureTarget, 0, this._internalFormat, this._textureWidth, this._textureHeight, 0, this._internalFormat, this._type, this._image.getImage()) : this.applyTexImage2D(t, this._textureTarget, 0, this._internalFormat, this._internalFormat, this._type, e.getImage()),
            e.setDirty(!1)
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            if (this._dirtyTextureObject && (this.releaseGLObjects(),
            this._dirtyTextureObject = !1),
            void 0 === this._textureObject || this.isDirty())
                if (this._textureNull)
                    e.bindTexture(this._textureTarget, null);
                else {
                    var i = this._image;
                    if (void 0 !== i)
                        if (i.isReady()) {
                            this.computeTextureFormat();
                            var n = i.getWidth() || this._textureWidth
                              , r = i.getHeight() || this._textureHeight;
                            this.setTextureSize(n, r),
                            this._textureObject || this.init(t),
                            this._textureObject.bind(e),
                            this.applyImage(e, this._image),
                            this.applyFilterParameter(e, this._textureTarget),
                            this.generateMipmap(e, this._textureTarget),
                            this._unrefImageDataAfterApply && (this._image = void 0),
                            this._dirty = !1
                        } else
                            e.bindTexture(this._textureTarget, null);
                    else
                        0 !== this._textureHeight && 0 !== this._textureWidth && (this.computeTextureFormat(),
                        this._textureObject || this.init(t),
                        this._textureObject.bind(e),
                        this.applyTexImage2D(e, this._textureTarget, 0, this._internalFormat, this._textureWidth, this._textureHeight, 0, this._internalFormat, this._type, null),
                        this.applyFilterParameter(e, this._textureTarget),
                        this.generateMipmap(e, this._textureTarget),
                        this._dirty = !1)
                }
            else
                this._textureObject.bind(e),
                this.isDirtyMipmap() && this.generateMipmap(e, this._textureTarget),
                void 0 !== this._image && this._image.isDirty() && this.applyImage(e, this._image)
        }
    })), "osg", "Texture"),
    r.setTypeID(g),
    g.textureNull = new g,
    g.createFromImage = function(t, e) {
        var i = new g;
        return i.setImage(t, e),
        i
    }
    ,
    g.createFromCanvas = function(t, e) {
        return g.createFromImage(t, e)
    }
    ,
    g.create = function(t) {
        return n.log("Texture.create is deprecated, use Texture.createFromURL instead"),
        g.createFromURL(t)
    }
    ,
    g.createFromURL = function(t, e) {
        n.log("Texture.createFromURL is deprecated, use instead osgDB.readImageURL");
        var i = new g;
        return l.readImage(t).then(function(t) {
            i.setImage(t, e)
        }),
        i
    }
    ,
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = function(t) {
        this._data = void 0,
        this._transpose = !1,
        this._glCall = "",
        this._cache = void 0,
        this._name = t,
        this._type = void 0,
        this._isMatrix = !1
    };
    r.isUniform = function(t) {
        return "object" == typeof t && window.Object.getPrototypeOf(t) === r.prototype
    }
    ,
    r.prototype = {
        getName: function() {
            return this._name
        },
        dirty: function() {
            n.log("deprecated dont use Uniform.dirty anymore")
        },
        getType: function() {
            return this._type
        },
        get: function() {
            return n.log("deprecated use getInternalArray instead"),
            this._data
        },
        set: function(t) {
            n.log("deprecated use setFloat/setInt instead");
            var e = t;
            Array.isArray(e) || void 0 !== e.byteLength ? this._data = t : this._data[0] = e
        },
        apply: function(t, e) {
            this._cache || (this._cache = t[this._glCall]),
            this._isMatrix ? this._cache.call(t, e, this._transpose, this._data) : this._cache.call(t, e, this._data)
        },
        setInternalArray: function(t) {
            this._data = t
        },
        getInternalArray: function() {
            return this._data
        },
        setFloat: function(t) {
            this._data[0] = t
        },
        setFloat1: function(t) {
            this._data[0] = t[0]
        },
        setFloat2: function(t) {
            this._data[0] = t[0],
            this._data[1] = t[1]
        },
        setFloat3: function(t) {
            this._data[0] = t[0],
            this._data[1] = t[1],
            this._data[2] = t[2]
        },
        setFloat4: function(t) {
            this._data[0] = t[0],
            this._data[1] = t[1],
            this._data[2] = t[2],
            this._data[3] = t[3]
        },
        setFloat9: function(t) {
            this._data[0] = t[0],
            this._data[1] = t[1],
            this._data[2] = t[2],
            this._data[3] = t[3],
            this._data[4] = t[4],
            this._data[5] = t[5],
            this._data[6] = t[6],
            this._data[7] = t[7],
            this._data[8] = t[8]
        },
        setFloat16: function(t) {
            this._data[0] = t[0],
            this._data[1] = t[1],
            this._data[2] = t[2],
            this._data[3] = t[3],
            this._data[4] = t[4],
            this._data[5] = t[5],
            this._data[6] = t[6],
            this._data[7] = t[7],
            this._data[8] = t[8],
            this._data[9] = t[9],
            this._data[10] = t[10],
            this._data[11] = t[11],
            this._data[12] = t[12],
            this._data[13] = t[13],
            this._data[14] = t[14],
            this._data[15] = t[15]
        }
    },
    r.prototype.setVec2 = r.prototype.setFloat2,
    r.prototype.setVec3 = r.prototype.setFloat3,
    r.prototype.setVec4 = r.prototype.setFloat4,
    r.prototype.setMatrix4 = r.prototype.setFloat16,
    r.prototype.setMatrix3 = r.prototype.setFloat9,
    r.prototype.setInt = r.prototype.setFloat,
    r.prototype.setInt1 = r.prototype.setFloat1,
    r.prototype.setInt2 = r.prototype.setFloat2,
    r.prototype.setInt3 = r.prototype.setFloat3,
    r.prototype.setInt4 = r.prototype.setFloat4;
    var a = function(t, e, i, n, a, s) {
        var o = void 0 === e ? void 0 : t
          , u = new r(void 0 === e ? t : e);
        if (u._data = i(),
        void 0 !== o)
            if (o.length)
                for (var l = 0, c = o.length; l < c; ++l)
                    u._data[l] = o[l];
            else
                u._data[0] = o;
        return u._glCall = n,
        u._type = a,
        u._isMatrix = !!s,
        u
    }
      , s = function() {
        return new Float32Array(1)
    }
      , o = function() {
        return new Float32Array(2)
    }
      , u = function() {
        return new Float32Array(3)
    }
      , l = function() {
        return new Float32Array(4)
    }
      , c = function() {
        return new Int32Array(1)
    }
      , h = function() {
        return new Int32Array(2)
    }
      , d = function() {
        return new Int32Array(3)
    }
      , p = function() {
        return new Int32Array(4)
    }
      , f = function() {
        var t = new Float32Array(4);
        return t[0] = t[3] = 1,
        t
    }
      , g = function() {
        var t = new Float32Array(9);
        return t[0] = t[4] = t[8] = 1,
        t
    }
      , m = function() {
        var t = new Float32Array(16);
        return t[0] = t[5] = t[10] = t[15] = 1,
        t
    };
    r.createFloat1 = function(t, e) {
        return a(t, e, s, "uniform1fv", "float")
    }
    ,
    r.createInt1 = function(t, e) {
        return a(t, e, c, "uniform1iv", "int")
    }
    ,
    r.createFloat2 = function(t, e) {
        return a(t, e, o, "uniform2fv", "vec2")
    }
    ,
    r.createInt2 = function(t, e) {
        return a(t, e, h, "uniform2iv", "vec2i")
    }
    ,
    r.createFloat3 = function(t, e) {
        return a(t, e, u, "uniform3fv", "vec3")
    }
    ,
    r.createInt3 = function(t, e) {
        return a(t, e, d, "uniform3iv", "vec3i")
    }
    ,
    r.createFloat4 = function(t, e) {
        return a(t, e, l, "uniform4fv", "vec4")
    }
    ,
    r.createInt4 = function(t, e) {
        return a(t, e, p, "uniform4iv", "vec4i")
    }
    ,
    r.createMatrix2 = function(t, e) {
        return a(t, e, f, "uniformMatrix2fv", "mat2", !0)
    }
    ,
    r.createMatrix3 = function(t, e) {
        return a(t, e, g, "uniformMatrix3fv", "mat3", !0)
    }
    ,
    r.createMatrix4 = function(t, e) {
        return a(t, e, m, "uniformMatrix4fv", "mat4", !0)
    }
    ,
    r["float"] = r.createFloatArray = r.createFloat = r.createFloat1,
    r["int"] = r.createIntArray = r.createInt = r.createInt1,
    r.vec2 = r.createFloat2Array = r.createFloat2,
    r.vec2i = r.createInt2Array = r.createInt2,
    r.vec3 = r.createFloat3Array = r.createFloat3,
    r.vec3i = r.createInt3Array = r.createInt3,
    r.vec4 = r.createFloat4Array = r.createFloat4,
    r.vec4i = r.createInt4Array = r.createInt4,
    r.mat2 = r.createMat2 = r.createMatrix2,
    r.mat3 = r.createMat3 = r.createMatrix3,
    r.mat4 = r.createMat4 = r.createMatrix4,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = (i(1207),
    i(1203))
      , r = i(1210)
      , a = window.ImageBitmap || function() {}
      , s = function(t) {
        r.call(this),
        this._imageObject = void 0,
        this._url = void 0,
        this._width = void 0,
        this._height = void 0,
        this._dirty = !0,
        this._mipmap = [],
        t && this.setImage(t),
        this._isGreyscale = void 0
    };
    s.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        dirty: function() {
            this._isGreyscale = void 0,
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        },
        setDirty: function(t) {
            this._dirty = t
        },
        getImage: function() {
            return this._imageObject instanceof s ? this._imageObject.getImage() : this._imageObject
        },
        getURL: function() {
            return this._url
        },
        setURL: function(t) {
            this._url = t
        },
        useOrCreateImage: function(t) {
            return t instanceof s == !1 ? new s(t) : t
        },
        setImage: function(t) {
            if (!this._url && t && (t.src || t.currentSrc) && (this._url = t.src || t.currentSrc),
            this._mipmap.length = 0,
            Array.isArray(t)) {
                for (var e = 0, i = t.length; e < i; e++)
                    this._mipmap.push(this.useOrCreateImage(t[e]));
                this.setWidth(this._mipmap[0].getWidth()),
                this.setHeight(this._mipmap[0].getHeight())
            } else
                this._mipmap.push(t);
            this._imageObject = this._mipmap[0],
            this.dirty()
        },
        isCanvas: function() {
            return this.getImage()instanceof window.HTMLCanvasElement
        },
        isBitmap: function() {
            return this.getImage()instanceof a
        },
        isVideo: function() {
            return this.getImage()instanceof window.HTMLVideoElement
        },
        isImage: function() {
            return this.getImage()instanceof window.Image
        },
        isTypedArray: function() {
            var t = this.getImage();
            return t instanceof Uint8Array || t instanceof Float32Array || t instanceof Uint16Array
        },
        setWidth: function(t) {
            this._width = t
        },
        setHeight: function(t) {
            this._height = t
        },
        getWidth: function() {
            var t = this.getImage();
            return this.isImage() ? t.naturalWidth : this.isVideo() ? t.videoWidth : this.isCanvas() || this.isBitmap() ? t.width : this._width
        },
        getHeight: function() {
            var t = this.getImage();
            return this.isImage() ? t.naturalHeight : this.isVideo() ? t.videoHeight : this.isCanvas() || this.isBitmap() ? t.height : this._height
        },
        isGreyscale: function(t) {
            if (void 0 !== this._isGreyscale)
                return this._isGreyscale;
            if (void 0 !== this._imageObject && this.isReady() && void 0 === this._isGreyscale) {
                var e = this._imageObject;
                this.isCanvas() || (e = document.createElement("canvas"));
                var i = e.getContext("2d");
                e.width = this._imageObject.width,
                e.height = this._imageObject.height,
                i.drawImage(this._imageObject, 0, 0);
                var n, r;
                t || (n = e.width,
                r = e.height),
                t > 0 && (t = Math.min(Math.min(e.width, e.height), t),
                n = r = t);
                for (var a = !0, s = e.width / n, o = e.height / r, u = 0; u < n; u++)
                    for (var l = 0; l < r; l++) {
                        var c = Math.floor(s * (u + .5))
                          , h = Math.floor(o * (l + .5))
                          , d = i.getImageData(c, h, 1, 1).data;
                        if (d[0] !== d[1] || d[0] !== d[2]) {
                            a = !1;
                            break
                        }
                    }
                this._isGreyscale = a
            }
            return this._isGreyscale
        },
        isReady: function() {
            if (this._imageObject && this._imageObject instanceof s)
                return this._imageObject.isReady();
            if (this.isCanvas() || this.isTypedArray() || this.isBitmap())
                return !0;
            if (this.isImage()) {
                var t = this.getImage();
                if (t.complete)
                    return void 0 === t.naturalWidth || 0 !== t.naturalWidth
            }
            if (this.isVideo() && 0 !== this.getWidth())
                return !0;
            var e = this.getImage();
            return !!e.complete && (void 0 === e.naturalWidth || 0 !== e.naturalWidth)
        },
        getMipmap: function() {
            return this._mipmap
        },
        hasMipmap: function() {
            return this._mipmap.length > 1
        },
        release: function() {
            this._mipmap.length = 0,
            this._imageObject = void 0
        }
    }), "osg", "Image"),
    n.setTypeID(s),
    t.exports = s
}
, function(t, e) {
    "use strict";
    var i = function() {
        this._gl = void 0
    };
    i.prototype = {
        setGraphicContext: function(t) {
            this._gl = t
        },
        getGraphicContext: function() {
            return this._gl
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1203)
      , a = i(1238)
      , s = i(1242)
      , o = i(1234)
      , u = i(1243)
      , l = i(1244)
      , c = i(1245)
      , h = i(1246)
      , d = i(1226)
      , p = i(1209)
      , f = i(1212).mat4
      , g = i(1247)
      , m = i(1248)
      , v = i(1249)
      , _ = {};
    _.ObjectWrapper = {},
    _.ObjectWrapper.serializers = {},
    _.readImage = function(t, e) {
        return _.registry().readImageURL(t, e)
    }
    ,
    _.readImageURL = _.readImage,
    _.readBinaryArrayURL = function(t, e) {
        return _.registry().readBinaryArrayURL(t, e)
    }
    ,
    _.readNodeURL = function(t, e) {
        var i = t.substr(t.lastIndexOf(".") + 1)
          , n = v.instance().getReaderWriterForExtension(i);
        return void 0 !== n ? n.readNodeURL(t, e) : _.registry().readNodeURL(t, e)
    }
    ,
    _.registry = function() {
        var t = i(1250);
        return void 0 === _.registry._input && (_.registry._input = new t),
        _.registry._input
    }
    ,
    _.parseSceneGraph = function(t, e) {
        if (!(void 0 !== t.Version && t.Version > 0)) {
            r.time("osgjs.metric:ReaderParser.parseSceneGraphDeprecated");
            var i = _.parseSceneGraphDeprecated(t);
            return r.timeEnd("osgjs.metric:ReaderParser.parseSceneGraphDeprecated"),
            i
        }
        r.time("osgjs.metric:ReaderParser.parseSceneGraph");
        var a = function(t) {
            for (var e = window.Object.keys(t), i = 0, n = e.length; i < n; i++)
                if ("Generator" !== e[i] && "Version" !== e[i])
                    return e[i]
        }
          , s = a(t);
        if (s) {
            var o = {};
            o[s] = t[s];
            var u = _.registry().clone();
            u.setJSON(o);
            var l = r.objectMix(r.objectMix({}, _.registry().getOptions()), e || {});
            u.setOptions(l);
            var c = u.readObject();
            return r.timeEnd("osgjs.metric:ReaderParser.parseSceneGraph"),
            c
        }
        n.log("can't parse scenegraph " + t)
    }
    ,
    _.parseSceneGraphDeprecated = function(t) {
        var e, v = function(t, e) {
            var i = e[t];
            return void 0 === i && (i = e[t.toLowerCase()]),
            i
        }, b = function(t, e) {
            var i = v("Name", e);
            i && void 0 !== t.setName && t.setName(i)
        }, x = function(t, e) {
            b(t, e),
            t.setAmbient(v("Ambient", e)),
            t.setDiffuse(v("Diffuse", e)),
            t.setEmission(v("Emission", e)),
            t.setSpecular(v("Specular", e)),
            t.setShininess(v("Shininess", e))
        }, A = function(t, e) {
            b(t, e),
            t.setSourceRGB(e.SourceRGB),
            t.setSourceAlpha(e.SourceAlpha),
            t.setDestinationRGB(e.DestinationRGB),
            t.setDestinationAlpha(e.DestinationAlpha)
        }, y = function(t, e) {
            var i = e.MagFilter || e.mag_filter || void 0;
            i && t.setMagFilter(i);
            var r = e.MinFilter || e.min_filter || void 0;
            r && t.setMinFilter(r);
            var a = e.WrapT || e.wrap_t || void 0;
            a && t.setWrapT(a);
            var s = e.WrapS || e.wrap_s || void 0;
            s && t.setWrapS(s);
            var o = v("File", e);
            _.readImage(o).then(function(e) {
                t.setImage(e)
            })["catch"](function() {
                n.log("Can't read image")
            })
        }, S = function(t, e) {
            b(t, e);
            var r = v("Textures", e) || v("TextureAttributeList", e) || void 0;
            if (r)
                for (var o = 0, u = r.length; o < u; o++) {
                    var l = v("File", r[o]);
                    if (l) {
                        var c = i(1237)
                          , h = new c;
                        y(h, r[o]),
                        t.setTextureAttributeAndModes(o, h),
                        t.addUniform(a.createInt1(o, "Texture" + o))
                    } else
                        n.log("no texture on unit " + o + " skip it")
                }
            var d = v("BlendFunc", e);
            if (d) {
                var p = new s;
                A(p, d),
                t.setAttributeAndModes(p)
            }
            var f = v("Material", e);
            if (f) {
                var g = i(1255)
                  , m = new g;
                x(m, f),
                t.setAttributeAndModes(m)
            }
        }, C = t.children, M = t.primitives || t.Primitives || void 0, w = t.attributes || t.Attributes || void 0;
        if (M || w) {
            var T = new o;
            b(T, t),
            T.stateset = t.stateset,
            t = T;
            for (var E = 0, I = M.length; E < I; E++) {
                var k = M[E].mode;
                if (M[E].indices) {
                    var F = M[E].indices;
                    F = new u(u[F.type],F.elements,F.itemSize),
                    k = k ? l[k] : "TRIANGLES",
                    T.getPrimitiveSetList().push(new h(k,F))
                } else {
                    k = l[k];
                    var D = M[E].first
                      , N = M[E].count;
                    T.getPrimitiveSetList().push(new c(k,D,N))
                }
            }
            for (var R = window.Object.keys(w), P = 0, L = R.length; P < L; P++) {
                var O = R[P]
                  , V = w[O];
                T.getVertexAttributeList()[O] = new u(V.type,V.elements,V.itemSize)
            }
        }
        var B = v("StateSet", t);
        if (B) {
            var U = new d;
            S(U, B),
            t.stateset = U
        }
        var G = t.matrix || t.Matrix || void 0;
        G && (e = new g,
        b(e, t),
        r.extend(e, t),
        f.copy(e.getMatrix(), G),
        t = e);
        var z = t.projection || t.Projection || void 0;
        if (z && (e = new m,
        b(e, t),
        r.extend(e, t),
        f.copy(e.setProjectionMatrix(), z),
        t = e),
        void 0 === t.typeID && (e = new p,
        b(e, t),
        r.extend(e, t),
        t = e),
        C) {
            t.children = [];
            for (var H = 0, j = C.length; H < j; H++)
                t.addChild(_.parseSceneGraphDeprecated(C[H]))
        }
        return t
    }
    ,
    t.exports = _
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = function(t, e, i, n) {
        r.call(this),
        this._sourceFactor = a.DISABLE,
        this._destinationFactor = a.DISABLE,
        this._sourceFactorAlpha = this._sourceFactor,
        this._destinationFactorAlpha = this._destinationFactor,
        this._separate = !1,
        void 0 !== t && this.setSource(t),
        void 0 !== e && this.setDestination(e),
        void 0 !== i && this.setSourceAlpha(i),
        void 0 !== n && this.setDestinationAlpha(n)
    };
    a.DISABLE = -1,
    a.ZERO = 0,
    a.ONE = 1,
    a.SRC_COLOR = 768,
    a.ONE_MINUS_SRC_COLOR = 769,
    a.SRC_ALPHA = 770,
    a.ONE_MINUS_SRC_ALPHA = 771,
    a.DST_ALPHA = 772,
    a.ONE_MINUS_DST_ALPHA = 773,
    a.DST_COLOR = 774,
    a.ONE_MINUS_DST_COLOR = 775,
    a.SRC_ALPHA_SATURATE = 776,
    a.BLEND_DST_RGB = 32968,
    a.BLEND_SRC_RGB = 32969,
    a.BLEND_DST_ALPHA = 32970,
    a.BLEND_SRC_ALPHA = 32971,
    a.CONSTANT_COLOR = 32769,
    a.ONE_MINUS_CONSTANT_COLOR = 32770,
    a.CONSTANT_ALPHA = 32771,
    a.ONE_MINUS_CONSTANT_ALPHA = 32772,
    a.BLEND_COLOR = 32773,
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "BlendFunc",
        cloneType: function() {
            return new a
        },
        setSource: function(t) {
            this.setSourceRGB(t),
            this.setSourceAlpha(t)
        },
        getSource: function() {
            return this._sourceFactor
        },
        setDestination: function(t) {
            this.setDestinationRGB(t),
            this.setDestinationAlpha(t)
        },
        getDestination: function() {
            return this._destinationFactor
        },
        getSeparate: function() {
            return this._separate
        },
        checkSeparate: function() {
            return this._sourceFactor !== this._sourceFactorAlpha || this._destinationFactor !== this._destinationFactorAlpha
        },
        setSourceRGB: function(t) {
            "string" == typeof t ? this._sourceFactor = a[t] : this._sourceFactor = t,
            this._separate = this.checkSeparate()
        },
        getSourceRGB: function() {
            return this._sourceFactor
        },
        setSourceAlpha: function(t) {
            "string" == typeof t ? this._sourceFactorAlpha = a[t] : this._sourceFactorAlpha = t,
            this._separate = this.checkSeparate()
        },
        getSourceAlpha: function() {
            return this._sourceFactorAlpha
        },
        setDestinationRGB: function(t) {
            "string" == typeof t ? this._destinationFactor = a[t] : this._destinationFactor = t,
            this._separate = this.checkSeparate()
        },
        getDestinationRGB: function() {
            return this._destinationFactor
        },
        setDestinationAlpha: function(t) {
            "string" == typeof t ? this._destinationFactorAlpha = a[t] : this._destinationFactorAlpha = t,
            this._separate = this.checkSeparate()
        },
        getDestinationAlpha: function() {
            return this._destinationFactorAlpha
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            this._sourceFactor === a.DISABLE || this._destinationFactor === a.DISABLE ? e.disable(e.BLEND) : (e.enable(e.BLEND),
            this._separate ? e.blendFuncSeparate(this._sourceFactor, this._destinationFactor, this._sourceFactorAlpha, this._destinationFactorAlpha) : e.blendFunc(this._sourceFactor, this._destinationFactor))
        }
    }), "osg", "BlendFunc"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1207)
      , a = i(1210)
      , s = i(1240)
      , o = i(1206)
      , u = function(t) {
        var e;
        return t instanceof n.Float32Array && (e = 5126),
        t instanceof n.Uint32Array && (e = 5125),
        t instanceof n.Uint16Array && (e = 5123),
        t instanceof n.Uint8Array && (e = 5121),
        e
    }
      , l = function(t, e, i, r) {
        if (s.call(this),
        this._instanceID = a.getInstanceID(),
        this.dirty(),
        this._itemSize = i,
        this._target = "string" == typeof t ? l[t] : t,
        this._type = void 0,
        this._normalize = !1,
        void 0 !== e) {
            var o = e;
            r || (o = this._target === l.ELEMENT_ARRAY_BUFFER ? e instanceof n.Uint16Array ? e : new n.Uint16Array(e) : e instanceof n.Float32Array ? e : new n.Float32Array(e)),
            this.setElements(o)
        }
    };
    l.ELEMENT_ARRAY_BUFFER = 34963,
    l.ARRAY_BUFFER = 34962,
    l._sDeletedGLBufferArrayCache = new window.Map,
    l.deleteGLBufferArray = function(t, e) {
        l._sDeletedGLBufferArrayCache.has(t) || l._sDeletedGLBufferArrayCache.set(t, []),
        l._sDeletedGLBufferArrayCache.get(t).push(e)
    }
    ,
    l.flushDeletedGLBufferArrays = function(t, e) {
        if (e <= 0)
            return e;
        if (!l._sDeletedGLBufferArrayCache.has(t))
            return e;
        for (var i = 0, n = o.instance().tick(), r = l._sDeletedGLBufferArrayCache.get(t), a = r.length, s = a - 1; s >= 0 && i < e; s--)
            t.deleteBuffer(r[s]),
            r.splice(s, 1),
            i = o.instance().deltaS(n, o.instance().tick());
        return e - i
    }
    ,
    l.flushAllDeletedGLBufferArrays = function(t) {
        if (l._sDeletedGLBufferArrayCache.has(t))
            for (var e = l._sDeletedGLBufferArrayCache.get(t), i = e.length, n = i - 1; n >= 0; n--)
                t.deleteBuffer(e[n]),
                e.splice(n, 1)
    }
    ,
    l.prototype = n.objectInherit(s.prototype, {
        getInstanceID: function() {
            return this._instanceID
        },
        setItemSize: function(t) {
            this._itemSize = t
        },
        isValid: function() {
            return void 0 !== this._buffer || void 0 !== this._elements
        },
        releaseGLObjects: function() {
            void 0 !== this._buffer && null !== this._buffer && void 0 !== this._gl && l.deleteGLBufferArray(this._gl, this._buffer),
            this._buffer = void 0
        },
        setNormalize: function(t) {
            this._normalize = t
        },
        getNormalize: function() {
            return this._normalize
        },
        bind: function(t) {
            this._gl || this.setGraphicContext(t);
            var e = this._target
              , i = this._buffer;
            return i ? void t.bindBuffer(e, i) : void (!i && this._elements.length > 0 && (this._buffer = t.createBuffer(),
            this._numItems = this._elements.length / this._itemSize,
            t.bindBuffer(e, this._buffer)))
        },
        getItemSize: function() {
            return this._itemSize
        },
        dirty: function() {
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        },
        compile: function(t) {
            this._dirty && (n.timeStamp("osgjs.metrics:bufferData"),
            t.bufferData(this._target, this._elements, t.STATIC_DRAW),
            this._dirty = !1)
        },
        getElements: function() {
            return this._elements
        },
        setElements: function(t) {
            this._elements = t,
            this._type = u(t),
            this._dirty = !0
        },
        getType: function() {
            return this._type
        }
    }),
    l.create = function(t, e, i) {
        return r.log("BufferArray.create is deprecated, use new BufferArray with same arguments instead"),
        new l(t,e,i)
    }
    ,
    t.exports = l
}
, function(t, e) {
    "use strict";
    var i = {};
    i.POINTS = 0,
    i.LINES = 1,
    i.LINE_LOOP = 2,
    i.LINE_STRIP = 3,
    i.TRIANGLES = 4,
    i.TRIANGLE_STRIP = 5,
    i.TRIANGLE_FAN = 6,
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1244)
      , a = function(t, e, i) {
        this.mode = t,
        void 0 !== t && ("string" == typeof t && (t = r[t]),
        this.mode = t),
        this.first = e,
        this.count = i
    };
    a.prototype = {
        draw: function(t) {
            if (0 !== this.count) {
                var e = t.getGraphicContext();
                e.drawArrays(this.mode, this.first, this.count)
            }
        },
        getMode: function() {
            return this.mode
        },
        setCount: function(t) {
            this.count = t
        },
        getCount: function() {
            return this.count
        },
        setFirst: function(t) {
            this.first = t
        },
        getFirst: function() {
            return this.first
        },
        getNumIndices: function() {
            return this.count
        },
        index: function(t) {
            return this.first + t
        }
    },
    a.create = function(t, e, i) {
        n.log("DrawArrays.create is deprecated, use new DrawArrays with same arguments");
        var r = new a(t,e,i);
        return r
    }
    ,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1244)
      , a = function(t, e) {
        this.mode = r.POINTS,
        void 0 !== t && ("string" == typeof t && (t = r[t]),
        this.mode = t),
        this.count = 0,
        this.offset = 0,
        this.indices = e,
        this.uType = a.UNSIGNED_SHORT,
        void 0 !== e && this.setIndices(e)
    };
    a.UNSIGNED_BYTE = 5121,
    a.UNSIGNED_SHORT = 5123,
    a.UNSIGNED_INT = 5125,
    a.prototype = {
        getMode: function() {
            return this.mode
        },
        draw: function(t) {
            0 !== this.count && (t.setIndexArray(this.indices),
            this.drawElements(t))
        },
        drawElements: function(t) {
            var e = t.getGraphicContext();
            e.drawElements(this.mode, this.count, this.uType, this.offset)
        },
        setIndices: function(t) {
            this.indices = t;
            var e = t.getElements();
            this.count = e.length;
            var i = e.BYTES_PER_ELEMENT;
            1 === i ? this.uType = a.UNSIGNED_BYTE : 2 === i ? this.uType = a.UNSIGNED_SHORT : 4 === i && (this.uType = a.UNSIGNED_INT)
        },
        getIndices: function() {
            return this.indices
        },
        setFirst: function(t) {
            this.offset = t
        },
        getFirst: function() {
            return this.offset
        },
        setCount: function(t) {
            this.count = t
        },
        getCount: function() {
            return this.count
        },
        getNumIndices: function() {
            return this.indices.getElements().length
        },
        index: function(t) {
            return this.indices.getElements()[t]
        }
    },
    a.create = function(t, e) {
        return n.log("DrawElements.create is deprecated, use new DrawElements with same arguments"),
        new a(t,e)
    }
    ,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1212).mat4
      , a = i(1208)
      , s = i(1232)
      , o = function() {
        a.call(this),
        this.matrix = r.create()
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, {
        getMatrix: function() {
            return this.matrix
        },
        setMatrix: function(t) {
            this.matrix = t,
            this.dirtyBound()
        },
        computeLocalToWorldMatrix: function(t) {
            return this.referenceFrame === s.RELATIVE_RF ? r.mul(t, t, this.matrix) : r.copy(t, this.matrix),
            !0
        },
        computeWorldToLocalMatrix: function() {
            var t = r.create();
            return function(e) {
                return r.invert(t, this.matrix),
                this.referenceFrame === s.RELATIVE_RF ? r.mul(e, t, e) : r.copy(e, t),
                !0
            }
        }()
    }), "osg", "MatrixTransform"),
    n.setTypeID(o),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1209)
      , a = i(1212).mat4
      , s = function() {
        r.call(this),
        this.projection = a.create()
    };
    s.prototype = n.objectInherit(r.prototype, {
        getProjectionMatrix: function() {
            return this.projection
        },
        setProjectionMatrix: function(t) {
            this.projection = t
        }
    }),
    n.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = {
        instance: function() {
            return r._instance || (r._instance = r,
            r._instance.plugins = new window.Map),
            r._instance
        },
        addReaderWriter: function(t, e) {
            void 0 !== r.instance().plugins.get(t) && n.warn("the '" + t + "' plugin already exists"),
            r.instance().plugins.set(t, e)
        },
        getReaderWriterForExtension: function(t) {
            return r.instance().plugins.get(t)
        }
    };
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(1203)
      , a = i(1199)
      , s = i(1251)
      , o = i(1252)
      , u = i(1253)
      , l = i(1207)
      , c = i(1239)
      , h = i(1243)
      , d = i(1245)
      , p = i(1254)
      , f = i(1246)
      , g = i(1244)
      , m = function(t, e) {
        this._json = t;
        var i = e;
        void 0 === i && (i = {}),
        this._identifierMap = i,
        this._objectRegistry = {},
        this._cacheReadObject = {},
        this.setOptions(r.objectMix({}, o))
    };
    m.imageFallback || (m.imageFallback = function() {
        var t = new window.Image;
        return t.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",
        t
    }()),
    m.prototype = {
        clone: function() {
            var t = new m;
            return t._objectRegistry = this._objectRegistry,
            t._cacheReadObject = this._cacheReadObject,
            t
        },
        setOptions: function(t) {
            this._defaultOptions = t
        },
        getOptions: function() {
            return this._defaultOptions
        },
        setProgressXHRCallback: function(t) {
            this._defaultOptions.progressXHRCallback = t
        },
        setReadNodeURLCallback: function(t) {
            this._defaultOptions.readNodeURL = t
        },
        registerObject: function(t, e) {
            this._objectRegistry[t] = e
        },
        getJSON: function() {
            return this._json
        },
        setJSON: function(t) {
            return this._json = t,
            this
        },
        setPrefixURL: function(t) {
            this._defaultOptions.prefixURL = t
        },
        getPrefixURL: function() {
            return this._defaultOptions.prefixURL
        },
        setDatabasePath: function(t) {
            this._defaultOptions.databasePath = t
        },
        getDatabasePath: function() {
            return this._defaultOptions.databasePath
        },
        computeURL: function(t) {
            return "string" == typeof this._defaultOptions.prefixURL && this._defaultOptions.prefixURL.length > 0 ? this._defaultOptions.prefixURL + t : t
        },
        requestFile: function(t, e) {
            return s(t, e)
        },
        getObjectWrapper: function(t) {
            if (this._objectRegistry[t])
                return new this._objectRegistry[t];
            for (var e = a, i = t.split("."), n = 0, r = i.length; n < r; n++) {
                var s = e[i[n]];
                if (void 0 === s)
                    return;
                e = s
            }
            return this._objectRegistry[t] = e,
            new e
        },
        fetchImage: function(t, e, i, n) {
            var r = "data:image/"
              , a = e.substring(0, r.length) === r
              , s = new window.Image;
            return s.onerror = function() {
                l.warn("warning use white texture as fallback instead of " + e),
                t.setImage(m.imageFallback),
                n && n.resolve(t)
            }
            ,
            !a && i.imageCrossOrigin && (s.crossOrigin = i.imageCrossOrigin),
            s.onload = function() {
                n ? (i.imageOnload && i.imageOnload.call(t),
                n.resolve(t)) : i.imageOnload && i.imageOnload.call(t)
            }
            ,
            t.setURL(e),
            t.setImage(s),
            s.src = e,
            t
        },
        readImageURL: function(t, e) {
            if (void 0 === e && (e = this._defaultOptions),
            e.readImageURL)
                return e.readImageURL.call(this, t, e);
            "data:image" !== t.substr(0, 10) && (t = this.computeURL(t));
            var i = new c;
            if (e.imageLoadingUsePromise !== !0)
                return this.fetchImage(i, t, e);
            var r = n.defer();
            return this.fetchImage(i, t, e, r),
            r.promise
        },
        readNodeURL: function(t, e) {
            var a = e;
            if (void 0 === a && (a = this._defaultOptions),
            a.readNodeURL)
                return a.readNodeURL.call(this, t, a);
            t = this.computeURL(t);
            var s = n.defer();
            if (a = r.objectMix({}, a),
            !a.prefixURL) {
                var o = this.getPrefixURL()
                  , c = t.lastIndexOf("/");
                c !== -1 && (o = t.substring(0, c + 1)),
                a.prefixURL = o
            }
            var h = this
              , d = i(1241)
              , p = function(e) {
                d.parseSceneGraph(e, a).then(function(e) {
                    s.resolve(e),
                    l.log("loaded " + t)
                })["catch"](s.reject.bind(s))
            }
              , f = function(t) {
                function e(t) {
                    return t.length < 2 ? "0" + t : t
                }
                function i(t) {
                    for (var i = "", n = 0, r = t.length; n < r; ++n)
                        i += "%" + e(t[n].toString(16));
                    return i = decodeURIComponent(i)
                }
                var n = t;
                u.isGunzipBuffer(t) && (n = u.gunzip(t));
                var r = new Uint8Array(n)
                  , a = i(r);
                return a
            }
              , g = h.requestFile(t);
            return g.then(function(e) {
                var i;
                try {
                    i = JSON.parse(e)
                } catch (n) {
                    l.error("cant parse url " + t + " try to gunzip")
                }
                if (i)
                    return p(i);
                var r = h.requestFile(t, {
                    responseType: "arraybuffer"
                });
                return r.then(function(t) {
                    var e = f(t);
                    i = JSON.parse(e),
                    p(i)
                })["catch"](function(e) {
                    l.error("cant read file " + t + " status " + e),
                    s.reject()
                }).done(),
                !0
            })["catch"](function(e) {
                l.error("cant get file " + t + " status " + e),
                s.reject()
            }).done(),
            s.promise
        },
        _unzipTypedArray: function(t) {
            var e = new Uint8Array(t);
            if (31 === e[0] && 139 === e[1]) {
                var n = i(1253);
                n || l.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server");
                var r = new n.Gunzip(e)
                  , a = r.decompress();
                return a.buffer
            }
            return t
        },
        readBinaryArrayURL: function(t, e) {
            if (void 0 === e && (e = this._defaultOptions),
            e.readBinaryArrayURL)
                return e.readBinaryArrayURL.call(this, t, e);
            if (t = this.computeURL(t),
            void 0 !== this._identifierMap[t])
                return this._identifierMap[t];
            var i = n.defer()
              , r = this.requestFile(t, {
                responseType: "arraybuffer",
                progress: this._defaultOptions.progressXHRCallback
            });
            return this._identifierMap[t] = i.promise,
            r.then(function(t) {
                i.resolve(this._unzipTypedArray(t))
            }
            .bind(this)),
            i.promise
        },
        initializeBufferArray: function(t, e, i, a) {
            if (void 0 === a && (a = this.getOptions()),
            a.initializeBufferArray)
                return a.initializeBufferArray.call(this, t, e, i);
            var s = t.File
              , o = n.defer();
            return this.readBinaryArrayURL(s).then(function(n) {
                var a, s;
                !function() {
                    var t = new Uint8Array([18, 52])
                      , e = new Uint16Array(t.buffer);
                    s = "1234" === e[0].toString(16)
                }();
                var u = 0;
                void 0 !== t.Offset && (u = t.Offset);
                var c = r[e].BYTES_PER_ELEMENT
                  , h = t.Size
                  , d = i.getItemSize()
                  , p = h * c * d;
                if (s) {
                    l.log("big endian detected");
                    var f = r[e]
                      , g = new f(h * d)
                      , m = new DataView(n,u,p)
                      , v = 0
                      , _ = g.length;
                    if ("Uint16Array" === e)
                        for (; v < _; v++)
                            g[v] = m.getUint16(v * c, !0);
                    else if ("Float32Array" === e)
                        for (; v < _; v++)
                            g[v] = m.getFloat32(v * c, !0);
                    a = g,
                    m = null
                } else
                    a = new r[e](n,u,d * h);
                i.setElements(a),
                o.resolve(i)
            })["catch"](function() {
                l.warn("Can't read binary array URL")
            }),
            o.promise
        },
        readBufferArray: function(t) {
            var e, i = this.getJSON(), a = i.UniqueID;
            if (void 0 !== a && (e = this._identifierMap[a],
            void 0 !== e))
                return e;
            if (void 0 === t && (t = this.getOptions()),
            t.readBufferArray)
                return t.readBufferArray.call(this);
            if (!i.Elements && !i.Array || !i.ItemSize || !i.Type)
                return n.reject();
            var s;
            if (i.Elements)
                s = n.resolve(new h(h[i.Type],i.Elements,i.ItemSize));
            else if (i.Array) {
                var o = new h(h[i.Type]);
                o.setItemSize(i.ItemSize);
                var u, c;
                if (i.Array.Float32Array ? (u = i.Array.Float32Array,
                c = "Float32Array") : i.Array.Uint16Array ? (u = i.Array.Uint16Array,
                c = "Uint16Array") : i.Array.Uint8Array && (u = i.Array.Uint8Array,
                c = "Uint8Array"),
                void 0 === u)
                    return l.warn("Typed Array " + window.Object.keys(i.Array)[0]),
                    n.reject();
                u.File ? s = this.initializeBufferArray(u, c, o) : u.Elements && (o.setElements(new r[c](u.Elements)),
                s = n.resolve(o))
            }
            return void 0 !== a && (this._identifierMap[a] = s),
            s
        },
        readUserDataContainer: function() {
            var t, e = this.getJSON(), i = e.UniqueID;
            return void 0 !== i && (t = this._identifierMap[i],
            void 0 !== t) ? t.Values : (this._identifierMap[i] = e,
            e.Values)
        },
        readPrimitiveSet: function() {
            var t, e, i, r, a, s, o = this.getJSON(), u = n.defer(), c = o.DrawElementUShort || o.DrawElementUByte || o.DrawElementUInt || o.DrawElementsUShort || o.DrawElementsUByte || o.DrawElementsUInt || void 0;
            if (c) {
                if (t = c.UniqueID,
                void 0 !== t && (e = this._identifierMap[t],
                void 0 !== e))
                    return e;
                var h = c.Indices
                  , m = o;
                r = c.Mode,
                r = r ? g[r] : g.TRIANGLES,
                i = new f(r),
                this.setJSON(h),
                this.readBufferArray().then(function(t) {
                    i.setIndices(t),
                    u.resolve(i)
                })["catch"](function() {
                    l.warn("Error buffer array")
                }),
                this.setJSON(m)
            }
            var v = o.DrawArray || o.DrawArrays;
            if (v) {
                if (t = v.UniqueID,
                void 0 !== t && (e = this._identifierMap[t],
                void 0 !== e))
                    return e;
                r = v.Mode || v.mode,
                a = void 0 !== v.First ? v.First : v.first,
                s = void 0 !== v.Count ? v.Count : v.count;
                var _ = new d(g[r],a,s);
                u.resolve(_)
            }
            var b = o.DrawArrayLengths || void 0;
            if (b) {
                if (t = b.UniqueID,
                void 0 !== t && (e = this._identifierMap[t],
                void 0 !== e))
                    return e;
                r = b.Mode,
                a = b.First;
                var x = b.ArrayLengths
                  , A = new p(g[r],a,x);
                u.resolve(A)
            }
            return void 0 !== t && (this._identifierMap[t] = u.promise),
            u.promise
        },
        readObject: function() {
            var t = this.getJSON()
              , e = window.Object.keys(t)[0];
            if (!e)
                return l.warn("can't find property for object " + t),
                n.reject();
            var r, a = t[e].UniqueID;
            if (void 0 !== a && (r = this._identifierMap[a],
            void 0 !== r))
                return r;
            var s = this.getObjectWrapper(e);
            if (!s)
                return l.warn("can't instanciate object " + e),
                n.reject();
            var o = i(1241)
              , u = o.ObjectWrapper.serializers;
            if (this._cacheReadObject[e])
                u = this._cacheReadObject[e];
            else {
                for (var c = e.split("."), h = 0, d = c.length; h < d; h++) {
                    var p = u[c[h]];
                    if (void 0 === p)
                        return l.warn("can't find function to read object " + e + " - undefined"),
                        n.reject();
                    u = p
                }
                this._cacheReadObject[e] = u
            }
            var f = u(this.setJSON(t[e]), s);
            return void 0 !== a && (this._identifierMap[a] = f,
            s._uniqueID = a),
            f
        }
    },
    t.exports = m
}
, function(t, e, i) {
    var n = i(235)
      , r = function(t, e) {
        var i = n.defer()
          , r = new XMLHttpRequest;
        return r.open("GET", t, !0),
        e && e.responseType && (r.responseType = e.responseType),
        e && e.progress && r.addEventListener("progress", e.progress, !1),
        r.addEventListener("error", function() {
            i.reject()
        }, !1),
        r.addEventListener("load", function() {
            "arraybuffer" === r.responseType || "blob" === r.responseType ? i.resolve(r.response) : i.resolve(r.responseText)
        }),
        r.send(null),
        i.promise
    };
    t.exports = r
}
, function(t, e) {
    "use strict";
    var i = {
        prefixURL: "",
        databasePath: "",
        progressXHRCallback: void 0,
        readNodeURL: void 0,
        readImageURL: void 0,
        readBinaryArrayURL: void 0,
        imageLoadingUsePromise: !0,
        imageOnload: void 0,
        imageCrossOrigin: void 0
    };
    t.exports = i
}
, function(t, e) {}
, function(t, e) {
    "use strict";
    var i = function(t, e, i) {
        this._mode = t,
        this._first = e,
        this._arrayLengths = i.slice(0)
    };
    i.prototype = {
        draw: function(t) {
            for (var e = t.getGraphicContext(), i = this._mode, n = this._first, r = this._arrayLengths, a = 0, s = r.length; a < s; a++) {
                var o = r[a];
                e.drawArrays(i, n, o),
                n += o
            }
        },
        getMode: function() {
            return this._mode
        },
        getNumIndices: function() {
            for (var t = 0, e = this._arrayLengths, i = 0, n = e.length; i < n; i++)
                t += e[i];
            return t
        },
        getCount: function() {
            return this.getNumIndices()
        },
        getArrayLengths: function() {
            return this._arrayLengths
        },
        getFirst: function() {
            return this._first
        },
        setFirst: function(t) {
            this._first = t
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = i(1212).vec4
      , s = i(1238)
      , o = i(1227)
      , u = function() {
        r.call(this),
        this._ambient = a.fromValues(.2, .2, .2, 1),
        this._diffuse = a.fromValues(.8, .8, .8, 1),
        this._specular = a.fromValues(0, 0, 0, 1),
        this._emission = a.fromValues(0, 0, 0, 1),
        this._shininess = 12.5
    };
    u.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Material",
        cloneType: function() {
            return new u
        },
        getParameterName: function(t) {
            return "u" + this.getType() + "_" + t
        },
        getOrCreateUniforms: function() {
            var t = u;
            if (t.uniforms)
                return t.uniforms;
            var e = {
                ambient: s.createFloat4("uMaterialAmbient"),
                diffuse: s.createFloat4("uMaterialDiffuse"),
                specular: s.createFloat4("uMaterialSpecular"),
                emission: s.createFloat4("uMaterialEmission"),
                shininess: s.createFloat1("uMaterialShininess")
            };
            return t.uniforms = new o(e),
            t.uniforms
        },
        setEmission: function(t) {
            a.copy(this._emission, t)
        },
        getEmission: function() {
            return this._emission
        },
        setAmbient: function(t) {
            a.copy(this._ambient, t)
        },
        getAmbient: function() {
            return this._ambient
        },
        setSpecular: function(t) {
            a.copy(this._specular, t)
        },
        getSpecular: function() {
            return this._specular
        },
        setDiffuse: function(t) {
            a.copy(this._diffuse, t)
        },
        getDiffuse: function() {
            return this._diffuse
        },
        setShininess: function(t) {
            this._shininess = t
        },
        getShininess: function() {
            return this._shininess
        },
        setTransparency: function(t) {
            this._diffuse[3] = 1 - t
        },
        getTransparency: function() {
            return this._diffuse[3]
        },
        apply: function() {
            var t = this.getOrCreateUniforms();
            t.ambient.setFloat4(this._ambient),
            t.diffuse.setFloat4(this._diffuse),
            t.specular.setFloat4(this._specular),
            t.emission.setFloat4(this._emission),
            t.shininess.setFloat(this._shininess)
        }
    }), "osg", "Material"),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1206)
      , a = function(t, e, i, n) {
        this._target = t,
        this._internalFormat = e,
        this._width = i,
        this._height = n,
        this._size = 0,
        this.computeSize()
    };
    a.prototype = {
        match: function(t) {
            return t._target === this._target && t._internalFormat === this._internalFormat && t._width === this._width && t._height === this._height
        },
        computeSize: function() {
            var t = i(1237)
              , e = 0;
            switch (this._internalFormat) {
            case 1:
                e = 8;
                break;
            case t.ALPHA:
                e = 8;
                break;
            case t.LUMINANCE:
                e = 8;
                break;
            case t.LUMINANCE_ALPHA:
                e = 16;
                break;
            case 2:
                e = 16;
                break;
            case t.RGB:
                e = 24;
                break;
            case 3:
                e = 24;
                break;
            case t.RGBA:
                e = 32;
                break;
            case 4:
                e = 32
            }
            var n = Math.ceil(this._width * this._height * e) / 8;
            this._target === t.TEXTURE_CUBE_MAP && (n *= 6),
            n += n / 3,
            this._size = n
        },
        getSize: function() {
            return this._size
        }
    },
    a.getHash = function() {
        var t = Array.prototype.slice.call(arguments)
          , e = "";
        return t.forEach(function(t) {
            e += t
        }),
        e
    }
    ;
    var s = function(t, e, i) {
        this._texture = t,
        this._id = e,
        this._textureSet = i
    };
    s.prototype = {
        target: function() {
            return this._textureSet._profile._target
        },
        id: function() {
            return this._id
        },
        getTextureSet: function() {
            return this._textureSet
        },
        reset: function() {
            this._textureObject = null,
            this._texture = void 0
        },
        bind: function(t) {
            t.bindTexture(this.target(), this._id)
        }
    };
    var o = function(t) {
        this._profile = t,
        this._usedTextureObjects = [],
        this._orphanedTextureObjects = []
    };
    o.prototype = {
        getProfile: function() {
            return this._profile
        },
        getUsedTextureObjects: function() {
            return this._usedTextureObjects
        },
        getOrphanedTextureObjects: function() {
            return this._orphanedTextureObjects
        },
        takeOrGenerate: function(t, e) {
            var i;
            if (this._orphanedTextureObjects.length > 0)
                return i = this.takeFromOrphans(),
                i._texture = e,
                this._usedTextureObjects.push(i),
                i;
            var n = t.createTexture();
            return i = new s(e,n,this),
            this._usedTextureObjects.push(i),
            i
        },
        takeFromOrphans: function() {
            if (this._orphanedTextureObjects.length)
                return this._orphanedTextureObjects.pop()
        },
        orphan: function(t) {
            var e = this._usedTextureObjects.indexOf(t);
            e !== -1 && (this._orphanedTextureObjects.push(this._usedTextureObjects[e]),
            this._usedTextureObjects.splice(e, 1))
        },
        flushDeletedTextureObjects: function(t, e) {
            if (e <= 0)
                return e;
            var i, n = this._orphanedTextureObjects.length, a = 0, s = r.instance().tick();
            for (i = 0; i < n && a < e; i++)
                t.deleteTexture(this._orphanedTextureObjects[i].id()),
                this._orphanedTextureObjects[i].reset(),
                a = r.instance().deltaS(s, r.instance().tick());
            return this._orphanedTextureObjects.splice(0, i),
            e - a
        },
        flushAllDeletedTextureObjects: function(t) {
            for (var e = this._orphanedTextureObjects.length, i = this.getProfile().getSize(), r = 0, a = e; r < a; ++r)
                t.deleteTexture(this._orphanedTextureObjects[r].id()),
                this._orphanedTextureObjects[r].reset();
            this._orphanedTextureObjects.length = 0,
            n.info("TextureManager: released " + e + " with " + e * i / 1048576 + " MB")
        }
    };
    var u = function() {
        this._textureSetMap = {}
    };
    u.prototype = {
        generateTextureObject: function(t, e, i, n, r, s) {
            var u = a.getHash(i, n, r, s);
            void 0 === this._textureSetMap[u] && (this._textureSetMap[u] = new o(new a(i,n,r,s)));
            var l = this._textureSetMap[u]
              , c = l.takeOrGenerate(t, e);
            return c
        },
        updateStats: function(t, e) {
            var i = 0
              , n = 0;
            window.Object.keys(this._textureSetMap).forEach(function(t) {
                var e = this._textureSetMap[t].getProfile()
                  , r = e.getSize()
                  , a = this._textureSetMap[t].getUsedTextureObjects().length
                  , s = this._textureSetMap[t].getOrphanedTextureObjects().length;
                i += a * r,
                n += s * r
            }, this);
            var r = 1048576;
            e("textureused").set(i / r),
            e("texturereserved").set(n / r),
            e("texturetotal").set((i + n) / r)
        },
        reportStats: function() {
            var t = 0;
            window.Object.keys(this._textureSetMap).forEach(function(e) {
                var i = this._textureSetMap[e].getProfile()
                  , r = i.getSize() / 1048576
                  , a = this._textureSetMap[e].getUsedTextureObjects().length;
                r *= a,
                t += r,
                n.notice(String(r) + " MB with " + a + " texture of " + i._width + "x" + i._height + " " + i._internalFormat)
            }, this),
            n.notice(String(t) + " MB in total")
        },
        flushAllDeletedTextureObjects: function(t) {
            window.Object.keys(this._textureSetMap).forEach(function(e) {
                this._textureSetMap[e].flushAllDeletedTextureObjects(t)
            }, this)
        },
        flushDeletedTextureObjects: function(t, e) {
            for (var i = e, n = window.Object.keys(this._textureSetMap), r = 0, a = n.length; r < a && i > 0; r++)
                i = this._textureSetMap[n[r]].flushDeletedTextureObjects(t, i);
            return i
        },
        releaseTextureObject: function(t) {
            if (t) {
                var e = t.getTextureSet();
                e.orphan(t)
            }
        }
    },
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1243)
      , r = function(t) {
        this._initialBufferArray = void 0,
        this._bufferArray = void 0,
        t && (this.setBufferArray(t),
        this.setInitialBufferArray(t))
    }
      , a = {
        setInitialBufferArray: function(t) {
            this._initialBufferArray = t
        },
        getInitialBufferArray: function() {
            return this._initialBufferArray
        },
        setBufferArray: function(t) {
            this._bufferArray = t.getBufferArray ? t.getBufferArray() : t
        },
        getBufferArray: function() {
            return this._bufferArray
        }
    }
      , s = window.Object.keys(n.prototype);
    s.forEach(function(t) {
        a[t] = function() {
            return n.prototype[t].apply(this._bufferArray, arguments)
        }
    }),
    r.prototype = a,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = function() {
        r.call(this),
        this._attributeEnable = !1
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Billboard",
        cloneType: function() {
            return new a
        },
        setEnabled: function(t) {
            this._attributeEnable = t
        },
        isEnabled: function() {
            return this._attributeEnable
        },
        apply: function() {}
    }), "osg", "Billboard"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = i(1212).vec4
      , s = function(t) {
        r.call(this),
        this._constantColor = a.create(),
        a.set(this._constantColor, 1, 1, 1, 1),
        void 0 !== t && this.setConstantColor(t)
    };
    s.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "BlendColor",
        cloneType: function() {
            return new s
        },
        setConstantColor: function(t) {
            a.copy(this._constantColor, t)
        },
        getConstantColor: function() {
            return this._constantColor
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            e.blendColor(this._constantColor[0], this._constantColor[1], this._constantColor[2], this._constantColor[3])
        }
    }), "osg", "BlendColor"),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1208)
      , a = i(1261)
      , s = i(1212).mat4
      , o = i(1237)
      , u = i(1232)
      , l = i(1212).vec4
      , c = function() {
        r.call(this),
        a.call(this),
        this.viewport = void 0,
        this._graphicContext = void 0,
        this.setClearColor(l.fromValues(0, 0, 0, 1)),
        this.setClearDepth(1),
        this.setClearMask(c.COLOR_BUFFER_BIT | c.DEPTH_BUFFER_BIT),
        this.setViewMatrix(s.create()),
        this.setProjectionMatrix(s.create()),
        this.renderOrder = c.NESTED_RENDER,
        this.renderOrderNum = 0,
        this._view = void 0,
        this._renderer = void 0,
        this._attachments = {}
    };
    c.PRE_RENDER = 0,
    c.NESTED_RENDER = 1,
    c.POST_RENDER = 2,
    c.COLOR_BUFFER_BIT = 16384,
    c.DEPTH_BUFFER_BIT = 256,
    c.STENCIL_BUFFER_BIT = 1024,
    c.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, n.objectInherit(r.prototype, {
        getView: function() {
            return this._view
        },
        setView: function(t) {
            this._view = t
        },
        getRenderer: function() {
            return this._renderer
        },
        setRenderer: function(t) {
            this._renderer = t
        },
        setFinalDrawCallback: function(t) {
            this._finalDrawCallback = t
        },
        getFinalDrawCallback: function() {
            return this._finalDrawCallback
        },
        setInitialDrawCallback: function(t) {
            this._initialDrawCallback = t
        },
        getInitialDrawCallback: function() {
            return this._initialDrawCallback
        },
        getAttachments: function() {
            return this._attachments
        },
        setGraphicContext: function(t) {
            this._graphicContext = t
        },
        getGraphicContext: function() {
            return this._graphicContext
        },
        setClearDepth: function(t) {
            this.clearDepth = t
        },
        getClearDepth: function() {
            return this.clearDepth
        },
        setClearMask: function(t) {
            this.clearMask = t
        },
        getClearMask: function() {
            return this.clearMask
        },
        setClearColor: function(t) {
            this.clearColor = t
        },
        getClearColor: function() {
            return this.clearColor
        },
        setViewport: function(t) {
            this.viewport = t,
            this.getOrCreateStateSet().setAttributeAndModes(t)
        },
        getViewport: function() {
            return this.viewport
        },
        setViewMatrix: function(t) {
            this.modelviewMatrix = t
        },
        setViewMatrixAsLookAt: function(t, e, i) {
            s.lookAt(this.getViewMatrix(), t, e, i)
        },
        setProjectionMatrix: function(t) {
            this.projectionMatrix = t
        },
        setProjectionMatrixAsOrtho: function(t, e, i, n, r, a) {
            s.ortho(this.getProjectionMatrix(), t, e, i, n, r, a)
        },
        isRenderToTextureCamera: function() {
            return window.Object.keys(this._attachments).length > 0
        },
        getViewMatrix: function() {
            return this.modelviewMatrix
        },
        getProjectionMatrix: function() {
            return this.projectionMatrix
        },
        getRenderOrder: function() {
            return this.renderOrder
        },
        setRenderOrder: function(t, e) {
            this.renderOrder = t,
            this.renderOrderNum = e
        },
        detachAll: function() {
            this._attachments = {},
            this.frameBufferObject && this.frameBufferObject.dirty()
        },
        resetAttachments: function() {
            this.frameBufferObject && (this.frameBufferObject.reset(),
            this.frameBufferObject = 0),
            this._attachments = {}
        },
        attachTexture: function(t, e, i) {
            this.frameBufferObject && this.frameBufferObject.dirty(),
            i || (i = o.TEXTURE_2D),
            this._attachments[t] = {
                attachment: t,
                texture: e,
                textureTarget: i
            }
        },
        attachRenderBuffer: function(t, e) {
            this.frameBufferObject && this.frameBufferObject.dirty(),
            this._attachments[t] = {
                format: e,
                attachment: t
            }
        },
        computeLocalToWorldMatrix: function(t) {
            return this.referenceFrame === u.RELATIVE_RF ? s.mul(t, t, this.modelviewMatrix) : s.copy(t, this.modelviewMatrix),
            !0
        },
        computeWorldToLocalMatrix: function() {
            var t = s.create();
            return function(e) {
                return s.invert(t, this.modelviewMatrix),
                this.referenceFrame === u.RELATIVE_RF ? s.mul(e, t, e) : s.copy(e, t),
                !0
            }
        }()
    })), "osg", "Camera"),
    n.setTypeID(c),
    t.exports = c
}
, function(t, e) {
    "use strict";
    var i = function() {
        i.prototype.reset.call(this)
    };
    i.prototype = {
        reset: function() {
            this._computeNearFar = !0,
            this._nearFarRatio = .005,
            this.bbCornerFar = 3,
            this.bbCornerNear = 4,
            this._enableFrustumCulling = !1,
            this._settingsSourceOverrider = this,
            this._LODScale = 1,
            this._clampProjectionMatrixCallback = void 0
        },
        setCullSettings: function(t) {
            this._computeNearFar = t._computeNearFar,
            this._nearFarRatio = t._nearFarRatio,
            this._enableFrustumCulling = t._enableFrustumCulling,
            this._settingsSourceOverrider = t._settingsSourceOverrider,
            this._clampProjectionMatrixCallback = t._clampProjectionMatrixCallback
        },
        setNearFarRatio: function(t) {
            this._nearFarRatio = t
        },
        getNearFarRatio: function() {
            return this._nearFarRatio
        },
        setComputeNearFar: function(t) {
            this._computeNearFar = t
        },
        getComputeNearFar: function() {
            return this._computeNearFar
        },
        setEnableFrustumCulling: function(t) {
            this._enableFrustumCulling = t
        },
        getEnableFrustumCulling: function() {
            return this._enableFrustumCulling
        },
        getSettingSourceOverrider: function() {
            return this._settingsSourceOverrider
        },
        setClampProjectionMatrixCallback: function(t) {
            this._clampProjectionMatrixCallback = t
        },
        getClampProjectionMatrixCallback: function() {
            return this._clampProjectionMatrixCallback
        },
        setLODScale: function(t) {
            this._LODScale = t
        },
        getLODScale: function() {
            return this._LODScale
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = function(t, e, i, n) {
        r.call(this),
        this._colorMask = [!0, !0, !0, !0],
        this.setMask(t, e, i, n)
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "ColorMask",
        cloneType: function() {
            return new a
        },
        setMask: function(t, e, i, n) {
            void 0 !== t && void 0 !== e && void 0 !== i && void 0 !== n && (this._colorMask[0] = t,
            this._colorMask[1] = e,
            this._colorMask[2] = i,
            this._colorMask[3] = n)
        },
        apply: function(t) {
            var e = t.getGraphicContext()
              , i = this._colorMask;
            e.colorMask(i[0], i[1], i[2], i[3])
        }
    }), "osg", "ColorMask"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = function(t) {
        r.call(this),
        this.setMode(void 0 !== t ? t : a.BACK)
    };
    a.DISABLE = 0,
    a.FRONT = 1028,
    a.BACK = 1029,
    a.FRONT_AND_BACK = 1032,
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "CullFace",
        cloneType: function() {
            return new a
        },
        setMode: function(t) {
            var e = t;
            "string" == typeof e && (e = a[e]),
            this._mode = e
        },
        getMode: function() {
            return this._mode
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            this._mode === a.DISABLE ? e.disable(e.CULL_FACE) : (e.enable(e.CULL_FACE),
            e.cullFace(this._mode))
        }
    }), "osg", "CullFace"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1265)
      , r = function() {
        this._mask = r.DEFAULT_CULLING,
        this._frustum = new n
    };
    r.prototype = {
        reset: function() {
            this._mask = r.DEFAULT_CULLING,
            this._frustum.clear()
        },
        setCullingMask: function(t) {
            this._mask = t
        },
        getCullingMask: function() {
            return this._mask
        },
        setFrustum: function(t) {
            this._frustum = t
        },
        getFrustum: function() {
            return this._frustum
        },
        getCurrentResultMask: function() {
            return this._frustum.getCurrentMask()
        },
        pushCurrentMask: function() {
            this._frustum.pushCurrentMask()
        },
        popCurrentMask: function() {
            this._frustum.popCurrentMask()
        },
        resetCullingMask: function() {
            this._frustum.setResultMask(this._frustum.getCurrentMask())
        },
        isBoundingBoxCulled: function(t) {
            return !(!(this._mask & r.VIEW_FRUSTUM_CULLING) || this._frustum.containsBoundingBox(t))
        },
        isBoundingSphereCulled: function(t) {
            return !(!(this._mask & r.VIEW_FRUSTUM_CULLING) || this._frustum.containsBoundingSphere(t))
        },
        isVerticesCulled: function(t) {
            return !(!(this._mask & r.VIEW_FRUSTUM_CULLING) || this._frustum.containsVertices(t))
        }
    },
    r.NO_CULLING = 0,
    r.VIEW_FRUSTUM_LEFT_CULLING = 1,
    r.VIEW_FRUSTUM_RIGHT_CULLING = 2,
    r.VIEW_FRUSTUM_TOP_CULLING = 3,
    r.VIEW_FRUSTUM_BOTTOM_CULLING = 4,
    r.NEAR_PLANE_CULLING = 5,
    r.FAR_PLANE_CULLING = 6,
    r.VIEW_FRUSTUM_SIDES_CULLING = r.VIEW_FRUSTUM_LEFT_CULLING | r.VIEW_FRUSTUM_RIGHT_CULLING | r.VIEW_FRUSTUM_BOTTOM_CULLING | r.VIEW_FRUSTUM_TOP_CULLING,
    r.VIEW_FRUSTUM_CULLING = r.VIEW_FRUSTUM_SIDES_CULLING | r.NEAR_PLANE_CULLING | r.FAR_PLANE_CULLING,
    r.DEFAULT_CULLING = r.VIEW_FRUSTUM_SIDES_CULLING,
    r.ENABLE_ALL_CULLING = r.VIEW_FRUSTUM_CULLING,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1210)
      , r = i(1266)
      , a = i(1203)
      , s = i(1212).vec4
      , o = function() {
        this._clippingMask = 0,
        this._planeList = [r.create(), r.create(), r.create(), r.create(), r.create(), r.create()],
        this._vertexList = [],
        this._maskStack = [],
        this._resultMask = 0,
        this._maskStack.push(this._resultMask)
    };
    o.prototype = a.objectInherit(n.prototype, {
        getPlanes: function() {
            return this._planeList
        },
        setPlanes: function(t) {
            this._planeList = t,
            this.setupMask()
        },
        clear: function() {
            if (this._clippingMask = 0,
            this._planeList)
                for (var t = 0, e = this._planeList.length; t < e; ++t)
                    r.init(this._planeList[t]);
            this._vertexList = [],
            this.setupMask()
        },
        setToUnitFrustum: function(t, e) {
            void 0 === t && (t = !0),
            void 0 === e && (e = !0),
            this._planeList.length = 0,
            this._planeList.push(s.set(r.create(), 1, 0, 0, 1)),
            this._planeList.push(s.set(r.create(), -1, 0, 0, 1)),
            this._planeList.push(s.set(r.create(), 0, 1, 0, 1)),
            this._planeList.push(s.set(r.create(), 0, -1, 0, 1)),
            t && this._planeList.push(s.set(r.create(), 0, 0, 1, 1)),
            e && this._planeList.push(s.set(r.create(), 0, 0, -1, 1)),
            this.setupMask()
        },
        setToBoundingBox: function(t) {
            this._planeList.length = 0,
            this._planeList.push(s.set(r.create(), 1, 0, 0, -t.getMin()[0])),
            this._planeList.push(s.set(r.create(), -1, 0, 0, t.getMax()[0])),
            this._planeList.push(s.set(r.create(), 0, 1, 0, -t.getMin()[1])),
            this._planeList.push(s.set(r.create(), 0, -1, 0, t.getMax()[1])),
            this._planeList.push(s.set(r.create(), 0, 0, 1, -t.getMin()[2])),
            this._planeList.push(s.set(r.create(), 0, 0, -1, t.getMax()[2])),
            this.setupMask()
        },
        setAndTransformProvidingInverse: function(t, e) {
            this._referenceVertexList = t._referenceVertexList;
            var i = t._maskStack[this._maskStack.length - 1];
            if (0 === i)
                return this._maskStack[this._maskStack.length - 1] = 0,
                this._resultMask = 0,
                void (this._planeList.length = 0);
            var n, a = 1, s = 0;
            for (n = 0; n !== t._planeList.length; ++n)
                i & a && ++s,
                a <<= 1;
            this._planeList.length = s,
            this._resultMask = 0,
            a = 1;
            var o = 0;
            for (n = 0; n !== t._planeList.length; ++n)
                i & a && (this._planeList[o] = t._planeList[n],
                r.transformProvidingInverse(this._planeList[o++], e),
                this._resultMask = this._resultMask << 1 | 1),
                a <<= 1;
            this._maskStack[this._maskStack.length - 1] = this._resultMask
        },
        voidset: function(t) {
            this._planeList = t,
            this.setupMask()
        },
        add: function(t) {
            this._planeList.push(t),
            this.setupMask()
        },
        empty: function() {
            return 0 === this._planeList.length
        },
        getPlaneList: function() {
            return this._planeList
        },
        setReferenceVertexList: function(t) {
            this._referenceVertexList = t
        },
        getReferenceVertexList: function() {
            return this._referenceVertexList
        },
        setupMask: function(t) {
            this._resultMask = 0;
            for (var e = void 0 !== t ? t : this._planeList.length, i = 0; i < e; ++i)
                this._resultMask = this._resultMask << 1 | 1;
            this._maskStack = [],
            this._maskStack.push(this._resultMask)
        },
        getCurrentMask: function() {
            return this._maskStack[this._maskStack.length - 1]
        },
        setResultMask: function(t) {
            this._resultMask = t
        },
        getResultMask: function() {
            return this._resultMask
        },
        getMaskStack: function() {
            return this._maskStack
        },
        pushCurrentMask: function() {
            this._maskStack.push(this._resultMask)
        },
        popCurrentMask: function() {
            return this._maskStack.pop()
        },
        containsVertex: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !0;
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._maskStack[this._maskStack.length - 1] & e && r.distanceToPlane(this._planeList[i], t) < 0)
                    return !1;
                e <<= 1
            }
            return !0
        },
        containsVertices: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !0;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 0; e < t.length; ++e) {
                for (var i = t[e], n = !1, a = 1, s = 0; !n && s < this._planeList.length; ++s)
                    this._maskStack[this._maskStack.length - 1] & a && r.distanceToPlane(this._planeList[s], i) < 0 && (n = !0),
                    a <<= 1;
                if (!n)
                    return !0
            }
            return !1
        },
        containsBoundingSphere: function(t) {
            if (!this._maskStack[this._maskStack.length - 1] || !t.valid())
                return !0;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._resultMask & e) {
                    var n = r.intersectsOrContainsBoundingSphere(this._planeList[i], t);
                    if (r.OUTSIDE === n)
                        return !1;
                    r.INSIDE === n && (this._resultMask ^= e)
                }
                e <<= 1
            }
            return !0
        },
        containsBoundingBox: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !0;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._resultMask & e) {
                    var n = r.intersectsOrContainsBoundingBox(this._planeList[i], t);
                    if (r.OUTSIDE === n)
                        return !1;
                    r.INSIDE === n && (this._resultMask ^= e)
                }
                e <<= 1
            }
            return !0
        },
        containsAllOfVertices: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !1;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._resultMask & e) {
                    var n = r.intersectsOrContainsVertices(this._planeList[i], t);
                    if (n < 1)
                        return !1;
                    this._resultMask ^= e
                }
                e <<= 1
            }
            return !0
        },
        containsAllOfBoundingSphere: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !1;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._resultMask & e) {
                    var n = r.intersectsOrContainsBoundingSphere(this._planeList[i], t);
                    if (n < 1)
                        return !1;
                    this._resultMask ^= e
                }
                e <<= 1
            }
            return !0
        },
        containsAllOfBoundingBox: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !1;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._resultMask & e) {
                    var n = r.intersectsOrContainsBoundingBox(this._planeList[i], t);
                    if (n < 1)
                        return !1;
                    this._resultMask ^= e
                }
                e <<= 1
            }
            return !0
        },
        transformProvidingInverse: function(t) {
            if (this._maskStack[this._maskStack.length - 1]) {
                this._resultMask = this._maskStack[this._maskStack.length - 1];
                for (var e = 1, i = 0; i < this._planeList.length; ++i)
                    this._resultMask & e && (r.transformProvidingInverse(this._planeList[i], t),
                    e <<= 1)
            }
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1212).vec4
      , a = i(1212).vec3
      , s = n.objectInherit(r, {
        INSIDE: 1,
        INTERSECT: 2,
        OUTSIDE: 3,
        transformProvidingInverse: function() {
            var t = s.create();
            return function(e, i) {
                var n = e[0]
                  , r = e[1]
                  , a = e[2]
                  , o = e[3];
                return t[0] = i[0] * n + i[1] * r + i[2] * a + i[3] * o,
                t[1] = i[4] * n + i[5] * r + i[6] * a + i[7] * o,
                t[2] = i[8] * n + i[9] * r + i[10] * a + i[11] * o,
                t[3] = i[12] * n + i[13] * r + i[14] * a + i[15] * o,
                s.normalizeEquation(t),
                s.copy(t, e),
                e
            }
        },
        normalizeEquation: function(t) {
            var e = 1 / Math.sqrt(t[0] * t[0] + t[1] * t[1] + t[2] * t[2]);
            t[0] *= e,
            t[1] *= e,
            t[2] *= e,
            t[3] *= e
        },
        getNormal: function(t, e) {
            return e[0] = t[0],
            e[1] = t[1],
            e[2] = t[2],
            e
        },
        setNormal: function(t, e) {
            t[0] = e[0],
            t[1] = e[1],
            t[2] = e[2]
        },
        getDistance: function(t) {
            return t[3]
        },
        setDistance: function(t, e) {
            t[3] = e
        },
        distanceToPlane: function(t, e) {
            return t[0] * e[0] + t[1] * e[1] + t[2] * e[2] + t[3]
        },
        intersectsOrContainsBoundingSphere: function(t, e) {
            if (!e.valid())
                return s.OUTSIDE;
            var i = e.center()
              , n = e.radius()
              , r = this.distanceToPlane(t, i);
            return r < -n ? s.OUTSIDE : r <= n ? s.INTERSECT : s.INSIDE
        },
        instersectsBoundingSphere: function(t, e) {
            return this.intersectsOrContainsBoundingSphere(t, e) === s.INTERSECT
        },
        intersectsOrContainsBoundingBox: function() {
            var t = a.create()
              , e = a.create()
              , i = a.create();
            return function(n, r, o) {
                a.add(t, r.getMax(), r.getMin()),
                a.scale(t, t, .5),
                a.sub(t, r.getMax(), r.getMin()),
                a.scale(e, e, .5);
                var u = a.dot(t, n);
                o || (o = i,
                o[0] = Math.abs(n[0]),
                o[1] = Math.abs(n[1]),
                o[2] = Math.abs(n[2]));
                var l = a.dot(e, o);
                return u + l > 0 ? s.INTERSECT : u - l >= 0 ? s.INSIDE : s.OUTSIDE
            }
        },
        intersectsBoundingBox: function(t, e, i) {
            return this.intersectsOrContainsBoundingBox(t, e, i) === s.INTERSECT
        },
        intersectOrContainsVertices: function(t, e) {
            for (var i = -1, n = 0; n < e.length; n++) {
                var r = this.distanceToPlane(t, e[n]);
                if (r < 0) {
                    if (1 === i)
                        return s.INTERSECT;
                    i = 2
                } else {
                    if (!(r > 0))
                        return s.INTERSECT;
                    if (2 === i)
                        return s.INTERSECT;
                    i = 1
                }
            }
            return i > 0 ? s.INSIDE : s.OUTSIDE
        },
        intersectVertices: function(t, e) {
            return this.intersectOrContainsVertices(t, e) === s.INTERSECT
        }
    });
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1225)
      , a = i(1260)
      , s = i(1231)
      , o = i(1261)
      , u = i(1264)
      , l = i(1212).mat4
      , c = i(1266)
      , h = i(1230)
      , d = i(1208)
      , p = i(1207)
      , f = i(1232)
      , g = i(1212).vec3
      , m = function() {
        this._modelViewMatrixStack = [],
        this._projectionMatrixStack = [],
        this._viewportStack = [],
        this._cullingSetStack = [],
        this._frustumVolume = -1,
        this._bbCornerFar = 0,
        this._bbCornerNear = 0,
        this._reservedMatrixStack = new h,
        this._reserveCullingSetStack = [new u],
        this._reserveCullingSetStack.current = 0,
        this._cameraIndexStack = [],
        this._cameraModelViewIndexStack = [],
        this._cameraMatrixInverse = [],
        this._cameraMatrixInverseRoot = void 0
    };
    m.prototype = n.objectInherit(o.prototype, {
        _getReservedCullingSet: function() {
            var t = this._reserveCullingSetStack[this._reserveCullingSetStack.current++];
            return this._reserveCullingSetStack.current === this._reserveCullingSetStack.length && this._reserveCullingSetStack.push(new u),
            t
        },
        reset: function() {
            this._modelViewMatrixStack.length = 0,
            this._projectionMatrixStack.length = 0,
            this._cullingSetStack.length = 0,
            this._reservedMatrixStack.reset(),
            this._reserveCullingSetStack.current = 0,
            this._cameraModelViewIndexStack.length = 0,
            this._cameraIndexStack.length = 0,
            this._cameraMatrixInverse.length = 0,
            this._cameraMatrixInverseRoot = void 0
        },
        getProjectionMatrixStack: function() {
            return this._projectionMatrixStack
        },
        getCurrentProjectionMatrix: function() {
            return this._projectionMatrixStack[this._projectionMatrixStack.length - 1]
        },
        getCurrentModelViewMatrix: function() {
            return this._modelViewMatrixStack[this._modelViewMatrixStack.length - 1]
        },
        getCurrentModelviewMatrix: function() {
            return p.warn("deprecated switch to getCurrentModelViewMatrix"),
            this.getCurrentModelViewMatrix()
        },
        getCameraInverseMatrix: function() {
            if (!this._cameraIndexStack.length)
                return this._cameraMatrixInverseRoot;
            var t = this._cameraIndexStack[this._cameraIndexStack.length - 1]
              , e = this.getNodePath()[t]
              , i = e.getInstanceID();
            if (void 0 === this._cameraMatrixInverse[i]) {
                var n = this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length - 1]
                  , r = this._modelViewMatrixStack[n]
                  , a = this._reservedMatrixStack.get();
                l.invert(a, r),
                this._cameraMatrixInverse[i] = a
            }
            return this._cameraMatrixInverse[i]
        },
        getCurrentModelMatrix: function() {
            var t = this.getCameraInverseMatrix()
              , e = this._reservedMatrixStack.get()
              , i = l.mul(e, t, this.getCurrentModelViewMatrix());
            return i
        },
        getCurrentViewMatrix: function() {
            if (!this._cameraIndexStack.length)
                return this._modelViewMatrixStack[0];
            var t = this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length - 1];
            return this._modelViewMatrixStack[t]
        },
        getViewport: function() {
            if (0 !== this._viewportStack.length)
                return this._viewportStack[this._viewportStack.length - 1]
        },
        getLookVectorLocal: function(t) {
            var e = this.getCurrentModelViewMatrix();
            return g.set(t, -e[2], -e[6], -e[10])
        },
        pushViewport: function(t) {
            this._viewportStack.push(t)
        },
        popViewport: function() {
            this._viewportStack.pop()
        },
        getFrustumPlanes: function() {
            var t = l.create();
            return function(e, i, n, r) {
                l.mul(t, i, n);
                var a = !!r
                  , s = e[0];
                s[0] = t[3] - t[0],
                s[1] = t[7] - t[4],
                s[2] = t[11] - t[8],
                s[3] = t[15] - t[12];
                var o = e[1];
                o[0] = t[3] + t[0],
                o[1] = t[7] + t[4],
                o[2] = t[11] + t[8],
                o[3] = t[15] + t[12];
                var u = e[2];
                u[0] = t[3] + t[1],
                u[1] = t[7] + t[5],
                u[2] = t[11] + t[9],
                u[3] = t[15] + t[13];
                var h = e[3];
                if (h[0] = t[3] - t[1],
                h[1] = t[7] - t[5],
                h[2] = t[11] - t[9],
                h[3] = t[15] - t[13],
                a) {
                    var d = e[4];
                    d[0] = t[3] - t[2],
                    d[1] = t[7] - t[6],
                    d[2] = t[11] - t[10],
                    d[3] = t[15] - t[14];
                    var p = e[5];
                    p[0] = t[3] + t[2],
                    p[1] = t[7] + t[6],
                    p[2] = t[11] + t[10],
                    p[3] = t[15] + t[14]
                }
                for (var f = r ? 6 : 4, g = 0; g < f; g++)
                    c.normalizeEquation(e[g])
            }
        }(),
        pushCullingSet: function() {
            var t = this._getReservedCullingSet();
            this._enableFrustumCulling && (l.getFrustumPlanes(t.getFrustum().getPlanes(), this.getCurrentProjectionMatrix(), this.getCurrentModelViewMatrix(), !1),
            t.getFrustum().setupMask(4)),
            this._cullingSetStack.push(t)
        },
        popCullingSet: function() {
            return this._cullingSetStack.pop()
        },
        getCurrentCullingSet: function() {
            return this._cullingSetStack[this._cullingSetStack.length - 1]
        },
        pushCurrentMask: function() {
            var t = this.getCurrentCullingSet();
            t && t.pushCurrentMask()
        },
        popCurrentMask: function() {
            var t = this.getCurrentCullingSet();
            t && t.popCurrentMask()
        },
        isVerticesCulled: function(t) {
            return !!this._enableFrustumCulling && this.getCurrentCullingSet().isVerticesCulled(t)
        },
        isBoundingBoxCulled: function(t) {
            return !!this._enableFrustumCulling && (t.valid() && this.getCurrentCullingSet().isBoundingBoxCulled(t))
        },
        isBoundingSphereCulled: function(t) {
            return !!this._enableFrustumCulling && (t.valid() && this.getCurrentCullingSet().isBoundingSphereCulled(t))
        },
        isCulled: function() {
            var t = new r;
            return function(e, i) {
                if (!this._enableFrustumCulling)
                    return !1;
                if (e.isCullingActive()) {
                    if (0 === this.getCurrentCullingSet().getCurrentResultMask())
                        return !1;
                    var n = this._reservedMatrixStack.get();
                    return l.identity(n),
                    n = e instanceof d ? s.computeLocalToWorld(i.slice(0, i.length - 1), !0, n) : s.computeLocalToWorld(i, !0, n),
                    e.getBound().transformMat4(t, n),
                    this.getCurrentCullingSet().isBoundingSphereCulled(t)
                }
                return this.getCurrentCullingSet().resetCullingMask(),
                !1
            }
        }(),
        pushModelViewMatrix: function() {
            var t = g.create();
            return function(e) {
                var i = this.getNodePath()
                  , n = i.length;
                if (n) {
                    var r = n - 1;
                    i[r].getTypeID() === a.getTypeID() && i[r].getReferenceFrame() === f.ABSOLUTE_RF && (this._cameraIndexStack.push(r),
                    this._cameraModelViewIndexStack.push(this._modelViewMatrixStack.length))
                } else {
                    var s = this._reservedMatrixStack.get();
                    l.invert(s, e),
                    this._cameraMatrixInverseRoot = s;
                }
                this._modelViewMatrixStack.push(e),
                this.getLookVectorLocal(t),
                this._bbCornerFar = (t[0] >= 0 ? 1 : 0) | (t[1] >= 0 ? 2 : 0) | (t[2] >= 0 ? 4 : 0),
                this._bbCornerNear = 7 & ~this._bbCornerFar
            }
        }(),
        popModelViewMatrix: function() {
            var t = g.create();
            return function() {
                var e = this.getNodePath()
                  , i = e.length - 1;
                this._cameraIndexStack.length && i === this._cameraIndexStack[this._cameraIndexStack.length - 1] && (this._cameraIndexStack.pop(),
                this._cameraModelViewIndexStack.pop()),
                this._modelViewMatrixStack.pop(),
                0 !== this._modelViewMatrixStack.length ? this.getLookVectorLocal(t) : g.set(t, 0, 0, -1),
                this._bbCornerFar = (t[0] >= 0 ? 1 : 0) | (t[1] >= 0 ? 2 : 0) | (t[2] >= 0 ? 4 : 0),
                this._bbCornerNear = 7 & ~this._bbCornerFar
            }
        }(),
        pushProjectionMatrix: function(t) {
            this._projectionMatrixStack.push(t),
            this._frustumVolume = -1,
            this.pushCullingSet()
        },
        popProjectionMatrix: function() {
            this._projectionMatrixStack.pop(),
            this._frustumVolume = -1,
            this.popCullingSet()
        }
    }),
    t.exports = m
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1203)
      , a = i(1213)
      , s = i(1229)
      , o = i(1261)
      , u = i(1267)
      , l = i(1212).mat4
      , c = i(1247)
      , h = i(1202)
      , d = i(1248)
      , p = i(1269)
      , f = i(1204)
      , g = i(1234)
      , m = i(1270)
      , v = i(1271)
      , _ = i(1272)
      , b = i(1209)
      , x = i(1274)
      , A = i(1275)
      , y = i(1260)
      , S = i(1232)
      , C = i(1212).vec3
      , M = i(1276)
      , w = i(1282)
      , T = i(1278)
      , E = i(1283)
      , I = function() {
        s.call(this, s.TRAVERSE_ACTIVE_CHILDREN),
        o.call(this),
        u.call(this),
        this._rootStateGraph = void 0,
        this._currentStateGraph = void 0,
        this._currentRenderBin = void 0,
        this._currentRenderStage = void 0,
        this._rootRenderStage = void 0,
        this._computedNear = Number.POSITIVE_INFINITY,
        this._computedFar = Number.NEGATIVE_INFINITY;
        var t = C.fromValues(0, 0, -1);
        this._camera = void 0,
        this._bbCornerFar = (t[0] >= 0 ? 1 : 0) | (t[1] >= 0 ? 2 : 0) | (t[2] >= 0 ? 4 : 0),
        this._bbCornerNear = 7 & ~this._bbCornerFar,
        this._reserveLeafStack = [new m],
        this._reserveLeafStackCurrent = 0,
        this._reserveRenderStageStacks = {},
        this._reserveCullSettingsStack = [new o],
        this._reserveCullSettingsStackCurrent = 0,
        this._renderBinStack = [],
        this.visitorType = s.CULL_VISITOR,
        this._identityMatrix = l.create(),
        this._renderer = void 0,
        this._renderStageType = _,
        this._numCamera = 0,
        this._numMatrixTransform = 0,
        this._numProjection = 0,
        this._numNode = 0,
        this._numLightSource = 0,
        this._numGeometry = 0
    };
    I.prototype = r.objectInherit(u.prototype, r.objectInherit(s.prototype, {
        distance: function(t, e) {
            return -(t[0] * e[2] + t[1] * e[6] + t[2] * e[10] + e[14])
        },
        getComputedNear: function() {
            return this._computedNear
        },
        getComputedFar: function() {
            return this._computedFar
        },
        resetStats: function() {
            this._numCamera = 0,
            this._numMatrixTransform = 0,
            this._numProjection = 0,
            this._numNode = 0,
            this._numLightSource = 0,
            this._numGeometry = 0
        },
        handleCullCallbacksAndTraverse: function(t) {
            var e = t.getCullCallback();
            e && !e.cull(t, this) || this.traverse(t)
        },
        getCurrentCamera: function() {
            return this._currentRenderBin.getStage().getCamera()
        },
        updateCalculatedNearFar: function() {
            var t = C.create()
              , e = C.create();
            return function(i, n) {
                var r, a, s = n.getBoundingBox();
                if (r = this.distance(s.corner(this._bbCornerNear, t), i),
                a = this.distance(s.corner(this._bbCornerFar, e), i),
                r > a) {
                    var o = r;
                    r = a,
                    a = o
                }
                return !(a < 0) && (r < this._computedNear && (this._computedNear = r),
                a > this._computedFar && (this._computedFar = a),
                !0)
            }
        }(),
        setStateGraph: function(t) {
            this._rootStateGraph = t,
            this._currentStateGraph = t
        },
        setRenderStage: function(t) {
            this._rootRenderStage = t,
            this._currentRenderBin = t
        },
        setRenderer: function(t) {
            this._renderer = t
        },
        getRenderer: function() {
            return this._renderer
        },
        reset: function() {
            u.prototype.reset.call(this),
            this.resetRenderLeafStack(),
            this._reserveLeafStackCurrent = 0,
            this.resetCullSettingsStack(),
            this._reserveCullSettingsStackCurrent = 0;
            for (var t = window.Object.keys(this._reserveRenderStageStacks), e = 0, i = t.length; e < i; e++) {
                var n = t[e];
                this._reserveRenderStageStacks[n].reset()
            }
            v.resetStack(),
            this._computedNear = Number.POSITIVE_INFINITY,
            this._computedFar = Number.NEGATIVE_INFINITY
        },
        getCurrentRenderBin: function() {
            return this._currentRenderBin
        },
        setCurrentRenderBin: function(t) {
            this._currentRenderBin = t
        },
        addPositionedAttribute: function(t, e) {
            var i = t ? t : this._identityMatrix;
            this._currentRenderBin.getStage().positionedAttribute.push([i, e])
        },
        pushStateSet: function(t) {
            if (this._currentStateGraph = this._currentStateGraph.findOrInsert(t),
            void 0 !== t.getBinName()) {
                var e = this._renderBinStack
                  , i = this._currentRenderBin;
                e.push(i),
                this._currentRenderBin = i.getStage().findOrInsert(t.getBinNumber(), t.getBinName())
            }
        },
        popStateSet: function() {
            var t = this._currentStateGraph
              , e = t.getStateSet();
            if (this._currentStateGraph = t.parent,
            void 0 !== e.getBinName()) {
                var i = this._renderBinStack;
                0 === i.length ? this._currentRenderBin = this._currentRenderBin.getStage() : this._currentRenderBin = i.pop()
            }
        },
        popProjectionMatrix: function() {
            if (this._computeNearFar === !0 && this._computedFar >= this._computedNear) {
                var t = this.getCurrentProjectionMatrix();
                void 0 !== this._clampProjectionMatrixCallback ? this._clampProjectionMatrixCallback(t, this._computedNear, this._computedFar, this._nearFarRatio) : this.clampProjectionMatrix(t, this._computedNear, this._computedFar, this._nearFarRatio)
            }
            u.prototype.popProjectionMatrix.call(this)
        },
        clampProjectionMatrix: function(t, e, i, r, a) {
            var s = 1e-6;
            if (i < e - s)
                return n.log("clampProjectionMatrix not applied, invalid depth range, znear = " + e + "  zfar = " + i, !1, !0),
                !1;
            var o, u;
            if (i < e + s) {
                var l = .5 * (e + i);
                e = l - s,
                i = l + s
            }
            if (Math.abs(t[3]) < s && Math.abs(t[7]) < s && Math.abs(t[11]) < s) {
                var c = .02 * (i - e);
                c < 1 && (c = 1),
                o = e - c,
                u = i + c,
                e = o,
                i = u,
                t[10] = -2 / (u - o),
                t[14] = -(u + o) / (u - o)
            } else {
                var h = 1.02
                  , d = .98;
                o = e * d,
                u = i * h;
                var p = i * r;
                o < p && (o = p),
                e = o,
                i = u;
                var f = t[10]
                  , g = t[14]
                  , m = t[11]
                  , v = t[15]
                  , _ = (-o * f + g) / (-o * m + v)
                  , b = (-u * f + g) / (-u * m + v)
                  , x = Math.abs(2 / (_ - b))
                  , A = -(_ + b) / 2
                  , y = A * x;
                t[2] = t[2] * x + t[3] * y,
                t[6] = t[6] * x + t[7] * y,
                t[10] = f * x + m * y,
                t[14] = g * x + v * y
            }
            return void 0 !== a && (a[0] = e,
            a[1] = i),
            !0
        },
        popCameraModelViewProjectionMatrix: function() {
            this.popModelViewMatrix(),
            this.popProjectionMatrix()
        },
        pushCameraModelViewProjectionMatrix: function(t, e, i) {
            this.pushModelViewMatrix(e),
            this.pushProjectionMatrix(i)
        },
        apply: function(t) {
            this[t.typeID](t)
        },
        createOrReuseRenderStage: function(t) {
            var e, i = t ? t.className() : "RenderStage", n = t ? t.constructor : _;
            return this._reserveRenderStageStacks[i] ? e = this._reserveRenderStageStacks[i] : (e = new f.OsgObjectMemoryStack(n),
            this._reserveRenderStageStacks[i] = e),
            e.get().init()
        },
        createOrReuseRenderLeaf: function() {
            var t = this._reserveLeafStack[this._reserveLeafStackCurrent++];
            return this._reserveLeafStackCurrent === this._reserveLeafStack.length && this._reserveLeafStack.push(new m),
            t
        },
        resetRenderLeafStack: function() {
            for (var t = 0, e = this._reserveLeafStackCurrent; t <= e; t++)
                this._reserveLeafStack[t].reset()
        },
        createOrReuseCullSettings: function() {
            var t = this._reserveCullSettingsStack[this._reserveCullSettingsStackCurrent++];
            return this._reserveCullSettingsStackCurrent === this._reserveCullSettingsStack.length && this._reserveCullSettingsStack.push(new o),
            t
        },
        resetCullSettingsStack: function() {
            for (var t = 0, e = this._reserveCullSettingsStackCurrent; t <= e; t++)
                this._reserveCullSettingsStack[t].reset()
        },
        postPushGeometry: function(t, e) {
            var i, n;
            e instanceof w ? (n = e.getStateSetAnimation(),
            n && t.pushStateSet(n),
            i = e.getSourceGeometry(),
            i instanceof E && (n = i.getStateSetAnimation(),
            n && t.pushStateSet(n))) : e instanceof E && (n = e.getStateSetAnimation(),
            n && t.pushStateSet(n))
        },
        prePopGeometry: function(t, e) {
            if (e instanceof w) {
                var i = e.getSourceGeometry();
                i instanceof E && i.getStateSetAnimation() && t.popStateSet(),
                e.getStateSetAnimation() && t.popStateSet()
            } else
                e instanceof E && e.getStateSetAnimation() && t.popStateSet()
        },
        pushLeaf: function(t, e) {
            var i = this._currentStateGraph.leafs;
            0 === i.length && this._currentRenderBin.addStateGraph(this._currentStateGraph);
            var n = this.createOrReuseRenderLeaf();
            n.init(this._currentStateGraph, t, this.getCurrentProjectionMatrix(), this.getCurrentViewMatrix(), this.getCurrentModelViewMatrix(), this.getCurrentModelMatrix(), e),
            i.push(n)
        }
    })),
    I.prototype[y.typeID] = function(t) {
        this._numCamera++;
        var e = t.getStateSet();
        e && this.pushStateSet(e);
        var i = this._reservedMatrixStack.get()
          , n = this._reservedMatrixStack.get();
        if (t.getReferenceFrame() === S.RELATIVE_RF) {
            var r = this.getCurrentProjectionMatrix();
            l.mul(n, r, t.getProjectionMatrix());
            var a = this.getCurrentModelViewMatrix();
            l.mul(i, a, t.getViewMatrix())
        } else
            l.copy(i, t.getViewMatrix()),
            l.copy(n, t.getProjectionMatrix());
        var s = this._computedNear
          , o = this._computedFar
          , u = this.createOrReuseCullSettings();
        if (u.setCullSettings(this),
        this._computedNear = Number.POSITIVE_INFINITY,
        this._computedFar = Number.NEGATIVE_INFINITY,
        this.setCullSettings(t),
        u.getSettingSourceOverrider() === this && u.getEnableFrustumCulling() && this.setEnableFrustumCulling(!0),
        this.pushCameraModelViewProjectionMatrix(t, i, n),
        t.getViewport() && this.pushViewport(t.getViewport()),
        t.getRenderOrder() === y.NESTED_RENDER)
            this.handleCullCallbacksAndTraverse(t);
        else {
            var c = this.getCurrentRenderBin()
              , h = c.getStage()
              , d = this.createOrReuseRenderStage(this._rootRenderStage);
            d.setCamera(t),
            d.setClearDepth(t.getClearDepth()),
            d.setClearColor(t.getClearColor()),
            d.setClearMask(t.getClearMask());
            var p;
            p = void 0 === t.getViewport() ? h.getViewport() : t.getViewport(),
            d.setViewport(p),
            this.setCurrentRenderBin(d),
            this.handleCullCallbacksAndTraverse(t),
            this.setCurrentRenderBin(c),
            t.getRenderOrder() === y.PRE_RENDER ? this.getCurrentRenderBin().getStage().addPreRenderStage(d, t.renderOrderNum) : this.getCurrentRenderBin().getStage().addPostRenderStage(d, t.renderOrderNum)
        }
        this.popCameraModelViewProjectionMatrix(t),
        t.getViewport() && this.popViewport(),
        this.setCullSettings(u),
        this._computedNear = s,
        this._computedFar = o,
        e && this.popStateSet()
    }
    ,
    I.prototype[c.typeID] = function(t) {
        if (this._numMatrixTransform++,
        !this.isCulled(t, this.nodePath)) {
            this.pushCurrentMask();
            var e = this._reservedMatrixStack.get()
              , i = this.getCurrentModelViewMatrix();
            l.copy(e, i),
            t.computeLocalToWorldMatrix(e),
            this.pushModelViewMatrix(e);
            var n = t.getStateSet();
            n && this.pushStateSet(n),
            this.handleCullCallbacksAndTraverse(t),
            n && this.popStateSet(),
            this.popModelViewMatrix(),
            this.popCurrentMask()
        }
    }
    ,
    I.prototype[d.typeID] = function(t) {
        this._numProjection++;
        var e = this.getCurrentProjectionMatrix()
          , i = this._reservedMatrixStack.get();
        l.mul(i, e, t.getProjectionMatrix()),
        this.pushProjectionMatrix(i);
        var n = t.getStateSet();
        n && this.pushStateSet(n),
        this.handleCullCallbacksAndTraverse(t),
        n && this.popStateSet(),
        this.popProjectionMatrix()
    }
    ,
    I.prototype[b.typeID] = function(t) {
        if (this._numNode++,
        !this.isCulled(t, this.nodePath)) {
            this.pushCurrentMask();
            var e = t.getStateSet();
            e && this.pushStateSet(e),
            this.handleCullCallbacksAndTraverse(t),
            e && this.popStateSet(),
            this.popCurrentMask()
        }
    }
    ,
    I.prototype[h.typeID] = I.prototype[c.typeID],
    I.prototype[x.typeID] = I.prototype[b.typeID],
    I.prototype[A.typeID] = I.prototype[b.typeID],
    I.prototype[p.typeID] = function(t) {
        this._numLightSource++;
        var e = t.getStateSet();
        e && this.pushStateSet(e);
        var i = t.getLight();
        i && (t.getReferenceFrame() === S.RELATIVE_RF ? this.addPositionedAttribute(this.getCurrentModelViewMatrix(), i) : this.addPositionedAttribute(null, i)),
        this.handleCullCallbacksAndTraverse(t),
        e && this.popStateSet()
    }
    ,
    I.prototype[g.typeID] = function() {
        var t = C.create()
          , e = !1;
        return function(i) {
            this._numGeometry++;
            var r = this.getCurrentModelViewMatrix()
              , s = i.getBoundingBox();
            if (!this._computeNearFar || !s.valid() || this.updateCalculatedNearFar(r, i)) {
                var o = i.getCullCallback();
                if (!o || o.cull(i, this)) {
                    var u = i.getStateSet();
                    u && this.pushStateSet(u),
                    this.postPushGeometry(this, i);
                    var l = 0;
                    s.valid() && (l = this.distance(s.center(t), r)),
                    a.isNaN(l) ? e || (n.warn("warning geometry has a NaN depth, " + r + " center " + t),
                    e = !0) : this.pushLeaf(i, l),
                    this.prePopGeometry(this, i),
                    u && this.popStateSet()
                }
            }
        }
    }(),
    I.prototype[M.typeID] = I.prototype[c.typeID],
    I.prototype[w.typeID] = I.prototype[g.typeID],
    I.prototype[E.typeID] = I.prototype[g.typeID],
    I.prototype[T.typeID] = I.prototype[c.typeID],
    t.exports = I
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1209)
      , a = i(1232)
      , s = i(1212).vec3
      , o = function() {
        r.call(this),
        this._light = void 0,
        this._referenceFrame = a.RELATIVE_RF
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getLight: function() {
            return this._light
        },
        setLight: function(t) {
            this._light = t
        },
        setReferenceFrame: function(t) {
            this._referenceFrame = t
        },
        getReferenceFrame: function() {
            return this._referenceFrame
        },
        computeBoundingSphere: function() {
            var t = s.create();
            return function(e) {
                if (r.prototype.computeBoundingSphere.call(this, e),
                void 0 !== this._light && this._referenceFrame === a.RELATIVE_RF) {
                    var i = this._light.getPosition();
                    0 !== i[3] && e.expandByvec3(s.scale(t, i, 1 / i[3]))
                }
                return e
            }
        }()
    }), "osg", "LightSource"),
    n.setTypeID(o),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1205)
      , r = function(t, e) {
        this.modelUniform = e._uniformsCache[t.modelMatrix.getName()],
        this.viewUniform = e._uniformsCache[t.viewMatrix.getName()],
        this.apply = void 0,
        this.generateUniformsApplyMethods()
    };
    r.prototype = {
        generateUniformsApplyMethods: function() {
            var t = ["//generated by RenderLeaf\n"];
            t.push("var gl = state.getGraphicContext();"),
            t.push("var matrixModelViewChanged = state.applyModelViewMatrix( modelview );"),
            t.push("state.applyProjectionMatrix( projection );"),
            void 0 !== this.modelUniform && (t.push("if ( matrixModelViewChanged ) {"),
            t.push("    var modelMatrix = state.modelMatrix;"),
            t.push("    modelMatrix.setMatrix4( model );"),
            t.push("    modelMatrix.apply( gl, this.modelUniform);"),
            t.push("};")),
            void 0 !== this.viewUniform && (t.push("if ( matrixModelViewChanged ) {"),
            t.push("    var viewMatrix = state.viewMatrix;"),
            t.push("    viewMatrix.setMatrix4( view );"),
            t.push("    viewMatrix.apply( gl, this.viewUniform);"),
            t.push("};"));
            var e = new Function("state","modelview","model","view","projection","return function RenderLeafApplyMatrixUniformCache( state, modelview, model, view, projection ) { " + t.join("\n") + "}")();
            this.apply = e
        }
    };
    var a = function() {
        this._parent = void 0,
        this._geometry = void 0,
        this._depth = 0,
        this._projection = void 0,
        this._view = void 0,
        this._model = void 0,
        this._modelView = void 0
    };
    a.prototype = {
        reset: function() {
            this._parent = void 0,
            this._geometry = void 0,
            this._depth = 0,
            this._projection = void 0,
            this._view = void 0,
            this._model = void 0,
            this._modelView = void 0
        },
        init: function(t, e, i, n, r, a, s) {
            this._parent = t,
            this._geometry = e,
            this._depth = s,
            this._projection = i,
            this._view = n,
            this._model = a,
            this._modelView = r
        },
        drawGeometry: function() {
            return function(t) {
                var e = t.getLastProgramApplied()
                  , i = e.getInstanceID()
                  , n = t.getCacheUniformsApplyRenderLeaf()
                  , a = n[i];
                a || (a = new r(t,e),
                n[i] = a),
                a.apply(t, this._modelView, this._model, this._view, this._projection, this._normal),
                this._geometry.drawImplementation(t)
            }
        }(),
        render: function() {
            var t = 0
              , e = -1;
            return function(i, r) {
                var a, s, o = this._parent, u = o.parent, l = o.stateset;
                void 0 !== r ? (a = r._parent,
                s = a.parent,
                s !== u ? (n.moveStateGraph(i, s, u),
                i.applyStateSet(l)) : o !== a ? i.applyStateSet(l) : i._stateSetStackChanged(t, e) && i.applyStateSet(l)) : (n.moveStateGraph(i, void 0, u),
                i.applyStateSet(l)),
                i._setStateSetsDrawID(++t),
                e = i.getStateSetStackSize(),
                this.drawGeometry(i)
            }
        }()
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1207)
      , a = i(1210)
      , s = i(1213)
      , o = function(t) {
        a.call(this),
        this._leafs = [],
        this.positionedAttribute = [],
        this.stateGraphList = [],
        o.prototype.init.call(this, t)
    };
    o.SORT_BY_STATE = 0,
    o.SORT_BACK_TO_FRONT = 1,
    o.SORT_FRONT_TO_BACK = 2,
    o.defaultSortMode = o.SORT_BY_STATE,
    o.BinPrototypes = {
        RenderBin: function() {
            return o.getOrCreate().init()
        },
        DepthSortedBin: function() {
            return o.getOrCreate().init(o.SORT_BACK_TO_FRONT)
        }
    };
    var u = function(t, e) {
        return e._depth - t._depth
    }
      , l = function(t, e) {
        return t._depth - e._depth
    }
      , c = function(t, e) {
        return t._binNum - e._binNum
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, {
        init: function(t) {
            return this._leafs.length = 0,
            this.positionedAttribute.length = 0,
            this._renderStage = void 0,
            this._bins = {},
            this.stateGraphList.length = 0,
            this._parent = void 0,
            this._binNum = 0,
            this._sorted = !1,
            this._sortMode = void 0 !== t ? t : o.defaultSortMode,
            this._drawCallback = void 0,
            this
        },
        _createRenderBin: function(t) {
            var e = o.BinPrototypes.RenderBin;
            return t && o.BinPrototypes[t] && (e = o.BinPrototypes[t]),
            e()
        },
        getStateGraphList: function() {
            return this.stateGraphList
        },
        copyLeavesFromStateGraphListToRenderLeafList: function() {
            this._leafs.splice(0, this._leafs.length);
            for (var t = !1, e = 0, i = this.stateGraphList.length; e < i; e++)
                for (var n = this.stateGraphList[e].leafs, a = 0, o = n.length; a < o; a++) {
                    var u = n[a];
                    s.isNaN(u._depth) ? t = !0 : this._leafs.push(u)
                }
            t && r.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),
            this.stateGraphList.splice(0, this.stateGraphList.length)
        },
        getSortMode: function() {
            return this._sortMode
        },
        sortBackToFront: function() {
            this.copyLeavesFromStateGraphListToRenderLeafList(),
            this._leafs.sort(u)
        },
        sortFrontToBack: function() {
            this.copyLeavesFromStateGraphListToRenderLeafList(),
            this._leafs.sort(l)
        },
        sortImplementation: function() {
            var t = o;
            switch (this._sortMode) {
            case t.SORT_BACK_TO_FRONT:
                this.sortBackToFront();
                break;
            case t.SORT_FRONT_TO_BACK:
                this.sortFrontToBack();
                break;
            case t.SORT_BY_STATE:
            }
        },
        sort: function() {
            if (!this._sorted) {
                for (var t = this._bins, e = window.Object.keys(t), i = 0, n = e.length; i < n; i++)
                    t[e[i]].sort();
                this.sortImplementation(),
                this._sorted = !0
            }
        },
        setParent: function(t) {
            this._parent = t
        },
        getParent: function() {
            return this._parent
        },
        getBinNumber: function() {
            return this._binNum
        },
        findOrInsert: function(t, e) {
            var i = this._bins[t];
            return i || (i = this._createRenderBin(e),
            i._parent = this,
            i._binNum = t,
            i._renderStage = this._renderStage,
            this._bins[t] = i),
            i
        },
        getStage: function() {
            return this._renderStage
        },
        addStateGraph: function(t) {
            this.stateGraphList.push(t)
        },
        reset: function() {
            this.stateGraphList.length = 0,
            this._bins = {},
            this.positionedAttribute.length = 0,
            this._leafs.length = 0,
            this._sorted = !1
        },
        draw: function(t, e) {
            var i = e;
            return i = this._drawCallback && this._drawCallback.drawImplementation ? this._drawCallback.drawImplementation(this, t, i) : this.drawImplementation(t, i)
        },
        applyPositionedAttribute: function(t, e) {
            for (var i = 0, n = e.length; i < n; i++) {
                var r = e[i]
                  , a = r[1]
                  , s = r[0];
                t.setGlobalDefaultAttribute(a),
                a.apply(t),
                a.applyPositionedUniform(s, t),
                t.haveAppliedAttribute(a)
            }
        },
        drawImplementation: function(t, e) {
            for (var i = e, n = window.Object.keys(this._bins), r = this._bins, a = [], s = 0, o = n.length; s < o; s++) {
                var u = n[s];
                a.push(r[u])
            }
            a.sort(c);
            for (var l, h = 0, d = a.length; h < d && (l = a[h],
            !(l.getBinNumber() > 0)); h++)
                i = l.draw(t, i);
            for (i = this.drawLeafs(t, i); h < d; h++)
                l = a[h],
                i = l.draw(t, i);
            return i
        },
        drawLeafs: function(t, e) {
            for (var i, n = this.stateGraphList, r = this._leafs, a = e, s = 0, o = r.length; s < o; s++)
                i = r[s],
                i.render(t, a),
                a = i;
            for (var u = 0, l = n.length; u < l; u++)
                for (var c = n[u], h = 0, d = c.leafs.length; h < d; h++)
                    i = c.leafs[h],
                    i.render(t, a),
                    a = i;
            return a
        }
    }), "osg", "RenderBin"),
    o.getOrCreate = function() {
        var t = o._reservedStack[o._reservedStackCurrent++];
        return o._reservedStackCurrent === o._reservedStack.length && o._reservedStack.push(new o),
        t
    }
    ,
    o.resetStack = function() {
        o._reservedStackCurrent = 0
    }
    ,
    o._reservedStack = [new o],
    o._reservedStackCurrent = 0,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1260)
      , a = i(1273)
      , s = i(1207)
      , o = i(1271)
      , u = i(1212).vec4
      , l = function() {
        o.call(this),
        this.clearColor = u.create(),
        this.preRenderList = [],
        this.postRenderList = [],
        l.prototype.init.call(this)
    };
    l.prototype = n.objectLibraryClass(n.objectInherit(o.prototype, {
        constructor: l,
        init: function() {
            return o.prototype.init.call(this),
            this.positionedAttribute.length = 0,
            this.clearDepth = 1,
            u.set(this.clearColor, 0, 0, 0, 1),
            this.clearMask = r.COLOR_BUFFER_BIT | r.DEPTH_BUFFER_BIT,
            this.camera = void 0,
            this.viewport = void 0,
            this.preRenderList.length = 0,
            this.postRenderList.length = 0,
            this._renderStage = this,
            this
        },
        reset: function() {
            o.prototype.reset.call(this),
            this.preRenderList.length = 0,
            this.postRenderList.length = 0
        },
        setClearDepth: function(t) {
            this.clearDepth = t
        },
        getClearDepth: function() {
            return this.clearDepth
        },
        setClearColor: function(t) {
            u.copy(this.clearColor, t)
        },
        getClearColor: function() {
            return this.clearColor
        },
        setClearMask: function(t) {
            this.clearMask = t
        },
        getClearMask: function() {
            return this.clearMask
        },
        setViewport: function(t) {
            this.viewport = t
        },
        getViewport: function() {
            return this.viewport
        },
        setCamera: function(t) {
            this.camera = t
        },
        getCamera: function() {
            return this.camera
        },
        getPositionedAttribute: function() {
            return this.positionedAttribute
        },
        getPreRenderStageList: function() {
            return this.preRenderList
        },
        getPostRenderStageList: function() {
            return this.postRenderList
        },
        addPreRenderStage: function(t, e) {
            for (var i = 0, n = this.preRenderList.length; i < n; i++) {
                var r = this.preRenderList[i];
                if (e < r.order)
                    break
            }
            i < this.preRenderList.length ? this.preRenderList = this.preRenderList.splice(i, 0, {
                order: e,
                renderStage: t
            }) : this.preRenderList.push({
                order: e,
                renderStage: t
            })
        },
        addPostRenderStage: function(t, e) {
            for (var i = 0, n = this.postRenderList.length; i < n; i++) {
                var r = this.postRenderList[i];
                if (e < r.order)
                    break
            }
            i < this.postRenderList.length ? this.postRenderList = this.postRenderList.splice(i, 0, {
                order: e,
                renderStage: t
            }) : this.postRenderList.push({
                order: e,
                renderStage: t
            })
        },
        drawPreRenderStages: function(t, e) {
            for (var i = e, n = 0, r = this.preRenderList.length; n < r; ++n) {
                var a = this.preRenderList[n].renderStage;
                i = a.draw(t, i)
            }
            return i
        },
        draw: function(t, e) {
            this.camera && this.camera.getInitialDrawCallback() && this.camera.getInitialDrawCallback()(t);
            var i = this.drawPreRenderStages(t, e);
            return i = this.drawImplementation(t, i),
            i = this.drawPostRenderStages(t, i),
            this.camera && this.camera.getFinalDrawCallback() && this.camera.getFinalDrawCallback()(t),
            i
        },
        sort: function() {
            for (var t = 0, e = this.preRenderList.length; t < e; ++t)
                this.preRenderList[t].renderStage.sort();
            o.prototype.sort.call(this);
            for (var i = 0, n = this.postRenderList.length; i < n; ++i)
                this.postRenderList[i].renderStage.sort()
        },
        drawPostRenderStages: function(t, e) {
            for (var i = e, n = 0, r = this.postRenderList.length; n < r; ++n) {
                var a = this.postRenderList[n].renderStage;
                i = a.draw(t, i)
            }
            return i
        },
        applyCamera: function(t) {
            var e = t.getGraphicContext();
            if (void 0 === this.camera)
                return void e.bindFramebuffer(e.FRAMEBUFFER, null);
            var i = this.camera.getViewport()
              , n = this.camera.frameBufferObject;
            if (n || (n = new a,
            this.camera.frameBufferObject = n),
            n.isDirty()) {
                var r, s, o = this.camera.getAttachments(), u = o[a.COLOR_ATTACHMENT0];
                u && u.texture && (r = u.texture.getWidth(),
                s = u.texture.getHeight());
                var l = window.Object.keys(o);
                if (l.length)
                    for (var c = 0, h = l.length; c < h; c++) {
                        var d = l[c]
                          , p = o[d]
                          , f = {};
                        f.attachment = p.attachment,
                        void 0 === p.texture ? (f.format = p.format,
                        f.width = void 0 !== r ? r : i.width(),
                        f.height = void 0 !== s ? s : i.height()) : void 0 !== p.texture && (f.texture = p.texture,
                        f.textureTarget = p.textureTarget,
                        p.format && (f.format = p.format)),
                        n.setAttachment(f)
                    }
            }
            n.apply(t)
        },
        drawImplementation: function(t, e) {
            var i = t.getGraphicContext();
            if (this.applyCamera(t),
            void 0 === this.viewport && s.log("RenderStage does not have a valid viewport"),
            t.applyAttribute(this.viewport),
            this.camera) {
                var n = this.camera.getStateSet() && this.camera.getStateSet().getAttribute("Scissor");
                n && t.applyAttribute(n)
            }
            0 !== this.clearMask && (this.clearMask & i.COLOR_BUFFER_BIT && i.clearColor(this.clearColor[0], this.clearColor[1], this.clearColor[2], this.clearColor[3]),
            this.clearMask & i.DEPTH_BUFFER_BIT && (i.depthMask(!0),
            i.clearDepth(this.clearDepth)),
            i.clear(this.clearMask)),
            0 !== this.positionedAttribute.length && this.applyPositionedAttribute(t, this.positionedAttribute);
            var r = o.prototype.drawImplementation.call(this, t, e);
            return r
        }
    }), "osg", "RenderStage"),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1203)
      , a = i(1240)
      , s = i(1228)
      , o = i(1206)
      , u = i(1235)
      , l = function() {
        a.call(this),
        s.call(this),
        this._fbo = void 0,
        this._rbo = void 0,
        this._attachments = [],
        this._dirty = !0
    };
    l.COLOR_ATTACHMENT0 = 36064,
    l.DEPTH_ATTACHMENT = 36096,
    l.DEPTH_COMPONENT16 = 33189,
    l._sDeletedGLFrameBufferCache = new window.Map,
    l.deleteGLFrameBuffer = function(t, e) {
        l._sDeletedGLFrameBufferCache.has(t) || l._sDeletedGLFrameBufferCache.set(t, []),
        l._sDeletedGLFrameBufferCache.get(t).push(e)
    }
    ,
    l.flushDeletedGLFrameBuffers = function(t, e) {
        if (e <= 0)
            return e;
        if (!l._sDeletedGLFrameBufferCache.has(t))
            return e;
        for (var i = 0, n = o.instance().tick(), r = l._sDeletedGLFrameBufferCache.get(t), a = r.length, s = a - 1; s >= 0 && i < e; s--)
            t.deleteFramebuffer(r[s]),
            r.splice(s, 1),
            i = o.instance().deltaS(n, o.instance().tick());
        return e - i
    }
    ,
    l.flushAllDeletedGLFrameBuffers = function(t) {
        if (l._sDeletedGLFrameBufferCache.has(t))
            for (var e = l._sDeletedGLFrameBufferCache.get(t), i = e.length, n = i - 1; n >= 0; n--)
                t.deleteFramebuffer(e[n]),
                e.splice(n, 1)
    }
    ,
    l._sDeletedGLRenderBufferCache = new window.Map,
    l.deleteGLRenderBuffer = function(t, e) {
        l._sDeletedGLRenderBufferCache.has(t) || l._sDeletedGLRenderBufferCache.set(t, []),
        l._sDeletedGLRenderBufferCache.get(t).push(e)
    }
    ,
    l.flushDeletedGLRenderBuffers = function(t, e) {
        if (e <= 0)
            return e;
        if (!l._sDeletedGLRenderBufferCache.has(t))
            return e;
        for (var i = 0, n = o.instance().tick(), r = l._sDeletedGLRenderBufferCache.get(t), a = r.length, s = a - 1; s >= 0 && i < e; s--)
            t.deleteRenderbuffer(r[s]),
            r.splice(s, 1),
            i = o.instance().deltaS(n, o.instance().tick());
        return e - i
    }
    ,
    l.flushAllDeletedGLRenderBuffers = function(t) {
        if (l._sDeletedGLRenderBufferCache.has(t))
            for (var e = l._sDeletedGLRenderBufferCache.get(t), i = e.length, n = i - 1; n >= 0; n--)
                t.deleteRenderbuffer(e[n]),
                e.splice(n, 1)
    }
    ,
    l.prototype = r.objectInherit(a.prototype, r.objectInherit(s.prototype, {
        attributeType: "FrameBufferObject",
        cloneType: function() {
            return new l
        },
        dirty: function() {
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        },
        setAttachment: function(t) {
            this._attachments.push(t)
        },
        releaseGLObjects: function() {
            void 0 !== this._fbo && void 0 !== this._gl && l.deleteGLFrameBuffer(this._gl, this._fbo),
            this._fbo = void 0,
            void 0 !== this._rbo && void 0 !== this._gl && l.deleteGLRenderBuffer(this._gl, this._rbo),
            this._rbo = void 0
        },
        _reportFrameBufferError: function(t) {
            switch (t) {
            case 36054:
                n.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");
                break;
            case 36055:
                n.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
                break;
            case 36057:
                n.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
                break;
            case 36061:
                n.debug("FRAMEBUFFER_UNSUPPORTED");
                break;
            default:
                n.debug("FRAMEBUFFER unknown error " + t.toString(16))
            }
        },
        reset: function() {
            this.releaseGLObjects(),
            this._attachments = []
        },
        getFrameBufferObject: function() {
            return this._fbo
        },
        createFrameBufferObject: function(t) {
            this.setGraphicContext(t.getGraphicContext()),
            this._fbo = this._gl.createFramebuffer()
        },
        createRenderBuffer: function(t, e, i) {
            var n = this._gl
              , r = n.createRenderbuffer();
            return n.bindRenderbuffer(n.RENDERBUFFER, r),
            n.renderbufferStorage(n.RENDERBUFFER, t, e, i),
            r
        },
        framebufferRenderBuffer: function(t, e) {
            var i = this._gl;
            i.bindRenderbuffer(i.RENDERBUFFER, e),
            i.framebufferRenderbuffer(i.FRAMEBUFFER, t, i.RENDERBUFFER, e)
        },
        framebufferTexture2D: function(t, e, i, n) {
            var r = this._gl;
            return t.applyTextureAttribute(1, n),
            !(n.isDirty() || !n.getTextureObject()) && (r.framebufferTexture2D(r.FRAMEBUFFER, e, i, n.getTextureObject().id(), 0),
            !0)
        },
        bindFrameBufferObject: function() {
            var t = this._gl;
            t.bindFramebuffer(t.FRAMEBUFFER, this._fbo)
        },
        checkStatus: function() {
            var t = this._gl
              , e = t.checkFramebufferStatus(t.FRAMEBUFFER);
            36053 !== e && this._reportFrameBufferError(e)
        },
        _checkAllowedSize: function(t, e) {
            var i = u.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE");
            return !(0 === t || 0 === e || e > i || t > i) || (n.error("width (" + t + ") or height (" + t + ') makes frame buffer not bindable. Max RenderBuffer is "' + i + '"'),
            !1)
        },
        apply: function(t) {
            this._gl || this.setGraphicContext(t.getGraphicContext());
            var e = this._gl
              , i = this._attachments;
            if (i.length > 0 || this._fbo)
                if (this.isDirty()) {
                    this._fbo || this.createFrameBufferObject(t),
                    this.bindFrameBufferObject();
                    for (var r = !1, a = 0, s = i.length; a < s; ++a) {
                        var o = i[a];
                        if (o.texture) {
                            var u = o.texture;
                            if (!this._checkAllowedSize(u.getWidth(), u.getHeight()))
                                return void this.releaseGLObjects();
                            if (!this.framebufferTexture2D(t, o.attachment, o.textureTarget, u))
                                return void this.releaseGLObjects()
                        } else {
                            if (!this._checkAllowedSize(o.width, o.height))
                                return void this.releaseGLObjects();
                            this._rbo = this.createRenderBuffer(o.format, o.width, o.height),
                            this.framebufferRenderBuffer(o.attachment, this._rbo),
                            r = !0
                        }
                    }
                    this.checkStatus(),
                    r && e.bindRenderbuffer(e.RENDERBUFFER, null),
                    this._dirty = !1
                } else
                    e.bindFramebuffer(e.FRAMEBUFFER, this._fbo),
                    n.reportWebGLError === !0 && this.checkStatus();
            else
                e.bindFramebuffer(e.FRAMEBUFFER, null)
        }
    })),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1209)
      , a = i(1229)
      , s = i(1212).mat4
      , o = i(1212).vec2
      , u = i(1212).vec3
      , l = i(1225)
      , c = function() {
        r.call(this),
        this._radius = -1,
        this._range = [],
        this._rangeMode = c.DISTANCE_FROM_EYE_POINT,
        this._userDefinedCenter = [],
        this._centerMode = c.USE_BOUNDING_SPHERE_CENTER
    };
    c.DISTANCE_FROM_EYE_POINT = 0,
    c.PIXEL_SIZE_ON_SCREEN = 1,
    c.USE_BOUNDING_SPHERE_CENTER = 0,
    c.USER_DEFINED_CENTER = 1,
    c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED = 2,
    c.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getRadius: function() {
            return this._radius
        },
        setRadius: function(t) {
            this._radius = t
        },
        setCenter: function(t) {
            this._centerMode !== c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED && (this._centerMode = c.USER_DEFINED_CENTER),
            this._userDefinedCenter = t
        },
        getCenter: function() {
            return this._centerMode === c.USER_DEFINED_CENTER || this._centerMode === c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED ? this._userDefinedCenter : this.getBound().center()
        },
        setCenterMode: function(t) {
            this._centerMode = t
        },
        computeBoundingSphere: function(t) {
            if (this._centerMode === c.USER_DEFINED_CENTER && this._radius >= 0)
                return t.set(this._userDefinedCenter, this._radius),
                t;
            if (this._centerMode === c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED && this._radius >= 0) {
                t.set(this._userDefinedCenter, this._radius);
                var e = new l;
                return t.expandByBoundingSphere(r.prototype.computeBoundingSphere.call(this, e)),
                t
            }
            return r.prototype.computeBoundingSphere.call(this, t),
            t
        },
        projectBoundingSphere: function() {
            var t = u.create();
            return function(e, i, n) {
                u.transformMat4(t, e.center(), i);
                var r = e.radius2()
                  , a = t[2] * t[2]
                  , s = u.sqrLen(t)
                  , o = -Math.PI * n * n * r * Math.sqrt(Math.abs((s - r) / (r - a))) / (r - a);
                return o
            }
        }(),
        setRangeMode: function(t) {
            this._rangeMode = t
        },
        addChildNode: function(t) {
            if (r.prototype.addChild.call(this, t),
            this.children.length > this._range.length) {
                var e = []
                  , i = 0;
                this._range.lenght > 0 && (i = this._range[this._range.length - 1][1]),
                e.push(o.fromValues(i, i)),
                this._range.push(e)
            }
            return !0
        },
        addChild: function(t, e, i) {
            if (r.prototype.addChild.call(this, t),
            this.children.length > this._range.length) {
                var n = [];
                n.push(o.fromValues(e, e)),
                this._range.push(n)
            }
            return this._range[this.children.length - 1][0] = e,
            this._range[this.children.length - 1][1] = i,
            !0
        },
        traverse: function() {
            var t = u.create()
              , e = u.create()
              , i = s.create();
            return function(n) {
                var r = n.traversalMode;
                switch (r) {
                case a.TRAVERSE_ALL_CHILDREN:
                    for (var o = 0; o < this.children.length; o++)
                        this.children[o].accept(n);
                    break;
                case a.TRAVERSE_ACTIVE_CHILDREN:
                    var l = 0
                      , h = n.getCurrentModelViewMatrix();
                    if (s.invert(i, h),
                    this._rangeMode === c.DISTANCE_FROM_EYE_POINT) {
                        u.transformMat4(e, t, i);
                        var d = u.distance(this.getBound().center(), e);
                        l = d * n.getLODScale()
                    } else {
                        var p = n.getCurrentProjectionMatrix();
                        l = this.projectBoundingSphere(this.getBound(), h, p[0]),
                        l = l * n.getViewport().width() * n.getViewport().width() * .25 / n.getLODScale()
                    }
                    var f = this.children.length;
                    this._range.length < f && (f = this._range.length);
                    for (var g = 0; g < f; ++g)
                        this._range[g][0] <= l && l < this._range[g][1] && this.children[g].accept(n)
                }
            }
        }()
    }), "osg", "Lod"),
    n.setTypeID(c),
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1274)
      , a = i(1229)
      , s = i(1212).mat4
      , o = i(1212).vec3
      , u = function() {
        r.call(this),
        this._perRangeDataList = [],
        this._loading = !1,
        this._expiryTime = 0,
        this._expiryFrame = 0,
        this._centerMode = r.USER_DEFINED_CENTER,
        this._frameNumberOfLastTraversal = 0,
        this._databasePath = "",
        this._numChildrenThatCannotBeExpired = 0
    }
      , l = function() {
        this.filename = "",
        this["function"] = void 0,
        this.loaded = !1,
        this.timeStamp = 0,
        this.frameNumber = 0,
        this.frameNumberOfLastTraversal = 0,
        this.dbrequest = void 0
    };
    u.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        setRange: function(t, e, i) {
            if (t >= this._range.length) {
                var n = [];
                n.push([e, e]),
                this._range.push(n)
            }
            this._range[t][0] = e,
            this._range[t][1] = i
        },
        setExpiryTime: function(t) {
            this._expiryTime = t
        },
        setDatabasePath: function(t) {
            this._databasePath = t
        },
        getDatabasePath: function() {
            return this._databasePath
        },
        setFileName: function(t, e) {
            if (t >= this._perRangeDataList.length) {
                var i = new l;
                i.filename = e,
                this._perRangeDataList.push(i)
            } else
                this._perRangeDataList[t].filename = e
        },
        setFunction: function(t, e) {
            if (t >= this._perRangeDataList.length) {
                var i = new l;
                i["function"] = e,
                this._perRangeDataList.push(i)
            } else
                this._perRangeDataList[t]["function"] = e
        },
        addChild: function(t, e, i) {
            r.prototype.addChild.call(this, t, e, i),
            this._perRangeDataList.push(new l)
        },
        addChildNode: function(t) {
            r.prototype.addChildNode.call(this, t)
        },
        setFrameNumberOfLastTraversal: function(t) {
            this._frameNumberOfLastTraversal = t
        },
        getFrameNumberOfLastTraversal: function() {
            return this._frameNumberOfLastTraversal
        },
        setTimeStamp: function(t, e) {
            this._perRangeDataList[t].timeStamp = e
        },
        setFrameNumber: function(t, e) {
            this._perRangeDataList[t].frameNumber = e
        },
        setNumChildrenThatCannotBeExpired: function(t) {
            this._numChildrenThatCannotBeExpired = t;
        },
        getNumChildrenThatCannotBeExpired: function() {
            return this._numChildrenThatCannotBeExpired
        },
        getDatabaseRequest: function(t) {
            return this._perRangeDataList[t].dbrequest
        },
        removeExpiredChildren: function(t, e, i) {
            if (!(this.children.length <= this._numChildrenThatCannotBeExpired)) {
                var n, r, a = this.children.length - 1;
                n = this._perRangeDataList[a].timeStamp + this._expiryTime,
                r = this._perRangeDataList[a].frameNumber + this._expiryFrame,
                n < t && r < e && (this._perRangeDataList[a].filename.length > 0 || void 0 !== this._perRangeDataList[a]["function"]) && (i.push(this.children[a]),
                this.removeChild(this.children[a]),
                this._perRangeDataList[a].loaded = !1,
                void 0 !== this._perRangeDataList[a].dbrequest && (this._perRangeDataList[a].dbrequest._groupExpired = !0))
            }
        },
        traverse: function() {
            var t = o.create()
              , e = o.create()
              , i = s.create();
            return function(n) {
                var u = n.traversalMode
                  , l = !1;
                switch (n.getVisitorType() === a.CULL_VISITOR && (this._frameNumberOfLastTraversal = n.getFrameStamp().getFrameNumber(),
                l = !0),
                u) {
                case a.TRAVERSE_ALL_CHILDREN:
                    for (var c = 0; c < this.children.length; c++)
                        this.children[c].accept(n);
                    break;
                case a.TRAVERSE_ACTIVE_CHILDREN:
                    var h = 0
                      , d = n.getCurrentModelViewMatrix();
                    if (s.invert(i, d),
                    this._rangeMode === r.DISTANCE_FROM_EYE_POINT) {
                        o.transformMat4(e, t, i);
                        var p = o.distance(this.getBound().center(), e);
                        h = p * n.getLODScale()
                    } else {
                        var f = n.getCurrentProjectionMatrix();
                        h = this.projectBoundingSphere(this.getBound(), d, f[0]),
                        h = h * n.getViewport().width() * n.getViewport().width() * .25 / n.getLODScale(),
                        h < 0 && (h = this._range[this._range.length - 1][0])
                    }
                    for (var g = !1, m = -1, v = 0; v < this._range.length; ++v)
                        this._range[v][0] <= h && h < this._range[v][1] && (v < this.children.length ? (l && (this._perRangeDataList[v].timeStamp = n.getFrameStamp().getSimulationTime(),
                        this._perRangeDataList[v].frameNumber = n.getFrameStamp().getFrameNumber()),
                        this.children[v].accept(n),
                        m = v) : g = !0);
                    if (g) {
                        var _ = this.children.length;
                        if (_ > 0 && _ - 1 !== m && (l && (this._perRangeDataList[_ - 1].timeStamp = n.getFrameStamp().getSimulationTime(),
                        this._perRangeDataList[_ - 1].frameNumber = n.getFrameStamp().getFrameNumber()),
                        this.children[_ - 1].accept(n)),
                        _ < this._perRangeDataList.length) {
                            var b = (this._range[_][0] - h) / (this._range[_][1] - this._range[_][0]);
                            this._rangeMode === r.PIXEL_SIZE_ON_SCREEN && (b = -b);
                            var x = n.nodePath[n.nodePath.length - 1];
                            if (this._perRangeDataList[_].loaded === !1) {
                                this._perRangeDataList[_].loaded = !0;
                                var A = n.getDatabaseRequestHandler();
                                this._perRangeDataList[_].dbrequest = A.requestNodeFile(this._perRangeDataList[_]["function"], this._databasePath + this._perRangeDataList[_].filename, x, n.getFrameStamp().getSimulationTime(), b)
                            } else
                                void 0 !== this._perRangeDataList[_].dbrequest ? (this._perRangeDataList[_].dbrequest._timeStamp = n.getFrameStamp().getSimulationTime(),
                                this._perRangeDataList[_].dbrequest._priority = b) : this._perRangeDataList[_].loaded = !1
                        }
                    }
                }
            }
        }()
    }), "osg", "PagedLOD"),
    n.setTypeID(u),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1247)
      , a = i(1277)
      , s = i(1229)
      , o = i(1280)
      , u = i(1278)
      , l = function() {
        s.call(this, s.TRAVERSE_ALL_CHILDREN)
    };
    l.prototype = n.objectInherit(s.prototype, {
        apply: function(t) {
            if (t.getTypeID() === u.getTypeID()) {
                var e = t.getUpdateCallback();
                if (e instanceof o) {
                    for (var i = e._stackedTransforms, n = 0, r = i.length; n < r; n++) {
                        var a = i[n];
                        a.resetToDefaultValue()
                    }
                    e.computeChannels()
                }
            }
            this.traverse(t)
        }
    });
    var c = new l
      , h = function() {
        r.call(this)
    };
    h.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        setDefaultUpdateCallback: function() {
            this.addUpdateCallback(new a)
        },
        setRestPose: function() {
            this.accept(c)
        }
    }), "osgAnimation", "Skeleton"),
    n.setTypeID(h),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1278)
      , a = i(1229)
      , s = i(1207)
      , o = i(1210)
      , u = function() {
        a.call(this)
    };
    u.prototype = n.objectInherit(a.prototype, {
        apply: function(t) {
            if (t.getTypeID() === r.getTypeID()) {
                for (var e = !1, i = t.getChildren(), n = 0, a = t.getChildren().length; n < a; n++) {
                    var o = i[n];
                    if (o.getTypeID() === r.getTypeID()) {
                        if (e)
                            return void s.warn("Warning: a Bone was found after a non-Bone child within a Skeleton. Children of a Bone must be ordered with all child Bones first for correct update order.")
                    } else
                        e = !0
                }
                this.traverse(t)
            }
        }
    });
    var l = function(t, e) {
        var i = t instanceof r ? 0 : 1
          , n = e instanceof r ? 0 : 1;
        return i - n
    }
      , c = function() {
        this._needValidate = !0
    };
    c.prototype = n.objectInherit(o.prototype, {
        needToValidate: function() {
            return this._needValidate
        },
        update: function(t, e) {
            if (this._needValidate && e.getVisitorType() === a.UPDATE_VISITOR && t.className && "Skeleton" === t.className()) {
                for (var i = new u, n = t.getChildren(), r = 0, s = n.length; r < s; r++) {
                    var o = n[r];
                    o.accept(i)
                }
                n.sort(l),
                this._needValidate = !1
            }
            return !0
        }
    }),
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1212).vec3
      , a = i(1211)
      , s = i(1212).mat4
      , o = i(1247)
      , u = i(1279)
      , l = function(t) {
        void 0 !== t && this.setName(t),
        o.call(this),
        this._invBindInSkeletonSpace = s.create(),
        this._boneInSkeletonSpace = s.create(),
        this._boneBoundingBox = new a
    };
    l.prototype = n.objectLibraryClass(n.objectInherit(o.prototype, {
        getOrCreateDebugColor: function() {
            return this._boneColor ? this._boneColor : (this._boneColor = r.fromValues(Math.random(), Math.random(), Math.random()),
            this._boneColor)
        },
        getBoneBoundingBox: function() {
            return this._boneBoundingBox
        },
        setBoneBoundingBox: function(t) {
            this._boneBoundingBox = t
        },
        getMatrixInSkeletonSpace: function() {
            return this._boneInSkeletonSpace
        },
        getInvBindMatrixInSkeletonSpace: function() {
            return this._invBindInSkeletonSpace
        },
        setMatrixInSkeletonSpace: function(t) {
            s.copy(this._boneInSkeletonSpace, t)
        },
        setInvBindMatrixInSkeletonSpace: function(t) {
            s.copy(this._invBindInSkeletonSpace, t)
        },
        getBoneParent: function() {
            for (var t = this.getParents(), e = 0, i = t.length; e < i; e++) {
                var n = t[e].getTypeID();
                if (n === l.getTypeID())
                    return t[e]
            }
        },
        setDefaultUpdateCallback: function(t) {
            this.addUpdateCallback(new u(void 0 !== t ? t : this.getName()))
        }
    }), "osgAnimation", "Bone"),
    n.setTypeID(l),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1207)
      , a = i(1280)
      , s = i(1212).mat4
      , o = i(1229)
      , u = function() {
        a.call(this)
    };
    u.prototype = n.objectInherit(a.prototype, {
        update: function(t, e) {
            if (e.getVisitorType() === o.UPDATE_VISITOR) {
                if (t.className && "Bone" !== t.className())
                    return r.warn("Warning: UpdateBone set on non-Bone object."),
                    !1;
                var i = t;
                a.prototype.update.call(this, t),
                i.setMatrix(i.getMatrix());
                var n = i.getMatrix()
                  , u = i.getBoneParent();
                u ? s.mul(i.getMatrixInSkeletonSpace(), u.getMatrixInSkeletonSpace(), n) : i.setMatrixInSkeletonSpace(n)
            }
            return !0
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1212).mat4
      , a = i(1281)
      , s = function() {
        a.call(this),
        this._stackedTransforms = [],
        this._matrix = r.create(),
        this._dirty = !1
    };
    s.prototype = n.objectInherit(a.prototype, {
        getStackedTransforms: function() {
            return this._stackedTransforms
        },
        computeChannels: function() {
            this._dirty = !0;
            var t = this._matrix;
            r.identity(t);
            for (var e = this._stackedTransforms, i = 0, n = e.length; i < n; i++) {
                var a = e[i];
                a.applyToMatrix(t)
            }
        },
        update: function(t) {
            return r.copy(t.getMatrix(), this._matrix),
            this._dirty && (t.dirtyBound(),
            this._dirty = !1),
            !0
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1203)
      , a = i(1210)
      , s = i(1247)
      , o = function() {
        a.call(this)
    };
    o.checkPathIsAnimated = function(t) {
        for (var e = 0, i = t.length; e < i; ++e) {
            var n = t[e];
            if (n instanceof s)
                for (var r = n.getUpdateCallbackList(), a = 0, u = r.length; a < u; ++a)
                    if (r[a]instanceof o)
                        return !0
        }
        return !1
    }
    ,
    o.prototype = r.objectInherit(a.prototype, {
        linkChannel: function() {},
        linkAnimation: function(t) {
            var e = this.getName();
            if (0 === e.length)
                return n.log("no name on an update callback, discard"),
                0;
            for (var i = 0, r = t.getChannels(), a = 0, s = r.length; a < s; a++) {
                var o = r[a];
                o.getTargetName() === e && (this.linkChannel(o),
                i++)
            }
            return i
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1212).vec3
      , a = i(1234)
      , s = i(1207)
      , o = i(1212).mat4
      , u = i(1226)
      , l = i(1283)
      , c = i(1285)
      , h = i(1287)
      , d = i(1281)
      , p = i(1231)
      , f = function() {
        a.call(this),
        this._shape = null,
        this.addUpdateCallback(new c),
        this._root = void 0,
        this._pathToRoot = void 0,
        this._isAnimatedPath = !1,
        this._boneNameID = {},
        this._matrixFromSkeletonToGeometry = o.create(),
        this._invMatrixFromSkeletonToGeometry = o.create(),
        this._rigTransformImplementation = new h,
        this._stateSetAnimation = new u,
        this._needToComputeMatrix = !0
    };
    f.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, {
        getStateSetAnimation: function() {
            return this._stateSetAnimation
        },
        getSkeleton: function() {
            return this._root
        },
        setSkeleton: function(t) {
            this._root = t
        },
        setPathToSkeleton: function(t) {
            this._pathToRoot = t,
            this._isAnimatedPath = d.checkPathIsAnimated(t)
        },
        setNeedToComputeMatrix: function(t) {
            this._needToComputeMatrix = t
        },
        getNeedToComputeMatrix: function() {
            return this._needToComputeMatrix
        },
        computeBoundingBox: function(t) {
            t.init();
            var e = this.getVertexAttributeList().Vertex
              , i = this.getVertexAttributeList().Weights;
            if (e && i && e.getElements() && e.getItemSize() > 2) {
                for (var n = i.getElements(), r = e.getElements(), a = e.getItemSize(), s = t.getMin(), o = t.getMax(), u = s[0], l = s[1], c = s[2], h = o[0], d = o[1], p = o[2], f = 0, g = 0, m = r.length; f < m; f += a,
                g += 4)
                    if (0 === n[f] && 0 === n[f + 1] && 0 === n[f + 2] && 0 === n[f + 3]) {
                        var v = r[f]
                          , _ = r[f + 1]
                          , b = r[f + 2];
                        v < u && (u = v),
                        v > h && (h = v),
                        _ < l && (l = _),
                        _ > d && (d = _),
                        b < c && (c = b),
                        b > p && (p = b)
                    }
                s[0] = u,
                s[1] = l,
                s[2] = c,
                o[0] = h,
                o[1] = d,
                o[2] = p
            }
            return t
        },
        computeMatrixFromRootSkeleton: function() {
            return this._root ? (o.identity(this._matrixFromSkeletonToGeometry),
            p.computeLocalToWorld(this._pathToRoot, !0, this._matrixFromSkeletonToGeometry),
            o.invert(this._invMatrixFromSkeletonToGeometry, this._matrixFromSkeletonToGeometry),
            void (this._isAnimatedPath || (this._needToComputeMatrix = !1))) : void s.warn("Warning " + this.className() + ".computeMatrixFromRootSkeleton if you have this message it means you miss to call buildTransformer( root ), or your RigGeometry (" + this.getName() + ") is not attached to a Skeleton subgraph")
        },
        getMatrixFromSkeletonToGeometry: function() {
            return this._matrixFromSkeletonToGeometry
        },
        getInvMatrixFromSkeletonToGeometry: function() {
            return this._invMatrixFromSkeletonToGeometry
        },
        getSourceGeometry: function() {
            return this._geometry
        },
        setSourceGeometry: function(t) {
            this._geometry = t
        },
        getBoneNameID: function() {
            return this._boneNameID
        },
        setBoneNameID: function(t) {
            this._boneNameID = t
        },
        mergeChildrenVertexAttributeList: function() {
            this._geometry instanceof l && this._geometry.mergeChildrenVertexAttributeList();
            var t = this._geometry.getVertexAttributeList();
            a.appendVertexAttributeToList(t, this.getVertexAttributeList())
        },
        mergeChildrenData: function() {
            this.mergeChildrenVertexAttributeList();
            var t = this._geometry.getPrimitiveSetList();
            this.getPrimitiveSetList().length = 0;
            for (var e = 0, i = t.length; e < i; e++)
                this.getPrimitiveSetList()[e] = t[e];
            this.getStateSet() && console.error("A stateset in the rig is already present : " + this.getStateSet()),
            this.setStateSet(this._geometry.getStateSet())
        },
        update: function() {
            this._rigTransformImplementation.update(this)
        },
        computeTransformedVertex: function(t, e) {
            e = e || r.create();
            var i = this.getVertexAttributeList()
              , n = i.Weights.getElements()
              , a = i.Bones.getElements()
              , s = 0
              , o = 0
              , u = 0;
            if (this._geometry.computeTransformedVertex)
                this._geometry.computeTransformedVertex(t, e),
                s = e[0],
                o = e[1],
                u = e[2];
            else {
                var l = i.Vertex.getElements();
                s = l[3 * t],
                o = l[3 * t + 1],
                u = l[3 * t + 2]
            }
            for (var c = 4 * t, h = this._rigTransformImplementation._skinningAttribute.getMatrixPalette(), d = 0, p = 0, f = 0, g = 0, m = 0, v = 0, _ = 0, b = 0, x = 0, A = 0, y = 0, S = 0, C = 0, M = !1, w = 0; w < 4; ++w) {
                var T = n[c + w];
                if (0 !== T) {
                    var E = 12 * a[c + w];
                    d += h[E + 0] * T,
                    g += h[E + 1] * T,
                    _ += h[E + 2] * T,
                    A += h[E + 3] * T,
                    p += h[E + 4] * T,
                    m += h[E + 5] * T,
                    b += h[E + 6] * T,
                    y += h[E + 7] * T,
                    f += h[E + 8] * T,
                    v += h[E + 9] * T,
                    x += h[E + 10] * T,
                    S += h[E + 11] * T,
                    C += T,
                    M = !0
                }
            }
            M || (e[0] = s,
            e[1] = o,
            e[2] = u);
            var I = 1 / C;
            return e[0] = (d * s + g * o + _ * u + A) * I,
            e[1] = (p * s + m * o + b * u + y) * I,
            e[2] = (f * s + v * o + x * u + S) * I,
            e
        },
        computeTransformedVertices: function() {
            for (var t = this.getVertexAttributeList(), e = this._geometry.computeTransformedVertices ? this._geometry.computeTransformedVertices() : t.Vertex.getElements(), i = t.Weights.getElements(), n = t.Bones.getElements(), r = this._riggedVerts || new Float32Array(e.length), a = this._rigTransformImplementation._skinningAttribute.getMatrixPalette(), s = 0, o = 0, u = e.length; s < u; s += 3,
            o += 4) {
                var l, c = 0, h = 0, d = 0, p = 0, f = 0, g = 0, m = 0, v = 0, _ = 0, b = 0, x = 0, A = 0, y = 0, S = !1, C = i[o];
                0 !== C && (l = 12 * n[o],
                c += a[l + 0] * C,
                p += a[l + 1] * C,
                m += a[l + 2] * C,
                b += a[l + 3] * C,
                h += a[l + 4] * C,
                f += a[l + 5] * C,
                v += a[l + 6] * C,
                x += a[l + 7] * C,
                d += a[l + 8] * C,
                g += a[l + 9] * C,
                _ += a[l + 10] * C,
                A += a[l + 11] * C,
                y += C,
                S = !0),
                C = i[o + 1],
                0 !== C && (l = 12 * n[o + 1],
                c += a[l + 0] * C,
                p += a[l + 1] * C,
                m += a[l + 2] * C,
                b += a[l + 3] * C,
                h += a[l + 4] * C,
                f += a[l + 5] * C,
                v += a[l + 6] * C,
                x += a[l + 7] * C,
                d += a[l + 8] * C,
                g += a[l + 9] * C,
                _ += a[l + 10] * C,
                A += a[l + 11] * C,
                y += C,
                S = !0),
                C = i[o + 2],
                0 !== C && (l = 12 * n[o + 2],
                c += a[l + 0] * C,
                p += a[l + 1] * C,
                m += a[l + 2] * C,
                b += a[l + 3] * C,
                h += a[l + 4] * C,
                f += a[l + 5] * C,
                v += a[l + 6] * C,
                x += a[l + 7] * C,
                d += a[l + 8] * C,
                g += a[l + 9] * C,
                _ += a[l + 10] * C,
                A += a[l + 11] * C,
                y += C,
                S = !0),
                C = i[o + 3],
                0 !== C && (l = 12 * n[o + 3],
                c += a[l + 0] * C,
                p += a[l + 1] * C,
                m += a[l + 2] * C,
                b += a[l + 3] * C,
                h += a[l + 4] * C,
                f += a[l + 5] * C,
                v += a[l + 6] * C,
                x += a[l + 7] * C,
                d += a[l + 8] * C,
                g += a[l + 9] * C,
                _ += a[l + 10] * C,
                A += a[l + 11] * C,
                y += C,
                S = !0);
                var M = e[s]
                  , w = e[s + 1]
                  , T = e[s + 2];
                if (S) {
                    var E = 1 / y;
                    r[s] = (c * M + p * w + m * T + b) * E,
                    r[s + 1] = (h * M + f * w + v * T + x) * E,
                    r[s + 2] = (d * M + g * w + _ * T + A) * E
                } else
                    r[s] = M,
                    r[s + 1] = w,
                    r[s + 2] = T
            }
            return r
        }
    }), "osgAnimation", "RigGeometry"),
    n.setTypeID(f),
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1257)
      , a = i(1207)
      , s = i(1212).vec3
      , o = i(1234)
      , u = i(1226)
      , l = i(1284)
      , c = i(1228)
      , h = i(1211)
      , d = function() {
        o.call(this),
        this._shape = null,
        this._targets = [],
        this._stateSetAnimation = new u,
        this._targetWeights = new Float32Array(4),
        this._morphTargetNames = void 0,
        this._updateMorph = void 0,
        this._isInitialized = !1
    }
      , p = d.EFFECTIVE_EPS = .05;
    d.prototype = n.objectLibraryClass(n.objectInherit(o.prototype, {
        init: function() {
            var t = new l(Math.min(4, this.getMorphTargets().length));
            return this.getStateSetAnimation().setAttributeAndModes(t, c.ON),
            t.setTargetWeights(this.getTargetsWeight()),
            this._targets[0] ? (this._morphTargetNames = window.Object.keys(this._targets[0].getVertexAttributeList()),
            t.copyTargetNames(this._morphTargetNames)) : (this._morphTargetNames = [],
            a.error("No Targets in the MorphGeometry !")),
            this._isInitialized = !0,
            !0
        },
        getMorphTargetNames: function() {
            return this._morphTargetNames
        },
        getStateSetAnimation: function() {
            return this._stateSetAnimation
        },
        getMorphTargets: function() {
            return this._targets
        },
        isInitialized: function() {
            return this._isInitialized
        },
        getTargetsWeight: function() {
            return this._targetWeights
        },
        computeBoundingBox: function() {
            var t = new h;
            return function(e) {
                o.prototype.computeBoundingBox.call(this, e);
                for (var i = 0, n = this._targets.length; i < n; i++)
                    e.expandByBoundingBox(this._targets[i].computeBoundingBox(t));
                return e
            }
        }(),
        mergeChildrenVertexAttributeList: function() {
            for (var t = 0, e = this._targets.length; t < e; t++) {
                for (var i = this._targets[t], n = i.getVertexAttributeList(), a = window.Object.keys(n), s = 0, u = a.length; s < u; s++) {
                    var l = a[s]
                      , c = n[l];
                    c && !c.getBufferArray && (n[l] = new r(c))
                }
                o.appendVertexAttributeToList(i.getVertexAttributeList(), this.getVertexAttributeList(), t)
            }
        },
        _computeEffectiveSumWeights: function() {
            for (var t = 0, e = this._targetWeights, i = 0, n = e.length; i < n; ++i) {
                var r = e[i];
                Math.abs(r) < p || (t += r)
            }
            var a = 1e-5;
            return Math.abs(t) > a ? t : t < 0 ? -a : a
        },
        computeTransformedVertex: function(t, e) {
            e = e || s.create();
            var i = 3 * t
              , n = this._targetWeights
              , r = this.getVertexAttributeList()
              , a = r.Vertex.getElements()
              , o = 1 - this._computeEffectiveSumWeights();
            e[0] = o * a[i],
            e[1] = o * a[i + 1],
            e[2] = o * a[i + 2];
            for (var u = 0, l = n.length; u < l; ++u) {
                var c = n[u];
                if (!(Math.abs(c) < p)) {
                    var h = r["Vertex_" + u].getElements();
                    e[0] += c * h[i],
                    e[1] += c * h[i + 1],
                    e[2] += c * h[i + 2]
                }
            }
            return e
        },
        computeTransformedVertices: function() {
            for (var t = this._targetWeights, e = this.getVertexAttributeList(), i = e.Vertex.getElements(), n = i.length, r = this._morphedVerts = this._morphedVerts || new Float32Array(n), a = 1 - this._computeEffectiveSumWeights(), s = 0; s < n; ++s)
                r[s] = a * i[s];
            for (var o = 0, u = t.length; o < u; ++o) {
                var l = t[o];
                if (!(Math.abs(l) < p))
                    for (var c = e["Vertex_" + o].getElements(), h = 0; h < n; ++h)
                        r[h] += l * c[h]
            }
            return r
        }
    }), "osgAnimation", "MorphGeometry"),
    n.setTypeID(d),
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1227)
      , a = i(1228)
      , s = i(1238)
      , o = function(t, e) {
        a.call(this),
        this._nbTarget = t,
        this._enable = !e,
        this._targetNames = {},
        this._hashNames = ""
    };
    o.uniforms = {},
    o.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, {
        attributeType: "Morph",
        cloneType: function() {
            return new o((void 0),(!0))
        },
        hasTarget: function(t) {
            return !!this._targetNames[t]
        },
        copyTargetNames: function(t) {
            for (var e = this._targetNames, i = "", n = e.length = t.length, r = 0; r < n; ++r) {
                var a = t[r];
                e[a] = !0,
                i += a
            }
            this._hashNames = i
        },
        getOrCreateUniforms: function() {
            var t = o
              , e = this.getNumTargets();
            if (t.uniforms[e])
                return t.uniforms[e];
            var i = {};
            return i.uTargetWeights = s.createFloat4("uTargetWeights"),
            t.uniforms[e] = new r(i),
            t.uniforms[e]
        },
        getNumTargets: function() {
            return this._nbTarget
        },
        setTargetWeights: function(t) {
            this._targetWeights = t
        },
        getTargetWeights: function() {
            return this._targetWeights
        },
        isEnabled: function() {
            return this._enable
        },
        getHash: function() {
            return this.getTypeMember() + this._hashNames + this.getNumTargets() + this.isEnabled()
        },
        apply: function() {
            if (this._enable) {
                var t = this.getOrCreateUniforms();
                t.uTargetWeights.setFloat4(this._targetWeights)
            }
        }
    }), "osgAnimation", "MorphAttribute"),
    n.setTypeID(o),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1207)
      , a = i(1210)
      , s = i(1286)
      , o = function() {
        a.call(this)
    };
    o.prototype = n.objectInherit(a.prototype, {
        init: function(t) {
            var e = new s;
            return t.getParents().length > 1 && r.warn("A RigGeometry should not have multi parent ( " + t.getName() + " )"),
            t.getParents()[0].accept(e),
            e._root ? (t.setSkeleton(e._root),
            void t.setPathToSkeleton(e._pathToRoot)) : void r.warn("A RigGeometry did not find a parent skeleton for RigGeometry ( " + t.getName() + " )")
        },
        update: function(t) {
            if (t && "RigGeometry" !== t.className())
                return !0;
            var e = t;
            return e.getSkeleton() || 0 === e.getParents().length || this.init(e),
            !e.getSkeleton() || (e.getNeedToComputeMatrix() && e.computeMatrixFromRootSkeleton(),
            e.update(),
            !0)
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1229)
      , a = i(1276)
      , s = function() {
        r.call(this, r.TRAVERSE_PARENTS),
        this._root = void 0,
        this._pathToRoot = void 0
    };
    s.prototype = n.objectInherit(r.prototype, {
        apply: function(t) {
            if (!this._root)
                return t.typeID === a.typeID ? (this._root = t,
                void (this._pathToRoot = this.nodePath.slice(1))) : void this.traverse(t)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).mat4
      , r = i(1228)
      , a = i(1288)
      , s = i(1289)
      , o = function() {
        this._isInitialized = !1,
        this._bones = []
    };
    o.prototype = {
        computeBonePalette: function(t, e) {
            for (var i = window.Object.keys(t), n = i.length, r = this._bones, a = 0; a < n; a++) {
                var s = i[a]
                  , o = e[s]
                  , u = t[s];
                void 0 !== o && (r[o] = u)
            }
            return r
        },
        init: function(t) {
            var e = new s;
            t.getSkeleton().accept(e);
            var i = e.getBoneMap();
            this.computeBonePalette(i, t._boneNameID);
            var n = 3 * this._bones.length
              , o = this._skinningAttribute = new a;
            return o.setMatrixPalette(new Float32Array(4 * n)),
            t.getStateSetAnimation().setAttributeAndModes(o, r.ON),
            this._isInitialized = !0,
            !0
        },
        computeMatrixPalette: function() {
            var t = n.create();
            return function(e, i) {
                for (var r = this._bones, a = this._skinningAttribute.getMatrixPalette(), s = 0, o = 0, u = r.length; o < u; o++) {
                    var l = r[o]
                      , c = l.getInvBindMatrixInSkeletonSpace()
                      , h = l.getMatrixInSkeletonSpace();
                    n.mul(t, h, c),
                    n.mul(t, i, t),
                    n.mul(t, t, e),
                    a[s++] = t[0],
                    a[s++] = t[4],
                    a[s++] = t[8],
                    a[s++] = t[12],
                    a[s++] = t[1],
                    a[s++] = t[5],
                    a[s++] = t[9],
                    a[s++] = t[13],
                    a[s++] = t[2],
                    a[s++] = t[6],
                    a[s++] = t[10],
                    a[s++] = t[14]
                }
            }
        }(),
        update: function(t) {
            this._isInitialized || this.init(t),
            this.computeMatrixPalette(t.getMatrixFromSkeletonToGeometry(), t.getInvMatrixFromSkeletonToGeometry())
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1227)
      , r = i(1203)
      , a = i(1228)
      , s = i(1238)
      , o = function(t, e) {
        a.call(this),
        this._enable = !t,
        this._boneUniformSize = e
    };
    o.uniforms = {},
    o.maxBoneUniformSize = 1,
    o.maxBoneUniformAllowed = 1 / 0,
    o.prototype = r.objectLibraryClass(r.objectInherit(a.prototype, {
        attributeType: "Skinning",
        cloneType: function() {
            return new o((!0))
        },
        setBoneUniformSize: function(t) {
            this._boneUniformSize = t
        },
        getBoneUniformSize: function() {
            return void 0 !== this._boneUniformSize ? this._boneUniformSize : o.maxBoneUniformSize
        },
        getOrCreateUniforms: function() {
            var t = o
              , e = this.getBoneUniformSize();
            if (t.uniforms[e])
                return t.uniforms[e];
            var i = {};
            return i.uBones = s.createFloat4Array("uBones"),
            t.uniforms[e] = new n(i),
            t.uniforms[e]
        },
        setMatrixPalette: function(t) {
            this._matrixPalette = t,
            void 0 === this._boneUniformSize && (o.maxBoneUniformSize = Math.max(o.maxBoneUniformSize, t.length / 4),
            o.maxBoneUniformSize = Math.min(o.maxBoneUniformAllowed, o.maxBoneUniformSize))
        },
        getMatrixPalette: function() {
            return this._matrixPalette
        },
        isEnabled: function() {
            return this._enable
        },
        getHash: function() {
            return this.getTypeMember() + this.getBoneUniformSize() + this.isEnabled()
        },
        apply: function() {
            this._enable && this.getOrCreateUniforms().uBones.setInternalArray(this._matrixPalette)
        }
    }), "osgAnimation", "SkinningAttribute"),
    r.setTypeID(o),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1229)
      , a = i(1207)
      , s = i(1278)
      , o = function() {
        r.call(this, r.TRAVERSE_ALL_CHILDREN),
        this._boneMap = {}
    };
    o.prototype = n.objectInherit(r.prototype, {
        apply: function(t) {
            if (t.typeID === s.typeID) {
                var e = t.getName();
                e ? this._boneMap[e] = t : a.warn("found Bone without name")
            }
            this.traverse(t)
        },
        getBoneMap: function() {
            return this._boneMap
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = function(t, e, i, n) {
        r.call(this),
        this._func = a.LESS,
        this._near = 0,
        this._far = 1,
        this._writeMask = !0,
        void 0 !== t && ("string" == typeof t ? this._func = a[t] : this._func = t),
        void 0 !== e && (this._near = e),
        void 0 !== i && (this._far = i),
        void 0 !== n && (this._writeMask = n)
    };
    a.DISABLE = 0,
    a.NEVER = 512,
    a.LESS = 513,
    a.EQUAL = 514,
    a.LEQUAL = 515,
    a.GREATER = 516,
    a.NOTEQUAL = 517,
    a.GEQUAL = 518,
    a.ALWAYS = 519,
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Depth",
        cloneType: function() {
            return new a
        },
        setRange: function(t, e) {
            this._near = t,
            this._far = e
        },
        setWriteMask: function(t) {
            this._writeMask = t
        },
        getWriteMask: function() {
            return this._writeMask
        },
        getFunc: function() {
            return this._func
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            0 === this._func ? e.disable(e.DEPTH_TEST) : (e.enable(e.DEPTH_TEST),
            e.depthFunc(this._func),
            e.depthMask(this._writeMask),
            e.depthRange(this._near, this._far))
        }
    }), "osg", "Depth"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1212).mat4
      , a = i(1212).vec3
      , s = function() {
        this._radiusEquator = s.WGS_84_RADIUS_EQUATOR,
        this._radiusPolar = s.WGS_84_RADIUS_POLAR,
        this.computeCoefficients()
    };
    s.WGS_84_RADIUS_EQUATOR = 6378137,
    s.WGS_84_RADIUS_POLAR = 6356752.3142,
    s.prototype = {
        setRadiusEquator: function(t) {
            this._radiusEquator = t,
            this.computeCoefficients()
        },
        getRadiusEquator: function() {
            return this._radiusEquator
        },
        setRadiusPolar: function(t) {
            this._radiusPolar = t,
            this.computeCoefficients()
        },
        getRadiusPolar: function() {
            return this._radiusPolar
        },
        convertLatLongHeightToXYZ: function(t, e, i, r) {
            void 0 === r && (n.warn("deprecated, use this signature convertLatLongHeightToXYZ( latitude, longitude, height, result )"),
            r = a.create());
            var s = Math.sin(t)
              , o = Math.cos(t)
              , u = this._radiusEquator / Math.sqrt(1 - this._eccentricitySquared * s * s)
              , l = (u + i) * o * Math.cos(e)
              , c = (u + i) * o * Math.sin(e)
              , h = (u * (1 - this._eccentricitySquared) + i) * s;
            return r[0] = l,
            r[1] = c,
            r[2] = h,
            r
        },
        convertXYZToLatLongHeight: function(t, e, i, r) {
            void 0 === r && (n.warn("deprecated, use this signature convertXYZToLatLongHeight( X,  Y,  Z , result)"),
            r = a.create());
            var s = Math.sqrt(t * t + e * e)
              , o = Math.atan2(i * this._radiusEquator, s * this._radiusPolar)
              , u = (this._radiusEquator * this._radiusEquator - this._radiusPolar * this._radiusPolar) / (this._radiusPolar * this._radiusPolar)
              , l = Math.sin(o)
              , c = Math.cos(o)
              , h = Math.atan((i + u * this._radiusPolar * l * l * l) / (s - this._eccentricitySquared * this._radiusEquator * c * c * c))
              , d = Math.atan2(e, t)
              , p = Math.sin(h)
              , f = this._radiusEquator / Math.sqrt(1 - this._eccentricitySquared * p * p)
              , g = Math.cos(h);
            0 === g && (g = 1);
            var m = s / g - f;
            return r[0] = h,
            r[1] = d,
            r[2] = m,
            r
        },
        computeLocalUpVector: function(t, e, i) {
            var n, r, a, s = this.convertXYZToLatLongHeight(t, e, i, n, r, a);
            return n = s[0],
            r = s[1],
            a = s[2],
            [Math.cos(r) * Math.cos(n), Math.sin(r) * Math.cos(n), Math.sin(n)]
        },
        isWGS84: function() {
            return this._radiusEquator === s.WGS_84_RADIUS_EQUATOR && this._radiusPolar === s.WGS_84_RADIUS_POLAR
        },
        computeCoefficients: function() {
            var t = (this._radiusEquator - this._radiusPolar) / this._radiusEquator;
            this._eccentricitySquared = 2 * t - t * t
        },
        computeLocalToWorldTransformFromLatLongHeight: function(t, e, i, a) {
            void 0 === a && (n.warn("deprecated, use this signature computeLocalToWorldTransformFromLatLongHeight(latitude, longitude, height, result)"),
            a = r.create());
            var s = this.convertLatLongHeightToXYZ(t, e, i, a);
            return r.fromTranslation(a, s),
            this.computeCoordinateFrame(t, e, a),
            a
        },
        computeLocalToWorldTransformFromXYZ: function(t, e, i) {
            var n = this.convertXYZToLatLongHeight(t, e, i)
              , s = r.fromTranslation(r.create(), a.fromValues(t, e, i));
            return this.computeCoordinateFrame(n[0], n[1], s),
            s
        },
        computeCoordinateFrame: function() {
            var t = a.create()
              , e = a.create()
              , i = a.create();
            return function(n, s, o) {
                t[0] = Math.cos(s) * Math.cos(n),
                t[1] = Math.sin(s) * Math.cos(n),
                t[2] = Math.sin(n),
                e[0] = -Math.sin(s),
                e[1] = -Math.cos(s),
                a.cross(i, t, e),
                r.set(o, e[0], e[1], e[2], 0, i[0], i[1], i[2], 0, t[0], t[1], t[2], 0, 0, 0, 0, 1)
            }
        }()
    },
    t.exports = s
}
, function(t, e) {
    "use strict";
    var i = function() {
        this._frame = 0,
        this._startSimulation = 0,
        this._currentSimulation = 0,
        this._deltaTime = 0
    };
    i.prototype = {
        setReferenceTime: function(t) {
            this._startSimulation = t
        },
        getReferenceTime: function() {
            return this._startSimulation
        },
        setSimulationTime: function(t) {
            this._currentSimulation = t
        },
        getSimulationTime: function() {
            return this._currentSimulation
        },
        setDeltaTime: function(t) {
            this._deltaTime = t
        },
        getDeltaTime: function() {
            return this._deltaTime
        },
        setFrameNumber: function(t) {
            this._frame = t
        },
        getFrameNumber: function() {
            return this._frame
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(1203)
      , a = i(1239)
      , s = function(t) {
        a.call(this, t),
        this._canPlayDefered = void 0
    };
    s.PAUSE = 0,
    s.PLAYING = 1,
    s.prototype = r.objectLibraryClass(r.objectInherit(a.prototype, {
        isDirty: function() {
            return this._status === s.PLAYING
        },
        setImage: function(t) {
            a.prototype.setImage.call(this, t),
            this._status = s.STOP,
            t.addEventListener("ended", function() {
                this._imageObject.loop || this.stop()
            }
            .bind(this), !0),
            this.dirty()
        },
        setLooping: function(t) {
            this._imageObject.loop = t
        },
        play: function() {
            this._imageObject.play(),
            this._status = s.PLAYING
        },
        stop: function() {
            this._imageObject.pause(),
            this._status = s.PAUSE
        },
        whenReady: function() {
            return this._imageObject ? (this._canPlayDefered || (this._canPlayDefered = n.defer(),
            this._imageObject.addEventListener("canplaythrough", this._canPlayDefered.resolve.bind(this._canPlayDefered, this), !0)),
            this._canPlayDefered.promise) : n.reject()
        }
    }), "osg", "ImageStream"),
    r.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1212).vec3
      , a = i(1211)
      , s = i(1295)
      , o = i(1244)
      , u = i(1296)
      , l = i(1298)
      , c = function(t, e) {
        this._bb = new a,
        this._first = t,
        this._second = e,
        this._nodeRayStart = r.create(),
        this._nodeRayEnd = r.create()
    }
      , h = function(t) {
        this._kdTree = t,
        this._bb = new a,
        this._primitiveIndices = null,
        this._centers = null,
        this._axisOrder = r.create(),
        this._stackLength = 0
    };
    h.prototype = {
        build: function(t, e) {
            var i = t._targetNumTrianglesPerLeaf
              , r = e.getVertexAttributeList().Vertex;
            if (!r)
                return !1;
            var s = r.getElements();
            if (!s)
                return !1;
            var o = s.length / 3;
            if (o < i)
                return !1;
            this._bb.copy(e.getBoundingBox()),
            this._kdTree.setVertices(s),
            this.computeDivisions(t),
            t._numVerticesProcessed += o,
            this.computeTriangles(e);
            var u = new c((-1),this._primitiveIndices.length);
            u._bb.copy(this._bb);
            var l = this._kdTree.addNode(u)
              , h = new a;
            h.copy(this._bb),
            l = this.divide(t, h, l, 0);
            for (var d = this._kdTree.getTriangles(), p = this._primitiveIndices, f = p.length, g = new n.Uint32Array(d.length), m = 0, v = 0; m < f; ++m,
            v += 3) {
                var _ = 3 * p[m];
                g[v] = d[_],
                g[v + 1] = d[_ + 1],
                g[v + 2] = d[_ + 2]
            }
            return this._kdTree.setTriangles(g),
            this._kdTree.getNodes().length > 0
        },
        computeTriangles: function(t) {
            var e = this._kdTree
              , i = 0
              , r = t.primitives
              , a = r.length
              , u = 0;
            for (u = 0; u < a; u++) {
                var l = r[u]
                  , c = l.getMode();
                c === o.TRIANGLES ? i += l.getCount() : c !== o.TRIANGLE_STRIP && c !== o.TRIANGLE_FAN || (i += 3 * (l.getCount() - 2))
            }
            var h = new n.Uint32Array(i)
              , d = 0
              , p = function(t, e, i) {
                t !== e && t !== i && e !== i && (h[d] = t,
                h[d + 1] = e,
                h[d + 2] = i,
                d += 3)
            }
              , f = new s;
            f.init(t, p),
            f.apply(),
            h = h.subarray(0, d);
            var g = h.length;
            e.setTriangles(h);
            var m = e.getVertices();
            this._centers = new n.Float32Array(g);
            var v = this._centers;
            this._primitiveIndices = new n.Uint32Array(g / 3);
            var _ = this._primitiveIndices
              , b = 0;
            for (u = 0,
            b = 0; u < g; u += 3,
            ++b) {
                var x = h[u]
                  , A = h[u + 1]
                  , y = h[u + 2];
                if (x === A || A === y || x === y)
                    return;
                x *= 3,
                A *= 3,
                y *= 3;
                var S = m[x]
                  , C = m[x + 1]
                  , M = m[x + 2]
                  , w = m[A]
                  , T = m[A + 1]
                  , E = m[A + 2]
                  , I = m[y]
                  , k = m[y + 1]
                  , F = m[y + 2]
                  , D = Math.min(S, Math.min(w, I))
                  , N = Math.min(C, Math.min(T, k))
                  , R = Math.min(M, Math.min(E, F))
                  , P = Math.max(S, Math.max(w, I))
                  , L = Math.max(C, Math.max(T, k))
                  , O = Math.max(M, Math.max(E, F));
                v[u] = .5 * (D + P),
                v[u + 1] = .5 * (N + L),
                v[u + 2] = .5 * (R + O),
                _[b] = b
            }
        },
        computeDivisions: function(t) {
            this._stackLength = t._maxNumLevels;
            var e = this._bb._max
              , i = this._bb._min
              , n = e[0] - i[0]
              , r = e[1] - i[1]
              , a = e[2] - i[2]
              , s = this._axisOrder;
            s[0] = n >= r && n >= a ? 0 : r >= a ? 1 : 2,
            s[2] = n < r && n < a ? 0 : r < a ? 1 : 2;
            var o = s[0] + s[2];
            s[1] = 3 === o ? 0 : 2 === o ? 1 : 2
        },
        divide: function(t, e, i, n) {
            var r = this._kdTree
              , a = this._primitiveIndices
              , s = r.getNodes()
              , o = s[i]
              , u = o._first
              , l = o._second
              , h = n < this._stackLength && u < 0 && l > t._targetNumTrianglesPerLeaf
              , d = -u - 1
              , p = d + l - 1;
            if (!h)
                return u < 0 && this.computeNodeBox(o, d, p),
                i;
            if (u >= 0)
                return i;
            for (var f = this._axisOrder[n % 3], g = e._min[f], m = e._max[f], v = .5 * (g + m), _ = 0, b = 0, x = !1, A = d, y = p, S = this._centers; A < y; ) {
                for (; A < y && S[3 * a[A] + f] <= v; )
                    ++A;
                for (; A < y && S[3 * a[y] + f] > v; )
                    --y;
                if (A < y) {
                    var C = a[A];
                    a[A] = a[y],
                    a[y] = C,
                    ++A,
                    --y
                }
            }
            A === y && (S[3 * a[A] + f] <= v ? ++A : --y),
            y - d <= -1 ? (_ = 0,
            b = i,
            x = !0) : p - A <= -1 ? (_ = i,
            b = 0,
            x = !0) : (_ = r.addNode(new c(-d - 1,y - d + 1)),
            b = r.addNode(new c(-A - 1,p - A + 1)));
            var M = e._max[f];
            e._max[f] = v;
            var w = 0 !== _ ? this.divide(t, e, _, n + 1) : 0;
            e._max[f] = M,
            M = e._min[f],
            e._min[f] = v;
            var T = 0 !== b ? this.divide(t, e, b, n + 1) : 0;
            if (e._min[f] = M,
            !x) {
                o._first = w,
                o._second = T,
                x = !0;
                var E = o._bb;
                E.init(),
                0 !== w && E.expandByBoundingBox(s[w]._bb),
                0 !== T && E.expandByBoundingBox(s[T]._bb)
            }
            return i
        },
        computeNodeBox: function(t, e, i) {
            for (var n = 1 / 0, r = 1 / 0, a = 1 / 0, s = -(1 / 0), o = -(1 / 0), u = -(1 / 0), l = this._kdTree.getTriangles(), c = this._kdTree.getVertices(), h = this._primitiveIndices, d = e; d <= i; ++d) {
                var p = 3 * h[d]
                  , f = 3 * l[p]
                  , g = 3 * l[p + 1]
                  , m = 3 * l[p + 2]
                  , v = c[f]
                  , _ = c[f + 1]
                  , b = c[f + 2]
                  , x = c[g]
                  , A = c[g + 1]
                  , y = c[g + 2]
                  , S = c[m]
                  , C = c[m + 1]
                  , M = c[m + 2];
                n = Math.min(n, Math.min(v, Math.min(x, S))),
                r = Math.min(r, Math.min(_, Math.min(A, C))),
                a = Math.min(a, Math.min(b, Math.min(y, M))),
                s = Math.max(s, Math.max(v, Math.max(x, S))),
                o = Math.max(o, Math.max(_, Math.max(A, C))),
                u = Math.max(u, Math.max(b, Math.max(y, M)))
            }
            var w = 1e-6
              , T = t._bb
              , E = T._min
              , I = T._max;
            E[0] = n - w,
            E[1] = r - w,
            E[2] = a - w,
            I[0] = s + w,
            I[1] = o + w,
            I[2] = u + w
        }
    };
    var d = function() {
        this._vertices = null,
        this._kdNodes = [],
        this._triangles = null
    };
    d.prototype = n.objectLibraryClass({
        getVertices: function() {
            return this._vertices
        },
        setVertices: function(t) {
            this._vertices = t
        },
        getNodes: function() {
            return this._kdNodes
        },
        getTriangles: function() {
            return this._triangles
        },
        setTriangles: function(t) {
            this._triangles = t
        },
        addNode: function(t) {
            return this._kdNodes.push(t),
            this._kdNodes.length - 1
        },
        build: function(t, e) {
            var i = new h(this);
            return i.build(t, e)
        },
        intersectRay: function(t, e, i, n) {
            if (0 === this._kdNodes.length)
                return !1;
            var r = i.length;
            return this._rayIntersector || (this._rayIntersector = new u,
            this._rayIntersector.setKdtree(this._vertices, this._kdNodes, this._triangles)),
            this._rayIntersector.init(i, t, e, n),
            this._rayIntersector.intersect(this.getNodes()[0], t, e),
            r !== i.length
        },
        intersectSphere: function(t, e, i, n) {
            if (0 === this._kdNodes.length)
                return !1;
            var r = i.length;
            return this._sphereIntersector || (this._sphereIntersector = new l,
            this._sphereIntersector.setKdtree(this._vertices, this._kdNodes, this._triangles)),
            this._sphereIntersector.init(i, t, e, n),
            this._sphereIntersector.intersect(this.getNodes()[0]),
            r !== i.length
        }
    }, "osg", "KdTree"),
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(1244)
      , r = i(1246)
      , a = i(1245)
      , s = function() {}
      , o = s.functorDrawElements = []
      , u = s.functorDrawArrays = [];
    o[n.TRIANGLES] = function(t, e, i, n) {
        for (var r = t + e, a = t; a < r; a += 3)
            n(i[a], i[a + 1], i[a + 2])
    }
    ,
    o[n.TRIANGLE_STRIP] = function(t, e, i, n) {
        for (var r = 2, a = t; r < e; ++r,
        ++a)
            r % 2 ? n(i[a], i[a + 2], i[a + 1]) : n(i[a], i[a + 1], i[a + 2])
    }
    ,
    o[n.TRIANGLE_FAN] = function(t, e, i, n) {
        for (var r = i[t], a = 2, s = t + 1; a < e; ++a,
        ++s)
            n(r, i[s], i[s + 1])
    }
    ,
    u[n.TRIANGLES] = function(t, e, i) {
        for (var n = 2, r = t; n < e; n += 3,
        r += 3)
            i(r, r + 1, r + 2)
    }
    ,
    u[n.TRIANGLE_STRIP] = function(t, e, i) {
        for (var n = 2, r = t; n < e; ++n,
        ++r)
            n % 2 ? i(r, r + 2, r + 1) : i(r, r + 1, r + 2)
    }
    ,
    u[n.TRIANGLE_FAN] = function(t, e, i) {
        for (var n = 2, r = t + 1; n < e; ++n,
        ++r)
            i(t, r, r + 1)
    }
    ,
    s.prototype = {
        init: function(t, e) {
            this._geom = t,
            this._cb = e
        },
        apply: function() {
            var t = this._geom
              , e = t.primitives;
            if (e)
                for (var i, n = this._cb, s = e.length, l = 0; l < s; l++) {
                    var c = e[l];
                    if (c instanceof r) {
                        if (i = o[c.getMode()]) {
                            var h = c.indices.getElements();
                            i(c.getFirst() / h.BYTES_PER_ELEMENT, c.getCount(), h, n)
                        }
                    } else
                        c instanceof a && (i = u[c.getMode()],
                        i && i(c.getFirst(), c.getCount(), n))
                }
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).vec3
      , r = i(1297)
      , a = i(1207)
      , s = function() {
        arguments && arguments.length && a.warn("using ctor as initialiser is deprecated, use init(intersections, start, end, nodePath) and/or     setKdtree: function ( vertices, nodes, triangles )"),
        this._intersector = new r,
        this._dInvX = n.create(),
        this._dInvY = n.create(),
        this._dInvZ = n.create()
    };
    s.prototype = {
        setKdtree: function(t, e, i) {
            this._vertices = t,
            this._kdNodes = e,
            this._triangles = i
        },
        init: function() {
            var t = n.create();
            return function(e, i, r, a) {
                var s = n.sub(t, r, i)
                  , o = n.length(s)
                  , u = 0;
                0 !== o && (u = 1 / o),
                n.scale(s, s, u),
                0 !== s[0] && n.scale(this._dInvX, s, 1 / s[0]),
                0 !== s[1] && n.scale(this._dInvY, s, 1 / s[1]),
                0 !== s[2] && n.scale(this._dInvZ, s, 1 / s[2]),
                this._intersector._intersections = e,
                this._intersector.setNodePath(a),
                this._intersector.set(i, r)
            }
        }(),
        intersect: function() {
            var t = n.create()
              , e = n.create()
              , i = n.create();
            return function(r, a, s) {
                var o = r._first
                  , u = r._second
                  , l = this._triangles
                  , c = this._vertices;
                if (o < 0) {
                    var h = -o - 1
                      , d = h + u
                      , p = this._intersector;
                    p.index = h;
                    for (var f = h; f < d; ++f) {
                        var g = 3 * f
                          , m = l[g]
                          , v = l[g + 1]
                          , _ = l[g + 2]
                          , b = 3 * m;
                        t[0] = c[b],
                        t[1] = c[b + 1],
                        t[2] = c[b + 2],
                        b = 3 * v,
                        e[0] = c[b],
                        e[1] = c[b + 1],
                        e[2] = c[b + 2],
                        b = 3 * _,
                        i[0] = c[b],
                        i[1] = c[b + 1],
                        i[2] = c[b + 2],
                        p.intersect(t, e, i, m, v, _)
                    }
                } else {
                    var x, A = r._nodeRayStart, y = r._nodeRayEnd, S = this._kdNodes;
                    n.copy(A, a),
                    n.copy(y, s),
                    o > 0 && (x = S[o],
                    this.intersectAndClip(A, y, x._bb) && this.intersect(x, A, y)),
                    u > 0 && (n.copy(A, a),
                    n.copy(y, s),
                    x = S[u],
                    this.intersectAndClip(A, y, x._bb) && this.intersect(x, A, y))
                }
            }
        }(),
        intersectAndClip: function() {
            return function(t, e, i) {
                var r = i._min
                  , a = r[0]
                  , s = r[1]
                  , o = r[2]
                  , u = i._max
                  , l = u[0]
                  , c = u[1]
                  , h = u[2]
                  , d = this._dInvX
                  , p = this._dInvY
                  , f = this._dInvZ;
                if (t[0] <= e[0]) {
                    if (e[0] < a)
                        return !1;
                    if (t[0] > l)
                        return !1;
                    t[0] < a && n.scaleAndAdd(t, t, d, a - t[0]),
                    e[0] > l && n.scaleAndAdd(e, t, d, l - t[0])
                } else {
                    if (t[0] < a)
                        return !1;
                    if (e[0] > l)
                        return !1;
                    e[0] < a && n.scaleAndAdd(e, t, d, a - t[0]),
                    t[0] > l && n.scaleAndAdd(t, t, d, l - t[0])
                }
                if (t[1] <= e[1]) {
                    if (e[1] < s)
                        return !1;
                    if (t[1] > c)
                        return !1;
                    t[1] < s && n.scaleAndAdd(t, t, p, s - t[1]),
                    e[1] > c && n.scaleAndAdd(e, t, p, c - t[1])
                } else {
                    if (t[1] < s)
                        return !1;
                    if (e[1] > c)
                        return !1;
                    e[1] < s && n.scaleAndAdd(e, t, p, s - t[1]),
                    t[1] > c && n.scaleAndAdd(t, t, p, c - t[1])
                }
                if (t[2] <= e[2]) {
                    if (e[2] < o)
                        return !1;
                    if (t[2] > h)
                        return !1;
                    t[2] < o && n.scaleAndAdd(t, t, f, o - t[2]),
                    e[2] > h && n.scaleAndAdd(e, t, f, h - t[2])
                } else {
                    if (t[2] < o)
                        return !1;
                    if (e[2] > h)
                        return !1;
                    e[2] < o && n.scaleAndAdd(e, t, f, o - t[2]),
                    t[2] > h && n.scaleAndAdd(t, t, f, h - t[2])
                }
                return !0
            }
        }()
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).vec3
      , r = i(1212).mat4
      , a = i(1295)
      , s = i(1207)
      , o = i(1231)
      , u = function(t, e, i, n, r, a, s) {
        this.normal = t,
        this.i1 = e,
        this.i2 = i,
        this.i3 = n,
        this.r1 = r,
        this.r2 = a,
        this.r3 = s
    }
      , l = function() {
        arguments && arguments.length && s.warn("using ctor as initialiser is deprecated, use set(start, end)"),
        this._intersections = [],
        this._nodePath = [],
        this._dir = n.create()
    };
    l.prototype = {
        reset: function() {
            this._intersections.length = 0
        },
        setNodePath: function(t) {
            this._nodePath = t
        },
        set: function(t, e) {
            this._start = t,
            this._end = e,
            this._dir = n.sub(this._dir, e, t),
            this._length = n.length(this._dir),
            this._invLength = 1 / this._length,
            n.scale(this._dir, this._dir, this._invLength)
        },
        apply: function() {
            var t = n.create()
              , e = n.create()
              , i = n.create()
              , r = new a;
            return function(n) {
                if (n.getAttributes().Vertex) {
                    var a = n.getAttributes().Vertex.getElements()
                      , s = this
                      , o = function(n, r, o) {
                        if (n !== r && n !== o && r !== o) {
                            var u = 3 * n;
                            t[0] = a[u],
                            t[1] = a[u + 1],
                            t[2] = a[u + 2],
                            u = 3 * r,
                            e[0] = a[u],
                            e[1] = a[u + 1],
                            e[2] = a[u + 2],
                            u = 3 * o,
                            i[0] = a[u],
                            i[1] = a[u + 1],
                            i[2] = a[u + 2],
                            s.intersect(t, e, i, n, r, o)
                        }
                    };
                    r.init(n, o),
                    r.apply()
                }
            }
        }(),
        isBackFace: function() {
            var t = r.create();
            return function(e, i) {
                r.identity(t),
                o.computeLocalToWorld(i, !0, t);
                var n = r.determinant(t);
                return n * e < 0
            }
        }(),
        intersect: function() {
            var t = n.create()
              , e = n.create()
              , i = n.create()
              , r = n.create()
              , a = n.create()
              , s = n.create()
              , o = 1e-20;
            return function(l, c, h, d, p, f) {
                var g = this._dir;
                n.sub(e, h, l),
                n.sub(i, c, l),
                n.cross(a, g, e);
                var m = n.dot(a, i);
                if (!(m > -o && m < o)) {
                    var v = 1 / m;
                    n.sub(r, this._start, l);
                    var _ = n.dot(a, r) * v;
                    if (!(_ < 0 || _ > 1)) {
                        n.cross(s, r, i);
                        var b = n.dot(s, g) * v;
                        if (!(b < 0 || _ + b > 1)) {
                            var x = n.dot(s, e) * v;
                            if (!(x < o || x > this._length)) {
                                var A = 1 - _ - b
                                  , y = _
                                  , S = b
                                  , C = x * this._invLength
                                  , M = l[0] * A + c[0] * y + h[0] * S
                                  , w = l[1] * A + c[1] * y + h[1] * S
                                  , T = l[2] * A + c[2] * y + h[2] * S;
                                n.cross(t, i, e),
                                n.normalize(t, t),
                                this._intersections.push({
                                    ratio: C,
                                    backface: this.isBackFace(m, this._nodePath),
                                    nodepath: this._nodePath.slice(0),
                                    TriangleIntersection: new u(n.clone(t),d,p,f,A,y,S),
                                    point: n.fromValues(M, w, T)
                                }),
                                this.hit = !0
                            }
                        }
                    }
                }
            }
        }()
    },
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1212).vec3
      , a = i(1296)
      , s = i(1299)
      , o = function() {
        this._intersector = new s
    };
    o.prototype = n.objectInherit(a.prototype, {
        init: function(t, e, i, n) {
            this._intersector._intersections = t,
            this._intersector.setNodePath(n),
            this._intersector.set(e, i),
            this._center = e,
            this._radius = i
        },
        intersect: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create();
            return function(n) {
                var r = n._first
                  , a = n._second
                  , s = this._triangles
                  , o = this._vertices;
                if (r < 0) {
                    var u = -r - 1
                      , l = u + a
                      , c = this._intersector;
                    c.index = u;
                    for (var h = u; h < l; ++h) {
                        var d = 3 * h
                          , p = s[d]
                          , f = s[d + 1]
                          , g = s[d + 2]
                          , m = 3 * p;
                        t[0] = o[m],
                        t[1] = o[m + 1],
                        t[2] = o[m + 2],
                        m = 3 * f,
                        e[0] = o[m],
                        e[1] = o[m + 1],
                        e[2] = o[m + 2],
                        m = 3 * g,
                        i[0] = o[m],
                        i[1] = o[m + 1],
                        i[2] = o[m + 2],
                        c.intersect(t, e, i, p, f, g)
                    }
                } else
                    r > 0 && this.intersectSphere(this._kdNodes[r]._bb) && this.intersect(this._kdNodes[r]),
                    a > 0 && this.intersectSphere(this._kdNodes[a]._bb) && this.intersect(this._kdNodes[a])
            }
        }(),
        intersectSphere: function() {
            var t = r.create();
            return function(e) {
                var i = this._radius + e.radius();
                return r.sqrDist(e.center(t), this._center) <= i * i
            }
        }()
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1212).vec3
      , a = i(1297)
      , s = i(1207)
      , o = function(t, e, i, n) {
        this.normal = t,
        this.i1 = e,
        this.i2 = i,
        this.i3 = n
    }
      , u = function() {
        a.apply(this, arguments),
        arguments && arguments.length && s.warn("using ctor as initialiser is deprecated, use set(center, radius)")
    };
    u.prototype = n.objectInherit(a.prototype, {
        set: function(t, e) {
            this._center = t,
            this._radius = e
        },
        intersect: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create();
            return function(n, a, s, u, l, c) {
                r.sub(t, a, n),
                r.sub(e, s, n);
                var h = r.sqrLen(t)
                  , d = r.dot(t, e)
                  , p = r.sqrLen(e);
                r.sub(i, n, this._center);
                var f = r.dot(i, t)
                  , g = r.dot(i, e)
                  , m = r.sqrLen(i)
                  , v = Math.abs(h * p - d * d);
                if (!(v < 1e-10)) {
                    var _, b = d * g - p * f, x = d * f - h * g, A = 4;
                    if (b + x <= v)
                        if (b < 0)
                            x < 0 ? (A = 4,
                            f < 0 ? (x = 0,
                            -f >= h ? (b = 1,
                            _ = h + 2 * f + m) : (b = -f / h,
                            _ = f * b + m)) : (b = 0,
                            g >= 0 ? (x = 0,
                            _ = m) : -g >= p ? (x = 1,
                            _ = p + 2 * g + m) : (x = -g / p,
                            _ = g * x + m))) : (A = 3,
                            b = 0,
                            g >= 0 ? (x = 0,
                            _ = m) : -g >= p ? (x = 1,
                            _ = p + 2 * g + m) : (x = -g / p,
                            _ = g * x + m));
                        else if (x < 0)
                            A = 5,
                            x = 0,
                            f >= 0 ? (b = 0,
                            _ = m) : -f >= h ? (b = 1,
                            _ = h + 2 * f + m) : (b = -f / h,
                            _ = f * b + m);
                        else {
                            A = 0;
                            var y = 1 / v;
                            b *= y,
                            x *= y,
                            _ = b * (h * b + d * x + 2 * f) + x * (d * b + p * x + 2 * g) + m
                        }
                    else {
                        var S, C, M, w;
                        b < 0 ? (A = 2,
                        S = d + f,
                        C = p + g,
                        C > S ? (M = C - S,
                        w = h - 2 * d + p,
                        M >= w ? (b = 1,
                        x = 0,
                        _ = h + 2 * f + m) : (b = M / w,
                        x = 1 - b,
                        _ = b * (h * b + d * x + 2 * f) + x * (d * b + p * x + 2 * g) + m)) : (b = 0,
                        C <= 0 ? (x = 1,
                        _ = p + 2 * g + m) : g >= 0 ? (x = 0,
                        _ = m) : (x = -g / p,
                        _ = g * x + m))) : x < 0 ? (A = 6,
                        S = d + g,
                        C = h + f,
                        C > S ? (M = C - S,
                        w = h - 2 * d + p,
                        M >= w ? (x = 1,
                        b = 0,
                        _ = p + 2 * g + m) : (x = M / w,
                        b = 1 - x,
                        _ = b * (h * b + d * x + 2 * f) + x * (d * b + p * x + 2 * g) + m)) : (x = 0,
                        C <= 0 ? (b = 1,
                        _ = h + 2 * f + m) : f >= 0 ? (b = 0,
                        _ = m) : (b = -f / h,
                        _ = f * b + m))) : (A = 1,
                        M = p + g - d - f,
                        M <= 0 ? (b = 0,
                        x = 1,
                        _ = p + 2 * g + m) : (w = h - 2 * d + p,
                        M >= w ? (b = 1,
                        x = 0,
                        _ = h + 2 * f + m) : (b = M / w,
                        x = 1 - b,
                        _ = b * (h * b + d * x + 2 * f) + x * (d * b + p * x + 2 * g) + m)))
                    }
                    if (_ < 0 && (_ = 0),
                    !(_ > this._radius * this._radius)) {
                        var T = r.create();
                        T && (T[0] = n[0] + b * t[0] + x * e[0],
                        T[1] = n[1] + b * t[1] + x * e[1],
                        T[2] = n[2] + b * t[2] + x * e[2]);
                        var E = r.create();
                        r.cross(E, t, e),
                        r.normalize(E, E),
                        this._intersections.push({
                            ratio: Math.sqrt(_),
                            nodepath: this._nodePath.slice(0),
                            TriangleIntersection: new o(E,u,l,c),
                            point: T,
                            zone: A
                        }),
                        this.hit = !0
                    }
                }
            }
        }()
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1229)
      , a = i(1294)
      , s = function(t) {
        r.call(this),
        this._buildOptions = void 0 !== t ? t : {
            _numVerticesProcessed: 0,
            _targetNumTrianglesPerLeaf: 50,
            _maxNumLevels: 20
        }
    };
    s.prototype = n.objectInherit(r.prototype, {
        apply: function(t) {
            if (t.getShape) {
                var e = t.getShape();
                if (void 0 === e) {
                    var i = new a;
                    i.build(this._buildOptions, t) && t.setShape(i)
                }
            }
            this.traverse(t)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = i(1238)
      , s = i(1212).mat4
      , o = i(1212).vec3
      , u = i(1212).vec4
      , l = i(1227)
      , c = i(1207)
      , h = function(t, e) {
        r.call(this);
        var i = void 0 !== t ? t : 0;
        this._ambient = u.fromValues(.2, .2, .2, 1),
        this._diffuse = u.fromValues(.8, .8, .8, 1),
        this._specular = u.fromValues(.2, .2, .2, 1),
        this._position = u.fromValues(0, 0, 1, 0),
        this._direction = o.fromValues(0, 0, -1),
        this._ground = u.fromValues(.2, .2, .2, -1),
        this._spotCutoff = 180,
        this._spotBlend = .01,
        this._attenuation = u.fromValues(1, 0, 0, 0),
        this._lightUnit = i,
        this._invMatrix = s.create(),
        this._enable = !e
    };
    h.DIRECTION = "DIRECTION",
    h.SPOT = "SPOT",
    h.POINT = "POINT",
    h.HEMI = "HEMI",
    h.uniforms = {},
    h.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Light",
        cloneType: function() {
            return new h(this._lightUnit,(!0))
        },
        getTypeMember: function() {
            return this.attributeType + this._lightUnit
        },
        getUniformName: function(t) {
            var e = this.getType() + this._lightUnit.toString();
            return "u" + e + "_" + t
        },
        getHash: function() {
            return this.getTypeMember() + this.getLightType() + this.isEnabled().toString()
        },
        getOrCreateUniforms: function() {
            var t = h
              , e = this.getTypeMember();
            if (t.uniforms[e])
                return t.uniforms[e];
            var i = {
                ambient: a.createFloat4(this.getUniformName("ambient")),
                diffuse: a.createFloat4(this.getUniformName("diffuse")),
                specular: a.createFloat4(this.getUniformName("specular")),
                attenuation: a.createFloat4(this.getUniformName("attenuation")),
                position: a.createFloat4(this.getUniformName("position")),
                direction: a.createFloat3(this.getUniformName("direction")),
                spotCutOff: a.createFloat1(this.getUniformName("spotCutOff")),
                spotBlend: a.createFloat1(this.getUniformName("spotBlend")),
                ground: a.createFloat4(this.getUniformName("ground")),
                matrix: a.createMatrix4(this.getUniformName("matrix")),
                invMatrix: a.createMatrix4(this.getUniformName("invMatrix"))
            };
            return t.uniforms[e] = new l(i),
            t.uniforms[e]
        },
        isEnabled: function() {
            return this._enable
        },
        setEnabled: function(t) {
            this._enable = t
        },
        isEnable: function() {
            return c.log("Light.isEnable() is deprecated, use isEnabled instead"),
            this.isEnabled()
        },
        setEnable: function(t) {
            c.log("Light.setEnable() is deprecated, use setEnabled instead"),
            this.setEnabled(t)
        },
        setAmbient: function(t) {
            u.copy(this._ambient, t)
        },
        getAmbient: function() {
            return this._ambient
        },
        setDiffuse: function(t) {
            u.copy(this._diffuse, t)
        },
        getDiffuse: function() {
            return this._diffuse
        },
        setSpecular: function(t) {
            u.copy(this._specular, t)
        },
        getSpecular: function() {
            return this._specular
        },
        setPosition: function(t) {
            u.copy(this._position, t)
        },
        getPosition: function() {
            return this._position
        },
        setDirection: function(t) {
            o.copy(this._direction, t)
        },
        getDirection: function() {
            return this._direction
        },
        setSpotCutoff: function(t) {
            this._spotCutoff = t
        },
        getSpotCutoff: function() {
            return this._spotCutoff
        },
        setSpotBlend: function(t) {
            this._spotBlend = t
        },
        getSpotBlend: function() {
            return this._spotBlend
        },
        setGround: function(t) {
            o.copy(this._ground, t)
        },
        getGround: function() {
            return this._ground
        },
        setConstantAttenuation: function(t) {
            this._attenuation[0] = t
        },
        getConstantAttenuation: function() {
            return this._attenuation[0]
        },
        setLinearAttenuation: function(t) {
            this._attenuation[1] = t
        },
        getLinearAttenuation: function() {
            return this._attenuation[1]
        },
        setQuadraticAttenuation: function(t) {
            this._attenuation[2] = t
        },
        getQuadraticAttenuation: function() {
            return this._attenuation[2]
        },
        setLightType: function(t) {
            return t === h.DIRECTION ? this.setLightAsDirection() : t === h.SPOT ? this.setLightAsSpot() : t === h.HEMI ? this.setLightAsHemi() : this.setLightAsPoint()
        },
        getLightType: function() {
            return this.isDirectionLight() ? h.DIRECTION : this.isSpotLight() ? h.SPOT : this.isHemiLight() ? h.HEMI : h.POINT
        },
        setLightAsSpot: function() {
            u.set(this._position, 0, 0, 0, 1),
            o.set(this._direction, 0, 0, -1),
            this._ground[3] = -1,
            this._spotCutoff = 90
        },
        setLightAsPoint: function() {
            u.set(this._position, 0, 0, 0, 1),
            o.set(this._direction, 0, 0, -1),
            this._ground[3] = -1
        },
        setLightAsDirection: function() {
            u.set(this._position, 0, 0, 1, 0),
            this._spotCutoff = 180,
            this._ground[3] = -1
        },
        setLightAsHemi: function() {
            u.set(this._position, 0, 0, 1, 0),
            this._spotCutoff = 180,
            this._ground[3] = 1
        },
        setLightNumber: function(t) {
            this._lightUnit = t
        },
        getLightNumber: function() {
            return this._lightUnit
        },
        isSpotLight: function() {
            return this._spotCutoff < 180
        },
        isDirectionLight: function() {
            return 0 === this._position[3] && this._ground[3] === -1
        },
        isHemiLight: function() {
            return 1 === this._ground[3]
        },
        applyPositionedUniform: function(t) {
            var e = this.getOrCreateUniforms()
              , i = e.matrix.getInternalArray()
              , n = e.invMatrix.getInternalArray();
            s.copy(i, t),
            s.copy(n, t),
            n[12] = 0,
            n[13] = 0,
            n[14] = 0,
            s.invert(n, n),
            s.transpose(n, n)
        },
        apply: function() {
            if (this._enable) {
                var t = this.getOrCreateUniforms();
                if (t.position.setFloat4(this._position),
                this.isSpotLight()) {
                    var e = Math.cos(this._spotCutoff * Math.PI / 180);
                    t.spotCutOff.setFloat(e),
                    t.spotBlend.setFloat((1 - e) * this._spotBlend),
                    t.direction.setFloat3(this._direction)
                }
                this.isHemiLight() && t.ground.setFloat4(this._ground),
                t.attenuation.setFloat4(this._attenuation),
                t.diffuse.setFloat4(this._diffuse),
                t.specular.setFloat4(this._specular),
                t.ambient.setFloat4(this._ambient)
            }
        }
    }), "osg", "Light"),
    n.setTypeID(h),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = function(t) {
        r.call(this),
        this.lineWidth = 1,
        void 0 !== t && (this.lineWidth = t)
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "LineWidth",
        cloneType: function() {
            return new a
        },
        apply: function(t) {
            t.getGraphicContext().lineWidth(this.lineWidth)
        }
    }), "osg", "LineWidth"),
    t.exports = a
}
, function(t, e, i) {
    t.exports = i(1304)
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1213)
      , a = i(1211)
      , s = i(1266)
      , o = i(1212).vec3
      , u = i(1212)
      , l = Math.abs
      , c = Number.MIN_VALUE
      , h = u.mat4.create
      , d = {
        create: u.mat4.create,
        createAndSet: u.mat4.fromValues,
        isIdentity: function(t) {
            return u.mat4.equals(d.identity, t)
        },
        valid: function(t) {
            for (var e = 0; e < 16; e++)
                if (r.isNaN(t[e]))
                    return !1;
            return !0
        },
        setRow: function(t, e, i, n, r, a) {
            var s = 4 * e;
            t[s + 0] = i,
            t[s + 1] = n,
            t[s + 2] = r,
            t[s + 3] = a
        },
        innerProduct: function(t, e, i, n) {
            var r = 4 * i;
            return t[r + 0] * e[0 + n] + t[r + 1] * e[4 + n] + t[r + 2] * e[8 + n] + t[r + 3] * e[12 + n]
        },
        set: function(t, e, i, n) {
            return t[4 * e + i] = n,
            n
        },
        get: function(t, e, i) {
            return t[4 * e + i]
        },
        makeIdentity: u.mat4.identity,
        equal: u.mat4.exactEquals,
        makeTranslate: function(t, e, i, n) {
            return u.mat4.fromTranslation(n, o.fromValues(t, e, i))
        },
        setTrans: function(t, e, i, n) {
            return t[12] = e,
            t[13] = i,
            t[14] = n,
            t
        },
        getTrans: function(t, e) {
            return u.mat4.getTranslation(e, t)
        },
        preMult: function(t, e) {
            return u.mat4.multiply(t, t, e)
        },
        postMult: function(t, e) {
            return u.mat4.multiply(e, t, e)
        },
        mult: function(t, e, i) {
            return u.mat4.multiply(i, t, e)
        },
        makeLookFromDirection: function() {
            var t = o.create()
              , e = o.create()
              , i = o.create();
            return function(n, r, a, s) {
                var u = r;
                return o.cross(t, u, a),
                o.normalize(t, t),
                o.cross(e, t, u),
                o.normalize(e, e),
                s[0] = t[0],
                s[1] = e[0],
                s[2] = -u[0],
                s[3] = 0,
                s[4] = t[1],
                s[5] = e[1],
                s[6] = -u[1],
                s[7] = 0,
                s[8] = t[2],
                s[9] = e[2],
                s[10] = -u[2],
                s[11] = 0,
                s[12] = 0,
                s[13] = 0,
                s[14] = 0,
                s[15] = 1,
                d.multTranslate(s, o.neg(i, n), s),
                s
            }
        }(),
        makeLookAt: function(t, e, i, n) {
            return u.mat4.lookAt(n, t, e, i)
        },
        makeOrtho: function(t, e, i, n, r, a, s) {
            return u.mat4.ortho(s, t, e, i, n, r, a)
        },
        getLookAt: function() {
            var t = h()
              , e = o.create()
              , i = o.fromValues(0, 1, 0)
              , n = o.fromValues(0, 0, -1);
            return function(r, a, s, l, c) {
                void 0 === c && (c = 1);
                var h = d.inverse(r, t);
                h || u.mat4.identity(t),
                d.transformVec3(t, e, a),
                d.transform3x3(r, i, l),
                d.transform3x3(r, n, s),
                o.normalize(s, s),
                o.add(s, o.scale(e, s, c), a)
            }
        }(),
        getRotate: function(t, e) {
            return u.mat4.getRotation(e, t)
        },
        preMultTranslate: function(t, e) {
            return u.mat4.translate(t, t, e)
        },
        postMultTranslate: function(t, e) {
            return u.mat4.multiply(t, u.mat4.fromTranslation(u.mat4.create(), e), t)
        },
        multTranslate: function(t, e, i) {
            return u.mat4.translate(i, t, e)
        },
        makeRotate: function(t, e, i, n, r) {
            var a = o.fromValues(e, i, n);
            return 0 === e && 0 === i && 0 === n && (a[2] = 1),
            u.mat4.fromRotation(r, t, a)
        },
        preMultRotate: function() {
            var t = h();
            return function(e, i) {
                return u.mat4.multiply(e, e, u.mat4.fromQuat(t, i))
            }
        }(),
        postMultRotate: function() {
            var t = h();
            return function(e, i) {
                return u.mat4.multiply(e, u.mat4.fromQuat(t, i), e)
            }
        }(),
        transform3x3: function(t, e, i) {
            return i[0] = t[0] * e[0] + t[1] * e[1] + t[2] * e[2],
            i[1] = t[4] * e[0] + t[5] * e[1] + t[6] * e[2],
            i[2] = t[8] * e[0] + t[9] * e[1] + t[10] * e[2],
            i
        },
        transformVec3: function(t, e, i) {
            return u.vec3.transformMat4(i, e, t)
        },
        transformVec4: function(t, e, i) {
            return u.vec4.transformMat4(i, e, t)
        },
        transformBoundingBox: function() {
            var t = new a;
            return function(e, i, n) {
                n === i && (n = t);
                for (var r = i.getMin(), a = i.getMax(), s = u.mat4.getTranslation(n.getMin(), e), l = o.copy(n.getMax(), s), c = 0; c < 3; ++c)
                    for (var h = 4 * c, d = r[c], p = a[c], f = 0; f < 3; ++f) {
                        var g = e[h + f]
                          , m = g * p
                          , v = g * d;
                        m < v ? (s[f] += m,
                        l[f] += v) : (s[f] += v,
                        l[f] += m)
                    }
                n === t && i.copy(t)
            }
        }(),
        transformBoundingSphere: function() {
            var t = o.create();
            return function(e, i, n) {
                if (!i.valid())
                    return n;
                o.copy(n._center, i._center),
                n._radius = i._radius;
                var r = n._center
                  , a = n._radius;
                d.getScale2(e, t);
                var s = Math.sqrt(Math.max(Math.max(t[0], t[1]), t[2]));
                return a *= s,
                n._radius = a,
                d.transformVec3(e, r, r),
                n
            }
        }(),
        transformVec4PostMult: function(t, e, i) {
            var n = e[0]
              , r = e[1]
              , a = e[2]
              , s = e[3];
            return i[0] = t[0] * n + t[1] * r + t[2] * a + t[3] * s,
            i[1] = t[4] * n + t[5] * r + t[6] * a + t[7] * s,
            i[2] = t[8] * n + t[9] * r + t[10] * a + t[11] * s,
            i[3] = t[12] * n + t[13] * r + t[14] * a + t[15] * s,
            i
        },
        copy: function(t, e) {
            return u.mat4.copy(e, t)
        },
        inverse: function(t, e) {
            var i = u.mat4.invert(e, t);
            return null !== i
        },
        transpose: function(t, e) {
            return u.mat4.transpose(e, t)
        },
        getFrustumPlanes: function() {
            var t = h();
            return function(e, i, n, r) {
                u.mat4.multiply(t, e, i),
                void 0 === r && (r = !1);
                var a = n[0];
                a[0] = t[3] - t[0],
                a[1] = t[7] - t[4],
                a[2] = t[11] - t[8],
                a[3] = t[15] - t[12];
                var o = n[1];
                o[0] = t[3] + t[0],
                o[1] = t[7] + t[4],
                o[2] = t[11] + t[8],
                o[3] = t[15] + t[12];
                var l = n[2];
                l[0] = t[3] + t[1],
                l[1] = t[7] + t[5],
                l[2] = t[11] + t[9],
                l[3] = t[15] + t[13];
                var c = n[3];
                if (c[0] = t[3] - t[1],
                c[1] = t[7] - t[5],
                c[2] = t[11] - t[9],
                c[3] = t[15] - t[13],
                r) {
                    var h = n[4];
                    h[0] = t[3] - t[2],
                    h[1] = t[7] - t[6],
                    h[2] = t[11] - t[10],
                    h[3] = t[15] - t[14];
                    var d = n[5];
                    d[0] = t[3] + t[2],
                    d[1] = t[7] + t[6],
                    d[2] = t[11] + t[10],
                    d[3] = t[15] + t[14]
                }
                for (var p = r ? 6 : 4, f = 0; f < p; f++)
                    s.normalizeEquation(n[f])
            }
        }(),
        makePerspective: function(t, e, i, n, r) {
            return u.mat4.perspective(r, t * Math.PI / 180, e, i, n)
        },
        getFrustum: function(t, e) {
            var i, n, r = 0, a = 0, s = 0, o = 0;
            if (0 !== t[3] || 0 !== t[7] || t[11] !== -1 || 0 !== t[15])
                return !1;
            var u = t[14] / (t[10] - 1)
              , l = t[14] / (1 + t[10]);
            return a = u * (t[8] - 1) / t[0],
            r = u * (1 + t[8]) / t[0],
            s = u * (1 + t[9]) / t[5],
            o = u * (t[9] - 1) / t[5],
            i = u,
            n = l,
            e.left = a,
            e.right = r,
            e.top = s,
            e.bottom = o,
            e.zNear = i,
            e.zFar = n,
            !0
        },
        getPerspective: function() {
            var t = {
                right: 0,
                left: 0,
                top: 0,
                bottom: 0,
                zNear: 0,
                zFar: 0
            };
            return function(e, i) {
                var n = d.getFrustum(e, t);
                return n && (i.fovy = 180 / Math.PI * (Math.atan(t.top / t.zNear) - Math.atan(t.bottom / t.zNear)),
                i.aspectRatio = (t.right - t.left) / (t.top - t.bottom)),
                i.zNear = t.zNear,
                i.zFar = t.zFar,
                i
            }
        }(),
        preMultScale: function(t, e) {
            return u.mat4.scale(t, t, e)
        },
        postMultScale: function(t, e) {
            return u.mat4.multiply(t, u.mat4.fromScaling(u.mat4.create(), e), t)
        },
        makeScale: function(t, e, i, n) {
            return u.mat4.fromScaling(n, [t, e, i])
        },
        getScale: function() {
            var t = o.create()
              , e = o.create()
              , i = o.create();
            return function(n, r) {
                return t[0] = n[0],
                t[1] = n[4],
                t[2] = n[8],
                e[0] = n[1],
                e[1] = n[5],
                e[2] = n[9],
                i[0] = n[2],
                i[1] = n[6],
                i[2] = n[10],
                r[0] = o.length(t),
                r[1] = o.length(e),
                r[2] = o.length(i),
                r
            }
        }(),
        getScale2: function() {
            var t = o.create()
              , e = o.create()
              , i = o.create();
            return function(n, r) {
                return t[0] = n[0],
                t[1] = n[4],
                t[2] = n[8],
                e[0] = n[1],
                e[1] = n[5],
                e[2] = n[9],
                i[0] = n[2],
                i[1] = n[6],
                i[2] = n[10],
                r[0] = o.sqrLen(t),
                r[1] = o.sqrLen(e),
                r[2] = o.sqrLen(i),
                r
            }
        }(),
        clampProjectionMatrix: function(t, e, i, r, a) {
            var s = 1e-6;
            if (i < e - s)
                return n.log("clampProjectionMatrix not applied, invalid depth range, znear = " + e + "  zfar = " + i, !1, !0),
                !1;
            var o, u;
            if (i < e + s) {
                var l = .5 * (e + i);
                e = l - s,
                i = l + s
            }
            if (Math.abs(t[3]) < s && Math.abs(t[7]) < s && Math.abs(t[11]) < s) {
                var c = .02 * (i - e);
                c < 1 && (c = 1),
                o = e - c,
                u = i + c,
                e = o,
                i = u,
                t[10] = -2 / (u - o),
                t[14] = -(u + o) / (u - o)
            } else {
                var h = 1.02
                  , d = .98;
                o = e * d,
                u = i * h;
                var p = i * r;
                o < p && (o = p),
                e = o,
                i = u;
                var f = t[10]
                  , g = t[14]
                  , m = t[11]
                  , v = t[15]
                  , _ = (-o * f + g) / (-o * m + v)
                  , b = (-u * f + g) / (-u * m + v)
                  , x = Math.abs(2 / (_ - b))
                  , A = -(_ + b) / 2
                  , y = A * x;
                t[2] = t[2] * x + t[3] * y,
                t[6] = t[6] * x + t[7] * y,
                t[10] = f * x + m * y,
                t[14] = g * x + v * y
            }
            return void 0 !== a && (a[0] = e,
            a[1] = i),
            !0
        },
        computeFrustumCornersVectors: function(t, e) {
            var i = 1 / t[0]
              , n = 1 / t[5];
            return e[0] = o.fromValues(-i, n, 1),
            e[1] = o.fromValues(-i, -n, 1),
            e[2] = o.fromValues(i, -n, 1),
            e[3] = o.fromValues(i, n, 1),
            e
        },
        makeFrustumInfinite: function(t, e, i, n, r, a, s) {
            var o = 2 * r / (e - t)
              , u = 2 * r / (n - i)
              , l = (e + t) / (e - t)
              , c = (n + i) / (n - i)
              , h = -1;
            return d.setRow(s, 0, o, 0, 0, 0),
            d.setRow(s, 1, 0, u, 0, 0),
            d.setRow(s, 2, l, c, h, -1),
            d.setRow(s, 3, 0, 0, -2 * r, 0),
            s
        },
        makeFrustum: function(t, e, i, n, r, a, s) {
            return u.mat4.frustum(s, t, e, i, n, r, a)
        },
        makeRotateFromQuat: function(t, e) {
            return u.mat4.fromQuat(e, t)
        },
        setRotateFromQuat: function(t, e) {
            var i = u.quat.sqrLen(e);
            if (l(i) <= c)
                t[0] = 0,
                t[1] = 0,
                t[2] = 0,
                t[4] = 0,
                t[5] = 0,
                t[6] = 0,
                t[8] = 0,
                t[9] = 0,
                t[10] = 0;
            else {
                var n;
                n = 1 !== i ? 2 / i : 2;
                var r, a, s, o, h, d, p, f, g, m, v, _;
                m = n * e[0],
                v = n * e[1],
                _ = n * e[2],
                o = e[0] * m,
                p = e[0] * v,
                f = e[0] * _,
                h = e[1] * v,
                d = e[1] * _,
                g = e[2] * _,
                r = e[3] * m,
                a = e[3] * v,
                s = e[3] * _,
                t[0] = 1 - (h + g),
                t[4] = p - s,
                t[8] = f + a,
                t[1] = p + s,
                t[5] = 1 - (o + g),
                t[9] = d - r,
                t[2] = f - a,
                t[6] = d + r,
                t[10] = 1 - (o + h)
            }
            return t
        }
    };
    d.identity = d.create(),
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).vec3
      , r = i(1244)
      , a = i(1246)
      , s = i(1245)
      , o = function(t, e, i) {
        this._geom = t,
        this._cb = e,
        this._vertices = i
    }
      , u = o.functorDrawElements = []
      , l = o.functorDrawArrays = [];
    u[r.POINTS] = function() {
        var t = n.create();
        return function(e, i, n, r, a) {
            for (var s = e + i, o = e; o < s; ++o) {
                var u = 3 * n[o];
                t[0] = a[u],
                t[1] = a[u + 1],
                t[2] = a[u + 2],
                r.operatorPoint(t)
            }
        }
    }(),
    u[r.LINES] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a, s) {
            for (var o = i + n, u = i; u < o - 1; u += 2) {
                var l = 3 * r[u];
                t[0] = s[l],
                t[1] = s[l + 1],
                t[2] = s[l + 2],
                l = 3 * r[u + 1],
                e[0] = s[l],
                e[1] = s[l + 1],
                e[2] = s[l + 2],
                a.operatorLine(t, e)
            }
        }
    }(),
    u[r.LINE_STRIP] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a, s) {
            for (var o = i + n, u = i; u < o - 1; ++u) {
                var l = 3 * r[u];
                t[0] = s[l],
                t[1] = s[l + 1],
                t[2] = s[l + 2],
                l = 3 * r[u + 1],
                e[0] = s[l],
                e[1] = s[l + 1],
                e[2] = s[l + 2],
                a.operatorLine(t, e)
            }
        }
    }(),
    u[r.LINE_LOOP] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a, s) {
            for (var o = i + n - 1, u = i; u < o; ++u) {
                var l = 3 * r[u];
                t[0] = s[l],
                t[1] = s[l + 1],
                t[2] = s[l + 2],
                l = 3 * r[u + 1],
                e[0] = s[l],
                e[1] = s[l + 1],
                e[2] = s[l + 2],
                a.operatorLine(t, e)
            }
            o = 3 * r[o],
            t[0] = s[o],
            t[1] = s[o + 1],
            t[2] = s[o + 2];
            var c = 3 * r[0];
            e[0] = s[c],
            e[1] = s[c + 1],
            e[2] = s[c + 2],
            a.operatorLine(t, e)
        }
    }(),
    u[r.TRIANGLES] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s, o) {
            for (var u = n + r, l = n; l < u; l += 3) {
                var c = 3 * a[l];
                t[0] = o[c],
                t[1] = o[c + 1],
                t[2] = o[c + 2],
                c = 3 * a[l + 1],
                e[0] = o[c],
                e[1] = o[c + 1],
                e[2] = o[c + 2],
                c = 3 * a[l + 2],
                i[0] = o[c],
                i[1] = o[c + 1],
                i[2] = o[c + 2],
                s.operatorTriangle(t, e, i)
            }
        }
    }(),
    u[r.TRIANGLE_STRIP] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s, o) {
            for (var u = 2, l = n; u < r; ++u,
            ++l) {
                var c = 3 * a[l];
                t[0] = o[c],
                t[1] = o[c + 1],
                t[2] = o[c + 2],
                c = 3 * a[l + 1],
                e[0] = o[c],
                e[1] = o[c + 1],
                e[2] = o[c + 2],
                c = 3 * a[l + 2],
                i[0] = o[c],
                i[1] = o[c + 1],
                i[2] = o[c + 2],
                u % 2 ? s.operatorTriangle(t, i, e) : s.operatorTriangle(t, e, i)
            }
        }
    }(),
    u[r.TRIANGLE_FAN] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s, o) {
            for (var u = a[n], l = 2, c = n + 1; l < r; ++l,
            ++c) {
                t[0] = o[u],
                t[1] = o[u + 1],
                t[2] = o[u + 2];
                var h = 3 * a[c];
                e[0] = o[h],
                e[1] = o[h + 1],
                e[2] = o[h + 2],
                h = 3 * a[c + 1],
                i[0] = o[h],
                i[1] = o[h + 1],
                i[2] = o[h + 2],
                s.operatorTriangle(t, e, i)
            }
        }
    }(),
    l[r.POINTS] = function() {
        var t = n.create();
        return function(e, i, n, r) {
            for (var a = e; a < e + i; ++a) {
                var s = 3 * a;
                t[0] = r[s],
                t[1] = r[s + 1],
                t[2] = r[s + 2],
                n.operatorPoint(t)
            }
        }
    }(),
    l[r.LINES] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a) {
            for (var s = i; s < i + n - 1; s += 2) {
                var o = 3 * s;
                t[0] = a[o],
                t[1] = a[o + 1],
                t[2] = a[o + 2],
                o = 3 * (s + 1),
                e[0] = a[o],
                e[1] = a[o + 1],
                e[2] = a[o + 2],
                r.operatorLine(t, e)
            }
        }
    }(),
    l[r.LINE_STRIP] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a) {
            for (var s = i; s < i + n - 1; ++s) {
                var o = 3 * s;
                t[0] = a[o],
                t[1] = a[o + 1],
                t[2] = a[o + 2],
                o = 3 * (s + 1),
                e[0] = a[o],
                e[1] = a[o + 1],
                e[2] = a[o + 2],
                r.operatorLine(t, e)
            }
        }
    }(),
    l[r.LINE_LOOP] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a) {
            for (var s = i + n - 1, o = i; o < s; ++o) {
                var u = 3 * o;
                t[0] = a[u],
                t[1] = a[u + 1],
                t[2] = a[u + 2],
                u = 3 * (o + 1),
                e[0] = a[u],
                e[1] = a[u + 1],
                e[2] = a[u + 2],
                r.operatorLine(t, e)
            }
            s = 3 * s,
            t[0] = a[s],
            t[1] = a[s + 1],
            t[2] = a[s + 2],
            i = 3 * i,
            e[0] = a[i],
            e[1] = a[i + 1],
            e[2] = a[i + 2],
            r.operatorLine(t, e)
        }
    }(),
    l[r.TRIANGLES] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s) {
            for (var o = n; o < n + r; o += 3) {
                var u = 3 * o;
                t[0] = s[u],
                t[1] = s[u + 1],
                t[2] = s[u + 2],
                u = 3 * (o + 1),
                e[0] = s[u],
                e[1] = s[u + 1],
                e[2] = s[u + 2],
                u = 3 * (o + 2),
                i[0] = s[u],
                i[1] = s[u + 1],
                i[2] = s[u + 2],
                a.operatorTriangle(t, e, i)
            }
        }
    }(),
    l[r.TRIANGLE_STRIP] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s) {
            for (var o = 2, u = n; o < r; ++o,
            ++u) {
                var l = 3 * u;
                t[0] = s[l],
                t[1] = s[l + 1],
                t[2] = s[l + 2],
                l = 3 * (u + 1),
                e[0] = s[l],
                e[1] = s[l + 1],
                e[2] = s[l + 2],
                l = 3 * (u + 2),
                i[0] = s[l],
                i[1] = s[l + 1],
                i[2] = s[l + 2],
                o % 2 ? a.operatorTriangle(t, i, e) : a.operatorTriangle(t, e, i)
            }
        }
    }(),
    l[r.TRIANGLE_FAN] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s) {
            for (var o = 2, u = n + 1; o < r; ++o,
            ++u) {
                t[0] = s[n],
                t[1] = s[n + 1],
                t[2] = s[n + 2];
                var l = 3 * u;
                e[0] = s[l],
                e[1] = s[l + 1],
                e[2] = s[l + 2],
                l = 3 * (u + 1),
                i[0] = s[l],
                i[1] = s[l + 1],
                i[2] = s[l + 2],
                a.operatorTriangle(t, e, i)
            }
        }
    }(),
    o.prototype = {
        apply: function() {
            var t = this._geom
              , e = t.primitives;
            if (e)
                for (var i, n = this._cb(), r = this._vertices, o = e.length, c = 0; c < o; c++) {
                    var h = e[c];
                    if (h instanceof a) {
                        if (i = u[h.getMode()]) {
                            var d = h.indices.getElements();
                            i(h.getFirst() / d.BYTES_PER_ELEMENT, h.getCount(), d, n, r)
                        }
                    } else
                        h instanceof s && (i = l[h.getMode()],
                        i && i(h.getFirst(), h.getCount(), n, r))
                }
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1207)
      , a = i(1240)
      , s = i(1228)
      , o = i(1227)
      , u = i(1206)
      , l = function(t, e) {
        a.call(this),
        s.call(this),
        this._program = null,
        this._nullProgram = !0,
        this._vertex = void 0,
        this._fragment = void 0,
        this._uniformsCache = void 0,
        this._attributesCache = void 0,
        this._activeUniforms = void 0,
        this._foreignUniforms = void 0,
        this._trackAttributes = void 0,
        t && this.setVertexShader(t),
        e && this.setFragmentShader(e),
        this._dirty = !0
    }
      , c = function(t) {
        var e = {}
          , i = t.match(/attribute\s+\w+\s+\w+/g);
        if (null !== i)
            for (var n = 0, r = i.length; n < r; n++) {
                var a = i[n].match(/attribute\s+\w+\s+(\w+)/)[1];
                e[a] = !0
            }
        return e
    };
    l._sDeletedGLProgramCache = new window.Map,
    l.deleteGLProgram = function(t, e) {
        l._sDeletedGLProgramCache.has(t) || l._sDeletedGLProgramCache.set(t, []),
        l._sDeletedGLProgramCache.get(t).push(e)
    }
    ,
    l.flushDeletedGLPrograms = function(t, e) {
        if (e <= 0)
            return e;
        if (!l._sDeletedGLProgramCache.has(t))
            return e;
        for (var i = 0, n = u.instance().tick(), r = l._sDeletedGLProgramCache.get(t), a = r.length, s = a - 1; s >= 0 && i < e; s--)
            t.deleteProgram(r[s]),
            r.splice(s, 1),
            i = u.instance().deltaS(n, u.instance().tick());
        return e - i
    }
    ,
    l.flushAllDeletedGLPrograms = function(t) {
        if (l._sDeletedGLProgramCache.has(t))
            for (var e = l._sDeletedGLProgramCache.get(t), i = e.length, n = i - 1; n >= 0; n--)
                t.deleteProgram(e[n]),
                e.splice(n, 1)
    }
    ,
    l.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, n.objectInherit(s.prototype, {
        attributeType: "Program",
        cloneType: function() {
            return new l
        },
        setVertexShader: function(t) {
            this._vertex = t,
            this._nullProgram = !1
        },
        setFragmentShader: function(t) {
            this._fragment = t,
            this._nullProgram = !1
        },
        getVertexShader: function() {
            return this._vertex
        },
        getFragmentShader: function() {
            return this._fragment
        },
        getProgram: function() {
            return this._program
        },
        setActiveUniforms: function(t) {
            this._activeUniforms = t
        },
        getActiveUniforms: function() {
            return this._activeUniforms
        },
        setForeignUniforms: function(t) {
            this._foreignUniforms = t
        },
        getForeignUniforms: function() {
            return this._foreignUniforms
        },
        setUniformsCache: function(t) {
            this._uniformsCache = t
        },
        getUniformsCache: function() {
            return this._uniformsCache
        },
        setAttributesCache: function(t) {
            this._attributesCache = t
        },
        getAttributesCache: function() {
            return this._attributesCache
        },
        setTrackAttributes: function(t) {
            this._trackAttributes = t
        },
        getTrackAttributes: function() {
            return this._trackAttributes
        },
        releaseGLObjects: function() {
            void 0 !== this._vertex && this._vertex.releaseGLObjects(),
            void 0 !== this._fragment && this._fragment.releaseGLObjects(),
            null !== this._program && (void 0 !== this._gl && l.deleteGLProgram(this._gl, this._program),
            this._program = void 0)
        },
        apply: function(t) {
            if (!this._nullProgram) {
                this._gl || this.setGraphicContext(t.getGraphicContext());
                var e = this._gl;
                if (!this._program || this._dirty) {
                    var i;
                    this._vertex.shader || (i = this._vertex.compile(e)),
                    this._fragment.shader || (i = this._fragment.compile(e));
                    var a = c(this._vertex.getText());
                    if (i && (this._program = e.createProgram(),
                    a.Vertex && e.bindAttribLocation(this._program, 0, "Vertex"),
                    e.attachShader(this._program, this._vertex.shader),
                    e.attachShader(this._program, this._fragment.shader),
                    n.timeStamp("osgjs.metrics:linkShader"),
                    e.linkProgram(this._program),
                    !e.getProgramParameter(this._program, e.LINK_STATUS) && !e.isContextLost())) {
                        var s = e.getProgramInfoLog(this._program);
                        r.errorFold(s, "can't link program\nvertex shader:\n" + this._vertex.text + "\n fragment shader:\n" + this._fragment.text);
                        var u = void 0 !== e.rawgl ? e.rawgl : e;
                        void 0 !== u && void 0 !== u.getExtension && (u = u.getExtension("WEBGL_debug_shaders")),
                        u && "Failed to create D3D shaders.\n" === s && (r.error(u.getTranslatedShaderSource(this._vertex.shader)),
                        r.error(u.getTranslatedShaderSource(this._fragment.shader))),
                        i = !1
                    }
                    if (!i) {
                        if (!l.prototype._failSafeCache) {
                            var h = e.createProgram();
                            this._vertex.failSafe(e),
                            this._fragment.failSafe(e),
                            e.attachShader(h, this._vertex.shader),
                            e.attachShader(h, this._fragment.shader),
                            e.linkProgram(h),
                            e.validateProgram(h),
                            l.prototype._failSafeCache = h
                        }
                        r.warn("FailSafe shader Activated "),
                        this._program = this._failSafeCache
                    }
                    this._uniformsCache = new o,
                    this._attributesCache = new o,
                    this.cacheUniformList(e, this._vertex.text),
                    this.cacheUniformList(e, this._fragment.text),
                    this.cacheAttributeList(e, window.Object.keys(a)),
                    this._dirty = !1
                }
                t.applyProgram(this._program)
            }
        },
        cacheUniformList: function(t, e) {
            var i = e.match(/uniform\s+\w+\s+\w+((\s)?\[(.*?)\])?/g)
              , n = this._uniformsCache;
            if (null !== i)
                for (var r = 0, a = i.length; r < a; r++) {
                    var s = i[r].match(/uniform\s+\w+\s+(\w+)/)[1]
                      , o = i[r].match(/uniform\s+\w+\s+(\w+)(\s?\[.*?\])?/)[1]
                      , u = t.getUniformLocation(this._program, s);
                    void 0 !== u && null !== u && void 0 === n[o] && (n[o] = u,
                    this._uniformsCache.dirty())
                }
        },
        cacheAttributeList: function(t, e) {
            for (var i = this._attributesCache, n = 0, r = e.length; n < r; n++) {
                var a = e[n]
                  , s = t.getAttribLocation(this._program, a);
                s !== -1 && void 0 !== s && void 0 === i[a] && (i[a] = s,
                this._attributesCache.dirty())
            }
        }
    })), "osg", "Program"),
    t.exports = l
}
, function(t, e, i) {
    t.exports = i(1308)
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).vec3
      , r = i(1309)
      , a = i(1224)
      , s = a.ArrayType
      , o = Math.sqrt
      , u = Math.cos
      , l = Math.sin
      , c = {
        create: function() {
            var t = new s(4);
            return t[0] = 0,
            t[1] = 0,
            t[2] = 0,
            t[3] = 1,
            t
        },
        createAndSet: r.createAndSet,
        makeIdentity: function(t) {
            return c.init(t)
        },
        init: function(t) {
            return t[0] = 0,
            t[1] = 0,
            t[2] = 0,
            t[3] = 1,
            t
        },
        copy: r.copy,
        set: r.set,
        sub: r.sub,
        add: r.add,
        dot: r.dot,
        neg: r.neg,
        lerp: r.lerp,
        length2: function(t) {
            return t[0] * t[0] + t[1] * t[1] + t[2] * t[2] + t[3] * t[3]
        },
        zeroRotation: function(t) {
            return 0 === t[0] && 0 === t[1] && 0 === t[2] && 1 === t[3]
        },
        length: function(t) {
            return Math.sqrt(t[0] * t[0] + t[1] * t[1] + t[2] * t[2] + t[3] * t[3])
        },
        makeRotate: function(t, e, i, n, r) {
            var a = 1e-7
              , s = o(e * e + i * i + n * n);
            if (s < a)
                return this.init(r);
            var c = 1 / s
              , h = u(.5 * t)
              , d = l(.5 * t);
            return r[0] = e * d * c,
            r[1] = i * d * c,
            r[2] = n * d * c,
            r[3] = h,
            r
        },
        nlerp: function(t, e, i, n) {
            var r = this.dot(e, i)
              , a = 1 - t;
            return r < 0 ? (n[0] = e[0] * a - i[0] * t,
            n[1] = e[1] * a - i[1] * t,
            n[2] = e[2] * a - i[2] * t,
            n[3] = e[3] * a - i[3] * t) : (n[0] = e[0] * a + i[0] * t,
            n[1] = e[1] * a + i[1] * t,
            n[2] = e[2] * a + i[2] * t,
            n[3] = e[3] * a + i[3] * t),
            this.normalize(n, n)
        },
        slerp: function() {
            var t = 1e-5;
            return function(e, i, n, r) {
                var a = this.dot(i, n)
                  , s = 1;
                a < 0 && (s = -1,
                a = -a);
                var o, u;
                if (a > 1 - t)
                    o = 1 - e,
                    u = e;
                else {
                    var l = Math.sqrt(1 - a * a)
                      , c = Math.atan2(l, a)
                      , h = 1 / l;
                    o = Math.sin((1 - e) * c) * h,
                    u = Math.sin(e * c) * h
                }
                return u *= s,
                r[0] = i[0] * o + n[0] * u,
                r[1] = i[1] * o + n[1] * u,
                r[2] = i[2] * o + n[2] * u,
                r[3] = i[3] * o + n[3] * u,
                r
            }
        }(),
        transformVec3: function(t, e, i) {
            var n = e[0]
              , r = e[1]
              , a = e[2]
              , s = t[0]
              , o = t[1]
              , u = t[2]
              , l = t[3]
              , c = l * n + o * a - u * r
              , h = l * r + u * n - s * a
              , d = l * a + s * r - o * n
              , p = -s * n - o * r - u * a;
            return i[0] = c * l + p * -s + h * -u - d * -o,
            i[1] = h * l + p * -o + d * -s - c * -u,
            i[2] = d * l + p * -u + c * -o - h * -s,
            i
        },
        normalize: function(t, e) {
            var i = 1 / this.length(t);
            return e[0] = t[0] * i,
            e[1] = t[1] * i,
            e[2] = t[2] * i,
            e[3] = t[3] * i,
            e
        },
        conj: function(t, e) {
            return e[0] = -t[0],
            e[1] = -t[1],
            e[2] = -t[2],
            e[3] = t[3],
            e
        },
        inverse: function(t, e) {
            var i = 1 / this.length2(t);
            return this.conj(t, e),
            e[0] *= i,
            e[1] *= i,
            e[2] *= i,
            e[3] *= i,
            e
        },
        mult: function(t, e, i) {
            var n = t[0]
              , r = t[1]
              , a = t[2]
              , s = t[3]
              , o = e[0]
              , u = e[1]
              , l = e[2]
              , c = e[3];
            return i[0] = n * c + r * l - a * u + s * o,
            i[1] = -n * l + r * c + a * o + s * u,
            i[2] = n * u - r * o + a * c + s * l,
            i[3] = -n * o - r * u - a * l + s * c,
            i
        },
        div: function(t, e, i) {
            var n = 1 / e;
            return i[0] = t[0] * n,
            i[1] = t[1] * n,
            i[2] = t[2] * n,
            i[3] = t[3] * n,
            i
        },
        exp: function(t, e) {
            var i = Math.sqrt(t[0] * t[0] + t[1] * t[1] + t[2] * t[2])
              , n = Math.exp(t[3])
              , r = 0;
            return i > 1e-5 && (r = n * Math.sin(i) / i),
            e[0] = r * t[0],
            e[1] = r * t[1],
            e[2] = r * t[2],
            e[3] = n * Math.cos(i),
            e
        },
        ln: function(t, e) {
            var i = t[0] * t[0] + t[1] * t[1] + t[2] * t[2]
              , n = Math.sqrt(i)
              , r = 0;
            return n > 1e-5 && (r = Math.atan2(n, t[3]) / n),
            i += t[3] * t[3],
            e[0] = r * t[0],
            e[1] = r * t[1],
            e[2] = r * t[2],
            e[3] = .5 * Math.log(i),
            e
        },
        squad: function(t, e, i, n, r, a) {
            var s = this.slerp(t, e, r)
              , o = this.slerp(t, i, n);
            return this.slerp(2 * t * (1 - t), s, o, a)
        },
        computeTangent: function(t, e, i, n) {
            var r = this.inv(e)
              , a = this.create()
              , s = this.create();
            return this.mult(i, r, a),
            this.ln(a, a),
            this.mult(t, r, s),
            this.ln(s, s),
            this.add(a, s, a),
            this.div(a, -4, a),
            this.exp(a, s),
            this.mult(s, e, n)
        },
        makeRotateFromTo: function(t, e, i) {
            var r = 1 + n.dot(t, e);
            if (r < 1e-7) {
                var a, s = t[0], o = t[1], u = t[2];
                Math.abs(s) < .6 ? (a = Math.sqrt(1 - s * s),
                i[1] = u / a,
                i[2] = -o / a,
                i[0] = i[3] = 0) : Math.abs(o) < .6 ? (a = Math.sqrt(1 - o * o),
                i[0] = -u / a,
                i[2] = s / a,
                i[1] = i[3] = 0) : (a = Math.sqrt(1 - u * u),
                i[0] = o / a,
                i[1] = -s / a,
                i[2] = i[3] = 0)
            } else {
                var l = Math.sqrt(.5 * r);
                n.cross(i, t, e);
                var c = .5 / l;
                i[0] *= c,
                i[1] *= c,
                i[2] *= c,
                i[3] = l
            }
            return i
        }
    };
    c.identity = c.create(),
    t.exports = c
}
, function(t, e, i) {
    t.exports = i(1310)
}
, function(t, e, i) {
    "use strict";
    var n = i(1212)
      , r = n.vec4
      , a = {
        create: r.create,
        createAndSet: r.fromValues,
        init: function(t) {
            return r.set(t, 0, 0, 0, 0)
        },
        set: function(t, e, i, n, a) {
            return r.set(a, t, e, i, n)
        },
        dot: r.dot,
        copy: function(t, e) {
            return r.copy(e, t)
        },
        sub: function(t, e, i) {
            return r.sub(i, t, e)
        },
        mult: function(t, e, i) {
            return i[0] = t[0] * e,
            i[1] = t[1] * e,
            i[2] = t[2] * e,
            i[3] = t[3] * e,
            i
        },
        add: function(t, e, i) {
            return r.add(i, t, e)
        },
        neg: function(t, e) {
            return r.negate(e, t)
        },
        lerp: function(t, e, i, n) {
            return r.lerp(n, e, i, t)
        }
    };
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1203)
      , a = i(1206)
      , s = i(1240)
      , o = function(t, e) {
        s.call(this);
        var i = t;
        "string" == typeof t && (i = o[t]),
        this.type = i,
        this.setText(e)
    };
    o.VERTEX_SHADER = 35633,
    o.FRAGMENT_SHADER = 35632,
    o.VS_DBG = "attribute vec3 Vertex;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(void) {  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);}",
    o.FS_DBG = "precision lowp float; void main(void) { gl_FragColor = vec4(1.0, 0.6, 0.6, 1.0);}";
    var u = "\n#define SHADER_NAME FailSafe\n";
    o.VS_DBG += u,
    o.FS_DBG += u,
    o._sDeletedGLShaderCache = new window.Map,
    o.deleteGLShader = function(t, e) {
        o._sDeletedGLShaderCache.has(t) || o._sDeletedGLShaderCache.set(t, []),
        o._sDeletedGLShaderCache.get(t).push(e)
    }
    ,
    o.flushDeletedGLShaders = function(t, e) {
        if (e <= 0)
            return e;
        if (!o._sDeletedGLShaderCache.has(t))
            return e;
        for (var i = 0, n = a.instance().tick(), r = o._sDeletedGLShaderCache.get(t), s = r.length, u = s - 1; u >= 0 && i < e; u--)
            t.deleteShader(r[u]),
            r.splice(u, 1),
            i = a.instance().deltaS(n, a.instance().tick());
        return e -= i
    }
    ,
    o.flushAllDeletedGLShaders = function(t) {
        if (o._sDeletedGLShaderCache.has(t))
            for (var e = o._sDeletedGLShaderCache.get(t), i = e.length, n = i - 1; n >= 0; n--)
                t.deleteShader(e[n]),
                e.splice(n, 1)
    }
    ,
    o.prototype = r.objectInherit(s.prototype, {
        setText: function(t) {
            this.text = t
        },
        getText: function() {
            return this.text
        },
        failSafe: function(t) {
            this.shader = t.createShader(this.type),
            t.shaderSource(this.shader, this.type === o.VERTEX_SHADER ? o.VS_DBG : o.FS_DBG),
            t.compileShader(this.shader)
        },
        processErrors: function(t, e) {
            var i = /ERROR: [\d]+:([\d]+): (.+)/gim
              , r = e.split("\n")
              , a = r.length;
            if (0 !== a) {
                var s, o;
                for (null === i.exec(t) && (i = /Shader compilation errors\n\((\d+)\, \d+\): (.+)/gim),
                i.lastIndex = 0; null != (o = i.exec(t)); ) {
                    o.index === i.lastIndex && i.lastIndex++;
                    var u = parseInt(o[1]);
                    if (!(u > a)) {
                        n.error("ERROR " + o[2] + " in line " + u);
                        var l = Math.max(0, u - 7)
                          , c = Math.max(0, u - 2);
                        for (s = l; s <= c; s++)
                            n.warn(r[s].replace(/^[ \t]+/g, ""));
                        for (c = Math.max(0, u - 1),
                        n.error(r[c].replace(/^[ \t]+/g, "")),
                        l = Math.min(a, u),
                        c = Math.min(a, u + 5),
                        s = l; s < c; s++)
                            n.warn(r[s].replace(/^[ \t]+/g, ""))
                    }
                }
            }
        },
        compile: function(t) {
            this._gl || this.setGraphicContext(t),
            this.shader = t.createShader(this.type);
            var e = this.text;
            if (o.enableGLSLOptimizer && o.glslOptimizer) {
                var i = this.type === o.VERTEX_SHADER ? "vertex" : "fragment";
                n.infoFold(i + " shader before optimization", e);
                var a = o.glslOptimizer(e, "2", this.type === o.VERTEX_SHADER);
                a.indexOf("Error:") !== -1 ? n.error(a) : a.length <= 1 ? n.warnFold("glsl optimizer returned an empty shader, the original will be used", e) : (n.infoFold(i + " shader after optimization", a),
                e = a)
            }
            if (t.shaderSource(this.shader, e),
            r.timeStamp("osgjs.metrics:compileShader"),
            t.compileShader(this.shader),
            !t.getShaderParameter(this.shader, t.COMPILE_STATUS) && !t.isContextLost()) {
                var s = t.getShaderInfoLog(this.shader);
                this.processErrors(s, e);
                for (var u = "\n" + e, l = u.split("\n"), c = "\n", h = 0, d = l.length; h < d; ++h)
                    c += h + " " + l[h] + "\n";
                return n.debugFold("can't compile shader", c),
                !1
            }
            return !0
        },
        releaseGLObjects: function() {
            void 0 !== this._gl && o.deleteGLShader(this._gl, this.shader),
            this.shader = void 0
        }
    }),
    o.create = function(t, e) {
        return n.log("Shader.create is deprecated, use new Shader with the same arguments instead"),
        new o(t,e)
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1212).vec3
      , a = i(1243)
      , s = i(1234)
      , o = i(1244)
      , u = i(1245)
      , l = i(1246)
      , c = i(1306)
      , h = i(1311)
      , d = i(1203)
      , p = function(t, e, i, n, r, u) {
        var c, h, p, f = void 0 !== t ? t : 0, g = void 0 !== e ? e : 0, m = void 0 !== i ? i : 0, v = void 0 !== n ? n : 1, _ = void 0 !== r ? r : 1, b = void 0 !== u ? u : 1, x = new s;
        c = v / 2,
        h = _ / 2,
        p = b / 2;
        var A = new d.Float32Array(72)
          , y = new d.Float32Array(48)
          , S = new d.Float32Array(72);
        A[0] = f - c,
        A[1] = g - h,
        A[2] = m + p,
        S[0] = 0,
        S[1] = -1,
        S[2] = 0,
        y[0] = 0,
        y[1] = 1,
        A[3] = f - c,
        A[4] = g - h,
        A[5] = m - p,
        S[3] = 0,
        S[4] = -1,
        S[5] = 0,
        y[2] = 0,
        y[3] = 0,
        A[6] = f + c,
        A[7] = g - h,
        A[8] = m - p,
        S[6] = 0,
        S[7] = -1,
        S[8] = 0,
        y[4] = 1,
        y[5] = 0,
        A[9] = f + c,
        A[10] = g - h,
        A[11] = m + p,
        S[9] = 0,
        S[10] = -1,
        S[11] = 0,
        y[6] = 1,
        y[7] = 1,
        A[12] = f + c,
        A[13] = g + h,
        A[14] = m + p,
        S[12] = 0,
        S[13] = 1,
        S[14] = 0,
        y[8] = 0,
        y[9] = 1,
        A[15] = f + c,
        A[16] = g + h,
        A[17] = m - p,
        S[15] = 0,
        S[16] = 1,
        S[17] = 0,
        y[10] = 0,
        y[11] = 0,
        A[18] = f - c,
        A[19] = g + h,
        A[20] = m - p,
        S[18] = 0,
        S[19] = 1,
        S[20] = 0,
        y[12] = 1,
        y[13] = 0,
        A[21] = f - c,
        A[22] = g + h,
        A[23] = m + p,
        S[21] = 0,
        S[22] = 1,
        S[23] = 0,
        y[14] = 1,
        y[15] = 1,
        A[24] = f + c,
        A[25] = g - h,
        A[26] = m + p,
        S[24] = 1,
        S[25] = 0,
        S[26] = 0,
        y[16] = 0,
        y[17] = 1,
        A[27] = f + c,
        A[28] = g - h,
        A[29] = m - p,
        S[27] = 1,
        S[28] = 0,
        S[29] = 0,
        y[18] = 0,
        y[19] = 0,
        A[30] = f + c,
        A[31] = g + h,
        A[32] = m - p,
        S[30] = 1,
        S[31] = 0,
        S[32] = 0,
        y[20] = 1,
        y[21] = 0,
        A[33] = f + c,
        A[34] = g + h,
        A[35] = m + p,
        S[33] = 1,
        S[34] = 0,
        S[35] = 0,
        y[22] = 1,
        y[23] = 1,
        A[36] = f - c,
        A[37] = g + h,
        A[38] = m + p,
        S[36] = -1,
        S[37] = 0,
        S[38] = 0,
        y[24] = 0,
        y[25] = 1,
        A[39] = f - c,
        A[40] = g + h,
        A[41] = m - p,
        S[39] = -1,
        S[40] = 0,
        S[41] = 0,
        y[26] = 0,
        y[27] = 0,
        A[42] = f - c,
        A[43] = g - h,
        A[44] = m - p,
        S[42] = -1,
        S[43] = 0,
        S[44] = 0,
        y[28] = 1,
        y[29] = 0,
        A[45] = f - c,
        A[46] = g - h,
        A[47] = m + p,
        S[45] = -1,
        S[46] = 0,
        S[47] = 0,
        y[30] = 1,
        y[31] = 1,
        A[48] = f - c,
        A[49] = g + h,
        A[50] = m + p,
        S[48] = 0,
        S[49] = 0,
        S[50] = 1,
        y[32] = 0,
        y[33] = 1,
        A[51] = f - c,
        A[52] = g - h,
        A[53] = m + p,
        S[51] = 0,
        S[52] = 0,
        S[53] = 1,
        y[34] = 0,
        y[35] = 0,
        A[54] = f + c,
        A[55] = g - h,
        A[56] = m + p,
        S[54] = 0,
        S[55] = 0,
        S[56] = 1,
        y[36] = 1,
        y[37] = 0,
        A[57] = f + c,
        A[58] = g + h,
        A[59] = m + p,
        S[57] = 0,
        S[58] = 0,
        S[59] = 1,
        y[38] = 1,
        y[39] = 1,
        A[60] = f + c,
        A[61] = g + h,
        A[62] = m - p,
        S[60] = 0,
        S[61] = 0,
        S[62] = -1,
        y[40] = 0,
        y[41] = 1,
        A[63] = f + c,
        A[64] = g - h,
        A[65] = m - p,
        S[63] = 0,
        S[64] = 0,
        S[65] = -1,
        y[42] = 0,
        y[43] = 0,
        A[66] = f - c,
        A[67] = g - h,
        A[68] = m - p,
        S[66] = 0,
        S[67] = 0,
        S[68] = -1,
        y[44] = 1,
        y[45] = 0,
        A[69] = f - c,
        A[70] = g + h,
        A[71] = m - p,
        S[69] = 0,
        S[70] = 0,
        S[71] = -1,
        y[46] = 1,
        y[47] = 1;
        var C = new d.Uint16Array(36);
        C[0] = 0,
        C[1] = 1,
        C[2] = 2,
        C[3] = 0,
        C[4] = 2,
        C[5] = 3,
        C[6] = 4,
        C[7] = 5,
        C[8] = 6,
        C[9] = 4,
        C[10] = 6,
        C[11] = 7,
        C[12] = 8,
        C[13] = 9,
        C[14] = 10,
        C[15] = 8,
        C[16] = 10,
        C[17] = 11,
        C[18] = 12,
        C[19] = 13,
        C[20] = 14,
        C[21] = 12,
        C[22] = 14,
        C[23] = 15,
        C[24] = 16,
        C[25] = 17,
        C[26] = 18,
        C[27] = 16,
        C[28] = 18,
        C[29] = 19,
        C[30] = 20,
        C[31] = 21,
        C[32] = 22,
        C[33] = 20,
        C[34] = 22,
        C[35] = 23,
        x.getAttributes().Vertex = new a(a.ARRAY_BUFFER,A,3),
        x.getAttributes().Normal = new a(a.ARRAY_BUFFER,S,3),
        x.getAttributes().TexCoord0 = new a(a.ARRAY_BUFFER,y,2);
        var M = new l(o.TRIANGLES,new a(a.ELEMENT_ARRAY_BUFFER,C,1));
        return x.getPrimitives().push(M),
        x
    }
      , f = function() {
        var t = new s
          , e = new d.Float32Array([-1, -1, -1, 4, 4, -1])
          , i = new d.Float32Array([-1, -1, -1, 4, 4, -1])
          , n = new d.Uint16Array(3);
        n[0] = 2,
        n[1] = 1,
        n[2] = 0,
        t.getAttributes().Vertex = new a(a.ARRAY_BUFFER,i,2),
        t.getAttributes().TexCoord0 = new a(a.ARRAY_BUFFER,e,2);
        var r = new l(o.TRIANGLES,new a(a.ELEMENT_ARRAY_BUFFER,n,1));
        return t.getPrimitives().push(r),
        function() {
            return t
        }
    }()
      , g = function(t, e, i, n, u, c, h, p, f, g, m, v, _) {
        void 0 === v && void 0 === _ && (v = g,
        _ = m,
        g = 0,
        m = 0);
        var b = new s
          , x = new d.Float32Array(12);
        x[0] = t + h,
        x[1] = e + p,
        x[2] = i + f,
        x[3] = t,
        x[4] = e,
        x[5] = i,
        x[6] = t + n,
        x[7] = e + u,
        x[8] = i + c,
        x[9] = t + n + h,
        x[10] = e + u + p,
        x[11] = i + c + f,
        void 0 === v && (v = 1),
        void 0 === _ && (_ = 1);
        var A = new d.Float32Array(8);
        A[0] = g,
        A[1] = _,
        A[2] = g,
        A[3] = m,
        A[4] = v,
        A[5] = m,
        A[6] = v,
        A[7] = _;
        var y = r.fromValues(n, u, c);
        r.cross(y, y, r.fromValues(h, p, f)),
        r.normalize(y, y);
        var S = new d.Float32Array(12);
        S[0] = y[0],
        S[1] = y[1],
        S[2] = y[2],
        S[3] = y[0],
        S[4] = y[1],
        S[5] = y[2],
        S[6] = y[0],
        S[7] = y[1],
        S[8] = y[2],
        S[9] = y[0],
        S[10] = y[1],
        S[11] = y[2];
        var C = new d.Uint16Array(6);
        C[0] = 0,
        C[1] = 1,
        C[2] = 2,
        C[3] = 0,
        C[4] = 2,
        C[5] = 3,
        b.getAttributes().Vertex = new a(a.ARRAY_BUFFER,x,3),
        b.getAttributes().Normal = new a(a.ARRAY_BUFFER,S,3),
        b.getAttributes().TexCoord0 = new a(a.ARRAY_BUFFER,A,2);
        var M = new l(o.TRIANGLES,new a(a.ELEMENT_ARRAY_BUFFER,C,1));
        return b.getPrimitives().push(M),
        b
    }
      , m = function(t, e, i, r, a, s) {
        return n.log("createTexturedBox is deprecated use instead createTexturedBoxGeometry"),
        p(t, e, i, r, a, s)
    }
      , v = function(t, e, i, r, a, s, o, u, l, c, h, d, p) {
        return n.log("createTexturedQuad is deprecated use instead createTexturedQuadGeometry"),
        g(t, e, i, r, a, s, o, u, l, c, h, d, p)
    }
      , _ = function(t) {
        void 0 === t && (t = 5),
        void 0 === _.getShader && (_.getShader = function() {
            if (void 0 === _.getShader.program) {
                var t = ["#ifdef GL_ES", "precision highp float;", "#endif", "attribute vec3 Vertex;", "attribute vec4 Color;", "uniform mat4 uModelViewMatrix;", "uniform mat4 uProjectionMatrix;", "", "varying vec4 vColor;", "", "void main(void) {", "  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0));", "  vColor = Color;", "}"].join("\n")
                  , e = ["#ifdef GL_ES", "precision highp float;", "#endif", "varying vec4 vColor;", "void main(void) {", "gl_FragColor = vColor;", "}"].join("\n")
                  , i = new c(new h("VERTEX_SHADER",t),new h("FRAGMENT_SHADER",e));
                _.getShader.program = i
            }
            return _.getShader.program
        }
        );
        var e = new s
          , i = new d.Float32Array(18);
        i[3] = t,
        i[10] = t,
        i[17] = t;
        var n = new d.Float32Array(24);
        n[0] = n[3] = 1,
        n[4] = n[7] = 1,
        n[9] = n[11] = 1,
        n[13] = n[15] = 1,
        n[18] = n[19] = 1,
        n[22] = n[23] = 1,
        e.getAttributes().Vertex = new a(a.ARRAY_BUFFER,i,3),
        e.getAttributes().Color = new a(a.ARRAY_BUFFER,n,4);
        var r = new u(o.LINES,0,6);
        return e.getPrimitives().push(r),
        e.getOrCreateStateSet().setAttributeAndModes(_.getShader()),
        e
    }
      , b = function(t, e, i, n, c, h, p) {
        t = t || 50,
        n = void 0 !== n ? n : 0,
        c = void 0 !== c ? c : 2 * Math.PI,
        h = void 0 !== h ? h : 0,
        p = void 0 !== p ? p : Math.PI;
        for (var f = Math.max(3, Math.floor(e) || 8), g = Math.max(2, Math.floor(i) || 6), m = f * g / 3 >= 65536, v = m ? f * g * 6 : f * g * 4, _ = new d.Float32Array(3 * v), b = new d.Float32Array(3 * v), x = new d.Float32Array(2 * v), A = m ? void 0 : new d.Uint16Array(f * g * 6), y = 0, S = 0, C = new d.Float32Array(3), M = new d.Float32Array(3), w = new d.Float32Array(3), T = new d.Float32Array(3), E = new d.Float32Array(3), I = new d.Float32Array(3), k = new d.Float32Array(3), F = new d.Float32Array(3), D = new d.Float32Array(2), N = new d.Float32Array(2), R = new d.Float32Array(2), P = new d.Float32Array(2), L = function(e, i, a, s, o) {
            a[0] = -t * Math.cos(n + e * c) * Math.sin(h + i * p),
            a[1] = t * Math.cos(h + i * p),
            a[2] = t * Math.sin(n + e * c) * Math.sin(h + i * p),
            r.normalize(s, a),
            o[0] = e,
            o[1] = 1 - i
        }, O = 0; O < g; O++)
            for (var V = 0; V < f; V++) {
                L((V + 1) / f, O / g, C, E, D),
                L(V / f, O / g, M, I, N),
                L(V / f, (O + 1) / g, w, k, R),
                L((V + 1) / f, (O + 1) / g, T, F, P);
                var B = 3 * y;
                _[B] = C[0],
                _[B + 1] = C[1],
                _[B + 2] = C[2],
                _[B + 3] = M[0],
                _[B + 4] = M[1],
                _[B + 5] = M[2],
                _[B + 6] = w[0],
                _[B + 7] = w[1],
                _[B + 8] = w[2],
                b[B] = E[0],
                b[B + 1] = E[1],
                b[B + 2] = E[2],
                b[B + 3] = I[0],
                b[B + 4] = I[1],
                b[B + 5] = I[2],
                b[B + 6] = k[0],
                b[B + 7] = k[1],
                b[B + 8] = k[2];
                var U = 2 * y;
                if (x[U] = D[0],
                x[U + 1] = D[1],
                x[U + 2] = N[0],
                x[U + 3] = N[1],
                x[U + 4] = R[0],
                x[U + 5] = R[1],
                y += 3,
                m)
                    B = 3 * y,
                    _[B] = C[0],
                    _[B + 1] = C[1],
                    _[B + 2] = C[2],
                    _[B + 3] = w[0],
                    _[B + 4] = w[1],
                    _[B + 5] = w[2],
                    _[B + 6] = T[0],
                    _[B + 7] = T[1],
                    _[B + 8] = T[2],
                    b[B] = E[0],
                    b[B + 1] = E[1],
                    b[B + 2] = E[2],
                    b[B + 3] = k[0],
                    b[B + 4] = k[1],
                    b[B + 5] = k[2],
                    b[B + 6] = F[0],
                    b[B + 7] = F[1],
                    b[B + 8] = F[2],
                    U = 2 * y,
                    x[U] = D[0],
                    x[U + 1] = D[1],
                    x[U + 2] = R[0],
                    x[U + 3] = R[1],
                    x[U + 4] = P[0],
                    x[U + 5] = P[1],
                    y += 3;
                else {
                    B = 3 * y,
                    _[B] = T[0],
                    _[B + 1] = T[1],
                    _[B + 2] = T[2],
                    b[B] = F[0],
                    b[B + 1] = F[1],
                    b[B + 2] = F[2],
                    U = 2 * y,
                    x[U] = P[0],
                    x[U + 1] = P[1];
                    var G = 3 * S
                      , z = y - 3;
                    A[G] = z,
                    A[G + 1] = z + 1,
                    A[G + 2] = z + 2,
                    A[G + 3] = z,
                    A[G + 4] = z + 2,
                    A[G + 5] = z + 3,
                    S += 2,
                    y += 1
                }
            }
        var H = new s;
        return H.getAttributes().Vertex = new a("ARRAY_BUFFER",_,3),
        H.getAttributes().Normal = new a("ARRAY_BUFFER",b,3),
        H.getAttributes().TexCoord0 = new a("ARRAY_BUFFER",x,2),
        m ? H.getPrimitives().push(new u(o.TRIANGLES,0,_.length / 3)) : H.getPrimitives().push(new l(o.TRIANGLES,new a("ELEMENT_ARRAY_BUFFER",A,1))),
        H
    }
      , x = function(t, e, i, n, r, l, c, h, d, p, f) {
        t = void 0 !== t ? t : -.5,
        e = void 0 !== e ? e : -.5,
        i = void 0 !== i ? i : 0,
        n = void 0 !== n ? n : 1,
        r = void 0 !== r ? r : 0,
        l = void 0 !== l ? l : 0,
        c = void 0 !== c ? c : 0,
        h = void 0 !== h ? h : 1,
        d = void 0 !== d ? d : 0,
        p = void 0 !== p ? p : 5,
        f = void 0 !== f ? f : p,
        p += 2,
        f += 2;
        var g = new s
          , m = new Float32Array(2 * (p + f) * 3)
          , v = 0
          , _ = 0
          , b = n / (p - 1)
          , x = r / (p - 1)
          , A = l / (p - 1)
          , y = t + n + c
          , S = e + r + h
          , C = i + l + d;
        for (v = 0; v < p; ++v)
            _ = 6 * v,
            m[_] = t + b * v,
            m[_ + 1] = e + x * v,
            m[_ + 2] = i + A * v,
            m[_ + 3] = y - b * (p - v - 1),
            m[_ + 4] = S - x * (p - v - 1),
            m[_ + 5] = C - A * (p - v - 1);
        for (b = c / (f - 1),
        x = h / (f - 1),
        A = d / (f - 1),
        v = 0; v < f; ++v)
            _ = 6 * (p + v),
            m[_] = t + b * v,
            m[_ + 1] = e + x * v,
            m[_ + 2] = i + A * v,
            m[_ + 3] = y - b * (f - v - 1),
            m[_ + 4] = S - x * (f - v - 1),
            m[_ + 5] = C - A * (f - v - 1);
        g.getAttributes().Vertex = new a(a.ARRAY_BUFFER,m,3);
        var M = new u(o.LINES,0,2 * (p + f));
        return g.getPrimitives().push(M),
        g
    }
      , A = function(t) {
        var e = new s
          , i = new Float32Array([-.5, -.5, -.5, .5, -.5, -.5, .5, .5, -.5, -.5, .5, -.5, -.5, -.5, .5, .5, -.5, .5, .5, .5, .5, -.5, .5, .5]);
        e.getAttributes().Vertex = new a(a.ARRAY_BUFFER,i,3),
        t || (t = [1, 0, 0, 1]);
        for (var n = new d.Float32Array(32), r = 0; r < 8; r++)
            for (var u = 0; u < 4; u++)
                n[3 * r + u] = t[u];
        e.getAttributes().Color = new a(a.ARRAY_BUFFER,n,4);
        var c = new d.Uint16Array([0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7]);
        return e.getPrimitives().push(new l(o.LINES,new a("ELEMENT_ARRAY_BUFFER",c,1))),
        e
    };
    t.exports = {
        createTexturedBoxGeometry: p,
        createTexturedQuadGeometry: g,
        createTexturedSphereGeometry: b,
        createTexturedBox: m,
        createTexturedFullScreenFakeQuadGeometry: f,
        createTexturedQuad: v,
        createAxisGeometry: _,
        createTexturedSphere: b,
        createGridGeometry: x,
        createBoundingBoxGeometry: A
    }
}
, function(t, e) {
    "use strict";
    var i = function() {
        this.globalDefault = void 0,
        this.lastApplied = void 0,
        this.asChanged = !1,
        this._values = [],
        this._back = void 0
    };
    i.prototype = {
        empty: function() {
            return 0 === this._values.length
        },
        values: function() {
            return this._values
        },
        back: function() {
            return this._back
        },
        push: function(t) {
            this._values.push(t),
            this._back = t
        },
        pop: function() {
            var t = this._values.pop();
            return this._back = this._values[this._values.length - 1],
            t
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1227)
      , r = i(1212).mat4
      , a = i(1207)
      , s = i(1210)
      , o = i(1306)
      , u = i(1228)
      , l = i(1313)
      , c = i(1238)
      , h = i(1203)
      , d = i(1235)
      , p = [void 0, function(t, e) {
        return t[0] === e[0] || (e[0] = t[0],
        !1)
    }
    , function(t, e) {
        return t[0] === e[0] && t[1] === e[1] || (e[0] = t[0],
        e[1] = t[1],
        !1)
    }
    , function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] || (e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        !1)
    }
    , function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3] || (e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        !1)
    }
    ]
      , f = function(t) {
        s.call(this),
        this._graphicContext = void 0,
        this._shaderGeneratorProxy = t,
        void 0 === t && console["break"](),
        this._currentVAO = null,
        this._currentIndexVBO = null,
        this.vertexAttribList = [],
        this.stateSets = new l,
        this._shaderGeneratorNames = new l,
        this.uniforms = new n,
        this.textureAttributeMapList = [],
        this.attributeMap = new n,
        this.modelMatrix = c.createMatrix4(r.create(), "uModelMatrix"),
        this.viewMatrix = c.createMatrix4(r.create(), "uViewMatrix"),
        this.modelViewMatrix = c.createMatrix4(r.create(), "uModelViewMatrix"),
        this.projectionMatrix = c.createMatrix4(r.create(), "uProjectionMatrix"),
        this.modelViewNormalMatrix = c.createMatrix4(r.create(), "uModelViewNormalMatrix");
        var e = new l;
        e.globalDefault = c.createFloat1(0, "uArrayColorEnabled"),
        this.uniforms.setMap({
            ArrayColorEnabled: e
        }),
        this._previousColorAttribPair = {},
        this.vertexAttribMap = {},
        this.vertexAttribMap._disable = [],
        this.vertexAttribMap._keys = [],
        this._frameStamp = void 0,
        this._programCommonUniformsCache = {},
        this._modelViewMatrix = void 0,
        this._projectionMatrix = void 0,
        this._program = void 0,
        this.applyAttribute(new o),
        this._numPushStateSet = 0,
        this._numApply = 0,
        this._programUniformCache = [],
        this._cacheUniformId = 0
    };
    f.prototype = h.objectLibraryClass(h.objectInherit(s.prototype, {
        getCacheUniformsApplyRenderLeaf: function() {
            return this._programCommonUniformsCache
        },
        setGraphicContext: function(t) {
            this._graphicContext = t,
            this._extVAO = d.instance(t).getWebGLExtension("OES_vertex_array_object")
        },
        getGraphicContext: function() {
            return this._graphicContext
        },
        getShaderGeneratorProxy: function() {
            return this._shaderGeneratorProxy
        },
        pushCheckOverride: function(t, e, i) {
            0 === t.values().length ? t.push(this.getObjectPair(e, i)) : t.back().value & u.OVERRIDE && !(i & u.PROTECTED) ? t.push(t.back()) : t.push(this.getObjectPair(e, i))
        },
        pushStateSet: function(t) {
            if (this._numPushStateSet++,
            this.stateSets.push(t),
            t.attributeMap && this.pushAttributeMap(this.attributeMap, t.attributeMap),
            t.textureAttributeMapList)
                for (var e = t.textureAttributeMapList, i = 0, n = e.length; i < n; i++)
                    if (e[i]) {
                        var r = this.getOrCreateTextureAttributeMap(i);
                        this.pushAttributeMap(r, e[i])
                    }
            t.uniforms && this.pushUniformsList(this.uniforms, t.uniforms);
            var a = t.getShaderGeneratorPair();
            a && this.pushCheckOverride(this._shaderGeneratorNames, a.getShaderGeneratorName(), a.getValue())
        },
        getStateSetStackSize: function() {
            return this.stateSets.values().length
        },
        insertStateSet: function() {
            var t = [];
            return function(e, i) {
                t.length = 0;
                for (var n = this.getStateSetStackSize(); n > e; )
                    t.push(this.stateSets.back()),
                    this.popStateSet(),
                    n--;
                this.pushStateSet(i);
                for (var r = t.length - 1; r >= 0; r--)
                    this.pushStateSet(t[r])
            }
        }(),
        removeStateSet: function() {
            var t = [];
            return function(e) {
                var i = this.getStateSetStackSize();
                if (e >= i)
                    return void a.warn("Warning State:removeStateSet " + e + " out of range");
                for (t.length = 0; i - 1 > e; )
                    t.push(this.stateSets.back()),
                    this.popStateSet(),
                    i--;
                this.popStateSet();
                for (var n = t.length - 1; n >= 0; n--)
                    this.pushStateSet(t[n])
            }
        }(),
        resetCacheFrame: function() {
            this._modelViewMatrix = this._projectionMatrix = void 0
        },
        resetStats: function() {
            this._numApply = 0,
            this._numPushStateSet = 0
        },
        applyProgram: function(t) {
            this._program !== t && (this._program = t,
            this.getGraphicContext().useProgram(t))
        },
        applyModelViewMatrix: function() {
            var t = r.create();
            return function(e) {
                if (this._modelViewMatrix === e)
                    return !1;
                var i = this.getLastProgramApplied()
                  , n = i.getUniformsCache()
                  , a = this.modelViewMatrix
                  , s = n.uModelViewMatrix
                  , o = this.getGraphicContext();
                s && (a.setMatrix4(e),
                a.apply(o, s));
                var u;
                if (this._modelViewMatrix) {
                    for (var l = this._modelViewMatrix, c = 0; c < 11; c++)
                        if (e[c] !== l[c]) {
                            u = !0;
                            break
                        }
                } else
                    u = !0;
                return u && (a = this.modelViewNormalMatrix,
                s = n.uModelViewNormalMatrix,
                s && (t[0] = e[0],
                t[1] = e[1],
                t[2] = e[2],
                t[4] = e[4],
                t[5] = e[5],
                t[6] = e[6],
                t[8] = e[8],
                t[9] = e[9],
                t[10] = e[10],
                r.invert(t, t),
                r.transpose(t, t),
                a.setMatrix4(t),
                a.apply(o, s))),
                this._modelViewMatrix = e,
                !0
            }
        }(),
        applyModelViewMatrixEperiment: function() {
            var t = r.create()
              , e = function(t, e) {
                return t[0] !== e[0] || (t[1] !== e[1] || (t[2] !== e[2] || (t[4] !== e[4] || (t[5] !== e[5] || (t[6] !== e[6] || (t[8] !== e[8] || (t[9] !== e[9] || t[10] !== e[10])))))))
            }
              , i = 1e-6
              , n = 1 + i
              , a = 1 - i;
            return function(i) {
                if (this._modelViewMatrix === i)
                    return !1;
                var s = this.getLastProgramApplied()
                  , o = this.modelViewMatrix
                  , u = s.getUniformsCache().uModelViewMatrix;
                u && (o.setMatrix4(i),
                o.apply(this.getGraphicContext(), u));
                var l = !0;
                if (this._modelViewMatrix && (l = e(i, this._modelViewMatrix)),
                l && (o = this.modelViewNormalMatrix,
                u = s.getUniformsCache().uModelViewNormalMatrix)) {
                    t[0] = i[0],
                    t[1] = i[1],
                    t[2] = i[2],
                    t[4] = i[4],
                    t[5] = i[5],
                    t[6] = i[6],
                    t[8] = i[8],
                    t[9] = i[9],
                    t[10] = i[10];
                    var c = t[0] * t[0] + t[4] * t[4] + t[8] * t[8]
                      , h = t[1] * t[1] + t[5] * t[5] + t[9] * t[9]
                      , d = t[2] * t[2] + t[6] * t[6] + t[10] * t[10];
                    (c > n || c < a || h > n || h < a || d > n || d < a) && (r.invert(t, t),
                    r.transpose(t, t)),
                    o.setMatrix4(t),
                    o.apply(this.getGraphicContext(), u)
                }
                return this._modelViewMatrix = i,
                !0
            }
        }(),
        applyProjectionMatrix: function(t) {
            if (this._projectionMatrix !== t) {
                this._projectionMatrix = t;
                var e = this.getLastProgramApplied()
                  , i = this.projectionMatrix
                  , n = e.getUniformsCache()[i.getName()];
                n && (i.setMatrix4(t),
                i.apply(this.getGraphicContext(), n))
            }
        },
        applyStateSet: function(t) {
            this.pushStateSet(t),
            this.apply(),
            this.popStateSet()
        },
        popAllStateSets: function() {
            for (; this.stateSets.values().length; )
                this.popStateSet()
        },
        popStateSet: function() {
            if (!this.stateSets.empty()) {
                var t = this.stateSets.pop();
                if (t.attributeMap && this.popAttributeMap(this.attributeMap, t.attributeMap),
                t.textureAttributeMapList)
                    for (var e = t.textureAttributeMapList, i = 0, n = e.length; i < n; i++)
                        e[i] && this.popAttributeMap(this.textureAttributeMapList[i], e[i]);
                t.uniforms && this.popUniformsList(this.uniforms, t.uniforms),
                t.getShaderGeneratorPair() && this._shaderGeneratorNames.pop()
            }
        },
        _createAttributeStack: function(t, e, i) {
            var n = new l;
            return t[e] = n,
            t[e].globalDefault = i,
            t.dirty(),
            n
        },
        haveAppliedAttribute: function(t) {
            var e = t.getTypeMember()
              , i = this.attributeMap[e];
            i || (i = this._createAttributeStack(this.attributeMap, e, t.cloneType())),
            i.lastApplied = t,
            i.asChanged = !0
        },
        applyAttribute: function(t) {
            var e = t.getTypeMember()
              , i = this.attributeMap
              , n = i[e];
            n || (n = this._createAttributeStack(this.attributeMap, e, t.cloneType())),
            n.lastApplied !== t && (t.apply && t.apply(this),
            n.lastApplied = t,
            n.asChanged = !0)
        },
        applyTextureAttribute: function(t, e) {
            var i = this.getGraphicContext();
            i.activeTexture(i.TEXTURE0 + t);
            var r = e.getTypeMember();
            this.textureAttributeMapList[t] || (this.textureAttributeMapList[t] = new n);
            var a = this.getOrCreateTextureAttributeMap(t)
              , s = a[r];
            s || (s = this._createAttributeStack(a, r, e.cloneType())),
            s.lastApplied !== e && (e.apply && e.apply(this, t),
            s.lastApplied = e,
            s.asChanged = !0)
        },
        getLastProgramApplied: function() {
            return this.attributeMap.Program.lastApplied
        },
        applyDefault: function() {
            this.popAllStateSets(),
            this.applyAttributeMap(this.attributeMap),
            this.applyTextureAttributeMapList(this.textureAttributeMapList)
        },
        apply: function() {
            var t = this.getLastProgramApplied();
            this.applyAttributeMap(this.attributeMap),
            this.applyTextureAttributeMapList(this.textureAttributeMapList);
            var e = this._generateAndApplyProgram();
            e ? this._applyGeneratedProgramUniforms(this.attributeMap.Program.lastApplied) : this._applyCustomProgramUniforms(this.attributeMap.Program.lastApplied),
            t !== this.getLastProgramApplied() && (this._modelViewMatrix = void 0,
            this._projectionMatrix = void 0)
        },
        applyAttributeMap: function(t) {
            for (var e, i = t.getKeys(), n = 0, r = i.length; n < r; n++) {
                var a = i[n];
                if (e = t[a],
                e && e.asChanged) {
                    var s;
                    s = 0 === e.values().length ? e.globalDefault : e.back().object,
                    e.lastApplied !== s && (s.apply && s.apply(this),
                    e.lastApplied = s),
                    e.asChanged = !1
                }
            }
        },
        getObjectPair: function(t, e) {
            return {
                object: t,
                value: e
            }
        },
        pushUniformsList: function(t, e) {
            for (var i, n, r = e.getKeys(), a = 0, s = r.length; a < s; a++) {
                var o = r[a]
                  , u = e[o];
                n = u.getUniform(),
                i = n.getName(),
                t[i] || this._createAttributeStack(t, i, n),
                this.pushCheckOverride(t[i], n, u.getValue())
            }
        },
        popUniformsList: function(t, e) {
            for (var i = e.getKeys(), n = 0, r = i.length; n < r; n++) {
                var a = i[n];
                t[a].pop()
            }
        },
        _applyTextureAttributeStack: function(t, e, i) {
            var n;
            n = 0 === i.values().length ? i.globalDefault : i.back().object,
            i.lastApplied !== n && (t.activeTexture(t.TEXTURE0 + e),
            n.apply(this, e),
            i.lastApplied = n),
            i.asChanged = !1
        },
        applyTextureAttributeMapList: function(t) {
            for (var e, i = this._graphicContext, n = 0, r = t.length; n < r; n++)
                if (e = t[n])
                    for (var a = e.getKeys(), s = 0, o = a.length; s < o; s++) {
                        var u = a[s]
                          , l = e[u];
                        l && l.asChanged && this._applyTextureAttributeStack(i, n, l)
                    }
        },
        setGlobalDefaultValue: function(t) {
            a.log("setGlobalDefaultValue is deprecated, use instead setGlobalDefaultAttribute"),
            this.setGlobalDefaultAttribute(t)
        },
        setGlobalDefaultAttribute: function(t) {
            var e = t.getTypeMember()
              , i = this.attributeMap;
            void 0 === i[e] ? this._createAttributeStack(i, e, t) : i[e].globalDefault = t
        },
        getGlobalDefaultAttribute: function(t) {
            var e = this.attributeMap;
            if (void 0 !== e[t])
                return e[t].globalDefault
        },
        setGlobalDefaultTextureAttribute: function(t, e) {
            var i = this.getOrCreateTextureAttributeMap(t)
              , n = e.getTypeMember();
            void 0 === i[n] ? this._createAttributeStack(i, n, e) : i[n].globalDefault = e
        },
        getGlobalDefaultTextureAttribute: function(t, e) {
            var i = this.getOrCreateTextureAttributeMap(t)
              , n = i[e];
            return n.globalDefault
        },
        getOrCreateTextureAttributeMap: function(t) {
            return this.textureAttributeMapList[t] || (this.textureAttributeMapList[t] = new n),
            this.textureAttributeMapList[t]
        },
        pushAttributeMap: function(t, e) {
            for (var i, n = e.getKeys(), r = 0, a = n.length; r < a; r++) {
                var s = n[r]
                  , o = e[s]
                  , u = o.getAttribute();
                void 0 === t[s] && this._createAttributeStack(t, s, u.cloneType()),
                i = t[s],
                this.pushCheckOverride(i, u, o.getValue()),
                i.asChanged = !0
            }
        },
        popAttributeMap: function(t, e) {
            for (var i, n = e.getKeys(), r = 0, a = n.length; r < a; r++) {
                var s = n[r];
                i = t[s],
                i.pop(),
                i.asChanged = !0
            }
        },
        setIndexArray: function(t) {
            var e = this._graphicContext;
            this._currentIndexVBO !== t && (t.bind(e),
            this._currentIndexVBO = t),
            t.isDirty() && t.compile(e)
        },
        lazyDisablingOfVertexAttributes: function() {
            for (var t = this.vertexAttribMap._keys, e = 0, i = t.length; e < i; e++) {
                var n = t[e];
                this.vertexAttribMap[n] && (this.vertexAttribMap._disable[n] = !0)
            }
        },
        enableVertexColor: function() {
            var t = this.attributeMap.Program.lastApplied;
            if (t.getUniformsCache().uArrayColorEnabled && t.getAttributesCache().Color) {
                var e = this.uniforms.ArrayColorEnabled.globalDefault
                  , i = this._previousColorAttribPair[t.getInstanceID()];
                i || (e.setFloat(1),
                e.apply(this.getGraphicContext(), t.getUniformsCache().uArrayColorEnabled),
                this._previousColorAttribPair[t.getInstanceID()] = !0)
            }
        },
        disableVertexColor: function() {
            var t = this.attributeMap.Program.lastApplied;
            if (t.getUniformsCache().uArrayColorEnabled && t.getAttributesCache().Color) {
                var e = this.uniforms.ArrayColorEnabled.globalDefault
                  , i = this._previousColorAttribPair[t.getInstanceID()];
                i && (e.setFloat(0),
                e.apply(this.getGraphicContext(), t.getUniformsCache().uArrayColorEnabled),
                this._previousColorAttribPair[t.getInstanceID()] = !1)
            }
        },
        applyDisablingOfVertexAttributes: function() {
            for (var t = this.vertexAttribMap._keys, e = 0, i = t.length; e < i; e++)
                if (this.vertexAttribMap._disable[t[e]] === !0) {
                    var n = t[e];
                    this._graphicContext.disableVertexAttribArray(n),
                    this.vertexAttribMap._disable[n] = !1,
                    this.vertexAttribMap[n] = !1
                }
        },
        clearVertexAttribCache: function() {
            for (var t = this.vertexAttribMap, e = t._keys, i = 0, n = e.length; i < n; i++) {
                var r = e[i];
                t[r] = void 0,
                t._disable[r] = !1
            }
            this.vertexAttribMap._disable.length = 0,
            this.vertexAttribMap._keys.length = 0
        },
        setVertexArrayObject: function(t) {
            return this._currentVAO !== t && (this._extVAO.bindVertexArrayOES(t),
            this._currentVAO = t,
            t || this.clearVertexAttribCache(),
            this._currentIndexVBO = void 0,
            !0)
        },
        setVertexAttribArray: function(t, e, i) {
            var n = this.vertexAttribMap;
            n._disable[t] = !1;
            var r = this._graphicContext
              , a = !1;
            e.isDirty() && (e.bind(r),
            e.compile(r),
            a = !0);
            var s = n[t];
            s !== e && (a || e.bind(r),
            s || (r.enableVertexAttribArray(t),
            void 0 === s && n._keys.push(t)),
            n[t] = e,
            r.vertexAttribPointer(t, e.getItemSize(), e.getType(), i, 0, 0))
        },
        _getActiveUniformsFromProgramAttributes: function(t, e) {
            var i = this.attributeMap
              , n = t.getTrackAttributes().attributeKeys;
            if (n.length > 0)
                for (var r = 0, a = n.length; r < a; r++) {
                    var s = n[r]
                      , o = i[s];
                    if (void 0 !== o) {
                        var u = o.globalDefault;
                        if (void 0 !== u.getOrCreateUniforms)
                            for (var l = u.getOrCreateUniforms(), c = l.getKeys(), h = 0, d = c.length; h < d; h++)
                                e.push(l[c[h]])
                    }
                }
        },
        _getActiveUniformsFromProgramTextureAttributes: function(t, e) {
            var i = t.getTrackAttributes().textureAttributeKeys;
            if (void 0 !== i)
                for (var n = 0, r = i.length; n < r; n++) {
                    var a = i[n];
                    if (void 0 !== a) {
                        var s = this.textureAttributeMapList[n];
                        if (void 0 !== s)
                            for (var o = 0, u = a.length; o < u; o++) {
                                var l = a[o]
                                  , c = s[l];
                                if (void 0 !== c) {
                                    var h = c.globalDefault;
                                    if (void 0 !== h.getOrCreateUniforms)
                                        for (var d = h.getOrCreateUniforms(), p = d.getKeys(), f = 0, g = p.length; f < g; f++)
                                            e.push(d[p[f]])
                                }
                            }
                    }
                }
        },
        _cacheUniformsForCustomProgram: function(t, e) {
            this._getActiveUniformsFromProgramAttributes(t, e),
            this._getActiveUniformsFromProgramTextureAttributes(t, e);
            for (var i = this._graphicContext, r = new n, a = 0, s = e.length; a < s; a++) {
                var o = e[a]
                  , u = o.getName()
                  , l = i.getUniformLocation(t._program, u);
                void 0 !== l && null !== l && (r[u] = o)
            }
            r.dirty(),
            t.trackUniforms = r
        },
        _applyCustomProgramUniforms: function() {
            var t = [];
            return function(e) {
                t.length = 0,
                void 0 !== e.getTrackAttributes() && void 0 === e.trackUniforms && this._cacheUniformsForCustomProgram(e, t);
                var i, n = e.getUniformsCache(), r = n.getKeys(), a = this.uniforms;
                e.trackUniforms && (i = e.trackUniforms);
                for (var s, o = 0, u = r.length; o < u; o++) {
                    var l = r[o]
                      , c = n[l]
                      , h = a[l];
                    void 0 === h ? void 0 !== i && (s = i[l],
                    void 0 !== s && s.apply(this._graphicContext, c)) : (s = 0 === h.values().length ? h.globalDefault : h.back().object,
                    s.apply(this._graphicContext, c))
                }
            }
        }(),
        _generateAndApplyProgram: function() {
            var t = this.attributeMap;
            if (void 0 === t.Program || 0 === t.Program.values().length || t.Program.back().value === u.OFF) {
                var e = this._shaderGeneratorNames.back()
                  , i = this._shaderGeneratorProxy.getShaderGenerator(e ? e.object : void 0)
                  , n = i.getOrCreateProgram(this);
                return this.applyAttribute(n),
                n
            }
        },
        _computeForeignUniforms: function(t, e) {
            for (var i = t.getKeys(), n = t, r = [], a = 0, s = i.length; a < s; a++) {
                var o = i[a]
                  , u = n[o];
                void 0 !== u && void 0 === e[o] && o !== this.modelViewMatrix.getName() && o !== this.modelMatrix.getName() && o !== this.viewMatrix.getName() && o !== this.projectionMatrix.getName() && o !== this.modelViewNormalMatrix.getName() && "uArrayColorEnabled" !== o && r.push(o)
            }
            return r
        },
        _removeUniformsNotRequiredByProgram: function(t, e) {
            for (var i = t.getKeys(), n = 0, r = i.length; n < r; n++) {
                var a = i[n]
                  , s = e[a];
                void 0 !== s && null !== s || (delete t[a],
                t.dirty())
            }
        },
        _cacheUniformsForGeneratedProgram: function(t) {
            var e = this._computeForeignUniforms(t.getUniformsCache(), t.getActiveUniforms());
            t.setForeignUniforms(e),
            this._removeUniformsNotRequiredByProgram(t.getActiveUniforms(), t.getUniformsCache())
        },
        _copyUniformEntry: function(t) {
            var e, i = t.getInternalArray();
            return i.length < 16 && (e = new i.constructor(i.length)),
            e
        },
        _initUniformCache: function(t) {
            var e, i, n, r, a, s, o = t.getActiveUniforms(), u = o.getKeys(), l = t.getForeignUniforms(), c = this.uniforms, h = [], d = [];
            if (t._cacheUniformId = this._cacheUniformId++,
            this._programUniformCache[t._cacheUniformId] = {},
            l.length)
                for (n = h,
                e = 0,
                i = l.length; e < i; e++) {
                    r = l[e];
                    var p = c[r];
                    p && (s = p.globalDefault,
                    a = this._copyUniformEntry(s),
                    n.push(a))
                }
            if (u.length)
                for (n = d,
                e = 0,
                i = u.length; e < i; e++)
                    r = u[e],
                    s = o[r],
                    a = this._copyUniformEntry(s),
                    n.push(a);
            this._programUniformCache[t._cacheUniformId].foreign = h,
            this._programUniformCache[t._cacheUniformId].active = d
        },
        _checkCacheAndApplyUniform: function(t, e, i, n, r) {
            var a, s = t.getInternalArray(), o = s.length;
            if (o <= 4) {
                var u = e[i];
                a = p[o](s, u)
            } else
                a = !1;
            if (!a) {
                var l = n[r];
                t.apply(this._graphicContext, l)
            }
        },
        _applyGeneratedProgramUniforms: function(t) {
            var e = t.getForeignUniforms();
            e || (this._cacheUniformsForGeneratedProgram(t),
            e = t.getForeignUniforms(),
            this._initUniformCache(t));
            var i, n, r, s, o = t.getUniformsCache(), u = t.getActiveUniforms(), l = this._programUniformCache[t._cacheUniformId].active, c = this._programUniformCache[t._cacheUniformId].foreign, h = u.getKeys();
            for (this.nbApplyUniform += h.length,
            i = 0,
            n = h.length; i < n; i++)
                r = h[i],
                s = u[r],
                this._checkCacheAndApplyUniform(s, l, i, o, r);
            var d = this.uniforms;
            for (i = 0,
            n = e.length; i < n; i++) {
                r = e[i];
                var p = d[r];
                void 0 !== p && (0 === p.values().length ? (s = p.globalDefault,
                a.warn("Uniform Default Not attached to a StateSet in Scene Hierarchy: " + p.globalDefault.getName())) : s = p.back().object),
                this._checkCacheAndApplyUniform(s, c, i, o, r)
            }
        },
        _setStateSetsDrawID: function(t) {
            for (var e = this.stateSets.values(), i = 0, n = e.length; i < n; i++)
                e[i].setDrawID(t)
        },
        _stateSetStackChanged: function(t, e) {
            var i = this.stateSets.values()
              , n = i.length;
            if (e !== n)
                return !0;
            for (var r = 0; r < n; r++)
                if (t !== i[r].getDrawID())
                    return !0;
            return !1
        }
    }), "osg", "State"),
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1239)
      , a = i(1207)
      , s = i(1237)
      , o = function() {
        s.call(this),
        this._images = {};
        for (var t = 0; t < 6; t++)
            this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X + t] = new r
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(s.prototype, {
        setDefaultParameters: function() {
            s.prototype.setDefaultParameters.call(this),
            this._textureTarget = s.TEXTURE_CUBE_MAP,
            this._flipY = !1
        },
        cloneType: function() {
            return new o
        },
        setImage: function(t, e, i) {
            var n = t;
            "string" == typeof n && (n = s[n]),
            this._images[n].setImage(e, i),
            this.setImageFormat(i),
            this.setTextureSize(this._images[n].getWidth(), this._images[n].getHeight()),
            this._textureNull = !1,
            this.dirty()
        },
        getImage: function(t) {
            return this._images[t].getImage()
        },
        initCubemapContent: function(t) {
            var e = this._internalFormat;
            return this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_POSITIVE_X, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_NEGATIVE_X, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_POSITIVE_Y, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_NEGATIVE_Y, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_POSITIVE_Z, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_NEGATIVE_Z, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            !0
        },
        generateMipmap: function(t, e) {
            if (this.hasMipmapFilter()) {
                if (this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].hasMipmap())
                    for (var i = 0; i < 6; i++) {
                        var n = this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X + i];
                        n.hasMipmap() || a.error("mipmap not set correctly for TextureCubemap");
                        for (var r = this._internalFormat, o = 1; o < n.getMipmap().length; o++) {
                            var u = n.getMipmap()[o].getWidth();
                            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_POSITIVE_X + i, o, r, u, u, 0, r, this._type, n.getMipmap()[o].getImage())
                        }
                    }
                else
                    t.generateMipmap(e);
                this._dirtyMipmap = !1
            }
        },
        applyImageTarget: function(t, e, i) {
            var n = this._images[i];
            return n.getImage() && n.isReady() ? n.isDirty() ? (this.setTextureSize(n.getWidth(), n.getHeight()),
            n.setDirty(!1),
            n.isTypedArray() ? this.applyTexImage2D(t, i, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, n.getImage()) : this.applyTexImage2D(t, i, 0, e, e, this._type, n.getImage()),
            !this._unrefImageDataAfterApply || this.hasMipmap() && n.hasMipmap() || n.release(),
            1) : 1 : 0
        },
        initCubemapContentImage: function(t) {
            var e = this._internalFormat
              , i = 0;
            return i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_POSITIVE_X),
            i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_NEGATIVE_X),
            i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_POSITIVE_Y),
            i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_NEGATIVE_Y),
            i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_POSITIVE_Z),
            i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_NEGATIVE_Z),
            6 === i
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            if (this._dirtyTextureObject && this.releaseGLObjects(),
            void 0 === this._textureObject || this.isDirty())
                if (this._textureNull)
                    e.bindTexture(this._textureTarget, null);
                else {
                    this._textureObject || (this.computeTextureFormat(),
                    this.init(t)),
                    this._textureObject.bind(e);
                    var i;
                    i = this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].getImage() ? this.initCubemapContentImage(e) : this.initCubemapContent(e),
                    i && (this._dirty = !1,
                    this.applyFilterParameter(e, this._textureTarget),
                    this.generateMipmap(e, this._textureTarget))
                }
            else
                this._textureObject.bind(e),
                this.isDirtyMipmap() && this.generateMipmap(e, this._textureTarget)
        }
    }), "osg", "TextureCubeMap"),
    n.setTypeID(o),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1229)
      , a = function() {
        r.call(this),
        this.visitorType = r.UPDATE_VISITOR,
        this._numUpdateCallback = 0
    };
    a.prototype = n.objectInherit(r.prototype, {
        resetStats: function() {
            this._numUpdateCallback = 0
        },
        apply: function(t) {
            var e = t.getStateSet();
            if (e && e.requiresUpdateTraversal()) {
                var i = e.getUpdateCallbackList()
                  , n = i.length;
                if (n) {
                    this._numUpdateCallback += n;
                    for (var r = 0, a = n; r < a; r++)
                        i[r].update(e, this)
                }
            }
            for (var s = t.getUpdateCallbackList(), o = s.length, u = 0; u < o; u++)
                if (this._numUpdateCallback++,
                !s[u].update(t, this))
                    return;
            t.getNumChildrenRequiringUpdateTraversal() > 0 && this.traverse(t)
        }
    }),
    t.exports = a
}
, function(t, e, i) {
    t.exports = i(1318)
}
, function(t, e, i) {
    "use strict";
    var n = i(1213)
      , r = i(1212)
      , a = r.vec2
      , s = {
        create: a.create,
        createAndSet: a.fromValues,
        copy: function(t, e) {
            return a.copy(e, t)
        },
        set: function(t, e, i) {
            return a.set(i, t, e)
        },
        valid: function(t) {
            return !n.isNaN(t[0]) && !n.isNaN(t[1])
        },
        mult: function(t, e, i) {
            return i[0] = t[0] * e,
            i[1] = t[1] * e,
            i
        },
        length2: a.sqrLen,
        length: a.len,
        distance2: function(t, e) {
            return a.sqrDist(e, t)
        },
        distance: function(t, e) {
            return a.dist(e, t)
        },
        normalize: function(t, e) {
            return a.normalize(e, t)
        },
        dot: a.dot,
        sub: function(t, e, i) {
            return a.sub(i, t, e)
        },
        add: function(t, e, i) {
            return a.add(i, t, e)
        },
        neg: function(t, e) {
            return a.negate(e, t)
        },
        lerp: function(t, e, i, n) {
            return a.lerp(n, e, i, t)
        }
    };
    t.exports = s
}
, function(t, e, i) {
    t.exports = i(1320)
}
, function(t, e, i) {
    "use strict";
    var n = i(1213)
      , r = i(1212)
      , a = r.vec3
      , s = {
        create: a.create,
        createAndSet: a.fromValues,
        init: function(t) {
            return a.set(t, 0, 0, 0)
        },
        set: function(t, e, i, n) {
            return a.set(n, t, e, i)
        },
        copy: function(t, e) {
            return a.copy(e, t)
        },
        cross: function(t, e, i) {
            return a.cross(i, t, e)
        },
        valid: function(t) {
            return !n.isNaN(t[0]) && (!n.isNaN(t[1]) && !n.isNaN(t[2]))
        },
        mult: function(t, e, i) {
            return i[0] = t[0] * e,
            i[1] = t[1] * e,
            i[2] = t[2] * e,
            i
        },
        length2: a.sqrLen,
        length: a.len,
        distance2: function(t, e) {
            return a.sqrDist(e, t)
        },
        distance: function(t, e) {
            return a.dist(e, t)
        },
        normalize: function(t, e) {
            return a.normalize(e, t)
        },
        dot: a.dot,
        sub: function(t, e, i) {
            return a.sub(i, t, e)
        },
        add: function(t, e, i) {
            return a.add(i, t, e)
        },
        neg: function(t, e) {
            return a.negate(e, t)
        },
        lerp: function(t, e, i, n) {
            return a.lerp(n, e, i, t)
        },
        equal: function(t, e) {
            return a.exactEquals(t, e)
        }
    };
    s.zero = s.create(),
    s.one = s.createAndSet(1, 1, 1),
    s.infinity = s.createAndSet(1 / 0, 1 / 0, 1 / 0),
    s.negativeInfinity = s.createAndSet(-(1 / 0), -(1 / 0), -(1 / 0)),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = i(1212).mat4
      , s = i(1212).vec3
      , o = function(t, e, i, n) {
        r.call(this),
        this._x = void 0 !== t ? t : 0,
        this._y = void 0 !== e ? e : 0,
        this._width = void 0 !== i ? i : 800,
        this._height = void 0 !== n ? n : 600
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Viewport",
        cloneType: function() {
            return new o
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            e.viewport(this._x, this._y, this._width, this._height)
        },
        setViewport: function(t, e, i, n) {
            this._x = t,
            this._y = e,
            this._width = i,
            this._height = n
        },
        x: function() {
            return this._x
        },
        y: function() {
            return this._y
        },
        width: function() {
            return this._width
        },
        height: function() {
            return this._height
        },
        computeWindowMatrix: function() {
            var t = a.create()
              , e = a.create()
              , i = s.fromValues(1, 1, 1);
            return function(n) {
                a.fromTranslation(t, i),
                a.fromScaling(e, [.5 * this._width, .5 * this._height, .5]);
                var r = a.fromTranslation(n, s.fromValues(this._x, this._y, 0));
                return a.mul(r, r, a.mul(e, e, t))
            }
        }()
    }), "osg", "Viewport"),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = function(t, e, i, n) {
        r.call(this),
        this._x = void 0 !== t ? t : -1,
        this._y = void 0 !== e ? e : -1,
        this._width = void 0 !== i ? i : -1,
        this._height = void 0 !== n ? n : -1
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Scissor",
        cloneType: function() {
            return new a
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            this._x !== -1 ? (e.enable(e.SCISSOR_TEST),
            e.scissor(this._x, this._y, this._width, this._height)) : e.disable(e.SCISSOR_TEST)
        },
        setScissor: function(t, e, i, n) {
            this._x = t,
            this._y = e,
            this._width = i,
            this._height = n
        },
        x: function() {
            return this._x
        },
        y: function() {
            return this._y
        },
        width: function() {
            return this._width
        },
        height: function() {
            return this._height
        }
    }), "osg", "Scissor"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = function(t) {
        if (this._enabled = !1,
        t) {
            var e = t.getExtension("EXT_disjoint_timer_query");
            if (!e)
                return this;
            if (this._hasTimeElapsed = e.getQueryEXT(e.TIME_ELAPSED_EXT, e.QUERY_COUNTER_BITS_EXT) >= 30,
            this._hasTimeStamp = e.getQueryEXT(e.TIMESTAMP_EXT, e.QUERY_COUNTER_BITS_EXT) >= 30,
            !this._hasTimeElapsed && !this._hasTimeStamp)
                return this;
            this._hasTimeStamp || n.debug("Warning: do not use interleaved GPU query"),
            this._gl = t,
            this._glTimer = e,
            this._enabled = !0
        }
        this._frameAverageCount = 10,
        this._glQueries = [],
        this._queriesByID = {},
        this._userQueries = [],
        this._queryCount = 0,
        this._nbOpened = 0
    };
    r.FRAME_COUNT = 0,
    r.instance = function(t) {
        return r._instance ? t && r._instance.getContext() !== t && r._instance.setContext(t) : r._instance = new r(t),
        r._instance
    }
    ,
    r.prototype = {
        getContext: function() {
            return this._gl
        },
        setContext: function(t) {
            this._gl = t
        },
        setFrameAverageCount: function(t) {
            this._frameAverageCount = t
        },
        clearQueries: function() {
            for (var t = this._glQueries, e = 0, i = t.length; e < i; ++e) {
                var n = t[e];
                this._glTimer.deleteQueryEXT(n._pollingStartQuery),
                n._pollingEndQuery && this._glTimer.deleteQueryEXT(n)
            }
            this._userQueries.length = 0,
            this._glQueries.length = 0,
            this._queriesByID = {}
        },
        supportTimeStamp: function() {
            return this._hasTimeStamp
        },
        enable: function() {
            this._enabled = this._glTimer
        },
        disable: function() {
            this._enabled = !1
        },
        isEnabled: function() {
            return this._enabled
        },
        setCallback: function(t) {
            this._callback = t
        },
        createUserQuery: function(t) {
            var e;
            return e = this._hasTimeStamp ? this.createGLQuery() : {
                _startIndex: 0,
                _endIndex: 0
            },
            e._id = t,
            e._frame = r.FRAME_COUNT,
            e._isOpened = !0,
            e._siblings = [],
            e
        },
        createGLQuery: function() {
            var t = {};
            return t._isWaiting = !1,
            t._pollingStartQuery = void 0,
            t._pollingEndQuery = void 0,
            t._averageTimer = 0,
            t._resultCount = 0,
            this._hasTimeStamp && (t._pollingEndQuery = this._glTimer.createQueryEXT()),
            t._pollingStartQuery = this._glTimer.createQueryEXT(),
            this._glQueries.push(t),
            t
        },
        getOrCreateLastGLQuery: function() {
            var t = this._glQueries[this._queryCount - 1];
            return t ? t : t = this._glQueries[this._queryCount - 1] = this.createGLQuery()
        },
        beginCurrentQuery: function() {
            if (0 !== this._nbOpened) {
                this._queryCount++;
                var t = this.getOrCreateLastGLQuery();
                t._isWaiting || this._glTimer.beginQueryEXT(this._glTimer.TIME_ELAPSED_EXT, t._pollingStartQuery)
            }
        },
        endCurrentQuery: function() {
            0 !== this._nbOpened && (this.getOrCreateLastGLQuery()._isWaiting || this._glTimer.endQueryEXT(this._glTimer.TIME_ELAPSED_EXT))
        },
        getAvailableQueryByID: function(t) {
            var e = this._queriesByID[t];
            if (!e)
                return e = this._queriesByID[t] = this.createUserQuery(t),
                this._userQueries.push(e),
                e;
            if (e._frame === r.FRAME_COUNT) {
                if (e._isOpened)
                    return e;
                for (var i = e._siblings, n = 0, a = i.length; n < a; ++n) {
                    var s = i[n];
                    if (s._frame !== r.FRAME_COUNT || s._isOpened)
                        return s._frame = r.FRAME_COUNT,
                        s
                }
                var o = this.createUserQuery();
                return i.push(o),
                o
            }
            return e._frame = r.FRAME_COUNT,
            e
        },
        start: function(t) {
            if (this._enabled) {
                var e = this.getAvailableQueryByID(t);
                e._isOpened = !0,
                this._hasTimeStamp ? e._isWaiting || this._glTimer.queryCounterEXT(e._pollingStartQuery, this._glTimer.TIMESTAMP_EXT) : (this.endCurrentQuery(),
                this._nbOpened++,
                e._startIndex = this._queryCount,
                this.beginCurrentQuery())
            }
        },
        end: function(t) {
            if (this._enabled) {
                var e = this.getAvailableQueryByID(t);
                e._isOpened = !1,
                this._hasTimeStamp ? e._isWaiting || this._glTimer.queryCounterEXT(e._pollingEndQuery, this._glTimer.TIMESTAMP_EXT) : (this.endCurrentQuery(),
                e._endIndex = this._queryCount,
                this._nbOpened--,
                this.beginCurrentQuery())
            }
        },
        computeQueryAverageTime: function(t) {
            for (var e = 0, i = this._glQueries, n = t._startIndex; n < t._endIndex; ++n) {
                var r = i[n]._averageTimer;
                if (r < 0)
                    return -1;
                e += r
            }
            return e
        },
        computeFullAverageTime: function(t) {
            var e = this.computeQueryAverageTime(t);
            if (e < 0)
                return -1;
            for (var i = t._siblings, n = 0, a = i.length; n < a; ++n) {
                var s = i[n];
                if (s._frame === r.FRAME_COUNT - 1) {
                    var o = this.computeQueryAverageTime(s);
                    if (o < 0)
                        return -1;
                    e += o
                }
            }
            return e
        },
        pollQueries: function() {
            if (r.FRAME_COUNT++,
            this._queryCount = 0,
            this._nbOpened = 0,
            this._enabled && this._callback) {
                var t, e = this._glQueries, i = e.length, n = this._gl.getParameter(this._glTimer.GPU_DISJOINT_EXT);
                if (n)
                    for (t = 0; t < i; ++t)
                        e[t]._isWaiting = !1;
                else {
                    for (t = 0; t < i; ++t)
                        this.pollQuery(e[t]);
                    var a = this._userQueries
                      , s = a.length;
                    for (t = 0; t < s; ++t) {
                        var o = a[t]
                          , u = this.computeFullAverageTime(o);
                        u > 0 && this._callback(u, o._id)
                    }
                }
            }
        },
        pollQuery: function(t) {
            t._isWaiting = !1;
            var e = this._hasTimeStamp ? t._pollingEndQuery : t._pollingStartQuery
              , i = this._glTimer.getQueryObjectEXT(e, this._glTimer.QUERY_RESULT_AVAILABLE_EXT);
            if (!i)
                return t._isWaiting = !0,
                0;
            var n;
            if (this._hasTimeStamp) {
                var r = this._glTimer.getQueryObjectEXT(t._pollingStartQuery, this._glTimer.QUERY_RESULT_EXT)
                  , a = this._glTimer.getQueryObjectEXT(e, this._glTimer.QUERY_RESULT_EXT);
                n = a - r
            } else
                n = this._glTimer.getQueryObjectEXT(e, this._glTimer.QUERY_RESULT_EXT);
            return t._resultCount++,
            t._resultCount > this._frameAverageCount && (t._averageTimer = 0,
            t._resultCount = 1),
            t._averageTimer = t._averageTimer + (n - t._averageTimer) / t._resultCount,
            t._averageTimer
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1325)
      , a = i(1288)
      , s = i(1281)
      , o = i(1329)
      , u = i(1278)
      , l = i(1326)
      , c = i(1331)
      , h = i(1333)
      , d = i(1330)
      , p = i(1284)
      , f = i(1283)
      , g = i(1282)
      , m = i(1276)
      , v = i(1334)
      , _ = i(1335)
      , b = i(1336)
      , x = i(1337)
      , A = i(1338)
      , y = i(1279)
      , S = i(1280)
      , C = i(1332)
      , M = i(1277)
      , w = {};
    n.objectMix(w, h),
    n.objectMix(w, d),
    w.Animation = r,
    w.SkinningAttribute = a,
    w.AnimationUpdateCallback = s,
    w.BasicAnimationManager = o,
    w.Bone = u,
    w.Channel = l,
    w.CollectAnimationUpdateCallbackVisitor = c,
    w.MorphAttribute = p,
    w.MorphGeometry = f,
    w.RigGeometry = g,
    w.Skeleton = m,
    w.StackedMatrix = v,
    w.StackedQuaternion = _,
    w.StackedRotateAxis = b,
    w.StackedScale = x,
    w.StackedTranslate = A,
    w.UpdateBone = y,
    w.UpdateMatrixTransform = S,
    w.UpdateMorph = C,
    w.UpdateSkeleton = M,
    t.exports = w
}
, function(t, e, i) {
    "use strict";
    var n = i(1326)
      , r = 0
      , a = function(t, e) {
        for (var i = 1 / 0, n = -(1 / 0), a = 0; a < t.length; a++)
            i = Math.min(i, t[a].start),
            n = Math.max(n, t[a].end);
        var s = n - i
          , o = e || "animation" + r.toString();
        return r++,
        {
            channels: t,
            duration: s,
            name: o,
            start: i
        }
    }
      , s = function(t) {
        for (var e = [], i = 0; i < t.channels.length; i++) {
            var r = n.createInstanceChannel(t.channels[i]);
            e.push(r)
        }
        return {
            channels: e,
            duration: t.duration,
            start: 0,
            name: t.name,
            firstKeyTime: t.start
        }
    }
      , o = function() {};
    o.createAnimation = a,
    o.createInstanceAnimation = s,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).vec3
      , r = i(1212).quat
      , a = i(1327)
      , s = i(1328)
      , o = {}
      , u = function(t, e, i, n, r, a) {
        var s = i[0]
          , o = i[i.length - 1];
        return a.start = s,
        a.keys = e,
        a.end = o,
        a.times = i,
        a.type = t,
        a.duration = o - s,
        a.target = n,
        a.name = r,
        a
    }
      , l = function(t, e, i, n, r) {
        return u(s.Vec3, t, e, i, n, r || {})
    }
      , c = function(t, e, i, n, r) {
        return u(s.Float, t, e, i, n, r || {})
    }
      , h = function(t, e, i, n, r) {
        return u(s.Quat, t, e, i, n, r || {})
    }
      , d = function(t, e, i, n, r) {
        return u(s.QuatSlerp, t, e, i, n, r || {})
    }
      , p = function(t, e, i, n, r) {
        return u(s.FloatCubicBezier, t, e, i, n, r || {})
    }
      , f = function(t, e, i, n, r) {
        return u(s.Vec3CubicBezier, t, e, i, n, r || {})
    }
      , g = {
        create: function() {
            return 0
        }
    }
      , m = {
        create: function() {
            return n.create32()
        }
    }
      , v = {
        create: function() {
            return r.create32()
        }
    }
      , _ = function(t, e) {
        return {
            channel: e,
            value: t.create(),
            targetID: a.InvalidTargetID,
            weight: 1,
            key: 0,
            start: 0,
            end: 0
        }
    }
      , b = function(t) {
        return _(m, t)
    }
      , x = function(t) {
        return _(v, t)
    }
      , A = function(t) {
        return _(g, t)
    }
      , y = function(t) {
        return _(g, t)
    }
      , S = function(t) {
        return _(m, t)
    }
      , C = function(t) {
        return o[t.type](t)
    };
    o.createInstanceChannel = C,
    o.createInstanceVec3Channel = b,
    o.createInstanceQuatChannel = x,
    o.createInstanceQuatSlerpChannel = x,
    o.createInstanceFloatChannel = A,
    o.createInstanceFloatCubicBezierChannel = y,
    o.createInstanceVec3CubicBezierChannel = S,
    o.createVec3Channel = l,
    o.createQuatChannel = h,
    o.createQuatSlerpChannel = d,
    o.createFloatChannel = c,
    o.createFloatCubicBezierChannel = p,
    o.createVec3CubicBezierChannel = f,
    o[s.Vec3] = b,
    o[s.Quat] = x,
    o[s.QuatSlerp] = x,
    o[s.Float] = A,
    o[s.FloatCubicBezier] = y,
    o[s.Vec3CubicBezier] = S,
    o.ChannelType = s,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).mat4
      , r = i(1212).quat
      , a = i(1212).vec3
      , s = i(1328)
      , o = {};
    o.InvalidTargetID = -1;
    var u = function(t, e, i) {
        return {
            type: t,
            id: o.InvalidTargetID,
            channels: [],
            value: e,
            defaultValue: i
        }
    }
      , l = function(t) {
        return u(s.Quat, r.copy(r.create(), t), r.copy(r.create(), t))
    }
      , c = function(t) {
        return u(s.Matrix, n.copy(n.create(), t), n.copy(n.create(), t))
    }
      , h = function(t) {
        return u(s.Vec3, a.copy(a.create(), t), a.copy(a.create(), t))
    }
      , d = function(t) {
        return u(s.Float, t, t)
    };
    o.createQuatTarget = l,
    o.createVec3Target = h,
    o.createFloatTarget = d,
    o.createMatrixTarget = c,
    t.exports = o
}
, function(t, e) {
    "use strict";
    t.exports = {
        Vec3: 0,
        Quat: 1,
        Float: 2,
        FloatCubicBezier: 3,
        Vec3CubicBezier: 4,
        QuatSlerp: 5,
        Matrix: 6,
        Count: 7
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1203)
      , a = i(1210)
      , s = i(1212).quat
      , o = i(1212).vec3
      , u = i(1212).mat4
      , l = i(1326)
      , c = i(1325)
      , h = i(1330)
      , d = i(1331)
      , p = i(1327)
      , f = i(1332)
      , g = {
        lerp: function(t, e, i) {
            return t + (e - t) * i
        },
        init: function() {
            return 0
        },
        copy: function(t) {
            return t
        },
        create: function() {
            return 0
        }
    }
      , m = [];
    m[l.ChannelType.Float] = 1,
    m[l.ChannelType.FloatCubicBezier] = 1,
    m[l.ChannelType.Vec3] = 3,
    m[l.ChannelType.Vec3CubicBezier] = 3,
    m[l.ChannelType.Quat] = 4,
    m[l.ChannelType.QuatSlerp] = 4,
    m[l.ChannelType.Matrix] = 16;
    var v = [];
    v.length = l.ChannelType.Count,
    v[l.ChannelType.Vec3] = o,
    v[l.ChannelType.Quat] = s,
    v[l.ChannelType.QuatSlerp] = s,
    v[l.ChannelType.Float] = g,
    v[l.ChannelType.FloatCubicBezier] = g,
    v[l.ChannelType.Vec3CubicBezier] = o,
    v[l.ChannelType.Matrix] = u;
    var _ = function() {
        a.call(this),
        this._simulationTime = 0,
        this._pauseTime = 0,
        this._timeFactor = 1,
        this._startTime = 0,
        this._instanceAnimations = {},
        this._startAnimations = {},
        this._targets = [],
        this._targetsMap = {},
        this._targetsByTypes = [],
        this._targetsByTypes.length = l.ChannelType.Count;
        for (var t = 0, e = this._targetsByTypes.length; t < e; t++)
            this._targetsByTypes[t] = [];
        this._activeAnimations = {},
        this._activeAnimationList = [],
        this._activeChannelsByTypes = [],
        this._activeChannelsByTypes.length = l.ChannelType.Count;
        for (var i = 0, n = this._activeChannelsByTypes.length; i < n; i++)
            this._activeChannelsByTypes[i] = [];
        this._animationsUpdateCallback = {},
        this._animationsUpdateCallbackArray = [],
        this._animationsToRegister = [],
        this._pause = !1,
        this._dirty = !1,
        this._seekTime = -1
    };
    _.prototype = r.objectInherit(a.prototype, {
        init: function(t) {
            this._simulationTime = 0,
            this._pauseTime = 0,
            this._timeFactor = 1,
            this._startTime = 0,
            this._instanceAnimations = {},
            this._startAnimations = {},
            this._resetTargets(),
            this._activeAnimations = {},
            this._activeAnimationList.length = 0;
            for (var e = 0, i = this._activeChannelsByTypes.length; e < i; e++)
                this._activeChannelsByTypes[e].length = 0;
            this._animationsUpdateCallback = {},
            this._animationsUpdateCallbackArray.length = 0,
            this._pause = !1,
            this._seekTime = -1,
            this.addAnimations(t)
        },
        addAnimations: function(t) {
            var e = this._addAnimation(t);
            Array.prototype.push.apply(this._animationsToRegister, e),
            this._dirty = !0,
            this._registerAnimations()
        },
        update: function(t, e) {
            this._dirty && (this._findAnimationUpdateCallback(t),
            this._registerTargetFoundInAnimationCallback(),
            this._registerAnimations());
            var i = e.getFrameStamp().getSimulationTime();
            return this._seekTime !== -1 && (this._pauseTime = -this._seekTime + this._startTime + i),
            this._seekTime = -1,
            this._pause ? this._pauseTime = i - this._simulationTime + this._startTime : this._simulationTime = this._startTime + (i - this._pauseTime),
            this.updateManager(this._simulationTime * this._timeFactor),
            !0
        },
        updateManager: function(t) {
            this._processStartAnimation(t);
            for (var e = l.ChannelType.Count, i = 0; i < e; i++) {
                var n = this._activeChannelsByTypes[i];
                this._updateChannelsType(t, n, h[i])
            }
            for (var r = 0; r < e; r++) {
                var a = this._targetsByTypes[r];
                this._updateTargetType(a, v[r])
            }
            for (var s = 0, o = this._animationsUpdateCallbackArray.length; s < o; s++) {
                var u = this._animationsUpdateCallbackArray[s];
                u.computeChannels()
            }
            this._removeFinishedAnimation(t)
        },
        togglePause: function() {
            this._pause = !this._pause,
            this._pause || (this._seekTime = this._simulationTime)
        },
        getSimulationTime: function() {
            return this._simulationTime
        },
        setSimulationTime: function(t) {
            this._simulationTime = t
        },
        setSeekTime: function(t) {
            this._simulationTime = t,
            this._seekTime = t
        },
        stopAnimation: function(t) {
            for (var e = this._activeAnimationList, i = 0, n = e.length; i < n; ++i)
                if (e[i].name === t)
                    return this._removeActiveChannels(this._instanceAnimations[t]),
                    this._activeAnimations[t] = void 0,
                    void e.splice(i, 1)
        },
        stopAllAnimation: function() {
            for (var t = this._activeAnimationList, e = 0, i = t.length; e < i; ++e) {
                var n = t[e].name;
                this._removeActiveChannels(this._instanceAnimations[n]),
                this._activeAnimations[n] = void 0
            }
            t.length = 0
        },
        setTimeFactor: function(t) {
            var e = t / this._timeFactor;
            this._startTime += (this._simulationTime - this._simulationTime * e) / e,
            this._timeFactor = t,
            this._pause && (this._simulationTime += (this._simulationTime - this._simulationTime * e) / e)
        },
        getTimeFactor: function() {
            return this._timeFactor
        },
        isPlaying: function(t) {
            return !!this._activeAnimations[t]
        },
        playAnimationObject: function(t) {
            var e = this._instanceAnimations[t.name];
            return e ? void (this.isPlaying(t.name) || (e.priority = void 0 === t.priority ? 0 : t.priority,
            e.weight = void 0 === t.weight ? 1 : t.weight,
            e.loop = void 0 === t.loop || t.loop,
            this._startAnimations[e.name] = e)) : void n.info("no animation " + t.name + " found")
        },
        playAnimation: function(t, e, i, n) {
            var r;
            return r = "object" == typeof t ? t : {
                name: t,
                priority: i,
                weight: n,
                loop: e
            },
            this.playAnimationObject(r)
        },
        getAnimations: function() {
            return this._instanceAnimations
        },
        _registerAnimations: function() {
            if (this._targets.length) {
                for (var t = 0, e = this._animationsToRegister.length; t < e; t++) {
                    var i = this._animationsToRegister[t];
                    this._registerInstanceAnimation(i)
                }
                this._animationsToRegister.length = 0,
                this._dirty = !1
            }
        },
        _registerInstanceAnimation: function(t) {
            for (var e = t.channels, i = 0, r = e.length; i < r; i++) {
                var a = e[i]
                  , s = a.channel.target
                  , o = a.channel.name
                  , u = s + "." + o;
                this._targetMap[u] ? a.targetID = this._targetMap[u].id : n.warn("registerInstanceAnimation did not find targetName (" + u + ") in the scene graph")
            }
            return !0
        },
        _findAnimationUpdateCallback: function(t) {
            var e = new d;
            t.accept(e),
            this._animationsUpdateCallback = e.getAnimationUpdateCallbackMap()
        },
        _registerTargetFoundInAnimationCallback: function() {
            this._resetTargets();
            for (var t, e, i, r = 0, a = this._targetMap, s = this._targets, o = function(t, e, i) {
                if (a[t])
                    e !== a[t] && n.warn("detected differents target instance with the same name (" + i + ")");
                else {
                    a[t] = e,
                    e.id = r++,
                    s.push(e);
                    var o = e.type;
                    this._targetsByTypes[o].push(e)
                }
            }
            .bind(this), u = this._animationsUpdateCallback, l = window.Object.keys(u), c = 0, h = l.length; c < h; c++) {
                var d = l[c]
                  , p = u[d];
                if (p.getStackedTransforms && p.getStackedTransforms().length) {
                    this._animationsUpdateCallbackArray.push(p);
                    for (var g = p.getStackedTransforms(), m = 0, v = g.length; m < v; m++) {
                        var _ = g[m];
                        t = _.getTarget(),
                        e = _.getName(),
                        i = p.getName() + "." + e,
                        o(i, t, e)
                    }
                } else if (p instanceof f)
                    for (var b = 0, x = p.getNumTarget(); b < x; b++)
                        e = p.getTargetName(b),
                        i = e + "." + b,
                        t = p.getTarget(b),
                        o(i, t, e)
            }
        },
        _addAnimation: function(t) {
            for (var e = [], i = 0, n = t.length; i < n; i++) {
                var r = t[i]
                  , a = r.name;
                if (!this._instanceAnimations[a]) {
                    var s = c.createInstanceAnimation(r);
                    this._instanceAnimations[a] = s,
                    e.push(s)
                }
            }
            return e
        },
        _addActiveChannels: function(t, e) {
            for (var i = e.channels, n = 0, r = i.length; n < r; n++) {
                var a = i[n]
                  , s = a.channel.type;
                a.t = t,
                a.instanceAnimation = e;
                var o = a.targetID;
                o !== p.InvalidTargetID && (this._activeChannelsByTypes[s].push(a),
                this._targets[o].channels.push(a))
            }
        },
        _removeActiveChannels: function(t) {
            for (var e = t.channels, i = 0, n = e.length; i < n; i++) {
                var r = e[i]
                  , a = r.channel.type
                  , s = r.targetID;
                if (s !== p.InvalidTargetID) {
                    var o = this._targets[s].channels
                      , u = o.indexOf(r);
                    o.splice(u, 1);
                    var l = this._activeChannelsByTypes[a]
                      , c = l.indexOf(r);
                    l.splice(c, 1)
                }
            }
        },
        _updateTargetType: function(t, e) {
            for (var i = 0, n = t.length; i < n; i++) {
                var r = t[i]
                  , a = r.channels
                  , s = a.length;
                if (0 === s)
                    r.value = e.copy(r.defaultValue, r.value);
                else if (1 === s)
                    r.value = e.copy(a[0].value, r.value);
                else {
                    r.value = e.init(r.value);
                    for (var o = 0, u = 0, l = a.length; u < l; u++) {
                        var c = a[u]
                          , h = c.weight;
                        if (o += h,
                        0 !== o && 0 !== h) {
                            var d = h / o;
                            r.value = e.lerp(r.value, r.value, c.value, d)
                        }
                    }
                }
            }
        },
        _updateChannelsType: function(t, e, i) {
            for (var n = 0, r = e.length; n < r; n++) {
                var a = e[n]
                  , s = a.instanceAnimation
                  , o = s.loop
                  , u = t - a.t;
                o && s.duration > 0 && (u %= s.duration),
                i(u + s.firstKeyTime, a)
            }
        },
        _removeFinishedAnimation: function(t) {
            for (var e = this._activeAnimationList, i = 0; i < e.length; ) {
                var n = e[i]
                  , r = n.name;
                t > n.end && n.loop === !1 ? (this._removeActiveChannels(n),
                this._activeAnimations[r] = void 0,
                e.splice(i, 1)) : i++
            }
        },
        _addActiveAnimation: function(t, e) {
            this._activeAnimations[e.name] = e;
            var i = this._instanceAnimations[e.name];
            i.start = t,
            i.end = t + i.duration,
            this._addActiveChannels(t, i),
            this._activeAnimationList.push(i)
        },
        _processStartAnimation: function(t) {
            if (this._targets.length) {
                for (var e = this._startAnimations, i = window.Object.keys(e), n = 0, r = i.length; n < r; n++) {
                    var a = i[n]
                      , s = e[a]
                      , o = s.name;
                    this.isPlaying(o) || this._addActiveAnimation(t, s)
                }
                i.length && (this._startAnimations = {})
            }
        },
        _resetTargets: function() {
            this._targetMap = {},
            this._targets.length = 0;
            for (var t = 0, e = this._targetsByTypes.length; t < e; t++)
                this._targetsByTypes[t].length = 0
        },
        resetAllStackedTransforms: function() {
            for (var t = this._animationsUpdateCallbackArray, e = 0, i = t.length; e < i; e++) {
                for (var n = t[e].getStackedTransforms(), r = 0, a = n.length; r < a; r++)
                    n[r].resetToDefaultValue();
                t[e].computeChannels()
            }
        },
        setAnimationLerpEndStart: function(t, e) {
            var i = t.channels;
            void 0 === t.originalDuration && (t.originalDuration = t.duration),
            t.duration = t.originalDuration + e;
            for (var n = t.firstKeyTime, r = t.originalDuration, a = 0, s = i.length; a < s; ++a) {
                var o = i[a].channel;
                if (!(Math.abs(o.start - n) > .01 || Math.abs(o.duration - r) > .01)) {
                    void 0 === o.originalEnd && (o.originalEnd = o.end),
                    o.end = o.originalEnd + e;
                    var u = m[o.type]
                      , l = o.times.buffer.byteLength / 4;
                    if (0 === e)
                        o.keys = new Float32Array(o.keys.buffer,0,(l - 1) * u),
                        o.times = new Float32Array(o.times.buffer,0,l - 1);
                    else {
                        o.keys = new Float32Array(o.keys.buffer,0,l * u);
                        for (var c = (l - 1) * u, h = 0; h < u; ++h)
                            o.keys[c + h] = o.keys[h];
                        o.times = new Float32Array(o.times.buffer,0,l),
                        o.times[l - 1] = o.times[l - 2] + e
                    }
                }
            }
        }
    }),
    _.TypeToSize = m,
    t.exports = _
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).vec3
      , r = i(1212).quat
      , a = i(1326)
      , s = function(t, e, i) {
        i[0] = e[t++],
        i[1] = e[t++],
        i[2] = e[t++]
    }
      , o = function(t, e, i) {
        i[0] = e[t++],
        i[1] = e[t++],
        i[2] = e[t++],
        i[3] = e[t++]
    }
      , u = function(t, e) {
        var i = e.channel
          , n = e.value
          , r = i.start
          , a = i.end
          , o = i.keys
          , u = i.times;
        if (t >= a)
            return e.key = 0,
            void s(o.length - 3, o, n);
        if (t <= r)
            return e.key = 0,
            void s(0, o, n);
        var l = e.key;
        if (t > u[l])
            for (; u[l + 1] < t; )
                l++;
        else if (t < u[l])
            for (; u[l] > t; )
                l--;
        var c = u[l]
          , h = u[l + 1]
          , d = 3 * l
          , p = o[d++]
          , f = o[d++]
          , g = o[d++]
          , m = o[d++]
          , v = o[d++]
          , _ = o[d++]
          , b = (t - c) / (h - c);
        n[0] = p + (m - p) * b,
        n[1] = f + (v - f) * b,
        n[2] = g + (_ - g) * b,
        e.key = l
    }
      , l = function() {
        var t = r.create32()
          , e = r.create32();
        return function(i, n) {
            var a = n.channel
              , s = n.value
              , u = a.start
              , l = a.end
              , c = a.keys
              , h = a.times;
            if (i >= l)
                return n.key = 0,
                void o(c.length - 4, c, s);
            if (i <= u)
                return n.key = 0,
                void o(0, c, s);
            var d = n.key;
            if (i > h[d])
                for (; h[d + 1] < i; )
                    d++;
            else if (i < h[d])
                for (; h[d] > i; )
                    d--;
            var p = h[d]
              , f = h[d + 1]
              , g = 4 * d;
            t[0] = c[g++],
            t[1] = c[g++],
            t[2] = c[g++],
            t[3] = c[g++],
            e[0] = c[g++],
            e[1] = c[g++],
            e[2] = c[g++],
            e[3] = c[g++];
            var m = (i - p) / (f - p);
            r.nlerp(s, t, e, m),
            n.key = d
        }
    }()
      , c = function() {
        var t = r.create32()
          , e = r.create32();
        return function(i, n) {
            var a = n.channel
              , s = n.value
              , u = a.start
              , l = a.end
              , c = a.keys
              , h = a.times;
            if (i >= l)
                return n.key = 0,
                void o(c.length - 4, c, s);
            if (i <= u)
                return n.key = 0,
                void o(0, c, s);
            var d = n.key;
            if (i > h[d])
                for (; h[d + 1] < i; )
                    d++;
            else if (i < h[d])
                for (; h[d] > i; )
                    d--;
            var p = h[d]
              , f = h[d + 1]
              , g = 4 * d;
            t[0] = c[g++],
            t[1] = c[g++],
            t[2] = c[g++],
            t[3] = c[g++],
            e[0] = c[g++],
            e[1] = c[g++],
            e[2] = c[g++],
            e[3] = c[g++];
            var m = (i - p) / (f - p);
            r.slerp(s, t, e, m),
            n.key = d
        }
    }()
      , h = function(t, e) {
        var i = e.channel
          , n = e.value
          , r = i.start
          , a = i.end
          , s = i.keys
          , o = i.times;
        if (t >= a)
            return e.key = 0,
            void (e.value = s[s.length - 1]);
        if (t <= r)
            return e.key = 0,
            void (e.value = s[0]);
        var u = e.key;
        if (t > o[u])
            for (; o[u + 1] < t; )
                u++;
        else if (t < o[u])
            for (; o[u] > t; )
                u--;
        var l = o[u]
          , c = o[u + 1]
          , h = u
          , d = s[h++]
          , p = s[h++]
          , f = (t - l) / (c - l);
        n = d + (p - d) * f,
        e.key = u,
        e.value = n
    }
      , d = function(t, e) {
        var i = e.channel
          , n = e.value
          , r = i.start
          , a = i.end
          , s = i.keys
          , o = i.times;
        if (t >= a)
            return e.key = 0,
            void (e.value = s[s.length - 3]);
        if (t <= r)
            return e.key = 0,
            void (e.value = s[0]);
        var u = e.key;
        if (t > o[u])
            for (; o[u + 1] < t; )
                u++;
        else if (t < o[u])
            for (; o[u] > t; )
                u--;
        var l = (t - o[u]) / (o[u + 1] - o[u])
          , c = 1 - l
          , h = c * c
          , d = h * c
          , p = l * l
          , f = 3 * u
          , g = s[f] * d
          , m = s[f + 1] * (3 * l * h)
          , v = s[f + 2] * (3 * p * c)
          , _ = s[f + 3] * (p * l);
        n = g + m + v + _,
        e.key = u,
        e.value = n
    }
      , p = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create()
          , r = n.create();
        return function(a, o) {
            var u = o.channel
              , l = o.value
              , c = u.start
              , h = u.end
              , d = u.keys
              , p = u.times;
            if (a >= h)
                return o.key = 0,
                void s(d.length - 9, d, l);
            if (a <= c)
                return o.key = 0,
                void s(0, d, l);
            var f = o.key;
            if (a > p[f])
                for (; p[f + 1] < a; )
                    f++;
            else if (a < p[f])
                for (; p[f] > a; )
                    f--;
            var g = (a - p[f]) / (p[f + 1] - p[f])
              , m = 1 - g
              , v = m * m
              , _ = v * m
              , b = g * g
              , x = 9 * f;
            n.scale(t, n.set(t, d[x++], d[x++], d[x++]), _),
            n.scale(e, n.set(e, d[x++], d[x++], d[x++]), 3 * g * v),
            n.scale(i, n.set(i, d[x++], d[x++], d[x++]), 3 * b * m),
            n.scale(r, n.set(r, d[x++], d[x++], d[x++]), b * g),
            l[0] = t[0] + e[0] + i[0] + r[0],
            l[1] = t[1] + e[1] + i[1] + r[1],
            l[2] = t[2] + e[2] + i[2] + r[2],
            o.key = f
        }
    }()
      , f = a.ChannelType
      , g = {};
    g[f.Vec3] = u,
    g[f.Quat] = l,
    g[f.QuatSlerp] = c,
    g[f.Float] = h,
    g[f.FloatCubicBezier] = d,
    g[f.Vec3CubicBezier] = p,
    g.Vec3LerpInterpolator = u,
    g.QuatLerpInterpolator = l,
    g.QuatSlerpInterpolator = c,
    g.FloatLerpInterpolator = h,
    g.FloatCubicBezierInterpolator = d,
    g.Vec3CubicBezierInterpolator = p,
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1229)
      , a = i(1281)
      , s = function() {
        r.call(this),
        this._animationUpdateCallback = {}
    };
    s.prototype = n.objectInherit(r.prototype, {
        getAnimationUpdateCallbackMap: function() {
            return this._animationUpdateCallback
        },
        apply: function(t) {
            for (var e = t.getUpdateCallbackList(), i = 0, n = e.length; i < n; i++) {
                var r = e[i];
                r instanceof a && (this._animationUpdateCallback[r.getInstanceID()] = r)
            }
            this.traverse(t)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1243)
      , a = i(1282)
      , s = i(1281)
      , o = i(1327)
      , u = i(1283)
      , l = function() {
        s.call(this),
        this._isInitialized = !1,
        this._targets = [],
        this._targetNames = [],
        this._morphs = [],
        this._weights = new Float32Array(4),
        this._indexMap = [0, 0, 0, 0],
        this._gpuMorphed = []
    }
      , c = u.EFFECTIVE_EPS
      , h = function(t, e) {
        return Math.abs(e.value) - Math.abs(t.value)
    };
    l.prototype = n.objectInherit(s.prototype, {
        init: function(t) {
            for (var e = t.getChildren(), i = 0, n = e.length; i < n; i++) {
                var r, s = e[i];
                s instanceof u ? r = s : s instanceof a && s.getSourceGeometry()instanceof u && (r = s.getSourceGeometry()),
                r && r.getName() === this.getName() && (r.isInitialized() || r.init(),
                this._morphs.push(r),
                this._isInitialized = !0)
            }
        },
        isInitialized: function() {
            return this._isInitialized
        },
        getNumTarget: function() {
            return this._targets.length
        },
        getTarget: function(t) {
            return this._targets[t]
        },
        getTargetName: function(t) {
            return this._targetNames[t]
        },
        addTarget: function(t, e) {
            this._targets[e] = o.createFloatTarget(0),
            this._targetNames[e] = t
        },
        _remapBufferArrays: function() {
            for (var t = this._indexMap, e = this._morphs, i = 0; i < 4; ++i)
                for (var n = t[i], r = "_" + i, a = "_" + n, s = 0, o = e.length; s < o; ++s)
                    for (var u = e[s], l = u.getVertexAttributeList(), c = u.getMorphTargetNames(), h = 0, d = c.length; h < d; ++h) {
                        var p = c[h];
                        l[p + r].setBufferArray(l[p + a].getInitialBufferArray())
                    }
        },
        _mergeExtraMorphTarget: function(t, e, i) {
            var n = 0
              , a = this._gpuMorphed
              , s = t[e]
              , o = s.getElements().length
              , u = o / s.getItemSize()
              , l = s.getItemSize();
            s._cpuMorph = s._cpuMorph || new r(r.ARRAY_BUFFER,new Float32Array(o),l);
            var h = s._cpuMorph.getElements();
            for (n = 0; n < o; ++n)
                h[n] = 0;
            for (var d = this._targets, p = 0, f = d.length; p < f; ++p)
                if (a[p] !== !0) {
                    var g = d[p].value;
                    if (!(Math.abs(g) < c)) {
                        g /= i;
                        var m = t[e + "_" + p].getInitialBufferArray().getElements();
                        for (n = 0; n < u; ++n) {
                            var v = n * l;
                            h[v] += g * m[v],
                            h[v + 1] += g * m[v + 1],
                            h[v + 2] += g * m[v + 2]
                        }
                    }
                }
            t[e + "_3"].setBufferArray(s._cpuMorph),
            s._cpuMorph.dirty()
        },
        _computeExtraWeightsSum: function() {
            for (var t = this._gpuMorphed, e = 0, i = this._targets, n = 0, r = i.length; n < r; ++n)
                if (t[n] !== !0) {
                    var a = i[n].value;
                    Math.abs(a) < c || (e += a)
                }
            var s = 1e-5;
            return Math.abs(e) > s ? e : e < 0 ? -s : s
        },
        _morphBufferArrayCPU: function() {
            for (var t = this._weights[3] = this._computeExtraWeightsSum(), e = {}, i = this._morphs, n = 0, r = i.length; n < r; ++n)
                for (var a = i[n], s = a.getVertexAttributeList(), o = a.getMorphTargetNames(), u = 0, l = o.length; u < l; ++u) {
                    var c = o[u]
                      , h = s[c];
                    h && !e[h.getInstanceID()] && (e[h.getInstanceID()] = !0,
                    this._mergeExtraMorphTarget(s, c, t))
                }
        },
        updateWeights: function() {
            var t = 0
              , e = this._targets
              , i = e.length
              , n = this._weights;
            if (n[0] = n[1] = n[2] = n[3] = 0,
            i <= 4)
                for (t = 0; t < i; ++t)
                    n[t] = e[t].value;
            else {
                var r = this._indexMap;
                r[0] = r[1] = r[2] = r[3] = 0;
                var a = this._gpuMorphed;
                for (a.length = i,
                t = 0; t < i; ++t)
                    a[t] = !1;
                var s = e.slice(0).sort(h);
                for (t = 0; t < 4; ++t) {
                    var o = e.indexOf(s[t]);
                    a[o] = !0,
                    r[t] = o,
                    n[t] = s[t].value
                }
                var u = Math.abs(s[4].value) >= c;
                a[r[3]] = !u,
                this._remapBufferArrays(),
                u && this._morphBufferArrayCPU()
            }
        },
        update: function(t) {
            this.isInitialized() || this.init(t),
            this.updateWeights();
            for (var e = this._weights, i = Math.min(4, this._targets.length), n = this._morphs, r = 0, a = n.length; r < a; ++r)
                for (var s = n[r].getTargetsWeight(), o = 0; o < i; o++)
                    s[o] = e[o];
            return !0
        }
    }),
    t.exports = l
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        return -(t * (t - 2))
    }
      , n = function(t) {
        return t * t
    }
      , r = function(t) {
        return t -= 1,
        t * t * t + 1
    }
      , a = function(t) {
        return t * t * t
    }
      , s = function(t) {
        return t -= 1,
        -(t * t * t * t - 1)
    }
      , o = function(t) {
        return t * t * t * t
    }
      , u = function(t) {
        return Math.pow(2, -10 * t) * Math.sin((t - .075) * (2 * Math.PI) / .3) + 1
    }
      , l = function(t) {
        return t < 1 / 2.75 ? 7.5625 * t * t : t < 2 / 2.75 ? 7.5625 * (t -= 1.5 / 2.75) * t + .75 : t < 2.5 / 2.75 ? 7.5625 * (t -= 2.25 / 2.75) * t + .9375 : 7.5625 * (t -= 2.625 / 2.75) * t + .984375
    };
    t.exports = {
        easeOutQuad: i,
        easeInQuad: n,
        easeOutCubic: r,
        easeInCubic: a,
        easeOutQuart: s,
        easeInQuart: o,
        easeOutElastic: u,
        easeOutBounce: l,
        EaseOutQuad: i,
        EaseInQuad: n,
        EaseOutCubic: r,
        EaseInCubic: a,
        EaseOutQuart: s,
        EaseInQuart: o,
        EaseOutElastic: u,
        EaseOutBounce: l
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1210)
      , a = i(1212).mat4
      , s = i(1327)
      , o = function(t, e) {
        r.call(this),
        this._target = s.createMatrixTarget(e || a.IDENTITY),
        t && this.setName(t)
    };
    o.prototype = n.objectInherit(r.prototype, {
        init: function(t) {
            this.setMatrix(t),
            a.copy(this._target.defaultValue, t)
        },
        getTarget: function() {
            return this._target
        },
        getMatrix: function() {
            return this._target.value
        },
        setMatrix: function(t) {
            a.copy(this._target.value, t)
        },
        resetToDefaultValue: function() {
            this.setMatrix(this._target.defaultValue)
        },
        applyToMatrix: function(t) {
            a.mul(t, t, this._target.value)
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1210)
      , a = i(1212).mat4
      , s = i(1212).quat
      , o = i(1327)
      , u = s.create()
      , l = function(t, e) {
        r.call(this),
        this._target = o.createQuatTarget(e || u),
        t && this.setName(t)
    };
    l.prototype = n.objectInherit(r.prototype, {
        init: function(t) {
            this.setQuaternion(t),
            s.copy(this._target.defaultValue, t)
        },
        setQuaternion: function(t) {
            s.copy(this._target.value, t)
        },
        getTarget: function() {
            return this._target
        },
        resetToDefaultValue: function() {
            this.setQuaternion(this._target.defaultValue)
        },
        applyToMatrix: function() {
            var t = a.create();
            return function(e) {
                var i = t;
                a.fromQuat(i, this._target.value),
                a.mul(e, e, i)
            }
        }()
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1210)
      , a = i(1212).mat4
      , s = i(1212).vec3
      , o = i(1212).quat
      , u = i(1327)
      , l = function(t, e, i) {
        r.call(this),
        this._axis = s.fromValues(0, 0, 1),
        e && s.copy(this._axis, e),
        this._target = u.createFloatTarget("number" == typeof i ? i : 0),
        t && this.setName(t)
    };
    l.prototype = n.objectInherit(r.prototype, {
        init: function(t, e) {
            this.setAxis(t),
            this.setAngle(e),
            this._target.defaultValue = e
        },
        setAxis: function(t) {
            s.copy(this._axis, t)
        },
        setAngle: function(t) {
            this._target.value = t
        },
        getTarget: function() {
            return this._target
        },
        resetToDefaultValue: function() {
            this.setAngle(this._target.defaultValue)
        },
        applyToMatrix: function() {
            var t = a.create()
              , e = o.create();
            return function(i) {
                var n = this._axis
                  , r = e
                  , s = t
                  , u = this._target.value;
                o.setAxisAngle(r, n, u),
                a.fromQuat(s, r),
                a.mul(i, i, s)
            }
        }()
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1210)
      , a = i(1212).mat4
      , s = i(1212).vec3
      , o = i(1327)
      , u = function(t, e) {
        r.call(this),
        this._target = o.createVec3Target(e || s.ONE),
        t && this.setName(t)
    };
    u.prototype = n.objectInherit(r.prototype, {
        init: function(t) {
            this.setScale(t),
            s.copy(this._target.defaultValue, t)
        },
        setScale: function(t) {
            s.copy(this._target.value, t)
        },
        getTarget: function() {
            return this._target
        },
        resetToDefaultValue: function() {
            this.setScale(this._target.defaultValue)
        },
        applyToMatrix: function(t) {
            var e = this._target.value;
            a.scale(t, t, e)
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1210)
      , a = i(1212).vec3
      , s = i(1212).mat4
      , o = i(1327)
      , u = function(t, e) {
        r.call(this),
        this._target = o.createVec3Target(e || a.ZERO),
        t && this.setName(t)
    };
    u.prototype = n.objectInherit(r.prototype, {
        init: function(t) {
            this.setTranslate(t),
            a.copy(this._target.defaultValue, t)
        },
        setTranslate: function(t) {
            a.copy(this._target.value, t)
        },
        getTarget: function() {
            return this._target
        },
        resetToDefaultValue: function() {
            this.setTranslate(this._target.defaultValue)
        },
        applyToMatrix: function(t) {
            s.translate(t, t, this._target.value)
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1250)
      , a = i(1241)
      , s = i(1340)
      , o = i(1341)
      , u = i(1342)
      , l = i(1343)
      , c = i(1249)
      , h = {};
    h.Input = r,
    n.objectMix(h, a),
    h.DatabasePager = s,
    h.ObjectWrapper.serializers.osg = o,
    h.ObjectWrapper.serializers.osgAnimation = u,
    h.ObjectWrapper.serializers.osgText = l,
    h.Registry = c,
    h.requestFile = i(1251);
    var d = i(1253);
    n.objectMix(h, d),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(1203)
      , a = i(1229)
      , s = i(1275)
      , o = i(1206)
      , u = function() {
        this._pendingRequests = [],
        this._pendingNodes = [],
        this._loading = !1,
        this._progressCallback = void 0,
        this._lastCB = !0,
        this._activePagedLODList = new Set,
        this._childrenToRemoveList = new Set,
        this._downloadingRequestsNumber = 0,
        this._maxRequestsPerFrame = 10,
        this._acceptNewRequests = !0,
        this._targetMaximumNumberOfPagedLOD = 75
    }
      , l = function() {
        this._loadedModel = void 0,
        this._group = void 0,
        this._url = void 0,
        this._function = void 0,
        this._timeStamp = 0,
        this._groupExpired = !1,
        this._priority = 0
    }
      , c = function(t, e) {
        a.call(this, a.TRAVERSE_ALL_CHILDREN),
        this._activePagedLODList = t,
        this._frameNumber = e
    };
    c.prototype = r.objectInherit(a.prototype, {
        apply: function(t) {
            t.getTypeID() === s.getTypeID() && (t.setFrameNumberOfLastTraversal(this._frameNumber),
            this._activePagedLODList.add(t)),
            this.traverse(t)
        }
    });
    var h = function() {
        a.call(this, a.TRAVERSE_ALL_CHILDREN)
    };
    h.prototype = r.objectInherit(a.prototype, {
        apply: function(t) {
            t.releaseGLObjects(),
            this.traverse(t)
        }
    });
    var d = function() {
        a.call(this, a.TRAVERSE_ALL_CHILDREN),
        this._childrenList = []
    };
    d.prototype = r.objectInherit(a.prototype, {
        apply: function(t) {
            t.getTypeID() === s.getTypeID() && (this._childrenList.push(t),
            this._markRequestsExpired(t)),
            this.traverse(t)
        },
        removeExpiredChildrenAndFindPagedLODs: function(t, e, i, n) {
            if (!t.children.length)
                return !1;
            var r = n.length;
            t.removeExpiredChildren(e, i, n);
            for (var a = r; a < n.length; a++)
                n[a].accept(this);
            return r !== n.length
        },
        _markRequestsExpired: function(t) {
            for (var e, i = t._perRangeDataList.length, n = 0; n < i; n++)
                e = t.getDatabaseRequest(n),
                void 0 !== e && (e._groupExpired = !0,
                e._loadedModel = null)
        }
    }),
    u.prototype = r.objectLibraryClass({
        setTargetMaximumNumberOfPageLOD: function(t) {
            this._targetMaximumNumberOfPagedLOD = t
        },
        getTargetMaximumNumberOfPageLOD: function() {
            return this._targetMaximumNumberOfPagedLOD
        },
        setAcceptNewDatabaseRequests: function(t) {
            this._acceptNewRequests = t
        },
        getAcceptNewDatabaseRequests: function() {
            return this._acceptNewRequests
        },
        reset: function() {
            this._pendingRequests = [],
            this._pendingNodes = [],
            this._loading = !1,
            this._lastCB = !0,
            this._activePagedLODList.clear(),
            this._childrenToRemoveList.clear(),
            this._downloadingRequestsNumber = 0,
            this._maxRequestsPerFrame = 10,
            this._acceptNewRequests = !0,
            this._targetMaximumNumberOfPagedLOD = 75
        },
        updateSceneGraph: function(t) {
            void 0 !== this._progressCallback && this.executeProgressCallback(),
            this.removeExpiredSubgraphs(t, .0025),
            this.takeRequests(),
            this.addLoadedDataToSceneGraph(t, .005)
        },
        executeProgressCallback: function() {
            this._pendingRequests.length > 0 || this._pendingNodes.length > 0 ? (this._progressCallback(this._pendingRequests.length + this._downloadingRequestsNumber, this._pendingNodes.length),
            this._lastCB = !1) : this._lastCB || (this._progressCallback(this._pendingRequests.length + this._downloadingRequestsNumber, this._pendingNodes.length),
            this._lastCB = !0)
        },
        setMaxRequestsPerFrame: function(t) {
            this._maxRequestsPerFrame = t
        },
        getMaxRequestsPerFrame: function() {
            return this._maxRequestsPerFrame
        },
        getRequestListSize: function() {
            return this._pendingRequests.length + this._downloadingRequestsNumber
        },
        setProgressCallback: function(t) {
            this._progressCallback = t
        },
        addLoadedDataToSceneGraph: function(t, e) {
            if (e <= 0)
                return 0;
            var i = 0
              , n = o.instance().tick();
            this._pendingNodes.sort(function(t, e) {
                return e._timeStamp - t._timeStamp
            });
            for (var r = 0; r < this._pendingNodes.length; r++) {
                if (i > e)
                    return 0;
                var a = this._pendingNodes.shift()
                  , s = t.getFrameNumber()
                  , u = t.getSimulationTime();
                if (a._groupExpired === !1) {
                    var l = a._group;
                    l.setTimeStamp(l.children.length, u),
                    l.setFrameNumber(l.children.length, s),
                    l.addChildNode(a._loadedModel),
                    this._activePagedLODList.has(l) ? this.registerPagedLODs(a._loadedModel, s) : this.registerPagedLODs(l, s)
                } else
                    a._loadedModel = void 0,
                    a = void 0;
                i = o.instance().deltaS(n, o.instance().tick())
            }
            return e -= i
        },
        isLoading: function() {
            return this._loading
        },
        registerPagedLODs: function(t, e) {
            t && t.accept(new c(this._activePagedLODList,e))
        },
        requestNodeFile: function(t, e, i, n, r) {
            if (this._acceptNewRequests) {
                var a = new l;
                return a._group = i,
                a._function = t,
                a._url = e,
                a._timeStamp = n,
                a._priority = r,
                this._pendingRequests.push(a),
                a
            }
        },
        takeRequests: function() {
            if (this._pendingRequests.length) {
                var t = Math.min(this._maxRequestsPerFrame, this._pendingRequests.length);
                this._pendingRequests.sort(function(t, e) {
                    var i = t._timeStamp - e._timeStamp;
                    return 0 === i && (i = t._priority - e._priority),
                    i
                });
                for (var e = 0; e < t; e++)
                    this._downloadingRequestsNumber++,
                    this.processRequest(this._pendingRequests.shift())
            }
        },
        processRequest: function(t) {
            this._loading = !0;
            var e = this;
            return t._groupExpired ? (e._downloadingRequestsNumber--,
            void (this._loading = !1)) : void (void 0 !== t._function ? this.loadNodeFromFunction(t._function, t._group).then(function(i) {
                e._downloadingRequestsNumber--,
                t._loadedModel = i,
                e._pendingNodes.push(t),
                e._loading = !1
            }) : "" !== t._url && this.loadNodeFromURL(t._url).then(function(i) {
                e._downloadingRequestsNumber--,
                t._loadedModel = i,
                e._pendingNodes.push(t),
                e._loading = !1
            }))
        },
        loadNodeFromFunction: function(t, e) {
            var i = t(e);
            return i ? i && i.then ? i : n.resolve(i) : n.reject()
        },
        loadNodeFromURL: function(t) {
            var e = i(1241);
            return e.readNodeURL(t)
        },
        releaseGLExpiredSubgraphs: function(t) {
            if (t <= 0)
                return 0;
            var e = 0
              , i = o.instance().tick()
              , n = this;
            return this._childrenToRemoveList.forEach(function(r) {
                e > t || (n._childrenToRemoveList["delete"](r),
                r.accept(new h),
                r.removeChildren(),
                r = null,
                e = o.instance().deltaS(i, o.instance().tick()))
            }),
            t -= e
        },
        removeExpiredSubgraphs: function(t, e) {
            if (0 === t.getFrameNumber())
                return 0;
            var i = this._activePagedLODList.size - this._targetMaximumNumberOfPagedLOD
              , n = t.getSimulationTime() - .1
              , r = t.getFrameNumber() - 1;
            return i > 0 && (e = this.removeExpiredChildren(i, n, r, e)),
            e
        },
        removeExpiredChildren: function(t, e, i, n) {
            var r = 0
              , a = o.instance().tick()
              , s = this
              , u = []
              , l = new d;
            return this._activePagedLODList.forEach(function(c) {
                if (r > n)
                    return 0;
                if (t < 0)
                    return n;
                if (i < c.getFrameNumberOfLastTraversal())
                    return n;
                l.removeExpiredChildrenAndFindPagedLODs(c, e, i, u);
                for (var h = 0; h < l._childrenList.length; h++)
                    s._activePagedLODList["delete"](l._childrenList[h]),
                    t--;
                for (h = 0; h < u.length; h++)
                    s._childrenToRemoveList.add(u[h]);
                l._childrenList.length = 0,
                u.length = 0,
                r = o.instance().deltaS(a, o.instance().tick())
            }),
            n -= r
        }
    }, "osgDB", "DatabasePager"),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(1232)
      , a = {};
    a.Object = function(t, e) {
        var i = t.getJSON();
        if (i.Name && e.setName(i.Name),
        i.UserDataContainer) {
            var n = t.setJSON(i.UserDataContainer).readUserDataContainer();
            void 0 !== n && e.setUserData(n)
        }
        return e
    }
    ,
    a.Node = function(t, e) {
        var i = t.getJSON();
        a.Object(t, e);
        var r = [];
        if (i.UpdateCallbacks)
            for (var s = e.addUpdateCallback.bind(e), o = 0, u = i.UpdateCallbacks.length; o < u; o++) {
                var l = t.setJSON(i.UpdateCallbacks[o]).readObject();
                r.push(l),
                l.then(s)
            }
        if (i.StateSet) {
            var c = t.setJSON(i.StateSet).readObject();
            r.push(c),
            c.then(e.setStateSet.bind(e))
        }
        var h = [];
        if (i.Children)
            for (var d = 0, p = i.Children.length; d < p; d++)
                h.push(t.setJSON(i.Children[d]).readObject());
        return n.all(r).then(function() {
            return n.all(h).then(function(t) {
                for (var i = t.length, n = 0; n < i; n++)
                    e.addChild(t[n]);
                return e
            })
        })
    }
    ,
    a.StateSet = function(t, e) {
        var i = t.getJSON();
        a.Object(t, e),
        void 0 !== i.RenderingHint && e.setRenderingHint(i.RenderingHint);
        var r = []
          , s = function(i) {
            var n = t.setJSON(i).readObject();
            n.isRejected() || (r.push(n),
            n.then(e.setAttributeAndModes.bind(e)))
        };
        if (void 0 !== i.AttributeList)
            for (var o = 0, u = i.AttributeList.length; o < u; o++)
                s(i.AttributeList[o]);
        var l = function(i, n) {
            var a = t.setJSON(n).readObject();
            a.isRejected() || (r.push(a),
            a.then(e.setTextureAttributeAndModes.bind(e, i)))
        };
        if (i.TextureAttributeList)
            for (var c = i.TextureAttributeList, h = 0, d = c.length; h < d; h++)
                for (var p = c[h], f = 0, g = p.length; f < g; f++)
                    l(h, p[f]);
        return n.all(r).then(function() {
            return e
        })
    }
    ,
    a.Material = function(t, e) {
        var i = t.getJSON();
        return i.Diffuse && i.Emission && i.Specular && void 0 !== i.Shininess ? (a.Object(t, e),
        e.setAmbient(i.Ambient),
        e.setDiffuse(i.Diffuse),
        e.setEmission(i.Emission),
        e.setSpecular(i.Specular),
        e.setShininess(i.Shininess),
        n.resolve(e)) : n.reject()
    }
    ,
    a.BlendFunc = function(t, e) {
        var i = t.getJSON();
        return i.SourceRGB && i.SourceAlpha && i.DestinationRGB && i.DestinationAlpha ? (a.Object(t, e),
        e.setSourceRGB(i.SourceRGB),
        e.setSourceAlpha(i.SourceAlpha),
        e.setDestinationRGB(i.DestinationRGB),
        e.setDestinationAlpha(i.DestinationAlpha),
        n.resolve(e)) : n.reject()
    }
    ,
    a.CullFace = function(t, e) {
        var i = t.getJSON();
        return void 0 === i.Mode ? n.reject() : (a.Object(t, e),
        e.setMode(i.Mode),
        n.resolve(e))
    }
    ,
    a.BlendColor = function(t, e) {
        var i = t.getJSON();
        return i.ConstantColor ? (a.Object(t, e),
        e.setConstantColor(i.ConstantColor),
        n.resolve(e)) : n.reject()
    }
    ,
    a.Light = function(t, e) {
        var i = t.getJSON();
        return i.Ambient && i.Diffuse && i.Direction && i.Position && i.Specular && void 0 !== i.LightNum && void 0 !== i.SpotCutoff && void 0 !== i.LinearAttenuation && void 0 !== i.ConstantAttenuation && void 0 !== i.QuadraticAttenuation ? (a.Object(t, e),
        e.setAmbient(i.Ambient),
        e.setConstantAttenuation(i.ConstantAttenuation),
        e.setDiffuse(i.Diffuse),
        e.setDirection(i.Direction),
        e.setLightNumber(i.LightNum),
        e.setLinearAttenuation(i.LinearAttenuation),
        e.setPosition(i.Position),
        e.setQuadraticAttenuation(i.QuadraticAttenuation),
        e.setSpecular(i.Specular),
        e.setSpotCutoff(i.SpotCutoff),
        e.setSpotBlend(.01),
        void 0 !== i.SpotExponent && e.setSpotBlend(i.SpotExponent / 128),
        n.resolve(e)) : n.reject()
    }
    ,
    a.Texture = function(t, e) {
        var i = t.getJSON();
        a.Object(t, e),
        i.MinFilter && e.setMinFilter(i.MinFilter),
        i.MagFilter && e.setMagFilter(i.MagFilter),
        i.WrapT && e.setWrapT(i.WrapT),
        i.WrapS && e.setWrapS(i.WrapS);
        var n = i.File;
        return void 0 === n && (n = "no-image-provided"),
        t.readImageURL(n).then(function(t) {
            return e.setImage(t),
            e
        })
    }
    ,
    a.Projection = function(t, e) {
        var i = t.getJSON();
        if (!i.Matrix)
            return n.reject();
        var r = a.Node(t, e);
        return e.setMatrix(i.Matrix),
        r
    }
    ,
    a.MatrixTransform = function(t, e) {
        var i = t.getJSON();
        if (!i.Matrix)
            return n.reject();
        var r = a.Node(t, e);
        return e.setMatrix(i.Matrix),
        r
    }
    ,
    a.LightSource = function(t, e) {
        var i = t.getJSON();
        if (!i.Light)
            return n.reject();
        var s = a.Node(t, e);
        return n.all([t.setJSON(i.Light).readObject(), s]).then(function(t) {
            var n = t[0];
            return e.setLight(n),
            "ABSOLUTE_RF" === i.ReferenceFrame && e.setReferenceFrame(r.ABSOLUTE_RF),
            e
        })
    }
    ,
    a.functionSortAttributes = function(t, e) {
        return t.indexOf("TexCoord") !== -1 && e.indexOf("TexCoord") !== -1 ? parseInt(t.substr(8), 10) - parseInt(e.substr(8), 10) : t < e ? -1 : t > e ? 1 : 0
    }
    ,
    a.Geometry = function(t, e) {
        var i = t.getJSON();
        if (!i.VertexAttributeList)
            return n.reject();
        i.PrimitiveSetList = i.PrimitiveSetList || [];
        var r = [];
        r.push(a.Node(t, e));
        var s = e.getPrimitives()
          , o = s.push.bind(s)
          , u = 0
          , l = i.PrimitiveSetList.length;
        for (u = 0; u < l; u++) {
            var c = t.setJSON(i.PrimitiveSetList[u]).readPrimitiveSet();
            r.push(c),
            c.then(o)
        }
        var h = function(t, e) {
            this.getVertexAttributeList()[t] = e
        }
          , d = i.VertexAttributeList
          , p = window.Object.keys(d);
        for (p.sort(a.functionSortAttributes),
        l = p.length,
        u = 0; u < l; u++) {
            var f = p[u]
              , g = t.setJSON(d[f]).readBufferArray();
            r.push(g),
            g.then(h.bind(e, f))
        }
        return n.all(r).then(function() {
            return e
        })
    }
    ,
    a.PagedLOD = function(t, e) {
        var i = t.getJSON();
        a.Object(t, e),
        "USE_BOUNDING_SPHERE_CENTER" === i.CenterMode ? e.setCenterMode(0) : "UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED" === i.CenterMode && e.setCenterMode(2),
        e.setCenter([i.UserCenter[0], i.UserCenter[1], i.UserCenter[2]]),
        e.setRadius(i.UserCenter[3]),
        "PIXEL_SIZE_ON_SCREEN" === i.RangeMode && e.setRangeMode(1);
        for (var r, s = i.RangeList, o = 0; o < window.Object.keys(s).length; o++) {
            r = "Range " + o;
            var u = s[r];
            e.setRange(o, u[0], u[1])
        }
        for (s = i.RangeDataList,
        o = 0; o < window.Object.keys(s).length; o++)
            r = "File " + o,
            e.setFileName(o, s[r]);
        e.setDatabasePath(t.getDatabasePath());
        var l = [];
        if (i.Children)
            for (var c = 0, h = i.Children.length; c < h; c++)
                l.push(t.setJSON(i.Children[c]).readObject());
        return n.all(l).then(function(t) {
            var i = t.length;
            for (o = 0; o < i; o++)
                e.addChildNode(t[o]);
            return e
        })
    }
    ,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(1207)
      , a = i(1341)
      , s = i(1326)
      , o = i(1325)
      , u = i(1241)
      , l = i(1334)
      , c = i(1337)
      , h = i(1283)
      , d = i(1234)
      , p = {}
      , f = function() {}
      , g = u.registry();
    g.registerObject("osgAnimation.Vec3LerpChannel", f),
    g.registerObject("osgAnimation.FloatLerpChannel", f),
    g.registerObject("osgAnimation.QuatSlerpChannel", f),
    g.registerObject("osgAnimation.QuatLerpChannel", f),
    g.registerObject("osgAnimation.FloatCubicBezierChannel", f),
    g.registerObject("osgAnimation.Vec3CubicBezierChannel", f),
    g.registerObject("osgAnimation.StackedMatrixElement", l),
    g.registerObject("osgAnimation.StackedScaleElement", c),
    p.Animation = function(t) {
        var e = t.getJSON();
        if (void 0 === e.Name || !e.Channels || 0 === e.Channels.length)
            return n.reject();
        for (var i = [], r = 0, a = e.Channels.length; r < a; r++) {
            var s = t.setJSON(e.Channels[r]).readObject();
            i.push(s)
        }
        return n.all(i).then(function(t) {
            return o.createAnimation(t, e.Name)
        })
    }
    ,
    p.StandardVec3Channel = function(t, e, i) {
        var r = t.getJSON();
        if (!(void 0 !== r.TargetName && r.KeyFrames && r.Name && r.KeyFrames.Time && r.KeyFrames.Key && 3 === r.KeyFrames.Key.length))
            return n.reject();
        var a = t.setJSON(r.KeyFrames.Time).readBufferArray()
          , s = t.setJSON(r.KeyFrames.Key[0]).readBufferArray()
          , o = t.setJSON(r.KeyFrames.Key[1]).readBufferArray()
          , u = t.setJSON(r.KeyFrames.Key[2]).readBufferArray();
        return n.all([a, s, o, u]).then(function(t) {
            for (var n = t[0].getElements(), a = t[1].getElements(), s = t[2].getElements(), o = t[3].getElements(), u = n.length, l = new Float32Array(new ArrayBuffer(4 * (u + 1) * 3),0,3 * u), c = new Float32Array(new ArrayBuffer(4 * (u + 1)),0,u), h = 0; h < u; h++) {
                var d = 3 * h;
                c[h] = n[h],
                l[d++] = a[h],
                l[d++] = s[h],
                l[d] = o[h]
            }
            return i(l, c, r.TargetName, r.Name, e),
            e
        })
    }
    ,
    p.StandardQuatChannel = function(t, e, i) {
        var r = t.getJSON();
        if (!(void 0 !== r.TargetName && r.KeyFrames && r.Name && r.KeyFrames.Time && r.KeyFrames.Key && 4 === r.KeyFrames.Key.length))
            return n.reject();
        var a = t.setJSON(r.KeyFrames.Time).readBufferArray()
          , s = t.setJSON(r.KeyFrames.Key[0]).readBufferArray()
          , o = t.setJSON(r.KeyFrames.Key[1]).readBufferArray()
          , u = t.setJSON(r.KeyFrames.Key[2]).readBufferArray()
          , l = t.setJSON(r.KeyFrames.Key[3]).readBufferArray();
        return n.all([a, s, o, u, l]).then(function(t) {
            for (var n = t[0].getElements(), a = t[1].getElements(), s = t[2].getElements(), o = t[3].getElements(), u = t[4].getElements(), l = n.length, c = new Float32Array(new ArrayBuffer(4 * (l + 1) * 4),0,4 * l), h = new Float32Array(new ArrayBuffer(4 * (l + 1)),0,l), d = 0; d < l; d++) {
                var p = 4 * d;
                h[d] = n[d],
                c[p++] = a[d],
                c[p++] = s[d],
                c[p++] = o[d],
                c[p] = u[d]
            }
            return i(c, h, r.TargetName, r.Name, e),
            e
        })
    }
    ,
    p.StandardFloatChannel = function(t, e, i) {
        var r = t.getJSON();
        if (!(void 0 !== r.TargetName && r.KeyFrames && r.Name && r.KeyFrames.Time && r.KeyFrames.Key))
            return n.reject();
        var a = t.setJSON(r.KeyFrames.Time).readBufferArray()
          , s = t.setJSON(r.KeyFrames.Key).readBufferArray();
        return n.all([a, s]).then(function(t) {
            for (var n = t[0].getElements(), a = t[1].getElements(), s = n.length, o = new Float32Array(new ArrayBuffer(4 * (s + 1)),0,s), u = new Float32Array(new ArrayBuffer(4 * (s + 1)),0,s), l = 0; l < s; l++)
                u[l] = n[l],
                o[l] = a[l];
            return i(o, u, r.TargetName, r.Name, e),
            e
        })
    }
    ,
    p.Vec3LerpChannel = function(t, e) {
        return p.StandardVec3Channel(t, e, s.createVec3Channel)
    }
    ,
    p.QuatLerpChannel = function(t, e) {
        return p.StandardQuatChannel(t, e, s.createQuatChannel)
    }
    ,
    p.QuatSlerpChannel = function(t, e) {
        return p.StandardQuatChannel(t, e, s.createQuatChannel)
    }
    ,
    p.FloatLerpChannel = function(t, e) {
        return p.StandardFloatChannel(t, e, s.createFloatChannel)
    }
    ,
    p.FloatCubicBezierChannel = function(t, e) {
        var i = t.getJSON();
        if (!(void 0 !== i.TargetName && i.KeyFrames && i.Name && i.KeyFrames.Time && i.KeyFrames.Position && i.KeyFrames.ControlPointOut && i.KeyFrames.ControlPointIn))
            return n.reject();
        for (var r = [], a = window.Object.keys(i.KeyFrames), o = 0; o < a.length; o++)
            r.push(t.setJSON(i.KeyFrames[a[o]]).readBufferArray());
        return n.all(r).then(function(t) {
            for (var n = t[0].getElements(), r = t[1].getElements(), a = t[2].getElements(), o = t[3].getElements(), u = o.length, l = new Float32Array(new ArrayBuffer(4 * (u + 1) * 3),0,3 * u), c = new Float32Array(new ArrayBuffer(4 * (u + 1)),0,u), h = 0; h < u; h++) {
                var d = 3 * h;
                c[h] = o[h],
                l[d++] = a[h],
                l[d++] = n[h],
                l[d] = r[h]
            }
            return s.createFloatCubicBezierChannel(l, c, i.TargetName, i.Name, e),
            e
        })
    }
    ,
    p.Vec3CubicBezierChannel = function(t, e) {
        var i = t.getJSON();
        if (!(void 0 !== i.TargetName && i.KeyFrames && i.Name && i.KeyFrames.Time && i.KeyFrames.Position && i.KeyFrames.ControlPointOut && i.KeyFrames.ControlPointIn && 3 === i.KeyFrames.Position.length && 3 === i.KeyFrames.ControlPointIn.length && 3 === i.KeyFrames.ControlPointOut.length))
            return n.reject();
        for (var r = [], a = window.Object.keys(i.KeyFrames), o = 0; o < a.length; o++) {
            var u = a[o]
              , l = i.KeyFrames[u];
            "Time" !== u ? (r.push(t.setJSON(l[0]).readBufferArray()),
            r.push(t.setJSON(l[1]).readBufferArray()),
            r.push(t.setJSON(l[2]).readBufferArray())) : r.push(t.setJSON(l).readBufferArray())
        }
        return n.all(r).then(function(t) {
            for (var n = t[0].getElements(), r = t[1].getElements(), a = t[2].getElements(), o = t[3].getElements(), u = t[4].getElements(), l = t[5].getElements(), c = t[6].getElements(), h = t[7].getElements(), d = t[8].getElements(), p = t[9].getElements(), f = p.length, g = new Float32Array(new ArrayBuffer(4 * (f + 1) * 9),0,9 * f), m = new Float32Array(new ArrayBuffer(4 * (f + 1)),0,f), v = 0; v < f; v++) {
                var _ = 9 * v;
                m[v] = p[v],
                g[_++] = c[v],
                g[_++] = h[v],
                g[_++] = d[v],
                g[_++] = n[v],
                g[_++] = r[v],
                g[_++] = a[v],
                g[_++] = o[v],
                g[_++] = u[v],
                g[_] = l[v]
            }
            return s.createVec3CubicBezierChannel(g, m, i.TargetName, i.Name, e),
            e
        })
    }
    ,
    p.BasicAnimationManager = function(t, e) {
        var i = t.getJSON();
        if (!i.Animations)
            return n.reject();
        a.Object(t, e);
        for (var s = [], o = 0, u = i.Animations.length; o < u; o++) {
            var l = t.setJSON(i.Animations[o]).readObject();
            l.isRejected() ? r.warn("An Animation failed on the parsing!") : s.push(l)
        }
        return n.all(s).then(function(t) {
            return e.init(t),
            e
        })
    }
    ,
    p.UpdateMatrixTransform = function(t, e) {
        var i = t.getJSON();
        if (/*!jsonObj.Name ||*/
        !i.StackedTransforms)
            return n.reject();
        a.Object(t, e);
        for (var r = [], s = 0, o = i.StackedTransforms.length; s < o; s++)
            r.push(t.setJSON(i.StackedTransforms[s]).readObject());
        return n.all(r).then(function(t) {
            for (var i = e.getStackedTransforms(), n = 0, r = t.length; n < r; n++)
                i.push(t[n]);
            return e.computeChannels(),
            e
        })
    }
    ,
    p.StackedTranslate = function(t, e) {
        var i = t.getJSON();
        return i.Name && i.Translate ? (a.Object(t, e),
        e.init(i.Translate),
        n.resolve(e)) : n.reject()
    }
    ,
    p.StackedQuaternion = function(t, e) {
        var i = t.getJSON();
        return i.Name && i.Quaternion ? (a.Object(t, e),
        e.init(i.Quaternion),
        n.resolve(e)) : n.reject()
    }
    ,
    p.StackedRotateAxis = function(t, e) {
        var i = t.getJSON();
        return i.Axis && void 0 !== i.Angle ? (a.Object(t, e),
        e.init(i.Axis, i.Angle),
        n.resolve(e)) : n.reject()
    }
    ,
    p.StackedMatrix = function(t, e) {
        var i = t.getJSON();
        return i.Name && i.Matrix ? (a.Object(t, e),
        e.init(i.Matrix),
        n.resolve(e)) : n.reject()
    }
    ,
    p.StackedScale = function(t, e) {
        var i = t.getJSON();
        return i.Name && i.Scale ? (a.Object(t, e),
        e.init(i.Scale),
        n.resolve(e)) : n.reject()
    }
    ,
    p.Bone = function(t, e) {
        var i = t.getJSON();
        if (!i.InvBindMatrixInSkeletonSpace)
            return n.reject();
        var r = a.MatrixTransform(t, e);
        if (e.setInvBindMatrixInSkeletonSpace(i.InvBindMatrixInSkeletonSpace),
        i.BoundingBox) {
            var s = e.getBoneBoundingBox();
            s.setMax(i.BoundingBox.max),
            s.setMin(i.BoundingBox.min)
        }
        return r
    }
    ,
    p.UpdateBone = p.UpdateMatrixTransform,
    p.UpdateSkeleton = function(t, e) {
        return a.Object(t, e),
        n.resolve(e)
    }
    ,
    p.Skeleton = a.MatrixTransform,
    p.RigGeometry = function(t, e) {
        var i = t.getJSON();
        if (!i.SourceGeometry)
            return n.reject();
        i.BoneMap || r.warn("No boneMap found in a RigGeometry !");
        var s = a.Geometry(t, e);
        e._boneNameID = i.BoneMap;
        var o, u = i.SourceGeometry["osg.Geometry"];
        return u ? (t.setJSON(u),
        e.setSourceGeometry(new d),
        o = a.Geometry(t, e.getSourceGeometry())) : (u = i.SourceGeometry["osgAnimation.MorphGeometry"],
        u ? (t.setJSON(u),
        e.setSourceGeometry(new h),
        o = p.MorphGeometry(t, e.getSourceGeometry())) : r.warn("SourceGeometry type no recognized")),
        void 0 === e._uniqueID && (e._uniqueID = u.UniqueID),
        n.all([s, o]).then(function() {
            return e.mergeChildrenData(),
            e
        })
    }
    ,
    p.MorphGeometry = function(t, e) {
        var i = t.getJSON();
        if (!i.MorphTargets)
            return n.reject();
        var r = i.MorphTargets
          , s = [];
        s.push(a.Geometry(t, e));
        for (var o = 0, u = r.length; o < u; o++)
            s.push(t.setJSON(r[o]).readObject());
        return n.all(s).then(function(t) {
            for (var e = t[0], i = e.getMorphTargets(), n = 1, r = t.length; n < r; n++)
                i.push(t[n]);
            return e.mergeChildrenVertexAttributeList(),
            e
        })
    }
    ,
    p.UpdateMorph = function(t, e) {
        var i = t.getJSON();
        if (!i.TargetMap)
            return n.reject();
        a.Object(t, e);
        for (var r = window.Object.keys(i.TargetMap), s = 0, o = r.length; s < o; s++) {
            var u = r[s];
            e.addTarget(i.TargetMap[u], parseInt(u, 10))
        }
        return n.resolve(e)
    }
    ,
    p.StackedMatrixElement = p.StackedMatrix,
    p.StackedScaleElement = p.StackedScale,
    t.exports = p
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(1341)
      , a = i(1207)
      , s = i(1344)
      , o = {};
    o.Text = function(t, e) {
        var i = t.getJSON();
        if (!i.Text)
            return n.reject();
        var o = r.Node(t, e);
        if (e.setColor(i.Color),
        e.setText(i.Text),
        e.setAutoRotateToScreen(i.AutoRotateToScreen),
        e.setPosition(i.Position),
        e.setCharacterSize(i.CharacterSize),
        "VERTICAL" === i.Layout)
            return a.error("Vertical Alignment not supported"),
            n.reject();
        var u = i.Alignment;
        return i.Alignment.indexOf("BASE_LINE") > -1 && ("LEFT_BASE_LINE" === i.Alignment ? u = s.LEFT_CENTER : "CENTER_BASE_LINE" === i.Alignment ? u = s.CENTER_CENTER : "RIGHT_BASE_LINE" === i.Alignment ? u = s.RIGHT_CENTER : "LEFT_BOTTOM_BASE_LINE" === i.Alignment ? u = s.LEFT_BOTTOM : "CENTER_BOTTOM_BASE_LINE" === i.Alignment ? u = s.CENTER_BOTTOM : "RIGHT_BOTTOM_BASE_LINE" === i.Alignment && (u = s.RIGHT_BOTTOM)),
        e.setAlignment(u),
        e.setLayout(i.Layout),
        o
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1212).vec3
      , a = i(1212).vec4
      , s = i(1212).mat4
      , o = i(1202)
      , u = i(1247)
      , l = i(1312)
      , c = i(1237)
      , h = i(1242)
      , d = i(1212).quat
      , p = i(1229)
      , f = i(1209)
      , g = function(t) {
        o.call(this),
        this._canvas = document.createElement("canvas"),
        this._context = this._canvas.getContext("2d"),
        this._matrixTransform = new u,
        this.addChild(this._matrixTransform),
        this._text = "",
        void 0 !== t && (this._text = t),
        this._font = "monospace",
        this._color = a.fromValues(0, 0, 0, 1),
        this._fillStyle = "rgba( 0, 0, 0, 1 )",
        this._context.textAlign = "center",
        this._textX = void 0,
        this._context.baseLine = "middle",
        this._textY = void 0,
        this._characterSize = 1,
        this._characterSizeMode = g.OBJECT_COORDS,
        this._fontSize = 32,
        this._geometry = void 0,
        this._autoRotateToScreen = !1,
        this._position = r.create(),
        this._layout = g.LEFT_TO_RIGHT,
        this._alignment = g.CENTER_CENTER,
        this._forcePowerOfTwo = !1,
        this._texture = new c,
        this.drawText(),
        this._dirty = !1,
        this._previousModelView = s.create()
    };
    g.OBJECT_COORDS = 0,
    g.SCREEN_COORDS = 1,
    g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT = 2,
    g.LEFT_TO_RIGHT = "ltr",
    g.RIGHT_TO_LEFT = "rtl",
    g.LEFT_TOP = 0,
    g.LEFT_CENTER = 1,
    g.LEFT_BOTTOM = 2,
    g.CENTER_TOP = 3,
    g.CENTER_CENTER = 4,
    g.CENTER_BOTTOM = 5,
    g.RIGHT_TOP = 6,
    g.RIGHT_CENTER = 7,
    g.RIGHT_BOTTOM = 8,
    g.prototype = n.objectLibraryClass(n.objectInherit(o.prototype, {
        drawText: function() {
            if (void 0 !== this._geometry && (this._matrixTransform.removeChild(this._geometry),
            this._geometry.releaseGLObjects()),
            this._text) {
                this.setTextProperties(),
                this._canvas.width = this._context.measureText(this._text).width,
                this._canvas.height = 2 * this._fontSize,
                this._forcePowerOfTwo && (this._canvas.width = this._nextPowerOfTwo(this._canvas.width),
                this._canvas.height = this._nextPowerOfTwo(this._canvas.height)),
                this.setTextProperties(),
                this._context.clearRect(0, 0, this._canvas.width, this._canvas.height),
                this._context.fillText(this._text, this._textX, this._textY);
                var t = this._canvas.width / this._canvas.height
                  , e = this._characterSize * t;
                this._geometry = l.createTexturedQuadGeometry(-e / 2, -this._characterSize / 2, 0, e, 0, 0, 0, this._characterSize, 0),
                this._texture.setTextureSize(this._canvas.width, this._canvas.height),
                this._texture.setMinFilter("LINEAR"),
                this._texture.setMagFilter("LINEAR"),
                this._texture.setImage(this._canvas);
                var i = this._geometry.getOrCreateStateSet();
                i.setTextureAttributeAndModes(0, this._texture),
                i.setRenderingHint("TRANSPARENT_BIN"),
                i.setAttributeAndModes(new h(h.ONE,h.ONE_MINUS_SRC_ALPHA)),
                this._matrixTransform.addChild(this._geometry),
                this.dirtyBound()
            }
        },
        setText: function(t) {
            this._text = t,
            this._dirty = !0
        },
        getText: function() {
            return this._text
        },
        setFont: function(t) {
            this._font = t,
            this._dirty = !0
        },
        setColor: function(t) {
            this._color = t,
            this._fillStyle = "rgba(" + Math.round(255 * t[0]) + "," + Math.round(255 * t[1]) + "," + Math.round(255 * t[2]) + "," + t[3] + ")",
            this._context.fillStyle = this._fillStyle,
            this._context.fillText(this._text, this._textX, this._textY)
        },
        getColor: function() {
            return this._color
        },
        setCharacterSize: function(t) {
            this._characterSize = t,
            this._characterSizeMode !== g.OBJECT_COORDS && (s.fromScaling(this._matrixTransform.getMatrix(), [this._characterSize, this._characterSize, this._characterSize]),
            this._characterSizeMode === g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT && this.setMaximumScale(this._characterSize)),
            this._dirty = !0
        },
        getCharacterSize: function() {
            return this._characterSize
        },
        setCharacterSizeMode: function(t) {
            this._characterSizeMode = t,
            this._characterSizeMode !== g.OBJECT_COORDS ? (s.fromScaling(this._matrixTransform.getMatrix(), [this._characterSize, this._characterSize, this._characterSize]),
            this.setAutoScaleToScreen(!0),
            this.setMaximumScale(Number.MAX_VALUE),
            this._characterSizeMode === g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT && this.setMaximumScale(this._characterSize)) : (this._matrixTransform.setMatrix(s.create()),
            this.setAutoScaleToScreen(!1)),
            this._dirty = !0
        },
        getCharacterSizeMode: function() {
            return this._characterSizeMode
        },
        setFontResolution: function(t) {
            this._fontSize = t,
            this._dirty = !0
        },
        getFontResolution: function() {
            return this._fontSize
        },
        setPosition: function(t) {
            this._position = t,
            s.fromTranslation(this.getMatrix(), t)
        },
        getPosition: function() {
            return this._position
        },
        setTextProperties: function() {
            this._context.fillStyle = this._fillStyle,
            this._setAlignmentValues(this._alignment),
            this._context.font = this._fontSize + "px " + this._font,
            this._context.direction = this._layout
        },
        setAutoRotateToScreen: function(t) {
            o.prototype.setAutoRotateToScreen.call(this, t),
            this._dirty = !0
        },
        getAutoRotateToScreen: function() {
            return this._autoRotateToScreen
        },
        setLayout: function(t) {
            "string" == typeof t ? this._layout = g[t] : this._layout = t,
            this._dirty = !0
        },
        getLayout: function() {
            return this._layout
        },
        setAlignment: function(t) {
            "string" == typeof t ? this._alignment = g[t] : this._alignment = t,
            this._dirty = !0
        },
        getAlignment: function() {
            return this._alignment
        },
        accept: function() {
            return function(t) {
                if (this._dirty && (this.drawText(),
                this._dirty = !1),
                t.getVisitorType() === p.CULL_VISITOR) {
                    var e = t.getViewport().width()
                      , i = t.getViewport().height()
                      , n = t.getCurrentProjectionMatrix()
                      , o = t.getCurrentModelViewMatrix()
                      , u = this._position
                      , l = this._firstTimeToInitEyePoint;
                    if (this._firstTimeToInitEyePoint || (s.exactEquals(o, this._previousModelView) ? e !== this._previousWidth || i !== this._previousHeight ? l = !0 : s.exactEquals(n, this._previousProjection) ? r.exactEquals(u, this._previousPosition) || (l = !0) : l = !0 : l = !0),
                    this._firstTimeToInitEyePoint = !1,
                    l) {
                        if (this._autoScaleToScreen) {
                            var c = t.getViewport()
                              , h = this.computePixelSizeVector(c, n, o)
                              , g = a.fromValues(this._position[0], this._position[1], this._position[2], 1)
                              , m = a.dot(g, h);
                            m = .48 / m;
                            var v = 1 / m;
                            if (this._autoScaleTransitionWidthRatio > 0) {
                                var _, b, x;
                                if (this._minimumScale > 0) {
                                    var A = this._minimumScale
                                      , y = this._maximumScale < Number.MAX_VALUE ? this._minimumScale + (this._maximumScale - this._minimumScale) * this._autoScaleTransitionWidthRatio : this._minimumScale * (1 + this._autoScaleTransitionWidthRatio);
                                    _ = 1 / (4 * (y - A)),
                                    b = 1 - 2 * _ * y,
                                    x = A + b * b / (4 * _);
                                    var S = -b / (2 * _);
                                    v < S ? v = this._minimumScale : v < y && (v = x + b * v + _ * (v * v))
                                }
                                if (this._maximumScale < Number.MAX_VALUE) {
                                    var C = this._maximumScale
                                      , M = this._minimumScale > 0 ? this._maximumScale + (this._minimumScale - this._maximumScale) * this._autoScaleTransitionWidthRatio : this._maximumScale * (1 - this._autoScaleTransitionWidthRatio);
                                    _ = 1 / (4 * (M - C)),
                                    b = 1 - 2 * _ * M,
                                    x = C + b * b / (4 * _);
                                    var w = -b / (2 * _);
                                    v > w ? v = this._maximumScale : v > M && (v = x + b * v + _ * (v * v))
                                }
                            }
                            this.setScale(v)
                        }
                        if (this._autoRotateToScreen) {
                            var T = d.create()
                              , E = t.getCurrentModelViewMatrix();
                            s.getRotation(T, E),
                            this.setRotation(d.invert(T, T))
                        }
                        this._previousWidth = e,
                        this._previousHeight = i,
                        r.copy(this._previousPosition, u),
                        s.copy(this._previousProjection, n),
                        s.copy(this._previousModelView, o)
                    }
                }
                f.prototype.accept.call(this, t)
            }
        }(),
        _setAlignmentValues: function(t) {
            switch (t) {
            case g.LEFT_TOP:
                this._context.textAlign = "left",
                this._textX = 0,
                this._context.textBaseline = "top",
                this._textY = 0;
                break;
            case g.LEFT_CENTER:
                this._context.textAlign = "left",
                this._textX = 0,
                this._context.textBaseline = "middle",
                this._textY = this._canvas.height / 2;
                break;
            case g.LEFT_BOTTOM:
                this._context.textAlign = "left",
                this._textX = 0,
                this._context.textBaseline = "bottom",
                this._textY = this._canvas.height;
                break;
            case g.CENTER_TOP:
                this._context.textAlign = "center",
                this._textX = this._canvas.width / 2,
                this._context.textBaseline = "top",
                this._textY = 0;
                break;
            case g.CENTER_CENTER:
                this._context.textAlign = "center",
                this._textX = this._canvas.width / 2,
                this._context.textBaseline = "middle",
                this._textY = this._canvas.height / 2;
                break;
            case g.CENTER_BOTTOM:
                this._context.textAlign = "center",
                this._textX = this._canvas.width / 2,
                this._context.textBaseline = "bottom",
                this._textY = this._canvas.height;
                break;
            case g.RIGHT_TOP:
                this._context.textAlign = "right",
                this._textX = this._canvas.width,
                this._context.textBaseline = "top",
                this._textY = 0;
                break;
            case g.RIGHT_CENTER:
                this._context.textAlign = "right",
                this._textX = this._canvas.width,
                this._context.textBaseline = "middle",
                this._textY = this._canvas.height / 2;
                break;
            case g.RIGHT_BOTTOM:
                this._context.textAlign = "right",
                this._textX = this._canvas.width,
                this._context.textBaseline = "bottom",
                this._textY = this._canvas.height
            }
        },
        setForcePowerOfTwo: function(t) {
            this._forcePowerOfTwo = t
        },
        getForcePowerOfTwo: function() {
            return this._forcePowerOfTwo
        },
        _nextPowerOfTwo: function(t) {
            var e = t;
            return e--,
            e |= e >> 1,
            e |= e >> 2,
            e |= e >> 4,
            e |= e >> 8,
            e |= e >> 16,
            e++,
            e
        }
    }), "osgText", "Text"),
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(283)
      , r = i(1346)
      , a = i(1361)
      , s = i(1362)
      , o = i(1363)
      , u = i(1350)
      , l = i(1364)
      , c = i(1366)
      , h = i(1365)
      , d = i(1347)
      , p = i(1348)
      , f = i(1349)
      , g = i(1351)
      , m = i(1352)
      , v = i(1353)
      , _ = i(1354)
      , b = i(1356)
      , x = i(1367)
      , A = i(1355)
      , y = {};
    n.NO_MOUSEEVENTS = !0,
    y.CADManipulator = r,
    y.getCADManipulatorStandardMouseKeyboardController = function() {
        return a
    }
    ,
    y.getCADManipulatorHammerController = function() {
        return s
    }
    ,
    y.FirstPersonManipulator = o,
    y.getFirstPersonDeviceOrientationController = function() {
        return u
    }
    ,
    y.getFirstPersonManipulatorHammerController = function() {
        return l
    }
    ,
    y.getFirstPersonStandardMouseKeyboardControllerClass = function() {
        return c
    }
    ,
    y.getFirstPersonWebVRControllerClass = function() {
        return h
    }
    ,
    y.Manipulator = d,
    y.OrbitManipulator = p,
    y.getOrbitManipulatorDeviceOrientationController = function() {
        return f
    }
    ,
    y.getOrbitManipulatorGamePadController = function() {
        return g
    }
    ,
    y.getOrbitManipulatorHammerController = function() {
        return m
    }
    ,
    y.getOrbitManipulatorLeapMotionController = function() {
        return v
    }
    ,
    y.getOrbitManipulatorStandardMouseKeyboardController = function() {
        return _
    }
    ,
    y.getOrbitManipulatorWebVRController = function() {
        return b
    }
    ,
    y.SwitchManipulator = x,
    y.OrbitManipulator.Rotate = A.ROTATE,
    y.OrbitManipulator.Pan = A.PAN,
    y.OrbitManipulator.Zoom = A.ZOOM,
    t.exports = y
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1347)
      , a = i(1348)
      , s = i(1357)
      , o = i(1358)
      , u = i(1359)
      , l = i(1231)
      , c = i(1212).mat4
      , h = i(1212).vec2
      , d = i(1212).vec3
      , p = i(1212).quat
      , f = i(1361)
      , g = i(1362)
      , m = function() {
        r.call(this),
        this._tmpHomePosition = d.create(),
        this._intersectionVisitor = new s,
        this._lineSegmentIntersector = new o,
        this._polytopeIntersector = void 0,
        this._usePolytopeIntersector = !1,
        this._dimensionMask = 4,
        this.init()
    };
    m.Interpolator = function() {
        this._current = h.create(),
        this._target = h.create(),
        this._delta = h.create(),
        this._reset = !1,
        this.reset(),
        this._width = void 0,
        this._height = void 0
    }
    ,
    m.Interpolator.prototype = {
        setWidth: function(t) {
            this._width = t
        },
        setHeight: function(t) {
            this._height = t
        },
        reset: function() {
            for (var t = 0, e = this._current.length; t < e; t++)
                this._current[t] = this._target[t] = 0;
            this._reset = !0
        },
        update: function() {
            var t, e;
            return t = void 0 === this._width ? 0 : (this._target[0] - this._current[0]) / this._width,
            this._delta[0] = t,
            this._current[0] = this._target[0],
            e = void 0 === this._height ? 0 : (this._target[1] - this._current[1]) / this._height,
            this._delta[1] = e,
            this._current[1] = this._target[1],
            this._delta
        },
        set: function() {
            for (var t = 0, e = this._current.length; t < e; t++)
                this._current[t] = this._target[t] = arguments[t];
            this._reset = !1
        },
        isReset: function() {
            return this._reset
        },
        getCurrent: function() {
            return this._current
        },
        setTarget: function() {
            for (var t = 0, e = this._target.length; t < e; t++)
                this._reset ? this._target[t] = this._current[t] = arguments[t] : this._target[t] = arguments[t];
            this._reset = !1
        },
        addTarget: function() {
            for (var t = 0; t < arguments.length; t++)
                this._target[t] += arguments[t]
        },
        getTarget: function() {
            return this._target
        },
        getDelta: function() {
            return this._delta
        }
    },
    m.AvailableControllerList = ["StandardMouseKeyboard", "Hammer"],
    m.ControllerList = ["StandardMouseKeyboard", "Hammer"],
    m.prototype = n.objectInherit(r.prototype, {
        init: function() {
            this._distance = 25,
            this._target = d.create(),
            this._upz = d.fromValues(0, 0, 1),
            this._right = d.fromValues(1, 0, 0),
            d.init(this._target);
            var t = c.fromRotation(c.create(), -Math.PI, this._upz)
              , e = c.fromRotation(c.create(), Math.PI / 10, this._right);
            this._rotation = c.create(),
            c.mul(this._rotation, t, e),
            this._time = 0,
            this._rotate = new m.Interpolator,
            this._pan = new m.Interpolator,
            this._zoom = new a.Interpolator(1),
            this._panFactor = 1.5,
            this._rotateFactor = 1,
            this._zoomFactor = 1,
            this._inverseMatrix = c.create(),
            this._homeEye = void 0,
            this._homeCenter = void 0,
            this._homeUp = d.fromValues(0, 0, 1),
            this._orientation = p.create(),
            this._pivotPoint = d.create(),
            this._eye = void 0,
            this._zoomDir = d.create();
            var i = this;
            m.ControllerList.forEach(function(t) {
                void 0 !== m[t] && (i._controllerList[t] = new m[t](i))
            })
        },
        setViewer: function(t) {
            this._viewer = t
        },
        reset: function() {
            this.init()
        },
        setNode: function(t) {
            this._node = t
        },
        setPivotPoint: function(t) {
            d.copy(this._pivotPoint, t)
        },
        setTarget: function() {
            var t = d.create();
            return function(e) {
                d.copy(this._target, e),
                this.getEyePosition(t),
                this._distance = d.distance(e, t)
            }
        }(),
        setEyePosition: function(t) {
            d.copy(this._eye, t),
            this._distance = d.distance(this._target, t)
        },
        setHomePosition: function(t, e, i) {
            this._homeEye = t,
            this._homeCenter = e,
            this._homeUp = i
        },
        computeHomePosition: function() {
            var t = d.create()
              , e = d.create()
              , i = d.create()
              , n = c.create();
            return function(r) {
                var a = this.getHomeBound(r);
                if (a) {
                    this.setDistance(this.getHomeDistance(a)),
                    this.setTarget(a.center()),
                    this.setPivotPoint(a.center()),
                    void 0 === this._homeEye && (this._homeEye = d.create(),
                    this.getEyePosition(this._homeEye)),
                    void 0 === this._homeCenter && (this._homeCenter = d.create(),
                    d.copy(this._homeCenter, a.center())),
                    void 0 === this._eye && (this._eye = d.create()),
                    d.copy(this._eye, this._homeEye),
                    d.copy(this._target, this._homeCenter),
                    d.copy(this._upz, this._homeUp),
                    c.copy(n, this._rotation);
                    var s = this._target
                      , o = this._eye;
                    d.sub(t, s, o),
                    d.normalize(t, t),
                    d.cross(e, t, this._upz),
                    d.normalize(e, e),
                    d.cross(i, e, t),
                    d.normalize(i, i),
                    n[0] = e[0],
                    n[1] = i[0],
                    n[2] = -t[0],
                    n[3] = 0,
                    n[4] = e[1],
                    n[5] = i[1],
                    n[6] = -t[1],
                    n[7] = 0,
                    n[8] = e[2],
                    n[9] = i[2],
                    n[10] = -t[2],
                    n[11] = 0,
                    n[12] = 0,
                    n[13] = 0,
                    n[14] = 0,
                    n[15] = 1,
                    c.getRotation(this._orientation, n),
                    p.invert(this._orientation, this._orientation)
                }
            }
        }(),
        setZoomFactor: function(t) {
            this._zoomFactor = t
        },
        setRotateFactor: function(t) {
            this._rotateFactor = t
        },
        setPanFactor: function(t) {
            this._panFactor = t
        },
        setDistance: function(t) {
            this._distance = t
        },
        setUsePolytopeIntersector: function(t) {
            this._usePolytopeIntersector = t
        },
        getUsePolytopeIntersector: function() {
            return this._usePolytopeIntersector
        },
        getDistance: function() {
            return this._distance
        },
        zoom: function(t) {
            this._distance = t
        },
        getRotateInterpolator: function() {
            return this._rotate
        },
        getPanInterpolator: function() {
            return this._pan
        },
        getZoomInterpolator: function() {
            return this._zoom
        },
        getIntersectionVisitor: function() {
            return this._intersectionVisitor
        },
        getLineSegmentIntersector: function() {
            return this._lineSegmentIntersector
        },
        getOrCreatePolytopeIntersector: function() {
            return void 0 === this._polytopeIntersector && (this._polytopeIntersector = new u,
            this._polytopeIntersector.setIntersectionLimit(u.LIMIT_ONE_PER_DRAWABLE),
            this._polytopeIntersector.setDimensionMask(u.DimZero | u.DimOne)),
            this._polytopeIntersector
        },
        getTarget: function(t) {
            return d.copy(t, this._target),
            t
        },
        getEyePosition: function(t) {
            void 0 === this._eye ? this.computeEyePosition(this._target, this._distance, t) : d.copy(t, this._eye)
        },
        computeEyePosition: function() {
            var t = d.create()
              , e = c.create();
            return function(i, n, r) {
                c.invert(e, this._rotation),
                t[1] = n,
                d.transformMat4(r, t, e),
                d.add(r, i, r)
            }
        }(),
        computePan: function() {
            var t = d.create()
              , e = d.create()
              , i = d.create();
            return function(n, r, a) {
                var s = d.length(d.sub(i, this._eye, this._pivotPoint)) / this._panFactor;
                s < 10 && (s = 10),
                t[0] = n * s / 2,
                t[1] = r * s / 2,
                t[2] = 0,
                d.transformMat4(e, t, a),
                d.add(this._eye, this._eye, e)
            }
        }(),
        computeZoom: function() {
            var t = d.create()
              , e = d.create();
            return function(i) {
                var n = i * this._zoomFactor;
                d.sub(t, this._pivotPoint, this._eye),
                d.add(this._eye, this._eye, d.scale(e, t, n))
            }
        }(),
        computeRotation: function() {
            var t = d.create()
              , e = d.create()
              , i = d.create()
              , n = d.create()
              , r = p.create()
              , a = p.create()
              , s = p.create()
              , o = d.create()
              , u = d.create();
            return function(l, c) {
                d.transformQuat(e, this._right, this._orientation),
                d.normalize(t, e),
                d.sub(i, this._eye, this._pivotPoint);
                var h = d.dot(t, i);
                d.sub(n, i, d.scale(u, t, h));
                var f = d.fromValues(-n[0], -n[1], 0)
                  , g = Math.atan2(-n[2], d.length(f));
                c = Math.max(-Math.PI / 2 + .01, Math.min(Math.PI / 2 - .01, g + c)) - g,
                p.setAxisAngle(r, e, c * this._rotateFactor),
                p.setAxisAngle(a, this._upz, l * this._rotateFactor),
                p.mul(s, a, r),
                d.transformQuat(o, i, s),
                d.add(this._eye, o, this._pivotPoint),
                p.mul(this._orientation, a, this._orientation),
                d.transformQuat(e, this._right, this._orientation),
                p.setAxisAngle(r, e, c * this._rotateFactor),
                p.mul(this._orientation, r, this._orientation)
            }
        }(),
        update: function() {
            var t = c.create()
              , e = c.create();
            return function(i) {
                var n = i.getFrameStamp().getDeltaTime()
                  , r = 10
                  , a = this._rotate.update();
                this.computeRotation(-a[0] * r, a[1] * r),
                c.fromQuat(t, this._orientation);
                var s = this._pan.update();
                this.computePan(-s[0] * r, -s[1] * r, t),
                a = this._zoom.update(n),
                this.computeZoom(-a[0] / 10),
                c.fromTranslation(e, this._eye),
                c.mul(this._inverseMatrix, e, t),
                c.invert(this._inverseMatrix, this._inverseMatrix)
            }
        }(),
        getInverseMatrix: function() {
            return this._inverseMatrix
        },
        computeIntersections: function() {
            var t = []
              , e = d.create();
            return function(i) {
                var n = this._camera.getView()
                  , r = this._camera
                  , a = r.getViewport().width()
                  , s = r.getViewport().height();
                this._rotate.setWidth(a),
                this._rotate.setHeight(s),
                this._pan.setWidth(a),
                this._pan.setHeight(s);
                var o, u;
                if (0 !== (4 & this._dimensionMask) && (t = n.computeIntersections(i[0], i[1]),
                t.length > 0 && (o = t[0].point,
                t[0].nodepath.shift(),
                u = l.computeLocalToWorld(t[0].nodepath),
                d.transformMat4(e, o, u),
                this.setPivotPoint(e))),
                0 === t.length && this._usePolytopeIntersector) {
                    var c = this.getOrCreatePolytopeIntersector();
                    c.reset(),
                    c.setPolytopeFromWindowCoordinates(i[0] - 5, i[1] - 5, i[0] + 5, i[1] + 5);
                    var h = this._intersectionVisitor;
                    h.setIntersector(c),
                    n.getCamera().accept(h),
                    t = c.getIntersections(),
                    t.sort(function(t, e) {
                        return t._distance - e._distance
                    }),
                    t.length > 0 && (o = t[0]._center,
                    t[0].nodePath.shift(),
                    u = l.computeLocalToWorld(t[0].nodePath),
                    d.transformMat4(e, o, u),
                    this.setPivotPoint(e))
                }
            }
        }(),
        getPositionRelativeToCanvas: function() {
            var t = h.create()
              , e = h.create();
            return function(i, n) {
                var r = this._camera._graphicContext.canvas;
                this.getOffsetRect(r, t);
                var a = r.width / r.clientWidth
                  , s = r.height / r.clientHeight;
                return e[0] = (i - t[1]) * a,
                e[1] = (r.clientHeight - (n - t[0])) * s,
                e
            }
        }(),
        getCanvasCenter: function() {
            var t = h.create()
              , e = h.create();
            return function() {
                var i = this._camera.getGraphicContext().canvas;
                this.getOffsetRect(i, t);
                var n = i.width / i.clientWidth
                  , r = i.height / i.clientHeight;
                return e[0] = i.clientWidth / 2 * n,
                e[1] = i.clientHeight / 2 * r,
                e
            }
        }(),
        getOffsetRect: function(t, e) {
            var i = t.getBoundingClientRect()
              , n = document.body
              , r = document.documentElement
              , a = window.pageYOffset || r.scrollTop || n.scrollTop
              , s = window.pageXOffset || r.scrollLeft || n.scrollLeft
              , o = r.clientTop || n.clientTop || 0
              , u = r.clientLeft || n.clientLeft || 0
              , l = i.top + a - o
              , c = i.left + s - u;
            return e[0] = Math.round(l),
            e[1] = Math.round(c),
            e
        }
    }),
    m.StandardMouseKeyboard = f,
    m.Hammer = g,
    t.exports = m
}
, function(t, e, i) {
    "use strict";
    var n = i(1225)
      , r = i(1212).mat4
      , a = i(1207)
      , s = function(t) {
        this._boundStrategy = t,
        void 0 === this._boundStrategy && (this._boundStrategy = s.COMPUTE_HOME_USING_SPHERE),
        this._controllerList = {},
        this._inverseMatrix = r.create(),
        this._camera = void 0,
        this._node = void 0,
        this._frustum = {},
        this._computeBoundNodeMaskOverride = -1
    };
    s.prototype = {
        setCamera: function(t) {
            this._camera = t
        },
        getCamera: function() {
            return this._camera
        },
        setNode: function(t) {
            this._node = t
        },
        setComputeBoundNodeMaskOverride: function(t) {
            this._computeBoundNodeMaskOverride = t
        },
        getComputeBoundNodeMaskOverride: function() {
            return this._computeBoundNodeMaskOverride
        },
        getHomeBound: function(t) {
            var e = this._node;
            if (e) {
                var r = void 0 !== t ? t : this._boundStrategy;
                if (r !== !0 && r !== !1 || (a.warn("Manipulator.getHomeBound with boolean is deprecated, pass a type instead"),
                r = r ? s.COMPUTE_HOME_USING_BBOX : s.COMPUTE_HOME_USING_SPHERE),
                r & s.COMPUTE_HOME_USING_BBOX) {
                    var o = new n
                      , u = null;
                    if (this._computeBoundNodeMaskOverride === -1)
                        u = e.getBoundingBox();
                    else {
                        var l = i(1233)
                          , c = new l;
                        c.setNodeMaskOverride(this._computeBoundNodeMaskOverride),
                        c.reset(),
                        c.apply(e),
                        u = c.getBoundingBox()
                    }
                    if (u.valid() && o.expandByBoundingBox(u),
                    r & s.COMPUTE_HOME_USING_SPHERE) {
                        var h = e.getBound();
                        if (h.radius() < o.radius())
                            return h
                    }
                    return o
                }
                return e.getBound()
            }
        },
        getHomeDistance: function(t) {
            var e = this._frustum
              , i = t.radius();
            if (this._camera && r.getFrustum(e, this._camera.getProjectionMatrix())) {
                var n = Math.abs(e.right - e.left) / e.zNear / 2
                  , a = Math.abs(e.top - e.bottom) / e.zNear / 2;
                i /= Math.sin(Math.atan2(a < n ? a : n, 1))
            } else
                i *= 1.5;
            return i
        },
        update: function() {},
        getInverseMatrix: function() {
            return this._inverseMatrix
        },
        getControllerList: function() {
            return this._controllerList
        }
    },
    s.COMPUTE_HOME_USING_SPHERE = 1,
    s.COMPUTE_HOME_USING_BBOX = 2,
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1212).vec3
      , a = i(1212).mat4
      , s = i(1347)
      , o = i(1349)
      , u = i(1351)
      , l = i(1352)
      , c = i(1353)
      , h = i(1354)
      , d = i(1356)
      , p = function(t) {
        s.call(this, t),
        this._homePosition = r.create(),
        this._frustum = {},
        this.init()
    };
    p.Interpolator = function(t, e) {
        this._current = new Float32Array(t),
        this._target = new Float32Array(t),
        this._delta = new Float32Array(t),
        this._delay = void 0 !== e ? e : .15,
        this._reset = !1,
        this._start = 0,
        this.reset()
    }
    ,
    p.Interpolator.prototype = {
        setDelay: function(t) {
            this._delay = t
        },
        reset: function() {
            for (var t = 0, e = this._current.length; t < e; t++)
                this._current[t] = this._target[t] = 0;
            this._reset = !0
        },
        update: function(t) {
            for (var e = Math.min(1, this._delay * t * 60), i = 0, n = this._current.length; i < n; i++) {
                var r = (this._target[i] - this._current[i]) * e;
                this._delta[i] = r,
                this._current[i] += r
            }
            return this._delta
        },
        set: function() {
            for (var t = 0, e = this._current.length; t < e; t++)
                this._current[t] = this._target[t] = arguments[t];
            this._reset = !1
        },
        isReset: function() {
            return this._reset
        },
        getCurrent: function() {
            return this._current
        },
        setTarget: function() {
            for (var t = 0, e = this._target.length; t < e; t++)
                this._reset ? this._target[t] = this._current[t] = arguments[t] : this._target[t] = arguments[t];
            this._reset = !1
        },
        addTarget: function() {
            for (var t = 0; t < arguments.length; t++)
                this._target[t] += arguments[t]
        },
        getTarget: function() {
            return this._target
        },
        getDelta: function() {
            return this._delta
        },
        getStart: function() {
            return this._start
        },
        setStart: function(t) {
            this._start = t
        }
    },
    p.AvailableControllerList = ["StandardMouseKeyboard", "LeapMotion", "GamePad", "Hammer", "DeviceOrientation", "WebVR"],
    p.ControllerList = ["StandardMouseKeyboard", "LeapMotion", "GamePad", "Hammer", "DeviceOrientation", "WebVR"],
    p.prototype = n.objectInherit(s.prototype, {
        init: function() {
            this._distance = 25,
            this._target = r.create(),
            this._upz = r.fromValues(0, 0, 1),
            r.init(this._target);
            var t = a.fromRotation(a.create(), -Math.PI, this._upz)
              , e = a.fromRotation(a.create(), Math.PI / 10, r.fromValues(1, 0, 0));
            this._rotation = a.create(),
            a.mul(this._rotation, t, e),
            this._time = 0,
            this._vrMatrix = a.create(),
            this._rotate = new p.Interpolator(2),
            this._pan = new p.Interpolator(2),
            this._zoom = new p.Interpolator(1),
            this._minSpeed = 1e-4,
            this._scaleMouseMotion = 1,
            this._inverseMatrix = a.create(),
            this._autoPushTarget = !0,
            this._limitPitchUp = .5 * Math.PI * .9,
            this._limitPitchDown = -this._limitPitchUp,
            this._limitYawLeft = -Math.PI,
            this._limitYawRight = -this._limitYawLeft,
            this._limitZoomIn = 1e-4,
            this._limitZoomOut = 1 / 0;
            var i = this;
            p.ControllerList.forEach(function(t) {
                void 0 !== p[t] && (i._controllerList[t] = new p[t](i))
            })
        },
        setLimitPitchUp: function(t) {
            this._limitPitchUp = t
        },
        setLimitPitchDown: function(t) {
            this._limitPitchDown = t
        },
        setLimitYawLeft: function(t) {
            this._limitYawLeft = t
        },
        setLimitYawRight: function(t) {
            this._limitYawRight = t
        },
        setLimitZoomOut: function(t) {
            this._limitZoomOut = t
        },
        setLimitZoomIn: function(t) {
            this._limitZoomIn = t
        },
        setDelay: function(t) {
            this._rotate.setDelay(t),
            this._pan.setDelay(t),
            this._zoom.setDelay(t)
        },
        reset: function() {
            this.init()
        },
        setTarget: function(t) {
            r.copy(this._target, t);
            var e = r.create();
            this.getEyePosition(e),
            this._distance = r.distance(t, e)
        },
        setEyePosition: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create();
            return function(n) {
                var a = this._rotation
                  , s = this._target;
                r.sub(t, n, s),
                r.normalize(t, t),
                r.cross(e, t, this._upz),
                r.normalize(e, e),
                r.cross(i, e, t),
                r.normalize(i, i),
                a[0] = e[0],
                a[1] = t[0],
                a[2] = i[0],
                a[3] = 0,
                a[4] = e[1],
                a[5] = t[1],
                a[6] = i[1],
                a[7] = 0,
                a[8] = e[2],
                a[9] = t[2],
                a[10] = i[2],
                a[11] = 0,
                a[12] = 0,
                a[13] = 0,
                a[14] = 0,
                a[15] = 1,
                this._distance = r.distance(s, n)
            }
        }(),
        computeHomePosition: function(t) {
            var e = this.getHomeBound(t);
            e && e.valid() && (this.setDistance(this.getHomeDistance(e)),
            this.setTarget(e.center()))
        },
        getHomePosition: function() {
            if (void 0 !== this._node) {
                var t = this._target
                  , e = this.getDistance();
                this.computeEyePosition(t, e, this._homePosition)
            }
            return this._homePosition
        },
        setMinSpeed: function(t) {
            this._minSpeed = t
        },
        getMinSpeed: function() {
            return this._minSpeed
        },
        setDistance: function(t) {
            this._distance = t
        },
        getDistance: function() {
            return this._distance
        },
        getSpeedFactor: function() {
            return Math.max(this._distance, this._minSpeed)
        },
        computePan: function() {
            var t = a.create()
              , e = r.create()
              , i = r.create();
            return function(n, s) {
                var o = this._camera.getProjectionMatrix()
                  , u = 1 === o[15] ? 1 : 2 / o[5]
                  , l = this.getSpeedFactor() * u;
                s *= l,
                n *= l,
                a.invert(t, this._rotation),
                e[0] = t[0],
                e[1] = t[1],
                e[2] = t[2],
                r.normalize(e, e),
                i[0] = t[8],
                i[1] = t[9],
                i[2] = t[10],
                r.normalize(i, i),
                r.scale(e, e, -n),
                r.scale(i, i, s),
                r.add(this._target, this._target, e),
                r.add(this._target, this._target, i)
            }
        }(),
        computeRotation: function() {
            var t = r.fromValues(1, 0, 0);
            return function(e, i) {
                var n = Math.atan(-this._rotation[6] / this._rotation[5]) + i / 10;
                n = Math.min(Math.max(n, this._limitPitchDown), this._limitPitchUp);
                var r = Math.atan2(this._rotation[4], this._rotation[0]) + e / 10;
                r > Math.PI ? r = r % Math.PI - Math.PI : r < -Math.PI && (r = r % Math.PI + Math.PI),
                r = Math.min(Math.max(r, this._limitYawLeft), this._limitYawRight),
                a.fromRotation(this._rotation, -n, t),
                a.rotate(this._rotation, this._rotation, -r, this._upz)
            }
        }(),
        computeZoom: function(t) {
            this.zoom(t)
        },
        setAutoPushTarget: function(t) {
            this._autoPushTarget = t
        },
        zoom: function() {
            var t = r.create();
            return function(e) {
                var i = this._distance + this.getSpeedFactor() * (e - 1);
                this._autoPushTarget && i < this._limitZoomIn && (r.sub(t, this._target, this.getEyePosition(t)),
                r.normalize(t, t),
                r.scale(t, t, this._limitZoomIn - i),
                r.add(this._target, this._target, t)),
                this._distance = Math.max(this._limitZoomIn, Math.min(this._limitZoomOut, i))
            }
        }(),
        getRotateInterpolator: function() {
            return this._rotate
        },
        getPanInterpolator: function() {
            return this._pan
        },
        getZoomInterpolator: function() {
            return this._zoom
        },
        getTarget: function(t) {
            return r.copy(t, this._target)
        },
        getEyePosition: function(t) {
            return this.computeEyePosition(this._target, this._distance, t),
            t
        },
        computeEyePosition: function() {
            var t = r.create()
              , e = a.create();
            return function(i, n, s) {
                a.invert(e, this._rotation),
                t[1] = n,
                r.transformMat4(s, t, e),
                r.add(s, i, s)
            }
        }(),
        update: function() {
            var t = r.create();
            return function(e) {
                var i, n = e.getFrameStamp().getDeltaTime(), s = .1;
                i = this._rotate.update(n),
                this.computeRotation(-i[0] * s * this._scaleMouseMotion, -i[1] * s * this._scaleMouseMotion);
                var o = .002;
                i = this._pan.update(n),
                this.computePan(-i[0] * o, -i[1] * o),
                i = this._zoom.update(n),
                this.computeZoom(1 + i[0] / 10);
                var u = this._target
                  , l = this._distance;
                a.invert(this._inverseMatrix, this._rotation),
                a.mul(this._inverseMatrix, this._vrMatrix, this._inverseMatrix),
                r.set(t, 0, l, 0),
                r.transformMat4(t, t, this._inverseMatrix),
                a.lookAt(this._inverseMatrix, r.add(t, u, t), u, this._upz)
            }
        }(),
        setPoseVR: function(t) {
            a.fromQuat(this._vrMatrix, t)
        }
    }),
    p.DeviceOrientation = o,
    p.GamePad = u,
    p.Hammer = l,
    p.LeapMotion = c,
    p.WebVR = d,
    p.StandardMouseKeyboard = h,
    t.exports = p
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).quat
      , r = i(1212).vec3
      , a = i(1350)
      , s = function(t) {
        this._manipulator = t,
        this.init()
    };
    s.prototype = {
        init: function() {
            this._stepFactor = 1,
            this._quat = n.create(),
            this._pos = r.create()
        },
        update: function(t, e) {
            a.computeQuaternion(this._quat, t, e),
            this._manipulator.setPoseVR(this._quat, this._pos)
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).quat
      , r = i(1212).vec3
      , a = Math.PI / 180
      , s = function(t, e, i, n, r) {
        var a = Math.cos(e / 2)
          , s = Math.cos(i / 2)
          , o = Math.cos(n / 2)
          , u = Math.sin(e / 2)
          , l = Math.sin(i / 2)
          , c = Math.sin(n / 2);
        return "XYZ" === r ? (t[0] = u * s * o + a * l * c,
        t[1] = a * l * o - u * s * c,
        t[2] = a * s * c + u * l * o,
        t[3] = a * s * o - u * l * c) : "YXZ" === r ? (t[0] = u * s * o + a * l * c,
        t[1] = a * l * o - u * s * c,
        t[2] = a * s * c - u * l * o,
        t[3] = a * s * o + u * l * c) : "ZXY" === r ? (t[0] = u * s * o - a * l * c,
        t[1] = a * l * o + u * s * c,
        t[2] = a * s * c + u * l * o,
        t[3] = a * s * o - u * l * c) : "ZYX" === r ? (t[0] = u * s * o - a * l * c,
        t[1] = a * l * o + u * s * c,
        t[2] = a * s * c - u * l * o,
        t[3] = a * s * o + u * l * c) : "YZX" === r ? (t[0] = u * s * o + a * l * c,
        t[1] = a * l * o + u * s * c,
        t[2] = a * s * c - u * l * o,
        t[3] = a * s * o - u * l * c) : "XZY" === r && (t[0] = u * s * o - a * l * c,
        t[1] = a * l * o - u * s * c,
        t[2] = a * s * c + u * l * o,
        t[3] = a * s * o + u * l * c),
        t
    }
      , o = function(t) {
        this._manipulator = t,
        this.init()
    };
    o.computeQuaternion = function() {
        var t = n.create()
          , e = n.fromValues(-Math.sqrt(.5), 0, 0, Math.sqrt(.5));
        return function(i, r, o) {
            var u = r.alpha * a
              , l = r.beta * a
              , c = r.gamma * a
              , h = o * a;
            s(i, l, u, -c, "YXZ");
            var d = -h / 2;
            t[1] = Math.sin(d),
            t[3] = Math.cos(d),
            n.mul(i, i, t),
            n.mul(i, i, e);
            var p = i[1];
            return i[1] = -i[2],
            i[2] = p,
            i
        }
    }(),
    o.prototype = {
        init: function() {
            this._stepFactor = 1,
            this._quat = n.create(),
            this._pos = r.create()
        },
        update: function(t, e) {
            o.computeQuaternion(this._quat, t, e),
            this._manipulator.setPoseVR(this._quat, this._pos)
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).vec2
      , r = function(t) {
        this._manipulator = t,
        this.init()
    };
    r.prototype = {
        init: function() {
            this._delay = .15,
            this._threshold = .08,
            this._mode = 0,
            this._padFactor = 10,
            this._zoomFactor = .5,
            this._rotateFactor = 5
        },
        addPan: function(t, e, i) {
            t.setDelay(this._delay),
            t.addTarget(e * this._padFactor, i * this._padFactor)
        },
        addZoom: function(t, e) {
            t.setDelay(this._delay),
            t.addTarget(e * this._zoomFactor)
        },
        addRotate: function(t, e, i) {
            t.setDelay(this._delay),
            t.addTarget(e * this._rotateFactor, i * this._rotateFactor)
        },
        gamepadaxes: function(t) {
            var e = .005
              , i = this._manipulator.getRotateInterpolator()
              , n = this._manipulator.getZoomInterpolator()
              , r = this._manipulator.getPanInterpolator();
            4 === t.length ? ((Math.abs(t[0]) > e || Math.abs(t[1]) > e) && this.addRotate(i, -t[0], t[1]),
            Math.abs(t[3]) > e && this.addZoom(n, -t[3])) : t.length >= 5 && ((Math.abs(t[0]) > e || Math.abs(t[1]) > e) && this.addPan(r, -t[0], t[1]),
            Math.abs(t[2]) > e && this.addZoom(n, -t[2]),
            (Math.abs(t[3]) > e || Math.abs(t[4]) > e) && this.addRotate(i, t[4], t[3]))
        },
        gamepadbuttondown: function(t) {
            if (t.button >= 12 && t.button <= 15) {
                var e = this._manipulator.getPanInterpolator()
                  , i = e.getTarget()
                  , r = {
                    12: n.fromValues(0, -1),
                    13: n.fromValues(0, 1),
                    14: n.fromValues(-1, 0),
                    15: n.fromValues(1, 0)
                }[t.button];
                e.setDelay(this._delay),
                e.setTarget(i[0] - 10 * r[0], i[1] + 10 * r[1])
            }
        },
        update: function(t) {
            if (t) {
                var e = t.axes
                  , i = t.buttons;
                this.gamepadaxes(e);
                for (var n = function() {}, r = 0; r < i.length; r++)
                    i[r] && this.gamepadbuttondown({
                        preventDefault: n,
                        gamepad: t,
                        button: r
                    }, !!i[r])
            }
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = function(t) {
        this._manipulator = t,
        this.init()
    };
    r.prototype = {
        init: function() {
            this._panFactorX = 1,
            this._panFactorY = -this._panFactorX,
            this._rotateFactorX = .6,
            this._rotateFactorY = -this._rotateFactorX,
            this._zoomFactor = 5,
            this._lastScale = 0,
            this._nbPointerLast = 0,
            this._delay = .15
        },
        setEventProxy: function(t) {
            if (void 0 !== t && (void 0 === t || t !== this._eventProxy)) {
                this._eventProxy = t;
                var e = this
                  , i = t
                  , r = function(t) {
                    return void 0 !== t.pointers ? t.pointers.length : 1
                }
                  , a = function(t) {
                    return "touches " + r(t) + " distance " + t.distance + " x " + t.deltaX + " y " + t.deltaY
                };
                i.get("pinch").set({
                    threshold: .1
                }),
                i.get("pan").set({
                    threshold: 0,
                    pointers: 0
                }),
                i.get("pinch").recognizeWith(i.get("pan")),
                this._cbPanStart = function(t) {
                    var i = e._manipulator;
                    if (i && !e._transformStarted && "mouse" !== t.pointerType) {
                        var s = t;
                        e._dragStarted = !0,
                        e._nbPointerLast = r(s),
                        2 === e._nbPointerLast ? (i.getPanInterpolator().reset(),
                        i.getPanInterpolator().set(t.center.x * e._panFactorX, t.center.y * e._panFactorY)) : (i.getRotateInterpolator().reset(),
                        i.getRotateInterpolator().set(t.center.x * e._rotateFactorX, t.center.y * e._rotateFactorY)),
                        n.debug("drag start, " + a(s))
                    }
                }
                ,
                this._cbPanMove = function(t) {
                    var i = e._manipulator;
                    if (i && e._dragStarted && "mouse" !== t.pointerType) {
                        var s = t
                          , o = r(s);
                        e._nbPointerLast !== o && (2 === o ? i.getPanInterpolator().reset() : i.getRotateInterpolator().reset(),
                        e._nbPointerLast = o),
                        2 === o ? (i.getPanInterpolator().setTarget(t.center.x * e._panFactorX, t.center.y * e._panFactorY),
                        n.debug("pan, " + a(s))) : (i.getRotateInterpolator().setDelay(e._delay),
                        i.getRotateInterpolator().setTarget(t.center.x * e._rotateFactorX, t.center.y * e._rotateFactorY),
                        n.debug("rotate, " + a(s)))
                    }
                }
                ,
                this._cbPanEnd = function(t) {
                    var i = e._manipulator;
                    if (i && e._dragStarted && "mouse" !== t.pointerType) {
                        e._dragStarted = !1;
                        var r = t;
                        n.debug("drag end, " + a(r))
                    }
                }
                ,
                this._cbPinchStart = function(t) {
                    var i = e._manipulator;
                    if (i && "mouse" !== t.pointerType) {
                        e._transformStarted = !0;
                        var r = t;
                        e._lastScale = r.scale,
                        i.getZoomInterpolator().reset(),
                        i.getZoomInterpolator().set(e._lastScale),
                        t.preventDefault(),
                        n.debug("zoom start, " + a(r))
                    }
                }
                ,
                this._cbPinchEnd = function(t) {
                    "mouse" !== t.pointerType && (e._transformStarted = !1,
                    n.debug("zoom end, " + a(t)))
                }
                ,
                this._cbPinchInOut = function(t) {
                    var i = e._manipulator;
                    if (i && e._transformStarted && "mouse" !== t.pointerType) {
                        var r = t
                          , s = r.scale > e._lastScale ? e._zoomFactor : 4 * e._zoomFactor
                          , o = (r.scale - e._lastScale) * s;
                        e._lastScale = r.scale,
                        i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0] - o),
                        n.debug("zoom, " + a(r))
                    }
                }
                ,
                i.on("panstart ", this._cbPanStart),
                i.on("panmove", this._cbPanMove),
                i.on("panend", this._cbPanEnd),
                i.on("pinchstart", this._cbPinchStart),
                i.on("pinchend", this._cbPinchEnd),
                i.on("pinchin pinchout", this._cbPinchInOut)
            }
        },
        removeEventProxy: function(t) {
            t && this._eventProxy && (t.off("panstart ", this._cbPanStart),
            t.off("panmove", this._cbPanMove),
            t.off("panend", this._cbPanEnd),
            t.off("pinchstart", this._cbPinchStart),
            t.off("pinchend", this._cbPinchEnd),
            t.off("pinchin pinchout", this._cbPinchInOut))
        },
        setManipulator: function(t) {
            this._manipulator = t
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1212).vec3
      , a = i(1212).vec2
      , s = function(t) {
        this._manipulator = t,
        this.init()
    }
      , o = {
        rotate: {
            dtx: -1.44,
            dty: -1.08,
            dtz: -.1,
            delay: .05,
            method: "getRotateInterpolator"
        },
        pan: {
            dtx: -1.44,
            dty: -1.08,
            delay: .05,
            method: "getPanInterpolator"
        },
        zoom: {
            dtx: 0,
            dty: -.5,
            delay: .05,
            method: "getZoomInterpolator"
        },
        "zoom-twohands": {
            dtx: -.05,
            dty: 0,
            delay: .05,
            method: "getZoomInterpolator"
        }
    };
    s.prototype = {
        init: function() {
            this._virtualCursor = a.fromValues(0, 0),
            this._targetPosition = a.fromValues(0, 0),
            this._previousFrame = void 0,
            this._displacement = a.fromValues(0, 0),
            this._top = a.fromValues(0, 1),
            this._motion = a.fromValues(0, 0),
            this._delay = .05,
            this._threshold = .08,
            this._directionDotThreshold = .5,
            this._mode = "rotate"
        },
        update: function(t) {
            if (this._previousFrame || (this._previousFrame = t),
            0 !== t.fingers.length) {
                var e = this._previousFrame.translation(t);
                if (this._previousFrame = t,
                0 !== t.hands.length && !(Math.abs(e[0]) < this._threshold && Math.abs(e[1]) < this._threshold)) {
                    var i = this._mode
                      , a = 0;
                    if (t.gestures.length > 0)
                        for (var s = 0; s < t.gestures.length; s++) {
                            var u = t.gestures[s];
                            if ("circle" === u.type)
                                return void this._manipulator.computeHomePosition()
                        }
                    if (1 === t.hands.length)
                        t.hands[0].fingers.length >= 3 ? (i = "zoom",
                        a = t.hands[0].palmPosition[1] / 10,
                        a = Math.max(a - 4, .01)) : i = t.hands[0].fingers.length > 1 ? "pan" : "rotate";
                    else if (2 === t.hands.length) {
                        var l = Math.abs(r.dot(t.hands[0].palmNormal, this._top))
                          , c = Math.abs(r.dot(t.hands[1].palmNormal, this._top));
                        l < this._directionDotThreshold && c < this._directionDotThreshold ? i = "zoom-twohands" : (i = void 0,
                        this._handsDistanceOld = void 0)
                    }
                    var h = this._manipulator.getZoomInterpolator();
                    if (void 0 !== i) {
                        if (i !== this._mode)
                            return n.info("Switch to mode " + i),
                            this._motion[0] = 0,
                            this._motion[1] = 0,
                            this._mode = i,
                            void ("zoom" !== i && "zoom-twohands" !== i || h.isReset() && (h.setStart(1),
                            h.set(0)));
                        var d, p, f;
                        d = o[i].dtx,
                        p = o[i].dty,
                        f = o[i].dtz,
                        this._motion[0] += e[0] * d,
                        this._motion[1] += e[1] * p;
                        var g = o[i].delay
                          , m = o[i].method;
                        if (this._manipulator[m]().setDelay(g),
                        "zoom" === i)
                            n.log(a),
                            h.setTarget(a);
                        else if ("zoom-twohands" === i) {
                            var v = r.distance(t.hands[1].palmPosition, t.hands[0].palmPosition);
                            if (void 0 !== this._handsDistanceOld) {
                                var _ = d * (v - this._handsDistanceOld);
                                a = h._target,
                                a[0] += _
                            }
                            this._handsDistanceOld = v
                        } else
                            "rotate" === i && (a = h._target[0],
                            a += e[2] * f,
                            a = Math.max(a, .01),
                            h.setTarget(a)),
                            this._manipulator[m]().addTarget(this._motion[0], this._motion[1]);
                        this._motion[1] = this._motion[0] = 0
                    }
                }
            }
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1213)
      , r = i(1355)
      , a = function(t) {
        this._manipulator = t,
        this.init()
    };
    a.prototype = {
        init: function() {
            this.releaseButton(),
            this._rotateKey = 65,
            this._zoomKey = 83,
            this._panKey = 68,
            this._mode = void 0,
            this._delay = .15
        },
        getMode: function() {
            return this._mode
        },
        setMode: function(t) {
            this._mode = t
        },
        setEventProxy: function(t) {
            this._eventProxy = t
        },
        setManipulator: function(t) {
            this._manipulator = t
        },
        mousemove: function(t) {
            if (this._buttonup !== !0) {
                var e = this._eventProxy.getPositionRelativeToCanvas(t)
                  , i = this._manipulator;
                if (n.isNaN(e[0]) === !1 && n.isNaN(e[1]) === !1) {
                    var a = this.getMode();
                    if (a === r.ROTATE)
                        i.getRotateInterpolator().setDelay(this._delay),
                        i.getRotateInterpolator().setTarget(e[0], e[1]);
                    else if (a === r.PAN)
                        i.getPanInterpolator().setTarget(e[0], e[1]);
                    else if (a === r.ZOOM) {
                        var s = i.getZoomInterpolator();
                        s.isReset() && (s.setStart(e[1]),
                        s.set(0));
                        var o = e[1] - s.getStart();
                        s.setStart(e[1]);
                        var u = s.getTarget()[0];
                        s.setTarget(u - o / 20)
                    }
                }
                t.preventDefault()
            }
        },
        mousedown: function(t) {
            var e = this._manipulator
              , i = this.getMode();
            void 0 === i && (0 === t.button ? t.shiftKey ? this.setMode(r.PAN) : t.ctrlKey ? this.setMode(r.ZOOM) : this.setMode(r.ROTATE) : 2 === t.button && t.ctrlKey ? this.setMode(r.ZOOM) : this.setMode(r.PAN)),
            this.pushButton();
            var n = this._eventProxy.getPositionRelativeToCanvas(t);
            i = this.getMode(),
            i === r.ROTATE ? (e.getRotateInterpolator().reset(),
            e.getRotateInterpolator().set(n[0], n[1])) : i === r.PAN ? (e.getPanInterpolator().reset(),
            e.getPanInterpolator().set(n[0], n[1])) : i === r.ZOOM && (e.getZoomInterpolator().setStart(n[1]),
            e.getZoomInterpolator().set(0)),
            t.preventDefault()
        },
        mouseup: function() {
            this.releaseButton(),
            this.setMode(void 0)
        },
        mouseout: function() {
            this.releaseButton(),
            this.setMode(void 0)
        },
        mousewheel: function(t, e) {
            var i = this._manipulator;
            t.preventDefault();
            var n = i.getZoomInterpolator().getTarget()[0] - e;
            i.getZoomInterpolator().setTarget(n)
        },
        pushButton: function() {
            this._buttonup = !1
        },
        releaseButton: function() {
            this._buttonup = !0
        },
        keydown: function(t) {
            32 === t.keyCode ? (this._manipulator.computeHomePosition(),
            t.preventDefault()) : t.keyCode === this._panKey && this.getMode() !== r.PAN ? (this.setMode(r.PAN),
            this._manipulator.getPanInterpolator().reset(),
            this.pushButton(),
            t.preventDefault()) : t.keyCode === this._zoomKey && this.getMode() !== r.ZOOM ? (this.setMode(r.ZOOM),
            this._manipulator.getZoomInterpolator().reset(),
            this.pushButton(),
            t.preventDefault()) : t.keyCode === this._rotateKey && this.getMode() !== r.ROTATE && (this.setMode(r.ROTATE),
            this._manipulator.getRotateInterpolator().reset(),
            this.pushButton(),
            t.preventDefault())
        },
        keyup: function(t) {
            t.keyCode === this._panKey ? this.mouseup(t) : t.keyCode === this._rotateKey ? this.mouseup(t) : t.keyCode === this._rotateKey && this.mouseup(t),
            this.setMode(void 0)
        }
    },
    t.exports = a
}
, function(t, e) {
    "use strict";
    t.exports = {
        ROTATE: 0,
        PAN: 1,
        ZOOM: 2
    }
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        this._manipulator = t,
        this.init()
    };
    i.prototype = {
        init: function() {},
        update: function(t, e) {
            this._manipulator.setPoseVR(t, e)
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1229)
      , a = i(1212).mat4
      , s = i(1230)
      , o = i(1232)
      , u = function() {
        r.call(this),
        this._intersector = void 0,
        this._projectionStack = [a.IDENTITY],
        this._modelStack = [a.IDENTITY],
        this._viewStack = [a.IDENTITY],
        this._windowStack = [a.IDENTITY],
        this.reset()
    };
    u.prototype = n.objectInherit(r.prototype, {
        reset: function() {
            u._reservedMatrixStack.reset()
        },
        setIntersector: function(t) {
            this._intersector = t
        },
        getIntersector: function() {
            return this._intersector
        },
        pushModelMatrix: function(t) {
            this._modelStack.push(t)
        },
        getModelMatrix: function() {
            return this._modelStack.length ? this._modelStack[this._modelStack.length - 1] : void 0
        },
        popModelMatrix: function() {
            return this._modelStack.pop()
        },
        pushViewMatrix: function(t) {
            this._viewStack.push(t)
        },
        getViewMatrix: function() {
            return this._viewStack.length ? this._viewStack[this._viewStack.length - 1] : void 0
        },
        popViewMatrix: function() {
            return this._viewStack.pop()
        },
        pushProjectionMatrix: function(t) {
            this._projectionStack.push(t)
        },
        getProjectionMatrix: function() {
            return this._projectionStack.length ? this._projectionStack[this._projectionStack.length - 1] : void 0
        },
        popProjectionMatrix: function() {
            return this._projectionStack.pop()
        },
        pushWindowMatrix: function(t) {
            this._windowStack.push(t)
        },
        pushWindowMatrixUsingViewport: function(t) {
            this._windowStack.push(t.computeWindowMatrix(u._reservedMatrixStack.get()))
        },
        getWindowMatrix: function() {
            return this._windowStack.length ? this._windowStack[this._windowStack.length - 1] : void 0
        },
        popWindowMatrix: function() {
            return this._windowStack.pop()
        },
        getTransformation: function() {
            var t = a.create64();
            return function() {
                return a.copy(t, this.getWindowMatrix() || a.IDENTITY),
                a.mul(t, t, this.getProjectionMatrix() || a.IDENTITY),
                a.mul(t, t, this.getViewMatrix() || a.IDENTITY),
                a.mul(t, t, this.getModelMatrix() || a.IDENTITY),
                t
            }
        }(),
        enter: function(t) {
            return this._intersector.enter(t)
        },
        apply: function(t) {
            t.getViewMatrix ? this.applyCamera(t) : t.getMatrix ? this.applyTransform(t) : this.applyNode(t)
        },
        applyCamera: function(t) {
            var e = t.getViewport();
            void 0 !== e && this.pushWindowMatrixUsingViewport(e);
            var i, n, r;
            t.getReferenceFrame() === o.RELATIVE_RF && this.getViewMatrix() && this.getProjectionMatrix() ? (i = a.mul(u._reservedMatrixStack.get(), this.getProjectionMatrix(), t.getProjectionMatrix()),
            n = this.getViewMatrix(),
            r = a.mul(u._reservedMatrixStack.get(), this.getModelMatrix(), t.getViewMatrix())) : (i = t.getProjectionMatrix(),
            n = t.getViewMatrix(),
            r = a.identity(u._reservedMatrixStack.get())),
            this.pushProjectionMatrix(i),
            this.pushViewMatrix(n),
            this.pushModelMatrix(r),
            this._intersector.setCurrentTransformation(this.getTransformation()),
            this.traverse(t),
            this.popModelMatrix(),
            this.popViewMatrix(),
            this.popProjectionMatrix(),
            void 0 !== e && this.popWindowMatrix(),
            this._intersector.setCurrentTransformation(this.getTransformation())
        },
        applyNode: function(t) {
            if (this.enter(t))
                return t.primitives ? void this._intersector.intersect(this, t) : void (t.traverse && this.traverse(t))
        },
        applyTransform: function(t) {
            if (this.enter(t)) {
                if (t.getReferenceFrame() === o.ABSOLUTE_RF) {
                    var e = u._reservedMatrixStack.get();
                    this.pushViewMatrix(a.identity(e)),
                    this.pushModelMatrix(t.getMatrix())
                } else if (this._modelStack.length > 0) {
                    var i = a.copy(u._reservedMatrixStack.get(), this.getModelMatrix());
                    a.mul(i, i, t.getMatrix()),
                    this.pushModelMatrix(i)
                } else
                    this.pushModelMatrix(t.getMatrix());
                this._intersector.setCurrentTransformation(this.getTransformation()),
                this.traverse(t),
                this.popModelMatrix(),
                t.getReferenceFrame() === o.ABSOLUTE_RF && this.popViewMatrix(),
                this._intersector.setCurrentTransformation(this.getTransformation())
            }
        }
    }),
    u._reservedMatrixStack = new s,
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).vec3
      , r = i(1212).mat4
      , a = i(1297)
      , s = function() {
        this._start = n.create(),
        this._end = n.create(),
        this._iStart = n.create(),
        this._iEnd = n.create(),
        this._intersections = []
    };
    s.prototype = {
        set: function(t, e) {
            n.copy(this._start, t),
            n.copy(this._iStart, t),
            n.copy(this._end, e),
            n.copy(this._iEnd, e)
        },
        setStart: function(t) {
            n.copy(this._start, t),
            n.copy(this._iStart, t)
        },
        setEnd: function(t) {
            n.copy(this._end, t),
            n.copy(this._iEnd, t)
        },
        reset: function() {
            this._intersections.length = 0
        },
        enter: function(t) {
            return !t.isCullingActive() || this.intersects(t.getBound())
        },
        intersects: function() {
            var t = n.create()
              , e = n.create();
            return function(i) {
                if (!i.valid())
                    return !1;
                n.sub(t, this._iStart, i.center());
                var r = n.sqrLen(t) - i.radius2();
                if (r <= 0)
                    return !0;
                n.sub(e, this._iEnd, this._iStart);
                var a = n.sqrLen(e)
                  , s = 2 * n.dot(t, e)
                  , o = s * s - 4 * a * r;
                if (o < 0)
                    return !1;
                o = Math.sqrt(o);
                var u = .5 / a
                  , l = (-s - o) * u
                  , c = (-s + o) * u;
                return !(l <= 0 && c <= 0) && !(l > 1 && c > 1)
            }
        }(),
        intersect: function() {
            var t = new a;
            return function(e, i) {
                var n = i.getShape();
                if (n)
                    return n.intersectRay(this._iStart, this._iEnd, this._intersections, e.nodePath);
                if (t.reset(),
                t.setNodePath(e.nodePath),
                t.set(this._iStart, this._iEnd),
                i.computeTransformedVertices) {
                    var r = i.getVertexAttributeList()
                      , a = r.Vertex.getElements();
                    r.Vertex._elements = i.computeTransformedVertices(),
                    t.apply(i),
                    r.Vertex._elements = a
                } else
                    t.apply(i);
                for (var s = t._intersections, o = this._intersections, u = s.length, l = 0; l < u; l++)
                    o.push(s[l]);
                return u > 0
            }
        }(),
        getIntersections: function() {
            return this._intersections
        },
        setCurrentTransformation: function(t) {
            r.invert(t, t),
            n.transformMat4(this._iStart, this._start, t),
            n.transformMat4(this._iEnd, this._end, t)
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1360)
      , r = i(1212).vec4
      , a = i(1212).vec3
      , s = function() {
        this._intersections = [],
        this._index = 0,
        this._polytope = [],
        this._iPolytope = [],
        this._referencePlane = r.create(),
        this._iReferencePlane = r.create(),
        this._intersectionLimit = s.NO_LIMIT,
        this._dimensionMask = s.AllDims
    };
    s.NO_LIMIT = 0,
    s.LIMIT_ONE_PER_DRAWABLE = 1,
    s.LIMIT_ONE = 2,
    s.DimZero = 1,
    s.DimOne = 2,
    s.DimTwo = 4,
    s.AllDims = s.DimZero | s.DimOne | s.DimTwo;
    var o = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3];
        t[0] = i[0] * n + i[1] * r + i[2] * a + i[3] * s,
        t[1] = i[4] * n + i[5] * r + i[6] * a + i[7] * s,
        t[2] = i[8] * n + i[9] * r + i[10] * a + i[11] * s,
        t[3] = i[12] * n + i[13] * r + i[14] * a + i[15] * s
    };
    s.prototype = {
        setPolytope: function(t) {
            this._polytope = t,
            this._referencePlane[0] = t[t.length - 1][0],
            this._referencePlane[1] = t[t.length - 1][1],
            this._referencePlane[2] = t[t.length - 1][2],
            this._referencePlane[3] = t[t.length - 1][3]
        },
        setPolytopeFromWindowCoordinates: function(t, e, i, n) {
            this.setPolytope([r.fromValues(1, 0, 0, -t), r.fromValues(-1, 0, 0, i), r.fromValues(0, 1, 0, -e), r.fromValues(0, -1, 0, n), r.fromValues(0, 0, 1, 0)])
        },
        setDimensionMask: function(t) {
            this._dimensionMask = t
        },
        reset: function() {
            this._intersections.length = 0
        },
        enter: function(t) {
            return !this.reachedLimit() && this.intersects(t.getBound())
        },
        reachedLimit: function() {
            return this._intersectionLimit === s.LIMIT_ONE && this._intersections.length > 0
        },
        intersects: function() {
            var t = a.create();
            return function(e) {
                if (!e.valid())
                    return !1;
                var i, n = e.center();
                a.copy(t, n);
                for (var r = -e.radius(), s = 0, o = this._iPolytope.length; s < o; s++)
                    if (i = this._iPolytope[s][0] * t[0] + this._iPolytope[s][1] * t[1] + this._iPolytope[s][2] * t[2] + this._iPolytope[s][3],
                    i <= r)
                        return !1;
                return !0
            }
        }(),
        intersect: function(t, e) {
            if (this.reachedLimit())
                return !1;
            var i = new n;
            i.setNodePath(t.nodePath),
            i.set(this._iPolytope, this._iReferencePlane),
            i.setLimitOneIntersection(this._intersectionLimit === s.LIMIT_ONE_PER_DRAWABLE || this._intersectionLimit === s.LIMIT_ONE),
            i.setDimensionMask(this._dimensionMask),
            i.apply(e);
            var r = i._intersections.length;
            if (r > 0) {
                for (var a = 0; a < r; a++)
                    this._intersections.push(i._intersections[a]);
                return !0
            }
            return !1
        },
        getIntersections: function() {
            return this._intersections
        },
        setIntersectionLimit: function(t) {
            this._intersectionLimit = t
        },
        setCurrentTransformation: function(t) {
            for (var e, i = r.create(), n = 0, a = this._polytope.length; n < a; n++) {
                var s = this._polytope[n];
                o(i, s, t),
                e = 1 / Math.sqrt(i[0] * i[0] + i[1] * i[1] + i[2] * i[2]),
                i[0] *= e,
                i[1] *= e,
                i[2] *= e,
                i[3] *= e,
                this._iPolytope[n] = r.clone(i)
            }
            o(this._iReferencePlane, this._referencePlane, t),
            e = 1 / Math.sqrt(this._iReferencePlane[0] * this._iReferencePlane[0] + this._iReferencePlane[1] * this._iReferencePlane[1] + this._iReferencePlane[2] * this._iReferencePlane[2]),
            this._iReferencePlane[0] *= e,
            this._iReferencePlane[1] *= e,
            this._iReferencePlane[2] *= e,
            this._iReferencePlane[3] *= e
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1213)
      , r = i(1212).vec3
      , a = i(1305)
      , s = function(t, e, i, n, a) {
        this._index = t - 1,
        this._distance = 0,
        this._maxDistance = -1,
        this._numPoints = 0,
        this._points = [],
        this._maxNumIntersections = 6,
        this._center = r.create();
        for (var s = 0, o = e.length; s < o; s++)
            if (0 !== i[s]) {
                this._points[this._numPoints++] = r.clone(e[s]),
                r.add(this._center, this._center, e[s]);
                var u = n[0] * e[s][0] + n[1] * e[s][1] + n[2] * e[s][2] + n[3];
                if (u > this._maxDistance && (this._maxDistance = u),
                this._numPoints === this._maxNumIntesections)
                    break
            }
        r.scale(this._center, this._center, 1 / this._numPoints),
        this._distance = n[0] * this._center[0] + n[1] * this._center[1] + n[2] * this._center[2] + n[3],
        this.nodePath = a
    }
      , o = function(t, e, i) {
        this._planeMask = t,
        this._pos = e,
        this._dir = i
    }
      , u = function() {
        this._intersections = [],
        this._nodePath = [],
        this._index = 0,
        this._referencePlane = [],
        this._planes = [],
        this._lines = [],
        this._candidates = [],
        this._candidatesMasks = [],
        this._lines = [],
        this._planesMask = 0,
        this._limitOneIntersection = !1,
        this._dimensionMask = void 0
    };
    u.prototype = {
        setNodePath: function(t) {
            this._nodePath = t
        },
        set: function(t, e) {
            this._planes = t,
            this._referencePlane = e,
            this._planesMask = 0,
            this._lines.length = 0;
            for (var i = 0; i < this._planes.length; i++)
                this._planesMask = this._planesMask << 1 | 1
        },
        setDimensionMask: function(t) {
            this._dimensionMask = t
        },
        apply: function(t) {
            if (t.getAttributes().Vertex) {
                var e = t.getAttributes().Vertex.getElements()
                  , i = this
                  , n = function() {
                    return {
                        operatorPoint: function(t) {
                            i.intersectPoint(t)
                        },
                        operatorLine: function(t, e) {
                            i.intersectLine(t, e)
                        },
                        operatorTriangle: function(t, e, n) {
                            i.intersectTriangle(t, e, n)
                        }
                    }
                }
                  , r = new a(t,n,e);
                r.apply()
            }
        },
        checkCandidatePoints: function(t) {
            for (var e = 1, i = this._candidates.length, n = 0, r = this._planes.length; n < r && i > 0; ++n,
            e <<= 1)
                if (!(t & e))
                    for (var a = 0; a < this._candidates.length; ++a)
                        if (0 !== this._candidatesMasks[a] && !(e & this._candidatesMasks[a]) && this.distance(this._planes[n], this._candidates[a]) < 0 && (this._candidatesMasks[a] = 0,
                        --i,
                        0 === i))
                            return 0;
            return i
        },
        intersectPoint: function() {
            var t = r.create();
            return function(e) {
                if (this._index++,
                0 !== (1 & this._dimensionMask) && !(this._limitOneIntersection && this._intersections.length > 0)) {
                    for (var i, n = 0, a = this._planes.length; n < a; ++n)
                        if (i = this.distance(this._planes[n], e),
                        i < 0)
                            return;
                    this._candidates = [],
                    this._candidatesMasks = [],
                    r.copy(t, e),
                    this._candidates.push(t),
                    this._candidatesMasks.push(this._planesMask),
                    this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)))
                }
            }
        }(),
        intersectLine: function() {
            var t = r.create();
            return function(e, i) {
                if (this._index++,
                0 !== (2 & this._dimensionMask) && !(this._limitOneIntersection && this._intersections.length > 0)) {
                    var n = !0
                      , a = !0
                      , o = 1
                      , u = 0;
                    this._candidates = [],
                    this._candidatesMasks = [];
                    for (var l, c, h, d, p = 0, f = this._planes.length; p < f; ++p,
                    o <<= 1) {
                        if (l = this.distance(this._planes[p], e),
                        c = this.distance(this._planes[p], i),
                        h = l < 0,
                        d = c < 0,
                        h && d)
                            return;
                        h || d ? (h && (n = !1),
                        d && (a = !1),
                        0 === l ? (r.copy(t, e),
                        this._candidates.push(t),
                        this._candidatesMasks.push(o)) : 0 === c ? (r.copy(t, i),
                        this._candidates.push(t),
                        this._candidatesMasks.push(o)) : h && !d ? (r.sub(t, i, e),
                        r.scale(t, t, l / (-l + c)),
                        r.sub(t, e, t),
                        this._candidates.push(t),
                        this._candidatesMasks.push(o)) : !h && d && (r.sub(t, i, e),
                        r.scaleAndAdd(t, e, t, l / (l - c)),
                        this._candidates.push(t),
                        this._candidatesMasks.push(o))) : u |= o
                    }
                    if (u === this._planesMask)
                        return this._candidates.push(r.clone(e)),
                        this._candidatesMasks.push(this._planesMask),
                        this._candidates.push(r.clone(i)),
                        this._candidatesMasks.push(this._planesMask),
                        void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));
                    var g = this.checkCandidatePoints(u);
                    g > 0 && (n && (this._candidatesMasks.push(this._planesMask),
                    this._candidates.push(r.clone(e))),
                    a && (this._candidatesMasks.push(this._planesMask),
                    this._candidates.push(r.clone(i))),
                    this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0))))
                }
            }
        }(),
        intersectTriangle: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create()
              , n = r.create()
              , a = r.create()
              , o = r.create()
              , u = r.create();
            return function(l, c, h) {
                if (this._index++,
                0 !== (4 & this._dimensionMask) && !(this._limitOneIntersection && this._intersections.length > 0)) {
                    var d = 1
                      , p = 0;
                    this._candidates = [],
                    this._candidatesMasks = [];
                    for (var f, g, m, v, _, b, x = 0, A = this._planes.length; x < A; ++x,
                    d <<= 1) {
                        if (f = this.distance(this._planes[x], l),
                        g = this.distance(this._planes[x], c),
                        m = this.distance(this._planes[x], h),
                        v = f < 0,
                        _ = g < 0,
                        b = m < 0,
                        v && _ && b)
                            return;
                        v || _ || b ? (0 === f ? (r.copy(t, l),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : 0 === g ? (r.copy(t, c),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : v && !_ ? (r.sub(t, c, l),
                        r.scale(t, t, f / (-f + g)),
                        r.sub(t, l, t),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : !v && _ && (r.sub(t, c, l),
                        r.scaleAndAdd(t, l, t, f / (f - g)),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)),
                        0 === m ? (r.copy(t, h),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : v && !b ? (r.sub(t, h, l),
                        r.scale(t, t, f / (-f + m)),
                        r.sub(t, l, t),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : !v && b && (r.sub(t, h, l),
                        r.scaleAndAdd(t, l, t, f / (f - m)),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)),
                        _ && !b ? (r.sub(t, h, c),
                        r.scale(t, t, g / (-g + m)),
                        r.sub(t, c, t),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : !_ && b && (r.sub(t, h, c),
                        r.scaleAndAdd(t, c, t, g / (g - m)),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d))) : p |= d
                    }
                    if (p === this._planesMask)
                        return this._candidates.push(r.clone(l)),
                        this._candidatesMasks.push(this._planesMask),
                        this._candidates.push(r.clone(c)),
                        this._candidatesMasks.push(this._planesMask),
                        this._candidates.push(r.clone(h)),
                        this._candidatesMasks.push(this._planesMask),
                        void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));
                    var y = this.checkCandidatePoints(p);
                    if (y > 0)
                        return void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));
                    var S = this.getPolytopeLines();
                    for (this._candidates = [],
                    this._candidatesMasks = [],
                    r.sub(e, c, l),
                    r.sub(i, h, l),
                    x = 0; x < S.length; ++x) {
                        r.cross(a, S[x]._dir, i);
                        var C = r.dot(e, a);
                        if (!(Math.abs(C) < 1e-6)) {
                            var M = 1 / C;
                            r.sub(o, S[x]._pos, l);
                            var w = M * r.dot(o, a);
                            if (!(w < 0 || w > 1)) {
                                r.cross(u, o, e);
                                var T = M * r.dot(S[x]._dir, u);
                                if (!(T < 0 || w + T > 1)) {
                                    var E = M * r.dot(i, u);
                                    r.scaleAndAdd(n, S[x]._pos, S[x]._dir, E),
                                    this._candidates.push(r.copy(r.create(), n)),
                                    this._candidatesMasks.push(S[x]._planeMask)
                                }
                            }
                        }
                    }
                    return y = this.checkCandidatePoints(p),
                    y > 0 ? void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0))) : void 0
                }
            }
        }(),
        getPolytopeLines: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create()
              , a = r.create()
              , s = r.create()
              , u = r.create()
              , l = 1e-6;
            return function() {
                if (this._lines.length > 0)
                    return this._lines;
                for (var c = 1, h = 0, d = this._planes.length; h < d; h++,
                c <<= 1) {
                    r.copy(i, this.getNormal(this._planes[h])),
                    r.scale(a, i, -this._planes[h][3]);
                    for (var p = c << 1, f = h + 1, g = this._planes.length; f < g; ++f,
                    p <<= 1)
                        if (r.copy(s, this.getNormal(this._planes[f])),
                        !(Math.abs(r.dot(i, s)) > 1 - l)) {
                            r.cross(t, i, s),
                            r.cross(e, t, i);
                            var m = -this.distance(this._planes[f], a) / r.dot(e, s);
                            n.isNaN(m) || (r.scaleAndAdd(u, a, e, m),
                            this._lines.push(new o(c | p,r.clone(u),r.clone(t))))
                        }
                }
                return this._lines
            }
        }(),
        setLimitOneIntersection: function(t) {
            this._limitOneIntersection = t
        },
        distance: function(t, e) {
            var i = t[0] * e[0] + t[1] * e[1] + t[2] * e[2] + t[3];
            return i
        },
        getNormal: function() {
            var t = r.create();
            return function(e) {
                return t[0] = e[0],
                t[1] = e[1],
                t[2] = e[2],
                t
            }
        }()
    },
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1348)
      , r = function(t) {
        this._manipulator = t,
        this._timer = !1,
        this.init()
    };
    r.prototype = {
        init: function() {
            this.releaseButton(),
            this._rotateKey = 65,
            this._zoomKey = 83,
            this._panKey = 68,
            this._mode = void 0
        },
        getMode: function() {
            return this._mode
        },
        setMode: function(t) {
            this._mode = t
        },
        setEventProxy: function(t) {
            this._eventProxy = t
        },
        setManipulator: function(t) {
            this._manipulator = t
        },
        setDimensionMask: function(t) {
            this._dimensionMask = t
        },
        mousemove: function(t) {
            if (this._buttonup !== !0) {
                var e = this._manipulator
                  , i = e.getPositionRelativeToCanvas(t.clientX, t.clientY);
                if (isNaN(i[0]) === !1 && isNaN(i[1]) === !1) {
                    var r = this.getMode();
                    if (r === n.Rotate)
                        e.getRotateInterpolator().setTarget(i[0], i[1]);
                    else if (r === n.Pan)
                        e.getPanInterpolator().setTarget(i[0], i[1]);
                    else if (r === n.Zoom) {
                        var a = e.getZoomInterpolator();
                        e.computeIntersections(i),
                        a.isReset() && (a.setStart(i[1]),
                        a.set(0));
                        var s = i[1] - a.getStart();
                        a.setStart(i[1]);
                        var o = a.getTarget()[0];
                        a.setTarget(o - s / 20)
                    }
                }
                t.preventDefault()
            }
        },
        mousedown: function(t) {
            var e = this._manipulator
              , i = this.getMode();
            void 0 === i && (0 === t.button ? t.shiftKey ? this.setMode(n.Pan) : t.ctrlKey ? this.setMode(n.Zoom) : this.setMode(n.Rotate) : this.setMode(n.Pan)),
            this.pushButton();
            var r = e.getPositionRelativeToCanvas(t.clientX, t.clientY);
            e.computeIntersections(r),
            i = this.getMode(),
            i === n.Rotate ? (e.getRotateInterpolator().reset(),
            e.getRotateInterpolator().set(r[0], r[1])) : i === n.Pan ? (e.getPanInterpolator().reset(),
            e.getPanInterpolator().set(r[0], r[1])) : i === n.Zoom && (e.getZoomInterpolator().setStart(r[1]),
            e.getZoomInterpolator().set(0)),
            t.preventDefault()
        },
        mouseup: function() {
            this.releaseButton(),
            this.setMode(void 0)
        },
        mousewheel: function(t, e) {
            var i = this._manipulator;
            t.preventDefault();
            var n = i.getZoomInterpolator().getTarget()[0] - e;
            i.getZoomInterpolator().setTarget(n);
            var r;
            if (this._timer === !1) {
                this._timer = !0;
                var a = this;
                clearTimeout(r),
                r = setTimeout(function() {
                    a._timer = !1
                }, 200);
                var s = i.getPositionRelativeToCanvas(t.clientX, t.clientY);
                i.computeIntersections(s)
            }
        },
        dblclick: function(t) {
            var e = this._manipulator;
            t.preventDefault(),
            e.getZoomInterpolator().set(0);
            var i = e.getZoomInterpolator().getTarget()[0] - 10;
            e.getZoomInterpolator().setTarget(i);
            var n = e.getPositionRelativeToCanvas(t.clientX, t.clientY);
            e.computeIntersections(n)
        },
        pushButton: function() {
            this._buttonup = !1
        },
        releaseButton: function() {
            this._buttonup = !0
        },
        keydown: function(t) {
            32 === t.keyCode ? (this._manipulator.computeHomePosition(),
            t.preventDefault()) : t.keyCode === this._panKey && this.getMode() !== n.Pan ? (this.setMode(n.Pan),
            this._manipulator.getPanInterpolator().reset(),
            this.pushButton(),
            t.preventDefault()) : t.keyCode === this._zoomKey && this.getMode() !== n.Zoom ? (this.setMode(n.Zoom),
            this._manipulator.getZoomInterpolator().reset(),
            this.pushButton(),
            t.preventDefault()) : t.keyCode === this._rotateKey && this.getMode() !== n.Rotate && (this.setMode(n.Rotate),
            this._manipulator.getRotateInterpolator().reset(),
            this.pushButton(),
            t.preventDefault())
        },
        keyup: function(t) {
            t.keyCode === this._panKey ? this.mouseup(t) : t.keyCode === this._rotateKey ? this.mouseup(t) : t.keyCode === this._rotateKey && this.mouseup(t),
            this.setMode(void 0)
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = function(t) {
        this._manipulator = t,
        this._timer = !1,
        this.init()
    };
    r.prototype = {
        init: function() {
            this._panFactorX = 1,
            this._panFactorY = -this._panFactorX,
            this._rotateFactorX = .6,
            this._rotateFactorY = -this._rotateFactorX,
            this._zoomFactor = 5,
            this._lastScale = 0,
            this._nbPointerLast = 0,
            this._lastPos = void 0
        },
        setEventProxy: function(t) {
            if (void 0 !== t && (void 0 === t || t !== this._eventProxy)) {
                this._eventProxy = t;
                var e = this
                  , i = t
                  , r = function(t) {
                    return void 0 !== t.pointers ? t.pointers.length : 1
                }
                  , a = function(t) {
                    return "touches " + r(t) + " distance " + t.distance + " x " + t.deltaX + " y " + t.deltaY
                };
                i.get("pinch").set({
                    threshold: .1
                }),
                i.get("pan").set({
                    threshold: 0,
                    pointers: 0
                }),
                i.get("pinch").recognizeWith(i.get("pan")),
                i.get("tap").set({
                    taps: 2,
                    posThreshold: 300
                }),
                this._cbPanStart = function(t) {
                    var i = e._manipulator;
                    if (i && !e._transformStarted && "mouse" !== t.pointerType) {
                        var s = t;
                        e._dragStarted = !0,
                        e._nbPointerLast = r(s);
                        var o;
                        2 === e._nbPointerLast ? (o = i.getPositionRelativeToCanvas(t.center.x, t.center.y),
                        e._lastPos = o) : o = void 0 === e._lastPos ? i.getCanvasCenter() : e._lastPos,
                        i.computeIntersections(o),
                        2 === e._nbPointerLast ? (i.getPanInterpolator().reset(),
                        i.getPanInterpolator().set(t.center.x * e._panFactorX, t.center.y * e._panFactorY)) : i.getRotateInterpolator().reset(),
                        n.debug("drag start, " + a(s))
                    }
                }
                ,
                this._cbPanMove = function(t) {
                    var i = e._manipulator;
                    if (i && e._dragStarted && "mouse" !== t.pointerType) {
                        var s = t
                          , o = r(s);
                        e._nbPointerLast !== o && (2 === o ? i.getPanInterpolator().reset() : i.getRotateInterpolator().reset(),
                        e._nbPointerLast = o),
                        2 === o ? (i.getPanInterpolator().setTarget(t.center.x * e._panFactorX, t.center.y * e._panFactorY),
                        n.debug("pan, " + a(s))) : (i.getRotateInterpolator().setTarget(t.center.x * e._rotateFactorX, t.center.y * e._rotateFactorY),
                        n.debug("rotate, " + a(s)))
                    }
                }
                ,
                this._cbPanEnd = function(t) {
                    var i = e._manipulator;
                    if (i && e._dragStarted && "mouse" !== t.pointerType) {
                        e._dragStarted = !1;
                        var r = t;
                        n.debug("drag end, " + a(r))
                    }
                }
                ,
                this._cbPinchStart = function(t) {
                    var i = e._manipulator;
                    if (i && "mouse" !== t.pointerType) {
                        e._transformStarted = !0;
                        var r = t;
                        e._lastScale = r.scale,
                        i.getZoomInterpolator().reset(),
                        i.getZoomInterpolator().set(e._lastScale),
                        t.preventDefault(),
                        n.debug("zoom start, " + a(r))
                    }
                }
                ,
                this._cbPinchEnd = function(t) {
                    "mouse" !== t.pointerType && (e._transformStarted = !1,
                    n.debug("zoom end, " + a(t)))
                }
                ,
                this._cbPinchInOut = function(t) {
                    var i = e._manipulator;
                    if (i && e._transformStarted && "mouse" !== t.pointerType) {
                        var r = t
                          , s = r.scale > e._lastScale ? e._zoomFactor : 4 * e._zoomFactor
                          , o = (r.scale - e._lastScale) * s;
                        e._lastScale = r.scale,
                        i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0] - o),
                        n.debug("zoom, " + a(r))
                    }
                }
                ,
                this._cbDoubleTap = function(t) {
                    var i = e._manipulator;
                    if (i && "mouse" !== t.pointerType) {
                        var r = t
                          , s = i.getPositionRelativeToCanvas(t.center.x, t.center.y);
                        e._lastPos = s,
                        i.getZoomInterpolator().set(0);
                        var o = i.getZoomInterpolator().getTarget()[0] - 10;
                        i.getZoomInterpolator().setTarget(o),
                        n.debug("tap, " + a(r))
                    }
                }
                ,
                i.on("panstart ", this._cbPanStart),
                i.on("panmove", this._cbPanMove),
                i.on("panend", this._cbPanEnd),
                i.on("pinchstart", this._cbPinchStart),
                i.on("pinchend", this._cbPinchEnd),
                i.on("pinchin pinchout", this._cbPinchInOut),
                i.on("tap", this._cbDoubleTap)
            }
        },
        removeEventProxy: function(t) {
            t && this._eventProxy && (t.off("panstart ", this._cbPanStart),
            t.off("panmove", this._cbPanMove),
            t.off("panend", this._cbPanEnd),
            t.off("pinchstart", this._cbPinchStart),
            t.off("pinchend", this._cbPinchEnd),
            t.off("pinchin pinchout", this._cbPinchInOut),
            t.off("tap", this._cbDoubleTap))
        },
        setManipulator: function(t) {
            this._manipulator = t
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1347)
      , a = i(1348)
      , s = i(1212).mat4
      , o = i(1212).vec2
      , u = i(1212).vec3
      , l = i(1212).quat
      , c = i(1350)
      , h = i(1364)
      , d = i(1365)
      , p = i(1366)
      , f = function(t) {
        r.call(this, t),
        this.init()
    };
    f.AvailableControllerList = ["StandardMouseKeyboard", "WebVR", "DeviceOrientation", "Hammer"],
    f.ControllerList = ["StandardMouseKeyboard", "WebVR", "DeviceOrientation", "Hammer"],
    f.prototype = n.objectInherit(r.prototype, {
        computeHomePosition: function(t) {
            var e = this.getHomeBound(t);
            if (e && e.valid()) {
                this._distance = this.getHomeDistance(e);
                var i = e.center();
                u.scale(this._eye, this._direction, -this._distance),
                u.add(this._eye, i, this._eye),
                this.setTarget(i)
            }
        },
        init: function() {
            this._direction = u.fromValues(0, 1, 0),
            this._eye = u.fromValues(0, 25, 10),
            this._up = u.fromValues(0, 0, 1),
            this._distance = 1,
            this._forward = new a.Interpolator(1),
            this._side = new a.Interpolator(1),
            this._lookPosition = new a.Interpolator(2),
            this._pan = new a.Interpolator(2),
            this._zoom = new a.Interpolator(1),
            this._stepFactor = 1,
            this._angleVertical = 0,
            this._angleHorizontal = 0,
            this._tmpGetTargetDir = u.create(),
            this._vrEnable = !1,
            this._vrRot = l.create(),
            this._vrPos = u.create(),
            this._vrTrans = u.create();
            var t = this;
            this._controllerList = {},
            f.ControllerList.forEach(function(e) {
                void 0 !== f[e] && (t._controllerList[e] = new f[e](t))
            })
        },
        setDelay: function(t) {
            this._forward.setDelay(t),
            this._side.setDelay(t),
            this._lookPosition.setDelay(t),
            this._pan.setDelay(t),
            this._zoom.setDelay(t)
        },
        getEyePosition: function(t) {
            return t[0] = this._eye[0],
            t[1] = this._eye[1],
            t[2] = this._eye[2],
            t
        },
        setEyePosition: function(t) {
            return this._eye[0] = t[0],
            this._eye[1] = t[1],
            this._eye[2] = t[2],
            this
        },
        getTarget: function(t) {
            var e = u.scale(this._tmpGetTargetDir, this._direction, this._distance);
            return u.add(t, this._eye, e),
            t
        },
        setTarget: function(t) {
            var e = this._tmpGetTargetDir;
            u.sub(e, t, this._eye),
            e[2] = 0,
            u.normalize(e, e),
            this._angleHorizontal = Math.acos(e[1]),
            e[0] < 0 && (this._angleHorizontal = -this._angleHorizontal),
            u.sub(e, t, this._eye),
            u.normalize(e, e),
            this._angleVertical = -Math.asin(e[2]),
            u.copy(this._direction, e)
        },
        getLookPositionInterpolator: function() {
            return this._lookPosition
        },
        getSideInterpolator: function() {
            return this._side
        },
        getForwardInterpolator: function() {
            return this._forward
        },
        getPanInterpolator: function() {
            return this._pan
        },
        getZoomInterpolator: function() {
            return this._zoom
        },
        getRotateInterpolator: function() {
            return this._lookPosition
        },
        computeRotation: function() {
            var t = s.create()
              , e = s.create()
              , i = u.fromValues(1, 0, 0)
              , n = u.fromValues(0, 1, 0)
              , r = u.fromValues(0, 0, 1)
              , a = .5 * Math.PI;
            return function(o, l) {
                this._angleVertical += .01 * l,
                this._angleHorizontal -= .01 * o,
                this._angleVertical > a ? this._angleVertical = a : this._angleVertical < -a && (this._angleVertical = -a),
                this._vrEnable ? (u.transformQuat(this._direction, n, this._vrRot),
                u.normalize(this._direction, this._direction),
                u.transformQuat(this._up, r, this._vrRot)) : (s.fromRotation(t, -this._angleVertical, i),
                s.fromRotation(e, -this._angleHorizontal, r),
                s.mul(e, e, t),
                u.transformMat4(this._direction, n, e),
                u.normalize(this._direction, this._direction),
                u.transformMat4(this._up, r, e))
            }
        }(),
        reset: function() {
            this.init()
        },
        setDistance: function(t) {
            this._distance = t
        },
        getDistance: function() {
            return this._distance
        },
        setStepFactor: function(t) {
            this._stepFactor = t
        },
        computePosition: function() {
            var t = o.create();
            return function(e) {
                this._forward.update(e),
                this._side.update(e);
                var i = this._distance < .001 ? .001 : this._distance
                  , n = this._camera.getProjectionMatrix()
                  , r = 1 === n[15] ? 1 : 2 / n[5];
                t[0] = this._forward.getCurrent()[0],
                t[1] = this._side.getCurrent()[0];
                var a = o.sqrLen(t);
                a > 1 && o.scale(t, t, 1 / Math.sqrt(a));
                var s = this._pan.update(e)
                  , l = this._zoom.update(e)
                  , c = this._stepFactor * i * r * e
                  , h = this._stepFactor * i * r * .005;
                this.moveForward(t[0] * c - l[0] * h * 20),
                this.strafe(t[1] * c - s[0] * h),
                this.strafeVertical(-s[1] * h),
                this._vrEnable && (u.add(this._eye, this._eye, this._vrTrans),
                u.init(this._vrTrans))
            }
        }(),
        update: function() {
            var t = u.create();
            return function(e) {
                var i = e.getFrameStamp().getDeltaTime()
                  , n = this._lookPosition.update(i);
                this.computeRotation(.5 * -n[0], .5 * -n[1]),
                this.computePosition(i),
                u.add(t, this._eye, this._direction),
                s.lookAt(this._inverseMatrix, this._eye, t, this._up),
                this._vrEnable = !1
            }
        }(),
        setPoseVR: function(t, e) {
            this._vrEnable = !0,
            l.copy(this._vrRot, t),
            u.sub(this._vrTrans, e, this._vrPos),
            u.copy(this._vrPos, e)
        },
        moveForward: function() {
            var t = u.create();
            return function(e) {
                u.normalize(t, this._direction),
                u.scale(t, t, e),
                u.add(this._eye, this._eye, t)
            }
        }(),
        strafe: function() {
            var t = u.create();
            return function(e) {
                u.cross(t, this._direction, this._up),
                u.normalize(t, t),
                u.scale(t, t, e),
                u.add(this._eye, this._eye, t)
            }
        }(),
        strafeVertical: function() {
            var t = u.create();
            return function(e) {
                u.normalize(t, this._up),
                u.scale(t, t, e),
                u.add(this._eye, this._eye, t)
            }
        }()
    }),
    f.DeviceOrientation = c,
    f.Hammer = h,
    f.WebVR = d,
    f.StandardMouseKeyboard = p,
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(1352);
    t.exports = n
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        this._manipulator = t,
        this.init()
    };
    i.prototype = {
        init: function() {},
        update: function(t, e) {
            this._manipulator.setPoseVR(t, e)
        }
    },
    t.exports = i
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        this._manipulator = t,
        this.init()
    };
    i.prototype = {
        init: function() {
            this.releaseButton(),
            this._delay = .15,
            this._stepFactor = 1
        },
        setEventProxy: function(t) {
            this._eventProxy = t
        },
        setManipulator: function(t) {
            this._manipulator = t,
            this._manipulator.setStepFactor(this._stepFactor)
        },
        pushButton: function() {
            this._buttonup = !1
        },
        releaseButton: function() {
            this._buttonup = !0
        },
        mousedown: function(t) {
            var e = this._eventProxy.getPositionRelativeToCanvas(t)
              , i = this._manipulator;
            i.getLookPositionInterpolator().set(e[0], e[1]),
            this.pushButton()
        },
        mouseup: function() {
            this.releaseButton()
        },
        mouseout: function() {
            this.releaseButton()
        },
        mousemove: function(t) {
            if (this._buttonup !== !0) {
                var e = this._eventProxy.getPositionRelativeToCanvas(t);
                this._manipulator.getLookPositionInterpolator().setDelay(this._delay),
                this._manipulator.getLookPositionInterpolator().setTarget(e[0], e[1])
            }
        },
        mousewheel: function(t, e) {
            t.preventDefault(),
            this._stepFactor = Math.min(Math.max(.001, this._stepFactor + .01 * e), 4),
            this._manipulator.setStepFactor(this._stepFactor)
        },
        keydown: function(t) {
            var e = this._manipulator;
            if (32 === t.keyCode)
                e.computeHomePosition(),
                t.preventDefault();
            else {
                if (87 === t.keyCode || 90 === t.keyCode || 38 === t.keyCode)
                    return e.getForwardInterpolator().setDelay(this._delay),
                    e.getForwardInterpolator().setTarget(1),
                    t.preventDefault(),
                    !1;
                if (83 === t.keyCode || 40 === t.keyCode)
                    return e.getForwardInterpolator().setDelay(this._delay),
                    e.getForwardInterpolator().setTarget(-1),
                    t.preventDefault(),
                    !1;
                if (68 === t.keyCode || 39 === t.keyCode)
                    return e.getSideInterpolator().setDelay(this._delay),
                    e.getSideInterpolator().setTarget(1),
                    t.preventDefault(),
                    !1;
                if (65 === t.keyCode || 81 === t.keyCode || 37 === t.keyCode)
                    return e.getSideInterpolator().setDelay(this._delay),
                    e.getSideInterpolator().setTarget(-1),
                    t.preventDefault(),
                    !1
            }
        },
        keyup: function(t) {
            var e = this._manipulator;
            return 87 === t.keyCode || 90 === t.keyCode || 38 === t.keyCode || 83 === t.keyCode || 40 === t.keyCode ? (e.getForwardInterpolator().setDelay(this._delay),
            e.getForwardInterpolator().setTarget(0),
            !1) : 68 === t.keyCode || 39 === t.keyCode || 65 === t.keyCode || 81 === t.keyCode || 37 === t.keyCode ? (e.getSideInterpolator().setDelay(this._delay),
            e.getSideInterpolator().setTarget(0),
            !1) : void 0
        }
    },
    t.exports = i
}
, function(t, e) {
    "use strict";
    var i = function() {
        this._manipulatorList = [],
        this._currentManipulator = void 0
    };
    i.prototype = {
        getCamera: function() {
            return this.getCurrentManipulator().getCamera()
        },
        setCamera: function(t) {
            for (var e = this.getManipulatorList(), i = 0, n = e.length; i < n; ++i)
                e[i].setCamera(t)
        },
        update: function(t) {
            var e = this.getCurrentManipulator();
            if (void 0 !== e)
                return e.update(t)
        },
        getNode: function() {
            return this.getCurrentManipulator()._node
        },
        setNode: function(t) {
            for (var e = this.getManipulatorList(), i = 0, n = e.length; i < n; ++i)
                e[i].setNode(t)
        },
        getControllerList: function() {
            return this.getCurrentManipulator().getControllerList()
        },
        getNumManipulator: function() {
            return this._manipulatorList.length
        },
        addManipulator: function(t) {
            this._manipulatorList.push(t),
            void 0 === this._currentManipulator && this.setManipulatorIndex(0)
        },
        getManipulatorList: function() {
            return this._manipulatorList
        },
        setManipulatorIndex: function(t) {
            this._currentManipulator = t
        },
        getCurrentManipulatorIndex: function() {
            return this._currentManipulator
        },
        getCurrentManipulator: function() {
            return this._manipulatorList[this._currentManipulator]
        },
        reset: function() {
            this.getCurrentManipulator().reset()
        },
        computeHomePosition: function(t) {
            var e = this.getCurrentManipulator();
            void 0 !== e && e.computeHomePosition(t)
        },
        getInverseMatrix: function() {
            var t = this.getCurrentManipulator();
            if (void 0 !== t)
                return t.getInverseMatrix()
        },
        getHomeBound: function(t) {
            return this.getCurrentManipulator().getHomeBound(t)
        },
        getHomeDistance: function(t) {
            return this.getCurrentManipulator().getHomeDistance(t)
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1369)
      , r = i(1370)
      , a = i(1371)
      , s = i(1381)
      , o = i(1417)
      , u = i(1357)
      , l = i(1358)
      , c = i(1203)
      , h = i(1423)
      , d = i(1424)
      , p = i(1425)
      , f = i(1359)
      , g = i(1360)
      , m = i(1426)
      , v = i(1427)
      , _ = i(1297)
      , b = i(1428)
      , x = i(1429)
      , A = {};
    A.Composer = n,
    c.objectMix(A, r),
    A.DisplayNormalVisitor = a,
    A.DisplayGeometryVisitor = s,
    A.DisplayGraph = o,
    A.IntersectionVisitor = u,
    A.LineSegmentIntersector = l,
    A.NodeGizmo = h,
    A.GizmoGeometry = d,
    A.WebVRCustom = b,
    A.ParameterVisitor = p,
    A.PolytopeIntersector = f,
    A.PolytopePrimitiveIntersector = g,
    A.SphereIntersector = m,
    A.TangentSpaceGenerator = v,
    A.TriangleIntersect = _,
    A.WebVR = x,
    t.exports = A
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1203)
      , a = i(1209)
      , s = i(1263)
      , o = i(1290)
      , u = i(1237)
      , l = i(1260)
      , c = i(1273)
      , h = i(1321)
      , d = i(1212).mat4
      , p = i(1238)
      , f = i(1226)
      , g = i(1306)
      , m = i(1311)
      , v = i(1312)
      , _ = i(1232)
      , b = i(1212).vec2
      , x = i(1212).vec3
      , A = function() {
        a.call(this),
        this._stack = [],
        this._renderToScreen = !1,
        this._dirty = !1,
        this._textureRTT = [],
        this._cameraRTT = [];
        var t = function() {};
        t.prototype = {
            update: function(t) {
                return t.isDirty() && t.build(),
                !0
            }
        },
        this.addUpdateCallback(new t),
        this.getOrCreateStateSet().setAttributeAndModes(new o("DISABLE")),
        this.getOrCreateStateSet().setAttributeAndModes(new s("BACK"))
    };
    A.prototype = r.objectInherit(a.prototype, {
        dirty: function() {
            for (var t = 0, e = this._stack.length; t < e; t++)
                this._stack[t].filter.dirty()
        },
        addPass: function(t, e, i) {
            var n = {};
            return n.filter = t,
            e instanceof u ? (n.texture = e,
            n.textureTarget = i || u.TEXTURE_2D) : void 0 !== e && void 0 !== i && (n.width = Math.floor(e),
            n.height = Math.floor(i)),
            this._stack.push(n),
            n.filter
        },
        renderToScreen: function(t, e) {
            this._renderToScreen = !0,
            this._renderToScreenWidth = t,
            this._renderToScreenHeight = e
        },
        getResultTexture: function() {
            return this._resultTexture
        },
        isDirty: function() {
            for (var t = 0, e = this._stack.length; t < e; t++)
                if (this._stack[t].filter.isDirty())
                    return !0;
            return !1
        },
        build: function() {
            var t = this;
            t._textureRTT = [],
            t._cameraRTT = [],
            this.removeChildren();
            var e;
            this._stack.forEach(function(i, r, a) {
                if (i.filter.isDirty() && i.filter.build(),
                i.filter.interConnectFilters)
                    return void (e = i.filter.interConnectFilters(t, r, a));
                var s, o, f = i.filter.getStateSet();
                if (void 0 !== i.texture)
                    s = i.texture.getWidth(),
                    o = i.texture.getHeight();
                else if (void 0 !== i.width && void 0 !== i.height)
                    s = i.width,
                    o = i.height;
                else {
                    var g = f.getTextureAttribute(0, "Texture");
                    void 0 === g ? n.warn("Composer can't find any information to setup texture output size") : (s = g.getWidth(),
                    o = g.getHeight())
                }
                var m = r === a.length - 1 && t._renderToScreen === !0;
                if (!m && void 0 === f.getAttribute("Program"))
                    return void a[r + 1].filter.getStateSet().setTextureAttributeAndModes(0, f.getTextureAttribute(0, "Texture"));
                var x = new l;
                t._cameraRTT.push(x),
                x.setStateSet(f);
                var A;
                if (m === !0)
                    s = t._renderToScreenWidth,
                    o = t._renderToScreenHeight;
                else {
                    x.setRenderOrder(l.PRE_RENDER, 0),
                    A = i.texture;
                    var y = i.textureTarget;
                    void 0 === A && (A = new u,
                    A.setName("composer Rtt " + i.filter.getFragmentName()),
                    A.setTextureSize(s, o),
                    y = u.TEXTURE_2D,
                    t._textureRTT.push(A)),
                    x.attachTexture(c.COLOR_ATTACHMENT0, A, y)
                }
                var S = new h(0,0,s,o);
                x.setReferenceFrame(_.ABSOLUTE_RF),
                x.setViewport(S),
                d.ortho(x.getProjectionMatrix(), 0, 1, 0, 1, -5, 5);
                var C = v.createTexturedFullScreenFakeQuadGeometry();
                i.filter.buildGeometry && (C = i.filter.buildGeometry(C)),
                C.setName("composer layer"),
                A && r + 1 < a.length && a[r + 1].filter.getStateSet().setTextureAttributeAndModes(0, A),
                e = A,
                x.addChild(C),
                i.filter.getStateSet().addUniform(p.createFloat2(b.fromValues(s, o), "RenderSize")),
                x.setClearMask(0),
                x.setName(i.filter.getFragmentName() || "Composer Pass" + r),
                t.addChild(x)
            }),
            this._resultTexture = e
        }
    }),
    A.Filter = function() {
        this._stateSet = new f,
        this._dirty = !0,
        this._fragmentName = "FilterOSGJS",
        this._vertexName = ""
    }
    ,
    A.Filter.prototype = {
        setFragmentName: function(t) {
            this._fragmentName = t
        },
        getFragmentName: function() {
            return this._fragmentName
        },
        setVertexName: function(t) {
            this._vertexName = t
        },
        getVertexName: function() {
            return this._vertexName
        },
        getDefineFragmentName: function() {
            return "\n#define SHADER_NAME " + this._fragmentName + "\n"
        },
        getDefineVertexName: function() {
            return "\n#define SHADER_NAME " + (this._vertexName || this._fragmentName) + "\n"
        },
        getStateSet: function() {
            return this._stateSet
        },
        getOrCreateStateSet: function() {
            return this._stateSet
        },
        dirty: function() {
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        }
    },
    A.Filter.defaultVertexShader = ["attribute vec3 Vertex;", "varying vec2 vTexCoord0;", "void main(void) {", "  gl_Position = vec4(Vertex*2.0 - 1.0,1.0);", "  vTexCoord0 = Vertex.xy;", "}", ""].join("\n"),
    A.Filter.defaultFragmentShaderHeader = ["#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif", "varying vec2 vTexCoord0;", "uniform vec2 RenderSize;", "uniform sampler2D Texture0;", ""].join("\n"),
    A.Filter.shaderUtils = ["vec4 packFloatTo4x8(in float v) {", "vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;", "enc = fract(enc);", "enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);", "return enc;", "}", " ", "vec4 pack2FloatTo4x8(in vec2 val) {", " const vec2 bitSh = vec2(256.0, 1.0);", " const vec2 bitMsk = vec2(0.0, 1.0/256.0);", " vec2 res1 = fract(val.x * bitSh);", " res1 -= res1.xx * bitMsk;", " vec2 res2 = fract(val.y * bitSh);", " res2 -= res2.xx * bitMsk;", " return vec4(res1.x,res1.y,res2.x,res2.y);", "}", " ", "float unpack4x8ToFloat( vec4 rgba ) {", " return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );", "}", " ", "vec2 unpack4x8To2Float(in vec4 val) {", " const vec2 unshift = vec2(1.0/256.0, 1.0);", " return vec2(dot(val.xy, unshift), dot(val.zw, unshift));", "}", "vec2 encodeNormal (vec3 n)", "{", "    float f = sqrt(8.0*n.z+8.0);", "    return n.xy / f + 0.5;", "}", "vec3 decodeNormal (vec2 enc)", "{", "    vec2 fenc = enc*4.0-2.0;", "    float f = dot(fenc,fenc);", "    float g = sqrt(1.0-f/4.0);", "    vec3 n;", "    n.xy = fenc*g;", "    n.z = 1.0-f/2.0;", "    return n;", "}", ""].join("\n"),
    A.Filter.Helper = {
        pascalCache: [[1]],
        getOrCreatePascalCoefficients: function(t) {
            t = void 0 === t ? 5 : Math.min(t, 128);
            var e = A.Filter.Helper.pascalCache;
            if (e[t])
                return e[t];
            for (var i = e.length - 1; i < t; i++) {
                var n = e[i]
                  , r = n.length
                  , a = new Array(r);
                a[0] = 1,
                a[r] = 1;
                for (var s = i === e.length - 1 ? Math.pow(2, i) : 1, o = 0; o < r - 1; o++)
                    a[o + 1] = (n[o] + n[o + 1]) * s;
                s = Math.pow(2, i + 1);
                for (var u = 0; u < r + 1; u++)
                    a[u] /= s;
                e.push(a)
            }
            return e[t]
        }
    },
    A.Filter.Custom = function(t, e) {
        A.Filter.call(this),
        this._fragmentShader = t,
        this._uniforms = e,
        this._vertexShader = A.Filter.defaultVertexShader
    }
    ,
    A.Filter.Custom.prototype = r.objectInherit(A.Filter.prototype, {
        setFragmentShader: function(t) {
            this._fragmentShader = t
        },
        setVertexShader: function(t) {
            this._vertexShader = t
        },
        autoBindFragmentUniformStateSet: function(t, e, i) {
            var n = 0
              , r = e.match(/uniform\s+\w+\s+\w+/g);
            if (r)
                for (var a = 0, s = r.length; a < s; a++) {
                    var o, u = r[a].match(/uniform\s+(\w+)\s+(\w+)/), l = u[1], c = u[2];
                    if (i[c]) {
                        var h = i[c];
                        l.search("sampler") !== -1 ? (t.setTextureAttributeAndModes(n, h),
                        o = p.createInt1(n, c),
                        n++,
                        t.addUniform(o)) : (o = p.isUniform(h) ? h : p[l](i[c], c),
                        t.addUniform(o))
                    }
                }
        },
        build: function() {
            this._program = new g(new m(m.VERTEX_SHADER,this._vertexShader + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,this._fragmentShader + this.getDefineFragmentName())),
            this._uniforms && this.autoBindFragmentUniformStateSet(this._stateSet, this._fragmentShader, this._uniforms),
            this._stateSet.setAttributeAndModes(this._program),
            this._dirty = !1
        }
    }),
    A.Filter.PingPong = function(t, e, i, n, r, a) {
        A.Filter.Custom.apply(this, [r, a]),
        this._cameraRtt0 = t,
        this._rtt0 = e,
        this._cameraRtt1 = i,
        this._rtt1 = n,
        this._fragmentName = "PingPong"
    }
    ,
    A.Filter.PingPong.prototype = r.objectInherit(A.Filter.Custom.prototype, {
        interConnectFilters: function(t, e, i) {
            var n = this.getStateSet()
              , r = this._cameraRtt0.getOrCreateStateSet()
              , a = this._cameraRtt1.getOrCreateStateSet();
            r.setAttributeAndModes(this._program),
            a.setAttributeAndModes(this._program);
            var s, o, u, l, c = this.getStateSet().getUniformList();
            if (c)
                for (u = window.Object.keys(c),
                s = 0,
                o = u.length; s < o; s++)
                    l = c[u[s]].getUniform(),
                    r.addUniform(l),
                    a.addUniform(l);
            if (c = this._uniforms)
                for (u = window.Object.keys(c),
                s = 0,
                o = u.length; s < o; s++)
                    l = c[u[s]],
                    r.addUniform(l),
                    a.addUniform(l);
            var h = p.createInt1(0, "Texture0")
              , d = p.createInt1(1, "Texture1");
            r.addUniform(h),
            r.addUniform(d),
            a.addUniform(h),
            a.addUniform(d);
            var f = n.getTextureAttribute(0, "Texture");
            if (r.setTextureAttributeAndModes(0, f),
            a.setTextureAttributeAndModes(0, f),
            r.setTextureAttributeAndModes(1, this._rtt1),
            a.setTextureAttributeAndModes(1, this._rtt0),
            e !== i.length - 1) {
                var g = i[e + 1].filter.getStateSet();
                g.setTextureAttributeAndModes(0, this._rtt0),
                g.setTextureAttributeAndModes(1, this._rtt1),
                g.addUniform(h),
                g.addUniform(d)
            }
            var m = v.createTexturedFullScreenFakeQuadGeometry();
            return this.buildGeometry && (m = this.buildGeometry(m)),
            m.setName("composer layer"),
            this._cameraRtt0.addChild(m),
            this._cameraRtt1.addChild(m),
            t.addChild(this._cameraRtt0),
            t.addChild(this._cameraRtt1),
            t._textureRTT.push(this._rtt0),
            t._textureRTT.push(this._rtt1),
            t._cameraRTT.push(this._cameraRtt0),
            t._cameraRTT.push(this._cameraRtt1),
            this._cameraRtt1.setNodeMask(0),
            this._rtt0
        },
        "switch": function() {
            var t = this._cameraRtt0.getNodeMask()
              , e = this._cameraRtt1.getNodeMask();
            this._cameraRtt0.setNodeMask(e),
            this._cameraRtt1.setNodeMask(t)
        }
    }),
    A.Filter.AverageHBlur = function(t, e, i, n) {
        A.Filter.call(this),
        this._linear = e !== !1,
        this.setBlurSize(void 0 !== t ? t : 5),
        this._unpack = i,
        this._pack = n,
        this._pixelSize = 1,
        this._fragmentName = "AverageHBlur" + this._nbSamples
    }
    ,
    A.Filter.AverageHBlur.prototype = r.objectInherit(A.Filter.prototype, {
        setBlurSize: function(t) {
            t % 2 !== 1 && (t += 1),
            this._nbSamples = t,
            this.dirty()
        },
        setPixelSize: function(t) {
            this._pixelSize = t,
            this.dirty()
        },
        getUVOffset: function(t) {
            return "vec2(float(" + t + ")/RenderSize[0], 0.0);"
        },
        getShaderBlurKernel: function() {
            var t = this._nbSamples
              , e = [];
            e.push(" pixel = unpack(Texture0, vTexCoord0 );"),
            e.push(" if (pixel.w == 0.0) { gl_FragColor = pixel; return; }"),
            e.push(" vec2 offset;");
            var i, n = Math.floor(t / 2);
            n % 2 !== 0 && (t += 1,
            n = Math.floor(t / 2));
            var r = 2 * n + 1
              , a = 1 / r;
            if (this._linear) {
                var s, o, u = 1, l = (1 - a) / (2 * n);
                for (e.push(" pixel *= float(" + a + ");"),
                e.push(" vec4 pixelLin = vec4(0.0);"),
                i = 0; i < n; i += 2)
                    o = u + .5,
                    u += 2,
                    s = this.getUVOffset(o * this._pixelSize),
                    e.push(" offset = " + s),
                    e.push(" pixelLin += unpack(Texture0, vTexCoord0 + offset);"),
                    e.push(" pixelLin += unpack(Texture0, vTexCoord0 - offset);");
                e.push(" pixel += pixelLin * float(" + 2 * l + ");")
            } else {
                for (i = 0; i < n; i++)
                    e.push(" offset = " + this.getUVOffset((i + 1) * this._pixelSize)),
                    e.push(" pixel += unpack(Texture0, vTexCoord0 + offset);"),
                    e.push(" pixel += unpack(Texture0, vTexCoord0 - offset);");
                e.push(" pixel *= float(" + a + ");")
            }
            return e
        },
        build: function() {
            var t = this._stateSet.getTextureAttribute(0, "Texture");
            t && this._linear ? (t.setMinFilter("LINEAR"),
            t.setMagFilter("LINEAR")) : this._linear = !1;
            var e = A.Filter.defaultVertexShader
              , i = [A.Filter.defaultFragmentShaderHeader, "uniform float width;", this._unpack || "vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }", this._pack || "vec4 pack(vec4 pix) { return pix; }", "void main (void)", "{", "  vec4 pixel;", this.getShaderBlurKernel().join("\n"), "  gl_FragColor = pack(pixel);", "}", ""].join("\n")
              , n = new g(new m(m.VERTEX_SHADER,e + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i + this.getDefineFragmentName()));
            void 0 === this._stateSet.getUniform("Texture0") && this._stateSet.addUniform(p.createInt1(0, "Texture0")),
            this._stateSet.setAttributeAndModes(n),
            this._dirty = !1
        }
    }),
    A.Filter.AverageVBlur = function(t, e, i, n) {
        A.Filter.AverageHBlur.call(this, t, e, i, n),
        this._fragmentName = "AverageVBlur" + this._nbSamples
    }
    ,
    A.Filter.AverageVBlur.prototype = r.objectInherit(A.Filter.AverageHBlur.prototype, {
        getUVOffset: function(t) {
            return "vec2(0.0, float(" + t + ")/RenderSize[1]);"
        }
    }),
    A.Filter.BilateralHBlur = function(t, e, i) {
        A.Filter.call(this),
        void 0 === t && (t = {});
        var n = t.nbSamples
          , r = t.depthTexture
          , a = t.radius;
        this.setBlurSize(void 0 !== n ? n : 5),
        this._depthTexture = r,
        this._radius = p.createFloat(1, "radius"),
        this._pixelSize = p.createFloat(1, "pixelSize"),
        this.setRadius(a),
        this._unpack = e,
        this._pack = i,
        this._fragmentName = "BilateralHBlur" + this._nbSamples
    }
    ,
    A.Filter.BilateralHBlur.prototype = r.objectInherit(A.Filter.prototype, {
        setBlurSize: function(t) {
            t % 2 !== 1 && (t += 1),
            this._nbSamples = t,
            this.dirty()
        },
        setPixelSize: function(t) {
            this._pixelSize.setFloat(t)
        },
        setRadius: function(t) {
            this._radius.setFloat(t)
        },
        getUVOffset: function(t) {
            return "vec2(0.0, float(" + t + ") * pixelSize )/RenderSize[1];"
        },
        getShaderBlurKernel: function() {
            var t = this._nbSamples
              , e = [];
            e.push(" pixel = unpack(Texture0, vTexCoord0 );"),
            e.push(" if (pixel.w <= 0.0001) { gl_FragColor = vec4(1.0); return; }"),
            e.push(" vec2 offset, tmpUV;"),
            e.push(" depth = getDepthValue(unpack(Texture1, vTexCoord0 ));");
            for (var i = 1; i < Math.ceil(t / 2); i++)
                e.push(" offset = " + this.getUVOffset(i)),
                e.push(" tmpUV =  vTexCoord0 + offset;"),
                e.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),
                e.push(" if ( abs(depth-tmpDepth) < radius) {"),
                e.push("   pixel += unpack(Texture0, tmpUV);"),
                e.push("   nbHits += 1.0;"),
                e.push(" }"),
                e.push(" tmpUV =  vTexCoord0 - offset;"),
                e.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),
                e.push(" if ( abs(depth-tmpDepth) < radius) {"),
                e.push("   pixel += unpack(Texture0, tmpUV);"),
                e.push("   nbHits += 1.0;"),
                e.push(" }");
            return e.push(" pixel /= nbHits;"),
            e
        },
        build: function() {
            var t = A.Filter.defaultVertexShader
              , e = [A.Filter.defaultFragmentShaderHeader, "uniform sampler2D Texture1;", "uniform float width;", "uniform mat4 projection;", "uniform float radius;", "uniform float pixelSize;", this._unpack || "vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }", this._pack || "vec4 pack(vec4 pix) { return pix; }", "float znear,zfar,zrange;", "", A.Filter.shaderUtils, "", "float getDepthValue(vec4 v) {", "  float depth = unpack4x8ToFloat(v);", "  depth = depth*zrange+znear;", "  return -depth;", "}", "void main (void)", "{", "  vec4 pixel;", "  float depth, tmpDepth;", "  znear = projection[3][2] / (projection[2][2]-1.0);", "  zfar = projection[3][2] / (projection[2][2]+1.0);", "  zrange = zfar-znear;", "  float nbHits = 1.0;", this.getShaderBlurKernel().join("\n"), "  gl_FragColor = pack(pixel);", "}", ""].join("\n")
              , i = new g(new m(m.VERTEX_SHADER,t + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,e + this.getDefineFragmentName()));
            void 0 === this._stateSet.getUniform("Texture0") && this._stateSet.addUniform(p.createInt1(0, "Texture0")),
            void 0 === this._stateSet.getUniform("Texture1") && this._stateSet.addUniform(p.createInt1(1, "Texture1")),
            this._stateSet.addUniform(this._radius),
            this._stateSet.addUniform(this._pixelSize),
            this._stateSet.setTextureAttributeAndModes(1, this._depthTexture),
            this._stateSet.setAttributeAndModes(i),
            this._dirty = !1
        }
    }),
    A.Filter.BilateralVBlur = function(t, e, i) {
        A.Filter.BilateralHBlur.call(this, t, e, i),
        this._fragmentName = "BilateralVBlur" + this._nbSamples
    }
    ,
    A.Filter.BilateralVBlur.prototype = r.objectInherit(A.Filter.BilateralHBlur.prototype, {
        getUVOffset: function(t) {
            return "vec2(float(" + t + ")*pixelSize/RenderSize[0],0.0);"
        }
    }),
    A.Filter.InputTexture = function(t) {
        A.Filter.call(this),
        this._stateSet.setTextureAttributeAndModes(0, t),
        this._fragmentName = "InputTexture"
    }
    ,
    A.Filter.InputTexture.prototype = r.objectInherit(A.Filter.prototype, {
        build: function() {
            this._dirty = !1
        }
    }),
    A.Filter.HBlur = function(t, e, i, n) {
        A.Filter.call(this),
        this._linear = e !== !1,
        this.setBlurSize(void 0 !== t ? t : 5),
        this._unpack = i,
        this._pack = n,
        this._fragmentName = "HBlur" + this._nbSamples
    }
    ,
    A.Filter.HBlur.prototype = r.objectInherit(A.Filter.prototype, {
        setBlurSize: function(t) {
            t % 2 !== 0 && (t += 1),
            this._nbSamples = t,
            this.dirty()
        },
        getUVOffset: function(t) {
            return "vec2(float(" + t + ")/ RenderSize[0], 0.0) ;"
        },
        build: function() {
            var t = this._nbSamples
              , e = this._stateSet.getTextureAttribute(0, "Texture");
            e && this._linear ? (e.setMinFilter("LINEAR"),
            e.setMagFilter("LINEAR")) : this._linear = !1;
            var i = A.Filter.defaultVertexShader
              , n = .005 / t
              , r = t
              , a = A.Filter.Helper.getOrCreatePascalCoefficients(r)
              , s = Math.floor(r / 2)
              , o = [];
            o.push(" pixel = float(" + a[s] + ")*unpack(Texture0, vTexCoord0 ).rgb;"),
            o.push(" vec2 offset;");
            var u, l, c, h, d;
            if (this._linear)
                for (u = 1,
                l = s + 1; l < t; l += 2) {
                    var f = a[l]
                      , v = a[l + 1];
                    if (c = f + v,
                    c < n)
                        break;
                    var _ = u
                      , b = u + 1;
                    u += 2,
                    d = (_ * f + b * v) / c,
                    h = this.getUVOffset(d),
                    o.push(" offset = " + h),
                    o.push(" pixel += " + c + "* unpack(Texture0, (vTexCoord0.xy + offset.xy)).rgb;"),
                    o.push(" pixel += " + c + "* unpack(Texture0, (vTexCoord0.xy - offset.xy)).rgb;")
                }
            else
                for (u = 1,
                l = s + 1; l < t && (c = a[l],
                !(c < n)); l++)
                    d = u++,
                    h = this.getUVOffset(d),
                    o.push(" offset = " + h),
                    o.push(" pixel += " + c + "* unpack(Texture0, (vTexCoord0.xy + offset.xy)).rgb;"),
                    o.push(" pixel += " + c + "* unpack(Texture0, (vTexCoord0.xy - offset.xy)).rgb;");
            var x = [A.Filter.defaultFragmentShaderHeader, "uniform float width;", this._unpack || "vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }", this._pack || "vec4 pack(vec4 pix) { return pix; }", "void main (void)", "{", "  vec3 pixel;", o.join("\n"), "  gl_FragColor = pack(vec4(pixel, 1.0));", "}", ""].join("\n")
              , y = new g(new m(m.VERTEX_SHADER,i + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,x + this.getDefineFragmentName()));
            void 0 === this._stateSet.getUniform("Texture0") && this._stateSet.addUniform(p.createInt1(0, "Texture0")),
            this._stateSet.setAttributeAndModes(y),
            this._dirty = !1
        }
    }),
    A.Filter.VBlur = function(t, e, i, n) {
        A.Filter.HBlur.call(this, t, e, i, n),
        this._fragmentName = "VBlur" + this._nbSamples
    }
    ,
    A.Filter.VBlur.prototype = r.objectInherit(A.Filter.HBlur.prototype, {
        getUVOffset: function(t) {
            return "vec2(0.0, float(" + t + ")/RenderSize[1]) ;"
        }
    }),
    A.Filter.SobelFilter = function() {
        A.Filter.call(this),
        this._color = p.createFloat3(x.fromValues(1, 1, 1), "color"),
        this._factor = p.createFloat(1, "factor"),
        this._fragmentName = "SobelFilter"
    }
    ,
    A.Filter.SobelFilter.prototype = r.objectInherit(A.Filter.prototype, {
        setColor: function(t) {
            this._color.setVec3(t)
        },
        setFactor: function(t) {
            this._factor.setFloat(t)
        },
        build: function() {
            var t = this._stateSet
              , e = A.Filter.defaultVertexShader
              , i = ["", A.Filter.defaultFragmentShaderHeader, "uniform vec3 color;", "uniform float factor;", "void main (void)", "{", "  float fac0 = 2.0;", "  float fac1 = 1.0;", "  float offsetx = 1.0/RenderSize[0];", "  float offsety = 1.0/RenderSize[1];", "  vec4 texel0 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, offsety));", "  vec4 texel1 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, 0.0));", "  vec4 texel2 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, -offsety));", "  vec4 texel3 = texture2D(Texture0, vTexCoord0 + vec2(0.0, -offsety));", "  vec4 texel4 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, -offsety));", "  vec4 texel5 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, 0.0));", "  vec4 texel6 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, offsety));", "  vec4 texel7 = texture2D(Texture0, vTexCoord0 + vec2(0.0, offsety));", "  vec4 rowx = -fac0*texel5 + fac0*texel1 +  -fac1*texel6 + fac1*texel0 + -fac1*texel4 + fac1*texel2;", "  vec4 rowy = -fac0*texel3 + fac0*texel7 +  -fac1*texel4 + fac1*texel6 + -fac1*texel2 + fac1*texel0;", "  float mag = sqrt(dot(rowy,rowy)+dot(rowx,rowx));", "  if (mag < 1.0/255.0) discard;", "  mag *= factor;", "  mag = min(1.0, mag);", "  gl_FragColor = vec4(color*mag,mag);", "}", ""].join("\n")
              , n = new g(new m(m.VERTEX_SHADER,e + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i + this.getDefineFragmentName()));
            t.setAttributeAndModes(n),
            t.addUniform(this._color),
            t.addUniform(this._factor),
            t.addUniform(p.createInt1(0, "Texture0")),
            this._dirty = !1
        }
    }),
    A.Filter.BlendMix = function() {
        A.Filter.call(this);
        var t, e, i, n = 0, r = 1, a = this._stateSet;
        3 === arguments.length ? (t = arguments[0],
        e = arguments[1],
        i = arguments[2],
        n = 1,
        r = 2,
        a.setTextureAttributeAndModes(n, t)) : 2 === arguments.length ? (e = arguments[0],
        i = arguments[1]) : 1 === arguments.length && (e = arguments[0],
        i = .5),
        a.setTextureAttributeAndModes(r, e),
        a.addUniform(p.createInt1(n, "Texture0")),
        a.addUniform(p.createInt1(r, "Texture1")),
        this._mixValueUniform = p.createFloat1(i, "MixValue"),
        a.addUniform(this._mixValueUniform),
        this._fragmentName = "BlendMix"
    }
    ,
    A.Filter.BlendMix.prototype = r.objectInherit(A.Filter.prototype, {
        getBlendFactorUniform: function() {
            return this._mixValueUniform
        },
        build: function() {
            var t = this._stateSet
              , e = A.Filter.defaultVertexShader
              , i = ["", A.Filter.defaultFragmentShaderHeader, "uniform sampler2D Texture1;", "uniform float MixValue;", "void main (void)", "{", "  gl_FragColor = mix(texture2D(Texture0,vTexCoord0), texture2D(Texture1,vTexCoord0),MixValue);", "}", ""].join("\n")
              , n = new g(new m(m.VERTEX_SHADER,e + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i + this.getDefineFragmentName()));
            t.setAttributeAndModes(n),
            this._dirty = !1
        }
    }),
    A.Filter.BlendMultiply = function() {
        A.Filter.call(this);
        var t, e, i = this._stateSet, n = 0, r = 1;
        2 === arguments.length ? (t = arguments[0],
        e = arguments[1],
        n = 1,
        n = 2,
        i.setTextureAttributeAndModes(n, t)) : 1 === arguments.length && (e = arguments[0]),
        i.setTextureAttributeAndModes(r, e),
        i.addUniform(p.createInt1(n, "Texture0")),
        i.addUniform(p.createInt1(r, "Texture1")),
        this._fragmentName = "BlendMultiply"
    }
    ,
    A.Filter.BlendMultiply.prototype = r.objectInherit(A.Filter.prototype, {
        build: function() {
            var t = A.Filter.defaultVertexShader
              , e = ["", A.Filter.defaultFragmentShaderHeader, "uniform sampler2D Texture1;", "uniform float MixValue;", "void main (void)", "{", "  gl_FragColor = texture2D(Texture0,vTexCoord0)*texture2D(Texture1,vTexCoord0);", "}", ""].join("\n")
              , i = new g(new m(m.VERTEX_SHADER,t + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,e + this.getDefineFragmentName()));
            this._stateSet.setAttributeAndModes(i),
            this._dirty = !1
        }
    }),
    A.Filter.SSAO = function(t) {
        A.Filter.call(this);
        var e = this._stateSet
          , i = 16
          , n = .05;
        if (void 0 !== t) {
            void 0 !== t.nbSamples && (i = t.nbSamples),
            void 0 !== t.radius && (n = t.radius);
            var r = t.normal
              , a = t.position
              , s = r.getWidth()
              , o = r.getHeight();
            this._size = b.fromValues(s, o),
            e.setTextureAttributeAndModes(0, r),
            e.setTextureAttributeAndModes(1, a)
        }
        this._radius = n,
        this._nbSamples = i,
        this._noiseTextureSize = 16,
        this._sceneRadius = 2,
        e.addUniform(p.createFloat1(1, "Power")),
        e.addUniform(p.createFloat1(n, "Radius")),
        e.addUniform(p.createInt1(0, "Texture0")),
        e.addUniform(p.createInt1(1, "Texture1")),
        e.addUniform(p.createInt1(2, "Texture2")),
        e.addUniform(p.createFloat1(.1, "AngleLimit")),
        this.initNoise(),
        this._fragmentName = "SSAO"
    }
    ,
    A.Filter.SSAO.prototype = r.objectInherit(A.Filter.prototype, {
        initNoise: function() {
            var t = this._noiseTextureSize
              , e = new Array(t * t * 3);
            !function(e) {
                for (var i = b.fromValues(0, 0), n = 0; n < t * t; n++)
                    i[0] = 2 * (Math.random() - .5),
                    i[1] = 2 * (Math.random() - .5),
                    b.normalize(i, i),
                    e[3 * n + 0] = 255 * (.5 * i[0] + .5),
                    e[3 * n + 1] = 255 * (.5 * i[1] + .5),
                    e[3 * n + 2] = 127.5
            }(e);
            var i = new u;
            i.setWrapS("REPEAT"),
            i.setWrapT("REPEAT"),
            i.setMinFilter("NEAREST"),
            i.setMagFilter("NEAREST"),
            i.setTextureSize(t, t),
            i.setImage(new Uint8Array(e), "RGB"),
            this._noiseTexture = i
        },
        setSceneRadius: function(t) {
            this._sceneRadius = t,
            this.dirty()
        },
        setAngleLimit: function(t) {
            var e = this._stateSet.getUniform("AngleLimit");
            e.setFloat(t)
        },
        setNbSamples: function(t) {
            t !== this._nbSamples && (this._nbSamples = Math.floor(t),
            this.dirty())
        },
        setRadius: function(t) {
            var e = this._stateSet.getUniform("Radius");
            e.setFloat(t)
        },
        setPower: function(t) {
            var e = this._stateSet.getUniform("Power");
            e.setFloat(t)
        },
        build: function() {
            var t = this._stateSet
              , e = this._nbSamples
              , i = new Array(4 * e);
            !function(t) {
                for (var i = x.create(), n = 0; n < e; n++) {
                    i[0] = 2 * (Math.random() - .5),
                    i[1] = 2 * (Math.random() - .5),
                    i[2] = Math.random(),
                    x.normalize(i, i);
                    var r = Math.max(n / e, .1);
                    r = .1 + .9 * (r * r),
                    t[3 * n + 0] = i[0],
                    t[3 * n + 1] = i[1],
                    t[3 * n + 2] = i[2],
                    t[3 * n + 3] = r
                }
            }(i),
            t.setTextureAttributeAndModes(2, this._noiseTexture);
            var n = t.getUniform("noiseSampling");
            void 0 === n ? (n = p.createFloat2(b.fromValues(this._size[0] / this._noiseTextureSize, this._size[1] / this._noiseTextureSize), "noiseSampling"),
            t.addUniform(n)) : n.setVec2(b.fromValues(this._size[0] / this._noiseTextureSize, this._size[1] / this._noiseTextureSize));
            for (var r = ["", "attribute vec3 Vertex;", "attribute vec2 TexCoord0;", "varying vec2 vTexCoord0;", "uniform mat4 uModelViewMatrix;", "uniform mat4 uProjectionMatrix;", "void main(void) {", "  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex,1.0);", "  vTexCoord0 = TexCoord0;", "}", ""].join("\n"), a = [], s = 0; s < e; s++)
                a.push("kernel[" + s + "] = vec4(" + i[3 * s] + "," + i[3 * s + 1] + ", " + i[3 * s + 2] + ", " + i[3 * s + 3] + ");");
            a = a.join("\n");
            var o = ["", A.Filter.defaultFragmentShaderHeader, "uniform sampler2D Texture1;", "uniform sampler2D Texture2;", "uniform mat4 projection;", "uniform vec2 noiseSampling;", "uniform float Power;", "uniform float Radius;", "uniform float AngleLimit;", "#define NB_SAMPLES " + this._nbSamples, "float depth;", "vec3 normal;", "vec4 position;", "vec4 kernel[" + e + "];", "mat3 computeBasis()", "{", "  vec2 uvrand = vTexCoord0*noiseSampling;", "  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);", "  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));", "  vec3 bitangent = cross(normal, tangent);", "  mat3 tbn = mat3(tangent, bitangent, normal);", "  return tbn;", "}", "void main (void)", "{", a, "  position = texture2D(Texture1, vTexCoord0);", "  vec4 p = texture2D(Texture0, vTexCoord0);", "  depth = p.w;", "  normal = vec3(p);", "  if ( position.w == 0.0) {", "     gl_FragColor = vec4(1.0,1.0,1.0,0.0);", "     return;", "  }", "", " mat3 tbn = computeBasis();", " float occlusion = 0.0;", " for (int i = 0; i < NB_SAMPLES; i++) {", "    vec3 vecKernel = vec3(kernel[i]);", "    vecKernel[2] = max(AngleLimit,vecKernel[2]);", "    vec3 sample = tbn * vecKernel;", "    vec3 dir = sample;", "    float w = dot(dir, normal);", "    float dist = 1.0-kernel[i].w;", "    w *= dist*dist*Power;", "    sample = dir * float(Radius) + position.xyz;", "    vec4 offset = projection * vec4(sample,1.0);", "    offset.xy /= offset.w;", "    offset.xy = offset.xy * 0.5 + 0.5;", "    float sample_depth = texture2D(Texture1, offset.xy).z;", "    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;", "    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;", " }", " occlusion = 1.0 - (occlusion / float(NB_SAMPLES));", " gl_FragColor = vec4(vec3(occlusion),1.0);", "}", ""].join("\n")
              , u = new g(new m(m.VERTEX_SHADER,r + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,o + this.getDefineFragmentName()));
            t.setAttributeAndModes(u),
            this._dirty = !1
        }
    }),
    A.Filter.SSAO8 = function(t) {
        A.Filter.SSAO.call(this, t),
        this._fragmentName = "SSAO8"
    }
    ,
    A.Filter.SSAO8.prototype = r.objectInherit(A.Filter.SSAO.prototype, {
        buildGeometry: function(t) {
            return t.getAttributes().TexCoord1 = this._texCoord1,
            t
        },
        build: function() {
            var t = this._stateSet
              , e = this._nbSamples
              , i = new Array(4 * e);
            !function(t) {
                for (var i = x.create(), n = 0; n < e; n++) {
                    i[0] = 2 * (Math.random() - .5),
                    i[1] = 2 * (Math.random() - .5),
                    i[2] = Math.random(),
                    x.normalize(i, i);
                    var r = Math.max(n / e, .1);
                    r = .1 + .9 * (r * r),
                    t[3 * n + 0] = i[0],
                    t[3 * n + 1] = i[1],
                    t[3 * n + 2] = i[2],
                    t[3 * n + 3] = r
                }
            }(i),
            t.setTextureAttributeAndModes(2, this._noiseTexture);
            var n = t.getUniform("noiseSampling");
            void 0 === n ? (n = p.createFloat2(b.fromValues(this._size[0] / this._noiseTextureSize, this._size[1] / this._noiseTextureSize), "noiseSampling"),
            t.addUniform(n)) : n.setVec2(b.fromValues(this._size[0] / this._noiseTextureSize, this._size[1] / this._noiseTextureSize));
            for (var r = ["", "attribute vec3 Vertex;", "attribute vec2 TexCoord0;", "attribute vec3 TexCoord1;", "varying vec2 vTexCoord0;", "varying vec3 vTexCoord1;", "uniform mat4 uModelViewMatrix;", "uniform mat4 uProjectionMatrix;", "void main(void) {", "  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex,1.0);", "  vTexCoord0 = TexCoord0;", "  vTexCoord1 = TexCoord1;", "}", ""].join("\n"), a = [], s = 0; s < e; s++)
                a.push("kernel[" + s + "] = vec4(" + i[3 * s] + "," + i[3 * s + 1] + ", " + i[3 * s + 2] + ", " + i[3 * s + 3] + ");");
            a = a.join("\n");
            var o = ["", A.Filter.defaultFragmentShaderHeader, "varying vec3 vTexCoord1;", "uniform sampler2D Texture1;", "uniform sampler2D Texture2;", "uniform mat4 projection;", "uniform vec2 noiseSampling;", "uniform float Power;", "uniform float Radius;", "uniform float AngleLimit;", "#define NB_SAMPLES " + this._nbSamples, "float depth;", "float znear, zfar, zrange;", "vec3 normal;", "vec3 position;", "vec4 kernel[" + e + "];", A.Filter.shaderUtils, "mat3 computeBasis()", "{", "  vec2 uvrand = vTexCoord0*noiseSampling;", "  //uvrand = rand(gl_FragCoord.xy);", "  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);", "  //vec3 rvec = normalize(vec3(uvrand,0.0));", "  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));", "  vec3 bitangent = cross(normal, tangent);", "  mat3 tbn = mat3(tangent, bitangent, normal);", "  return tbn;", "}", "float getDepthValue(vec4 v) {", "  float depth = unpack4x8ToFloat(v);", "  depth = depth*zrange+znear;", "  //depth = depth*zrange;", "  return -depth;", "}", "void main (void)", "{", a, "  vec4 p = texture2D(Texture0, vTexCoord0);", "  if (dot(p,p) < 0.001) { ", "     gl_FragColor = vec4(1.0,1.0,1.0,0.0);", "     return;", "  }", "  znear = projection[3][2] / (projection[2][2]-1.0);", "  zfar = projection[3][2] / (projection[2][2]+1.0);", "  zrange = zfar-znear;", "  depth = getDepthValue(texture2D(Texture1, vTexCoord0));", "  if ( -depth < znear) {", "     gl_FragColor = vec4(1.0,1.0,1.0,0.0);", "     return;", "  }", "  normal = decodeNormal(unpack4x8To2Float(p));", "  position = -vTexCoord1*depth;", "  position.z = -position.z;", "", " mat3 tbn = computeBasis();", " float occlusion = 0.0;", " for (int i = 0; i < NB_SAMPLES; i++) {", "    vec3 vecKernel = vec3(kernel[i]);", "    vecKernel[2] = max(AngleLimit,vecKernel[2]);", "    vec3 sample = tbn * vec3(vecKernel);", "    vec3 dir = sample;", "    float w = dot(dir, normal);", "    float dist = 1.0-kernel[i].w;", "    w *= dist*dist*Power;", "    sample = dir * float(Radius) + position.xyz;", "    vec4 offset = projection * vec4(sample,1.0);", "    offset.xy /= offset.w;", "    offset.xy = offset.xy * 0.5 + 0.5;", "    float sample_depth = getDepthValue(texture2D(Texture1, offset.xy));", "    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;", "    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;", " }", " occlusion = 1.0 - (occlusion / float(NB_SAMPLES));", " gl_FragColor = vec4(vec3(occlusion),1.0);", "}", ""].join("\n")
              , u = new g(new m(m.VERTEX_SHADER,r + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,o + this.getDefineFragmentName()));
            t.setAttributeAndModes(u),
            this._dirty = !1
        }
    }),
    t.exports = A
}
, function(t, e, i) {
    "use strict";
    var n = i(1312)
      , r = function(t, e) {
        var i, n;
        e ? (i = e[0],
        n = e[1]) : (i = t[14] / (t[10] - 1),
        n = t[14] / (1 + t[10]));
        var r = i * (t[8] - 1) / t[0]
          , a = i * (1 + t[8]) / t[0]
          , s = i * (1 + t[9]) / t[5]
          , o = i * (t[9] - 1) / t[5]
          , u = n * (t[8] - 1) / t[0]
          , l = n * (1 + t[8]) / t[0]
          , c = n * (1 + t[9]) / t[5]
          , h = n * (t[9] - 1) / t[5]
          , d = this.getAttributes().Vertex
          , p = d.getElements();
        p[0] = r,
        p[1] = o,
        p[2] = -i,
        p[3] = a,
        p[4] = o,
        p[5] = -i,
        p[6] = a,
        p[7] = s,
        p[8] = -i,
        p[9] = r,
        p[10] = s,
        p[11] = -i,
        p[12] = u,
        p[13] = h,
        p[14] = -n,
        p[15] = l,
        p[16] = h,
        p[17] = -n,
        p[18] = l,
        p[19] = c,
        p[20] = -n,
        p[21] = u,
        p[22] = c,
        p[23] = -n,
        d.dirty()
    }
      , a = function() {
        var t = n.createBoundingBoxGeometry();
        return t.updateGeometry = r,
        t
    };
    t.exports = {
        createDebugFrustumGeometry: a
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1229)
      , a = i(1234)
      , s = i(1243)
      , o = i(1245)
      , u = i(1244)
      , l = i(1226)
      , c = i(1238)
      , h = i(1290)
      , d = i(1212).vec3
      , p = i(1372)
      , f = i(1373)
      , g = i(1282)
      , m = i(1283)
      , v = i(1332)
      , _ = function() {
        f.apply(this, arguments)
    };
    _.prototype = n.objectInherit(f.prototype, {
        getFragmentShaderName: function() {
            return "CompilerOffsetNormal"
        },
        initTextureAttributes: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.getNode("SetAlpha").inputs({
                color: this.getOrCreateUniform("vec3", "uColorDebug"),
                alpha: this.createVariable("float").setValue("1.0")
            }).outputs({
                color: t
            }),
            [t]
        },
        getOffsetDirection: function() {
            return this.getOrCreateModelNormal()
        },
        getOrCreateModelVertex: function() {
            var t = this.getVariable("vertexOffset");
            if (t)
                return t;
            t = this.createVariable("vec3", "vertexOffset");
            var e = "%out = %offset == 1.0 ? %vertex + normalize(%direction.xyz) * %scale: %vertex;";
            return this.getNode("InlineCode").code(e).inputs({
                offset: this.getOrCreateAttribute("float", "Offset"),
                direction: this.getOffsetDirection(),
                vertex: f.prototype.getOrCreateModelVertex.call(this),
                scale: this.getOrCreateUniform("float", "uScale")
            }).outputs({
                out: t
            }),
            t
        },
        getOrCreateViewVertex: function() {
            var t = this._variables.FragEyeVector;
            return t && !t.isEmpty() ? t : (t = this._varyings.FragEyeVector || this.createVariable("vec4", "FragEyeVector"),
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uViewMatrix"),
                vec: this.getOrCreateModelVertex()
            }).outputs({
                vec: t
            }),
            t)
        }
    });
    var b = function() {
        p.apply(this, arguments),
        this.setShaderCompiler(_)
    };
    b.prototype = p.prototype;
    var x = function() {
        _.apply(this, arguments)
    };
    x.prototype = n.objectInherit(_.prototype, {
        getFragmentShaderName: function() {
            return "CompilerOffsetTangent"
        },
        getOffsetDirection: function() {
            return this.getOrCreateModelTangent()
        }
    });
    var A = function() {
        p.apply(this, arguments),
        this.setShaderCompiler(x)
    };
    A.prototype = p.prototype;
    var y = function() {
        r.call(this),
        this._unifScale = c.createFloat(1, "uScale");
        var t = this._normalStateSet = new l;
        t.addUniform(c.createFloat3(d.fromValues(1, 0, 0), "uColorDebug")),
        t.addUniform(this._unifScale),
        t.setAttributeAndModes(new h(h.NEVER)),
        t.setShaderGeneratorName("debugNormal");
        var e = this._tangentStateSet = new l;
        e.addUniform(c.createFloat3(d.fromValues(0, 1, 0), "uColorDebug")),
        e.addUniform(this._unifScale),
        e.setAttributeAndModes(new h(h.NEVER)),
        e.setShaderGeneratorName("debugTangent")
    };
    y.CompilerOffsetNormal = _,
    y.CompilerOffsetTangent = x,
    y.ShaderGeneratorCompilerOffsetNormal = b,
    y.ShaderGeneratorCompilerOffsetTangent = A,
    y.prototype = n.objectInherit(r.prototype, {
        setScale: function(t) {
            this._unifScale.setFloat(t)
        },
        setTangentVisibility: function(t) {
            this._tangentStateSet.setAttributeAndModes(new h(t ? h.LESS : h.NEVER))
        },
        setNormalVisibility: function(t) {
            this._normalStateSet.setAttributeAndModes(new h(t ? h.LESS : h.NEVER))
        },
        apply: function(t) {
            for (var e = t.getUpdateCallbackList(), i = 0, n = e.length; i < n; ++i)
                e[i]instanceof v && (e[i]._isInitialized = !1);
            if (!t._isVisitedNormalDebug) {
                if (t._isVisitedNormalDebug = !0,
                t instanceof a == !1)
                    return this.traverse(t);
                this._createDebugGeom(t, "Normal", this._normalStateSet),
                this._createDebugGeom(t, "Tangent", this._tangentStateSet)
            }
        },
        _createDoubleOffsetArray: function(t) {
            for (var e = new Float32Array(2 * t), i = 0; i < t; ++i)
                e[2 * i] = 1;
            return new s(s.ARRAY_BUFFER,e,1)
        },
        _createDoubledBufferArray: function(t) {
            t.getInitialBufferArray && (t = t.getInitialBufferArray());
            for (var e = t.getItemSize(), i = t.getElements(), n = i.length / e, r = i.constructor, a = new r(2 * i.length), o = 0; o < n; ++o)
                for (var u = o * e, l = 2 * u, c = 0; c < e; ++c)
                    a[l + c] = a[l + c + e] = i[u + c];
            return new s(s.ARRAY_BUFFER,a,e)
        },
        _addMorphTargets: function(t, e, i) {
            var n = e.getMorphTargets();
            e.setName(t.getName());
            for (var r = t.getMorphTargets(), s = 0, o = r.length; s < o; ++s) {
                var u = r[s]
                  , l = u.getVertexAttributeList()
                  , c = new a;
                c.setName(u.getName());
                var h = c.getVertexAttributeList();
                h.Vertex = this._createDoubledBufferArray(l.Vertex),
                l[i] && (h[i] = this._createDoubledBufferArray(l[i])),
                n.push(c)
            }
            return e.mergeChildrenVertexAttributeList(),
            e
        },
        _createDebugGeom: function(t, e, i) {
            var n = t.getAttributes()
              , r = n[e];
            if (r) {
                var s = n.Vertex;
                if (s) {
                    var l;
                    t instanceof m ? l = t : t.getSourceGeometry && t.getSourceGeometry()instanceof m && (l = t.getSourceGeometry());
                    var c = s.getElements().length / s.getItemSize()
                      , h = l ? new m : new a;
                    h.getAttributes().Vertex = this._createDoubledBufferArray(s),
                    h.getAttributes().Offset = this._createDoubleOffsetArray(c),
                    h.getAttributes()[e] = this._createDoubledBufferArray(r),
                    h.getPrimitives().push(new o(u.LINES,0,2 * c)),
                    l && this._addMorphTargets(l, h, e);
                    var d;
                    if (t instanceof g) {
                        var p = new g;
                        p.setSourceGeometry(h),
                        p.getVertexAttributeList().Bones = this._createDoubledBufferArray(n.Bones),
                        p.getVertexAttributeList().Weights = this._createDoubledBufferArray(n.Weights),
                        p._rigTransformImplementation = t._rigTransformImplementation,
                        p._stateSetAnimation = t._stateSetAnimation,
                        p.mergeChildrenData(),
                        d = p
                    } else
                        d = h;
                    var f = t.getParents()
                      , v = f.length;
                    d._isVisitedNormalDebug = !0,
                    d._isNormalDebug = !0,
                    d.setStateSet(i);
                    for (var _ = 0; _ < v; ++_)
                        f[_].addChild(d);
                    return d
                }
            }
        }
    }),
    t.exports = y
}
, function(t, e, i) {
    "use strict";
    var n = (i(1207),
    i(1306))
      , r = i(1311)
      , a = i(1227)
      , s = i(1373)
      , o = i(1382)
      , u = ["ShadowReceive", "Skinning", "Morph", "ShadowTexture", "Texture", "Light", "Material", "Billboard"]
      , l = function() {
        this._cache = new window.Map,
        this._shaderProcessor = new o,
        this._acceptAttributeTypes = new window.Set(u),
        this._ShaderCompiler = s
    };
    l.prototype = {
        setShaderCompiler: function(t) {
            this._ShaderCompiler = t
        },
        getShaderCompiler: function() {
            return this._ShaderCompiler
        },
        getAcceptAttributeTypes: function() {
            return this._acceptAttributeTypes
        },
        getShaderProcessor: function() {
            return this._shaderProcessor
        },
        setShaderProcessor: function(t) {
            this._shaderProcessor = t
        },
        filterAttributeTypes: function(t) {
            if ("osg" !== t.libraryName() && "osgShadow" !== t.libraryName() && "osgAnimation" !== t.libraryName())
                return !0;
            var e = t.getType();
            return !this._acceptAttributeTypes.has(e) || !(!t.isEnabled || t.isEnabled())
        },
        getActiveAttributeList: function(t, e) {
            for (var i = "", n = t.attributeMap, r = n.getKeys(), a = 0, s = r.length; a < s; a++) {
                var o = r[a]
                  , u = n[o]
                  , l = u.lastApplied;
                this.filterAttributeTypes(l) || (i += l.getHash ? l.getHash() : l.getType(),
                e.push(l))
            }
            return i
        },
        getActiveTextureAttributeList: function(t, e) {
            var i, n, r = "", a = t.textureAttributeMapList;
            for (i = 0,
            n = a.length; i < n; i++) {
                var s = a[i];
                if (s) {
                    e[i] = [];
                    for (var o = s.getKeys(), u = 0, l = o.length; u < l; u++) {
                        var c = o[u]
                          , h = s[c];
                        if (0 !== h.values().length) {
                            var d = h.lastApplied;
                            this.filterAttributeTypes(d) || d.isTextureNull() || (r += d.getHash ? d.getHash() : d.getType(),
                            e[i].push(d))
                        }
                    }
                }
            }
            return r
        },
        getActiveUniforms: function(t, e, i) {
            for (var n = {}, r = 0, s = e.length; r < s; r++) {
                var o = e[r];
                if (o.getOrCreateUniforms) {
                    var u = o.getOrCreateUniforms();
                    if (void 0 !== u)
                        for (var l = u.getKeys(), c = 0, h = l.length; c < h; c++) {
                            var d = l[c]
                              , p = u[d];
                            n[p.getName()] = p
                        }
                }
            }
            for (var f = 0, g = i.length; f < g; f++) {
                var m = i[f];
                if (m)
                    for (var v = 0, _ = m.length; v < _; v++)
                        for (var b = m[v], x = b.getOrCreateUniforms(f), A = x.getKeys(), y = 0, S = A.length; y < S; y++) {
                            var C = A[y]
                              , M = x[C];
                            n[M.getName()] = M
                        }
            }
            return new a(n)
        },
        getOrCreateProgram: function() {
            var t = []
              , e = [];
            return function(i) {
                var a = "";
                e.length = 0,
                t.length = 0,
                a += this.getActiveAttributeList(i, e),
                a += this.getActiveTextureAttributeList(i, t);
                var s = this._cache.get(a);
                if (void 0 !== s)
                    return s;
                var o = this._ShaderCompiler
                  , u = new o(e,t,this._shaderProcessor)
                  , l = u.createFragmentShader()
                  , c = u.createVertexShader()
                  , h = new n(new r(r.VERTEX_SHADER,c),new r(r.FRAGMENT_SHADER,l));
                return h.hash = a,
                h.setActiveUniforms(this.getActiveUniforms(i, e, t)),
                h.generated = !0,
                this._cache.set(a, h),
                h
            }
        }()
    },
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1238)
      , a = i(1374)
      , s = i(1203)
      , o = i(1415)
      , u = i(1416)
      , l = function(t, e, i) {
        this._attributes = t,
        this._textureAttributes = e,
        this._fragmentShaderMode = !1,
        this._activeNodeList = {},
        this._compiledNodeList = {},
        this._traversedNodeList = {},
        this._variables = {},
        this._varyings = {},
        this._vertexShader = [],
        this._fragmentShader = [],
        this._shaderProcessor = i,
        this._texturesByName = {},
        this._shadowsTextures = [],
        this._lights = [],
        this._shadows = [],
        this._textures = [],
        this._material = null,
        this._invariantPosition = !1,
        this._isBillboard = !1,
        this._customVertexShader = !1,
        this._customFragmentShader = !1,
        this.initAttributes(),
        this.initTextureAttributes()
    };
    l.prototype = s.extend({}, o, u, {
        getOrCreateProjectionMatrix: function() {
            return this.getOrCreateUniform("mat4", "uProjectionMatrix")
        },
        getFragmentShaderName: function() {
            return this._material ? "CompilerOSGJS" : "NoMaterialCompilerOSGJS"
        },
        getVertexShaderName: function() {
            return this.getFragmentShaderName()
        },
        getOrCreateConstantOne: function(t) {
            return this.getOrCreateConstant(t, t + "White").setValue(t + "(1.0)")
        },
        getOrCreateConstantZero: function(t) {
            return this.getOrCreateConstant(t, t + "Black").setValue(t + "(0.0)")
        },
        initAttributes: function() {
            for (var t = this._attributes, e = this._lights, i = this._shadows, n = 0, r = t.length; n < r; n++) {
                var a = t[n].className();
                "Light" === a ? e.push(t[n]) : "Material" === a ? this._material = t[n] : "ShadowReceiveAttribute" === a ? i.push(t[n]) : "Billboard" === a ? this._isBillboard = !!t[n] : "SkinningAttribute" === a ? this._skinningAttribute = t[n] : "MorphAttribute" === a && (this._morphAttribute = t[n])
            }
        },
        initTextureAttributes: function() {
            var t = this._textureAttributes
              , e = t.length;
            this._textures.length = this._shadowsTextures.length = e;
            for (var i = 0; i < e; i++) {
                var n = t[i];
                if (void 0 !== n)
                    for (var r = 0, a = n.length; r < a; r++)
                        this.registerTextureAttributes(n[r], i)
            }
        },
        registerTextureAttributes: function(t, e) {
            var i = t.className();
            return "Texture" === i ? this.registerTexture(t, e) : "ShadowTexture" === i ? this.registerTextureShadow(t, e) : void 0
        },
        registerTexture: function(t, e) {
            var i = t.getName();
            i || (i = "Texture" + e,
            t.setName(i)),
            this._textures[e] = t,
            this._texturesByName[i] = {
                texture: t,
                variable: void 0,
                textureUnit: e
            }
        },
        registerTextureShadow: function(t, e) {
            var i = t.getName();
            i || (i = "Texture" + e,
            t.setName(i)),
            this._shadowsTextures[e] = t,
            this._texturesByName[i] = {
                texture: t,
                variable: void 0,
                textureUnit: e,
                shadow: !0
            }
        },
        getTextureByName: function(t) {
            var e = this._texturesByName[t];
            if (!e || e.variable)
                return e;
            var i, n = e.texture, r = e.textureUnit, a = n.className(), s = "Texture" + r;
            if ("Texture" === a)
                i = this.getOrCreateSampler("sampler2D", s);
            else {
                if ("TextureCubeMap" !== a)
                    return;
                i = this.getOrCreateSampler("samplerCube", s)
            }
            var o = this._fragmentShaderMode ? this.getOrCreateVarying("vec2", "vTexCoord" + r) : this.getOrCreateAttribute("vec2", "TexCoord" + r);
            return e.variable = this.createTextureRGBA(n, i, o),
            e
        },
        createShaderFromGraphs: function(t) {
            this._compiledNodeList = {};
            for (var e = window.Object.keys(this._variables), i = [], r = 0, a = e.length; r < a; r++) {
                var s = this._variables[e[r]]
                  , o = s.declare();
                o && i.push(o)
            }
            var u = this.evaluateExtensions(t)
              , l = this.evaluateDefines(t)
              , c = [];
            c.push("\n"),
            c.push(this.evaluateGlobalVariableDeclaration(t)),
            this._invariantPosition && !this._fragmentShaderMode && c.push("\ninvariant gl_Position;"),
            c.push("\n"),
            c.push(this.evaluateGlobalFunctionDeclaration(t)),
            c.push("void main() {"),
            0 !== i.length && (c.push("// vars\n"),
            c.push(i.join(" ")),
            c.push("\n// end vars\n")),
            0 === t.length && n.error("shader without any final Node output (need at least one)"),
            c.push(this.evaluate(t)),
            c.push("}");
            var h = c.join("\n")
              , d = this._shaderProcessor.processShader(h, l, u, this._fragmentShaderMode ? "fragment" : "vertex");
            return d
        },
        getNode: function() {
            var t = a.getNode.apply(a, arguments)
              , e = t.getID();
            return this._activeNodeList[e] = t,
            t
        },
        getVariable: function(t) {
            return this._variables[t]
        },
        getAttributeType: function(t) {
            for (var e = 0; e < this._attributes.length; e++)
                if (this._attributes[e].getType() === t)
                    return this._attributes[e]
        },
        createVariable: function(t, e, i) {
            var n = e;
            if (void 0 === n) {
                var r = window.Object.keys(this._variables).length;
                n = "tmp_" + r
            } else if (this._variables[n]) {
                if (n += i,
                void 0 === i)
                    return this.createVariable(t, e, 1);
                if (this._variables[n])
                    return i++,
                    this.createVariable(t, e, i)
            }
            var a = this.getNode("Variable", t, n);
            return this._variables[n] = a,
            a
        },
        getOrCreateUniformFromUniformMap: function(t, e) {
            for (var i = window.Object.keys(t), n = {}, r = e ? e : "", a = 0; a < i.length; a++) {
                var s = r + i[a];
                n[s] = this.getOrCreateUniform(t[i[a]])
            }
            return n
        },
        getOrCreateTextureStateAttributeUniforms: function(t, e, i) {
            var n = t.getOrCreateUniforms(i);
            return this.getOrCreateUniformFromUniformMap(n, e)
        },
        getOrCreateStateAttributeUniforms: function(t, e) {
            var i = t.getOrCreateUniforms();
            return this.getOrCreateUniformFromUniformMap(i, e)
        },
        getOrCreateUniform: function(t, e, i) {
            var a = e;
            if (t instanceof r) {
                var s = t;
                t = s.getType(),
                a = s.getName()
            } else
                void 0 === a && n.error("Cannot create unamed Uniform");
            var o = this._variables[a];
            if (o && o.getType() === t)
                return o;
            var u = this.getNode("Uniform", t, a, i);
            return this._variables[a] = u,
            u
        },
        getOrCreateSampler: function(t, e) {
            void 0 === e && n.error("No name given for sampler type : " + t);
            var i = this._variables[e];
            if (i)
                return i;
            var r = this.getNode("Sampler", t, e);
            return this._variables[e] = r,
            r
        },
        getOrCreateAttribute: function(t, e) {
            this._fragmentShaderMode && n.error("No Vertex Attribute in Fragment Shader");
            var i = this._variables[e];
            if (i)
                return i;
            var r = this.getNode("Attribute", t, e);
            return this._variables[e] = r,
            r
        },
        getOrCreateConstant: function(t, e) {
            var i = e;
            if (void 0 === i) {
                var n = window.Object.keys(this._variables).length;
                i = "tmp_" + n
            } else {
                var r = this._variables[i];
                if (r)
                    return r
            }
            var a = this.getNode("Constant", t, i);
            return this._variables[i] = a,
            a
        },
        getOrCreateVarying: function(t, e) {
            void 0 === e && n.error("Error: Mandatory to name varying (as you need to retrieve them)");
            var i = this._variables[e];
            return i ? (this._varyings[e] || n.error("Error: requesting a varying not declared with getOrCreateVarying previously"),
            i.getType() !== t && n.error("Error: Same varying, but different type"),
            i) : (this._fragmentShaderMode || this._customFragmentShader || n.error("Error: requesting a varying not declared in Fragment Shader Graph (for Custom Vertex Shader, add this._customFragmentShader to the processor): " + e + " " + t),
            i = this._variables[e] = this._varyings[e] = this.getNode("Varying", t, e))
        },
        markNodeAsVisited: function(t) {
            var e = t.getID();
            this._activeNodeList[e] === t ? this._compiledNodeList[e] = t : n.warn("Node not requested by using Compiler getNode and/or not registered in nodeFactory " + t.toString())
        },
        checkOrMarkNodeAsTraversed: function(t) {
            var e = t.getID();
            return !!this._traversedNodeList[e] || (this._traversedNodeList[e] = t,
            !1)
        },
        traverse: function(t, e) {
            if (!this.checkOrMarkNodeAsTraversed(e)) {
                var i = e.getInputs();
                if (!Array.isArray(i)) {
                    for (var n = window.Object.keys(i), r = [], a = 0; a < n.length; a++)
                        r.push(i[n[a]]);
                    i = r
                }
                for (var s = 0, o = i.length; s < o; s++) {
                    e.checkInputsOutputs();
                    var u = i[s];
                    void 0 !== u && u !== e && this.traverse(t, u)
                }
                t.call(t, e),
                this.markNodeAsVisited(e)
            }
        },
        preTraverse: function(t) {
            return this._traversedNodeList = {},
            t._map = {},
            t._text = [],
            t
        },
        evaluateAndGatherField: function(t, e) {
            var i = function(t) {
                var i = t.getType();
                if (void 0 !== i && "" !== i || n.error("Your node " + t + " has no type"),
                t[e] && void 0 === this._map[i]) {
                    this._map[i] = !0;
                    var r = t[e]();
                    Array.prototype.push.apply(this._text, r)
                }
            };
            this.preTraverse(i);
            for (var r = 0, a = t.length; r < a; r++)
                this.traverse(i, t[r]);
            return i._text
        },
        evaluateGlobalFunctionDeclaration: function(t) {
            var e = function(t) {
                var e = t.getType();
                if (void 0 !== e && "" !== e || n.error("Your node " + t + " has no type"),
                t.globalFunctionDeclaration && void 0 === this._map[e]) {
                    this._map[e] = !0;
                    var i = t.globalFunctionDeclaration();
                    void 0 !== i && this._text.push(i)
                }
            };
            this.preTraverse(e);
            for (var i = 0, r = t.length; i < r; i++)
                this.traverse(e, t[i]);
            return e._text.join("\n")
        },
        evaluateGlobalVariableDeclaration: function(t) {
            var e = function(t) {
                var e = t.getID();
                if (t.globalDeclaration && void 0 === this._map[e]) {
                    this._map[e] = !0;
                    var i = t.globalDeclaration();
                    void 0 !== i && this._text.push(i)
                }
            };
            this.preTraverse(e);
            var i = 0
              , n = t.length;
            for (i = 0; i < n; i++)
                this.traverse(e, t[i]);
            var r = e._text
              , a = r.length;
            if (a > 0) {
                this.sortDeclarations(r);
                var s = r[0][0];
                for (i = 0; i < a; ++i) {
                    var o = r[i][0];
                    o !== s && (s = o,
                    r[i - 1] += "\n")
                }
            }
            return r.join("\n")
        },
        sortDeclarations: function(t) {
            if (t.sort(),
            !this._fragmentShaderMode)
                for (var e = 0, i = t.length; e < i; ++e) {
                    var n = t[e];
                    if ("a" !== n[0])
                        break;
                    if (n.indexOf("Vertex") !== -1) {
                        t.splice(e, 1),
                        t.unshift(n);
                        break
                    }
                }
        },
        evaluate: function(t) {
            var e = function(t) {
                var e = t.getID();
                if (void 0 === this._map[e]) {
                    var i = t.computeShader();
                    if (void 0 !== i) {
                        if (void 0 !== t.getComment) {
                            var n = t.getComment();
                            void 0 !== n && this._text.push(n)
                        }
                        this._text.push(i)
                    }
                    this._map[e] = !0
                }
            };
            this.preTraverse(e);
            for (var i = 0, n = t.length; i < n; i++)
                this.traverse(e, t[i]);
            return e._text.join("\n")
        },
        evaluateDefines: function(t) {
            return this.evaluateAndGatherField(t, "getDefines")
        },
        evaluateExtensions: function(t) {
            return this.evaluateAndGatherField(t, "getExtensions")
        }
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1375)
      , a = i(1408)
      , s = i(1410)
      , o = i(1411)
      , u = i(1413)
      , l = i(1412)
      , c = i(1409)
      , h = i(1406)
      , d = i(1414)
      , p = function() {
        this._nodes = new window.Map,
        this.registerNodes(r),
        this.registerNodes(a),
        this.registerNodes(c),
        this.registerNodes(s),
        this.registerNodes(o),
        this.registerNodes(h),
        this.registerNodes(u),
        this.registerNodes(l),
        this.registerNodes(d)
    };
    p.prototype = {
        registerNodes: function(t) {
            var e = this;
            window.Object.keys(t).forEach(function(i) {
                e.registerNode(i, t[i])
            })
        },
        registerNode: function(t, e) {
            this._nodes.has(t) && n.warn("Node " + t + " already registered"),
            this._nodes.set(t, e)
        },
        getNode: function(t) {
            var e = this._nodes.get(t);
            if (!e)
                return void n.warn("Node " + t + " does not exist");
            var i = window.Object.create(e.prototype);
            return e.apply(i, Array.prototype.slice.call(arguments, 1)),
            i
        }
    };
    var f = new p;
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1376)
      , a = i(1407)
      , s = function() {
        a.call(this)
    };
    s.prototype = n.objectInherit(a.prototype, {
        type: "Skinning",
        validInputs: ["weights", "bonesIndex", "matrixPalette"],
        validOutputs: ["mat4"],
        globalFunctionDeclaration: function() {
            return '#pragma include "skinning.glsl"'
        },
        computeShader: function() {
            return r.callFunction("skeletalTransform", this._outputs.mat4, [this._inputs.weights, this._inputs.bonesIndex])
        }
    }),
    t.exports = {
        Skinning: s
    }
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e) {
        if (!t || !e)
            return "";
        var i;
        for (var n in e)
            i = e[n],
            void 0 !== i && (i.getVariable && (i = i.getVariable()),
            t = t.replace("%s", i));
        return t
    }
      , r = function(t, e) {
        var i = t
          , n = []
          , r = e;
        void 0 === e && (r = "");
        for (var a = 0, s = i.length; a < s; a++) {
            var o, u = i[a];
            o = void 0 === u ? "undefined" : "string" == typeof u ? u : u.getType ? u.getType() + " " + u.getVariable() : u.getVariable(),
            n.push(r + o)
        }
        return n
    }
      , a = function(t, e, n) {
        var a = i(1377)
          , s = []
          , o = "";
        if (a.debugShaderNode && (s.push("\n// output"),
        Array.prototype.push.apply(s, r([e], "// "))),
        e && (e.getVariable && (e = e.getVariable()),
        o = e + " = "),
        o = o + t + "( ",
        n && n.length > 0) {
            a.debugShaderNode && (s.push("// inputs"),
            Array.prototype.push.apply(s, r(n, "// ")));
            for (var u = 0, l = n.length; u < l; u++)
                o += n[u].getVariable ? n[u].getVariable() : n[u],
                u !== l - 1 && (o += ", ")
        }
        return o += " );\n",
        a.debugShaderNode ? s.join("\n") + "\n" + o : o
    };
    t.exports = {
        callFunction: a,
        checkVariableType: r,
        sprintf: n
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1373)
      , r = i(1372)
      , a = i(1378)
      , s = i(1382)
      , o = i(1374)
      , u = i(1405)
      , l = i(1376)
      , c = {};
    c.Compiler = n,
    c.ShaderGenerator = r,
    c.ShaderGeneratorProxy = a,
    c.ShaderProcessor = s,
    c.nodeFactory = o,
    c.node = u,
    c.utils = l,
    c.debugShaderNode = !1,
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(1372)
      , r = i(1379)
      , a = i(1371)
      , s = i(1381)
      , o = function() {
        return this._generators = new window.Map,
        this.addShaderGenerator("default", new n),
        this.addShaderGenerator("ShadowCast", new r),
        this.addShaderGenerator("debugNormal", new a.ShaderGeneratorCompilerOffsetNormal),
        this.addShaderGenerator("debugTangent", new a.ShaderGeneratorCompilerOffsetTangent),
        this.addShaderGenerator("debugGeometry", new s.ShaderGeneratorCompilerColorGeometry),
        this.addShaderGenerator("debugSkinning", new s.ShaderGeneratorCompilerColorSkinning),
        this
    };
    o.prototype = {
        getShaderGenerator: function(t) {
            return t ? this._generators.get(t) : this._generators.get("default")
        },
        addShaderGenerator: function(t, e) {
            this._generators.set(t, e)
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1372)
      , r = i(1380)
      , a = function() {
        n.apply(this, arguments),
        this.setShaderCompiler(r),
        this._acceptAttributeTypes = new window.Set(["ShadowCast", "Skinning", "Morph"])
    };
    a.prototype = n.prototype,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1373)
      , a = function() {
        r.apply(this, arguments)
    };
    a.prototype = n.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "ShadowCast"
        },
        getFragmentShaderName: function() {
            return this.getCompilerName()
        },
        initAttributes: function() {
            for (var t = this._attributes, e = 0, i = t.length; e < i; e++) {
                var n = t[e].className();
                "ShadowCastAttribute" === n ? this._shadowCastAttribute = t[e] : "Billboard" === n ? this._isBillboard = !!t[e] : "SkinningAttribute" === n ? this._skinningAttribute = t[e] : "MorphAttribute" === n && (this._morphAttribute = t[e])
            }
        },
        registerTextureAttributes: function() {},
        createShadowCastDepth: function(t) {
            return this.getNode("ShadowCast").setShadowCastAttribute(this._shadowCastAttribute).inputs({
                exponent0: this.getOrCreateUniform("float", "exponent0"),
                exponent1: this.getOrCreateUniform("float", "exponent1"),
                shadowDepthRange: this.getOrCreateUniform("vec4", "uShadowDepthRange"),
                fragEye: this.getOrCreateVarying("vec4", "vViewVertex")
            }).outputs({
                color: t
            }),
            t
        },
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return [this.createShadowCastDepth(t)]
        }
    }),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1229)
      , a = i(1234)
      , s = i(1282)
      , o = i(1238)
      , u = i(1226)
      , l = i(1212).vec3
      , c = i(1372)
      , h = i(1373)
      , d = i(1243)
      , p = i(1245)
      , f = i(1244)
      , g = i(1247)
      , m = i(1290)
      , v = function() {
        h.apply(this, arguments)
    };
    v.prototype = n.objectInherit(h.prototype, {
        getFragmentShaderName: function() {
            return "CompilerDebugGeometry"
        },
        initTextureAttributes: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.getNode("SetAlpha").inputs({
                color: this.getOrCreateUniform("vec3", "uColorDebug"),
                alpha: this.createVariable("float").setValue("1.0")
            }).outputs({
                color: t
            }),
            [t]
        }
    });
    var _ = function() {
        c.apply(this, arguments),
        this.setShaderCompiler(v)
    };
    _.prototype = c.prototype;
    var b = function() {
        h.apply(this, arguments)
    };
    b.prototype = n.objectInherit(h.prototype, {
        getFragmentShaderName: function() {
            return "CompilerDebugSkinning"
        },
        initTextureAttributes: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.getNode("SetAlpha").inputs({
                color: this.getOrCreateVarying("vec3", "vBonesColor"),
                alpha: this.createVariable("float").setValue("1.0")
            }).outputs({
                color: t
            }),
            [t]
        },
        declareVertexVaryings: function(t) {
            var e = this.getOrCreateVarying("vec3", "vBonesColor");
            return this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec3", "BonesColor")).outputs(e),
            h.prototype.declareVertexVaryings.call(this, t)
        }
    });
    var x = function() {
        c.apply(this, arguments),
        this.setShaderCompiler(b)
    };
    x.prototype = c.prototype;
    var A = function() {
        r.call(this),
        this._debugColor = !0,
        this._debugSkinning = !1,
        this._stCenter = new u,
        this._stCenter.setShaderGeneratorName("debugGeometry")
    };
    A.CompilerColorGeometry = v,
    A.ShaderGeneratorCompilerColorGeometry = _,
    A.CompilerSkinningGeometry = b,
    A.ShaderGeneratorCompilerColorSkinning = x,
    A.prototype = n.objectInherit(r.prototype, {
        setGeometryDebug: function(t) {
            this._stCenter.setAttributeAndModes(new m(m.ALWAYS)),
            this._debugColor = !0,
            this._debugSkinning = !1,
            this.apply(t)
        },
        setSkinningDebug: function(t) {
            this._stCenter.setAttributeAndModes(new m(m.NEVER)),
            this._debugColor = !1,
            this._debugSkinning = !0,
            this.apply(t)
        },
        disableDebug: function(t) {
            this._stCenter.setAttributeAndModes(new m(m.NEVER)),
            this._debugColor = !1,
            this._debugSkinning = !1,
            this.apply(t)
        },
        apply: function(t) {
            if (!t._isNormalDebug && !t._isCenterDebug) {
                if (t instanceof a)
                    if (this._debugColor || this._debugSkinning && t instanceof s) {
                        void 0 === t._originalStateSet && (t._originalStateSet = t.getStateSet() || null);
                        var e = new u;
                        if (t.setStateSet(e),
                        this._debugSkinning) {
                            e.setShaderGeneratorName("debugSkinning");
                            var i = t.getVertexAttributeList();
                            if (!i.BonesColor) {
                                for (var n = i.Bones.getElements(), r = i.Weights.getElements(), c = t._rigTransformImplementation._bones, h = n.length / 4, m = new Float32Array(3 * h), v = 0; v < h; ++v) {
                                    var _ = 4 * v
                                      , b = c[n[_]].getOrCreateDebugColor()
                                      , x = c[n[_ + 1]].getOrCreateDebugColor()
                                      , A = c[n[_ + 2]].getOrCreateDebugColor()
                                      , y = c[n[_ + 3]].getOrCreateDebugColor()
                                      , S = r[_]
                                      , C = r[_ + 1]
                                      , M = r[_ + 2]
                                      , w = r[_ + 3]
                                      , T = 3 * v;
                                    m[T] = S * b[0] + C * x[0] + M * A[0] + w * y[0],
                                    m[T + 1] = S * b[1] + C * x[1] + M * A[1] + w * y[1],
                                    m[T + 2] = S * b[2] + C * x[2] + M * A[2] + w * y[2]
                                }
                                i.BonesColor = new d(d.ARRAY_BUFFER,m,3)
                            }
                        } else {
                            var E = l.fromValues(Math.random(), Math.random(), Math.random());
                            e.addUniform(o.createFloat3(E, "uColorDebug")),
                            e.setShaderGeneratorName("debugGeometry");
                            var I = t.getBound()
                              , k = new Float32Array(18)
                              , F = .1 * I.radius();
                            k[0] = F,
                            k[3] = -F,
                            k[7] = F,
                            k[10] = -F,
                            k[14] = F,
                            k[17] = -F;
                            var D = new a;
                            D.getAttributes().Vertex = new d(d.ARRAY_BUFFER,k,3);
                            var N = new p(f.LINES,0,6);
                            D.getPrimitives().push(N);
                            var R = new g
                              , P = I.center();
                            R.getMatrix()[12] = P[0],
                            R.getMatrix()[13] = P[1],
                            R.getMatrix()[14] = P[2],
                            R.addChild(D),
                            this.nodePath[this.nodePath.length - 2].addChild(R),
                            E = l.fromValues(.8 * E[0], .8 * E[1], .8 * E[2]),
                            D.getOrCreateStateSet().addUniform(o.createFloat3(E, "uColorDebug")),
                            R.setStateSet(this._stCenter),
                            R._isCenterDebug = !0
                        }
                    } else
                        void 0 !== t._originalStateSet && t.setStateSet(t._originalStateSet || void 0);
                this.traverse(t)
            }
        }
    }),
    t.exports = A
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1383)
      , a = i(1391)
      , s = function(t) {
        if (!t) {
            if (s.instance)
                return s.instance;
            s.instance = this
        }
        return this.addShaders(r),
        this.addShaders(a),
        this
    };
    s.prototype = {
        _shadersText: {},
        _shadersList: {},
        _globalDefaultprecision: "#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif",
        _debugLines: !1,
        _includeR: /#pragma include "([^"]+)"/g,
        _includeCondR: /#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,
        _defineR: /\#define\s+([a-zA-Z_0-9]+)/,
        _precisionR: /precision\s+(high|low|medium)p\s+float/,
        addShaders: function(t) {
            var e = window.Object.keys(t);
            e.forEach(function(e) {
                this._shadersList[e] = e,
                this._shadersText[e] = t[e]
            }, this)
        },
        instrumentShaderlines: function(t, e) {
            return "\n#line 0 " + e + "\n" + t
        },
        getShaderTextPure: function(t) {
            var e = this._shadersText[t];
            return e || (n.error("shader file/text: " + t + " not registered"),
            e = ""),
            e
        },
        getShader: function(t, e, i, n) {
            var r = this.getShaderTextPure(t);
            return this.processShader(r, e, i, n)
        },
        preprocess: function(t, e, i, n) {
            var r = this;
            return t.replace(this._includeCondR, function(t, a) {
                var s = a.split(" ")
                  , o = s[0].replace(/"/g, "");
                if (s.length > 1 && n) {
                    for (var u = !1, l = n.map(function(t) {
                        return r._defineR.test(t) && t.replace(/\s+/g, " ").split(" ")[1]
                    }), c = 1; c < s.length && !u; c++)
                        for (var h = s[c].replace(/"/g, ""), d = 0; d < l.length && !u; d++)
                            if (l[d] !== !1 && l[d] === h) {
                                u = !0;
                                break
                            }
                    if (!u)
                        return ""
                }
                if (i.indexOf(o) !== -1)
                    return "";
                var p = this.getShaderTextPure(o);
                return i.push(o),
                this._debugLines && (p = this.instrumentShaderlines(p, e)),
                e++,
                p = this.preprocess(p, e, i, n)
            }
            .bind(this))
        },
        processShader: function(t, e, i, n) {
            var r = []
              , a = t
              , s = 0;
            this._debugLines && (a = this.instrumentShaderlines(a, s),
            s++),
            void 0 !== e && (e = e.sort().filter(function(t, i) {
                return !i || t !== e[i - 1]
            })),
            void 0 !== i && (i = i.sort().filter(function(t, e) {
                return !e || t !== i[e - 1]
            }));
            var o = this.preprocess(a, s, r, e, n)
              , u = "";
            return u += "#version 100\n",
            void 0 !== i && (u += i.join("\n") + "\n"),
            this._globalDefaultprecision && (this._precisionR.test(o) || (u += this._globalDefaultprecision + "\n")),
            void 0 !== e && (u += e.join("\n") + "\n"),
            o = u + o
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1384)
      , r = i(1385)
      , a = i(1386)
      , s = i(1387)
      , o = i(1388)
      , u = i(1389)
      , l = i(1390);
    t.exports = {
        "functions.glsl": n,
        "lights.glsl": r,
        "skinning.glsl": a,
        "textures.glsl": s,
        "colorEncode.glsl": o,
        "noise.glsl": u,
        "billboard.glsl": l
    }
}
, function(t, e) {
    t.exports = "// the approximation :\n// http://chilliant.blogspot.fr/2012/08/srgb-approximations-for-hlsl.html\n// introduced slightly darker colors and more slight banding in the darks.\n// The reference implementation (or even a single pow approx) did not introduced these effects.\n\n// so for now we stick with the reference implementation :\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\n// with the slight changes :\n// - we always assume the color is >= 0.0 (so no check)\n// - unlike the previous approximation, linear to srgb is monotonic so we don't need to check if the color is > 1\n\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\nfloat linearTosRGB(const in float c) {\n    return LIN_SRGB(c);\n}\nvec3 linearTosRGB(const in vec3 c) {\n    return vec3(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b));\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b), c.a);\n}\n\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\nfloat sRGBToLinear(const in float c) {\n    return SRGB_LIN(c);\n}\nvec3 sRGBToLinear(const in vec3 c) {\n    return vec3(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b));\n}\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b), c.a);\n}\n\n//http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec3 RGBMToRGB( const in vec4 rgba ) {\n    const float maxRange = 8.0;\n    return rgba.rgb * maxRange * rgba.a;\n}\n\nconst mat3 LUVInverse = mat3( 6.0013,    -2.700,   -1.7995,\n                              -1.332,    3.1029,   -5.7720,\n                              0.3007,    -1.088,    5.6268 );\n\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\n    float Le = vLogLuv.z * 255.0 + vLogLuv.w;\n    vec3 Xp_Y_XYZp;\n    Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n    Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\n    Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\n    vec3 vRGB = LUVInverse * Xp_Y_XYZp;\n    return max(vRGB, 0.0);\n}\n\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec4 encodeRGBM(const in vec3 col, const in float range) {\n    if(range <= 0.0)\n        return vec4(col, 1.0);\n    vec4 rgbm;\n    vec3 color = col / range;\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\n    rgbm.rgb = color / rgbm.a;\n    return rgbm;\n}\n\nvec3 decodeRGBM(const in vec4 col, const in float range) {\n    if(range <= 0.0)\n        return col.rgb;\n    return range * col.rgb * col.a;\n}"
}
, function(t, e) {
    t.exports = "////////////////\n// ATTENUATION\n/////////////\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation)\n{\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\n    // TODO find a vector alu instead of 4 scalar\n    float constant = lightAttenuation.x;\n    float linear = lightAttenuation.y*dist;\n    float quadratic = lightAttenuation.z*dist*dist;\n    return 1.0 / ( constant + linear + quadratic );\n}\n//\n// LIGHTING EQUATION TERMS\n///\nvoid specularCookTorrance(const in vec3 n, const in vec3 l, const in vec3 v, const in float hard, const in vec3 materialSpecular, const in vec3 lightSpecular, out vec3 specularContrib)\n{\n    vec3 h = normalize(v + l);\n    float nh = dot(n, h);\n    float specfac = 0.0;\n\n    if(nh > 0.0) {\n        float nv = max( dot(n, v), 0.0 );\n        float i = pow(nh, hard);\n        i = i / (0.1 + nv);\n        specfac = i;\n    }\n    // ugly way to fake an energy conservation (mainly to avoid super bright stuffs with low glossiness)\n    float att = hard > 100.0 ? 1.0 : smoothstep(0.0, 1.0, hard * 0.01);\n    specularContrib = specfac*materialSpecular*lightSpecular*att;\n}\n\nvoid lambert(const in float ndl,  const in vec3 materialDiffuse, const in vec3 lightDiffuse, out vec3 diffuseContrib)\n{\n    diffuseContrib = ndl*materialDiffuse*lightDiffuse;\n}\n////////////////////////\n/// Main func\n///////////////////////\n\n/// for each light\n//direction, dist, NDL, attenuation, compute diffuse, compute specular\n\nvec3 computeSpotLightShading(\n                             const in vec3 normal,\n                             const in vec3 eyeVector,\n\n                             const in vec3 materialAmbient,\n                             const in vec3 materialDiffuse,\n                             const in vec3 materialSpecular,\n                             const in float materialShininess,\n\n                             const in vec3 lightAmbient,\n                             const in vec3 lightDiffuse,\n                             const in vec3 lightSpecular,\n\n                             const in vec3  lightSpotDirection,\n                             const in vec4  lightAttenuation,\n                             const in vec4  lightSpotPosition,\n                             const in float lightCosSpotCutoff,\n                             const in float lightSpotBlend,\n\n                             const in mat4 lightMatrix,\n                             const in mat4 lightInvMatrix,\n\n                             out vec3 eyeLightPos,\n                             out vec3 eyeLightDir,\n                             out float NdotL,\n                             out bool lighted)\n{\n    lighted = false;\n    eyeLightPos = vec3(lightMatrix * lightSpotPosition);\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\n    // compute dist\n    float dist = length(eyeLightDir);\n    // compute attenuation\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\n    if (attenuation != 0.0)\n        {\n            // compute direction\n            eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n            if (lightCosSpotCutoff > 0.0)\n                {\n                    //compute lightSpotBlend\n                    vec3 lightSpotDirectionEye = normalize(mat3(vec3(lightInvMatrix[0]), vec3(lightInvMatrix[1]), vec3(lightInvMatrix[2]))*lightSpotDirection);\n\n                    float cosCurAngle = dot(-eyeLightDir, lightSpotDirectionEye);\n                    float diffAngle = cosCurAngle - lightCosSpotCutoff;\n                    float spot = 1.0;\n                    if ( diffAngle < 0.0 ) {\n                        spot = 0.0;\n                    } else {\n                        if ( lightSpotBlend > 0.0 )\n                            spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightCosSpotCutoff) / (lightSpotBlend));\n                    }\n\n                    if (spot > 0.0)\n                        {\n                            // compute NdL\n                            NdotL = dot(eyeLightDir, normal);\n                            if (NdotL > 0.0)\n                                {\n                                    lighted = true;\n                                    vec3 diffuseContrib;\n                                    lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n                                    vec3 specularContrib;\n                                    specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n                                    return spot * attenuation * (diffuseContrib + specularContrib);\n                                }\n                        }\n                }\n        }\n    return vec3(0.0);\n}\n\nvec3 computePointLightShading(\n                              const in vec3 normal,\n                              const in vec3 eyeVector,\n\n                              const in vec3 materialAmbient,\n                              const in vec3 materialDiffuse,\n                              const in vec3 materialSpecular,\n                              const in float materialShininess,\n\n                              const in vec3 lightAmbient,\n                              const in vec3 lightDiffuse,\n                              const in vec3 lightSpecular,\n\n                              const in vec4 lightPosition,\n                              const in vec4 lightAttenuation,\n\n                              const in mat4 lightMatrix,\n\n                              out vec3 eyeLightPos,\n                              out vec3 eyeLightDir,\n                              out float NdotL,\n                              out bool lighted)\n{\n\n    eyeLightPos =  vec3(lightMatrix * lightPosition);\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\n    float dist = length(eyeLightDir);\n    // compute dist\n    // compute attenuation\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\n    if (attenuation != 0.0)\n        {\n            // compute direction\n            eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n            // compute NdL\n            NdotL = dot(eyeLightDir, normal);\n            if (NdotL > 0.0)\n                {\n                    lighted = true;\n                    vec3 diffuseContrib;\n                    lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n                    vec3 specularContrib;\n                    specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n                    return attenuation * (diffuseContrib + specularContrib);\n                }\n        }\n    return vec3(0.0);\n}\n\nvec3 computeSunLightShading(\n\n                            const in vec3 normal,\n                            const in vec3 eyeVector,\n\n                            const in vec3 materialAmbient,\n                            const in vec3 materialDiffuse,\n                            const in vec3 materialSpecular,\n                            const in float materialShininess,\n\n                            const in vec3 lightAmbient,\n                            const in vec3 lightDiffuse,\n                            const in vec3 lightSpecular,\n\n                            const in vec4 lightPosition,\n\n                            const in mat4 lightMatrix,\n\n                            out vec3 eyeLightDir,\n                            out float NdotL,\n                            out bool lighted)\n{\n\n    lighted = false;\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    // compute NdL   // compute NdL\n    NdotL = dot(eyeLightDir, normal);\n    if (NdotL > 0.0)\n        {\n            lighted = true;\n            vec3 diffuseContrib;\n            lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n            vec3 specularContrib;\n            specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n            return (diffuseContrib + specularContrib);\n        }\n    return vec3(0.0);\n}\n\nvec3 computeHemiLightShading(\n\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightDiffuse,\n    const in vec3 lightGround,\n\n    const in vec4 lightPosition,\n\n    const in mat4 lightMatrix,\n\n    out vec3 eyeLightDir,\n    out float NdotL,\n    out bool lighted)\n{\n    lighted = false;\n\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    NdotL = dot(eyeLightDir, normal);\n    float weight = 0.5 * NdotL + 0.5;\n    vec3 diffuseContrib = materialDiffuse * mix(lightGround, lightDiffuse, weight);\n\n    // same cook-torrance as above for sky/ground\n    float skyWeight = 0.5 * dot(normal, normalize(eyeVector + eyeLightDir)) + 0.5;\n    float gndWeight = 0.5 * dot(normal, normalize(eyeVector - eyeLightDir)) + 0.5;\n    float skySpec = pow(skyWeight, materialShininess);\n    float skyGround = pow(gndWeight, materialShininess);\n    float divisor = (0.1 + max( dot(normal, eyeVector), 0.0 ));\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\n    vec3 specularContrib = lightDiffuse * materialSpecular * weight * att * (skySpec + skyGround) / divisor;\n\n    return diffuseContrib + specularContrib;\n}\n"
}
, function(t, e) {
    t.exports = "//////////////////////////////\n// OPTIMIZED VERSION (NO IF)\n//////////////////////////////\nmat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n    mat4 outMat_1;\n    mat4 tmpMat_2;\n    highp ivec4 tmpvar_3;\n    tmpvar_3 = (3 * ivec4(bonesIdx));\n    tmpMat_2 = mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0);\n    vec4 tmpvar_4;\n    tmpvar_4 = -(abs(weightsVec));\n    tmpMat_2[0] = uBones[tmpvar_3.x];\n    tmpMat_2[1] = uBones[(tmpvar_3.x + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.x + 2)];\n    outMat_1 = ((float(\n    ((tmpvar_4.x + tmpvar_4.y) >= -((tmpvar_4.z + tmpvar_4.w)))\n    ) * mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0)) + (weightsVec.x * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.y];\n    tmpMat_2[1] = uBones[(tmpvar_3.y + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.y + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.y * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.z];\n    tmpMat_2[1] = uBones[(tmpvar_3.z + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.z + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.z * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.w];\n    tmpMat_2[1] = uBones[(tmpvar_3.w + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.w + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.w * tmpMat_2));\n\n    return outMat_1;\n}\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (WITH IF)\n//////////////////////////////\n\n// //http://http.developer.nvidia.com/GPUGems/gpugems_ch04.html\n// mat4 getMat4FromVec4( const int index, inout mat4 myMat ) {\n//     // We have to use a global variable because we can't access dynamically\n//     // matrix is transpose so we should do vec * matrix\n//     myMat[0] = uBones[ index ];\n//     myMat[1] = uBones[ index + 1];\n//     myMat[2] = uBones[ index + 2];\n//     return myMat;\n// }\n\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n//     ivec4 idx =  3 * ivec4(bonesIdx);\n//     mat4 tmpMat = mat4(1.0);\n//     mat4 outMat = mat4(0.0);\n\n//     // we handle negative weights\n//     if(all(equal(weightsVec, vec4(0.0)))) return tmpMat;\n\n//     if(weightsVec.x != 0.0) outMat += weightsVec.x * getMat4FromVec4( idx.x, tmpMat );\n//     if(weightsVec.y != 0.0) outMat += weightsVec.y * getMat4FromVec4( idx.y, tmpMat );\n//     if(weightsVec.z != 0.0) outMat += weightsVec.z * getMat4FromVec4( idx.z, tmpMat );\n//     if(weightsVec.w != 0.0) outMat += weightsVec.w * getMat4FromVec4( idx.w, tmpMat );\n//     return outMat;\n// }\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (NO IF)\n//////////////////////////////\n\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n//     ivec4 idx =  3 * ivec4(bonesIdx);\n//     mat4 tmpMat = mat4(1.0);\n\n//     // if sum is 0, return identity\n//     vec4 absWeights = -abs(weightsVec);\n//     mat4 outMat = step(0.0, absWeights.x + absWeights.y + absWeights.z + absWeights.w) * tmpMat;\n\n//     // we handle negative weights\n//     // outMat[3][3] += weightsVec.x + weightsVec.y + weightsVec.z + weightsVec.w;\n\n//     tmpMat[0] = uBones[ idx.x ];\n//     tmpMat[1] = uBones[ idx.x + 1];\n//     tmpMat[2] = uBones[ idx.x + 2];\n//     outMat += weightsVec.x * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.y ];\n//     tmpMat[1] = uBones[ idx.y + 1];\n//     tmpMat[2] = uBones[ idx.y + 2];\n//     outMat += weightsVec.y * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.z ];\n//     tmpMat[1] = uBones[ idx.z + 1];\n//     tmpMat[2] = uBones[ idx.z + 2];\n//     outMat += weightsVec.z * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.w ];\n//     tmpMat[1] = uBones[ idx.w + 1];\n//     tmpMat[2] = uBones[ idx.w + 2];\n//     outMat += weightsVec.w * tmpMat;\n\n//     return outMat;\n// }\n";
}
, function(t, e) {
    t.exports = "vec3 textureRGB(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv.xy ).rgb;\n}\n\nvec4 textureRGBA(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv.xy ).rgba;\n}\n\nfloat textureIntensity(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv).r;\n}\n\nfloat textureAlpha(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv.xy ).a;\n}\n"
}
, function(t, e) {
    t.exports = "\nfloat decodeFloatRGBA( vec4 rgba ) {\n    return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );\n}\n\nvec4 encodeFloatRGBA( float v ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\n\nvec2 decodeHalfFloatRGBA( vec4 rgba ) {\n    return vec2(rgba.x + (rgba.y / 255.0), rgba.z + (rgba.w / 255.0));\n}\n\nvec4 encodeHalfFloatRGBA( vec2 v ) {\n    const vec2 bias = vec2(1.0 / 255.0, 0.0);\n    vec4 enc;\n    enc.xy = vec2(v.x, fract(v.x * 255.0));\n    enc.xy = enc.xy - (enc.yy * bias);\n\n    enc.zw = vec2(v.y, fract(v.y * 255.0));\n    enc.zw = enc.zw - (enc.ww * bias);\n    return enc;\n}\n"
}
, function(t, e) {
    t.exports = '#pragma include "hash.glsl"\n\n//// noise glsl\n\n// Based on Morgan McGuire @morgan3d\n// https://www.shadertoy.com/view/4dS3Wd\nfloat noise2D(const in vec2 x) {\n    vec2 i = floor(x);\n    vec2 f = fract(x);\n\n    // Four corners in 2D of a tile\n    float a = hash21(i);\n    float b = hash21(i + vec2(1.0, 0.0));\n    float c = hash21(i + vec2(0.0, 1.0));\n    float d = hash21(i + vec2(1.0, 1.0));\n\n    vec2 u = f * f * (3.0 - 2.0 * f);\n    return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\n}\n\n//// end noise glsl\n'
}
, function(t, e) {
    t.exports = "vec3 getScale( const in mat4 matrix ) {\n      // Only working with positive scales.\n      float xs = matrix[0][0] * matrix[0][1] * matrix[0][2] * matrix[0][3] < 0. ? -1. : 1.;\n      float ys = matrix[1][0] * matrix[1][1] * matrix[1][2] * matrix[1][3] < 0. ? -1. : 1.;\n      float zs = matrix[2][0] * matrix[2][1] * matrix[2][2] * matrix[2][3] < 0. ? -1. : 1.;\n      vec3 scale;\n      scale.x = xs * sqrt( matrix[0][0] * matrix[0][0] + matrix[0][1] * matrix[0][1] + matrix[0][2] * matrix[0][2]);\n      scale.y = ys * sqrt( matrix[1][0] * matrix[1][0] + matrix[1][1] * matrix[1][1] + matrix[1][2] * matrix[1][2]);\n      scale.z = zs * sqrt( matrix[2][0] * matrix[2][0] + matrix[2][1] * matrix[2][1] + matrix[2][2] * matrix[2][2]);\n      return scale;\n}\n\nvec4 billboard( const in vec3 vertex, const in mat4 modelViewMatrix, const in mat4 projectionMatrix ) {\n      vec3 scale = getScale( modelViewMatrix );\n      return projectionMatrix * ( vec4( scale.x* vertex.x , scale.y * vertex.y, scale.z * vertex.z, 1.0 ) + vec4( modelViewMatrix[ 3 ].xyz, 0.0 ) );\n}\n"
}
, function(t, e, i) {
    "use strict";
    var n = i(1392)
      , r = i(1393)
      , a = i(1394)
      , s = i(1395)
      , o = i(1396)
      , u = i(1397)
      , l = i(1398)
      , c = i(1399)
      , h = i(1400)
      , d = i(1401)
      , p = i(1402)
      , f = i(1403)
      , g = i(1404);
    t.exports = {
        "shadowsCastFrag.glsl": n,
        "shadowsReceive.glsl": r,
        "shadowsReceiveMain.glsl": a,
        "shadowLinearSoft.glsl": s,
        "pcf.glsl": o,
        "bandPCF.glsl": u,
        "tapPCF.glsl": l,
        "hash.glsl": c,
        "arrayPoisson.glsl": h,
        "poissonPCF.glsl": d,
        "esm.glsl": p,
        "vsm.glsl": f,
        "evsm.glsl": g
    }
}
, function(t, e) {
    t.exports = '\n#pragma include "colorEncode.glsl"\n\n// see shadowSettings.js header for shadow algo param explanations\n\n#ifdef _EVSM\n// Convert depth to EVSM coefficients\n// Input depth should be in [0, 1]\nvec2 warpDepth(const in float depth, const in vec2 exponents) {\n    float pos =  exp( exponents.x * depth);\n    float neg = -exp(-exponents.y * depth);\n    return vec2(pos, neg);\n}\n\n// Convert depth value to EVSM representation\nvec4 shadowDepthToEVSM(const in float depth, const in float expo0, const in float expo1) {\n    vec2 warpedDepth = warpDepth(depth, vec2(expo0, expo1));\n    return vec4(warpedDepth.xy, warpedDepth.xy * warpedDepth.xy);\n}\n#endif // _EVSM\n\n\n#if defined(_NONE) ||  defined(_PCF)\nvec4 computeShadowDepth(const in vec4 fragEye,\n                        const in vec4 shadowRange)\n#else\nvec4 computeShadowDepth(const in vec4 fragEye,\n                        const in vec4 shadowRange,\n                        const in float expo0,\n                        const in float expo1)\n#endif\n{\n    // distance to camera\n    float depth =  -fragEye.z * fragEye.w;\n    // most precision near 0, make sure we are near 0 and in  [0,1]\n    depth = (depth - shadowRange.x ) * shadowRange.w;\n\n    vec4 outputFrag;\n\n#if defined (_FLOATTEX) && defined(_PCF)\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#elif defined (_FLOATTEX)  && defined(_ESM)\n    float depthScale = expo1;\n    depth = exp(-depth * depthScale);\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#elif defined (_FLOATTEX)  && defined(_VSM)\n    outputFrag = vec4(depth, depth * depth, 0.0, 1.0);\n#elif defined (_FLOATTEX)  && defined(_EVSM)\n    outputFrag = shadowDepthToEVSM(depth, expo0, expo1);\n#elif defined (_FLOATTEX) // && defined(_NONE)\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#elif defined(_PCF)\n    outputFrag = encodeFloatRGBA(depth);\n#elif defined(_ESM)\n    float depthScale = expo1;\n    depthScale = exp(-depth * depthScale);\n    outputFrag = encodeFloatRGBA(depthScale);\n#elif defined(_VSM)\n    outputFrag = encodeHalfFloatRGBA(vec2(depth, depth* depth));\n#else // NONE\n    outputFrag = encodeFloatRGBA(depth);\n\n#endif\n\n    return outputFrag;\n}\n'
}
, function(t, e) {
    t.exports = '//begin shadows\n\n#pragma include "colorEncode.glsl"\n\n// see shadowSettings.js header for shadow algo param explanations\n\n// end Float codec\nfloat getSingleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return  decodeFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).x;\n#endif\n}\n\nvec2 getDoubleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return decodeHalfFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).xy;\n#endif\n}\n\nvec4 getQuadFloatFromTex(const in sampler2D depths, const in vec2 uv){\n    return texture2D(depths, uv).xyzw;\n}\n// end Float codec\n\n\n#pragma include "vsm.glsl" "_VSM"\n\n#pragma include "evsm.glsl" "_EVSM"\n\n#pragma include "esm.glsl" "_ESM"\n\n#pragma include "pcf.glsl" "_NONE" "_PCF"'
}
, function(t, e) {
    t.exports = "\n    if (!lighted)\n        return 0.;\n\n    if (depthRange.x == depthRange.y)\n        return 1.;\n\n    vec4 shadowVertexEye = shadowViewMatrix *  vec4(vertexWorld, 1.0);\n    float shadowReceiverZ =  - shadowVertexEye.z;\n\n    if( shadowReceiverZ < 0.0)\n        return 1.0; // notably behind camera\n\n    vec4 shadowVertexProjected = shadowProjectionMatrix * shadowVertexEye;\n    if (shadowVertexProjected.w < 0.0)\n        return 1.0; // notably behind camera\n\n    vec2 shadowUV;\n\n    shadowUV.xy = shadowVertexProjected.xy / shadowVertexProjected.w;\n    shadowUV.xy = shadowUV.xy * 0.5 + 0.5;// mad like\n\n    bool outFrustum = any(bvec4 ( shadowUV.x > 1., shadowUV.x < 0., shadowUV.y > 1., shadowUV.y < 0. ));\n    if (outFrustum )\n        return 1.0;// limits of light frustum\n    // most precision near 0, make sure we are near 0 and in [0,1]\n    shadowReceiverZ =  (shadowReceiverZ - depthRange.x)* depthRange.w;\n\n    // depth bias: fighting shadow acne (depth imprecsion z-fighting)\n    float shadowBias = 0.0;\n    // cosTheta is dot( n, l ), clamped between 0 and 1\n    //float shadowBias = 0.005*tan(acos(N_Dot_L));\n    // same but 4 cycles instead of 15\n    shadowBias += 0.05 *  sqrt( 1. -  N_Dot_L*N_Dot_L) / clamp(N_Dot_L, 0.0005,  1.0);\n\n    //That makes sure that plane perpendicular to light doesn't flicker due to\n    //selfshadowing and 1 = dot(Normal, Light) using a min bias\n    shadowBias = clamp(shadowBias, 0.00005,  bias);\n\n    // shadowZ must be clamped to [0,1]\n    // otherwise it's not comparable to\n    // shadow caster depth map\n    // which is clamped to [0,1]\n    // Not doing that makes ALL shadowReceiver > 1.0 black\n    // because they ALL becomes behind any point in Caster depth map\n    shadowReceiverZ = clamp(shadowReceiverZ, 0., 1. - shadowBias);\n\n    shadowReceiverZ -= shadowBias;\n\n    // Now computes Shadow\n\n    // Calculate shadow amount\n    float shadow = 1.0;\n\n    // return 0.0 for black;\n    // return 1.0 for light;\n\n#ifdef _NONE\n\n    float shadowDepth = getSingleFloatFromTex(tex, shadowUV.xy);\n    // shadowReceiverZ : receiver depth in light view\n    // shadowDepth : caster depth in light view\n    // receiver is shadowed if its depth is superior to the caster\n    shadow = ( shadowReceiverZ > shadowDepth ) ? 0.0 : 1.0;\n\n#elif defined( _PCF )\n    // pcf pbias to add on offset\n    vec2 shadowBiasPCF = vec2(0.);\n\n\n// looks like derivative is broken on some mac + intel cg ...\n#ifdef GL_OES_standard_derivatives\n\n    shadowBiasPCF.x = clamp(dFdx(shadowReceiverZ)* shadowMapSize.z, -1.0, 1.0 );\n    shadowBiasPCF.y = clamp(dFdy(shadowReceiverZ)* shadowMapSize.w, -1.0, 1.0 );\n    \n#endif\n\n\n    shadow = getShadowPCF(tex, shadowMapSize, shadowUV, shadowReceiverZ, shadowBiasPCF);\n\n#elif defined( _ESM )\n\n    shadow = fetchESM(tex, shadowMapSize, shadowUV, shadowReceiverZ, exponent0, exponent1);\n\n#elif  defined( _VSM )\n\n    vec2 moments = getDoubleFloatFromTex(tex, shadowUV.xy);\n    shadow = chebyshevUpperBound(moments, shadowReceiverZ, epsilonVSM);\n\n#elif  defined( _EVSM )\n\n    vec4 occluder = getQuadFloatFromTex(tex, shadowUV.xy);\n    vec2 exponents = vec2(exponent0, exponent1);\n    vec2 warpedDepth = warpDepth(shadowReceiverZ, exponents);\n\n    float derivationEVSM = epsilonVSM;\n    // Derivative of warping at depth\n    vec2 depthScale = derivationEVSM * exponents * warpedDepth;\n    vec2 minVariance = depthScale * depthScale;\n\n    float epsilonEVSM = -epsilonVSM;\n\n    // Compute the upper bounds of the visibility function both for x and y\n    float posContrib = chebyshevUpperBound(occluder.xz, -warpedDepth.x, minVariance.x);\n    float negContrib = chebyshevUpperBound(occluder.yw, warpedDepth.y, minVariance.y);\n\n    shadow = min(posContrib, negContrib);\n\n#endif\n\n\n    return shadow;\n"
}
, function(t, e) {
    t.exports = "\n// simulation of texture2Dshadow glsl call on HW\n// http://codeflow.org/entries/2013/feb/15/soft-shadow-mapping/\nfloat texture2DCompare(const in sampler2D depths, const in vec2 uv, const in float compare){\n\n    float depth = getSingleFloatFromTex(depths, uv);\n    return step(compare, depth);\n\n}\n\n// simulates linear fetch like texture2d shadow\nfloat texture2DShadowLerp(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare){\n\n#if defined(_FAKE_PCF)\n    // CHEAT: it's wrong, but 4x faster\n    // wronb because http://www.eng.utah.edu/~cs5610/handouts/reeves87.pdf p2\n    return texture2DCompare(depths, uv, compare);\n#else\n    vec2 f = fract(uv*size.xy+0.5);\n    vec2 centroidUV = floor(uv*size.xy+0.5)*size.zw;\n\n    float lb = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 0.0), compare);\n    float lt = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 1.0), compare);\n    float rb = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 0.0), compare);\n    float rt = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 1.0), compare);\n    float a = mix(lb, lt, f.y);\n    float b = mix(rb, rt, f.y);\n    float c = mix(a, b, f.x);\n    return c;\n#endif\n\n}\n"
}
, function(t, e) {
    t.exports = '\n#pragma include "bandPCF.glsl" "_BAND_PCF"\n#pragma include "poissonPCF.glsl" "_POISSON_PCF"\n#pragma include "tapPCF.glsl" "_TAP_PCF"\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias\n    )\n{\n    #pragma include "shadowsReceiveMain.glsl" "_PCF" "_NONE"\n\n\n\n}\n'
}
, function(t, e) {
    t.exports = "\n\n\nfloat getShadowPCF(const in sampler2D tex, const in vec4 size, const in vec2 uv, const in float shadowZ, const in vec2 biasPCF) {\n\n    float shadowed = 0.0;\n\n    #define TSF(off1, off2) getSingleFloatFromTex( tex, uv.xy + vec2(off1, off2) + biasPCF )\n\n    float dx0 = -size.z;\n    float dy0 = -size.w;\n    float dx1 = size.z;\n    float dy1 = size.w;\n\n    // fastest but gives banding\n#if defined(_PCFx4)\n\n    vec4 sV;\n\n    // vector ops faster alu\n    sV.x = TSF( dx0, dy0 );\n    sV.y = TSF( dx1, dy0 );\n    sV.z = TSF( dx1, dy0 );\n    sV.w = TSF( dx1, dy1 );\n    sV = vec4(lessThan(vec4(shadowZ), sV  ));\n    shadowed = dot(sV, vec4(0.25));\n\n    // here still didn't querying the real shadow at uv.\n    // This could be a single func checking for branching\n    // like before going to x9, x16 or anything\n    // or even complex \"blurring\"\n    if (shadowed != 0.0) // we're on an edge\n    {\n        shadowed += step(shadowZ, TSF(0.0, 0.0));\n        shadowed *= 0.5;\n    }\n\n#elif defined(_PCFx9)\n\n\n    mat3 kern;\n    mat3 depthKernel;\n\n\n    depthKernel[0][0] = TSF( dx0, dy0 );\n    depthKernel[0][1] = TSF( dx0, 0.0 );\n    depthKernel[0][2] = TSF( dx0, dy1 );\n    depthKernel[1][0] = TSF( 0.0, dy0 );\n    depthKernel[1][1] = TSF( 0.0, 0.0 );\n    depthKernel[1][2] = TSF( 0.0, dy1 );\n    depthKernel[2][0] = TSF( dx1, dy0 );\n    depthKernel[2][1] = TSF( dx1, 0.0 );\n    depthKernel[2][2] = TSF( dx1, dy1 );\n\n    // using 4 vector ops to save ALU\n    // filter is done post dept/shadow compare\n    vec3 shadowZ3 = vec3( shadowZ );\n    kern[0] = vec3(lessThan(shadowZ3, depthKernel[0]  ));\n    kern[0] *= vec3(0.25);\n\n    kern[1] = vec3(lessThan(shadowZ3, depthKernel[1] ));\n    kern[1] *= vec3(0.25);\n\n    kern[2] = vec3(lessThan(shadowZ3, depthKernel[2] ));\n    kern[2] *= vec3(0.25);\n\n    vec2 fractCoord = 1.0 - fract( uv.xy );\n\n    kern[0] = mix( kern[1], kern[0], fractCoord.x );\n    kern[1] = mix( kern[2], kern[1], fractCoord.x );\n\n    vec4 sV;\n    sV.x = mix( kern[0][1], kern[0][0], fractCoord.y );\n    sV.y = mix( kern[0][2], kern[0][1], fractCoord.y );\n    sV.z = mix( kern[1][1], kern[1][0], fractCoord.y );\n    sV.w = mix( kern[1][2], kern[1][1], fractCoord.x );\n\n    shadowed = dot( sV, vec4( 1.0 ) );\n\n#elif defined(_PCFx16)\n\n    float dx2 = -2.0 * size.z;\n    float dy2 = -2.0 * size.w;\n    float dx3 = 2.0 * size.z;\n    float dy3 = 2.0 * size.w;\n\n    shadowed += step(shadowZ , TSF(dx2, dy2));\n    shadowed += step(shadowZ , TSF(dx0, dy2));\n    shadowed += step(shadowZ , TSF(dx1, dy2));\n    shadowed += step(shadowZ , TSF(dx3, dy2));\n\n    shadowed += step(shadowZ , TSF(dx2, dy0));\n    shadowed += step(shadowZ , TSF(dx0, dy0));\n    shadowed += step(shadowZ , TSF(dx1, dy0));\n    shadowed += step(shadowZ , TSF(dx3, dy0));\n\n    shadowed += step(shadowZ , TSF(dx2, dy1));\n    shadowed += step(shadowZ , TSF(dx0, dy1));\n    shadowed += step(shadowZ , TSF(dx1, dy1));\n    shadowed += step(shadowZ , TSF(dx3, dy1));\n\n    shadowed += step(shadowZ , TSF(dx2, dy3));\n    shadowed += step(shadowZ , TSF(dx0, dy3));\n    shadowed += step(shadowZ , TSF(dx1, dy3));\n    shadowed += step(shadowZ , TSF(dx3, dy3));\n\n    shadowed = shadowed / 16.0;\n#endif // pcfx16\n    return shadowed;\n\n}\n"
}
, function(t, e) {
    t.exports = '\n#pragma include "noise.glsl" "_ROTATE_OFFSET"\n\n#pragma include "shadowLinearSoft.glsl"\n\nfloat getShadowPCF(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare, const in vec2 biasPCF)\n{\n\n     float res = 0.0;\n\n#if defined(_ROTATE_OFFSET)\n     res += texture2DShadowLerp(depths, size,   uv + size.zw*(noise2D(uv*gl_FragCoord.xy)*2.0 - 1.0) + biasPCF, compare);\n#else\n     res += texture2DShadowLerp(depths, size,   uv + biasPCF, compare);\n#endif\n\n\n#if defined(_PCFx1)\n\n#else\n\n    float dx0 = -size.z;\n    float dy0 = -size.w;\n    float dx1 = size.z;\n    float dy1 = size.w;\n\n#define TSF(o1,o2) texture2DShadowLerp(depths, size, uv + vec2(o1, o2) + biasPCF,  compare)\n\n    res += TSF(dx0, dx0);\n    res += TSF(dx0, .0);\n    res += TSF(dx0, dx1);\n\n#if defined(_PCFx4)\n\n    res /=4.0;\n\n#elif defined(_PCFx9)\n    res += TSF(.0, dx0);\n    res += TSF(.0, dx1);\n\n    res += TSF(dx1, dx0);\n    res += TSF(dx1, .0);\n    res += TSF(dx1, dx1);\n\n\n    res /=9.0;\n\n#elif defined(_PCFx25)\n\n    float dx02 = -2.0*size.z;\n    float dy02 = -2.0*size.w;\n    float dx2 = 2.0*size.z;\n    float dy2 = 2.0*size.w;\n\n    // complete row above\n    res += TSF(dx0, dx02);\n    res += TSF(dx0, dx2);\n\n    res += TSF(.0, dx02);\n    res += TSF(.0, dx2);\n\n    res += TSF(dx1, dx02);\n    res += TSF(dx1, dx2);\n\n    // two new col\n    res += TSF(dx02, dx02);\n    res += TSF(dx02, dx0);\n    res += TSF(dx02, .0);\n    res += TSF(dx02, dx1);\n    res += TSF(dx02, dx2);\n\n    res += TSF(dx2, dx02);\n    res += TSF(dx2, dx0);\n    res += TSF(dx2, .0);\n    res += TSF(dx2, dx1);\n    res += TSF(dx2, dx2);\n\n\n    res/=25.0;\n\n#endif\n\n#undef TSF\n\n#endif\n    return res;\n}\n/////// end Tap\n'
}
, function(t, e) {
    t.exports = "//// hash glsl\n\n// Dave Hoskins: hash without sin\n//https://www.shadertoy.com/view/4djSRW\n#define MOD2 vec2(443.8975,397.2973)\n//----------------------------------------------------------------------------------------\n//  1 out, 1 in...\n//note: normalized uniform random, [0;1[\nfloat hash11(const in float p)\n{\n    vec2 p2 = fract(vec2(p) * MOD2);\n    p2 += dot(p2.yx, p2.xy+19.19);\n    return fract(p2.x * p2.y);\n}\n//note: normalized uniform random, [0;1[\n//  2 out, 1 in...\nfloat hash21(const in vec2 p)\n{\n    vec2 p2 = fract(p * MOD2);\n    p2 += dot(p2.yx, p2.xy+19.19);\n    return fract(p2.x * p2.y);\n}\n\n\n// Based on Morgan McGuire @morgan3d\n// https://www.shadertoy.com/view/4dS3Wd\n// using Sin\n//  1 out, 1 in...\nfloat hashSin11( const in float n )\n{\n    return fract(sin(n)*43758.5453);\n}\n\n//note: normalized uniform random, [0;1[\n//  2 out, 1 in...\nfloat hashSin21( const in vec2 n ) {\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n\n// note: [-1;1]\n// iq: https://www.shadertoy.com/view/Xsl3Dl\n// note: value noise\n//  2 out, 2 in...\nvec2 hashSin22( const in vec2 n )\n{\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* vec2(43758.5453,35458.5734));\n}\n//  3 out, 3 in...\nvec3 hashSin33( in vec3 p )\n{\n    p = vec3( dot(p,vec3(127.1,311.7, 74.7)),\n              dot(p,vec3(269.5,183.3,246.1)),\n              dot(p,vec3(113.5,271.9,124.6)));\n    return fract(sin(p)*43758.5453123);\n}\n\n// Returns a random number based on a vec3 and an int.\nfloat hashSin41(const in vec4 seed){\n    return fract(sin(dot(seed, vec4(12.9898,78.233,45.164,94.673)) * 43758.5453));\n}\n\n/////// end hash\n"
}
, function(t, e) {
    t.exports = "vec2 poissonDisk[64];\n\npoissonDisk[0] = vec2(-0.613392, 0.617481);\npoissonDisk[1] = vec2(0.170019, -0.040254);\npoissonDisk[2] = vec2(-0.299417, 0.791925);\npoissonDisk[3] = vec2(0.645680, 0.493210);\npoissonDisk[4] = vec2(-0.651784, 0.717887);\npoissonDisk[5] = vec2(0.421003, 0.027070);\npoissonDisk[6] = vec2(-0.817194, -0.271096);\npoissonDisk[7] = vec2(-0.705374, -0.668203);\npoissonDisk[8] = vec2(0.977050, -0.108615);\npoissonDisk[9] = vec2(0.063326, 0.142369);\npoissonDisk[10] = vec2(0.203528, 0.214331);\npoissonDisk[11] = vec2(-0.667531, 0.326090);\npoissonDisk[12] = vec2(-0.098422, -0.295755);\npoissonDisk[13] = vec2(-0.885922, 0.215369);\npoissonDisk[14] = vec2(0.566637, 0.605213);\npoissonDisk[15] = vec2(0.039766, -0.396100);\npoissonDisk[16] = vec2(0.751946, 0.453352);\npoissonDisk[17] = vec2(0.078707, -0.715323);\npoissonDisk[18] = vec2(-0.075838, -0.529344);\npoissonDisk[19] = vec2(0.724479, -0.580798);\npoissonDisk[20] = vec2(0.222999, -0.215125);\npoissonDisk[21] = vec2(-0.467574, -0.405438);\npoissonDisk[22] = vec2(-0.248268, -0.814753);\npoissonDisk[23] = vec2(0.354411, -0.887570);\npoissonDisk[24] = vec2(0.175817, 0.382366);\npoissonDisk[25] = vec2(0.487472, -0.063082);\npoissonDisk[26] = vec2(-0.084078, 0.898312);\npoissonDisk[27] = vec2(0.488876, -0.783441);\npoissonDisk[28] = vec2(0.470016, 0.217933);\npoissonDisk[29] = vec2(-0.696890, -0.549791);\npoissonDisk[30] = vec2(-0.149693, 0.605762);\npoissonDisk[31] = vec2(0.034211, 0.979980);\npoissonDisk[32] = vec2(0.503098, -0.308878);\npoissonDisk[33] = vec2(-0.016205, -0.872921);\npoissonDisk[34] = vec2(0.385784, -0.393902);\npoissonDisk[35] = vec2(-0.146886, -0.859249);\npoissonDisk[36] = vec2(0.643361, 0.164098);\npoissonDisk[37] = vec2(0.634388, -0.049471);\npoissonDisk[38] = vec2(-0.688894, 0.007843);\npoissonDisk[39] = vec2(0.464034, -0.188818);\npoissonDisk[40] = vec2(-0.440840, 0.137486);\npoissonDisk[41] = vec2(0.364483, 0.511704);\npoissonDisk[42] = vec2(0.034028, 0.325968);\npoissonDisk[43] = vec2(0.099094, -0.308023);\npoissonDisk[44] = vec2(0.693960, -0.366253);\npoissonDisk[45] = vec2(0.678884, -0.204688);\npoissonDisk[46] = vec2(0.001801, 0.780328);\npoissonDisk[47] = vec2(0.145177, -0.898984);\npoissonDisk[48] = vec2(0.062655, -0.611866);\npoissonDisk[49] = vec2(0.315226, -0.604297);\npoissonDisk[50] = vec2(-0.780145, 0.486251);\npoissonDisk[51] = vec2(-0.371868, 0.882138);\npoissonDisk[52] = vec2(0.200476, 0.494430);\npoissonDisk[53] = vec2(-0.494552, -0.711051);\npoissonDisk[54] = vec2(0.612476, 0.705252);\npoissonDisk[55] = vec2(-0.578845, -0.768792);\npoissonDisk[56] = vec2(-0.772454, -0.090976);\npoissonDisk[57] = vec2(0.504440, 0.372295);\npoissonDisk[58] = vec2(0.155736, 0.065157);\npoissonDisk[59] = vec2(0.391522, 0.849605);\npoissonDisk[60] = vec2(-0.620106, -0.328104);\npoissonDisk[61] = vec2(0.789239, -0.419965);\npoissonDisk[62] = vec2(-0.545396, 0.538133);\npoissonDisk[63] = vec2(-0.178564, -0.596057);\n"
}
, function(t, e) {
    t.exports = '\n\n#pragma include "shadowLinearSoft.glsl"\n\n#pragma include "hash.glsl"\n\nfloat getShadowPCF(const in sampler2D tex, const in vec4 size, const in vec2 uv, const in float shadowZ, const in vec2 biasPCF) {\n\n    vec2 o = size.zw;\n    float s = 0.0;\n\n// Not Good, as it needs the lerp things\n#pragma include "arrayPoisson.glsl"\n\n    int idx = 0;\n\n    // Not Good, as it needs the lerp things\n#define TSF_BASE(p, m) texture2DShadowLerp(tex, size, uv + m*poissonDisk[p]*o + biasPCF,  shadowZ)\n\n// fixed pattern in the shadow, no noise\n#define TSF_FIXED(i) TSF_BASE(i, 1.0)\n\n    // rand  using screenpos: No banding,"moves" camera\n#define TSF_SCREEN(i) TSF_BASE(i, hashSin22( float(i)*gl_FragCoord.xy ))\n\n//rand using worl proj +depth as world psace xyez\n#define TSF_SPACE(i)  TSF_BASE(i, hashSin41(vec4(uv.xy, shadowZ, float(i))))\n\n#define TSF(k) TSF_SPACE(k)\n\n\n    s += TSF(1);\n    s += TSF(2);\n    s += TSF(3);\n    s += TSF(4);\n\n#ifdef _PCFx4\n    const float kernSize = 4.;\n#else\n    s += TSF(5);\n    s += TSF(6);\n    s += TSF(7);\n    s += TSF(8);\n#ifdef _PCFx9\n    const float kernSize = 8.;\n#else\n    s += TSF(9);\n    s += TSF(10);\n    s += TSF(11);\n    s += TSF(12);\n    s += TSF(13);\n    s += TSF(14);\n    s += TSF(15);\n    s += TSF(16);\n#ifdef _PCFx16\n    const float kernSize = 16.;\n#else\n    s += TSF(17);\n    s += TSF(18);\n    s += TSF(19);\n    s += TSF(20);\n    s += TSF(21);\n    s += TSF(22);\n    s += TSF(23);\n    s += TSF(24);\n    s += TSF(25);\n#ifdef _PCFx25\n    const float kernSize = 25.;\n#else\n    s += TSF(26);\n    s += TSF(27);\n    s += TSF(28);\n    s += TSF(29);\n    s += TSF(30);\n    s += TSF(31);\n    s += TSF(32);\n#ifdef _PCFx32\n    const float kernSize = 32.;\n#endif // 32\n#endif // 25\n#endif // 16\n#endif // 8\n#endif // 4\n\n    s /= kernSize;\n    return s;\n}\n// end poisson\n#undef TSF\n'
}
, function(t, e) {
    t.exports = '////////////////////////////////////////////////\n// ESM\nfloat fetchESM(const in sampler2D tex, const in vec4 shadowMapSize, const in vec2 shadowUV, const in float shadowZ,  const in float exponent0, const in float exponent1) {\n\n\n#if defined(_FLOATTEX) && (!defined(_FLOATLINEAR))\n    // emulate bilinear filtering (not needed if webgm/GPU support filtering FP32/FP16 textures)\n    vec2 unnormalized = shadowUV * shadowMapSize.xy;\n    vec2 fractional = fract(unnormalized);\n    unnormalized = floor(unnormalized);\n\n    vec4 occluder4;\n    occluder4.x = getSingleFloatFromTex(tex, (unnormalized + vec2( -0.5,  0.5 ))* shadowMapSize.zw );\n    occluder4.y = getSingleFloatFromTex(tex, (unnormalized + vec2( 0.5,   0.5 ))* shadowMapSize.zw );\n    occluder4.z = getSingleFloatFromTex(tex, (unnormalized + vec2( 0.5,  -0.5 ))* shadowMapSize.zw );\n    occluder4.w = getSingleFloatFromTex(tex, (unnormalized + vec2( -0.5, -0.5 ))* shadowMapSize.zw );\n\n    float occluder = (occluder4.w + (occluder4.x - occluder4.w) * fractional.y);\n    occluder = occluder + ((occluder4.z + (occluder4.y - occluder4.z) * fractional.y) - occluder)*fractional.x;\n\n#else\n    float occluder = getSingleFloatFromTex(tex, shadowUV);\n#endif\n\n\n    // we\'re on an edge\n    float depthScale = exponent1;\n    float over_darkening_factor = exponent0;\n    float receiver = depthScale * ( shadowZ);\n    return 1.0 - clamp(over_darkening_factor*(occluder*exp(receiver)), 0.0, 1.0);\n}\n\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias,\n                    const in float exponent0,\n                    const in float exponent1\n    )\n{\n    #pragma include "shadowsReceiveMain.glsl" "_ESM"\n}\n\n// end ESM\n'
}
, function(t, e) {
    t.exports = '//////VSM\n//http://en.wikipedia.org/wiki/Chebyshev%27s_inequality\nfloat chebychevInequality (const in vec2 moments, const in float t)\n{\n    // No shadow if depth of fragment is in front\n    if ( t <= moments.x )\n        return 1.0;\n\n    // Calculate variance, which is actually the amount of\n    // error due to precision loss from fp32 to RG/BA\n    // (moment1 / moment2)\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, 0.02);\n\n    // Calculate the upper bound\n    float d = t - moments.x;\n    return variance / (variance + d * d);\n}\n\n// http://http.developer.nvidia.com/GPUGems3/gpugems3_ch08.html\nfloat chebyshevUpperBound(const in vec2 moments, const in float mean, const in float minVariance)\n{\n    float d = mean - moments.x;\n    if ( d <= 0.0 )\n        return 1.0;\n    // Compute variance\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, minVariance);\n\n    // Compute probabilistic upper bound\n    //p represent an upper bound on the visibility percentage of the receiver. This value //attempts to estimate how much of the distribution of occluders at the surface location is //beyond the surface\'s distance from the light. If it is 0, then there is no probability //that the fragment is partially lit, so it will be fully in shadow. If it is a value in the //[0, 1] range, it represent the penumbrae value of the shadow edge.\n    float p = smoothstep(mean, mean, moments.x);\n\n    // Remove the [0, Amount] tail and linearly rescale (Amount, 1].\n    /// light bleeding when shadows overlap.\n\n    float pMax = smoothstep(0.2, 1.0, variance / (variance + d*d));\n    // One-tailed chebyshev\n    return clamp(max(p, pMax), 0.0, 1.0);\n}\n\n// might be included for EVSM\n#ifdef _VSM\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias,\n                    const in float epsilonVSM\n    )\n{\n#pragma include "shadowsReceiveMain.glsl" "_VSM"\n}\n#endif // _VSM\n\n// end VSM\n'
}
, function(t, e) {
    t.exports = '// EVSM\n\n#pragma include "vsm.glsl"\n\n// Convert depth to EVSM coefficients\n// Input depth should be in [0, 1]\nvec2 warpDepth(const in float depth, const in vec2 exponents)\n{\n    float pos =  exp( exponents.x * depth);\n    float neg = -exp(-exponents.y * depth);\n    return vec2(pos, neg);\n}\n\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias,\n                    const in float epsilonVSM,\n                    const in float exponent0,\n                    const in float exponent1\n    )\n{\n    #pragma include "shadowsReceiveMain.glsl" "_EVSM"\n}\n\n// _EVSM\n'
}
, function(t, e, i) {
    "use strict";
    var n = [i(1375), i(1406), i(1408), i(1409), i(1410), i(1411), i(1412)]
      , r = {};
    n.forEach(function(t) {
        window.Object.keys(t).forEach(function(e) {
            var i = t[e];
            if (void 0 !== this[e])
                throw "duplicate entry in node library";
            this[e] = i
        }, this)
    }, r),
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1376)
      , a = i(1407)
      , s = function() {
        a.call(this)
    }
      , o = function(t) {
        return "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    };
    s.prototype = n.objectInherit(a.prototype, {
        type: "Morph",
        validInputs: ["weights", "vertex", "target0"],
        validOutputs: ["out"],
        globalFunctionDeclaration: function() {
            var t = window.Object.keys(this._inputs).length - 2
              , e = 0
              , i = "vec3 morphTransform( const in vec4 weights,  const in vec3 vertex, const in vec3 target0";
            for (e = 1; e < t; ++e)
                i += ", const in vec3 target" + e;
            if (i += " ) { \n",
            1 === t)
                i += "return mix(vertex, target0, weights[0])";
            else {
                for (i += "\tvec3 vecOut = vertex * (1.0 - ( weights[0]",
                e = 1; e < t; ++e)
                    i += " + weights[" + e + "]";
                for (i += "));\n",
                e = 0; e < t; ++e)
                    i += "\tvecOut += target" + e + " * weights[" + e + "];\n";
                i += "\treturn vecOut"
            }
            return i += ";\n}\n"
        },
        computeShader: function() {
            for (var t = this._inputs, e = [t.weights, o(t.vertex)], i = 0; i < 4 && t["target" + i]; i++)
                e.push(o(t["target" + i]));
            return r.callFunction("morphTransform", this._outputs.out, e)
        }
    }),
    t.exports = {
        Morph: s
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = 0
      , a = function() {
        this._name = "AbstractNode",
        this._inputs = [],
        this._outputs = null,
        this._id = r++,
        this._text = void 0
    };
    a.prototype = {
        getID: function() {
            return this._id
        },
        getName: function() {
            return this._name
        },
        getType: function() {
            return this.type
        },
        toString: function() {
            var t = "name : " + this._name;
            return this.type && (t += " (" + this.type + ")"),
            t
        },
        getInputs: function() {
            return this._inputs
        },
        getOutputs: function() {
            return this._outputs
        },
        checkInputsOutputs: function() {
            var t, e;
            if (this.validInputs)
                for (t = 0; t < this.validInputs.length; t++)
                    if (e = this.validInputs[t],
                    !this._inputs[e])
                        return n.error("Shader node " + this.type + " validation error input " + e + " is missing"),
                        !1;
            if (this.validOutputs)
                for (t = 0; t < this.validOutputs.length; t++)
                    if (e = this.validOutputs[t],
                    !this._outputs[e])
                        return n.error("Shader node " + this.type + " validation error output " + e + " is missing"),
                        !1;
            return !0
        },
        inputs: function() {
            for (var t = 0, e = arguments.length; t < e; t++) {
                var i = arguments[t];
                if (!i) {
                    n.error("Shader node " + this.type + " input number " + e + " is undefined ");
                    break
                }
                if (Array.isArray(i))
                    return this.inputs.apply(this, i),
                    this;
                if ("object" == typeof i && null !== i && i instanceof a == !1)
                    return this._inputs = i,
                    this;
                this._inputs.push(i)
            }
            return this
        },
        outputs: function(t) {
            if (this._outputs = t,
            this._outputs instanceof a == !0)
                this.autoLink(this._outputs);
            else
                for (var e = window.Object.keys(this._outputs), i = 0; i < e.length; i++) {
                    var n = e[i];
                    this.autoLink(this._outputs[n])
                }
            return this
        },
        autoLink: function(t) {
            return void 0 === t ? this : (t.inputs(this),
            this)
        },
        computeShader: function() {
            return this._text
        },
        comment: function(t) {
            this._comment = "//" + t
        },
        getComment: function() {
            return this._comment
        }
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1376)
      , a = i(1407)
      , s = r.sprintf
      , o = function(t, e) {
        a.call(this),
        this._name = "Variable",
        this._prefix = e,
        this._type = t,
        this._value = void 0
    };
    o.prototype = n.objectInherit(a.prototype, {
        getType: function() {
            return this._type
        },
        getVariable: function() {
            return this._prefix
        },
        setValue: function(t) {
            return this._value = t,
            this
        },
        toString: function() {
            var t = "prefix : " + this._prefix;
            return t += ", name : " + this._prefix,
            this.type && (t += " (" + this.type + ")"),
            t
        },
        declare: function() {
            return void 0 !== this._value ? s("%s %s = %s;", [this._type, this.getVariable(), this._value]) : s("%s %s;", [this._type, this.getVariable()])
        },
        isEmpty: function() {
            return void 0 === this._value && 0 === this._inputs.length
        },
        reset: function() {
            this._inputs = [],
            this._outputs = null,
            this._value = void 0,
            this._text = void 0
        }
    });
    var u = function(t, e) {
        o.call(this, t, e)
    };
    u.prototype = n.objectInherit(o.prototype, {
        declare: function() {
            return s("const %s %s = %s;", [this._type, this.getVariable(), this._value])
        }
    });
    var l = function(t, e, i) {
        o.call(this, t, e),
        this._size = i
    };
    l.prototype = n.objectInherit(o.prototype, {
        declare: function() {},
        globalDeclaration: function() {
            return this._size ? s("uniform %s %s[%s];", [this._type, this.getVariable(), this._size]) : s("uniform %s %s;", [this._type, this.getVariable()])
        }
    });
    var c = function(t, e) {
        o.call(this, t, e)
    };
    c.prototype = n.objectInherit(o.prototype, {
        declare: function() {},
        globalDeclaration: function() {
            return s("attribute %s %s;", [this._type, this.getVariable()])
        }
    });
    var h = function(t, e) {
        o.call(this, t, e)
    };
    h.prototype = n.objectInherit(o.prototype, {
        declare: function() {},
        globalDeclaration: function() {
            return s("varying %s %s;", [this._type, this.getVariable()])
        }
    });
    var d = function(t, e) {
        o.call(this, t, e)
    };
    d.prototype = n.objectInherit(o.prototype, {
        declare: function() {},
        globalDeclaration: function() {
            return s("uniform %s %s;", [this._type, this.getVariable()])
        }
    });
    var p = function(t, e) {
        o.call(this, t, e)
    };
    p.prototype = n.objectInherit(o.prototype, {
        _unique: !0,
        isUnique: function() {
            return this._unique
        },
        outputs: function() {
            return this
        },
        getVariable: function() {
            return this._prefix
        }
    });
    var f = function() {
        p.call(this, "vec4", "gl_FragColor"),
        this._name = "glFragColor"
    };
    f.prototype = n.objectInherit(p.prototype, {});
    var g = function() {
        p.call(this, "vec4", "gl_Position"),
        this._name = "glPosition"
    };
    g.prototype = n.objectInherit(p.prototype, {});
    var m = function() {
        p.call(this, "float", "gl_PointSize"),
        this._name = "glPointSize"
    };
    m.prototype = n.objectInherit(p.prototype, {}),
    t.exports = {
        Output: p,
        glPointSize: m,
        glPosition: g,
        glFragColor: f,
        Sampler: d,
        Variable: o,
        Constant: u,
        Attribute: c,
        Varying: h,
        Uniform: l
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1376)
      , a = i(1407)
      , s = function() {
        a.call(this)
    };
    s.prototype = n.objectInherit(a.prototype, {
        type: "TextureAbstractNode",
        functionName: "noTextureFunction",
        validInputs: ["sampler", "uv"],
        validOutputs: ["color"],
        computeShader: function() {
            return r.callFunction(this.functionName, this._outputs.color, [this._inputs.sampler, this._inputs.uv.getVariable() + ".xy"])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "textures.glsl"'
        }
    });
    var o = function() {
        s.call(this)
    };
    o.prototype = n.objectInherit(s.prototype, {
        type: "TextureRGB",
        functionName: "textureRGB"
    });
    var u = function() {
        o.call(this)
    };
    u.prototype = n.objectInherit(o.prototype, {
        type: "TextureRGBA",
        functionName: "textureRGBA"
    });
    var l = function() {
        o.call(this)
    };
    l.prototype = n.objectInherit(o.prototype, {
        type: "TextureAlpha",
        functionName: "textureAlpha"
    });
    var c = function() {
        o.call(this)
    };
    c.prototype = n.objectInherit(o.prototype, {
        type: "TextureIntensity",
        functionName: "textureIntensity"
    }),
    t.exports = {
        NodeTextures: s,
        TextureRGB: o,
        TextureRGBA: u,
        TextureAlpha: l,
        TextureIntensity: c
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1376)
      , a = i(1407)
      , s = r.sprintf
      , o = function() {
        a.call(this)
    };
    o.prototype = n.objectInherit(a.prototype, {
        globalFunctionDeclaration: function() {
            return '#pragma include "functions.glsl"'
        }
    });
    var u = function() {
        o.call(this)
    };
    u.prototype = n.objectInherit(o.prototype, {
        type: "Normalize",
        validInputs: ["vec"],
        validOuputs: ["vec"],
        computeShader: function() {
            return r.callFunction("normalize", this._outputs.vec, [this._inputs.vec])
        }
    });
    var l = function() {
        o.call(this)
    };
    l.prototype = n.objectInherit(o.prototype, {
        type: "sRGBToLinear",
        validInputs: ["color"],
        validOuputs: ["color"],
        computeShader: function() {
            return this.computeConversion("sRGBToLinear")
        },
        computeConversion: function(t) {
            var e = this._outputs.color
              , i = this._inputs.color
              , n = e.getType() !== i.getType() ? ".rgb" : "";
            return r.callFunction(t, e.getVariable() + n, [i.getVariable() + n])
        }
    });
    var c = function() {
        l.call(this)
    };
    c.prototype = n.objectInherit(l.prototype, {
        type: "LinearTosRGB",
        computeShader: function() {
            return this.computeConversion("linearTosRGB")
        }
    });
    var h = function() {
        o.call(this)
    };
    h.prototype = n.objectInherit(o.prototype, {
        type: "FrontNormal",
        validInputs: ["normal"],
        validOuputs: ["normal"],
        computeShader: function() {
            return s("%s = gl_FrontFacing ? %s : -%s ;", [this._outputs.normal.getVariable(), this._inputs.normal.getVariable(), this._inputs.normal.getVariable()])
        }
    });
    var d = function(t) {
        return t.getType && "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    }
      , p = function() {
        o.call(this)
    };
    p.prototype = n.objectInherit(o.prototype, {
        type: "EncodeRGBM",
        validInputs: ["color", "range"],
        validOutputs: ["color"],
        computeShader: function() {
            return r.callFunction("encodeRGBM", this._outputs.color, [d(this._inputs.color), this._inputs.range])
        }
    });
    var f = function() {
        o.call(this)
    };
    f.prototype = n.objectInherit(o.prototype, {
        type: "DecodeRGBM",
        validInputs: ["color", "range"],
        validOutputs: ["color"],
        computeShader: function() {
            return r.callFunction("decodeRGBM", this._outputs.color, [this._inputs.color, this._inputs.range])
        }
    });
    var g = function(t) {
        a.call(this),
        this._defineName = t,
        this._defineValue = ""
    };
    g.prototype = n.objectInherit(a.prototype, {
        type: "Define",
        setValue: function(t) {
            return this._defineValue = t,
            this
        },
        getDefines: function() {
            return ["#define " + this._defineName + " " + this._defineValue]
        }
    }),
    t.exports = {
        NodeFunctions: o,
        Normalize: u,
        sRGBToLinear: l,
        LinearTosRGB: c,
        FrontNormal: h,
        DecodeRGBM: f,
        EncodeRGBM: p,
        Define: g
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1376)
      , a = i(1407)
      , s = function() {
        a.call(this)
    };
    s.prototype = n.objectInherit(a.prototype, {
        validOutputs: ["color"],
        globalFunctionDeclaration: function() {
            return '#pragma include "lights.glsl"'
        }
    });
    var o = function(t) {
        return "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    }
      , u = function() {
        s.call(this)
    };
    u.prototype = n.objectInherit(s.prototype, {
        type: "PointLight",
        validInputs: ["normal", "eyeVector", "materialambient", "materialdiffuse", "materialspecular", "materialshininess", "lightambient", "lightdiffuse", "lightspecular", "lightposition", "lightattenuation", "lightmatrix", "lighted", "lightEyePos", "lightEyeDir", "lightNDL"],
        computeShader: function() {
            return r.callFunction("computePointLightShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, o(this._inputs.materialambient), o(this._inputs.materialdiffuse), o(this._inputs.materialspecular), this._inputs.materialshininess, o(this._inputs.lightambient), o(this._inputs.lightdiffuse), o(this._inputs.lightspecular), this._inputs.lightposition, this._inputs.lightattenuation, this._inputs.lightmatrix, this._inputs.lightEyePos, this._inputs.lightEyeDir, this._inputs.lightNDL, this._inputs.lighted])
        }
    });
    var l = function() {
        s.call(this)
    };
    l.prototype = n.objectInherit(s.prototype, {
        type: "SpotLight",
        validInputs: ["normal", "eyeVector", "materialambient", "materialdiffuse", "materialspecular", "materialshininess", "lightambient", "lightdiffuse", "lightspecular", "lightdirection", "lightattenuation", "lightposition", "lightspotCutOff", "lightspotBlend", "lightmatrix", "lightinvMatrix", "lighted", "lightEyePos", "lightEyeDir", "lightNDL"],
        computeShader: function() {
            return r.callFunction("computeSpotLightShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, o(this._inputs.materialambient), o(this._inputs.materialdiffuse), o(this._inputs.materialspecular), this._inputs.materialshininess, o(this._inputs.lightambient), o(this._inputs.lightdiffuse), o(this._inputs.lightspecular), this._inputs.lightdirection, this._inputs.lightattenuation, this._inputs.lightposition, this._inputs.lightspotCutOff, this._inputs.lightspotBlend, this._inputs.lightmatrix, this._inputs.lightinvMatrix, this._inputs.lightEyePos, this._inputs.lightEyeDir, this._inputs.lightNDL, this._inputs.lighted])
        }
    });
    var c = function() {
        s.call(this)
    };
    c.prototype = n.objectInherit(s.prototype, {
        type: "SunLight",
        validInputs: ["normal", "eyeVector", "materialambient", "materialdiffuse", "materialspecular", "materialshininess", "lightambient", "lightdiffuse", "lightspecular", "lightposition", "lightmatrix", "lighted", "lightEyeDir", "lightNDL"],
        computeShader: function() {
            return r.callFunction("computeSunLightShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, o(this._inputs.materialambient), o(this._inputs.materialdiffuse), o(this._inputs.materialspecular), this._inputs.materialshininess, o(this._inputs.lightambient), o(this._inputs.lightdiffuse), o(this._inputs.lightspecular), this._inputs.lightposition, this._inputs.lightmatrix, this._inputs.lightEyeDir, this._inputs.lightNDL, this._inputs.lighted])
        }
    });
    var h = function() {
        s.call(this)
    };
    h.prototype = n.objectInherit(s.prototype, {
        type: "HemiLight",
        validInputs: ["normal", "eyeVector", "materialdiffuse", "materialspecular", "materialshininess", "lightdiffuse", "lightground", "lightposition", "lightmatrix", "lighted", "lightEyeDir", "lightNDL"],
        computeShader: function() {
            return r.callFunction("computeHemiLightShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, o(this._inputs.materialdiffuse), o(this._inputs.materialspecular), this._inputs.materialshininess, o(this._inputs.lightdiffuse), o(this._inputs.lightground), this._inputs.lightposition, this._inputs.lightmatrix, this._inputs.lightEyeDir, this._inputs.lightNDL, this._inputs.lighted])
        }
    }),
    t.exports = {
        PointLight: u,
        SpotLight: l,
        SunLight: c,
        HemiLight: h
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1203)
      , a = i(1407)
      , s = i(1376)
      , o = s.sprintf
      , u = function() {
        a.call(this)
    };
    u.prototype = a.prototype;
    var l = function() {
        u.call(this)
    };
    l.prototype = r.objectInherit(u.prototype, {
        type: "Add",
        operator: "+",
        computeShader: function() {
            var t = this._outputs.getType()
              , e = "";
            "vec4" === t ? e = ".rgba" : "vec3" === t ? e = ".rgb" : "vec2" === t && (e = ".rg");
            for (var i = this._outputs.getVariable() + " = " + this._inputs[0].getVariable() + e, n = 1, r = this._inputs.length; n < r; n++) {
                var a = this._inputs[n];
                i += this.operator + a.getVariable(),
                "float" !== a.getType() && (i += e)
            }
            return i += ";"
        }
    });
    var c = function() {
        l.call(this)
    };
    c.prototype = r.objectInherit(l.prototype, {
        type: "Mult",
        operator: "*"
    });
    var h = function() {
        l.call(this)
    };
    h.prototype = r.objectInherit(l.prototype, {
        type: "SetFromNode"
    });
    var d = function() {
        l.call(this),
        this._overwriteW = !0,
        this._forceComplement = !0,
        this._inverseOp = !1
    };
    d.prototype = r.objectInherit(l.prototype, {
        type: "MatrixMultDirection",
        operator: "*",
        validInputs: ["vec", "matrix"],
        validOutputs: ["vec"],
        complement: "0.",
        setInverse: function(t) {
            return this._inverseOp = t,
            this
        },
        setForceComplement: function(t) {
            return this._forceComplement = t,
            this
        },
        setOverwriteW: function(t) {
            return this._overwriteW = t,
            this
        },
        computeShader: function() {
            var t = this._inputs.vec.getVariable()
              , e = this._inputs.matrix.getVariable()
              , i = this._outputs.vec.getVariable()
              , n = this._inputs.vec.getType()
              , r = this._outputs.vec.getType()
              , a = i + " = ";
            "vec4" !== r && (a += r + "(");
            var s = t;
            return (this._forceComplement || "vec4" !== n) && (s = "vec4(" + t + ".xyz, " + this.complement + ")"),
            a += this._inverseOp ? s + this.operator + e : e + this.operator + s,
            "vec4" !== r && (a += ")"),
            a += ";",
            this._overwriteW || "vec4" !== n || (a += "\n" + i + ".a = " + t + ".a;"),
            a
        }
    });
    var p = function() {
        d.call(this),
        this._forceComplement = !1
    };
    p.prototype = r.objectInherit(d.prototype, {
        type: "MatrixMultPosition",
        complement: "1."
    });
    var f = function() {
        a.call(this)
    };
    f.prototype = r.objectInherit(a.prototype, {
        type: "InlineCode",
        code: function(t) {
            return this._text = t,
            this
        },
        computeShader: function() {
            var t = r.objectMix({}, this._inputs);
            t = r.objectMix(t, this._outputs);
            for (var e = new RegExp("%[A-Za-z0-9_]+","gm"), i = this._text, a = this._text.match(e), s = new Set, o = 0; o < a.length; o++) {
                var u = a[o].substr(1);
                if (!s.has(u)) {
                    t[u] || (n.error("error with inline code\n" + this._text),
                    n.error("input " + u + " not provided for " + a[o]));
                    var l = new RegExp(a[o].toString(),"gm");
                    i = i.replace(l, t[u].getVariable()),
                    s.add(u)
                }
            }
            return i
        }
    });
    var g = function() {
        u.call(this)
    };
    g.prototype = r.objectInherit(u.prototype, {
        type: "SetAlpha",
        validInputs: ["color", "alpha"],
        validOuputs: ["color"],
        computeShader: function() {
            var t = this._inputs.alpha;
            return o("%s = vec4( %s.rgb, %s );", [this._outputs.color.getVariable(), this._inputs.color.getVariable(), "float" !== t.getType() ? t.getVariable() + ".a" : t.getVariable()])
        }
    });
    var m = function() {
        u.call(this)
    };
    m.prototype = r.objectInherit(u.prototype, {
        type: "PreMultAlpha",
        validInputs: ["color"],
        validOuputs: ["color"],
        computeShader: function() {
            var t, e = void 0 !== this._inputs.alpha ? this._inputs.alpha : this._inputs.color;
            return t = "float" !== e.getType() ? e.getVariable() + ".a" : e.getVariable(),
            o("%s.rgb = %s.rgb * %s;", [this._outputs.color.getVariable(), this._inputs.color.getVariable(), t])
        }
    }),
    t.exports = {
        BaseOperator: u,
        Mult: c,
        MatrixMultPosition: p,
        MatrixMultDirection: d,
        Add: l,
        InlineCode: f,
        SetAlpha: g,
        SetFromNode: h,
        PreMultAlpha: m
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1376)
      , a = i(1407)
      , s = function() {
        a.call(this)
    };
    s.prototype = n.objectInherit(a.prototype, {
        type: "ShadowReceiveNode",
        validInputs: ["lighted", "shadowTexture", "shadowTextureMapSize", "shadowTextureProjectionMatrix", "shadowTextureViewMatrix", "shadowTextureDepthRange", "lightNDL", "vertexWorld", "shadowbias"],
        validOutputs: ["float"],
        globalFunctionDeclaration: function() {
            return '#pragma include "shadowsReceive.glsl"'
        },
        setShadowAttribute: function(t) {
            this._shadow = t
        },
        getDefines: function() {
            return this._shadow.getDefines()
        },
        getExtensions: function() {
            return this._shadow.getExtensions()
        },
        computeShader: function() {
            var t = this._inputs
              , e = [t.lighted, t.shadowTexture, t.shadowTextureMapSize, t.shadowTextureProjectionMatrix, t.shadowTextureViewMatrix, t.shadowTextureDepthRange, t.lightNDL, t.vertexWorld, t.shadowbias]
              , i = this._shadow.getAlgorithm();
            return "ESM" === i ? (e.push(this._inputs.shadowexponent0),
            e.push(this._inputs.shadowexponent1)) : "EVSM" === i ? (e.push(this._inputs.shadowepsilonVSM),
            e.push(this._inputs.shadowexponent0),
            e.push(this._inputs.shadowexponent1)) : "VSM" === i && e.push(this._inputs.shadowepsilonVSM),
            r.callFunction("computeShadow", this._outputs["float"], e)
        }
    });
    var o = function() {
        a.call(this)
    };
    o.prototype = n.objectInherit(a.prototype, {
        type: "ShadowCast",
        validInputs: ["exponent0", "exponent1", "shadowDepthRange", "fragEye"],
        validOutputs: ["color"],
        globalFunctionDeclaration: function() {
            return '#pragma include "shadowsCastFrag.glsl"'
        },
        setShadowCastAttribute: function(t) {
            return this._shadowCast = t,
            this
        },
        getDefines: function() {
            return this._shadowCast.getDefines()
        },
        computeShader: function() {
            var t = this._inputs
              , e = this._shadowCast.getAlgorithm();
            return "NONE" === e || "PCF" === e ? r.callFunction("computeShadowDepth", this._outputs.color, [t.fragEye, t.shadowDepthRange]) : r.callFunction("computeShadowDepth", this._outputs.color, [t.fragEye, t.shadowDepthRange, t.exponent0, t.exponent1])
        }
    }),
    t.exports = {
        ShadowCast: o,
        ShadowReceive: s
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1376)
      , a = i(1407)
      , s = function() {
        a.apply(this)
    };
    s.prototype = n.objectInherit(a.prototype, {
        type: "Billboard",
        validInputs: ["Vertex", "ModelViewMatrix", "ProjectionMatrix"],
        validOutputs: ["vec"],
        globalFunctionDeclaration: function() {
            return '#pragma include "billboard.glsl"'
        },
        computeShader: function() {
            return r.callFunction("billboard", this._outputs.vec, [this._inputs.Vertex, this._inputs.ModelViewMatrix, this._inputs.ProjectionMatrix])
        }
    }),
    t.exports = {
        Billboard: s
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = {
        createVertexShader: function() {
            this._fragmentShaderMode = !1;
            var t = this.declareVertexMain()
              , e = this.getVertexShaderName();
            e && t.push(this.getNode("Define", "SHADER_NAME").setValue(e));
            var i = this.createShaderFromGraphs(t);
            return n.debug(i),
            i
        },
        declareVertexMain: function() {
            var t = this.getNode("glPointSize");
            this.getNode("SetFromNode").inputs(this.getOrCreateConstantOne("float")).outputs(t);
            var e = [t, this.declareVertexPosition()];
            return this.declareVertexVaryings(e),
            e
        },
        declareVertexVaryings: function(t) {
            var e = this._varyings;
            e.vModelVertex && this.getNode("SetFromNode").inputs(this.getOrCreateModelVertex()).outputs(e.vModelVertex),
            e.vModelNormal && this.getNode("SetFromNode").inputs(this.getOrCreateModelNormal()).outputs(e.vModelNormal),
            e.vModelTangent && this.getNode("SetFromNode").inputs(this.getOrCreateModelTangent()).outputs(e.vModelTangent),
            e.vViewVertex && this.getNode("SetFromNode").inputs(this.getOrCreateViewVertex()).outputs(e.vViewVertex),
            e.vViewNormal && this.getNode("SetFromNode").inputs(this.getOrCreateViewNormal()).outputs(e.vViewNormal),
            e.vViewTangent && this.getNode("SetFromNode").inputs(this.getOrCreateViewTangent()).outputs(e.vViewTangent),
            e.vVertexColor && this.getNode("InlineCode").code("%vcolor = %venabled == 1.0 ? %acolor : vec4(1.0, 1.0, 1.0, 1.0);").inputs({
                venabled: this.getOrCreateUniform("float", "uArrayColorEnabled"),
                acolor: this.getOrCreateAttribute("vec4", "Color")
            }).outputs({
                vcolor: this.getOrCreateVarying("vec4", "vVertexColor")
            });
            for (var i = window.Object.keys(e), n = 0, r = i.length; n < r; n++) {
                var a = e[i[n]];
                t.push(a);
                var s = a.getVariable();
                s.indexOf("vTexCoord") !== -1 && this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec2", s.substring(1))).outputs(a)
            }
        },
        declareVertexPosition: function() {
            var t = this.getNode("glPosition");
            return this._isBillboard ? this.declareVertexTransformBillboard(t) : this.declareScreenVertex(t),
            t
        },
        getOrCreateModelVertex: function() {
            var t = this._variables.modelVertex;
            return t ? t : (t = this.createVariable("vec3", "modelVertex"),
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uModelMatrix"),
                vec: this.getOrCreateLocalVertex()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateModelNormal: function() {
            var t = this._variables.modelNormal;
            return t ? t : (t = this.createVariable("vec3", "modelNormal"),
            this.getNode("MatrixMultDirection").inputs({
                matrix: this.getOrCreateUniform("mat4", "uModelMatrix"),
                vec: this.getOrCreateLocalNormal()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateModelTangent: function() {
            var t = this._variables.modelTangent;
            return t ? t : (t = this.createVariable("vec4", "modelTangent"),
            this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({
                matrix: this.getOrCreateUniform("mat4", "uModelMatrix"),
                vec: this.getOrCreateLocalTangent()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateViewVertex: function() {
            var t = this._variables.viewVertex;
            return t ? t : (t = this.createVariable("vec4", "viewVertex"),
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uModelViewMatrix"),
                vec: this.getOrCreateLocalVertex()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateViewNormal: function() {
            var t = this._variables.viewNormal;
            return t ? t : (t = this.createVariable("vec3", "viewNormal"),
            this.getNode("MatrixMultDirection").inputs({
                matrix: this.getOrCreateUniform("mat4", "uModelViewNormalMatrix"),
                vec: this.getOrCreateLocalNormal()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateViewTangent: function() {
            var t = this._variables.viewTangent;
            return t ? t : (t = this.createVariable("vec4", "viewTangent"),
            this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({
                matrix: this.getOrCreateUniform("mat4", "uModelViewNormalMatrix"),
                vec: this.getOrCreateLocalTangent()
            }).outputs({
                vec: t
            }),
            t)
        },
        declareScreenVertex: function(t) {
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateProjectionMatrix(),
                vec: this.getOrCreateViewVertex()
            }).outputs({
                vec: t
            })
        },
        declareVertexTransformBillboard: function(t) {
            this.getNode("Billboard").inputs({
                Vertex: this.getOrCreateAttribute("vec3", "Vertex"),
                ModelViewMatrix: this.getOrCreateUniform("mat4", "uModelViewMatrix"),
                ProjectionMatrix: this.getOrCreateUniform("mat4", "uProjectionMatrix")
            }).outputs({
                vec: t
            })
        },
        getOrCreateBoneMatrix: function() {
            var t = this._variables.boneMatrix;
            if (t)
                return t;
            t = this.createVariable("mat4", "boneMatrix");
            var e = this.getOrCreateAttribute("vec4", "Weights")
              , i = this.getOrCreateAttribute("vec4", "Bones")
              , n = this.getOrCreateUniform("vec4", "uBones", this._skinningAttribute.getBoneUniformSize());
            return this.getNode("Skinning").inputs({
                weights: e,
                bonesIndex: i,
                matrixPalette: n
            }).outputs({
                mat4: t
            }),
            t
        },
        getTarget: function(t, e) {
            var i = t.indexOf("Tangent") !== -1 ? "vec4" : "vec3";
            return this.getOrCreateAttribute(i, t + "_" + e)
        },
        morphTangentApproximation: function(t, e) {
            var i = this.getOrCreateLocalNormal();
            return this._skinningAttribute && (i = this.createVariable("vec3"),
            this.getNode("Normalize").inputs({
                vec: this.getOrCreateMorphNormal()
            }).outputs({
                vec: i
            })),
            this.getNode("InlineCode").code("%out = %tangent.rgb - dot(%tangent.rgb, %normal) * %normal;").inputs({
                tangent: t,
                normal: i
            }).outputs({
                out: e
            }),
            e
        },
        morphTransformVec3: function(t, e) {
            for (var i = {
                vertex: t,
                weights: this.getOrCreateUniform("vec4", "uTargetWeights")
            }, n = this._morphAttribute.getNumTargets(), r = 0; r < n; r++)
                i["target" + r] = this.getTarget(t.getVariable(), r);
            return this.getNode("Morph").inputs(i).outputs({
                out: e
            }),
            e
        },
        skinTransformVertex: function(t, e) {
            return this.getNode("MatrixMultPosition").setInverse(!0).inputs({
                matrix: this.getOrCreateBoneMatrix(),
                vec: t
            }).outputs({
                vec: e
            }),
            e
        },
        skinTransformNormal: function(t, e) {
            return this.getNode("MatrixMultDirection").setInverse(!0).inputs({
                matrix: this.getOrCreateBoneMatrix(),
                vec: t
            }).outputs({
                vec: e
            }),
            e
        },
        getOrCreateMorphVertex: function() {
            var t = this.getVariable("morphVertex");
            if (t)
                return t;
            var e = this.getOrCreateAttribute("vec3", "Vertex");
            return this._morphAttribute && this._morphAttribute.hasTarget("Vertex") ? this.morphTransformVec3(e, this.createVariable("vec3", "morphVertex")) : e
        },
        getOrCreateMorphNormal: function() {
            var t = this.getVariable("morphNormal");
            if (t)
                return t;
            var e = this.getOrCreateAttribute("vec3", "Normal");
            return this._morphAttribute && this._morphAttribute.hasTarget("Normal") ? this.morphTransformVec3(e, this.createVariable("vec3", "morphNormal")) : e
        },
        getOrCreateMorphTangent: function() {
            var t = this.getVariable("morphTangent");
            if (t)
                return t;
            var e = this.getOrCreateAttribute("vec4", "Tangent")
              , i = this._morphAttribute && this._morphAttribute.hasTarget("Tangent");
            return i ? this.morphTransformVec3(e, this.createVariable("vec3", "morphTangent")) : e
        },
        getOrCreateSkinVertex: function() {
            var t = this.getVariable("skinVertex");
            if (t)
                return t;
            var e = this.getOrCreateMorphVertex();
            return this._skinningAttribute ? this.skinTransformVertex(e, this.createVariable("vec3", "skinVertex")) : e
        },
        getOrCreateSkinNormal: function() {
            var t = this.getVariable("skinNormal");
            if (t)
                return t;
            var e = this.getOrCreateMorphNormal();
            return this._skinningAttribute ? this.skinTransformNormal(e, this.createVariable("vec3", "skinNormal")) : e
        },
        getOrCreateSkinTangent: function() {
            var t = this.getVariable("skinTangent");
            if (t)
                return t;
            var e = this.getOrCreateMorphTangent();
            return this._skinningAttribute ? this.skinTransformNormal(e, this.createVariable("vec3", "skinTangent")) : e
        },
        getOrCreateLocalVertex: function() {
            return this.getOrCreateSkinVertex()
        },
        getOrCreateLocalNormal: function() {
            var t = this.getVariable("localNormal");
            if (t)
                return t;
            var e = this.getOrCreateSkinNormal();
            return e === this.getOrCreateAttribute("vec3", "Normal") ? e : (t = this.createVariable("vec3", "localNormal"),
            this.getNode("Normalize").inputs({
                vec: e
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateLocalTangent: function() {
            var t = this.getVariable("localTangent");
            if (t)
                return t;
            var e = this.getOrCreateAttribute("vec4", "Tangent")
              , i = this.getOrCreateSkinTangent();
            return i === e ? i : this.normalizeAndSetAlpha(i, e, this.createVariable("vec4", "localTangent"))
        },
        normalizeAndSetAlpha: function(t, e, i) {
            var n = this.createVariable("vec3");
            return this.getNode("Normalize").inputs({
                vec: t
            }).outputs({
                vec: n
            }),
            this.getNode("SetAlpha").inputs({
                color: n,
                alpha: e
            }).outputs({
                color: i
            }),
            i
        }
    };
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1301)
      , r = i(1207)
      , a = i(1203)
      , s = {
        createFragmentShader: function() {
            this._fragmentShaderMode = !0;
            var t = this.createFragmentShaderGraph()
              , e = this.getFragmentShaderName();
            e && t.push(this.getNode("Define", "SHADER_NAME").setValue(e));
            var i = this.createShaderFromGraphs(t);
            return r.debug(i),
            this.cleanAfterFragment(),
            i
        },
        cleanAfterFragment: function() {
            this._variables = {},
            this._activeNodeList = {};
            for (var t = this._texturesByName, e = window.Object.keys(t), i = 0; i < e.length; i++)
                t[e[i]].variable = void 0;
            for (var n = this._varyings, r = window.Object.keys(n), a = 0, s = r.length; a < s; a++) {
                var o = r[a]
                  , u = n[o];
                u.reset(),
                this._activeNodeList[u.getID()] = u,
                this._variables[o] = u
            }
        },
        createDefaultFragmentShaderGraph: function() {
            var t = this.getOrCreateConstant("vec4", "fofd").setValue("vec4(1.0, 0.0, 1.0, 0.7)")
              , e = this.getNode("glFragColor");
            return this.getNode("SetFromNode").inputs(t).outputs(e),
            e
        },
        createFragmentShaderGraph: function() {
            var t = [];
            if (!this._material)
                return t.push(this.createDefaultFragmentShaderGraph()),
                t;
            var e, i = this.getOrCreateStateAttributeUniforms(this._material), n = this.getVertexColor(i.diffuse);
            if (this._lights.length > 0) {
                var r = this.createLighting({
                    materialdiffuse: n
                });
                e = r
            } else
                e = n;
            if (i.emission) {
                var a = this.createVariable("vec3").setValue("vec3(0.0)");
                this.getNode("Add").inputs(e, i.emission).outputs(a),
                e = a
            }
            var s = this.getDiffuseColorFromTextures();
            void 0 !== s && this.getNode("InlineCode").code("%color.rgb *= %texture.rgb;").inputs({
                texture: s
            }).outputs({
                color: e
            });
            var o, u = this.createVariable("float"), l = this.getFirstValidTexture();
            o = l ? "%alpha = %color.a * %texelAlpha.a;" : "%alpha = %color.a;",
            this._isBillboard && (o += "if ( %alpha == 0.0) discard;"),
            this.getNode("InlineCode").code(o).inputs({
                color: i.diffuse,
                texelAlpha: l
            }).outputs({
                alpha: u
            }),
            e = this.getPremultAlpha(e, u);
            var c = this.getNode("glFragColor");
            return this.getNode("SetAlpha").inputs({
                color: e,
                alpha: u
            }).outputs({
                color: c
            }),
            t.push(c),
            t
        },
        getOrCreateFrontTangent: function() {
            var t = this.createVariable("vec4", "frontTangent");
            return this.getNode("FrontNormal").inputs({
                normal: this.getOrCreateVarying("vec4", "vViewTangent")
            }).outputs({
                normal: t
            }),
            t
        },
        getOrCreateFrontNormal: function() {
            var t = this.createVariable("vec3", "frontNormal");
            return this.getNode("FrontNormal").inputs({
                normal: this.getOrCreateVarying("vec3", "vViewNormal")
            }).outputs({
                normal: t
            }),
            t
        },
        getOrCreateNormalizedNormal: function() {
            var t = this._variables.normal;
            if (t)
                return t;
            var e = this.createVariable("vec3", "normal");
            return this.getNode("Normalize").inputs({
                vec: this.getOrCreateFrontNormal()
            }).outputs({
                vec: e
            }),
            e
        },
        getOrCreateNormalizedPosition: function() {
            var t = this._variables.eyeVector;
            if (t)
                return t;
            var e = this.createVariable("vec3")
              , i = this.createVariable("vec3");
            this.getNode("SetFromNode").inputs(this.getOrCreateVarying("vec4", "vViewVertex")).outputs(i),
            this.getNode("Normalize").inputs({
                vec: i
            }).outputs({
                vec: e
            });
            var n = this.createVariable("vec3", "eyeVector");
            return this.getNode("Mult").inputs(e, this.createVariable("float").setValue("-1.0")).outputs(n),
            n
        },
        getPremultAlpha: function(t, e) {
            if (void 0 === e)
                return t;
            var i = this.createVariable("vec4");
            return this.getNode("PreMultAlpha").inputs({
                color: t,
                alpha: e
            }).outputs({
                color: i
            }),
            i
        },
        getColorsRGB: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("LinearTosRGB").inputs({
                color: t
            }).outputs({
                color: e
            }),
            e
        },
        getVertexColor: function(t) {
            if (void 0 !== t) {
                var e = this.getOrCreateVarying("vec4", "vVertexColor")
                  , i = this.getOrCreateUniform("float", "uArrayColorEnabled")
                  , n = this.createVariable("vec4")
                  , r = ["", "%color.rgb = %diffuse.rgb;", "if ( %hasVertexColor == 1.0)", "  %color *= %vertexColor.rgba;"].join("\n");
                return this.getNode("InlineCode").code(r).inputs({
                    diffuse: t,
                    hasVertexColor: i,
                    vertexColor: e
                }).outputs({
                    color: n
                }).comment("diffuse color = diffuse color * vertex color"),
                n
            }
        },
        getDiffuseColorFromTextures: function() {
            for (var t = [], e = this._texturesByName, i = window.Object.keys(e), n = 0; n < i.length; n++) {
                var r = i[n]
                  , a = e[r];
                a.shadow || t.push(this.getTextureByName(r).variable)
            }
            if (t.length > 1) {
                var s = this.createVariable("vec3", "texDiffuseAccum");
                return this.getNode("Mult").inputs(t).outputs(s),
                s
            }
            if (1 === t.length)
                return t[0]
        },
        getFirstValidTexture: function() {
            for (var t = this._textures, e = 0, i = t.length; e < i; ++e) {
                var n = t[e];
                if (n)
                    return this.getTextureByName(n.getName()).variable
            }
        },
        createShadowingLight: function(t, e, i) {
            var n, r, s, o = !1, u = new Array(this._shadowsTextures.length), l = -1, c = t.getLightNumber();
            for (n = 0; n < this._shadows.length; n++)
                if (r = this._shadows[n],
                r.getLightNumber() === c) {
                    l = n;
                    for (var h = 0; h < this._shadowsTextures.length; h++)
                        s = this._shadowsTextures[h],
                        s && s.getLightUnit() === c && (u[h] = s,
                        o = !0)
                }
            if (o) {
                var d = this.getOrCreateVarying("vec3", "vModelVertex")
                  , p = this.createVariable("float")
                  , f = this.getOrCreateStateAttributeUniforms(this._shadows[l], "shadow")
                  , g = a.objectMix(e, f);
                for (n = 0; n < u.length; n++)
                    s = u[n],
                    s && (g = this.createShadowTextureInputVarying(s, g, d, n));
                return this.getNode("ShadowReceive").inputs(e).outputs({
                    "float": p
                }).setShadowAttribute(r),
                this.connectShadowLightNode(t, i, p, g)
            }
        },
        connectShadowLightNode: function(t, e, i) {
            var n = this.createVariable("vec3", "lightAndShadowTempOutput");
            return this.getNode("Mult").inputs(e, i).outputs(n),
            n
        },
        createShadowTextureInputVarying: function(t, e, i, n) {
            var r = "Texture" + n
              , s = this.getOrCreateSampler("sampler2D", r)
              , o = t.getOrCreateUniforms(n)
              , u = o[r];
            delete o[r];
            var l = this.getOrCreateTextureStateAttributeUniforms(t, "shadowTexture", n);
            o[r] = u;
            var c = a.objectMix(e, l);
            c.shadowTexture = s;
            var h = {
                vertexWorld: i,
                lightEyeDir: c.lightEyeDir,
                lightNDL: c.lightNDL
            };
            return c = a.objectMix(c, h)
        },
        createCommonLightingVars: function() {
            return {}
        },
        createLightAndShadowVars: function(t, e, i) {
            var r, a = this._lights[i].getLightType(), s = this.createVariable("bool", "lighted" + i);
            a !== n.SPOT && a !== n.POINT || (r = this.createVariable("vec3", "lightEyePos" + i));
            var o = this.createVariable("vec3", "lightEyeDir" + i)
              , u = this.createVariable("float", "lightNDL" + i);
            return {
                lighted: s,
                lightEyePos: r,
                lightEyeDir: o,
                lightNDL: u
            }
        },
        createLighting: function(t, e) {
            for (var i = this.createVariable("vec3"), n = [], r = e || {
                DIRECTION: "SunLight",
                SPOT: "SpotLight",
                POINT: "PointLight",
                HEMI: "HemiLight"
            }, s = this.getOrCreateStateAttributeUniforms(this._material, "material"), o = this.createCommonLightingVars(t, r), u = 0; u < this._lights.length; u++) {
                var l = this._lights[u]
                  , c = this.createVariable("vec3")
                  , h = r[l.getLightType()]
                  , d = this.getOrCreateStateAttributeUniforms(this._lights[u], "light")
                  , p = this.createLightAndShadowVars(t, r, u)
                  , f = a.objectMix({}, d);
                f = a.objectMix(f, s),
                f = a.objectMix(f, t),
                f = a.objectMix(f, o),
                f = a.objectMix(f, p),
                f.normal || (f.normal = this.getOrCreateNormalizedNormal()),
                f.eyeVector || (f.eyeVector = this.getOrCreateNormalizedPosition()),
                this.getNode(h).inputs(f).outputs({
                    color: c,
                    lightEyePos: f.lightEyePos,
                    lightEyeDir: f.lightEyeDir,
                    ndl: f.lightNDL,
                    lighted: f.lighted
                });
                var g = this.createShadowingLight(l, f, c);
                g ? n.push(g) : n.push(c);
                var m = this.createVariable("vec3", "lightMatAmbientOutput");
                this.getNode("Mult").inputs(f.materialambient, d.lightambient).outputs(m),
                n.push(m)
            }
            return 0 === n.length && n.push(this.createVariable("vec3").setValue("vec3(0.0)")),
            this.getNode("Add").inputs(n).outputs(i),
            i
        },
        createTextureRGBA: function(t, e, i) {
            var n = this.createVariable("vec4");
            return this.getNode("TextureRGBA").inputs({
                sampler: e,
                uv: i
            }).outputs({
                color: n
            }),
            n
        }
    };
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n, r = i(1418), a = i(1419), s = i(1207), o = function() {
        try {
            n = i(220)
        } catch (t) {
            s.warn("You will not be able to use osgUtil.DisplayGraph until you add jQuery in your page")
        }
    }, u = function(t) {
        this.options = t;
        var e = document.createElement("style");
        e.type = "text/css",
        e.innerHTML = [".osgDebugSimpleTooltip {", "display: none;", "position: absolute;", "margin-left: 10px;", "border-radius: 4px;", "padding: 10px;", "background: rgba(0,0,0,.9);", "color: #ffffff;", "}", ".osgDebugSimpleTooltip:before {", "content: ", ";", "position: absolute;", "left: -10px;", "top: 8px;", "border: 10px solid transparent;", "border-width: 10px 10px 10px 0;", "border-right-color: rgba(0,0,0,.9);", "}"].join("\n"),
        document.getElementsByTagName("head")[0].appendChild(e),
        this.el = document.createElement("div"),
        this.el.className = "osgDebugSimpleTooltip",
        document.body.appendChild(this.el);
        for (var i = document.querySelectorAll(this.options.selector), n = 0; n < i.length; n++)
            i[n].addEventListener("mouseover", this.showTooltip.bind(this), !1),
            i[n].addEventListener("mouseout", this.hideTooltip.bind(this), !1)
    };
    u.prototype = {
        showTooltip: function(t) {
            if (n) {
                var e = t.currentTarget;
                this.el.innerHTML = e.getAttribute("title"),
                this.el.style.display = "block",
                this.el.style.left = n(e).position().left + n(e).get(0).getBoundingClientRect().width + "px",
                this.el.style.top = n(e).position().top + "px"
            }
        },
        hideTooltip: function() {
            this.el.style.display = "none"
        }
    };
    var l = function() {
        o(),
        n && (this._selectables = new window.Map,
        this._graphNode = new a(this._selectables),
        this._graphRender = new r(this._selectables),
        this._displayNode = !0,
        this._displayRenderer = !1,
        this._cbSelect = void 0,
        this._focusedElement = "graph",
        this._idToDomElement = new window.Map,
        this._$svg = n("<svg width=100% height=100%></svg>"),
        n("body").append(this._$svg),
        this._css = ".node {text-align: center;cursor: pointer;}.node rect {stroke: #FFF;}.edgePath path {stroke: #FFF;fill: none;}table {text-align: right;}svg {position: absolute;left: 0px;top: 0px;}.osgDebugButton {position: absolute;left: 15px;top: 15px;z-index: 5;border: 0;background: #65a9d7;background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));background: -webkit-linear-gradient(top, #3e779d, #65a9d7);background: -moz-linear-gradient(top, #3e779d, #65a9d7);background: -ms-linear-gradient(top, #3e779d, #65a9d7);background: -o-linear-gradient(top, #3e779d, #65a9d7);padding: 5px 10px;-webkit-border-radius: 7px;-moz-border-radius: 7px;border-radius: 7px;-webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;-moz-box-shadow: rgba(0,0,0,1) 0 1px 0;box-shadow: rgba(0,0,0,1) 0 1px 0;text-shadow: rgba(0,0,0,.4) 0 1px 0;color: white;font-size: 15px;font-family: Helvetica, Arial, Sans-Serif;text-decoration: none;vertical-align: middle;}.osgDebugButton:hover {border-top-color: #28597a;background: #28597a;color: #ccc;}.osgDebugButton:active {border-top-color: #1b435e;background: #1b435e;}.osgDebugSimpleTooltip .osgDebugName {font-weight: bold;color: #60b1fc;margin: 0;}.osgDebugSimpleTooltip .osgDebugDescription {margin: 0;}")
    };
    l.instance = function() {
        return l._instance || (l._instance = new l),
        l._instance
    }
    ,
    l.prototype = {
        getColorFromClassName: a.prototype.getColorFromClassName,
        setCallbackSelect: function(t) {
            this._cbSelect = t
        },
        reset: function() {
            n && (this._selectables.clear(),
            this._$svg.empty(),
            this._focusedElement = "scene",
            n(".osgDebugButton").hide())
        },
        setDisplayGraphRenderer: function(t) {
            this._displayRenderer = t
        },
        createRenderGraph: function(t) {
            this._graphRender.createGraph(t),
            this.displayGraph()
        },
        createGraph: function(t) {
            n && (this.reset(),
            this._displayNode = !!t,
            t && this._graphNode.createGraph(t),
            this._displayRenderer ? i(1420).debugGraph = !0 : this.displayGraph())
        },
        displayGraph: function() {
            if (n) {
                if (window.d3 && window.dagreD3)
                    return void this._createGraphApply();
                var t = "//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js"
                  , e = "//cdn.jsdelivr.net/dagre-d3/0.2.9/dagre-d3.min.js"
                  , i = this._createGraphApply.bind(this);
                n.getScript(t).done(function() {
                    n.getScript(e).done(i)
                })
            }
        },
        _createGraphApply: function() {
            var t = new window.dagreD3.Digraph;
            this._displayNode && this._graphNode.generateNodeAndLink(t),
            this._displayRenderer && this._graphRender.generateNodeAndLink(t),
            this.injectStyleElement(),
            n(".osgDebugButton").show();
            var e = this.renderer = new window.dagreD3.Renderer
              , i = window.d3.select(this._$svg.get(0))
              , r = i.append("g")
              , a = .75
              , s = e.zoom();
            e.zoom(function(t, e) {
                var i = s(t, e);
                return i.scale(a).event(e),
                i
            });
            var o = function(t, e) {
                return '<p class="osgDebugName">' + t + '</p><pre class="osgDebugDescription">' + e + "</pre>"
            }
              , l = this._idToDomElement
              , c = e.drawNodes();
            e.drawNodes(function(t, e) {
                var i = c(t, e);
                return i.attr("title", function(e) {
                    return l.set(e, this),
                    o(e, t.node(e).description || "")
                }),
                i
            }),
            e.run(t, r),
            this.tooltip = new u({
                selector: ".node"
            }),
            n(".node").click(this.onNodeSelect.bind(this)),
            this.focusOnGraph()
        },
        selectNode: function(t) {
            var e = t.getInstanceID()
              , i = this._idToDomElement.get(e);
            i && n(i).click()
        },
        onNodeSelect: function(t) {
            var e = t.currentTarget
              , i = n(e.getAttribute("title"))[0].innerHTML
              , r = this._selectables;
            this.lastNode && (this.lastNode.style.fill = this.lastColor);
            var a = r.get(i);
            a && (this.lastNode = e.childNodes[0],
            this.lastColor = this.lastNode.style.fill,
            e.childNodes[0].style.fill = "#f00",
            window.activeNode = a,
            s.info("window.activeNode is set with the node below !"),
            s.log(window.activeNode),
            s.log("\n"),
            this._cbSelect && this._cbSelect(a))
        },
        focusOnScene: function() {
            n(".osgDebugButton").text("Access to the graph"),
            this._$svg.css("zIndex", "-2"),
            this._focusedElement = "scene"
        },
        focusOnGraph: function() {
            n(".osgDebugButton").text("Access to the scene"),
            this._$svg.css("zIndex", "2"),
            n(".osgDebugSimpleTooltip").css("zIndex", "3"),
            this._focusedElement = "graph"
        },
        injectStyleElement: function() {
            if (!this._cssInjected) {
                this._cssInjected = !0,
                n("body").append('<button class="osgDebugButton">Access to the scene</button>'),
                n(".osgDebugButton").click(function() {
                    "scene" === this._focusedElement ? this.focusOnGraph() : this.focusOnScene()
                }
                .bind(this));
                var t = document.createElement("style");
                t.type = "text/css",
                t.innerHTML = this._css,
                document.getElementsByTagName("head")[0].appendChild(t)
            }
        }
    },
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1419)
      , r = i(1271)
      , a = function(t) {
        this._selectables = t,
        this._nodeList = [],
        this._linkList = [],
        this._renderBinMap = new window.Map,
        this._renderBinStack = [],
        this._generatorID = 0,
        this._refID = 0,
        this._uniqueEdges = new window.Set
    };
    a.prototype = {
        getColorFromClassName: n.prototype.getColorFromClassName,
        createGraph: function(t) {
            this.reset(),
            this.apply(t)
        },
        reset: function() {
            this._renderBinMap.clear(),
            this._renderBinStack.length = 0,
            this._generatorID = 0,
            this._refID++,
            this._nodeList.length = 0,
            this._linkList.length = 0,
            this._uniqueEdges.clear()
        },
        apply: function(t) {
            var e = t.getInstanceID();
            if (this._renderBinMap.has(e) || this._renderBinMap.set(e, t),
            this._renderBinStack.push(t),
            t.getPreRenderStageList)
                for (var i = t.getPreRenderStageList(), n = 0, r = i.length; n < r; ++n)
                    this.apply(i[n].renderStage);
            if (this.registerNode(t),
            t.getPostRenderStageList)
                for (var a = t.getPostRenderStageList(), s = 0, o = a.length; s < o; ++s)
                    this.apply(a[s].renderStage);
            this._renderBinStack.pop()
        },
        registerNode: function(t) {
            var e = t.getInstanceID();
            this._nodeList.push(t);
            for (var i = t._bins, n = window.Object.keys(i), r = 0, a = n.length; r < a; r++) {
                var s = i[n[r]];
                this.apply(s)
            }
            if (t._leafs.length)
                for (var o = 0, u = t._leafs.length; o < u; o++)
                    this.createNodeAndSetID(e, t._leafs[o]);
            for (var l = 0, c = t.stateGraphList.length; l < c; l++) {
                var h = t.stateGraphList[l];
                this.createNodeAndSetID(e, h);
                for (var d = h._instanceID, p = 0, f = h.leafs.length; p < f; p++)
                    this.createNodeAndSetID(d, h.leafs[p])
            }
            if (!(this._renderBinStack.length < 2)) {
                var g = this._renderBinStack[this._renderBinStack.length - 2].getInstanceID();
                this.createLink(g, e)
            }
        },
        createLink: function(t, e) {
            var i = t + "+" + e;
            this._uniqueEdges.has(i) || (this._linkList.push({
                parentNode: t,
                childrenNode: e
            }),
            this._uniqueEdges.add(i))
        },
        createNodeAndSetID: function(t, e) {
            this._nodeList.push(e),
            (void 0 === e._instanceID || e._instanceID < 0 && e._refID !== this._refID) && (e._instanceID = -1 - this._generatorID++,
            e._refID = this._refID),
            this.createLink(t, e._instanceID)
        },
        generateRenderLeaf: function(t, e) {
            var i = e._instanceID
              , n = "RenderLeaf"
              , r = e._geometry && e._geometry.getName() ? "\n" + e._geometry.getName() : "Geometry"
              , a = n + " ( " + e._instanceID + " )";
            a += "\n" + r + " ( " + e._geometry.getInstanceID() + " )",
            this._selectables.set(i.toString(), e),
            t.addNode(i, {
                label: a,
                description: "",
                style: "fill: " + this.getColorFromClassName(n) + ";stroke-width: 0px;"
            })
        },
        generateStateGraph: function(t, e) {
            var i = e._instanceID
              , n = "StateGraph"
              , r = n + " ( " + e._instanceID + " )";
            r += "\n" + e.leafs.length + " leafs",
            this._selectables.set(i.toString(), e),
            t.addNode(i, {
                label: r,
                description: "",
                style: "fill: " + this.getColorFromClassName(n) + ";stroke-width: 0px;"
            })
        },
        generateRenderStage: function(t, e) {
            var i = e.className() + " ( " + e._instanceID + " )";
            e.getName() && (i += "\n" + e.getName()),
            i += "\nViewport ( " + e.getViewport().width() + " x " + e.getViewport().height() + " )",
            this._selectables.set(e.getInstanceID().toString(), e),
            t.addNode(e.getInstanceID(), {
                label: i,
                description: "",
                style: "fill: " + this.getColorFromClassName(e.className()) + ";stroke-width: 0px;"
            })
        },
        generateRenderBin: function(t, e) {
            var i = e.className() + " ( " + e.getInstanceID() + " )";
            e.getName() && (i += "\n" + e.getName());
            var n = "";
            e.getSortMode() === r.SORT_BACK_TO_FRONT && (n = "SortMode: BackToFront");
            var a = "BinNumber: " + e.getBinNumber() + "\n" + n;
            this._selectables.set(e.getInstanceID().toString(), e),
            t.addNode(e.getInstanceID(), {
                label: i,
                description: a,
                style: "fill: " + this.getColorFromClassName(e.className()) + ";stroke-width: 0px;"
            })
        },
        generateNodeAndLink: function(t) {
            for (var e = 0, i = this._nodeList.length; e < i; e++) {
                var n = this._nodeList[e];
                n._geometry && void 0 !== n._depth ? this.generateRenderLeaf(t, n) : void 0 !== n.depth && n.leafs && n.children ? this.generateStateGraph(t, n) : "RenderStage" === n.className() ? this.generateRenderStage(t, n) : this.generateRenderBin(t, n)
            }
            for (var r = 0, a = this._linkList.length; r < a; r++)
                t.addEdge(null, this._linkList[r].parentNode, this._linkList[r].childrenNode)
        }
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1229)
      , a = i(1283)
      , s = function(t) {
        r.call(this, r.TRAVERSE_ALL_CHILDREN),
        this._selectables = t,
        this._nodeList = [],
        this._linkList = [],
        this._uniqueNodes = new window.Set,
        this._uniqueEdges = new window.Set
    };
    s.prototype = n.objectInherit(r.prototype, {
        getColorFromClassName: function(t) {
            switch (t) {
            case "ShadowedScene":
                return "#3D3D3D";
            case "Camera":
                return "#AB7BCF";
            case "RenderBin":
                return "#59778B";
            case "LightSource":
                return "#53967D";
            case "RenderStage":
                return "#DDCC55";
            case "RenderLeaf":
            case "Geometry":
                return "#FFCC55";
            case "RigGeometry":
                return "#DD8800";
            case "MorphGeometry":
                return "#AA5500";
            case "MatrixTransform":
                return "#CE697E";
            case "StateSet":
                return "#0099FF";
            case "StateGraph":
            case "Skeleton":
                return "#96999E";
            case "Bone":
                return "#A9DEAA";
            case "Node":
                return "#FFFFFF";
            default:
                return "#FF00AA"
            }
        },
        createGraph: function(t) {
            this.reset(),
            t.accept(this)
        },
        reset: function() {
            this._nodeList.length = 0,
            this._linkList.length = 0,
            this._uniqueNodes.clear(),
            this._uniqueEdges.clear()
        },
        apply: function(t) {
            if (!t._isNormalDebug) {
                if (this._uniqueNodes.has(t.getInstanceID()) || (this._uniqueNodes.add(t.getInstanceID()),
                this._nodeList.push(t)),
                this.nodePath.length >= 2) {
                    var e = this.nodePath[this.nodePath.length - 2].getInstanceID()
                      , i = t.getInstanceID()
                      , n = e + "+" + i;
                    this._uniqueEdges.has(n) || (this._linkList.push({
                        parentNode: e,
                        childrenNode: i
                    }),
                    this._uniqueEdges.add(n))
                }
                this.traverse(t)
            }
        },
        createMatrixGrid: function(t, e) {
            var i = "";
            return i += "<table><tr><td>" + e[0] + "</td>",
            i += "<td>" + e[4] + "</td>",
            i += "<td>" + e[8] + "</td>",
            i += "<td>" + e[12] + "</td></tr>",
            i += "<tr><td>" + e[1] + "</td>",
            i += "<td>" + e[5] + "</td>",
            i += "<td>" + e[9] + "</td>",
            i += "<td>" + e[13] + "</td></tr>",
            i += "<tr><td>" + e[2] + "</td>",
            i += "<td>" + e[6] + "</td>",
            i += "<td>" + e[10] + "</td>",
            i += "<td>" + e[14] + "</td></tr>",
            i += "<tr><td>" + e[3] + "</td>",
            i += "<td>" + e[7] + "</td>",
            i += "<td>" + e[11] + "</td>",
            i += "<td>" + e[15] + "</td></tr></table>"
        },
        getLabel: function(t) {
            var e = t.className() + " (" + t.getInstanceID() + ")";
            return t.getName && t.getName() && (e += "\n" + t.getName()),
            e
        },
        generateNode: function(t, e) {
            var i = "";
            e.getMatrix && e.getMatrix() && (i += "<br /><br />" + this.createMatrixGrid(e, e.getMatrix())),
            this._selectables.set(e.getInstanceID().toString(), e),
            t.addNode(e.getInstanceID(), {
                label: this.getLabel(e),
                description: i,
                style: "fill: " + this.getColorFromClassName(e.className()) + ";stroke-width: 0px;"
            })
        },
        generateStateSet: function(t, e) {
            var i = e.getStateSet()
              , n = i.getInstanceID()
              , r = this.getLabel(i);
            r += "\nNbTexture : " + i.getNumTextureAttributeLists(),
            t.hasNode(n) || (this._selectables.set(n.toString(), i),
            t.addNode(n, {
                label: r,
                style: "fill: " + this.getColorFromClassName(i.className()) + ";stroke-width: 0px;"
            })),
            t.addEdge(null, e.getInstanceID(), n, {
                style: "stroke: " + this.getColorFromClassName(i.className()) + ";"
            })
        },
        generateSourceGeometry: function(t, e) {
            var i = e.getSourceGeometry()
              , n = i.getInstanceID();
            this._selectables.set(n.toString(), i),
            t.addNode(n, {
                label: this.getLabel(i),
                style: "fill: " + this.getColorFromClassName(i.className()) + ";stroke-width: 0px;"
            }),
            t.addEdge(null, e.getInstanceID(), n, {
                style: "stroke: " + this.getColorFromClassName(i.className()) + ";"
            })
        },
        generateNodeAndLink: function(t) {
            for (var e = 0, i = this._nodeList.length; e < i; e++) {
                var n = this._nodeList[e];
                this.generateNode(t, n),
                n.getStateSet() && this.generateStateSet(t, n),
                n.getSourceGeometry && n.getSourceGeometry()instanceof a && this.generateSourceGeometry(t, n)
            }
            for (var r = 0, s = this._linkList.length; r < s; r++)
                t.addEdge(null, this._linkList[r].parentNode, this._linkList[r].childrenNode)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1261)
      , a = i(1268)
      , s = i(1210)
      , o = i(1272)
      , u = i(1314)
      , l = i(1205)
      , c = i(1212).vec4
      , h = i(1377)
      , d = i(1417)
      , p = function(t) {
        s.call(this),
        this._state = void 0,
        this._camera = t,
        this._renderStage = void 0,
        this._stateGraph = void 0,
        this._frameStamp = void 0,
        this._previousCullsettings = new r,
        this.setDefaults()
    };
    p.debugGraph = !1,
    p.prototype = n.objectLibraryClass(n.objectInherit(s.prototype, {
        setDefaults: function() {
            this._state = new u(new h.ShaderGeneratorProxy),
            this._cullVisitor = new a,
            this._cullVisitor.setRenderer(this),
            this._stateGraph = new l,
            this.getCamera().setClearColor(c.create()),
            this.setRenderStage(new o);
            var t = i(1201)
              , e = this.getCamera().getOrCreateStateSet();
            e.setAttributeAndModes(new t.Material),
            e.setAttributeAndModes(new t.Depth),
            e.setAttributeAndModes(new t.BlendFunc),
            e.setAttributeAndModes(new t.CullFace)
        },
        getCullVisitor: function() {
            return this._cullVisitor
        },
        setCullVisitor: function(t) {
            t && !t.getRenderer() && t.setRenderer(this),
            this._cullVisitor = t
        },
        setRenderStage: function(t) {
            this._renderStage = t
        },
        getCamera: function() {
            return this._camera
        },
        setFrameStamp: function(t) {
            this._frameStamp = t
        },
        getFrameStamp: function() {
            return this._frameStamp
        },
        getState: function() {
            return this._state
        },
        setState: function(t) {
            this._state = t
        },
        setGraphicContext: function(t) {
            this._state.setGraphicContext(t)
        },
        getGraphicContext: function() {
            return this._state.getGraphicContext()
        },
        cullAndDraw: function() {
            this.cull(),
            this.draw()
        },
        cull: function() {
            var t = this.getCamera()
              , e = t.getView();
            this._cullVisitor.setFrameStamp(this._frameStamp),
            this._cullVisitor.resetStats(),
            this._stateGraph.clean(),
            this._renderStage.reset(),
            this._cullVisitor.reset(),
            this._cullVisitor.setStateGraph(this._stateGraph),
            this._cullVisitor.setRenderStage(this._renderStage),
            this._cullVisitor.pushStateSet(t.getStateSet()),
            this._previousCullsettings.reset(),
            this._previousCullsettings.setCullSettings(this._cullVisitor),
            this._cullVisitor.setCullSettings(t),
            this._previousCullsettings.getSettingSourceOverrider() === this._cullVisitor && this._previousCullsettings.getEnableFrustumCulling() && this._cullVisitor.setEnableFrustumCulling(!0),
            this._cullVisitor.pushCameraModelViewProjectionMatrix(t, t.getViewMatrix(), t.getProjectionMatrix()),
            t.getBound();
            var n = e.getLight()
              , r = i(1421);
            if (n)
                switch (e.getLightingMode()) {
                case r.LightingMode.HEADLIGHT:
                    this._cullVisitor.addPositionedAttribute(null, n);
                    break;
                case r.LightingMode.SKY_LIGHT:
                    this._cullVisitor.addPositionedAttribute(t.getViewMatrix(), n)
                }
            this._cullVisitor.pushViewport(t.getViewport()),
            this._renderStage.setClearDepth(t.getClearDepth()),
            this._renderStage.setClearColor(t.getClearColor()),
            this._renderStage.setClearMask(t.getClearMask()),
            this._renderStage.setViewport(t.getViewport()),
            this._cullVisitor.setDatabaseRequestHandler(this._camera.getView().getDatabasePager()),
            this._cullVisitor.handleCullCallbacksAndTraverse(t),
            this._cullVisitor.popCameraModelViewProjectionMatrix(t),
            this._cullVisitor.setCullSettings(this._previousCullsettings),
            this._cullVisitor.popViewport(),
            this._cullVisitor.popStateSet(),
            this._renderStage.sort()
        },
        draw: function() {
            var t = this.getState();
            t.resetCacheFrame(),
            t.resetStats(),
            this._renderStage.setCamera(this._camera),
            this._renderStage.draw(t),
            p.debugGraph && (d.instance().createRenderGraph(this._renderStage),
            p.debugGraph = !1),
            this._renderStage.setCamera(void 0),
            t.applyDefault()
        }
    }), "osgViewer", "Renderer"),
    t.exports = p
}
, function(t, e, i) {
    "use strict";
    var n = i(1243)
      , r = i(1260)
      , a = i(1292)
      , s = i(1273)
      , o = i(1301)
      , u = i(1212).mat4
      , l = i(1237)
      , c = i(1306)
      , h = i(1311)
      , d = i(1212).vec3
      , p = i(1321)
      , f = i(1235)
      , g = i(1357)
      , m = i(1358)
      , v = i(1420)
      , _ = i(1422)
      , b = i(1417)
      , x = i(1207)
      , A = function() {
        this._camera = new r,
        this._scene = new _,
        this._frameStamp = new a,
        this._lightingMode = void 0,
        this._manipulator = void 0,
        this._canvasWidth = 0,
        this._canvasHeight = 0,
        this._requestContinousUpdate = !0,
        this._requestRedraw = !0,
        this.setLightingMode(A.LightingMode.HEADLIGHT);
        var t = this.createRenderer(this.getCamera());
        t.setFrameStamp(this._frameStamp),
        this.getCamera().setRenderer(t),
        this.getCamera().setView(this)
    };
    A.LightingMode = {
        NO_LIGHT: 0,
        HEADLIGHT: 1,
        SKY_LIGHT: 2
    },
    A.prototype = {
        requestRedraw: function() {
            this._requestRedraw = !0
        },
        requestContinuousUpdate: function(t) {
            this._requestContinousUpdate = t
        },
        createRenderer: function(t) {
            var e = new v(t);
            return e
        },
        setGraphicContext: function(t) {
            this.getCamera().getRenderer().getState().setGraphicContext(t)
        },
        getGraphicContext: function() {
            return this.getCamera().getRenderer().getState().getGraphicContext()
        },
        initWebGLCaps: function(t) {
            f.instance(t)
        },
        computeCanvasSize: function() {
            return function(t) {
                var e, i;
                e = t.clientWidth,
                i = t.clientHeight,
                e < 1 && (e = 1),
                i < 1 && (i = 1);
                var n = this._devicePixelRatio
                  , r = Math.floor(e * n)
                  , a = Math.floor(i * n)
                  , s = !1;
                return this._canvasWidth !== r && (t.width = r,
                this._canvasWidth = r,
                s = !0),
                this._canvasHeight !== a && (t.height = a,
                this._canvasHeight = a,
                s = !0),
                s
            }
        }(),
        getCanvasWidth: function() {
            return this._canvasWidth
        },
        getCanvasHeight: function() {
            return this._canvasHeight
        },
        getCanvasClientWidth: function() {
            return Math.ceil(this._canvasWidth / this._devicePixelRatio)
        },
        getCanvasClientHeight: function() {
            return Math.ceil(this._canvasHeight / this._devicePixelRatio)
        },
        getCanvasPixelRatio: function() {
            return this._devicePixelRatio
        },
        setUpView: function(t, e) {
            var i = window.devicePixelRatio || 1
              , n = e.getNumber("overrideDevicePixelRatio")
              , r = e.getNumber("maxDevicePixelRatio") || -1;
            "number" == typeof n ? i = n : r !== -1 && (i = Math.min(i, r)),
            this._devicePixelRatio = i,
            this.computeCanvasSize(t);
            var a = t.width
              , s = t.height
              , o = a / s;
            if (this._camera.setViewport(new p(0,0,a,s)),
            this._camera.setGraphicContext(this.getGraphicContext()),
            u.lookAt(this._camera.getViewMatrix(), d.fromValues(0, 0, -10), d.create(), d.fromValues(0, 1, 0)),
            u.perspective(this._camera.getProjectionMatrix(), Math.PI / 180 * 55, o, 1, 1e3),
            e && e.enableFrustumCulling && this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),
            e && e.debugGraph) {
                var l = this.getCamera();
                b.instance().refreshGraph = function() {
                    var t = b.instance();
                    t.setDisplayGraphRenderer(!0),
                    t.createGraph(l)
                }
                ,
                x.log("to refresh the graphs type in the console:\nOSG.osgUtil.DisplayGraph.instance().refreshGraph()")
            }
        },
        computeIntersections: function(t, e, i) {
            return void 0 === i && (i = -1),
            this._lsi ? this._lsi.reset() : this._lsi = new m,
            this._origIntersect || (this._origIntersect = d.create(),
            this._dstIntersect = d.create()),
            this._lsi.set(d.set(this._origIntersect, t, e, 0), d.set(this._dstIntersect, t, e, 1)),
            this._iv ? this._iv.reset() : (this._iv = new g,
            this._iv.setIntersector(this._lsi)),
            this._iv.setTraversalMask(i),
            this._camera.accept(this._iv),
            this._lsi.getIntersections()
        },
        setFrameStamp: function(t) {
            this._frameStamp = t
        },
        getFrameStamp: function() {
            return this._frameStamp
        },
        setCamera: function(t) {
            this._camera = t
        },
        getCamera: function() {
            return this._camera
        },
        setSceneData: function(t) {
            t !== this._scene.getSceneData() && (this._scene.setSceneData(t),
            this._camera.removeChildren(),
            this._camera.addChild(t))
        },
        getSceneData: function() {
            return this._scene.getSceneData()
        },
        setDatabasePager: function(t) {
            this._scene.setDatabasePager(t)
        },
        getDatabasePager: function() {
            return this._scene.getDatabasePager()
        },
        getScene: function() {
            return this._scene
        },
        getManipulator: function() {
            return this._manipulator
        },
        setManipulator: function(t) {
            this._manipulator = t
        },
        getLight: function() {
            return this._light
        },
        setLight: function(t) {
            this._light = t,
            this._lightingMode !== A.LightingMode.NO_LIGHT && this._scene.getOrCreateStateSet().setAttributeAndModes(this._light)
        },
        getLightingMode: function() {
            return this._lightingMode
        },
        setLightingMode: function(t) {
            this._lightingMode !== t && (this._lightingMode = t,
            this._lightingMode !== A.LightingMode.NO_LIGHT ? this._light || (this._light = new o) : this._light = void 0)
        },
        flushDeletedGLObjects: function(t) {
            var e = this.getGraphicContext();
            t = n.flushDeletedGLBufferArrays(e, t),
            t = l.getTextureManager(e).flushDeletedTextureObjects(e, t),
            t = c.flushDeletedGLPrograms(e, t),
            t = h.flushDeletedGLShaders(e, t),
            t = s.flushDeletedGLFrameBuffers(e, t),
            t = s.flushDeletedGLRenderBuffers(e, t)
        },
        flushAllDeletedGLObjects: function() {
            var t = this.getGraphicContext();
            n.flushAllDeletedGLBufferArrays(t),
            l.getTextureManager(t).flushAllDeletedTextureObjects(t),
            c.flushAllDeletedGLPrograms(t),
            h.flushAllDeletedGLShaders(t),
            s.flushAllDeletedGLFrameBuffers(t),
            s.flushAllDeletedGLRenderBuffers(t)
        }
    },
    t.exports = A
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1210)
      , a = i(1340)
      , s = function() {
        r.call(this),
        this._databasePager = new a,
        this._sceneData = void 0
    };
    s.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getSceneData: function() {
            return this._sceneData
        },
        setSceneData: function(t) {
            this._sceneData = t
        },
        setDatabasePager: function(t) {
            this._databasePager = t
        },
        getDatabasePager: function() {
            return this._databasePager
        },
        updateSceneGraph: function(t) {
            this._databasePager && this._databasePager.updateSceneGraph(t.getFrameStamp()),
            this._sceneData && this._sceneData.accept(t)
        }
    }), "osgViewer", "Scene"),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1209)
      , r = i(1247)
      , a = i(1207)
      , s = i(1290)
      , o = i(1242)
      , u = i(1263)
      , l = i(1238)
      , c = i(1212).vec2
      , h = i(1212).vec3
      , d = i(1212).vec4
      , p = i(1212).mat4
      , f = i(1212).quat
      , g = i(1357)
      , m = i(1358)
      , v = i(1424)
      , _ = i(1232)
      , b = i(1203)
      , x = function(t, e) {
        t[0] = void 0 === e.offsetX ? e.layerX : e.offsetX,
        t[1] = void 0 === e.offsetY ? e.layerY : e.offsetY
    }
      , A = function() {};
    A.prototype = {
        cull: function() {
            return !1
        }
    };
    var y = new o(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA)
      , S = function(t) {
        this._testPlane = t,
        this._inter = h.create(),
        m.call(this)
    };
    S.prototype = b.objectInherit(m.prototype, {
        setTestPlane: function(t) {
            this._testPlane = t
        },
        getTranslateDistance: function() {
            return this._inter
        },
        enter: function() {
            var t = h.create()
              , e = h.create();
            return function(i) {
                if (void 0 === i._nbAxis)
                    return !0;
                if (h.init(t),
                t[i._nbAxis] = 1,
                this._testPlane) {
                    var n = h.dot(this._iStart, t)
                      , r = h.dot(this._iEnd, t);
                    if (n === r)
                        return !1;
                    var a = -n / (r - n);
                    this._inter[0] = this._iStart[0] + (this._iEnd[0] - this._iStart[0]) * a,
                    this._inter[1] = this._iStart[1] + (this._iEnd[1] - this._iStart[1]) * a,
                    this._inter[2] = this._iStart[2] + (this._iEnd[2] - this._iStart[2]) * a
                } else {
                    h.normalize(e, h.sub(e, this._iEnd, this._iStart));
                    var s = -h.dot(e, t)
                      , o = h.dot(this._iStart, e)
                      , u = Math.abs(1 - s * s)
                      , l = -h.dot(this._iStart, t);
                    h.init(this._inter),
                    this._inter[i._nbAxis] = (s * o - l) / u
                }
                return !1
            }
        }(),
        intersect: function() {
            return !1
        }
    });
    var C = function(t) {
        r.call(this),
        this._tmask = 1,
        this._autoInsertMT = !1,
        this._viewer = t,
        this._canvas = t.getGraphicContext().canvas,
        this._manipulator = t.getManipulator(),
        this._rotateNode = new r,
        this._translateNode = new r,
        this._planeNode = new r,
        this._rotateInLocal = !0,
        this._translateInLocal = !0,
        this._showAngle = new r,
        this._downCanvasCoord = c.create(),
        this._hoverNode = null,
        this._keepHoverColor = d.create(),
        this._isEditing = !1,
        this._editLineOrigin = h.create(),
        this._editLineDirection = h.create(),
        this._editOffset = h.create(),
        this._editLocal = p.create(),
        this._editWorldTrans = p.create(),
        this._editWorldScaleRot = p.create(),
        this._editInvWorldScaleRot = p.create(),
        this._debugNode = new n,
        this._lastDistToEye = 0,
        this._attachedNode = null,
        this.attachToGeometry(null),
        this._lsi = new S,
        this._origIntersect = h.create(),
        this._dstIntersect = h.create(),
        this._iv = new g,
        this._iv.setIntersector(this._lsi),
        this.init()
    };
    C.NO_PICK = 1,
    C.PICK_ARC_X = 2,
    C.PICK_ARC_Y = 4,
    C.PICK_ARC_Z = 8,
    C.PICK_ARROW_X = 16,
    C.PICK_ARROW_Y = 32,
    C.PICK_ARROW_Z = 64,
    C.PICK_PLANE_X = 128,
    C.PICK_PLANE_Y = 256,
    C.PICK_PLANE_Z = 512,
    C.NO_FULL_CIRCLE = 1024,
    C.PICK_ARC = C.PICK_ARC_X | C.PICK_ARC_Y | C.PICK_ARC_Z,
    C.PICK_ARROW = C.PICK_ARROW_X | C.PICK_ARROW_Y | C.PICK_ARROW_Z,
    C.PICK_PLANE = C.PICK_PLANE_X | C.PICK_PLANE_Y | C.PICK_PLANE_Z,
    C.PICK_GIZMO = C.PICK_ARC | C.PICK_ARROW | C.PICK_PLANE,
    C.prototype = b.objectInherit(r.prototype, {
        setRotateInLocal: function(t) {
            this._rotateInLocal = t
        },
        setTranslateInLocal: function(t) {
            this._translateInLocal = t
        },
        setTraversalMask: function(t) {
            this._tmask = t
        },
        init: function() {
            this.getOrCreateStateSet().setAttributeAndModes(new s(s.DISABLE)),
            this.getOrCreateStateSet().setAttributeAndModes(new u(u.DISABLE));
            var t = function() {};
            t.prototype = {
                update: this.updateGizmo.bind(this)
            },
            this.addUpdateCallback(new t),
            this.addChild(this.initNodeTranslate()),
            this.addChild(this.initNodeTranslatePlane()),
            this.addChild(this.initNodeRotate()),
            this._debugNode && (this._debugNode.addChild(v.createDebugLineGeometry()),
            this.addChild(this._debugNode),
            this._debugNode.setNodeMask(0));
            var e = this._canvas;
            e.addEventListener("mousemove", this.onMouseMove.bind(this)),
            e.addEventListener("mousedown", this.onMouseDown.bind(this)),
            e.addEventListener("mouseup", this.onMouseUp.bind(this)),
            e.addEventListener("mouseout", this.onMouseUp.bind(this))
        },
        attachToNodePath: function(t) {
            var e;
            if (t)
                for (var i = t.length - 1; i >= 0; --i) {
                    var n = t[i].editMask || 0;
                    if (n & C.PICK_GIZMO) {
                        e = t[i];
                        break
                    }
                }
            return e ? (this._attachedNode = e,
            void this.updateGizmoMask()) : (this._attachedNode = null,
            void this.setNodeMask(0))
        },
        attachToMatrixTransform: function(t) {
            return t ? (void 0 === t.editMask && (t.editMask = C.PICK_GIZMO),
            this._attachedNode = t,
            void this.updateGizmoMask()) : (this._attachedNode = null,
            void this.setNodeMask(0))
        },
        attachToGeometry: function(t) {
            var e = t;
            if (!e)
                return this._attachedNode = null,
                void this.setNodeMask(0);
            var i = e.getParents();
            if (void 0 === i[0].editMask) {
                for (var n = new r; i.length > 0; )
                    i[0].addChild(n),
                    i[0].removeChild(e);
                n.addChild(e),
                n.editMask = C.PICK_GIZMO,
                e = n
            } else
                e = i[0];
            this._attachedNode = e,
            this.updateGizmoMask()
        },
        updateGizmoMask: function() {
            if (!this._attachedNode)
                return void this.setNodeMask(0);
            var t = this._attachedNode.editMask;
            this.setNodeMask(t & C.PICK_GIZMO ? C.NO_PICK : 0),
            this._translateNode.setNodeMask(t & C.PICK_ARROW ? C.PICK_ARROW : 0),
            this._rotateNode.setNodeMask(t & C.PICK_ARC ? C.PICK_ARC : 0),
            this._planeNode.setNodeMask(t & C.PICK_PLANE ? C.PICK_PLANE : 0);
            var e = this._translateNode.getChildren();
            e[0].setNodeMask(t & C.PICK_ARROW_X ? C.PICK_ARROW_X : 0),
            e[1].setNodeMask(t & C.PICK_ARROW_Y ? C.PICK_ARROW_Y : 0),
            e[2].setNodeMask(t & C.PICK_ARROW_Z ? C.PICK_ARROW_Z : 0);
            var i = this._rotateNode.getChildren();
            i[0].setNodeMask(t & C.NO_FULL_CIRCLE ? 0 : C.NO_PICK),
            i[1].setNodeMask(t & C.PICK_ARC_X ? C.PICK_ARC_X : 0),
            i[2].setNodeMask(t & C.PICK_ARC_Y ? C.PICK_ARC_Y : 0),
            i[3].setNodeMask(t & C.PICK_ARC_Z ? C.PICK_ARC_Z : 0);
            var n = this._planeNode.getChildren();
            n[0].setNodeMask(t & C.PICK_PLANE_X ? C.PICK_PLANE_X : 0),
            n[1].setNodeMask(t & C.PICK_PLANE_Y ? C.PICK_PLANE_Y : 0),
            n[2].setNodeMask(t & C.PICK_PLANE_Z ? C.PICK_PLANE_Z : 0)
        },
        onNodeHovered: function() {
            var t = d.fromValues(1, 1, 0, 1);
            return function(e) {
                if (this._hoverNode && this._hoverNode.getStateSet().getUniform("uColor").setFloat4(this._keepHoverColor),
                !e)
                    return void (this._hoverNode = null);
                for (var i = e.nodepath, n = i.length - 1, r = i[n]; void 0 === r._nbAxis; ) {
                    if (0 === n)
                        return;
                    r = i[--n]
                }
                var a = r.getStateSet().getUniform("uColor");
                this._hoverNode = r,
                d.copy(this._keepHoverColor, a.getInternalArray()),
                a.setFloat4(t)
            }
        }(),
        initNodeRotate: function() {
            var t = v.createTorusGeometry(1, .01, 6, 64, 2 * Math.PI)
              , e = v.createTorusGeometry(1, .01, 6, 64, Math.PI)
              , i = v.createTorusGeometry(1, .1, 6, 64, Math.PI)
              , a = new r
              , s = new r
              , o = new r
              , u = new r;
            s._nbAxis = 0,
            o._nbAxis = 1,
            u._nbAxis = 2;
            var c = new n;
            c.setCullCallback(new A),
            c.addChild(i),
            t.setNodeMask(C.NO_PICK),
            e.setNodeMask(C.NO_PICK),
            s.setNodeMask(C.PICK_ARC_X),
            o.setNodeMask(C.PICK_ARC_Y),
            u.setNodeMask(C.PICK_ARC_Z),
            a.addChild(t),
            s.addChild(e),
            o.addChild(e),
            u.addChild(e),
            s.addChild(c),
            o.addChild(c),
            u.addChild(c),
            a.getOrCreateStateSet().addUniform(l.createFloat4(d.fromValues(.2, .2, .2, 1), "uColor")),
            s.getOrCreateStateSet().addUniform(l.createFloat4(d.fromValues(1, 0, 0, 1), "uColor")),
            o.getOrCreateStateSet().addUniform(l.createFloat4(d.fromValues(0, 1, 0, 1), "uColor")),
            u.getOrCreateStateSet().addUniform(l.createFloat4(d.fromValues(0, 0, 1, 1), "uColor"));
            var p = this._showAngle;
            p.getOrCreateStateSet().setAttributeAndModes(y),
            p.setNodeMask(0),
            p.getOrCreateStateSet().addUniform(l.createFloat3(h.fromValues(1, 0, 0), "uBase")),
            p.getOrCreateStateSet().addUniform(l.createFloat(0, "uAngle")),
            p.addChild(v.createQuadCircleGeometry());
            var f = this._rotateNode;
            return f.setNodeMask(C.PICK_ARC),
            f.addChild(a),
            f.addChild(s),
            f.addChild(o),
            f.addChild(u),
            f.addChild(p),
            f
        },
        initNodeTranslate: function() {
            var t = 1.5
              , e = .3
              , i = .5
              , a = 1.1 * (t - i + e)
              , s = new r;
            p.fromTranslation(s.getMatrix(), h.fromValues(0, 0, t + .5 * e)),
            s.addChild(v.createCylinderGeometry(0, .07, e, 32, 1, !0, !0));
            var o = new r;
            p.fromTranslation(o.getMatrix(), h.fromValues(0, 0, .5 * t)),
            o.addChild(v.createCylinderGeometry(.01, .01, t, 32, 1, !0, !0));
            var u = new n;
            u.addChild(o),
            u.addChild(s);
            var c = v.createCylinderGeometry(.1, .1, a, 32, 1, !0, !0)
              , f = new r
              , g = new r
              , m = new r;
            f._nbAxis = 0,
            g._nbAxis = 1,
            m._nbAxis = 2,
            p.fromRotation(f.getMatrix(), .5 * Math.PI, h.fromValues(0, 1, 0)),
            p.fromRotation(g.getMatrix(), .5 * -Math.PI, h.fromValues(1, 0, 0));
            var _ = new r;
            _.setCullCallback(new A),
            p.fromTranslation(_.getMatrix(), h.fromValues(0, 0, i + .5 * a)),
            _.addChild(c),
            u.setNodeMask(C.NO_PICK),
            f.setNodeMask(C.PICK_ARROW_X),
            g.setNodeMask(C.PICK_ARROW_Y),
            m.setNodeMask(C.PICK_ARROW_Z),
            f.addChild(u),
            g.addChild(u),
            m.addChild(u),
            f.addChild(_),
            g.addChild(_),
            m.addChild(_),
            f.getOrCreateStateSet().addUniform(l.createFloat4(d.fromValues(1, 0, 0, 1), "uColor")),
            g.getOrCreateStateSet().addUniform(l.createFloat4(d.fromValues(0, 1, 0, 1), "uColor")),
            m.getOrCreateStateSet().addUniform(l.createFloat4(d.fromValues(0, 0, 1, 1), "uColor"));
            var b = this._translateNode;
            return b.setNodeMask(C.PICK_ARROW),
            b.addChild(f),
            b.addChild(g),
            b.addChild(m),
            b
        },
        initNodeTranslatePlane: function() {
            var t = new r;
            p.fromTranslation(t.getMatrix(), h.fromValues(.5, .5, 0)),
            p.mul(t.getMatrix(), p.fromScaling(p.create(), h.fromValues(.5, .5, 1)), t.getMatrix()),
            t.addChild(v.createPlaneGeometry());
            var e = new r
              , i = new r
              , n = new r;
            e._nbAxis = 0,
            i._nbAxis = 1,
            n._nbAxis = 2,
            p.fromRotation(e.getMatrix(), .5 * -Math.PI, h.fromValues(0, 1, 0)),
            p.fromRotation(i.getMatrix(), .5 * Math.PI, h.fromValues(1, 0, 0)),
            e.setNodeMask(C.PICK_PLANE_X),
            i.setNodeMask(C.PICK_PLANE_Y),
            n.setNodeMask(C.PICK_PLANE_Z),
            e.addChild(t),
            i.addChild(t),
            n.addChild(t),
            e.getOrCreateStateSet().addUniform(l.createFloat4(d.fromValues(1, 0, 0, .3), "uColor")),
            i.getOrCreateStateSet().addUniform(l.createFloat4(d.fromValues(0, 1, 0, .3), "uColor")),
            n.getOrCreateStateSet().addUniform(l.createFloat4(d.fromValues(0, 0, 1, .3), "uColor"));
            var a = this._planeNode;
            return a.setNodeMask(C.PICK_PLANE),
            a.getOrCreateStateSet().setAttributeAndModes(y),
            a.addChild(e),
            a.addChild(i),
            a.addChild(n),
            a
        },
        updateArcRotation: function() {
            var t = f.create()
              , e = f.setAxisAngle(f.create(), [0, 1, 0], .5 * -Math.PI)
              , i = f.setAxisAngle(f.create(), [1, 0, 0], .5 * -Math.PI);
            return function(n) {
                var r = this._rotateNode
                  , a = r.getChildren();
                t[0] = -n[1],
                t[1] = n[0],
                t[2] = 0,
                t[3] = 1 + n[2],
                f.normalize(t, t),
                p.fromQuat(a[0].getMatrix(), t),
                f.setAxisAngle(t, [1, 0, 0], Math.atan2(n[2], n[1])),
                f.mul(t, t, e),
                p.fromQuat(a[1].getMatrix(), t),
                f.setAxisAngle(t, [0, 1, 0], Math.atan2(-n[0], -n[2])),
                f.mul(t, t, i),
                p.fromQuat(a[2].getMatrix(), t),
                f.setAxisAngle(t, [0, 0, 1], Math.atan2(-n[0], n[1])),
                p.fromQuat(a[3].getMatrix(), t),
                a[1].dirtyBound(),
                a[2].dirtyBound(),
                a[3].dirtyBound()
            }
        }(),
        getTransformType: function(t) {
            for (var e = t; e.getParents().length > 0; ) {
                if (void 0 !== e.referenceFrame && e.referenceFrame === _.ABSOLUTE_RF)
                    return _.ABSOLUTE_RF;
                e = e.getParents()[0]
            }
            return _.RELATIVE_RF
        },
        updateGizmo: function() {
            var t = h.create()
              , e = h.create()
              , i = h.create()
              , n = p.create()
              , r = p.create()
              , a = p.create()
              , s = p.create();
            return function() {
                if (this._attachedNode) {
                    var o = this.getTransformType(this._attachedNode);
                    this.setReferenceFrame(o),
                    this.setCullingActive(o === _.RELATIVE_RF);
                    var u = this._attachedNode.getWorldMatrices()[0];
                    p.getTranslation(e, u),
                    p.fromTranslation(r, e);
                    var l = 3;
                    if (o === _.ABSOLUTE_RF)
                        t[0] = t[1] = t[2] = 0,
                        i[0] = i[1] = i[2] = 1;
                    else {
                        var c = this._viewer.getCamera().getProjectionMatrix()
                          , d = .023 * this._canvas.clientWidth * c[0];
                        this._manipulator.getEyePosition(t),
                        this._lastDistToEye = this._isEditing ? this._lastDistToEye : h.distance(e, t),
                        l *= this._lastDistToEye / d
                    }
                    p.fromScaling(s, [l, l, l]),
                    p.mul(this.getMatrix(), r, s),
                    h.sub(t, t, e),
                    h.normalize(t, t),
                    this._rotateInLocal || this._translateInLocal ? (p.getScale(i, u),
                    p.fromScaling(a, i),
                    p.invert(a, a),
                    p.mul(n, u, a),
                    n[12] = n[13] = n[14] = 0,
                    this._translateInLocal && (p.copy(this._translateNode.getMatrix(), n),
                    p.copy(this._planeNode.getMatrix(), n)),
                    this._rotateInLocal && (p.copy(this._rotateNode.getMatrix(), n),
                    p.invert(n, n),
                    h.transformMat4(t, t, n))) : p.identity(this._rotateNode.getMatrix()),
                    this.updateArcRotation(t),
                    this._rotateNode.dirtyBound(),
                    this._translateNode.dirtyBound(),
                    this._planeNode.dirtyBound(),
                    this._isEditing && p.copy(this._showAngle.getMatrix(), this._hoverNode.getMatrix())
                }
            }
        }(),
        computeNearestIntersection: function() {
            var t = function(t, e) {
                return t.ratio - e.ratio
            }
              , e = c.create();
            return function(i, n) {
                x(e, i);
                var r = this._viewer
                  , a = this._canvas
                  , s = e[0] * (r._canvasWidth / a.clientWidth)
                  , o = (a.clientHeight - e[1]) * (r._canvasHeight / a.clientHeight)
                  , u = this._viewer.computeIntersections(s, o, n);
                if (0 !== u.length)
                    return u.sort(t),
                    u[0]
            }
        }(),
        setOnlyGizmoPicking: function() {
            this._viewer.getCamera().addChild(this),
            this._viewer.getSceneData().setNodeMask(0),
            this.setNodeMask(-1)
        },
        setOnlyScenePicking: function() {
            this._viewer.getCamera().removeChild(this),
            this._viewer.getSceneData().setNodeMask(-1),
            this.setNodeMask(C.NO_PICK)
        },
        pickGizmo: function(t, e) {
            this.setOnlyGizmoPicking();
            var i = this.computeNearestIntersection(t, e);
            return this.setOnlyScenePicking(),
            i
        },
        getCanvasPositionFromWorldPoint: function() {
            var t = p.create();
            return function(e, i) {
                var n = this._viewer.getCamera()
                  , r = i;
                i || (a.warn("deprecated, use out argument for result "),
                r = h.create()),
                n.getViewport() ? n.getViewport().computeWindowMatrix(t) : p.identity(t),
                p.mul(t, t, n.getProjectionMatrix()),
                this.getReferenceFrame() === _.RELATIVE_RF && p.mul(t, t, n.getViewMatrix()),
                h.transformMat4(r, e, t);
                var s = this._viewer
                  , o = this._canvas;
                return r[0] = r[0] / (s._canvasWidth / o.clientWidth),
                r[1] = o.clientHeight - r[1] / (s._canvasHeight / o.clientHeight),
                r
            }
        }(),
        onMouseDown: function(t) {
            if (x(this._downCanvasCoord, t),
            this._hoverNode && this._attachedNode) {
                this._viewer._eventProxy.StandardMouseKeyboard._enable = !1,
                this.saveEditMatrices();
                var e = this._hoverNode.getParents()[0].getNodeMask();
                this._isEditing = !0,
                e & C.PICK_ARC ? (this._translateNode.setNodeMask(0),
                this._planeNode.setNodeMask(0),
                this.startRotateEdit(t)) : e & C.PICK_ARROW ? (this._rotateNode.setNodeMask(0),
                this._planeNode.setNodeMask(0),
                this.startTranslateEdit(t)) : e & C.PICK_PLANE && (this._rotateNode.setNodeMask(0),
                this._translateNode.setNodeMask(0),
                this.startPlaneEdit(t))
            }
        },
        saveEditMatrices: function() {
            p.copy(this._editLocal, this._attachedNode.getMatrix());
            var t = this._attachedNode.getWorldMatrices()[0];
            p.fromTranslation(this._editWorldTrans, h.fromValues(t[12], t[13], t[14])),
            p.copy(this._editWorldScaleRot, t),
            this._editWorldScaleRot[12] = this._editWorldScaleRot[13] = this._editWorldScaleRot[14] = 0,
            p.invert(this._editInvWorldScaleRot, this._editWorldScaleRot)
        },
        startRotateEdit: function(t) {
            var e = this._rotateNode.getWorldMatrices()[0]
              , i = h.create();
            h.transformMat4(i, i, e),
            this.getCanvasPositionFromWorldPoint(i, i);
            var n = this.pickGizmo(t, this._hoverNode.getNodeMask() | C.PICK_ARC);
            if (n) {
                var r = 0 === this._hoverNode._nbAxis ? -1 : 1
                  , a = h.create();
                a[0] = r * n.point[1],
                a[1] = -r * n.point[0],
                a[2] = n.point[2];
                var s = h.create();
                h.transformMat4(s, a, this._hoverNode.getMatrix()),
                h.transformMat4(s, s, e),
                this.getCanvasPositionFromWorldPoint(s, s);
                var o = this._editLineDirection;
                c.sub(o, s, i),
                c.normalize(o, o),
                this._showAngle.setNodeMask(C.NO_PICK),
                n.point[2] = 0;
                var u = this._showAngle.getStateSet();
                u.getUniform("uAngle").setFloat(0),
                u.getUniform("uBase").setVec3(h.normalize(n.point, n.point)),
                x(this._editLineOrigin, t)
            }
        },
        startTranslateEdit: function(t) {
            var e = this._editLineOrigin
              , i = this._editLineDirection
              , n = this._translateNode.getWorldMatrices()[0];
            p.getTranslation(e, n),
            h.init(i),
            i[this._hoverNode._nbAxis] = 1,
            this._translateInLocal && (h.transformMat4(i, i, this._editWorldScaleRot),
            h.normalize(i, i)),
            h.add(i, e, i),
            this.getCanvasPositionFromWorldPoint(e, e),
            this.getCanvasPositionFromWorldPoint(i, i),
            c.sub(i, i, e),
            c.normalize(i, i);
            var r = this._editOffset;
            x(r, t),
            c.sub(r, r, e)
        },
        startPlaneEdit: function(t) {
            var e = this._editLineOrigin
              , i = this._planeNode.getWorldMatrices()[0];
            p.getTranslation(e, i),
            this.getCanvasPositionFromWorldPoint(e, e);
            var n = this._editOffset;
            x(n, t),
            c.sub(n, n, e)
        },
        drawLineCanvasDebug: function(t, e, i, n) {
            this._debugNode.setNodeMask(C.NO_PICK);
            var r = this._debugNode.getChildren()[0].getAttributes().Vertex;
            r.getElements()[0] = t / this._canvas.clientWidth * 2 - 1,
            r.getElements()[1] = (this._canvas.clientHeight - e) / this._canvas.clientHeight * 2 - 1,
            r.getElements()[2] = i / this._canvas.clientWidth * 2 - 1,
            r.getElements()[3] = (this._canvas.clientHeight - n) / this._canvas.clientHeight * 2 - 1,
            r.dirty()
        },
        pickAndSelect: function(t) {
            this.setNodeMask(0);
            var e = this.computeNearestIntersection(t, this._tmask);
            this._autoInsertMT ? this.attachToGeometry(e ? e.nodepath[e.nodepath.length - 1] : e) : this.attachToNodePath(e ? e.nodepath : e)
        },
        onMouseUp: function(t) {
            var e = this._viewer._eventProxy.StandardMouseKeyboard;
            e._enable === !1 && (e._enable = !0,
            this._viewer._eventProxy.StandardMouseKeyboard.mouseup(t)),
            this._debugNode && this._debugNode.setNodeMask(0);
            var i = c.create();
            x(i, t),
            0 === c.distance(i, this._downCanvasCoord) && this.pickAndSelect(t),
            this._showAngle.setNodeMask(0),
            this._isEditing = !1,
            this._hoverNode && this.updateGizmoMask()
        },
        onMouseMove: function(t) {
            if (this._attachedNode) {
                var e;
                if (this._isEditing === !1)
                    return e = this.pickGizmo(t, C.PICK_GIZMO),
                    void this.onNodeHovered(e);
                if (this._hoverNode) {
                    var i = this._hoverNode.getParents()[0];
                    i === this._rotateNode ? this.updateRotateEdit(t) : i === this._translateNode ? this.updateTranslateEdit(t) : i === this._planeNode && this.updatePlaneEdit(t)
                }
            }
        },
        updateRotateEdit: function() {
            var t = p.create()
              , e = c.create()
              , i = h.fromValues(1, 0, 0)
              , n = h.fromValues(0, 1, 0)
              , r = h.fromValues(0, 0, 1);
            return function(a) {
                var s = this._editLineOrigin
                  , o = this._editLineDirection;
                x(e, a),
                c.sub(e, e, s);
                var u = c.dot(e, o);
                this._debugNode && this.drawLineCanvasDebug(s[0], s[1], s[0] + o[0] * u, s[1] + o[1] * u);
                var l = 7 * u / Math.min(this._canvas.clientWidth, this._canvas.clientHeight);
                l %= 2 * Math.PI;
                var h = this._hoverNode._nbAxis;
                0 === h ? p.fromRotation(t, -l, i) : 1 === h ? p.fromRotation(t, -l, n) : 2 === h && p.fromRotation(t, -l, r),
                this._showAngle.getOrCreateStateSet().getUniform("uAngle").setFloat(0 === h ? -l : l),
                this._rotateInLocal || (p.mul(t, this._editInvWorldScaleRot, t),
                p.mul(t, t, this._editWorldScaleRot)),
                p.mul(this._attachedNode.getMatrix(), this._editLocal, t),
                this._attachedNode.dirtyBound()
            }
        }(),
        updateTranslateEdit: function() {
            var t = c.create()
              , e = h.create();
            return function(i) {
                var n = this._editLineOrigin
                  , r = this._editLineDirection;
                x(t, i),
                c.sub(t, t, n),
                c.sub(t, t, this._editOffset);
                var a = c.dot(t, r);
                t[0] = n[0] + r[0] * a,
                t[1] = n[1] + r[1] * a,
                this._debugNode && this.drawLineCanvasDebug(n[0], n[1], t[0], t[1]);
                var s = this._viewer
                  , o = this._canvas
                  , u = t[0] * (s._canvasWidth / o.clientWidth)
                  , l = (o.clientHeight - t[1]) * (s._canvasHeight / o.clientHeight);
                if (this._lsi.reset(),
                this._lsi.setTestPlane(!1),
                this._lsi.set(h.set(this._origIntersect, u, l, 0), h.set(this._dstIntersect, u, l, 1)),
                this._iv.reset(),
                this._iv.setTraversalMask(this._hoverNode.getNodeMask()),
                p.copy(this.getMatrix(), this._editWorldTrans),
                this.setOnlyGizmoPicking(),
                this._viewer._camera.accept(this._iv),
                this.setOnlyScenePicking(),
                this._translateInLocal) {
                    p.getScale(e, this._editInvWorldScaleRot);
                    var d = this._lsi.getTranslateDistance();
                    h.mul(e, e, d)
                } else
                    h.transformMat4(e, this._lsi.getTranslateDistance(), this._editInvWorldScaleRot);
                p.translate(this._attachedNode.getMatrix(), this._editLocal, e),
                this._attachedNode.dirtyBound()
            }
        }(),
        updatePlaneEdit: function() {
            var t = c.create()
              , e = h.create();
            return function(i) {
                x(t, i),
                c.sub(t, t, this._editOffset);
                var n = this._viewer
                  , r = this._canvas
                  , a = t[0] * (n._canvasWidth / r.clientWidth)
                  , s = (r.clientHeight - t[1]) * (n._canvasHeight / r.clientHeight);
                if (this._lsi.reset(),
                this._lsi.setTestPlane(!0),
                this._lsi.set(h.set(this._origIntersect, a, s, 0), h.set(this._dstIntersect, a, s, 1)),
                this._iv.reset(),
                this._iv.setTraversalMask(this._hoverNode.getNodeMask()),
                p.copy(this.getMatrix(), this._editWorldTrans),
                this.setOnlyGizmoPicking(),
                this._viewer._camera.accept(this._iv),
                this.setOnlyScenePicking(),
                this._translateInLocal) {
                    p.getScale(e, this._editInvWorldScaleRot);
                    var o = this._lsi.getTranslateDistance();
                    h.mul(e, e, o)
                } else
                    h.transformMat4(e, this._lsi.getTranslateDistance(), this._editInvWorldScaleRot);
                p.translate(this._attachedNode.getMatrix(), this._editLocal, e),
                this._attachedNode.dirtyBound()
            }
        }()
    }),
    t.exports = C
}
, function(t, e, i) {
    "use strict";
    var n, r, a, s = i(1243), o = i(1234), u = i(1244), l = i(1245), c = i(1246), h = i(1306), d = i(1311), p = ["#ifdef GL_ES", "precision highp float;", "#endif"].join("\n"), f = function() {
        if (n)
            return n;
        var t = "#define SHADER_NAME GizmoLine3D"
          , e = [p, "attribute vec3 Vertex;", "uniform mat4 uModelViewMatrix;", "uniform mat4 uProjectionMatrix;", t, "", "void main(void) {", "  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);", "}"].join("\n")
          , i = [p, "uniform vec4 uColor;", t, "", "void main(void) {", "  gl_FragColor = uColor;", "}"].join("\n");
        return n = new h(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))
    }, g = function() {
        if (r)
            return r;
        var t = "#define SHADER_NAME GizmoLine2D"
          , e = [p, "attribute vec2 Vertex;", t, "", "void main(void) {", "  gl_Position = vec4(Vertex, 0.0, 1.0);", "}"].join("\n")
          , i = [p, t, "", "void main(void) {", "  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);", "}"].join("\n");
        return r = new h(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))
    }, m = function() {
        if (a)
            return a;
        var t = "#define SHADER_NAME GizmoQuadCircle"
          , e = [p, "attribute vec3 Vertex;", "uniform mat4 uModelViewMatrix;", "uniform mat4 uProjectionMatrix;", "varying vec3 vViewVertex;", t, "", "void main(void) {", "  vViewVertex = Vertex;", "  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);", "}"].join("\n")
          , i = [p, "uniform float uAngle;", "uniform vec3 uBase;", "varying vec3 vViewVertex;", "const float PI = 3.14159265358979323846264;", "const float PI2 = PI * 2.0;", t, "", "void main(void) {", "  if(length(vViewVertex) > 0.5)", "    discard;", "  vec3 vn = normalize(vViewVertex);", "  float angle = atan(uBase.y * vn.x - uBase.x * vn.y, dot(uBase, vn));", "  if(angle > 0.0) {", "    if(uAngle >= 0.0 && angle > uAngle) discard;", "    if(uAngle < -PI && angle < uAngle + PI2) discard;", "    if(uAngle < 0.0 && uAngle > -PI) discard;", "  }", "  if(angle < 0.0) {", "    if(uAngle <= 0.0 && angle < uAngle) discard;", "    if(uAngle > PI && angle > uAngle - PI2) discard;", "    if(uAngle > 0.0 && uAngle < PI) discard;", "  }", "  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.5);", "}"].join("\n");
        return a = new h(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))
    }, v = function() {
        var t = new o;
        t.getAttributes().Vertex = new s(s.ARRAY_BUFFER,new Float32Array(4),2);
        var e = new l(u.LINES,0,2);
        return t.getPrimitives().push(e),
        t.getOrCreateStateSet().setAttributeAndModes(g()),
        t
    }, _ = function(t, e, i, n, r) {
        var a = void 0 !== t ? t : 1
          , l = void 0 !== e ? e : .2
          , h = void 0 !== i ? i : 6
          , d = void 0 !== n ? n : 64
          , p = void 0 !== r ? r : 2 * Math.PI
          , g = (h + 1) * (d + 1)
          , m = h * d * 2
          , v = new o
          , _ = new Float32Array(3 * g)
          , b = new Uint16Array(3 * m);
        p = p || 2 * Math.PI;
        var x = 0
          , A = 0
          , y = 0
          , S = 0;
        for (S = 0; S <= h; ++S)
            for (y = 0; y <= d; ++y) {
                var C = y / d * p
                  , M = S / h * Math.PI * 2;
                A = 3 * x,
                _[A] = (a + l * Math.cos(M)) * Math.cos(C),
                _[A + 1] = (a + l * Math.cos(M)) * Math.sin(C),
                _[A + 2] = l * Math.sin(M),
                x++
            }
        for (x = 0,
        S = 1; S <= h; ++S)
            for (y = 1; y <= d; ++y)
                A = 6 * x,
                b[A] = (d + 1) * S + y - 1,
                b[A + 1] = b[A + 3] = (d + 1) * (S - 1) + y - 1,
                b[A + 2] = b[A + 5] = (d + 1) * S + y,
                b[A + 4] = (d + 1) * (S - 1) + y,
                x++;
        return v.getAttributes().Vertex = new s(s.ARRAY_BUFFER,_,3),
        v.getOrCreateStateSet().setAttributeAndModes(f()),
        v.getPrimitives().push(new c(u.TRIANGLES,new s(s.ELEMENT_ARRAY_BUFFER,b,1))),
        v
    }, b = function(t, e, i, n, r, a, l) {
        var h = void 0 !== t ? t : 1
          , d = void 0 !== e ? e : 1
          , p = void 0 !== i ? i : 5
          , g = void 0 !== n ? n : 32
          , m = void 0 !== r ? r : 1
          , v = void 0 === a || a
          , _ = void 0 === l || l;
        v = v && h > 0,
        _ = _ && d > 0;
        var b = .5 * p
          , x = (m + 1) * (g + 1)
          , A = m * g * 2;
        v && (x += 1,
        A += g),
        _ && (x += 1,
        A += g);
        var y = new o
          , S = new Float32Array(3 * x)
          , C = new Uint16Array(3 * A)
          , M = 0
          , w = 0
          , T = 0
          , E = 0;
        for (T = 0; T <= m; T++) {
            var I = T / m
              , k = I * (d - h) + h;
            for (E = 0; E <= g; E++) {
                var F = E / g;
                w = 3 * M,
                S[w] = k * Math.sin(F * Math.PI * 2),
                S[w + 1] = k * Math.cos(F * Math.PI * 2),
                S[w + 2] = -I * p + b,
                M++
            }
        }
        for (M = 0,
        E = 0; E < g; E++)
            for (T = 0; T < m; T++)
                w = 6 * M,
                C[w] = (g + 1) * T + E,
                C[w + 1] = C[w + 3] = (g + 1) * (T + 1) + E,
                C[w + 2] = C[w + 5] = (g + 1) * T + E + 1,
                C[w + 4] = (g + 1) * (T + 1) + E + 1,
                M++;
        M *= 2;
        var D;
        if (v)
            for (D = (_ ? S.length - 6 : S.length - 3) / 3,
            S[3 * D + 2] = b,
            E = 0; E < g; E++)
                w = 3 * M,
                C[w] = E,
                C[w + 1] = E + 1,
                C[w + 2] = D,
                M++;
        if (_) {
            D = (S.length - 3) / 3,
            S[3 * D + 2] = -b;
            var N = (g + 1) * T;
            for (E = 0; E < g; E++)
                w = 3 * M,
                C[w] = N + E + 1,
                C[w + 1] = N + E,
                C[w + 2] = D,
                M++
        }
        return y.getAttributes().Vertex = new s(s.ARRAY_BUFFER,S,3),
        y.getOrCreateStateSet().setAttributeAndModes(f()),
        y.getPrimitives().push(new c(u.TRIANGLES,new s(s.ELEMENT_ARRAY_BUFFER,C,1))),
        y
    }, x = function(t, e, i) {
        for (var n = new o, r = new Float32Array(3 * t), a = i || 2 * Math.PI, c = 0; c < t; ++c) {
            var h = 3 * c
              , d = a * c / t;
            r[h] = Math.cos(d) * e,
            r[h + 1] = Math.sin(d) * e
        }
        n.getAttributes().Vertex = new s(s.ARRAY_BUFFER,r,3);
        var p = new l(u.LINE_STRIP,0,t);
        return n.getOrCreateStateSet().setAttributeAndModes(f()),
        n.getPrimitives().push(p),
        n
    }, A = function(t, e) {
        var i = t ? .5 * t : .5
          , n = e ? .5 * e : .5
          , r = new o
          , a = new Float32Array(12);
        a[0] = -i,
        a[1] = -n,
        a[3] = i,
        a[4] = -n,
        a[6] = -i,
        a[7] = n,
        a[9] = i,
        a[10] = n,
        r.getAttributes().Vertex = new s(s.ARRAY_BUFFER,a,3);
        var c = new l(u.TRIANGLE_STRIP,0,4);
        return r.getOrCreateStateSet().setAttributeAndModes(f()),
        r.getPrimitives().push(c),
        r
    }, y = function() {
        var t = A();
        return t.getOrCreateStateSet().setAttributeAndModes(m()),
        t
    }, S = {};
    S.createCircleGeometry = x,
    S.createCylinderGeometry = b,
    S.createTorusGeometry = _,
    S.createDebugLineGeometry = v,
    S.createPlaneGeometry = A,
    S.createQuadCircleGeometry = y,
    t.exports = S
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1207)
      , a = i(1238)
      , s = i(1229)
      , o = function(t) {
        void 0 !== t && (void 0 !== t.object && void 0 !== t.field && this.createInternalSlider(t),
        this._uniform = this.createInternalSliderUniform(t))
    };
    o.prototype = {
        setTargetHTML: function(t) {
            this.parent = t
        },
        addToDom: function(t) {
            var e = document.createElement("div");
            e.innerHTML = t,
            this.parent.appendChild(e)
        },
        getValue: function(t) {
            if (window.localStorage) {
                var e = window.localStorage.getItem(t);
                return e
            }
            return null
        },
        setValue: function(t, e) {
            window.localStorage && window.localStorage.setItem(t, e)
        },
        createHTMLSlider: function(t, e, i, n) {
            var r = '<div>NAME [ MIN - MAX ] <input type="range" min="MIN" max="MAX" value="VALUE" step="STEP" onchange="ONCHANGE" /><span id="UPDATE"></span></div>'
              , a = t.min
              , s = t.max
              , o = t.step
              , u = i
              , l = n
              , c = l + "(this.value)";
            return r = r.replace(/MIN/g, a),
            r = r.replace(/MAX/g, s + o),
            r = r.replace("STEP", o),
            r = r.replace("VALUE", e),
            r = r.replace(/NAME/g, u),
            r = r.replace(/UPDATE/g, l),
            r = r.replace("ONCHANGE", c)
        },
        createUniformFunction: function(t, e, i, n, a) {
            var s = this;
            return function() {
                var o = e
                  , u = i
                  , l = n
                  , c = a
                  , h = function(e) {
                    l.get()[u] = e,
                    l.dirty(),
                    r.debug(o + " value " + e),
                    document.getElementById(a).innerHTML = Number(e).toFixed(4),
                    s.setValue(c, e),
                    void 0 !== t.onchange && t.onchange(l.get())
                };
                return h
            }()
        },
        createFunction: function(t, e, i, n, a, s) {
            var o = this;
            return function() {
                var u = e
                  , l = a
                  , c = s
                  , h = n
                  , d = function(e) {
                    "string" == typeof e && (e = parseFloat(e)),
                    "number" == typeof n[l] ? h[l] = e : h[l][i] = e,
                    r.debug(u + " value " + e),
                    document.getElementById(s).innerHTML = Number(e).toFixed(4),
                    o.setValue(c, e),
                    void 0 !== t.onchange && t.onchange(h[l])
                };
                return d
            }()
        },
        getCallbackName: function(t, e) {
            return "change_" + e + "_" + t
        },
        copyDefaultValue: function(t) {
            var e = t.value;
            return e = Array.isArray(t.value) ? t.value.slice() : [e]
        },
        createInternalSliderUniform: function(t) {
            var e = t.value
              , i = t.uniform;
            if (void 0 === i) {
                var n = t.type;
                n = n.charAt(0).toUpperCase() + n.slice(1),
                i = a["create" + n](e, t.name)
            }
            for (var s = this.getCallbackName(t.name, t.id), o = e.length, u = 0; u < o; u++) {
                var l = u.toString()
                  , c = t.name + l
                  , h = s + l
                  , d = e[u]
                  , p = this.getValue(h);
                null !== p ? d = p : t.uniform && void 0 !== t.uniform.get()[u] && (d = t.uniform.get()[u]);
                var f = this.createHTMLSlider(t, d, c, h);
                this.addToDom(f),
                window[h] = this.createUniformFunction(t, c, u, i, h),
                r.log(c + " " + d),
                window[h](d)
            }
            return this.uniform = i,
            i
        },
        createInternalSlider: function(t) {
            for (var e = t.value, i = t.name, n = t.id, a = e.length, s = this.getCallbackName(i, n), o = t.object, u = t.field, l = 0; l < a; l++) {
                var c = l.toString()
                  , h = i + c
                  , d = s + c
                  , p = e[l]
                  , f = this.getValue(d);
                p = null !== f ? f : "number" == typeof o[u] ? o[u] : o[u][l];
                var g = this.createHTMLSlider(t, p, h, d);
                this.addToDom(g),
                window[d] = this.createFunction(t, h, l, o, u, d),
                r.log(h + " " + p),
                window[d](p)
            }
        },
        createSlider: function(t) {
            return void 0 !== t.html && this.setTargetHTML(t.html),
            void 0 === t.id && (t.id = t.name),
            t.value = this.copyDefaultValue(t),
            void 0 !== t.type ? this.createInternalSliderUniform(t) : (void 0 === t.object && (t.object = {
                data: t.value
            },
            t.field = "data"),
            this.createInternalSlider(t))
        }
    };
    var u = function() {
        s.call(this),
        this.arraySlider = new o,
        this.setTargetHTML(document.body)
    };
    u.createSlider = function(t) {
        (new o).createSlider(t)
    }
    ,
    u.prototype = n.objectInherit(s.prototype, {
        setTargetHTML: function(t) {
            this.targetHTML = t,
            this.arraySlider.setTargetHTML(this.targetHTML)
        },
        getUniformList: function(t, e) {
            var i = "(uniform)"
              , n = ".*?"
              , r = "((?:[a-z][a-z]+))"
              , a = ".*?"
              , s = "((?:[a-z][a-z]+))"
              , o = ".*?"
              , u = "."
              , l = ".*?"
              , c = "."
              , h = ".*?"
              , d = "(.)"
              , p = "(.)"
              , f = ".*?"
              , g = "(\\{.*?\\})"
              , m = new RegExp(i + n + r + a + s + o + u + l + c + h + d + p + f + g,["g"])
              , v = t.match(m)
              , _ = e
              , b = function(t) {
                return function() {
                    return t
                }
            };
            if (null !== v)
                for (var x = new RegExp(i + n + r + a + s + o + u + l + c + h + d + p + f + g,["i"]), A = 0, y = v.length; A < y; A++) {
                    var S = v[A].match(x);
                    if (null !== S) {
                        var C = S[2]
                          , M = S[3]
                          , w = S[6]
                          , T = JSON.parse(w);
                        T.type = C,
                        T.name = M;
                        var E = T.value;
                        T.value = b(E),
                        _[M] = T
                    }
                }
            return _
        },
        getUniformFromStateSet: function(t, e) {
            var i = t.getUniformList();
            if (i)
                for (var n = window.Object.keys(e), r = 0, a = n.length; r < a; r++) {
                    var s = n[r];
                    void 0 !== i[s] && void 0 === e[s].uniform && (e[s].uniform = i[s].object)
                }
        },
        findExistingUniform: function(t, e) {
            var i = function() {
                s.call(this, s.TRAVERSE_PARENTS)
            };
            i.prototype = n.objectInherit(s.prototype, {
                setUniformMap: function(t) {
                    this.uniformMap = t
                },
                apply: function(t) {
                    var e = t.getStateSet();
                    e && u.prototype.getUniformFromStateSet(e, this.uniformMap),
                    this.traverse(t)
                }
            });
            var r = new i;
            r.setUniformMap(e),
            t.accept(r)
        },
        applyProgram: function(t, e) {
            var i = e.getAttribute("Program")
              , n = i.getName()
              , a = {};
            this.getUniformList(i.getVertexShader().getText(), a),
            this.getUniformList(i.getFragmentShader().getText(), a);
            var s = 0
              , o = window.Object.keys(a);
            if (void 0 === n) {
                var u = function(t) {
                    var e = 0
                      , i = 0;
                    if (0 === t.length)
                        return e;
                    for (s = 0; s < t.length; s++)
                        i = t.charCodeAt(s),
                        e = (e << 5) - e + i,
                        e &= e;
                    return e < 0 && (e = -e),
                    e
                }
                  , l = o.join("");
                n = u(l).toString()
            }
            this.findExistingUniform(t, a);
            var c = !1;
            for (s = 0; s < o.length; s++) {
                var h = o[s]
                  , d = a[h];
                d.type,
                d.name;
                d.id = n;
                var p = this.arraySlider.createSlider(d);
                void 0 === d.uniform && p && e.addUniform(p),
                c = !0
            }
            if (c) {
                var f = document.createElement("div");
                f.innerHTML = "<p> </p>",
                this.targetHTML.appendChild(f)
            }
            r.log(a)
        },
        applyStateSet: function(t, e) {
            void 0 !== e.getAttribute("Program") && this.applyProgram(t, e)
        },
        apply: function(t) {
            var e = this.targetHTML;
            if (void 0 !== e && null !== e) {
                var i = t.getStateSet();
                void 0 !== i && this.applyStateSet(t, i),
                this.traverse(t)
            }
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).vec3
      , r = i(1212).mat4
      , a = i(1299)
      , s = function() {
        this._center = n.create(),
        this._iCenter = n.create(),
        this._radius = 1,
        this._iRadius = 1,
        this._intersections = []
    };
    s.prototype = {
        set: function(t, e) {
            n.copy(this._center, t),
            n.copy(this._iCenter, t),
            this._radius = this._iRadius = e,
            this.reset()
        },
        setCenter: function(t) {
            n.copy(this._center, t),
            n.copy(this._iCenter, t)
        },
        setRadius: function(t) {
            this._radius = this._iRadius = t
        },
        reset: function() {
            this._intersections.length = 0
        },
        enter: function(t) {
            return !t.isCullingActive() || this.intersects(t.getBound())
        },
        intersects: function(t) {
            if (!t.valid())
                return !1;
            var e = this._iRadius + t.radius();
            return n.sqrDist(t.center(), this._iCenter) <= e * e
        },
        intersect: function() {
            var t = new a;
            return function(e, i) {
                var n = i.getShape();
                if (n)
                    return n.intersectSphere(this._iCenter, this._iRadius, this._intersections, e.nodePath);
                if (t.reset(),
                t.setNodePath(e.nodePath),
                t.set(this._iCenter, this._iRadius),
                i.computeTransformedVertices) {
                    var r = i.getVertexAttributeList()
                      , a = r.Vertex.getElements();
                    r.Vertex._elements = i.computeTransformedVertices(),
                    t.apply(i),
                    r.Vertex._elements = a
                } else
                    t.apply(i);
                for (var s = t._intersections.length, o = 0; o < s; o++)
                    this._intersections.push(t._intersections[o]);
                return s > 0
            }
        }(),
        getIntersections: function() {
            return this._intersections
        },
        setCurrentTransformation: function() {
            var t = n.create();
            return function(e) {
                r.invert(e, e),
                n.transformMat4(this._iCenter, this._center, e),
                this._iRadius = this._radius * r.getScale(t, e)[0]
            }
        }()
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1243)
      , a = i(1234)
      , s = i(1229)
      , o = i(1244)
      , u = i(1212).vec3
      , l = n
      , c = function() {
        s.call(this),
        this._T = void 0,
        this._B = void 0,
        this._N = void 0,
        this._texCoordUnit = 0
    };
    c.prototype = n.objectInherit(s.prototype, {
        apply: function(t) {
            t.getTypeID() === a.getTypeID() ? this.generate(t, this._texCoordUnit) : this.traverse(t)
        },
        setTexCoordUnit: function(t) {
            this._texCoordUnit = t
        },
        computePrimitiveSet: function(t, e) {
            if (e.getIndices) {
                var i, n = e.getNumIndices(), r = t.getAttributes().Vertex, a = t.getAttributes().Normal, s = t.getAttributes()["TexCoord" + this._texCoordUnit];
                if (e.getMode() === o.TRIANGLES)
                    for (i = 0; i < n; i += 3)
                        this.compute(e, r, a, s, i, i + 1, i + 2);
                else if (e.getMode() === o.TRIANGLE_STRIP)
                    for (i = 0; i < n - 2; ++i)
                        i % 2 === 0 ? this.compute(e, r, a, s, i, i + 1, i + 2) : this.compute(e, r, a, s, i + 1, i, i + 2)
            }
        },
        generate: function(t, e) {
            this._texCoordUnit = e,
            void 0 === this._texCoordUnit && (this._texCoordUnit = 0);
            var i = t.getAttributes().Vertex.getElements().length;
            this._T = new l.Float32Array(i),
            this._B = new l.Float32Array(i),
            this._N = new l.Float32Array(i),
            t.getPrimitiveSetList().forEach(function(e) {
                this.computePrimitiveSet(t, e)
            }, this);
            for (var n = i / 3, a = new l.Float32Array(4 * n), s = u.create(), o = u.create(), c = u.create(), h = 0; h < n; h++) {
                var d = this._T.subarray(3 * h, 3 * h + 3)
                  , p = this._N.subarray(3 * h, 3 * h + 3)
                  , f = this._B.subarray(3 * h, 3 * h + 3);
                u.normalize(p, p);
                var g = u.dot(p, d);
                u.scale(o, p, g),
                u.sub(s, d, o),
                u.normalize(c, s),
                u.cross(s, p, d);
                var m = u.dot(s, f);
                m = m < 0 ? -1 : 0,
                a[4 * h] = c[0],
                a[4 * h + 1] = c[1],
                a[4 * h + 2] = c[2],
                a[4 * h + 3] = m
            }
            t.getAttributes().Normal.setElements(this._N),
            t.getAttributes().Tangent = new r("ARRAY_BUFFER",a,4)
        },
        compute: function(t, e, i, n, r, a, s) {
            var o, l, c = t.index(r), h = t.index(a), d = t.index(s), p = e.getElements().subarray(3 * c, 3 * c + 3), f = e.getElements().subarray(3 * h, 3 * h + 3), g = e.getElements().subarray(3 * d, 3 * d + 3), m = i.getElements().subarray(3 * c, 3 * c + 3), v = i.getElements().subarray(3 * h, 3 * h + 3), _ = i.getElements().subarray(3 * d, 3 * d + 3), b = n.getElements().subarray(2 * c, 2 * c + 2), x = n.getElements().subarray(2 * h, 2 * h + 2), A = n.getElements().subarray(2 * d, 2 * d + 2), y = u.create(), S = u.create(), C = u.create(), M = u.create(), w = u.create(), T = u.create(), E = u.create(), I = u.create(), k = u.create();
            u.set(I, f[0] - p[0], x[0] - b[0], x[1] - b[1]),
            u.set(k, g[0] - p[0], A[0] - b[0], A[1] - b[1]),
            u.cross(y, I, k),
            0 !== y[0] && (u.normalize(y, y),
            l = -y[1] / y[0],
            o = -y[2] / y[0],
            w[0] += l,
            S[0] += o,
            T[0] += l,
            C[0] += o,
            E[0] += l,
            M[0] += o),
            u.set(I, f[1] - p[1], x[0] - b[0], x[1] - b[1]),
            u.set(k, g[1] - p[1], A[0] - b[0], A[1] - b[1]),
            u.cross(y, I, k),
            0 !== y[0] && (u.normalize(y, y),
            l = -y[1] / y[0],
            o = -y[2] / y[0],
            w[1] += l,
            S[1] += o,
            T[1] += l,
            C[1] += o,
            E[1] += l,
            M[1] += o),
            u.set(I, f[2] - p[2], x[0] - b[0], x[1] - b[1]),
            u.set(k, g[2] - p[2], A[0] - b[0], A[1] - b[1]),
            u.cross(y, I, k),
            0 !== y[0] && (u.normalize(y, y),
            l = -y[1] / y[0],
            o = -y[2] / y[0],
            w[2] += l,
            S[2] += o,
            T[2] += l,
            C[2] += o,
            E[2] += l,
            M[2] += o);
            var F, D, N, R = u.create(), P = u.create();
            u.cross(R, m, w),
            u.cross(P, R, m),
            F = this._T.subarray(3 * c, 3 * c + 3),
            u.add(F, P, F),
            u.cross(R, S, m),
            u.cross(P, m, R),
            D = this._B.subarray(3 * c, 3 * c + 3),
            u.add(D, P, D),
            u.cross(R, v, T),
            u.cross(P, R, v),
            F = this._T.subarray(3 * h, 3 * h + 3),
            u.add(F, P, F),
            u.cross(R, C, v),
            u.cross(P, v, R),
            D = this._B.subarray(3 * h, 3 * h + 3),
            u.add(D, P, D),
            u.cross(R, _, E),
            u.cross(P, R, _),
            F = this._T.subarray(3 * d, 3 * d + 3),
            u.add(F, P, F),
            u.cross(R, M, _),
            u.cross(P, _, R),
            D = this._B.subarray(3 * d, 3 * d + 3),
            u.add(D, P, D),
            N = this._N.subarray(3 * c, 3 * c + 3),
            u.add(N, m, N),
            N = this._N.subarray(3 * h, 3 * h + 3),
            u.add(N, v, N),
            N = this._N.subarray(3 * d, 3 * d + 3),
            u.add(N, _, N)
        }
    }),
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(1260)
      , r = i(1273)
      , a = i(1212).mat4
      , s = i(1209)
      , o = i(1306)
      , u = i(1311)
      , l = i(1312)
      , c = i(1237)
      , h = i(1208)
      , d = i(1238)
      , p = i(1212).vec2
      , f = i(1212).vec3
      , g = i(1212).vec4
      , m = i(1321)
      , v = i(1369)
      , _ = {}
      , b = function(t, e, i, n, r) {
        this._viewer = t,
        this._rttScene = e,
        this._hmdConfig = i,
        this._root = n,
        this._canvas = r,
        this._width = r.width,
        this._height = r.height
    };
    b.prototype = {
        update: function() {
            var t = this._canvas
              , e = t.width
              , i = t.height;
            if (e !== this._width || i !== this._height) {
                this._root.removeChildren();
                var n = this._hmdConfig;
                n && n.isCardboard && (n.hResolution = e,
                n.vResolution = i),
                this._width = e,
                this._height = i,
                _.createScene(this._viewer, this._rttScene, n, this._root)
            }
            return !0
        }
    };
    var x = function(t, e) {
        this._rootView = t,
        this._offsetView = e
    };
    x.prototype = {
        update: function(t) {
            var e = t.getViewMatrix();
            return a.mul(e, this._offsetView, this._rootView),
            !0
        }
    };
    var A = function(t, e, i, n) {
        var r = e.hResolution / (2 * e.vResolution)
          , s = -1 - 4 * (.25 * e.hScreenSize - .5 * e.lensSeparationDistance) / e.hScreenSize
          , o = e.distortionK[0] + e.distortionK[1] * Math.pow(s, 2) + e.distortionK[2] * Math.pow(s, 4) + e.distortionK[3] * Math.pow(s, 6)
          , u = 180 / Math.PI * 2 * Math.atan2(e.vScreenSize * o, 2 * e.eyeToScreenDistance)
          , l = a.perspective(a.create(), Math.PI / 180 * u, r, .3, 1e4)
          , c = 4 * (.25 * e.hScreenSize - .5 * e.interpupillaryDistance) / e.hScreenSize
          , h = 4 * (.25 * e.hScreenSize - .5 * e.lensSeparationDistance) / e.hScreenSize
          , d = a.create()
          , g = a.create();
        n.projectionLeft = a.mul(d, a.fromTranslation(d, f.fromValues(c, 0, 0)), l),
        n.projectionRight = a.mul(g, a.fromTranslation(g, f.fromValues(-c, 0, 0)), l),
        n.viewLeft = a.fromTranslation(a.create(), f.fromValues(t * e.interpupillaryDistance * .5, 0, 0)),
        n.viewRight = a.fromTranslation(a.create(), f.fromValues(-t * e.interpupillaryDistance * .5, 0, 0)),
        i.lensCenterLeft = p.fromValues(h, 0),
        i.lensCenterRight = p.fromValues(-h, 0),
        i.hmdWarpParam = e.distortionK,
        i.chromAbParam = e.chromaAbParameter,
        i.scaleIn = p.fromValues(1, 1 / r),
        i.scale = p.fromValues(1 / o, 1 * r / o)
    }
      , y = function() {
        var t = ["", "#ifdef GL_ES", "precision highp float;", "#endif", "uniform vec2 uScale;", "uniform vec2 uScaleIn;", "uniform vec2 uLensCenter;", "uniform vec4 uHmdWarpParam;", "uniform vec4 uChromAbParam;", "uniform sampler2D Texture0;", "varying vec2 vTexCoord0;", "void main(void) {", "  vec2 uv = (vTexCoord0 * 2.0) - 1.0;", "  vec2 theta = (uv - uLensCenter) * uScaleIn;", "  float rSq = theta.x * theta.x + theta.y * theta.y;", "  vec2 rvector = theta * (uHmdWarpParam.x + uHmdWarpParam.y * rSq + uHmdWarpParam.z * rSq * rSq + uHmdWarpParam.w * rSq * rSq * rSq);", "  vec2 rBlue = rvector * (uChromAbParam.z + uChromAbParam.w * rSq);", "  vec2 tcBlue = (uLensCenter + uScale * rBlue);", "  tcBlue = (tcBlue + 1.0) * 0.5;", "  if (any(bvec2(clamp(tcBlue, vec2(0.0, 0.0), vec2(1.0, 1.0)) - tcBlue))) {", "    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);", "    return;", "  }", "  vec2 tcGreen = uLensCenter + uScale * rvector;", "  tcGreen = (tcGreen + 1.0) * 0.5;", "  vec2 rRed = rvector * (uChromAbParam.x + uChromAbParam.y * rSq);", "  vec2 tcRed = uLensCenter + uScale * rRed;", "  tcRed = (tcRed + 1.0) * 0.5;", "  gl_FragColor = vec4(texture2D(Texture0, tcRed).r, texture2D(Texture0, tcGreen).g, texture2D(Texture0, tcBlue).b, 1);", "}", ""].join("\n");
        return new o(new u(u.VERTEX_SHADER,v.Filter.defaultVertexShader),new u(u.FRAGMENT_SHADER,t))
    }
      , S = function(t) {
        var e = new c;
        return e.setTextureSize(t[0], t[1]),
        e.setMinFilter("LINEAR"),
        e.setMagFilter("LINEAR"),
        e
    }
      , C = function(t, e, i, r, s, o) {
        var u = new n
          , l = e[0]
          , c = e[1]
          , p = i[0]
          , f = i[1];
        r === !0 ? t ? u.setViewport(new m(0,0,p / 2,f)) : u.setViewport(new m(p / 2,0,p / 2,f)) : t ? u.setViewport(new m(.5 * p - l,.5 * (f - c),l,c)) : u.setViewport(new m(.5 * p,.5 * (f - c),l,c)),
        a.ortho(u.getProjectionMatrix(), -.5, .5, -.5, .5, -5, 5),
        u.setRenderOrder(n.NESTED_RENDER, 0),
        u.setReferenceFrame(h.ABSOLUTE_RF);
        var g = u.getOrCreateStateSet();
        return g.setTextureAttributeAndModes(0, s),
        g.setAttributeAndModes(y()),
        g.addUniform(d.createFloat2(o.scale, "uScale")),
        g.addUniform(d.createFloat2(o.scaleIn, "uScaleIn")),
        g.addUniform(d.createFloat2(t ? o.lensCenterLeft : o.lensCenterRight, "uLensCenter")),
        g.addUniform(d.createFloat4(o.hmdWarpParam, "uHmdWarpParam")),
        g.addUniform(d.createFloat4(o.chromAbParam, "uChromAbParam")),
        u
    }
      , M = function(t, e) {
        var i = new n;
        return i.setName("rtt camera"),
        i.setViewport(new m(0,0,t.getWidth(),t.getHeight())),
        i.setProjectionMatrix(e),
        i.setClearColor(g.fromValues(.3, .3, .3, 0)),
        i.setRenderOrder(n.POST_RENDER, 0),
        i.attachTexture(r.COLOR_ATTACHMENT0, t),
        i.attachRenderBuffer(r.DEPTH_ATTACHMENT, r.DEPTH_COMPONENT16),
        i.setReferenceFrame(h.ABSOLUTE_RF),
        i
    };
    _.createScene = function(t, e, i, n, r) {
        var a = _.getDefaultConfig(i)
          , o = p.fromValues(.5 * a.hResolution, a.vResolution)
          , u = p.fromValues(.5 * a.hResolution, a.vResolution)
          , c = t.getCamera().getViewport()
          , h = p.fromValues(c.width(), c.height())
          , d = t.getGraphicContext().canvas;
        a.isCardboard && (h[0] = d.width,
        h[1] = d.height);
        var f = void 0 !== r ? r : 1
          , g = {}
          , m = {};
        A(f, a, g, m);
        var v = t.getCamera().getViewMatrix()
          , y = n || new s;
        y.addUpdateCallback(new b(t,e,i,y,d));
        var w = S(o)
          , T = M(w, m.projectionLeft)
          , E = C(!0, u, h, a.isCardboard, w, g);
        T.addUpdateCallback(new x(v,m.viewLeft));
        var I = S(o)
          , k = M(I, m.projectionRight)
          , F = C(!1, u, h, a.isCardboard, I, g);
        return k.addUpdateCallback(new x(v,m.viewRight)),
        T.addChild(e),
        k.addChild(e),
        E.addChild(l.createTexturedFullScreenFakeQuadGeometry()),
        F.addChild(l.createTexturedFullScreenFakeQuadGeometry()),
        y.addChild(T),
        y.addChild(k),
        y.addChild(E),
        y.addChild(F),
        y
    }
    ,
    _.getDefaultConfig = function(t) {
        var e = {
            hResolution: 1920,
            vResolution: 1080,
            hScreenSize: .1296,
            vScreenSize: .0729,
            interpupillaryDistance: .064,
            lensSeparationDistance: .0635,
            eyeToScreenDistance: .04,
            distortionK: g.fromValues(1, .22, .13, .02),
            chromaAbParameter: g.fromValues(.996, -.004, 1.014, 0),
            isCardboard: !1
        };
        return 2 === t || void 0 === t ? e : 1 === t ? (e.hResolution = 1280,
        e.vResolution = 800,
        e.hScreenSize = .14976,
        e.vScreenSize = .0936,
        e.lensSeparationDistance = .064,
        e.eyeToScreenDistance = .041,
        e.distortionK = g.fromValues(1, .22, .24, 0),
        e) : (void 0 !== t.hResolution && (e.hResolution = t.hResolution),
        void 0 !== t.vResolution && (e.vResolution = t.vResolution),
        void 0 !== t.hScreenSize && (e.hScreenSize = t.hScreenSize),
        void 0 !== t.vScreenSize && (e.vScreenSize = t.vScreenSize),
        void 0 !== t.interpupillaryDistance && (e.interpupillaryDistance = t.interpupillaryDistance),
        void 0 !== t.lensSeparationDistance && (e.lensSeparationDistance = t.lensSeparationDistance),
        void 0 !== t.eyeToScreenDistance && (e.eyeToScreenDistance = t.eyeToScreenDistance),
        void 0 !== t.distortionK && (e.distortionK = t.distortionK),
        void 0 !== t.chromaAbParameter && (e.chromaAbParameter = t.chromaAbParameter),
        void 0 !== t.isCardboard && (e.isCardboard = t.isCardboard),
        e)
    }
    ,
    t.exports = _
}
, function(t, e, i) {
    "use strict";
    var n = i(1260)
      , r = i(1273)
      , a = i(1212).mat4
      , s = i(1209)
      , o = i(1306)
      , u = i(1311)
      , l = i(1312)
      , c = i(1237)
      , h = i(1208)
      , d = i(1238)
      , p = i(1212).vec3
      , f = i(1212).vec4
      , g = i(1321)
      , m = i(1369)
      , v = function(t, e) {
        this._rootView = t,
        this._offsetView = e
    };
    v.prototype = {
        update: function(t) {
            var e = t.getViewMatrix();
            return a.mul(e, this._offsetView, this._rootView),
            !0
        }
    };
    var _ = function(t) {
        var e = new c;
        return e.setTextureSize(t.width, t.height),
        e.setMinFilter("LINEAR"),
        e.setMagFilter("LINEAR"),
        e
    }
      , b = function() {
        var t = ["#ifdef GL_ES", "   precision highp float;", "#endif", "varying vec2 vTexCoord0;", "uniform sampler2D TextureLeft;", "uniform sampler2D TextureRight;", "void main() {", "   if (vTexCoord0.x < 0.5)", "       gl_FragColor = texture2D(TextureLeft, vec2(vTexCoord0.x * 2.0, vTexCoord0.y));", "   else", "       gl_FragColor = texture2D(TextureRight, vec2(vTexCoord0.x * 2.0 - 1.0, vTexCoord0.y));", "}"].join("\n");
        return new o(new u(u.VERTEX_SHADER,m.Filter.defaultVertexShader),new u(u.FRAGMENT_SHADER,t))
    }
      , x = function(t, e, i) {
        var r = new n;
        r.setViewport(i),
        r.setRenderOrder(n.NESTED_RENDER, 0),
        r.setReferenceFrame(h.ABSOLUTE_RF),
        a.ortho(r.getProjectionMatrix(), 0, 1, 0, 1, -5, 5);
        var s = r.getOrCreateStateSet();
        return s.addUniform(d.createInt(0, "TextureLeft")),
        s.addUniform(d.createInt(1, "TextureRight")),
        s.setTextureAttributeAndModes(0, t),
        s.setTextureAttributeAndModes(1, e),
        s.setAttributeAndModes(b()),
        r.addChild(l.createTexturedFullScreenFakeQuadGeometry()),
        r
    }
      , A = function(t, e) {
        var i = new n;
        return i.setName("rtt camera"),
        i.setViewport(new g(0,0,t.getWidth(),t.getHeight())),
        i.setProjectionMatrix(e),
        i.setClearColor(f.fromValues(.3, .3, .3, 0)),
        i.setRenderOrder(n.POST_RENDER, 0),
        i.attachTexture(r.COLOR_ATTACHMENT0, t),
        i.attachRenderBuffer(r.DEPTH_ATTACHMENT, r.DEPTH_COMPONENT16),
        i.setReferenceFrame(h.ABSOLUTE_RF),
        i
    }
      , y = {};
    y.createScene = function(t, e, i, n, r) {
        var o = n || new s
          , u = void 0 !== r ? r : 1
          , l = i.getEyeParameters("left")
          , c = i.getEyeParameters("right")
          , h = new window.VRFrameData;
        i.getFrameData(h);
        var d = a.fromTranslation(a.create(), p.fromValues(-u * l.offset[0], l.offset[1], l.offset[2]))
          , f = a.fromTranslation(a.create(), p.fromValues(-u * c.offset[0], c.offset[1], c.offset[2]))
          , g = {
            width: Math.max(l.renderWidth, c.renderWidth),
            height: Math.max(l.renderHeight, c.renderHeight)
        }
          , m = _(g)
          , b = _(g)
          , y = A(m, h.leftProjectionMatrix)
          , S = A(b, h.rightProjectionMatrix)
          , C = t.getCamera().getViewMatrix();
        y.addUpdateCallback(new v(C,d)),
        S.addUpdateCallback(new v(C,f));
        var M = x(m, b, t.getCamera().getViewport());
        return y.addChild(e),
        S.addChild(e),
        o.addChild(y),
        o.addChild(S),
        o.addChild(M),
        o
    }
    ,
    t.exports = y
}
, function(t, e, i) {
    "use strict";
    var n = i(1420)
      , r = i(1421)
      , a = i(1431)
      , s = i(1434)
      , o = i(1422)
      , u = {};
    u.Renderer = n,
    u.View = r,
    u.Viewer = a,
    u.EventProxy = s,
    u.Scene = o,
    t.exports = u
}
, function(module, exports, __webpack_require__) {
    "use strict";
    var Notify = __webpack_require__(1207)
      , mat4 = __webpack_require__(1212).mat4
      , Options = __webpack_require__(1432)
      , P = __webpack_require__(235)
      , Timer = __webpack_require__(1206)
      , TimerGPU = __webpack_require__(1323)
      , UpdateVisitor = __webpack_require__(1316)
      , MACROUTILS = __webpack_require__(1203)
      , Texture = __webpack_require__(1237)
      , OrbitManipulator = __webpack_require__(1348)
      , createStats = __webpack_require__(1433)
      , EventProxy = __webpack_require__(1434)
      , View = __webpack_require__(1421)
      , WebGLUtils = __webpack_require__(1236)
      , WebGLDebugUtils = __webpack_require__(1443)
      , requestFile = __webpack_require__(1251)
      , OptionsURL = function() {
        var t = {};
        if (function(t) {
            var e, i = [];
            if (window.location.search)
                for (var n = window.location.search.slice(1).split("&"), r = 0; r < n.length; r++) {
                    e = n[r].split("=");
                    var a = e[0];
                    i.push(a);
                    var s = e[1];
                    void 0 === s && (s = "1"),
                    t[a] = s
                }
        }(t),
        void 0 !== t.log) {
            var e = t.log.toLowerCase();
            switch (e) {
            case "debug":
                Notify.setNotifyLevel(Notify.DEBUG);
                break;
            case "info":
                Notify.setNotifyLevel(Notify.INFO);
                break;
            case "notice":
                Notify.setNotifyLevel(Notify.NOTICE);
                break;
            case "warn":
                Notify.setNotifyLevel(Notify.WARN);
                break;
            case "error":
                Notify.setNotifyLevel(Notify.ERROR);
                break;
            case "html":
                !function() {
                    var t = []
                      , e = document.createElement("div")
                      , i = document.createElement("pre");
                    document.addEventListener("DOMContentLoaded", function() {
                        document.body.appendChild(e),
                        e.appendChild(i)
                    });
                    var n = function(e) {
                        t.unshift(e),
                        i.innerHTML = t.join("\n")
                    };
                    e.style.overflow = "hidden",
                    e.style.position = "absolute",
                    e.style.zIndex = "10000",
                    e.style.height = "100%",
                    e.style.maxWidth = "600px",
                    i.style.overflow = "scroll",
                    i.style.width = "105%",
                    i.style.height = "100%",
                    i.style.fontSize = "10px",
                    ["log", "error", "warn", "info", "debug"].forEach(function(t) {
                        window.console[t] = n
                    })
                }()
            }
        }
        return t
    }()
      , getGLSLOptimizer = function() {
        var deferOptimizeGLSL = P.defer();
        window.deferOptimizeGLSL = deferOptimizeGLSL;
        var mod = ["        var Module = {", "            preRun: [],", "            postRun: [ function () {", '                var func = Module.cwrap( "optimize_glsl", "string", [ "string", "number", "number" ] );', "                window.deferOptimizeGLSL.resolve( func );", "            } ],", "            print: function ( text ) {", "                Notify.debug( text );", "            },", "            printErr: function ( text ) {", "                Notify.debug( text );", "            },", "            setStatus: function ( text ) {", "                Notify.debug( text );", "            },", "            totalDependencies: 0,", "            monitorRunDependencies: function ( left ) {", "                this.totalDependencies = Math.max( this.totalDependencies, left );", '                Module.setStatus( left ? "GLSL optimizer preparing... (" + ( this.totalDependencies - left ) + "/" + this.totalDependencies + ")" : "All downloads complete." );', "            },", '            memoryInitializerPrefixURL: "https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/"', "        };"].join("\n");
        Notify.log("try to load glsl optimizer");
        var url = "https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/glsl-optimizer.js"
          , promise = requestFile(url);
        return promise.then(function(script) {
            eval(mod + script)
        })["catch"](function() {
            deferOptimizeGLSL.reject()
        }),
        deferOptimizeGLSL.promise
    }
      , Viewer = function(t, e, i) {
        View.call(this),
        this._startTick = Timer.instance().tick(),
        this._stats = void 0,
        this._done = !1,
        this._runPromise = P.resolve();
        var n = this.initOptions(e)
          , r = this.initWebGLContext(t, n, i);
        if (!r)
            throw "No WebGL implementation found";
        MACROUTILS.init(),
        this.initDeviceEvents(n, t),
        this.initStats(n, t),
        this.initRun(n),
        this._updateVisitor = new UpdateVisitor,
        this.setUpView(r.canvas, n),
        this._hmd = null,
        this._requestAnimationFrame = window.requestAnimationFrame.bind(window),
        this._contextLost = !1
    };
    Viewer.prototype = MACROUTILS.objectInherit(View.prototype, {
        initDeviceEvents: function(t, e) {
            var i = t.mouseEventNode || e
              , n = t.EventBackend || {};
            t.EventBackend || (t.EventBackend = n),
            n.StandardMouseKeyboard = t.EventBackend.StandardMouseKeyboard || {};
            var r = n.StandardMouseKeyboard.mouseEventNode || i;
            n.StandardMouseKeyboard.mouseEventNode = r,
            n.StandardMouseKeyboard.keyboardEventNode = n.StandardMouseKeyboard.keyboardEventNode || document,
            "ontouchstart"in window && (n.Hammer = n.Hammer || {},
            n.Hammer.eventNode = n.Hammer.eventNode || i),
            n.GamePad = n.GamePad || {},
            this._eventProxy = this.initEventProxy(t)
        },
        initOptions: function(t) {
            var e = new Options;
            return t && e.extend(t),
            e.extend(OptionsURL),
            e.getBoolean("traceLogCall") === !0 && (Notify.traceLogCall = !0),
            e.getBoolean("enableFrustumCulling") === !0 && this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),
            e
        },
        initWebGLContext: function(t, e, i) {
            e.get("SimulateWebGLLostContext") && (t = WebGLDebugUtils.makeLostContextSimulatingCanvas(t),
            t.loseContextInNCalls(e.get("SimulateWebGLLostContext")));
            var n = WebGLUtils.setupWebGL(t, e, i);
            return t.addEventListener("webglcontextlost", function(t) {
                this.contextLost(),
                t.preventDefault()
            }
            .bind(this), !1),
            t.addEventListener("webglcontextrestored", function() {
                this.contextRestored()
            }
            .bind(this), !1),
            (Notify.reportWebGLError || e.get("reportWebGLError")) && (n = WebGLDebugUtils.makeDebugContext(n)),
            this.initWebGLCaps(n),
            this.setGraphicContext(n),
            n
        },
        initRun: function(t) {
            if (t.getBoolean("GLSLOptimizer") === !0) {
                var e = __webpack_require__(1311);
                e.enableGLSLOptimizer = !0,
                this._runPromise = getGLSLOptimizer(),
                this._runPromise.then(function(t) {
                    e.glslOptimizer = t,
                    e.glslOptimizer ? Notify.log("uses glsl optimizer, use ?log=info to see shader output") : Notify.error("failed to load glsl optimizer")
                })["catch"](function(t) {
                    Notify.error(t)
                })
            }
        },
        setContextLostCallback: function(t) {
            this._contextLostCallback = t,
            this._contextLost && t()
        },
        contextLost: function() {
            Notify.log("webgl context lost"),
            this._contextLostCallback && this._contextLostCallback(),
            this._contextLost = !0,
            window.cancelAnimationFrame(this._requestID)
        },
        contextRestored: function() {
            Notify.log("webgl context restored, but not supported - reload the page")
        },
        init: function() {},
        getUpdateVisitor: function() {
            return this._updateVisitor
        },
        getState: function() {
            return this.getCamera().getRenderer().getState()
        },
        initStats: function(t) {
            var e = TimerGPU.instance(this.getGraphicContext());
            return t.getBoolean("stats") ? (this._stats = createStats(t),
            void e.setCallback(this.callbackTimerGPU.bind(this))) : void e.disable()
        },
        callbackTimerGPU: function(t, e) {
            this._stats && this._stats.rStats(e).set(t / 1e6)
        },
        getViewerStats: function() {
            return this._stats
        },
        renderingTraversal: function() {
            if (this.getScene().getSceneData() && this.getScene().getSceneData().getBound(),
            this.getCamera()) {
                var t = this._stats
                  , e = TimerGPU.instance(this.getGraphicContext())
                  , i = this.getCamera().getRenderer();
                if (t && t.rStats("cull").start(),
                i.cull(),
                t && t.rStats("cull").end(),
                e.pollQueries(),
                e.start("glframe"),
                t && t.rStats("render").start(),
                i.draw(),
                t && t.rStats("render").end(),
                e.end("glframe"),
                t) {
                    var n = i.getCullVisitor();
                    t.rStats("cullcamera").set(n._numCamera),
                    t.rStats("cullmatrixtransform").set(n._numMatrixTransform),
                    t.rStats("cullprojection").set(n._numProjection),
                    t.rStats("cullnode").set(n._numNode),
                    t.rStats("cullightsource").set(n._numLightSource),
                    t.rStats("cullgeometry").set(n._numGeometry),
                    t.rStats("pushstateset").set(i.getState()._numPushStateSet)
                }
            }
        },
        updateTraversal: function() {
            var t = this._stats;
            t && t.rStats("update").start(),
            this._updateVisitor.resetStats(),
            this.getScene().updateSceneGraph(this._updateVisitor),
            t && t.rStats("updatecallback").set(this._updateVisitor._numUpdateCallback),
            this.getDatabasePager().releaseGLExpiredSubgraphs(.005),
            this.flushDeletedGLObjects(.005),
            t && t.rStats("update").end()
        },
        advance: function(t) {
            var e = t;
            void 0 === e && (e = Number.MAX_VALUE);
            var i = this._frameStamp
              , n = i.getFrameNumber();
            i.setFrameNumber(n + 1);
            var r = Timer.instance().deltaS(this._startTick, Timer.instance().tick());
            i.setReferenceTime(r);
            var a = i.getSimulationTime();
            i.setSimulationTime(e === Number.MAX_VALUE ? r : e),
            i.setDeltaTime(i.getSimulationTime() - a)
        },
        beginFrame: function() {
            var t = this._stats;
            t && (t.rStats("frame").start(),
            t.glS.start(),
            t.rStats("rAF").tick(),
            t.rStats("FPS").frame())
        },
        endFrame: function() {
            var t = this.getFrameStamp().getFrameNumber()
              , e = this._stats
              , i = e ? e.rStats : void 0;
            i && (Texture.getTextureManager(this.getGraphicContext()).updateStats(t, i),
            i("frame").end(),
            i("rStats").start(),
            i().update(),
            i("rStats").end())
        },
        checkNeedToDoFrame: function() {
            return this._requestContinousUpdate || this._requestRedraw
        },
        frame: function() {
            if (!this._contextLost) {
                this.beginFrame(),
                this.advance();
                var t = this.updateViewport();
                this.updateEventProxy(this._eventProxy, this.getFrameStamp()),
                this._updateVisitor.setFrameStamp(this.getFrameStamp()),
                this.getManipulator() && (this.getManipulator().update(this._updateVisitor),
                mat4.copy(this.getCamera().getViewMatrix(), this.getManipulator().getInverseMatrix())),
                (this.checkNeedToDoFrame() || t) && (this._requestRedraw = !1,
                this.updateTraversal(),
                this.renderingTraversal()),
                this.endFrame(),
                this._hmd && this._hmd.isPresenting && this._hmd.submitFrame()
            }
        },
        setDone: function(t) {
            this._done = t
        },
        done: function() {
            return this._done
        },
        _runImplementation: function() {
            var t = this
              , e = function() {
                t.done() || (t._requestID = t._requestAnimationFrame(e, t.getGraphicContext().canvas),
                t.frame())
            };
            e()
        },
        run: function() {
            var t = this;
            this._runPromise.then(function() {
                t._runImplementation()
            })["catch"](function() {
                t._runImplementation()
            })
        },
        setVRDisplay: function(t) {
            this._hmd = t,
            this._requestAnimationFrame = t.requestAnimationFrame.bind(t)
        },
        getVRDisplay: function() {
            return this._hmd
        },
        setPresentVR: function(t) {
            if (!this._hmd)
                return Notify.warn("no hmd device provided to the viewer!"),
                P.reject();
            if (this._hmd.capabilities.hasPosition || this._hmd.resetPose(),
            !this._hmd.capabilities.canPresent)
                return P.reject();
            if (t) {
                var e = [{
                    source: this.getGraphicContext().canvas
                }];
                return this._hmd.requestPresent(e)
            }
            return this._hmd.exitPresent()
        },
        setupManipulator: function(t) {
            void 0 === t && (t = new OrbitManipulator),
            void 0 !== t.setNode ? t.setNode(this.getSceneData()) : t.view = this,
            t.setCamera(this.getCamera()),
            this.setManipulator(t)
        },
        updateViewport: function() {
            var t = this.getGraphicContext()
              , e = t.canvas
              , i = this.computeCanvasSize(e);
            if (!i)
                return !1;
            var n = this.getCamera()
              , r = n.getViewport()
              , a = r.width()
              , s = r.height()
              , o = e.width / a
              , u = e.height / s
              , l = o / u;
            return r.setViewport(Math.round(r.x() * o), Math.round(r.y() * u), Math.round(r.width() * o), Math.round(r.height() * u)),
            1 !== l && mat4.mul(n.getProjectionMatrix(), n.getProjectionMatrix(), mat4.fromScaling(mat4.create(), [1 / l, 1, 1])),
            !0
        },
        initEventProxy: function(t) {
            for (var e = t || {}, i = {}, n = EventProxy, r = e.EventBackend, a = window.Object.keys(n), s = 0, o = a.length; s < o; s++) {
                var u = a[s]
                  , l = !0
                  , c = {};
                if (r && void 0 !== r[u]) {
                    var h = r[u].enable;
                    l = void 0 === h || h,
                    c = r[u]
                }
                var d = new Options;
                if (d.extend(c).extend(t),
                delete d.EventBackend,
                l) {
                    var p = new n[u](this);
                    p.init(d),
                    i[u] = p
                }
            }
            return i
        },
        updateEventProxy: function(t, e) {
            var i = window.Object.keys(t);
            i.forEach(function(i) {
                var n = t[i];
                n.update && n.update(e)
            })
        },
        setManipulator: function(t) {
            this._manipulator && this.removeEventProxy(),
            t.getCamera() || t.setCamera(this.getCamera()),
            View.prototype.setManipulator.call(this, t)
        },
        removeEventProxy: function() {
            var t = this._eventProxy
              , e = window.Object.keys(t);
            e.forEach(function(e) {
                var i = t[e];
                i.remove && i.remove()
            })
        },
        getEventProxy: function() {
            return this._eventProxy
        }
    }),
    module.exports = Viewer
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = {
        antialias: !0,
        fullscreen: !0,
        enableFrustumCulling: !1,
        stats: !1,
        scrollwheel: !0,
        webgl2: !1
    }
      , a = function() {
        window.Object.keys(r).forEach(function(t) {
            this[t] = r[t]
        }
        .bind(this))
    };
    a.prototype = {
        extend: function(t) {
            return n.objectMix(this, t),
            this
        },
        get: function(t) {
            return this[t]
        },
        getBoolean: function(t) {
            var e = this.getString(t);
            if (e)
                return "false" !== e && "0" !== e
        },
        getNumber: function(t) {
            var e = this[t];
            if (e)
                return Number(e)
        },
        getString: function(t) {
            var e = this[t];
            if (void 0 !== e)
                return this[t].toString()
        }
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = window.BrowserStats
      , a = window.glStats
      , s = window.rStats
      , o = function(t) {
        this.bS = new r,
        this.glS = new a;
        var e = {
            frame: {
                caption: "Total frame time (ms)",
                over: 16,
                average: !0
            },
            fps: {
                caption: "Framerate (FPS)",
                below: 30
            },
            calls: {
                caption: "Calls (three.js)",
                over: 3e3
            },
            raf: {
                caption: "Time since last rAF (ms)",
                average: !0,
                avgMs: 500
            },
            rstats: {
                caption: "rStats update (ms)",
                average: !0,
                avgMs: 100
            },
            update: {
                caption: "update",
                average: !0
            },
            cull: {
                caption: "cull",
                average: !0
            },
            render: {
                caption: "render",
                average: !0
            },
            glframe: {
                caption: "glframe",
                average: !0
            },
            textureused: {
                caption: "texture used"
            },
            texturereserved: {
                caption: "texture reserved"
            },
            texturetotal: {
                caption: "texture total"
            },
            pushstateset: {
                caption: "num pushStateSet"
            },
            updatecallback: {
                caption: "num updateCallback"
            },
            cullcamera: {
                caption: "camera"
            },
            cullmatrixtransform: {
                caption: "matrixTransform"
            },
            cullprojection: {
                caption: "projection"
            },
            cullnode: {
                caption: "node"
            },
            culllightsource: {
                caption: "lightSource"
            },
            cullgeometry: {
                caption: "geometry"
            }
        }
          , i = [{
            base: "frame",
            steps: ["update", "cull", "render"]
        }]
          , o = [{
            caption: "Framerate",
            values: ["fps", "raf"]
        }, {
            caption: "Frame Budget",
            values: ["frame", "update", "cull", "render", "glframe"]
        }, {
            caption: "Scene Graph",
            values: ["pushstateset", "updatecallback"]
        }, {
            caption: "Cull",
            values: ["cullnode", "cullmatrixtransform", "cullgeometry", "cullcamera", "culllighsource", "cullprojection"]
        }, {
            caption: "Texture Memory",
            values: ["texturereserved", "textureused", "texturetotal"]
        }]
          , u = [this.bS, this.glS];
        t && (t.values && n.objectMix(e, t.values),
        t.groups && Array.prototype.unshift.apply(o, t.groups),
        t.fractions && Array.prototype.push.apply(i, t.fractions),
        t.plugins && Array.prototype.push.apply(u, t.plugins)),
        this.rStats = new s({
            values: e,
            groups: o,
            fractions: i,
            plugins: u,
            colours: ["#cc9933", "#f20041", "#69818c", "#d90074", "#b6f2ee", "#660044", "#50664d", "#330022", "#f2eeb6", "#ee00ff", "#806460", "#1600a6", "#994d57", "#00004d", "#f279da", "#002933", "#395073", "#00eeff", "#79baf2", "#008066", "#79f2aa", "#00ff66", "#1a331d", "#004d14", "#8c6c46", "#388c00", "#602080", "#ff8800", "#6d3df2", "#995200", "#0d1233", "#402200", "#3d6df2", "#330e00", "#e6f23d", "#730000"]
        })
    }
      , u = function(t) {
        if (s) {
            var e = ".rs-base{ position: absolute; z-index: 10000; padding: 10px; background-color: #222; font-size: 12px; line-height: 1.2em; width: 350px; font-family: 'Roboto Condensed', tahoma, sans-serif; left: 0; top: 0; overflow: hidden; } .rs-base h1{ margin: 0; padding: 0; font-size: 1.4em; color: #fff; margin-bottom: 5px; cursor: pointer; } .rs-base div.rs-group{ margin-bottom: 10px; } .rs-base div.rs-group.hidden{ display: none; } .rs-base div.rs-fraction{ position: relative; margin-bottom: 5px; } .rs-base div.rs-fraction p{ width: 145px; text-align: right; margin: 0; padding: 0; } .rs-base div.rs-legend{ position: absolute; line-height: 1em; } .rs-base div.rs-counter-base{ position: relative; margin: 2px 0; height: 1em; } .rs-base span.rs-counter-id{ position: absolute; left: 0; top: 0; } .rs-base div.rs-counter-value{ position: absolute; left: 115px; width: 30px; height: 1em; top: 0; text-align: right; } .rs-base canvas.rs-canvas{ position: absolute; right: 0; } "
              , i = document.head || document.getElementsByTagName("head")[0]
              , n = document.createElement("style");
            return n.type = "text/css",
            n.styleSheet ? n.styleSheet.cssText = e : n.appendChild(document.createTextNode(e)),
            i.appendChild(n),
            new o(t.rstats)
        }
    };
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1435)
      , r = i(1436)
      , a = i(1437)
      , s = i(1439)
      , o = i(1440)
      , u = i(1442);
    t.exports = {
        GamePad: n,
        Hammer: r,
        LeapMotion: a,
        StandardMouseKeyboard: s,
        WebVR: o,
        DeviceOrientation: u
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = function(t) {
        this._viewer = t,
        this._type = "GamePad",
        this._enable = !0,
        this._gamepadIndex = -1
    };
    r.prototype = {
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function() {},
        isValid: function() {
            if (!this._enable)
                return !1;
            var t = this._viewer.getManipulator();
            if (!t)
                return !1;
            var e = t.getControllerList();
            return !!e[this._type]
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        gamepadPoll: function() {
            if (!navigator.getGamepads)
                return null;
            var t = navigator.getGamepads()
              , e = t[this._gamepadIndex];
            if (e)
                return e;
            for (var i = 0, n = t.length; i < n; ++i) {
                var r = t[i];
                if (r && r.id && r.id.indexOf("Unknown Gamepad") === -1)
                    return this._gamepadIndex = i,
                    this.onGamepadConnect(r),
                    r
            }
            return this._gamepadIndex >= 0 && (this._gamepadIndex = -1,
            this.onGamepadConnect()),
            null
        },
        onGamepadConnect: function(t) {
            n.log("Detected new gamepad!", t)
        },
        onGamepadDisconnect: function() {
            n.log("Gamepad disconnected")
        },
        update: function() {
            if (this.isValid()) {
                var t = this.gamepadPoll();
                if (t) {
                    var e = this.getManipulatorController();
                    e.update && e.update(t)
                }
            }
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(283)
      , r = function(t) {
        this._enable = !0,
        this._viewer = t,
        this._type = "Hammer",
        this._eventNode = void 0
    };
    r.prototype = {
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function(t) {
            var e = {
                prevent_default: !0,
                drag_max_touches: 2,
                transform_min_scale: .08,
                transform_min_rotation: 180,
                transform_always_block: !0,
                hold: !1,
                release: !1,
                swipe: !1,
                tap: !1
            };
            this._eventNode = t.eventNode,
            this._eventNode && (this._hammer = new n(this._eventNode,e),
            t.getBoolean("scrollwheel") === !1 ? this._hammer.get("pinch").set({
                enable: !1
            }) : this._hammer.get("pinch").set({
                enable: !0
            }))
        },
        isValid: function() {
            return !!(this._enable && this._viewer.getManipulator() && this._viewer.getManipulator().getControllerList()[this._type])
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        update: function() {
            this.isValid() && this.getManipulatorController().setEventProxy(this._hammer)
        },
        remove: function() {
            this.isValid() && this.getManipulatorController().removeEventProxy(this._hammer)
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1438)
      , r = i(1207)
      , a = function(t) {
        this._viewer = t,
        this._type = "LeapMotion",
        this._enable = !0
    };
    a.prototype = {
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function(t) {
            if ("undefined" != typeof n && n.Controller) {
                var e = this;
                this._controller = new n.Controller({
                    enableGestures: t.gestures || !0,
                    tryReconnectOnDisconnect: !0,
                    connectAttempts: 3
                }),
                this._controller.on("ready", function() {
                    t.readyCallback && t.readyCallback(e._controller),
                    e._leapMotionReady = !0,
                    r.info("leapmotion ready")
                }),
                this._controller.loop(this._update.bind(this))
            }
        },
        isValid: function() {
            if (!this._enable)
                return !1;
            var t = this._viewer.getManipulator();
            if (!t)
                return !1;
            var e = t.getControllerList();
            return !!e[this._type]
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        _update: function(t) {
            if (t.valid && this.isValid()) {
                var e = this.getManipulatorController();
                e.update && e.update(t)
            }
        }
    },
    t.exports = a
}
, function(t, e) {
    t.exports = {}
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).vec2
      , r = function(t) {
        this._enable = !0,
        this._viewer = t,
        this._type = "StandardMouseKeyboard",
        this._mouseEventNode = void 0,
        this._wheelEventNode = void 0,
        this._keyboardEventNode = void 0,
        this._eventList = ["mousedown", "mouseup", "mouseout", "mousemove", "dblclick"],
        this._mousePosition = n.create()
    };
    r.prototype = {
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function(t) {
            this.removeEventListeners(this._mouseEventNode, this._wheelEventNode, this._keyboardEventNode);
            var e = t.mouseEventNode
              , i = t.wheelEventNode || e
              , n = t.keyboardEventNode || e;
            t.getBoolean("scrollwheel") === !1 && (i = null),
            this.addEventListeners(e, i, n),
            this._mouseEventNode = e,
            this._wheelEventNode = i,
            this._keyboardEventNode = n
        },
        addEventListeners: function(t, e, i) {
            if (t)
                for (var n = 0, r = this._eventList.length; n < r; n++) {
                    var a = this._eventList[n];
                    this[a] && t.addEventListener(a, this[a].bind(this), !1)
                }
            e && (e.addEventListener("DOMMouseScroll", this.mousewheel.bind(this), !1),
            e.addEventListener("mousewheel", this.mousewheel.bind(this), !1),
            e.addEventListener("MozMousePixelScroll", this.preventDefault.bind(this), !1)),
            i && (i.addEventListener("keydown", this.keydown.bind(this), !1),
            i.addEventListener("keyup", this.keyup.bind(this), !1))
        },
        removeEventListeners: function(t, e, i) {
            if (t)
                for (var n = 0, r = this._eventList.length; n < r; n++) {
                    var a = this._eventList[n];
                    this[a] && t.removeEventListener(a, this[a])
                }
            e && (e.removeEventListener("DOMMouseScroll", this.mousewheel),
            e.removeEventListener("mousewheel", this.mousewheel),
            e.removeEventListener("MozMousePixelScroll", this.preventDefault)),
            i && (i.removeEventListener("keydown", this.keydown),
            i.removeEventListener("keyup", this.keyup))
        },
        isValid: function() {
            return !!(this._enable && this._viewer.getManipulator() && this._viewer.getManipulator().getControllerList()[this._type])
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        keyup: function(t) {
            if (this.isValid() && this.getManipulatorController().keyup)
                return this.getManipulatorController().keyup(t)
        },
        keydown: function(t) {
            if (this.isValid() && this.getManipulatorController().keydown)
                return this.getManipulatorController().keydown(t)
        },
        mousedown: function(t) {
            if (this.isValid() && this.getManipulatorController().mousedown)
                return this.getManipulatorController().mousedown(t)
        },
        mouseup: function(t) {
            if (this.isValid() && this.getManipulatorController().mouseup)
                return this.getManipulatorController().mouseup(t)
        },
        mouseout: function(t) {
            if (this.isValid() && this.getManipulatorController().mouseout)
                return this.getManipulatorController().mouseout(t)
        },
        mousemove: function(t) {
            if (this.isValid() && this.getManipulatorController().mousemove)
                return this.getManipulatorController().mousemove(t)
        },
        dblclick: function(t) {
            if (this.isValid() && this.getManipulatorController().dblclick)
                return this.getManipulatorController().dblclick(t)
        },
        mousewheel: function(t) {
            if (this.isValid()) {
                var e = this.getManipulatorController();
                if (e.mousewheel) {
                    var i = t || window.event
                      , n = [].slice.call(arguments, 1)
                      , r = 0
                      , a = 0
                      , s = 0;
                    return t.wheelDelta && (r = t.wheelDelta / 120),
                    t.detail && (r = -t.detail / 3),
                    s = r,
                    void 0 !== i.axis && i.axis === i.HORIZONTAL_AXIS && (s = 0,
                    a = -1 * r),
                    void 0 !== i.wheelDeltaY && (s = i.wheelDeltaY / 120),
                    void 0 !== i.wheelDeltaX && (a = -1 * i.wheelDeltaX / 120),
                    n.unshift(t, r, a, s),
                    this.getManipulatorController().mousewheel.apply(e, n)
                }
            }
        },
        preventDefault: function(t) {
            t.preventDefault()
        },
        divGlobalOffset: function(t) {
            var e = 0
              , i = 0;
            e = t.offsetLeft,
            i = t.offsetTop;
            for (var n = document.getElementsByTagName("body")[0]; t.offsetParent && t !== n; )
                e += t.offsetParent.offsetLeft,
                i += t.offsetParent.offsetTop,
                t = t.offsetParent;
            return this._mousePosition[0] = e,
            this._mousePosition[1] = i,
            this._mousePosition
        },
        getPositionRelativeToCanvas: function(t, e) {
            var i, n, r = t.target;
            t.pageX || t.pageY ? (i = t.pageX,
            n = t.pageY) : (t.clientX || t.clientY) && (i = t.clientX + document.body.scrollLeft + document.documentElement.scrollLeft,
            n = t.clientY + document.body.scrollTop + document.documentElement.scrollTop);
            var a = this.divGlobalOffset(r);
            return i -= a[0],
            n = r.height - (n - a[1]),
            void 0 === e && (e = this._mousePosition),
            e[0] = i,
            e[1] = n,
            e
        },
        update: function() {
            this.isValid() && this.getManipulatorController().setEventProxy(this)
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1212).quat
      , a = i(1212).vec3
      , s = i(1212).mat4;
    i(1441);
    var o = function(t) {
        this._viewer = t,
        this._type = "WebVR",
        this._enable = !1,
        this._hmd = void 0,
        this._sensor = void 0,
        this._frameData = void 0,
        this._quat = r.create(),
        this._pos = a.create(),
        this._worldScale = 1
    };
    o.prototype = {
        setWorldScale: function(t) {
            this._worldScale = t
        },
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function() {
            if (navigator.getVRDisplays) {
                var t = this;
                navigator.getVRDisplays().then(function(e) {
                    e.length > 0 && (t._hmd = e[0],
                    t._frameData = new window.VRFrameData,
                    n.log("Found a VR display"),
                    t._viewer.setVRDisplay(t._hmd))
                })
            }
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        isValid: function() {
            if (!this._enable)
                return !1;
            var t = this._viewer.getManipulator();
            return !!t && (!!t.getControllerList()[this._type] && !!this._hmd)
        },
        update: function() {
            var t = r.create()
              , e = a.create();
            return function() {
                if (this.isValid()) {
                    var i = this.getManipulatorController();
                    if (i.update && (this._hmd.capabilities.hasOrientation || this._hmd.capabilities.hasPosition)) {
                        this._hmd.getFrameData(this._frameData);
                        var n = this._frameData.pose;
                        if (n) {
                            var o = this._hmd.stageParameters && this._hmd.stageParameters.sittingToStandingTransform
                              , u = n.orientation;
                            u && (o && (u = s.getRotation(t, o),
                            r.mul(u, u, n.orientation)),
                            this._quat[0] = u[0],
                            this._quat[1] = -u[2],
                            this._quat[2] = u[1],
                            this._quat[3] = u[3]);
                            var l = n.position;
                            l && (o && (l = a.transformMat4(e, l, o)),
                            this._pos[0] = l[0] * this._worldScale,
                            this._pos[1] = -l[2] * this._worldScale,
                            this._pos[2] = l[1] * this._worldScale),
                            i.update(this._quat, this._pos)
                        }
                    }
                }
            }
        }(),
        getHmd: function() {
            return this._hmd
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1212).mat4;
    "getVRDisplays"in navigator && ("depthNear"in window.VRDisplay.prototype || (window.VRDisplay.prototype.depthNear = .01),
    "depthFar"in window.VRDisplay.prototype || (window.VRDisplay.prototype.depthFar = 1e4),
    "VRFrameData"in window || (window.VRFrameData = function() {
        this.leftProjectionMatrix = new Float32Array(16),
        this.leftViewMatrix = new Float32Array(16),
        this.rightProjectionMatrix = new Float32Array(16),
        this.rightViewMatrix = new Float32Array(16),
        this.pose = null
    }
    ,
    window.VRDisplay.prototype.getFrameData = function() {
        function t(t, r, a, s, o) {
            n.perspectiveFromFieldOfView(t, s.fieldOfView, o.depthNear, o.depthFar);
            var u = a.orientation
              , l = a.position;
            u || (u = e),
            l || (l = i),
            n.fromRotationTranslation(r, u, l),
            n.translate(r, r, s.offset),
            n.invert(r, r)
        }
        var e = new Float32Array([0, 0, 0, 1])
          , i = new Float32Array([0, 0, 0]);
        return function(e) {
            var i = this.getPose();
            return !!i && (e.pose = i,
            e.timestamp = i.timestamp,
            t(e.leftProjectionMatrix, e.leftViewMatrix, i, this.getEyeParameters("left"), this),
            t(e.rightProjectionMatrix, e.rightViewMatrix, i, this.getEyeParameters("right"), this),
            !0)
        }
    }()))
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        this._viewer = t,
        this._type = "DeviceOrientation",
        this._enable = !1,
        this._deviceOrientation = void 0,
        this._screenOrientation = window.orientation || 90
    };
    i.prototype = {
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function() {
            var t = this;
            window.addEventListener("deviceorientation", function(e) {
                null !== e.alpha && void 0 !== e.alpha && (t._deviceOrientation = e)
            }, !1),
            window.addEventListener("orientationchange", function() {
                null !== window.orientation && void 0 !== window.orientation && (t._screenOrientation = window.orientation)
            }, !1)
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        isValid: function() {
            if (!this._enable)
                return !1;
            if (!this._deviceOrientation)
                return !1;
            var t = this._viewer.getManipulator();
            return !!t && !!t.getControllerList()[this._type]
        },
        update: function() {
            if (this.isValid()) {
                var t = this.getManipulatorController();
                t.update && t.update(this._deviceOrientation, this._screenOrientation)
            }
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = function() {
        function t(t) {
            if (null === h) {
                h = {};
                for (var e in t)
                    "number" == typeof t[e] && (h[t[e]] = e)
            }
        }
        function e() {
            if (null === h)
                throw "WebGLDebugUtils.init(ctx) not called"
        }
        function i(t) {
            return e(),
            void 0 !== h[t]
        }
        function r(t) {
            e();
            var i = h[t];
            return void 0 !== i ? i : "*UNKNOWN WebGL ENUM (0x" + t.toString(16) + ")"
        }
        function a(t, e, i) {
            var n = c[t];
            return void 0 !== n && n[e] ? r(i) : i.toString()
        }
        function s(t, e, i) {
            t.__defineGetter__(i, function() {
                return e[i]
            }),
            t.__defineSetter__(i, function(t) {
                e[i] = t
            })
        }
        function o(e, i) {
            function o(t, e) {
                return function() {
                    var n = t[e].apply(t, arguments)
                      , r = t.getError();
                    return 0 !== r && (u[r] = !0,
                    i(r, e, arguments)),
                    n
                }
            }
            t(e),
            i = i || function(t, e, i) {
                for (var s = "", o = 0; o < i.length; ++o)
                    s += (0 === o ? "" : ", ") + a(e, o, i[o]);
                n.log("WebGL error " + r(t) + " in " + e + "(" + s + ")")
            }
            ;
            var u = {}
              , l = {};
            for (var c in e)
                "function" == typeof e[c] ? l[c] = o(e, c) : s(l, e, c);
            return l.getError = function() {
                for (var t in u)
                    if (u[t])
                        return u[t] = !1,
                        t;
                return e.NO_ERROR
            }
            ,
            l
        }
        function u(t) {
            var e = t.getParameter(t.MAX_VERTEX_ATTRIBS)
              , i = t.createBuffer();
            t.bindBuffer(t.ARRAY_BUFFER, i);
            var n;
            for (n = 0; n < e; ++n)
                t.disableVertexAttribArray(n),
                t.vertexAttribPointer(n, 4, t.FLOAT, !1, 0, 0),
                t.vertexAttrib1f(n, 0);
            t.deleteBuffer(i);
            var r = t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);
            for (n = 0; n < r; ++n)
                t.activeTexture(t.TEXTURE0 + n),
                t.bindTexture(t.TEXTURE_CUBE_MAP, null),
                t.bindTexture(t.TEXTURE_2D, null);
            for (t.activeTexture(t.TEXTURE0),
            t.useProgram(null),
            t.bindBuffer(t.ARRAY_BUFFER, null),
            t.bindBuffer(t.ELEMENT_ARRAY_BUFFER, null),
            t.bindFramebuffer(t.FRAMEBUFFER, null),
            t.bindRenderbuffer(t.RENDERBUFFER, null),
            t.disable(t.BLEND),
            t.disable(t.CULL_FACE),
            t.disable(t.DEPTH_TEST),
            t.disable(t.DITHER),
            t.disable(t.SCISSOR_TEST),
            t.blendColor(0, 0, 0, 0),
            t.blendEquation(t.FUNC_ADD),
            t.blendFunc(t.ONE, t.ZERO),
            t.clearColor(0, 0, 0, 0),
            t.clearDepth(1),
            t.clearStencil(-1),
            t.colorMask(!0, !0, !0, !0),
            t.cullFace(t.BACK),
            t.depthFunc(t.LESS),
            t.depthMask(!0),
            t.depthRange(0, 1),
            t.frontFace(t.CCW),
            t.hint(t.GENERATE_MIPMAP_HINT, t.DONT_CARE),
            t.lineWidth(1),
            t.pixelStorei(t.PACK_ALIGNMENT, 4),
            t.pixelStorei(t.UNPACK_ALIGNMENT, 4),
            t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL, !1),
            t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !1),
            t.UNPACK_COLORSPACE_CONVERSION_WEBGL && t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL, t.BROWSER_DEFAULT_WEBGL),
            t.polygonOffset(0, 0),
            t.sampleCoverage(1, !1),
            t.scissor(0, 0, t.canvas.width, t.canvas.height),
            t.stencilFunc(t.ALWAYS, 0, 4294967295),
            t.stencilMask(4294967295),
            t.stencilOp(t.KEEP, t.KEEP, t.KEEP),
            t.viewport(0, 0, t.canvas.width, t.canvas.height),
            t.clear(t.COLOR_BUFFER_BIT | t.DEPTH_BUFFER_BIT | t.STENCIL_BUFFER_BIT); t.getError(); )
                ;
        }
        function l(t) {
            function e(t) {
                return "function" == typeof t ? t : function(e) {
                    t.handleEvent(e)
                }
            }
            function i(t) {
                var e = t.addEventListener;
                t.addEventListener = function(i, n, r) {
                    switch (i) {
                    case "webglcontextlost":
                        S(n);
                        break;
                    case "webglcontextrestored":
                        C(n);
                        break;
                    default:
                        e.apply(t, arguments)
                    }
                }
            }
            function n() {
                for (var t = window.Object.keys(y), e = 0; e < t.length; ++e)
                    delete y[t]
            }
            function r() {
                ++b,
                m || _ == b && t.loseContext()
            }
            function a(t, e) {
                var i = t[e];
                return function() {
                    if (r(),
                    !m) {
                        var e = i.apply(t, arguments);
                        return e
                    }
                }
            }
            function o() {
                for (var t = 0; t < v.length; ++t) {
                    var e = v[t];
                    e instanceof WebGLBuffer ? h.deleteBuffer(e) : e instanceof WebGLFramebuffer ? h.deleteFramebuffer(e) : e instanceof WebGLProgram ? h.deleteProgram(e) : e instanceof WebGLRenderbuffer ? h.deleteRenderbuffer(e) : e instanceof WebGLShader ? h.deleteShader(e) : e instanceof WebGLTexture && h.deleteTexture(e)
                }
            }
            function l(t) {
                return {
                    statusMessage: t,
                    preventDefault: function() {
                        x = !0
                    }
                }
            }
            function c(t) {
                for (var e in t)
                    "function" == typeof t[e] ? f[e] = a(t, e) : s(f, t, e);
                f.getError = function() {
                    r();
                    var t;
                    if (!m)
                        for (; t = h.getError(); )
                            y[t] = !0;
                    for (t in y)
                        if (y[t])
                            return delete y[t],
                            t;
                    return f.NO_ERROR
                }
                ;
                var i, n, o = ["createBuffer", "createFramebuffer", "createProgram", "createRenderbuffer", "createShader", "createTexture"];
                for (n = 0; n < o.length; ++n)
                    i = o[n],
                    f[i] = function(e) {
                        return function() {
                            if (r(),
                            m)
                                return null;
                            var i = e.apply(t, arguments);
                            return i.__webglDebugContextLostId__ = g,
                            v.push(i),
                            i
                        }
                    }(t[i]);
                var u = ["getActiveAttrib", "getActiveUniform", "getBufferParameter", "getContextAttributes", "getAttachedShaders", "getFramebufferAttachmentParameter", "getParameter", "getProgramParameter", "getProgramInfoLog", "getRenderbufferParameter", "getShaderParameter", "getShaderInfoLog", "getShaderSource", "getTexParameter", "getUniform", "getUniformLocation", "getVertexAttrib"];
                for (n = 0; n < u.length; ++n)
                    i = u[n],
                    f[i] = function(e) {
                        return function() {
                            return r(),
                            m ? null : e.apply(t, arguments)
                        }
                    }(f[i]);
                var l = ["isBuffer", "isEnabled", "isFramebuffer", "isProgram", "isRenderbuffer", "isShader", "isTexture"];
                for (n = 0; n < l.length; ++n)
                    i = l[n],
                    f[i] = function(e) {
                        return function() {
                            return r(),
                            !m && e.apply(t, arguments)
                        }
                    }(f[i]);
                return f.checkFramebufferStatus = function(e) {
                    return function() {
                        return r(),
                        m ? f.FRAMEBUFFER_UNSUPPORTED : e.apply(t, arguments)
                    }
                }(f.checkFramebufferStatus),
                f.getAttribLocation = function(e) {
                    return function() {
                        return r(),
                        m ? -1 : e.apply(t, arguments)
                    }
                }(f.getAttribLocation),
                f.getVertexAttribOffset = function(e) {
                    return function() {
                        return r(),
                        m ? 0 : e.apply(t, arguments)
                    }
                }(f.getVertexAttribOffset),
                f.isContextLost = function() {
                    return m
                }
                ,
                f
            }
            var h, d = [], p = [], f = {}, g = 1, m = !1, v = [], _ = 0, b = 0, x = !1, A = 0, y = {};
            t.getContext = function(e) {
                return function() {
                    var i = e.apply(t, arguments);
                    if (i instanceof WebGLRenderingContext) {
                        if (i != h) {
                            if (h)
                                throw "got different context";
                            h = i,
                            f = c(h)
                        }
                        return f
                    }
                    return i
                }
            }(t.getContext);
            var S = function(t) {
                d.push(e(t))
            }
              , C = function(t) {
                p.push(e(t))
            };
            return i(t),
            t.loseContext = function() {
                if (!m) {
                    for (m = !0,
                    _ = 0,
                    ++g; h.getError(); )
                        ;
                    n(),
                    y[h.CONTEXT_LOST_WEBGL] = !0;
                    var e = l("context lost")
                      , i = d.slice();
                    setTimeout(function() {
                        for (var n = 0; n < i.length; ++n)
                            i[n](e);
                        A >= 0 && setTimeout(function() {
                            t.restoreContext()
                        }, A)
                    }, 0)
                }
            }
            ,
            t.restoreContext = function() {
                m && p.length && setTimeout(function() {
                    if (!x)
                        throw "can not restore. webglcontestlost listener did not call event.preventDefault";
                    o(),
                    u(h),
                    m = !1,
                    b = 0,
                    x = !1;
                    for (var t = p.slice(), e = l("context restored"), i = 0; i < t.length; ++i)
                        t[i](e)
                }, 0)
            }
            ,
            t.loseContextInNCalls = function(t) {
                if (m)
                    throw "You can not ask a lost contet to be lost";
                _ = b + t
            }
            ,
            t.getNumCalls = function() {
                return b
            }
            ,
            t.setRestoreTimeout = function(t) {
                A = t
            }
            ,
            t
        }
        var c = {
            enable: {
                0: !0
            },
            disable: {
                0: !0
            },
            getParameter: {
                0: !0
            },
            drawArrays: {
                0: !0
            },
            drawElements: {
                0: !0,
                2: !0
            },
            createShader: {
                0: !0
            },
            getShaderParameter: {
                1: !0
            },
            getProgramParameter: {
                1: !0
            },
            getVertexAttrib: {
                1: !0
            },
            vertexAttribPointer: {
                2: !0
            },
            bindTexture: {
                0: !0
            },
            activeTexture: {
                0: !0
            },
            getTexParameter: {
                0: !0,
                1: !0
            },
            texParameterf: {
                0: !0,
                1: !0
            },
            texParameteri: {
                0: !0,
                1: !0,
                2: !0
            },
            texImage2D: {
                0: !0,
                2: !0,
                6: !0,
                7: !0
            },
            texSubImage2D: {
                0: !0,
                6: !0,
                7: !0
            },
            copyTexImage2D: {
                0: !0,
                2: !0
            },
            copyTexSubImage2D: {
                0: !0
            },
            generateMipmap: {
                0: !0
            },
            bindBuffer: {
                0: !0
            },
            bufferData: {
                0: !0,
                2: !0
            },
            bufferSubData: {
                0: !0
            },
            getBufferParameter: {
                0: !0,
                1: !0
            },
            pixelStorei: {
                0: !0,
                1: !0
            },
            readPixels: {
                4: !0,
                5: !0
            },
            bindRenderbuffer: {
                0: !0
            },
            bindFramebuffer: {
                0: !0
            },
            checkFramebufferStatus: {
                0: !0
            },
            framebufferRenderbuffer: {
                0: !0,
                1: !0,
                2: !0
            },
            framebufferTexture2D: {
                0: !0,
                1: !0,
                2: !0
            },
            getFramebufferAttachmentParameter: {
                0: !0,
                1: !0,
                2: !0
            },
            getRenderbufferParameter: {
                0: !0,
                1: !0
            },
            renderbufferStorage: {
                0: !0,
                1: !0
            },
            clear: {
                0: !0
            },
            depthFunc: {
                0: !0
            },
            blendFunc: {
                0: !0,
                1: !0
            },
            blendFuncSeparate: {
                0: !0,
                1: !0,
                2: !0,
                3: !0
            },
            blendEquation: {
                0: !0
            },
            blendEquationSeparate: {
                0: !0,
                1: !0
            },
            stencilFunc: {
                0: !0
            },
            stencilFuncSeparate: {
                0: !0,
                1: !0
            },
            stencilMaskSeparate: {
                0: !0
            },
            stencilOp: {
                0: !0,
                1: !0,
                2: !0
            },
            stencilOpSeparate: {
                0: !0,
                1: !0,
                2: !0,
                3: !0
            },
            cullFace: {
                0: !0
            },
            frontFace: {
                0: !0
            }
        }
          , h = null;
        return {
            init: t,
            mightBeEnum: i,
            glEnumToString: r,
            glFunctionArgToString: a,
            makeDebugContext: o,
            makeLostContextSimulatingCanvas: l,
            resetToInitialState: u
        }
    }();
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1445)
      , r = i(1380)
      , a = i(1379)
      , s = i(1446)
      , o = i(1447)
      , u = i(1448)
      , l = i(1449)
      , c = i(1452)
      , h = i(1450)
      , d = i(1451)
      , p = i(1453)
      , f = {};
    f.ShadowCastAttribute = n,
    f.ShadowCastCompiler = r,
    f.ShadowReceiveAttribute = l,
    f.ShadowCasterVisitor = s,
    f.ShadowFrustumIntersection = o,
    f.ShadowMap = u,
    f.ShadowedScene = p,
    f.ShadowSettings = c,
    f.ShadowCastShaderGenerator = a,
    f.ShadowTechnique = h,
    f.ShadowTexture = d,
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = function(t, e) {
        r.call(this),
        this._enable = !t,
        this._shadowReceiveAttribute = e
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "ShadowCast",
        cloneType: function() {
            return new a((!0))
        },
        setReceiveAttribute: function(t) {
            this._shadowReceiveAttribute = t
        },
        getReceiveAttribute: function() {
            return this._shadowReceiveAttribute
        },
        getDefines: function() {
            if (this._shadowReceiveAttribute)
                return this._shadowReceiveAttribute.getDefines()
        },
        getAlgorithm: function() {
            if (this._shadowReceiveAttribute)
                return this._shadowReceiveAttribute.getAlgorithm()
        },
        getHash: function() {
            return "ShadowCast" + this._enable + this._shadowReceiveAttribute.getAlgorithm() + this._shadowReceiveAttribute.getPrecision()
        },
        isEnabled: function() {
            return this._enable
        }
    }), "osgShadow", "ShadowCastAttribute"),
    n.setTypeID(a),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1242)
      , r = i(1260)
      , a = i(1290)
      , s = i(1301)
      , o = i(1269)
      , u = i(1229)
      , l = i(1203)
      , c = function(t) {
        u.call(this),
        this._noCastMask = t,
        this._nodeList = []
    };
    c.prototype = l.objectLibraryClass(l.objectInherit(u.prototype, {
        reset: function() {
            this._nodeList = []
        },
        removeNodeFromCasting: function(t) {
            var e = t.getNodeMask();
            e === -1 ? (e = this._noCastMask,
            t.setNodeMask(e),
            this._nodeList.push(t)) : 0 !== (e & ~this._noCastMask) && (t.setNodeMask(e | this._noCastMask),
            this._nodeList.push(t))
        },
        apply: function(t) {
            var e = t.getStateSet();
            if (e) {
                var i = e.getAttribute("BlendFunc");
                if (void 0 !== i && i.getSource() !== n.DISABLE) {
                    var u = e.getAttribute("Depth");
                    if (u && (u.getFunc() === a.DISABLE || u.getWriteMask() === !1))
                        return void this.removeNodeFromCasting(t)
                }
            }
            return t.getTypeID() === s.typeID || t.getTypeID() === o.typeID ? void this.removeNodeFromCasting(t) : t.getTypeID() === r.typeID && t.isRenderToTextureCamera() ? void this.removeNodeFromCasting(t) : void this.traverse(t)
        },
        setNoCastMask: function(t) {
            this._noCastMask = t
        },
        restore: function() {
            for (var t = 0, e = this._nodeList.length; t < e; t++) {
                var i = this._nodeList[t]
                  , n = i.getNodeMask();
                n === this._noCastMask ? i.setNodeMask(-1) : i.setNodeMask(n & ~this._noCastMask)
            }
        }
    }), "osgShadow", "ShadowCasterVisitor"),
    l.setTypeID(c),
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(1211)
      , r = i(1225)
      , a = i(1260)
      , s = i(1234)
      , o = i(1301)
      , u = i(1212).mat4
      , l = i(1230)
      , c = i(1247)
      , h = i(1229)
      , d = i(1266)
      , p = i(1203)
      , f = function() {
        h.call(this, h.TRAVERSE_ALL_CHILDREN),
        this._matrixStack = [u.create()],
        this._reservedMatrixStack = new l,
        this._bb = new n,
        this._bs = new r
    };
    f.prototype = p.objectInherit(h.prototype, {
        reset: function(t, e, i, n, r) {
            this.setTraversalMask(t),
            this._cameraFrustum = i,
            this._lightFrustum = r,
            this.getCameraPlaneMaskForLightNear(e, i, n ? 6 : 4),
            this._reservedMatrixStack.reset(),
            this._matrixStack.length = 1,
            this._bb.init()
        },
        getBoundingBox: function() {
            return this._bb
        },
        getCameraPlaneMaskForLightNear: function(t, e, i) {
            var n, r = 1, a = 15;
            for (n = 0; n < i; ++n)
                a = a << 1 | 1;
            var s = e.getPlanes();
            for (n = 0; n < i; ++n)
                d.distanceToPlane(s[n], t) < 0 && (a ^= r),
                r <<= 1;
            return this._cameraPlaneMaskedByLightNear = a,
            e.setResultMask(a),
            e.pushCurrentMask(a),
            a
        },
        applyTransform: function(t) {
            var e = this._reservedMatrixStack.get()
              , i = this._matrixStack.length;
            u.copy(e, this._matrixStack[i - 1]),
            t.computeLocalToWorldMatrix(e, this);
            var n = this._bs;
            t.getBound().transformMat4(this._bs, e),
            (0 === this._cameraFrustum.getCurrentMask() || this._cameraFrustum.containsBoundingSphere(n)) && (0 === this._lightFrustum.getCurrentMask() || this._lightFrustum.containsBoundingSphere(n)) && (this._cameraFrustum.pushCurrentMask(),
            this._lightFrustum.pushCurrentMask(),
            this.pushMatrix(e),
            this.traverse(t),
            this._cameraFrustum.popCurrentMask(),
            this._lightFrustum.popCurrentMask(),
            this.popMatrix())
        },
        applyBoundingBox: function() {
            var t = new n;
            return function(e) {
                var i = this._matrixStack.length
                  , n = this._matrixStack[i - 1];
                u.exactEquals(n, u.IDENTITY) ? this._bb.expandByBoundingBox(e) : e.valid() && (e.transformMat4(t, n),
                this._bb.expandByBoundingBox(t))
            }
        }(),
        apply: function(t) {
            var e = t.getTypeID();
            if (t instanceof c)
                return void this.applyTransform(t);
            if (e === s.getTypeID()) {
                var i = this._bs
                  , n = this._matrixStack[this._matrixStack.length - 1];
                if (t.getBound().transformMat4(i, n),
                0 !== this._cameraFrustum.getCurrentMask() && !this._cameraFrustum.containsBoundingSphere(i))
                    return;
                if (0 !== this._lightFrustum.getCurrentMask() && !this._lightFrustum.containsBoundingSphere(i))
                    return;
                return void this.applyBoundingBox(t.getBoundingBox())
            }
            e === a.getTypeID() || e === o.getTypeID(),
            this.traverse(t)
        },
        pushMatrix: function(t) {
            this._matrixStack.push(t)
        },
        popMatrix: function() {
            this._matrixStack.pop()
        }
    }),
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(1260)
      , r = i(1268)
      , a = i(1242)
      , s = i(1233)
      , o = i(1290)
      , u = i(1273)
      , l = i(1212).mat4
      , c = i(1247)
      , h = i(1207)
      , d = i(1312)
      , p = i(1228)
      , f = i(1226)
      , g = i(1370)
      , m = i(1237)
      , v = i(1208)
      , _ = i(1238)
      , b = i(1203)
      , x = i(1244)
      , A = i(1212).vec3
      , y = i(1212).vec4
      , S = i(1321)
      , C = i(1235)
      , M = i(1449)
      , w = i(1446)
      , T = i(1447)
      , E = i(1445)
      , I = i(1450)
      , k = i(1451)
      , F = function(t) {
        this._shadowTechnique = t
    };
    F.prototype = {
        cull: function(t, e) {
            this._shadowTechnique.getShadowedScene().nodeTraverse(e);
            var i = e.getCurrentCullingSet()
              , n = e.getCurrentProjectionMatrix()
              , r = e.getComputedNear()
              , a = e.getComputedFar();
            return l.getFrustumPlanes(i.getFrustum().getPlanes(), n, e.getCurrentModelViewMatrix(), !1),
            i.getFrustum().setupMask(6),
            this._shadowTechnique.setLightFrustum(i.getFrustum(), r, a),
            !1
        }
    };
    var D = function(t) {
        I.call(this),
        this._projectionMatrix = l.create(),
        this._viewMatrix = l.create(),
        this._lightUp = A.fromValues(0, 0, 1),
        this._light = t.light,
        this._cameraShadow = new n,
        this._cameraShadow.setCullCallback(new F(this)),
        this._cameraShadow.setRenderOrder(n.PRE_RENDER, 0),
        this._cameraShadow.setReferenceFrame(v.ABSOLUTE_RF),
        this._cameraShadow.setClearColor(y.fromValues(1, 1, 1, 1)),
        this._texture = new k,
        this._textureUnitBase = 4,
        this._textureUnit = this._textureUnitBase,
        this._textureMagFilter = void 0,
        this._textureMinFilter = void 0,
        this._textureSize = 256,
        this._receivingStateset = void 0,
        this._casterStateSet = new f,
        this._casterStateSet.addUniform(_.createFloat1(0, "exponent0")),
        this._casterStateSet.addUniform(_.createFloat1(0, "exponent1")),
        this._casterStateSet.addUniform(_.createFloat1(.005, "bias")),
        this._texelSizeUniform = _.createFloat1(1 / this._textureSize, "texelSize"),
        this._casterStateSet.addUniform(this._texelSizeUniform);
        var e = _.createFloat2("RenderSize");
        this._casterStateSet.addUniform(e),
        this._renderSize = e.getInternalArray(),
        this._renderSize[0] = this._renderSize[1] = this._textureSize,
        this._casterStateSet.setAttributeAndModes(new o(o.LESS), p.ON | p.OVERRIDE),
        this._casterStateSet.setAttributeAndModes(new a, p.ON | p.OVERRIDE),
        this._shadowReceiveAttribute = new M(this._light.getLightNumber()),
        this._casterStateSet.setAttributeAndModes(this._shadowReceiveAttribute, p.ON | p.OVERRIDE),
        this._shadowCastShaderGeneratorName = "ShadowCast";
        var i = .001
          , r = 1e3
          , u = _.createFloat4("uShadowDepthRange");
        this._casterStateSet.addUniform(u),
        this._depthRange = u.getInternalArray(),
        this._depthRange[0] = i,
        this._depthRange[1] = r,
        this._depthRange[2] = r - i,
        this._depthRange[3] = 1 / (r - i),
        this._worldLightPos = y.create(),
        this._worldLightPos[3] = 0,
        this._worldLightDir = y.create(),
        this._worldLightDir[3] = 1,
        this._castsShadowDrawTraversalMask = 4294967295,
        this._castsShadowBoundsTraversalMask = 4294967295,
        this._shaderProcessor = void 0,
        this._tmpVec = A.create(),
        this._tmpVecBis = A.create(),
        this._tmpVecTercio = A.create(),
        this._tmpMatrix = l.create(),
        t && this.setShadowSettings(t),
        this._computeFrustumBounds = new T,
        this._computeBoundsVisitor = new s,
        t.userShadowCasterVisitor !== !1 && (this._removeNodesNeverCastingVisitor = t.userShadowCasterVisitor || new w(this._castsShadowTraversalMask)),
        this._infiniteFrustum = !0;
        var c = new E((!1),this._shadowReceiveAttribute);
        this._casterStateSet.setAttributeAndModes(c, p.ON | p.OVERRIDE),
        this._casterStateSet.setShaderGeneratorName(this._shadowCastShaderGeneratorName, p.OVERRIDE | p.ON),
        this._debug = !1
    };
    D.prototype = b.objectLibraryClass(b.objectInherit(I.prototype, {
        getDepthRange: function() {
            return this._depthRange
        },
        setLightFrustum: function(t, e, i) {
            this._lightFrustum = t,
            this._depthRange[0] = e,
            this._depthRange[1] = i,
            this.nearFarBounding(),
            this._debug && (this._debugGeomFrustum.updateGeometry(this._projectionMatrix, this._depthRange),
            l.invert(this._debugNodeFrustum.getMatrix(), this._viewMatrix))
        },
        getCamera: function() {
            return this._cameraShadow
        },
        getTexture: function() {
            return this._texture
        },
        isDirty: function() {
            return this._dirty
        },
        setTextureUnitBase: function(t) {
            this._textureUnitBase = t,
            this._textureUnit = t
        },
        setShadowSettings: function(t) {
            t && (this._light = t.light,
            this._shadowCastShaderGeneratorName = t.getShadowCastShaderGeneratorName(),
            this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),
            this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),
            this.setLight(this._light),
            this.setTextureSize(t.textureSize),
            this.setTexturePrecision(t.textureType),
            this.setFakePCF(t.fakePCF),
            this.setRotateOffset(t.rotateOffset),
            this.setKernelSizePCF(t.kernelSizePCF),
            this.setAlgorithm(t.algorithm),
            this.setBias(t.bias),
            this.setExponent0(t.exponent),
            this.setExponent1(t.exponent1),
            this.setEpsilonVSM(t.epsilonVSM))
        },
        setCastsShadowDrawTraversalMask: function(t) {
            this._castsShadowDrawTraversalMask = t
        },
        getCastsShadowDrawTraversalMask: function() {
            return this._castsDrawShadowTraversalMask
        },
        setCastsShadowBoundsTraversalMask: function(t) {
            this._castsShadowBoundsTraversalMask = t
        },
        getCastsShadowBoundsTraversalMask: function() {
            return this._castsShadowBoundsTraversalMask
        },
        getBias: function() {
            return this._shadowReceiveAttribute.getBias()
        },
        setBias: function(t) {
            this._shadowReceiveAttribute.setBias(t),
            this._casterStateSet.getUniformList().bias.getUniform().setFloat(t)
        },
        getExponent0: function() {
            return this._shadowReceiveAttribute.getExponent0()
        },
        setExponent0: function(t) {
            this._shadowReceiveAttribute.setExponent0(t),
            this._casterStateSet.getUniformList().exponent0.getUniform().setFloat(t)
        },
        getExponent1: function() {
            return this._shadowReceiveAttribute.getExponent1()
        },
        setExponent1: function(t) {
            this._shadowReceiveAttribute.setExponent1(t),
            this._casterStateSet.getUniformList().exponent1.getUniform().setFloat(t)
        },
        getEpsilonVSM: function() {
            return this._shadowReceiveAttribute.getEpsilonVSM()
        },
        setEpsilonVSM: function(t) {
            this._shadowReceiveAttribute.setEpsilonVSM(t)
        },
        getKernelSizePCF: function() {
            return this._shadowReceiveAttribute.getKernelSizePCF()
        },
        setKernelSizePCF: function(t) {
            this._shadowReceiveAttribute.setKernelSizePCF(t)
        },
        getFakePCF: function() {
            return this._shadowReceiveAttribute.getFakePCF()
        },
        setFakePCF: function(t) {
            this._shadowReceiveAttribute.getFakePCF() !== t && (this._shadowReceiveAttribute.setFakePCF(t),
            this.setTextureFiltering())
        },
        getRotateOffset: function() {
            return this._shadowReceiveAttribute.getRotateOffset()
        },
        setRotateOffset: function(t) {
            this._shadowReceiveAttribute.getRotateOffset() !== t && this._shadowReceiveAttribute.setRotateOffset(t)
        },
        setShadowedScene: function(t) {
            I.prototype.setShadowedScene.call(this, t),
            this._receivingStateset = this._shadowedScene.getReceivingStateSet(),
            this.dirty()
        },
        checkLightNumber: function() {
            var t = this._light.getLightNumber();
            this._shadowReceiveAttribute.getLightNumber() !== t && this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember()) === this._shadowReceiveAttribute && this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),
            this._texture && this._texture.getLightUnit() !== t && this._receivingStateset.getTextureAttribute(this._textureUnit, this._texture.getTypeMember()) === this._texture && this._receivingStateset.removeTextureAttribute(this._textureUnit, this._texture.getTypeMember())
        },
        init: function() {
            if (this._shadowedScene) {
                this._filledOnce = !1,
                this.checkLightNumber(),
                this._cameraShadow || (this._cameraShadow = new n,
                this._cameraShadow.setCullCallback(new F(this)),
                this._cameraShadow.setRenderOrder(n.PRE_RENDER, 0),
                this._cameraShadow.setReferenceFrame(v.ABSOLUTE_RF),
                this._cameraShadow.setClearColor(y.fromValues(1, 1, 1, 1))),
                this.initTexture();
                var t = this._light.getLightNumber();
                this._textureUnit = this._textureUnitBase + t,
                this._cameraShadow.setName("light_shadow_camera" + this._light.getName()),
                this._texture.setLightUnit(t),
                this._texture.setName("ShadowTexture" + this._textureUnit),
                this._shadowReceiveAttribute.setLightNumber(t);
                var e = p.OVERRIDE | p.ON;
                this._receivingStateset.setAttributeAndModes(this._shadowReceiveAttribute, e),
                this._preventTextureBindingDuringShadowCasting(),
                this._casterStateSet.setTextureAttributeAndModes(this._textureUnit, m.textureNull, p.PROTECTED),
                this._receivingStateset.setTextureAttributeAndModes(this._textureUnit, this._texture, e),
                this._dirty = !1
            }
        },
        _preventTextureBindingDuringShadowCasting: function() {
            for (var t = C.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS"), e = 0; e < t; e++)
                this._casterStateSet.setTextureAttributeAndModes(e, m.textureNull, p.OVERRIDE | p.ON)
        },
        valid: function() {
            return !0
        },
        updateShadowTechnique: function() {
            var t = this._cameraShadow
              , e = this._texture;
            if (t && e) {
                var i = t.getViewport();
                i || (i = new S,
                t.setViewport(i)),
                i.width() === e.getWidth() && i.height() === e.getHeight() || (t.detachAll(),
                t.attachTexture(u.COLOR_ATTACHMENT0, e),
                t.attachRenderBuffer(u.DEPTH_ATTACHMENT, u.DEPTH_COMPONENT16),
                t.getViewport().setViewport(0, 0, e.getWidth(), e.getHeight()))
            }
        },
        updateShadowTechnic: function() {
            h.log("ShadowMap.updateShadowTechnic() is deprecated, use updateShadowTechnique instead"),
            this.updateShadowTechnique()
        },
        setTextureFiltering: function() {
            var t, e, i, n = this.getTexturePrecision();
            if (this._texture) {
                switch (this.getAlgorithm()) {
                case "ESM":
                case "VSM":
                case "EVSM":
                    e = m.LINEAR,
                    i = m.LINEAR;
                    break;
                default:
                case "PCF":
                case "NONE":
                    this.getFakePCF() ? (e = m.LINEAR,
                    i = m.LINEAR) : (e = m.NEAREST,
                    i = m.NEAREST)
                }
                switch (n) {
                case "HALF_FLOAT":
                    t = m.HALF_FLOAT,
                    e = m.NEAREST,
                    i = m.NEAREST;
                    break;
                case "HALF_FLOAT_LINEAR":
                    t = m.HALF_FLOAT,
                    e = m.LINEAR,
                    i = m.LINEAR;
                    break;
                case "FLOAT":
                    t = m.FLOAT,
                    e = m.NEAREST,
                    i = m.NEAREST;
                    break;
                case "FLOAT_LINEAR":
                    t = m.FLOAT,
                    e = m.LINEAR,
                    i = m.LINEAR;
                    break;
                default:
                case "UNSIGNED_BYTE":
                    t = m.UNSIGNED_BYTE
                }
            }
            this._texture.setInternalFormatType(t),
            this._texture.setMinFilter(e),
            this._texture.setMagFilter(i),
            this._textureMagFilter = i,
            this._textureMinFilter = e
        },
        initTexture: function() {
            if (this._dirty) {
                this._texture || (this._texture = new k,
                this._textureUnit = this._textureUnitBase),
                this._texture.setTextureSize(this._textureSize, this._textureSize),
                this._texelSizeUniform.setFloat(1 / this._textureSize),
                this._renderSize[0] = this._textureSize,
                this._renderSize[1] = this._textureSize;
                var t;
                t = m.RGBA,
                this.setTextureFiltering(),
                this._texture.setInternalFormat(t),
                this._texture.setWrapS(m.CLAMP_TO_EDGE),
                this._texture.setWrapT(m.CLAMP_TO_EDGE),
                this._texture.dirty()
            }
        },
        setTexturePrecision: function(t) {
            t !== this._shadowReceiveAttribute.getPrecision() && (this._shadowReceiveAttribute.setPrecision(t),
            this.dirty())
        },
        getTexturePrecision: function() {
            return this._shadowReceiveAttribute.getPrecision()
        },
        setTextureSize: function(t) {
            t !== this._textureSize && (this._textureSize = t,
            this.dirty())
        },
        setAlgorithm: function(t) {
            t !== this.getAlgorithm() && (this._shadowReceiveAttribute.setAlgorithm(t),
            this.dirty())
        },
        getAlgorithm: function() {
            return this._shadowReceiveAttribute.getAlgorithm()
        },
        setLight: function(t) {
            t && t !== this._light && (this._light = t,
            this.dirty())
        },
        getUp: function(t) {
            return Math.abs(A.dot(this._lightUp, t)) >= 1 && (1 === this._lightUp[0] ? (this._lightUp[0] = 0,
            this._lightUp[1] = 1,
            this._lightUp[2] = 0) : (this._lightUp[0] = 1,
            this._lightUp[1] = 0,
            this._lightUp[2] = 0)),
            this._lightUp
        },
        nearFarBounding: function() {
            var t = this._depthRange[0]
              , e = this._depthRange[1]
              , i = D.EPSILON;
            e < t - i ? (this._emptyCasterScene = !0,
            e = 1,
            t = i) : t < i && (t = i),
            this._depthRange[0] = t,
            this._depthRange[1] = e
        },
        makePerspectiveFromBoundingBox: function(t, e, i, n, r, a) {
            var s = t.center(this._tmpVec)
              , o = t.radius()
              , u = D.EPSILON
              , c = u
              , h = 1;
            this._radius = o;
            var d = A.distance(s, i);
            d < -o ? this._emptyCasterScene = !0 : d <= 0 ? (c = u,
            h = d + o) : d < o ? (c = u,
            h = d + o) : (c = d - o,
            h = d + o),
            this._depthRange[0] = c,
            this._depthRange[1] = h,
            this.nearFarBounding();
            var p = this._depthRange[0] * Math.tan(e * Math.PI / 180);
            p = p > o ? o : p;
            var f = p
              , g = -f
              , m = p
              , v = -m
              , _ = this.getUp(n);
            this._infiniteFrustum ? l.infiniteFrustum(a, v, m, g, f, this._depthRange[0]) : l.frustum(a, v, m, g, f, this._depthRange[0], this._depthRange[1]),
            l.lookAtDirection(r, i, n, _)
        },
        makeOrthoFromBoundingBox: function(t, e, i, n) {
            var r = t.center(this._tmpVecTercio)
              , a = t.radius()
              , s = a + a
              , o = 1e-4
              , u = s + 1e-4
              , c = this._tmpVec;
            A.scaleAndAdd(c, r, e, -s),
            o = a,
            u += a;
            var h = .001;
            o < u * h && (o = u * h);
            var d = this.getUp(e);
            l.lookAtDirection(i, c, e, d);
            var p, f;
            f = a,
            p = f,
            l.ortho(n, -p, p, -f, f, o, u),
            this._depthRange[0] = o,
            this._depthRange[1] = u
        },
        aimShadowCastingCamera: function(t, e) {
            var i = this._light;
            if (!i)
                return void (this._emptyCasterScene = !0);
            var n = this._cameraShadow
              , r = this._worldLightPos
              , a = this._worldLightDir;
            l.copy(this._projectionMatrix, n.getProjectionMatrix()),
            l.copy(this._viewMatrix, n.getViewMatrix());
            var s, o = this._projectionMatrix, u = this._viewMatrix, c = t.getCurrentRenderBin().getPositionedAttribute();
            if (c = c.find(function(t) {
                return t.length > 0 && t[1] === i && (s = t[0],
                !0)
            }),
            void 0 === s)
                return h.warn("light isnt inside children of shadowedScene Node"),
                void (this._emptyCasterScene = !0);
            var d = this._tmpMatrix;
            if (l.invert(d, t.getCurrentModelViewMatrix()),
            this._light.isDirectionLight())
                y.transformMat4(r, i.getPosition(), s),
                y.transformMat4(r, r, d),
                A.scale(r, r, -1),
                A.normalize(r, r),
                this.makeOrthoFromBoundingBox(e, r, u, o),
                this._debug && l.invert(this._debugNodeFrustum.getMatrix(), u);
            else {
                l.mul(this._tmpMatrix, d, s);
                var p = this._tmpMatrix;
                A.transformMat4(r, i.getPosition(), p),
                p[12] = 0,
                p[13] = 0,
                p[14] = 0,
                l.invert(p, p),
                l.transpose(p, p),
                A.copy(a, i.getDirection()),
                y.transformMat4(a, a, p),
                A.normalize(a, a),
                this.makePerspectiveFromBoundingBox(e, i.getSpotCutoff(), r, a, u, o)
            }
            l.copy(n.getProjectionMatrix(), this._projectionMatrix),
            l.copy(n.getViewMatrix(), this._viewMatrix),
            this.setShadowUniformsDepthValue()
        },
        frameShadowCastingFrustum: function(t) {
            this._infiniteFrustum || r.prototype.clampProjectionMatrix(this._projectionMatrix, this._depthRange[0], this._depthRange[1], t.getNearFarRatio(), this._depthRange),
            this.setShadowUniformsDepthValue();
            var e = this._cameraShadow;
            l.copy(e.getProjectionMatrix(), this._projectionMatrix),
            l.copy(e.getViewMatrix(), this._viewMatrix)
        },
        setShadowUniformsDepthValue: function() {
            this._depthRange[2] = this._depthRange[1] - this._depthRange[0],
            this._depthRange[3] = 1 / this._depthRange[2];
            var t = this._casterStateSet.getUniformList();
            t.uShadowDepthRange.getUniform().setVec4(this._depthRange),
            this._texture.setViewMatrix(this._viewMatrix),
            this._texture.setProjectionMatrix(this._projectionMatrix),
            this._texture.setDepthRange(this._depthRange)
        },
        noDraw: function() {
            this._depthRange[0] = 0,
            this._depthRange[1] = 0,
            this._depthRange[2] = 0,
            this._depthRange[3] = 0;
            var t = this._casterStateSet.getUniformList();
            t.uShadowDepthRange.getUniform().setVec4(this._depthRange),
            this._texture.setDepthRange(this._depthRange);
            var e = this._cameraShadow;
            l.copy(this._projectionMatrix, e.getProjectionMatrix()),
            l.copy(this._viewMatrix, e.getViewMatrix()),
            this._texture.setViewMatrix(this._viewMatrix),
            this._texture.setProjectionMatrix(this._projectionMatrix),
            this._filledOnce = !0
        },
        cullShadowCasting: function(t) {
            var e;
            if (this._removeNodesNeverCastingVisitor && (this._removeNodesNeverCastingVisitor.setNoCastMask(~(this._castsShadowBoundsTraversalMask | this._castsShadowDrawTraversalMask)),
            this._removeNodesNeverCastingVisitor.reset(),
            this.getShadowedScene().accept(this._removeNodesNeverCastingVisitor)),
            this._computeBoundsVisitor.setTraversalMask(this._castsShadowBoundsTraversalMask),
            this._computeBoundsVisitor.reset(),
            this.getShadowedScene().accept(this._computeBoundsVisitor),
            e = this._computeBoundsVisitor.getBoundingBox(),
            !e.valid())
                return this.noDraw(),
                void (this._removeNodesNeverCastingVisitor && this._removeNodesNeverCastingVisitor.restore());
            if (this._debug) {
                var i = e.getMin()
                  , n = e.getMax();
                e.center(this._tmpVec);
                var r = this._debugNodeSceneCast.getMatrix();
                l.fromScaling(r, [n[0] - i[0], n[1] - i[1], n[2] - i[2], 1]),
                l.setTranslation(r, this._tmpVec)
            }
            var a = t.getCurrentModelMatrix();
            if (e.transformMat4(e, a),
            this._emptyCasterScene = !1,
            this.aimShadowCastingCamera(t, e),
            this._emptyCasterScene)
                return this.noDraw(),
                void (this._removeNodesNeverCastingVisitor && this._removeNodesNeverCastingVisitor.restore());
            var s = t.getTraversalMask();
            t.setTraversalMask(this._castsShadowDrawTraversalMask),
            t.pushStateSet(this._casterStateSet),
            this._cameraShadow.setEnableFrustumCulling(!0),
            this._cameraShadow.setComputeNearFar(!0),
            this._debug && this._debugNode.accept(t),
            this._cameraShadow.accept(t),
            this.nearFarBounding(),
            this.frameShadowCastingFrustum(t),
            this._cameraShadow.setComputeNearFar(!1),
            this._removeNodesNeverCastingVisitor && this._removeNodesNeverCastingVisitor.restore(),
            t.popStateSet(),
            t.setTraversalMask(s),
            this._filledOnce = !0
        },
        cleanReceivingStateSet: function() {
            this._receivingStateset && (this._texture && this._receivingStateset.getTextureAttribute(this._textureUnit, this._texture.getTypeMember()) === this._texture && this._receivingStateset.removeTextureAttribute(this._textureUnit, this._texture.getTypeMember()),
            this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember()) === this._shadowReceiveAttribute && this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()))
        },
        cleanSceneGraph: function() {
            this._cameraShadow = void 0,
            this._filledOnce = !1,
            this.cleanReceivingStateSet(),
            this._texture = void 0,
            this._shadowedScene = void 0
        },
        setDebug: function(t) {
            t && !this._debug && (this._debugNode || (this._debugGeomFrustum = g.createDebugFrustumGeometry(),
            this._debugGeomSceneCast = d.createBoundingBoxGeometry(),
            this._debugGeomSceneCast.getPrimitives()[0].mode = x.LINES,
            this._debugNode = new c,
            this._debugNodeFrustum = new c,
            this._debugNodeSceneCast = new c,
            this._debugNodeFrustum.addChild(this._debugGeomFrustum),
            this._debugNodeSceneCast.addChild(this._debugGeomSceneCast),
            this._debugNode.addChild(this._debugNodeFrustum),
            this._debugNode.addChild(this._debugNodeSceneCast))),
            this._debug = t
        },
        getDebug: function() {
            return this._debug
        }
    }), "osgShadow", "ShadowMap"),
    D.EPSILON = .005,
    b.setTypeID(D),
    t.exports = D
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1228)
      , a = i(1238)
      , s = i(1227)
      , o = i(1207)
      , u = function(t, e) {
        r.call(this),
        this._lightNumber = t,
        this._algoType = "NONE",
        this._bias = .001,
        this._exponent0 = .001,
        this._exponent1 = .001,
        this._epsilonVSM = .001,
        this._precision = "UNSIGNED_BYTE",
        this._kernelSizePCF = void 0,
        this._fakePCF = !0,
        this._rotateOffset = !1,
        this._enable = !e
    };
    u.uniforms = {},
    u.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "ShadowReceive",
        cloneType: function() {
            return new u(this._lightNumber,(!0))
        },
        getTypeMember: function() {
            return this.attributeType + this.getLightNumber()
        },
        getLightNumber: function() {
            return this._lightNumber
        },
        getUniformName: function(t) {
            var e = this.getType() + this.getLightNumber().toString();
            return "u" + e + "_" + t
        },
        getRotateOffset: function() {
            return this._rotateOffset
        },
        setRotateOffset: function(t) {
            this._rotateOffset = t
        },
        setAlgorithm: function(t) {
            this._algoType = t
        },
        getAlgorithm: function() {
            return this._algoType
        },
        setBias: function(t) {
            this._bias = t
        },
        getBias: function() {
            return this._bias
        },
        setExponent0: function(t) {
            this._exponent0 = t
        },
        getExponent0: function() {
            return this._exponent0
        },
        setExponent1: function(t) {
            this._exponent1 = t
        },
        getExponent1: function() {
            return this._exponent1
        },
        setEpsilonVSM: function(t) {
            this._epsilonVSM = t
        },
        getEpsilonVSM: function() {
            return this._epsilonVSM
        },
        getKernelSizePCF: function() {
            return this._kernelSizePCF
        },
        setKernelSizePCF: function(t) {
            this._kernelSizePCF = t
        },
        getFakePCF: function() {
            return this._fakePCF
        },
        setFakePCF: function(t) {
            this._fakePCF = t
        },
        setPrecision: function(t) {
            this._precision = t
        },
        getPrecision: function() {
            return this._precision
        },
        setLightNumber: function(t) {
            this._lightNumber = t
        },
        getOrCreateUniforms: function() {
            var t = u
              , e = this.getTypeMember();
            if (t.uniforms[e])
                return t.uniforms[e];
            var i = {
                bias: a.createFloat(this.getUniformName("bias")),
                exponent0: a.createFloat(this.getUniformName("exponent0")),
                exponent1: a.createFloat(this.getUniformName("exponent1")),
                epsilonVSM: a.createFloat(this.getUniformName("epsilonVSM"))
            };
            return t.uniforms[e] = new s(i),
            t.uniforms[e]
        },
        getExtensions: function() {
            var t = this.getAlgorithm();
            return "PCF" === t ? ["#extension GL_OES_standard_derivatives : enable"] : []
        },
        getDefines: function() {
            var t = this.getPrecision()
              , e = this.getAlgorithm()
              , i = []
              , n = !1
              , r = !1;
            if ("UNSIGNED_BYTE" !== t && (n = !0),
            !n || "HALF_FLOAT_LINEAR" !== t && "FLOAT_LINEAR" !== t || (r = !0),
            "ESM" === e)
                i.push("#define _ESM");
            else if ("NONE" === e)
                i.push("#define _NONE");
            else if ("PCF" === e) {
                i.push("#define _PCF");
                var a = this.getKernelSizePCF();
                switch (this._fakePCF && i.push("#define _FAKE_PCF 1"),
                a) {
                case "4Poisson(16texFetch)":
                    i.push("#define _POISSON_PCF"),
                    i.push("#define _PCFx4");
                    break;
                case "8Poisson(32texFetch)":
                    i.push("#define _POISSON_PCF"),
                    i.push("#define _PCFx9");
                    break;
                case "16Poisson(64texFetch)":
                    i.push("#define _POISSON_PCF"),
                    i.push("#define _PCFx16");
                    break;
                case "25Poisson(100texFetch)":
                    i.push("#define _POISSON_PCF"),
                    i.push("#define _PCFx25");
                    break;
                case "32Poisson(128texFetch)":
                    i.push("#define _POISSON_PCF"),
                    i.push("#define _PCFx32");
                    break;
                case "1Band(1texFetch)":
                    i.push("#define _NONE"),
                    i.push("#define _PCFx1");
                    break;
                case "4Band(4texFetch)":
                    i.push("#define _BAND_PCF"),
                    i.push("#define _PCFx4");
                    break;
                case "9Band(9texFetch)":
                    i.push("#define _BAND_PCF"),
                    i.push("#define _PCFx9");
                    break;
                case "16Band(16texFetch)":
                    i.push("#define _BAND_PCF"),
                    i.push("#define _PCFx16");
                    break;
                case "4Tap(16texFetch)":
                    i.push("#define _TAP_PCF"),
                    i.push("#define _PCFx4");
                    break;
                case "9Tap(36texFetch)":
                    i.push("#define _TAP_PCF"),
                    i.push("#define _PCFx9");
                    break;
                case "16Tap(64texFetch)":
                    i.push("#define _TAP_PCF"),
                    i.push("#define _PCFx25");
                    break;
                default:
                case "1Tap(4texFetch)":
                    i.push("#define _TAP_PCF"),
                    i.push("#define _PCFx1")
                }
            } else
                "VSM" === e ? i.push("#define _VSM") : "EVSM" === e && i.push("#define _EVSM");
            return n && i.push("#define _FLOATTEX"),
            r && i.push("#define _FLOATLINEAR"),
            this.getRotateOffset() && i.push("#define _ROTATE_OFFSET"),
            i
        },
        apply: function() {
            if (this._enable) {
                var t = this.getOrCreateUniforms();
                t.bias.setFloat(this._bias),
                t.exponent0.setFloat(this._exponent0),
                t.exponent1.setFloat(this._exponent1),
                t.epsilonVSM.setFloat(this._epsilonVSM)
            }
        },
        isEnabled: function() {
            return this._enable
        },
        isEnable: function() {
            return o.log("ShadowAttribute.isEnable() is deprecated, use isEnabled() instead"),
            this.isEnabled()
        },
        getHash: function() {
            return this.getTypeMember() + "_" + this.getAlgorithm() + "_" + this.getKernelSizePCF() + "_" + this.getFakePCF() + "_" + this.getRotateOffset()
        }
    }), "osgShadow", "ShadowReceiveAttribute"),
    n.setTypeID(u),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1207)
      , r = i(1210)
      , a = i(1203)
      , s = function() {
        r.call(this),
        this._shadowedScene = void 0,
        this._dirty = !1,
        this._enabled = !0,
        this._filledOnce = !1
    };
    s.prototype = a.objectLibraryClass(a.objectInherit(r.prototype, {
        dirty: function() {
            this._dirty = !0
        },
        getShadowedScene: function() {
            return this._shadowedScene
        },
        setEnabled: function(t) {
            this._enabled = t
        },
        isEnabled: function() {
            return this._enabled
        },
        getEnable: function() {
            return n.log("ShadowTechnique.getEnable() is deprecated, use isEnabled instead"),
            this.isEnabled()
        },
        setEnable: function(t) {
            n.log("ShadowTechnique.setEnable() is deprecated, use setEnabled instead"),
            this.setEnabled(t)
        },
        isFilledOnce: function() {
            return this._filledOnce
        },
        requestRedraw: function() {
            this._filledOnce = !1
        },
        setShadowedScene: function(t) {
            this._shadowedScene = t
        },
        init: function() {
            n.log("No ShadowTechnique activated: normal rendering activated")
        },
        valid: function() {
            return !1
        },
        updateShadowTechnique: function() {},
        cullShadowCasting: function() {},
        cleanSceneGraph: function() {
            n.log("No ShadowTechnique activated: normal rendering activated")
        }
    }), "osgShadow", "ShadowTechnique"),
    a.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1227)
      , r = i(1207)
      , a = i(1237)
      , s = i(1238)
      , o = i(1203)
      , u = i(1212).vec4
      , l = function() {
        a.call(this),
        this._uniforms = {},
        this._mapSize = u.create(),
        this._lightUnit = -1
    };
    l.uniforms = {},
    l.prototype = o.objectLibraryClass(o.objectInherit(a.prototype, {
        cloneType: function() {
            return new l
        },
        setLightUnit: function(t) {
            this._lightUnit = t
        },
        getLightUnit: function() {
            return this._lightUnit
        },
        getUniformName: function(t) {
            var e = "Shadow_" + this.getType() + this._lightUnit.toString();
            return "u" + e + "_" + t
        },
        getVaryingName: function(t) {
            var e = this.getType() + this._lightUnit.toString();
            return "v" + e + "_" + t
        },
        getOrCreateUniforms: function(t) {
            var e = l;
            if (r.assert(void 0 !== t),
            r.assert(this._lightUnit !== -1),
            void 0 !== e.uniforms[t])
                return e.uniforms[t];
            var i = {
                ViewMatrix: s.createMat4(this.getUniformName("viewMatrix")),
                ProjectionMatrix: s.createMat4(this.getUniformName("projectionMatrix")),
                DepthRange: s.createFloat4(this.getUniformName("depthRange")),
                MapSize: s.createFloat4(this.getUniformName("mapSize"))
            }
              , a = "Texture" + t
              , o = s.createInt1(t, a);
            return i[a] = o,
            e.uniforms[t] = new n(i),
            e.uniforms[t]
        },
        setViewMatrix: function(t) {
            this._viewMatrix = t
        },
        setProjectionMatrix: function(t) {
            this._projectionMatrix = t
        },
        setDepthRange: function(t) {
            this._depthRange = t
        },
        setTextureSize: function(t, e) {
            a.prototype.setTextureSize.call(this, t, e),
            this.dirty(),
            this._mapSize[0] = t,
            this._mapSize[1] = e,
            this._mapSize[2] = 1 / t,
            this._mapSize[3] = 1 / e
        },
        apply: function(t, e) {
            if (a.prototype.apply.call(this, t, e),
            this._lightUnit !== -1) {
                var i = this.getOrCreateUniforms(e);
                i.ViewMatrix.setMatrix4(this._viewMatrix),
                i.ProjectionMatrix.setMatrix4(this._projectionMatrix),
                i.DepthRange.setFloat4(this._depthRange),
                i.MapSize.setFloat4(this._mapSize)
            }
        },
        getHash: function() {
            return this.getTypeMember() + "_" + this._lightUnit + "_" + this._type
        }
    }), "osgShadow", "ShadowTexture"),
    o.setTypeID(l),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1203)
      , r = i(1237)
      , a = ["1Band(1texFetch)", "4Band(4texFetch)", "9Band(9texFetch)", "16Band(16texFetch)", "1Tap(4texFetch)", "4Tap(16texFetch)", "9Tap(36texFetch)", "16Tap(64texFetch)", "4Poisson(16texFetch)", "8Poisson(32texFetch)", "16Poisson(64texFetch)", "25Poisson(100texFetch)", "32Poisson(128texFetch)"]
      , s = function(t) {
        this.castsShadowDrawTraversalMask = 4294967295,
        this.castsShadowBoundsTraversalMask = 4294967295,
        this.textureSize = 1024,
        this.textureType = "UNSIGNED_BYTE",
        this.textureFormat = r.RGBA,
        this.shadowProjection = "fov",
        this.fov = 50,
        this.kernelSizePCF = "4Band(4texFetch)",
        this._fakePCF = !1,
        this._rotateOffset = !1,
        this.superSample = 0,
        this.blur = !1,
        this.blurKernelSize = 4,
        this.blurTextureSize = 256,
        this.epsilonVSM = 8e-4,
        this.bias = .005,
        this.algorithm = "PCF",
        this.exponent = 40,
        this.exponent1 = 10,
        this.shadowCastShaderGeneratorName = "ShadowCast",
        n.objectMix(this, t)
    };
    s.kernelSizeList = a,
    s.prototype = {
        setCastsShadowDrawTraversalMask: function(t) {
            this.castsShadowDrawTraversalMask = t
        },
        getCastsShadowDrawTraversalMask: function() {
            return this.castsDrawShadowTraversalMask
        },
        setCastsShadowBoundsTraversalMask: function(t) {
            this.castsShadowBoundsTraversalMask = t
        },
        getCastsShadowBoundsTraversalMask: function() {
            return this.castsShadowBoundsTraversalMask
        },
        setLight: function(t) {
            this.light = t
        },
        getLight: function() {
            return this.light
        },
        setTextureSize: function(t) {
            this.textureSize = t
        },
        getTextureSize: function() {
            return this.textureSize
        },
        setTextureType: function(t) {
            this.textureType = t
        },
        getTextureType: function() {
            return this.textureType
        },
        setTextureFormat: function(t) {
            this.textureFormat = t
        },
        getTextureFormat: function() {
            return this.textureFormat
        },
        setAlgorithm: function(t) {
            this.algorithm = t
        },
        getAlgorithm: function() {
            return this.algorithm
        },
        setShadowCastShaderGeneratorName: function(t) {
            this.shadowCastShaderGeneratorName = t
        },
        getShadowCastShaderGeneratorName: function() {
            return this.shadowCastShaderGeneratorName
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1268)
      , r = i(1212).mat4
      , a = i(1209)
      , s = i(1229)
      , o = i(1226)
      , u = i(1203)
      , l = i(1212).vec4
      , c = function() {
        a.call(this),
        this._shadowTechniques = [],
        this._optimizedFrustum = !1,
        this._frustumReceivers = [l.create(), l.create(), l.create(), l.create(), l.create(), l.create()],
        this._tmpMat = r.create(),
        this._receivingStateset = new o
    };
    c.prototype = u.objectLibraryClass(u.objectInherit(a.prototype, {
        getReceivingStateSet: function() {
            return this._receivingStateset
        },
        getShadowTechniques: function() {
            return this._shadowTechniques
        },
        addShadowTechnique: function(t) {
            this._shadowTechniques.length > 0 && this._shadowTechniques.indexOf(t) !== -1 || (this._shadowTechniques.push(t),
            t.valid() && (t.setShadowedScene(this),
            t.dirty()))
        },
        removeShadowTechnique: function(t) {
            if (this._shadowTechniques.length > 0) {
                var e = this._shadowTechniques.indexOf(t);
                e !== -1 && (this._shadowTechniques[e].valid() && this._shadowTechniques[e].cleanSceneGraph(),
                this._shadowTechniques.splice(e, 1))
            }
        },
        cleanSceneGraph: function() {
            for (var t = 0, e = this._shadowTechniques.length; t < e; t++)
                this._shadowTechniques[t] && this._shadowTechniques[t].valid() && this._shadowTechniques[t].cleanSceneGraph()
        },
        dirty: function() {
            for (var t = 0; t < this._shadowTechniques.length; t++)
                this._shadowTechniques[t].dirty()
        },
        nodeTraverse: function(t) {
            a.prototype.traverse.call(this, t)
        },
        traverse: function(t) {
            if (t.getVisitorType() === s.CULL_VISITOR) {
                var e, i, n = this._shadowTechniques.length;
                for (n && t.pushStateSet(this._receivingStateset),
                this.nodeTraverse(t),
                n && t.popStateSet(),
                e = 0; e < n; e++)
                    i = this._shadowTechniques[e],
                    i && i.valid() && (i.isDirty() && i.init(),
                    !i.isEnabled() && i.isFilledOnce() || (i.updateShadowTechnique(t),
                    i.cullShadowCasting(t)))
            } else
                this.nodeTraverse(t)
        }
    }), "osgShadow", "ShadowedScene"),
    u.setTypeID(c),
    n.prototype[c.typeID] = n.prototype[a.typeID],
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(1344)
      , r = {};
    r.Text = n,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1341)
      , r = i(1342)
      , a = i(1343)
      , s = {};
    s.osg = n,
    s.osgAnimation = r,
    s.osgText = a,
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1457)
      , r = {};
    r.ReaderWriterGLTF = n,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1251)
      , r = i(1207)
      , a = i(1249)
      , s = i(1250)
      , o = i(1325)
      , u = i(1329)
      , l = i(1276)
      , c = i(1278)
      , h = i(1338)
      , d = i(1335)
      , p = i(1337)
      , f = i(1282)
      , g = i(1326)
      , m = g.createQuatChannel
      , v = g.createVec3Channel
      , _ = i(1234)
      , b = i(1237)
      , x = i(1247)
      , A = i(1255)
      , y = i(1246)
      , S = i(1244)
      , C = i(1243)
      , M = i(1279)
      , w = i(1280)
      , T = i(1238)
      , E = i(1212).vec3
      , I = i(1212).quat
      , k = i(1212).mat4
      , F = function() {
        this._files = null,
        this._loadedFiles = null,
        this._localPath = null,
        this._bufferViewCache = null,
        this._basicAnimationManager = null,
        this._visitedNodes = null,
        this._animatedNodes = null,
        this._skeletons = null,
        this._bones = null,
        this._skeletonToInfluenceMap = null,
        this._cachepromise = null,
        this._inputImgReader = null
    };
    F.WEBGL_COMPONENT_TYPES = {
        5120: Int8Array,
        5121: Uint8Array,
        5122: Int16Array,
        5123: Uint16Array,
        5125: Uint32Array,
        5126: Float32Array
    },
    F.TYPE_TABLE = {
        SCALAR: 1,
        VEC2: 2,
        VEC3: 3,
        VEC4: 4,
        MAT2: 4,
        MAT3: 9,
        MAT4: 16
    },
    F.TEXTURE_FORMAT = {
        6406: b.ALPHA,
        6407: b.RGB,
        6408: b.RGBA,
        6409: b.LUMINANCE,
        6410: b.LUMINANCE_ALPHA
    },
    F.PBR_EXTENSION = "FRAUNHOFER_materials_pbr",
    F.PBR_METAL_MODE = "PBR_metal_roughness",
    F.PBR_SPEC_MODE = "PBR_specular_glossiness",
    F.ALBEDO_TEXTURE_UNIT = 2,
    F.DIFFUSE_TEXTURE_UNIT = 2,
    F.ROUGHNESS_TEXTURE_UNIT = 3,
    F.GLOSSINESS_TEXTURE_UNIT = 3,
    F.METALNESS_TEXTURE_UNIT = 4,
    F.SPECULAR_TEXTURE_UNIT = 4,
    F.NORMAL_TEXTURE_UNIT = 5,
    F.AO_TEXTURE_UNIT = 6,
    F.ALBEDO_UNIFORM = "albedoMap",
    F.ROUGHNESS_UNIFORM = "roughnessMap",
    F.SPECULAR_UNIFORM = "specularMap",
    F.NORMAL_UNIFORM = "normalMap",
    F.AO_UNIFORM = "aoMap",
    F.prototype = {
        init: function() {
            this._files = null,
            this._loadedFiles = {},
            this._localPath = null,
            this._bufferViewCache = {},
            this._basicAnimationManager = null,
            this._visitedNodes = {},
            this._animatedNodes = {},
            this._skeletons = {},
            this._bones = {},
            this._skeletonToInfluenceMap = {},
            this._stateSetMap = {},
            this._cachepromise = {},
            this._inputImgReader = new s
        },
        getFileName: function(t) {
            if ("string" == typeof t) {
                var e = t.split("/").pop();
                return e
            }
            return t instanceof File ? t.name : null
        },
        findFileFromURI: function(t, e) {
            if ("string" == typeof t)
                return e;
            for (var i = 0; i < t.length; ++i) {
                var n = this.getFileName(t[i]);
                if (n === e)
                    return t[i]
            }
            return null
        },
        getFileType: function(t) {
            var e = this.getFileName(t);
            if (!e)
                return null;
            var i = e.split(".").pop();
            return "bin" === i ? "arraybuffer" : "gltf" === i ? "text" : "blob"
        },
        loadGLTFJson: function(t) {
            if (this._preloaded) {
                for (var e = window.Object.keys(this._loadedFiles), i = 0; i < e.length; ++i)
                    if (e[i].indexOf(".gltf") !== -1)
                        return Promise.resolve(this._loadedFiles[e[i]]);
                return r.warn("You did not provide any glTF file"),
                Promise.resolve(null)
            }
            var n = null;
            if ("string" == typeof t) {
                var a = t.split(".").pop();
                if ("gltf" !== a)
                    return r.warn("The given URL does not point toward a valid glTF file"),
                    Promise.resolve(null);
                var s = t.lastIndexOf("/");
                this._localPath = s === -1 ? "" : t.substr(0, s + 1),
                n = t
            } else {
                if (!(t instanceof FileList || this._preloaded))
                    return r.warn("The provided argument is neither a FileList nor a valid URL"),
                    Promise.resolve(null);
                for (var o = 0; o < t.length; ++o) {
                    var u = this.getFileName(t[o]);
                    if ("gltf" === u.split(".").pop()) {
                        n = t[o];
                        break
                    }
                }
            }
            return n ? this.loadFile(n, "gltf") : (r.warn("You did not provided any glTF file"),
            Promise.resolve(null))
        },
        requestFileFromReader: function(t, e) {
            var i = Promise.defer();
            if (!(t instanceof File))
                return i.reject();
            var n = new window.FileReader;
            return n.onload = function(t) {
                if ("blob" !== e)
                    i.resolve(t.target.result);
                else {
                    var n = new window.Image;
                    n.src = t.target.result,
                    i.resolve(n)
                }
            }
            ,
            "arraybuffer" === e ? n.readAsArrayBuffer(t) : "text" === e ? n.readAsText(t) : n.readAsDataURL(t),
            i.promise
        },
        loadFile: function(t, e) {
            if (this._cachepromise[e])
                return this._cachepromise[e];
            if (!t)
                return r.warn("'" + e + "' file not found"),
                Promise.resolve(null);
            var i = this.getFileType(t);
            if ("string" == typeof t) {
                if ("gltf" !== e && (0 !== t.indexOf("http://") && 0 !== t.indexOf("https://") || 0 !== t.indexOf("www.")) && (t = this._localPath + e),
                "blob" === i) {
                    var a = this._inputImgReader.readImageURL(t, {
                        imageLoadingUsePromise: !0
                    });
                    return this._cachepromise[e] = a,
                    a
                }
                var s = n(t, {
                    responseType: i
                }).then(function(t) {
                    return t
                });
                return this._cachepromise[e] = s,
                s
            }
            var o = this.requestFileFromReader(t, i);
            return this._cachepromise[e] = o,
            o
        },
        preloadFiles: function(t) {
            for (var e = window.Object.keys(t), i = 0; i < e.length; ++i)
                this._cachepromise[e[i]] = Promise.resolve(t[e[i]]);
            this._loadedFiles = t
        },
        loadAccessorBuffer: function(t, e) {
            var i = this._loadedFiles.glTF
              , n = i.bufferViews[t.bufferView]
              , r = i.buffers[n.buffer]
              , a = this.findFileFromURI(this._files, r.uri)
              , s = this.loadFile(a, r.uri)
              , o = this;
            return s.then(function(i) {
                if (!i)
                    return Promise.resolve(null);
                var r = F.WEBGL_COMPONENT_TYPES[t.componentType]
                  , a = null;
                o._bufferViewCache[t.bufferView] || (o._bufferViewCache[t.bufferView] = i.slice(n.byteOffset, n.byteOffset + n.byteLength));
                var s = o._bufferViewCache[t.bufferView];
                return a = new r(s,t.byteOffset,t.count * F.TYPE_TABLE[t.type]),
                e ? Promise.resolve(new C(e,a,F.TYPE_TABLE[t.type])) : Promise.resolve(a)
            })
        },
        findByKey: function(t, e) {
            if (!t)
                return null;
            for (var i = window.Object.keys(t), n = 0; n < i.length; ++n)
                if (i[n] === e)
                    return t[i[n]];
            return null
        },
        registerUpdateCallback: function(t, e) {
            var i = this._loadedFiles.glTF
              , n = null;
            n = i.nodes[t].jointName ? new M : new w,
            n.setName(t);
            var r = E.create();
            k.getTranslation(r, e.getMatrix());
            var a = I.create();
            k.getRotation(a, e.getMatrix());
            var s = E.create();
            k.getScale(s, e.getMatrix()),
            n.getStackedTransforms().push(new h("translation",r)),
            n.getStackedTransforms().push(new d("rotation",a)),
            n.getStackedTransforms().push(new p("scale",s)),
            e.addUpdateCallback(n)
        },
        createTextureAndSetAttrib: function(t, e, i, n) {
            var r = Promise.defer();
            if (!t)
                return r.resolve();
            var a = new b
              , s = this._loadedFiles.glTF
              , o = s.textures[t];
            if (!o)
                return r.resolve();
            var u = s.images[o.source];
            if (!u)
                return r.resolve();
            var l = this.findFileFromURI(this._files, u.uri);
            return this.loadFile(l, u.uri).then(function(t) {
                if (!t)
                    return r.resolve();
                a.setImage(t, F.TEXTURE_FORMAT[o.format]),
                a.setFlipY(o.flipY);
                var s = o.extras;
                return s && e.addUniform(T.createInt1(s.yUp ? 0 : 1, "uFlipNormalY")),
                e.setTextureAttributeAndModes(i, a),
                n && e.addUniform(T.createInt(i, n)),
                r.resolve()
            }),
            r.promise
        },
        loadTransform: function(t) {
            var e = k.create();
            if (t.matrix)
                return k.copy(e, t.matrix),
                e;
            var i = t.scale || E.ONE
              , n = t.rotation || I.IDENTITY
              , r = t.translation || E.ZERO;
            return k.fromRotationTranslationScale(e, n, r, i),
            e
        },
        preprocessChannel: function(t, e, i) {
            var n = this._loadedFiles.glTF
              , r = []
              , a = e.samplers[t.sampler]
              , s = n.accessors[i[a.input]]
              , o = n.accessors[i[a.output]]
              , u = this.loadAccessorBuffer(s, null)
              , l = this.loadAccessorBuffer(o, null);
            r.push(u, l);
            var c = this;
            return Promise.all(r).then(function(e) {
                var i = e[0]
                  , n = e[1]
                  , r = null;
                return 4 === F.TYPE_TABLE[o.type] ? r = m(n, i, t.target.id, a.output, null) : 3 === F.TYPE_TABLE[o.type] && (r = v(n, i, t.target.id, a.output, null)),
                c._animatedNodes[t.target.id] = !0,
                r
            })
        },
        createAnimationFromChannels: function(t, e) {
            return Promise.all(t).then(function(t) {
                return o.createAnimation(t, e)
            })
        },
        preprocessAnimations: function() {
            var t = this._loadedFiles.glTF;
            if (!t.animations)
                return Promise.resolve();
            for (var e = [], i = window.Object.keys(t.animations), n = 0; n < i.length; ++n) {
                for (var r = t.animations[i[n]], a = r.parameters, s = [], o = 0; o < r.channels.length; ++o) {
                    var l = r.channels[o]
                      , c = this.preprocessChannel(l, r, a);
                    s.push(c)
                }
                var h = this.createAnimationFromChannels(s, i[n]);
                e.push(h)
            }
            var d = this;
            return Promise.all(e).then(function(t) {
                var e = new u;
                e.init(t),
                d._basicAnimationManager = e
            })
        },
        loadBone: function(t, e) {
            var i = this._loadedFiles.glTF
              , n = i.nodes[t]
              , r = this
              , a = i.accessors[e.inverseBindMatrices]
              , s = this.loadAccessorBuffer(a, null);
            return s.then(function(i) {
                for (var a = 0; a < e.jointNames.length && e.jointNames[a] !== n.jointName; ++a)
                    ;
                var s = new c(n.jointName)
                  , o = i.subarray(16 * a, 16 * a + 16);
                return s.setInvBindMatrixInSkeletonSpace(o),
                r._bones[t] = s,
                s
            })
        },
        buildInfluenceMap: function(t, e) {
            if (!this._skeletonToInfluenceMap[t]) {
                this._skeletonToInfluenceMap[t] = {};
                for (var i = 0; i < e.jointNames.length; i++) {
                    var n = e.jointNames[i];
                    this._skeletonToInfluenceMap[t][n] = i
                }
            }
        },
        mapBonesToSkin: function() {
            for (var t = this._loadedFiles.glTF, e = {}, i = window.Object.keys(t.skins), n = 0; n < i.length; ++n)
                for (var r = t.skins[i[n]], a = 0; a < r.jointNames.length; ++a)
                    for (var s = r.jointNames[a], o = window.Object.keys(t.nodes), u = 0; u < o.length; ++u) {
                        var l = t.nodes[o[u]];
                        l.jointName && l.jointName === s && (e[o[u]] = r)
                    }
            return e
        },
        preprocessBones: function(t) {
            for (var e = this._loadedFiles.glTF, i = window.Object.keys(e.nodes), n = [], r = 0; r < i.length; ++r) {
                var a = i[r]
                  , s = e.nodes[a];
                if (s.jointName) {
                    var o = this.loadBone(a, t[a]);
                    n.push(o)
                }
            }
            return Promise.all(n)
        },
        preprocessSkeletons: function() {
            var t = this._loadedFiles.glTF;
            if (!t.skins)
                return Promise.resolve();
            for (var e = this.mapBonesToSkin(), i = window.Object.keys(t.nodes), n = 0; n < i.length; ++n) {
                var r = i[n]
                  , a = t.nodes[r]
                  , s = t.skins[a.skin];
                if (a.skeletons)
                    for (var o = 0; o < a.skeletons.length; ++o) {
                        for (var u = null, c = a.skeletons[o], h = 0; h < i.length; ++h) {
                            var d = i[h]
                              , p = t.nodes[d];
                            if (p.jointName && p.jointName === c) {
                                u = d;
                                break
                            }
                        }
                        u && !this._skeletons[u] && (this._skeletons[c] = new l,
                        e[u] = s),
                        this.buildInfluenceMap(c, s)
                    }
            }
            var f = this.preprocessBones(e);
            return f
        },
        loadPBRMaterial: function(t, e, i) {
            var n = e.materialModel
              , r = e.values;
            if (!r)
                return Promise.resolve();
            var a = i.getOrCreateStateSet()
              , s = [];
            return n === F.PBR_METAL_MODE ? (s.push(this.createTextureAndSetAttrib(r.baseColorTexture, a, F.ALBEDO_TEXTURE_UNIT, F.ALBEDO_UNIFORM)),
            s.push(this.createTextureAndSetAttrib(r.roughnessTexture, a, F.ROUGHNESS_TEXTURE_UNIT, F.ROUGHNESS_UNIFORM)),
            s.push(this.createTextureAndSetAttrib(r.metallicTexture, a, F.METALNESS_TEXTURE_UNIT, F.SPECULAR_UNIFORM)),
            s.push(this.createTextureAndSetAttrib(r.normalTexture, a, F.NORMAL_TEXTURE_UNIT, F.NORMAL_UNIFORM)),
            s.push(this.createTextureAndSetAttrib(r.aoTexture, a, F.AO_TEXTURE_UNIT, F.AO_UNIFORM))) : n === F.PBR_SPEC_MODE && (s.push(this.createTextureAndSetAttrib(r.diffuseTexture, a, F.DIFFUSE_TEXTURE_UNIT, F.ALBEDO_UNIFORM)),
            s.push(this.createTextureAndSetAttrib(r.glossinessTexture, a, F.GLOSSINESS_TEXTURE_UNIT, F.ROUGHNESS_UNIFORM)),
            s.push(this.createTextureAndSetAttrib(r.specularTexture, a, F.SPECULAR_TEXTURE_UNIT, F.SPECULAR_UNIFORM)),
            s.push(this.createTextureAndSetAttrib(r.normalTexture, a, F.NORMAL_TEXTURE_UNIT, F.NORMAL_UNIFORM)),
            s.push(this.createTextureAndSetAttrib(r.aoTexture, a, F.AO_TEXTURE_UNIT, F.AO_UNIFORM))),
            i.setUserData({
                pbrWorklow: n
            }),
            i.stateset = a,
            this._stateSetMap[t] = a,
            Promise.all(s)
        },
        loadMaterial: function(t, e) {
            var i = this._loadedFiles.glTF
              , n = i.materials[t];
            if (this._stateSetMap[t])
                return e.stateset = this._stateSetMap[t],
                Promise.resolve();
            var r = this.findByKey(n.extensions, F.PBR_EXTENSION);
            if (r)
                return this.loadPBRMaterial(t, r, e);
            var a = n.values;
            if (!a)
                return Promise.resolve();
            var s = new A
              , o = e.getOrCreateStateSet();
            if (o.setAttribute(s),
            a.ambient && s.setAmbient(a.ambient),
            a.emission && s.setEmission(a.emission),
            a.shininess && s.setShininess(a.shininess),
            a.specular && s.setSpecular(a.specular),
            a.diffuse) {
                if ("string" == typeof a.diffuse)
                    return this.createTextureAndSetAttrib(a.diffuse, o, 0);
                s.setDiffuse(a.diffuse)
            }
            return e.stateset = o,
            this._stateSetMap[t] = o,
            Promise.resolve()
        },
        createGeometry: function(t, e) {
            var i = this._loadedFiles.glTF
              , n = []
              , r = new _
              , a = r
              , s = function(t, e) {
                e && (this.getVertexAttributeList()[t] = e)
            };
            e && (a = new f,
            a._boneNameID = this._skeletonToInfluenceMap[e]);
            for (var o = function(t) {
                if (t) {
                    a.getAttributes().Weights = t;
                    for (var e = a.getAttributes().Weights.getElements(), i = 0, n = e.length / 4; i < n; ++i) {
                        var r = e[4 * i] + e[4 * i + 1] + e[4 * i + 2] + e[4 * i + 3]
                          , s = 1 / r;
                        e[4 * i] *= s,
                        e[4 * i + 1] *= s,
                        e[4 * i + 2] *= s,
                        e[4 * i + 3] *= s
                    }
                }
            }, u = window.Object.keys(t.attributes), l = 0; l < u.length; ++l) {
                var c = i.accessors[t.attributes[u[l]]]
                  , h = this.loadAccessorBuffer(c, C.ARRAY_BUFFER);
                if (u[l].indexOf("POSITION") !== -1)
                    h.then(s.bind(r, "Vertex"));
                else if (u[l].indexOf("NORMAL") !== -1)
                    h.then(s.bind(r, "Normal"));
                else if (u[l].indexOf("TANGENT") !== -1)
                    h.then(s.bind(r, "Tangent"));
                else if (u[l].indexOf("JOINT") !== -1)
                    h.then(s.bind(a, "Bones"));
                else if (u[l].indexOf("WEIGHT") !== -1)
                    h.then(o);
                else if (u[l].indexOf("TEXCOORD") !== -1) {
                    var d = u[l].substr(9);
                    h.then(s.bind(r, "TexCoord" + d))
                }
                n.push(h)
            }
            var p = i.accessors[t.indices]
              , g = this.loadAccessorBuffer(p, C.ELEMENT_ARRAY_BUFFER);
            return g.then(function(t) {
                if (t) {
                    var e = new y(S.TRIANGLES,t);
                    r.getPrimitives().push(e)
                }
            }),
            n.push(g),
            t.material && n.push(this.loadMaterial(t.material, r)),
            Promise.all(n).then(function() {
                return e && (a.setSourceGeometry(r),
                a.mergeChildrenData(),
                a.computeBoundingBox = r.computeBoundingBox),
                a
            })
        },
        loadGLTFPrimitives: function(t, e, i) {
            for (var n = this._loadedFiles.glTF, r = n.meshes[t], a = r.primitives, s = [], o = 0; o < a.length; ++o) {
                var u = a[o]
                  , l = this.createGeometry(u, i);
                s.push(l)
            }
            return Promise.all(s).then(function(t) {
                for (var i = 0; i < t.length; ++i)
                    e.addChild(t[i]);
                return t
            })
        },
        loadGLTFNode: function(t, e) {
            if (this._visitedNodes[t])
                return Promise.resolve();
            var i = this._loadedFiles.glTF
              , n = i.nodes[t]
              , r = n.children
              , a = 0
              , s = null;
            if (s = n.jointName ? this._bones[t] : new x,
            n.jointName && this._skeletons[n.jointName]) {
                var o = this._skeletons[n.jointName];
                o.addChild(s),
                e.addChild(o)
            }
            s.setName(t),
            k.copy(s.getMatrix(), this.loadTransform(n));
            var u = [];
            if (r)
                for (a = 0; a < r.length; ++a) {
                    var l = this.loadGLTFNode(r[a], s);
                    u.push(l)
                }
            if (n.meshes)
                for (a = 0; a < n.meshes.length; ++a) {
                    var c = n.meshes[a];
                    if (n.skeletons)
                        for (var h = 0; h < n.skeletons.length; ++h) {
                            var d = n.skeletons[h]
                              , p = this._skeletons[d]
                              , f = new x;
                            k.copy(f.getMatrix(), s.getMatrix());
                            var g = this.loadGLTFPrimitives(c, f, d);
                            p.addChild(f),
                            u.push(g)
                        }
                    else {
                        var m = this.loadGLTFPrimitives(c, s, null);
                        u.push(m)
                    }
                }
            return this._animatedNodes[t] && this.registerUpdateCallback(t, s),
            this._skeletons[t] || e.addChild(s),
            this._visitedNodes[t] = !0,
            Promise.all(u)
        },
        readNodeURL: function(t, e) {
            var i = this;
            this.init(),
            this._files = t,
            this._preloaded = e ? e.preloaded : null,
            this._preloaded && this.preloadFiles(t);
            var n = this.loadGLTFJson(this._files)
              , r = new x;
            return r.setName("root"),
            n.then(function(t) {
                i._loadedFiles.glTF = JSON.parse(t);
                var e = i._loadedFiles.glTF;
                if (!e)
                    return Promise.resolve(null);
                var n = []
                  , a = i.preprocessAnimations()
                  , s = i.preprocessSkeletons();
                return n.push(s, a),
                Promise.all(n).then(function() {
                    for (var t = [], n = window.Object.keys(e.scenes), a = 0; a < n.length; ++a) {
                        var s = e.scenes[n[a]];
                        if (s)
                            for (var o = 0; o < s.nodes.length; ++o) {
                                var u = i.loadGLTFNode(s.nodes[o], r);
                                t.push(u)
                            }
                    }
                    return i._basicAnimationManager && r.addUpdateCallback(i._basicAnimationManager),
                    Promise.all(t).then(function() {
                        return r
                    })
                })
            })
        }
    },
    a.instance().addReaderWriter("gltf", new F),
    t.exports = F
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = i(1459)
      , s = i(1460)
      , o = i(1461)
      , u = i(1463)
      , l = r.osg
      , c = function() {}
      , h = function(t, e, i) {
        i ? l.error("ResourceLoader: " + t + " failed " + e + " error " + i) : l.error("ResourceLoader: " + t + " failed " + e)
    }
      , d = function() {
        this._nbThreads = 5,
        this._processing = [],
        this._queue = [],
        this._finished = [],
        this._running = !1
    };
    d.prototype = {
        checkResource: function(t) {
            var e;
            return [this._processing, this._queue, this._finished].forEach(function(i) {
                e || (e = n.find(i, function(e) {
                    return e._url === t
                }))
            }),
            e
        },
        run: function() {
            this._running = !0,
            this.runPendingProcess()
        },
        runPendingProcess: function() {
            for (; this._processing.length < this._nbThreads && this._queue.length > 0; ) {
                var t = this._queue.shift();
                this._processing.push(t),
                t.start()
            }
        },
        queue: function(t) {
            var e = t;
            t.start || (console.log(t.url),
            e = new a(t.url,t.response)),
            this._queue.push(e);
            var i = function() {
                this._processing.splice(this._processing.indexOf(e), 1),
                this._finished.push(e),
                this.runPendingProcess()
            }
            .bind(this)
              , n = function() {
                this._processing.splice(this._processing.indexOf(e), 1),
                this.runPendingProcess()
            }
            .bind(this);
            return e.getPromise().then(i)["catch"](n).done(),
            this._running && this.runPendingProcess(),
            e
        },
        getModel: function(t, e) {
            var i = this.checkResource(t);
            return i ? i : (i = this.queue(new s(t,"text",e)),
            i.getPromise().then(function() {
                c(t, "model")
            })["catch"](function(e) {
                h(t, "model", e)
            }).done(),
            i)
        },
        getImage: function(t, e) {
            var i = this.checkResource(t);
            if (i)
                return i;
            var n = e || {}
              , r = "data:image" === t.substr(0, "data:image".length);
            return r || (n.crossOrigin = "anonymous"),
            i = this.queue(new o(t,n)),
            i.getPromise().then(function() {
                c(t, "image")
            })["catch"](function() {
                h(t, "image")
            }).done(),
            i
        },
        getBinaryArray: function(t, e) {
            var i = this.checkResource(t);
            return i ? i : (i = this.queue(new u(t,e)),
            i.getPromise().then(function() {
                c(t, "binary array")
            })["catch"](function(e) {
                h(t, "binary array", e)
            }).done(),
            i)
        }
    },
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = function(t, e, i) {
        this._url = t,
        this._defer = n.defer(),
        this._responseType = e,
        this._promise = this._defer.promise,
        this._options = i
    };
    r.prototype = {
        getPromise: function() {
            return this._promise
        },
        getURL: function() {
            return this._url
        },
        start: function() {
            this._xhr = new XMLHttpRequest,
            this._xhr.addEventListener("error", this.error.bind(this), !1),
            this._xhr.addEventListener("abort", this.abort.bind(this), !1),
            this._xhr.addEventListener("progress", this.progress.bind(this), !1),
            this._xhr.addEventListener("load", function(t) {
                return 200 !== this._xhr.status ? (console.log("Error not loaded " + this._url),
                void this.error(t)) : (this._xhr.response || (this._xhr.response = this._xhr.responseText),
                void this.load.call(this))
            }
            .bind(this), !1),
            this._xhr.open("GET", this._url, !0),
            this._xhr.responseType = this._responseType,
            this._xhr.send(null)
        },
        error: function() {
            console.log("Error not loaded " + this._url),
            this._defer.reject(this)
        },
        abort: function() {
            console.log("Error not loaded " + this._url),
            this._defer.reject(this)
        },
        progress: function(t) {
            var e = this._options;
            e && e.progress && e.size && e.progress(t.loaded / e.size, e.secondary, e.idChannel)
        },
        load: function() {
            this._defer.resolve(this)
        },
        getXHR: function() {
            return this._xhr
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1459)
      , a = function() {
        r.apply(this, arguments)
    };
    a.prototype = n.extend({}, r.prototype, {
        load: function() {
            this._model = this._xhr.response,
            this._defer.resolve(this._model)
        },
        getModel: function() {
            return this._model
        }
    }),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = i(1459)
      , s = i(1462)
      , o = r.osg
      , u = 0
      , l = Math.max(2, Math.min(4, navigator.hardwareConcurrency || 2))
      , c = []
      , h = URL.createObjectURL(new Blob([s],{
        type: "text/javascript"
    }))
      , d = {}
      , p = {}
      , f = function() {
        var t = c[u];
        return t || (t = c[u] = new Worker(h),
        t.onmessage = function(t) {
            var e = t.data
              , i = p[e.uid];
            i.setImage(e.img),
            i.setWidth(e.width),
            i.setHeight(e.height),
            d[e.uid]()
        }
        ),
        u = (u + 1) % l,
        t
    }
      , g = function(t, e) {
        a.call(this, t, "blob", e),
        this._responseType = "arraybuffer"
    };
    g.prototype = n.extend({}, a.prototype, {
        isVideo: function(t) {
            var e = t.split(".")
              , i = e[e.length - 1].toLowerCase();
            return "ogv" === i || "ogg" === i || "mp4" === i || "avi" === i || "webm" === i
        },
        createVideo: function() {
            var t = document.createElement("video");
            return document.body.appendChild(t),
            t.style.display = "none",
            t
        },
        start: function() {
            var t = this.getURL();
            if (this.isVideo(t)) {
                var e = this.createVideo();
                this._image = new o.ImageStream(e),
                window.video = this._image,
                e.preload = "auto",
                e.crossOrigin = "anonymous",
                e.src = t,
                this._image.whenReady().then(function(t) {
                    t.play(),
                    this._defer.resolve(this._image)
                }
                .bind(this))
            } else {
                this._image = new o.Image;
                var i = this._options;
                i.panoramaLUV || i.integrateBRDFLUV || i.cubemapLUV ? a.prototype.start.call(this) : ".astc.gz" === this._url.substr(-8) ? (i.astc = !0,
                a.prototype.start.call(this)) : this.loadImage()
            }
        },
        load: function() {
            var t = this._options;
            t.panoramaLUV || t.integrateBRDFLUV ? this.loadLUV() : t.cubemapLUV ? this.loadCubemapLUV() : t.astc && this.loadASTC()
        },
        loadImageAsync: function() {},
        loadASTC: function() {
            var t = this._xhr.response;
            d[this._url] = this._defer.resolve.bind(this._defer, this._image),
            p[this._url] = this._image,
            f().postMessage({
                buffer: t,
                swizzle: !0,
                uid: this._url,
                nbComponents: 3
            }, [t])
        },
        loadImage: function() {
            var t = new Image;
            this._options.crossOrigin && (t.crossOrigin = this._options.crossOrigin),
            this._image.setImage(t),
            t.onload = this._defer.resolve.bind(this._defer, this._image),
            t.onerror = this._defer.reject.bind(this._defer, this._image),
            this._imgHtmlTag = t,
            t.src = this._url
        },
        abortImage: function() {
            this._imgHtmlTag && (this._imgHtmlTag.src = "")
        },
        loadLUV: function() {
            var t, e = this._xhr.response, i = Math.sqrt(e.byteLength / 4);
            t = this._options.integrateBRDFLUV ? new Uint8Array(e) : this.deinterleaveImage4(i, new Uint8Array(e), new Uint8Array(e.byteLength));
            var n = this._image;
            n.setImage(t),
            n.setWidth(i),
            n.setHeight(i),
            this._defer.resolve(this._image)
        },
        loadCubemapLUV: function() {
            for (var t = this._xhr.response, e = Math.log(this._options.size) / Math.LN2, i = 0, n = {}, r = 0; r <= e && !(i >= t.byteLength); r++)
                for (var a = Math.pow(2, e - r), s = 0; s < 6; s++) {
                    n[o.Texture.TEXTURE_CUBE_MAP_POSITIVE_X + s] || (n[o.Texture.TEXTURE_CUBE_MAP_POSITIVE_X + s] = []);
                    var u = a * a * 4
                      , l = new Uint8Array(u);
                    this.deinterleaveImage4(a, new Uint8Array(t,i,u), l);
                    var c = new o.Image;
                    c.setImage(l),
                    c.setWidth(a),
                    c.setHeight(a),
                    n[o.Texture.TEXTURE_CUBE_MAP_POSITIVE_X + s].push(c),
                    i += u
                }
            this._defer.resolve(n)
        },
        deinterleaveImage4: function(t, e, i) {
            for (var n = t * t, r = 2 * t * t, a = 3 * t * t, s = 0, o = 0; o < n; o++)
                i[s++] = e[o],
                i[s++] = e[o + n],
                i[s++] = e[o + r],
                i[s++] = e[o + a];
            return i
        },
        getImage: function() {
            return this._image
        }
    }),
    t.exports = g
}
, function(t, e) {
    t.exports = "(function webpackUniversalModuleDefinition(root, factory) {\n  if(typeof exports === 'object' && typeof module === 'object')\n    module.exports = factory();\n  else if(typeof define === 'function' && define.amd)\n    define([], factory);\n  else {\n    var a = factory();\n    for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n  }\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/  // The module cache\n/******/  var installedModules = {};\n\n/******/  // The require function\n/******/  function __webpack_require__(moduleId) {\n\n/******/    // Check if module is in cache\n/******/    if(installedModules[moduleId])\n/******/      return installedModules[moduleId].exports;\n\n/******/    // Create a new module (and put it into the cache)\n/******/    var module = installedModules[moduleId] = {\n/******/      exports: {},\n/******/      id: moduleId,\n/******/      loaded: false\n/******/    };\n\n/******/    // Execute the module function\n/******/    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/    // Flag the module as loaded\n/******/    module.loaded = true;\n\n/******/    // Return the exports of the module\n/******/    return module.exports;\n/******/  }\n\n\n/******/  // expose the modules object (__webpack_modules__)\n/******/  __webpack_require__.m = modules;\n\n/******/  // expose the module cache\n/******/  __webpack_require__.c = installedModules;\n\n/******/  // __webpack_public_path__\n/******/  __webpack_require__.p = \"\";\n\n/******/  // Load entry module and return exports\n/******/  return __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var decompressor = __webpack_require__( 1 );\n\n  /*jshint worker: true */\n\n  self.onmessage = function ( event ) {\n      var input = event.data;\n      var result = decompressor.decompress( input.buffer );\n\n      var img = new Uint8Array( result.img.buffer );\n      var width = result.width;\n      var height = result.height;\n\n      if ( input.swizzle ) {\n          var nbComponents = input.nbComponents || 3;\n          var nbPixel = width * height * 4;\n          for ( var i = 0, j = 0; i < nbPixel; i += 4, j += nbComponents ) {\n              var r = img[ i ];\n              var a = img[ i + 3 ];\n\n              var x = ( r / 255.0 ) * 2.0 - 1.0;\n              var y = ( a / 255.0 ) * 2.0 - 1.0;\n              var z = Math.sqrt( 1.0 - x * x - y * y );\n              z = Math.round( ( z * 0.5 + 0.5 ) * 255.0 );\n\n              img[ j ] = r;\n              img[ j + 1 ] = a;\n              img[ j + 2 ] = z;\n          }\n\n          img = img.subarray( 0, width * height * nbComponents );\n      }\n\n      postMessage( {\n          img: img,\n          width: width,\n          height: height,\n          uid: input.uid || 'uid'\n      }, [ img.buffer ] );\n  };\n\n  /*jshint worker: false */\n\n  module.exports = {\n      astcDecompressor: decompressor\n  };\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var precompute = __webpack_require__(2);\n  var cacheUnquantizeSimple = precompute.cacheUnquantizeSimple;\n  var cacheUnquantizeTrits = precompute.cacheUnquantizeTrits;\n  var cacheUnquantizeQuints = precompute.cacheUnquantizeQuints;\n  var cacheDecodeSimple = precompute.cacheDecodeSimple;\n  var cacheDecodeTrits = precompute.cacheDecodeTrits;\n  var cacheDecodeQuints = precompute.cacheDecodeQuints;\n\n  var bitUtils = __webpack_require__(3);\n  var popCount = bitUtils.popCount;\n  var readBits = bitUtils.readBits;\n  var writeBits = bitUtils.writeBits;\n  var extractBits = bitUtils.extractBits;\n  var replicateBits = bitUtils.replicateBits;\n  var bitTransferSigned = bitUtils.bitTransferSigned;\n  var reverseU8Array = bitUtils.reverseU8Array;\n\n\n  // Counting how many bits have been read for each block\n  // the value is reseted when computing a new block\n  var bitsReadCount = 0;\n  // Counting how many bits have been written\n  // useful when extracting color endpoint data\n  var bitsWrittenCount = 0;\n  // Counting how many bits have been read in the\n  // current block color data stream\n  var colorDataBitsRead = 0;\n  // Keeping track of the current index\n  // when calling the computeEndpoints routine\n  var decodedColorValuesIdx = 0;\n\n  // Contains the information\n  // of the current processed block\n  var CURRENT_BLOCK_INFO = {};\n  // Describes how trit/quint/bit is packed\n  // for a single encoded integer in the maxWeightQuintsTritsMapper\n  var TRIT_IDX = 0;\n  var QUINT_IDX = 1;\n  var BIT_IDX = 2;\n\n  // Maximum number of encoded values = 288\n  var resultDecodedStorage = new Uint16Array(288 * 6);\n  var subDecodedValue = new Array(8);\n  var classSelectorBitsArray = new Uint8Array(4);\n  var colorModeLSB = new Uint8Array(4);\n  var texelWeightData = new Uint8Array(16);\n  var colorEndpointData = new Uint8Array(16);\n  var endpoints = new Uint8Array(4 * 2 * 4);\n  var blockPixelsOutput = null;\n\n  /**\n   * Encodes a given value into its quints/trits/bits representation\n   * @param  {uint} val the value to encode\n   * @return {Object} contains the number of trits/quints/bits to encode the given value.\n   */\n  var getEncodedInteger = function(val) {\n    var encodedInt = {\n      trits: 0,\n      quints: 0,\n      bits: 0,\n      tritValue: 0,\n      quintValue: 0,\n      bitValue: 0\n    };\n    while (val > 0) {\n      var check = val + 1;\n\n      if (!(check & (check - 1))) {\n        encodedInt.bits = popCount(val);\n        return encodedInt;\n      }\n      if ((check % 3 === 0) && !(Math.floor(check / 3) & Math.floor((check / 3) - 1))) {\n        encodedInt.bits = popCount(Math.floor(check / 3 - 1));\n        encodedInt.trits = 1;\n        return encodedInt;\n      }\n      if ((check % 5 === 0) && !(Math.floor(check / 5) & Math.floor((check / 5) - 1))) {\n        encodedInt.bits = popCount(Math.floor(check / 5 - 1));\n        encodedInt.quints = 1;\n        return encodedInt;\n      }\n\n      val--;\n    }\n    return encodedInt;\n  };\n\n  var replicateBits0816Map = new Uint16Array(256);\n  for (var i = 0; i < 256; ++i)\n    replicateBits0816Map[i] = replicateBits(i, 8, 16);\n\n  var maxWeightQuintsTritsMapper = new Uint16Array(256 * 3);\n  var idx = 0;\n  for (var i = 0; i < 256; i++) {\n    var encodedInt = getEncodedInteger(i);\n    maxWeightQuintsTritsMapper[idx + TRIT_IDX] = encodedInt.trits;\n    maxWeightQuintsTritsMapper[idx + QUINT_IDX] = encodedInt.quints;\n    maxWeightQuintsTritsMapper[idx + BIT_IDX] = encodedInt.bits;\n\n    idx += 3;\n  }\n\n  /**\n   * Gives additional precision to RGB colors near gray\n   * pixel is changed in-place in the endpoints array\n   * Refers to ASTC specifications (Section 3.8)\n   * @param  {int} a the alpha channel component\n   * @param  {int} r the red channel component\n   * @param  {int} g the green channel component\n   * @param  {int} b the blue channel component\n   */\n  var blueContract = function(a, r, g, b) {\n    var idx = endpoints.currIdx;\n    endpoints[idx] = a;\n    endpoints[idx + 1] = (r + b) >> 1;\n    endpoints[idx + 2] = (g + b) >> 1;\n    endpoints[idx + 3] = b;\n  };\n\n  /**\n   * Expands a given seed\n   * Refers to ASTC specifications (Section 3.15)\n   * @param  {uint32} p the seed to expand\n   * @return {uint32} the processed expanded seed\n   */\n  var hash52 = function(p) {\n    p ^= (p >>> 15) >>> 0;\n    p -= (p << 17) >>> 0;\n    p += (p << 7) >>> 0;\n    p += (p << 4) >>> 0;\n    p ^= (p >>> 5) >>> 0;\n    p += (p << 16) >>> 0;\n    p ^= (p >>> 7) >>> 0;\n    p ^= (p >>> 3) >>> 0;\n    p ^= (p << 6) >>> 0;\n    p ^= (p >>> 17) >>> 0;\n\n    return p;\n  };\n\n  /**\n   * Computes the partition index for a given texel\n   * @param  {uint32} seed partition pattern index\n   * @param  {int} x texel x position withing the block\n   * @param  {int} y texel y position withing the block\n   * @param  {int} z texel z position withing the block\n   * @param  {uint} partitionCount maximum number of existing partitions\n   * @param  {bool} smallBlock set to true, number of texel in the block is less than 31\n   * @return {uint} the partition index of the given texel\n   */\n\n  var seedsPartitionTable = new Uint8Array(12);\n\n  var precomputeSelectPartition = function(seed, partitionCount) {\n\n    // Refers to ASTC specifications (Section 3.15)\n    seed += (partitionCount - 1) * 1024;\n    var seedUint32 = seed >>> 0;\n\n    var rnum = hash52(seedUint32);\n\n    // The seeds values should be saved in an uint8 variable\n    seedsPartitionTable[0] = rnum & 0xF;\n    seedsPartitionTable[1] = (rnum >> 4) & 0xF;\n    seedsPartitionTable[2] = (rnum >> 8) & 0xF;\n    seedsPartitionTable[3] = (rnum >> 12) & 0xF;\n    seedsPartitionTable[4] = (rnum >> 16) & 0xF;\n    seedsPartitionTable[5] = (rnum >> 20) & 0xF;\n    seedsPartitionTable[6] = (rnum >> 24) & 0xF;\n    seedsPartitionTable[7] = (rnum >> 28) & 0xF;\n    seedsPartitionTable[8] = (rnum >> 18) & 0xF;\n    seedsPartitionTable[9] = (rnum >> 22) & 0xF;\n    seedsPartitionTable[10] = (rnum >> 26) & 0xF;\n    seedsPartitionTable[11] = ((rnum >> 30) | (rnum << 2)) & 0xF;\n\n    seedsPartitionTable[0] *= seedsPartitionTable[0];\n    seedsPartitionTable[1] *= seedsPartitionTable[1];\n    seedsPartitionTable[2] *= seedsPartitionTable[2];\n    seedsPartitionTable[3] *= seedsPartitionTable[3];\n    seedsPartitionTable[4] *= seedsPartitionTable[4];\n    seedsPartitionTable[5] *= seedsPartitionTable[5];\n    seedsPartitionTable[6] *= seedsPartitionTable[6];\n    seedsPartitionTable[7] *= seedsPartitionTable[7];\n    seedsPartitionTable[8] *= seedsPartitionTable[8];\n    seedsPartitionTable[9] *= seedsPartitionTable[9];\n    seedsPartitionTable[10] *= seedsPartitionTable[10];\n    seedsPartitionTable[11] *= seedsPartitionTable[11];\n\n    var sh1 = 0;\n    var sh2 = 0;\n    var sh3 = 0;\n    if (seed & 1) {\n      sh1 = (seed & 2) ? 4 : 5;\n      sh2 = (partitionCount === 3) ? 6 : 5;\n    } else {\n      sh1 = (partitionCount === 3) ? 6 : 5;\n      sh2 = (seed & 2) ? 4 : 5;\n    }\n    sh3 = (seed & 0x10) ? sh1 : sh2;\n\n    seedsPartitionTable[0] >>= sh1;\n    seedsPartitionTable[1] >>= sh2;\n    seedsPartitionTable[2] >>= sh1;\n    seedsPartitionTable[3] >>= sh2;\n    seedsPartitionTable[4] >>= sh1;\n    seedsPartitionTable[5] >>= sh2;\n    seedsPartitionTable[6] >>= sh1;\n    seedsPartitionTable[7] >>= sh2;\n    seedsPartitionTable[8] >>= sh3;\n    seedsPartitionTable[9] >>= sh3;\n    seedsPartitionTable[10] >>= sh3;\n    seedsPartitionTable[11] >>= sh3;\n\n    return rnum;\n  };\n\n  var selectPartition = function(rnum, x, y, z, partitionCount, smallBlock) {\n    if (partitionCount === 1)\n      return 0;\n\n    if (smallBlock) {\n      x <<= 1;\n      y <<= 1;\n      z <<= 1;\n    }\n\n    var a = seedsPartitionTable[0] * x + seedsPartitionTable[1] * y + seedsPartitionTable[10] * z + (rnum >> 14);\n    var b = seedsPartitionTable[2] * x + seedsPartitionTable[3] * y + seedsPartitionTable[11] * z + (rnum >> 10);\n    var c = seedsPartitionTable[4] * x + seedsPartitionTable[5] * y + seedsPartitionTable[8] * z + (rnum >> 6);\n    var d = seedsPartitionTable[6] * x + seedsPartitionTable[7] * y + seedsPartitionTable[9] * z + (rnum >> 2);\n\n    a &= 0x3F;\n    b &= 0x3F;\n    c &= 0x3F;\n    d &= 0x3F;\n\n    if (partitionCount < 4)\n      d = 0;\n    if (partitionCount < 3)\n      c = 0;\n\n    if (a >= b && a >= c && a >= d)\n      return 0;\n    else if (b >= c && b >= d)\n      return 1;\n    else if (c >= d)\n      return 2;\n\n    return 3;\n  };\n\n  /**\n   * Simple swap util procedure swapping to cells in a given array\n   * @param  {array} array contains the cells to swap\n   * @param  {uint} i the first index\n   * @param  {uint} j the second index\n   */\n  var swapCell = function(array, i, j) {\n    var a = array[i];\n    array[i] = array[j];\n    array[j] = a;\n  };\n\n  /**\n   * Computes the total number of bits required to encoded\n   * the same encoded integer a given amount of times.\n   * @param  {uint} nbValues the number of encoded values\n   * @param  {[type]} encodedInteger the encoded value\n   * @return {uint} the number of bits to encoded nbValues of encodedInteger\n   */\n  var getBitsNbrFromEncodedInt = function(nbValues, trits, quints, bits) {\n    var totalBits = bits * nbValues;\n\n    if (trits)\n      totalBits += Math.floor((nbValues * 8 + 4) / 5);\n    else if (quints)\n      totalBits += Math.floor((nbValues * 7 + 2) / 3);\n\n    return totalBits;\n  };\n\n  /**\n   * Computes the number of weight values\n   * available in a given block\n   * @param  {Object} blockInfo the block info containing block size, max weight, etc...\n   * @return {uint} the number of weight values encoded inside the block\n   */\n  var getNumberWeightValues = function(blockInfo) {\n    var nbValues = blockInfo.width * blockInfo.height;\n    if (blockInfo.dualPlane)\n      nbValues *= 2;\n\n    // max nbValues = 12*12*2\n    return nbValues;\n  };\n\n\n  /**\n   * Computes the total number of bits needed to\n   * encode all the weights using Integer Sequence Encoding\n   * @param  {Object} blockInfo the block info containing block size, max weight, etc...\n   * @return {uint} the number of required bits to encoded the weights.\n   */\n  var getPackedBitSize = function(blockInfo) {\n    var nbValues = getNumberWeightValues(blockInfo);\n\n    var idx = blockInfo.maxWeight * 3;\n    var trits = maxWeightQuintsTritsMapper[idx + TRIT_IDX];\n    var quints = maxWeightQuintsTritsMapper[idx + QUINT_IDX];\n    var bits = maxWeightQuintsTritsMapper[idx + BIT_IDX];\n\n    return getBitsNbrFromEncodedInt(nbValues, trits, quints, bits);\n  };\n\n  /**\n   * Reads n values from a given array\n   * @param  {array} decodedColorValues the array to read\n   * @param  {uint} n the number of array cells to read\n   * @return {array} sub-array containing the read data\n   */\n  var readNDecodedColor = function(decodedColorValues, n) {\n    for (var i = 0; i < n; ++i)\n      subDecodedValue[i] = decodedColorValues[decodedColorValuesIdx++];\n    return subDecodedValue;\n  };\n\n  /**\n   * Clamps a pixel to the [0...255] range\n   * @param  {uint} beginIdx the index of the pixel alpha channel\n   * in the endpoints global array\n   */\n  var clampPixel = function(beginIdx) {\n    for (var i = 0; i < 4; ++i)\n      endpoints[beginIdx + i] = Math.max(0, Math.min(255, endpoints[beginIdx + i]));\n  };\n\n  /**\n   * Fills the endpoints global array with the given channel colors\n   * @param  {int} a the alpha channel component\n   * @param  {int} r the red channel component\n   * @param  {int} g the green channel component\n   * @param  {int} b the blue channel component\n   */\n  var fillEndpointsWithPixel = function(a, r, g, b) {\n    var idx = endpoints.currIdx;\n    endpoints[idx] = a;\n    endpoints[idx + 1] = r;\n    endpoints[idx + 2] = g;\n    endpoints[idx + 3] = b;\n  };\n\n  /**\n   * Parses the first 16 bytes a buffer\n   * considering it as an ASTC file buffer.\n   * @param  {ArrayBuffer} imgBuffer buffer containing the ASTC raw data\n   * @return {Object} contains data about the compressed image\n   */\n  var parseHeader = function(imgBuffer) {\n    var header = {};\n\n    var u8buffer = new Uint8Array(imgBuffer);\n    var u32Buffer = new Uint32Array(imgBuffer);\n\n    header.magic = u32Buffer[0];\n\n    var littleEndian = u8buffer[0] === (header.magic & 0xFF);\n\n    var isFormatCorrect = false;\n    if (littleEndian && header.magic === 0x5CA1AB13)\n      isFormatCorrect = true;\n    else if (!littleEndian && header.magic === 0x13ABA15C)\n      isFormatCorrect = true;\n\n    if (!isFormatCorrect)\n      console.error('The ASTC header does not meet the requirements.');\n\n    header.blockDimX = u8buffer[4];\n    header.blockDimY = u8buffer[5];\n    header.blockDimZ = u8buffer[6];\n\n    if (header.blockDimX > 12 || header.blockDimY > 12)\n      console.error('Incorrect ASTC file: block can not be larger than 12x12 pixels.');\n    if (header.blockDimZ > 1)\n      console.error('3D ASTC file are not supported.');\n\n    // Image width\n    header.xSize = u8buffer[7] + (u8buffer[8] << 8) + (u8buffer[9] << 16);\n    // Image height\n    header.ySize = u8buffer[10] + (u8buffer[11] << 8) + (u8buffer[12] << 16);\n    // Image depth\n    header.zSize = u8buffer[13] + (u8buffer[14] << 8) + (u8buffer[15] << 16);\n\n    if (header.zSize > 1)\n      console.error('3D ASTC file are not supported.');\n\n    return header;\n  };\n\n  /**\n   * Computes the layout of 2D block\n   * @param  {uint} blockModeBits extracted 11 first bit of the block\n   * @return {int} contains the layout of the block [0...9]\n   */\n  var findBlockLayout = function(blockModeBits) {\n    var layout = -1;\n\n    // Layout is in [0-4]\n    if ((blockModeBits & 0x1) || blockModeBits & 0x2) {\n      // layout is in [2-4]\n      if (blockModeBits & 0x8) {\n        // layout is in [3-4]\n        if (blockModeBits & 0x4)\n          layout = (blockModeBits & 0x100) ? 4 : 3;\n        else\n          layout = 2;\n      }\n      // layout is in [0-1]\n      else\n        layout = blockModeBits & 0x4 ? 1 : 0;\n\n      return layout;\n    }\n\n    // Layout is in [7-9]\n    if (blockModeBits & 0x100) {\n      // Layout [7-8]\n      if (blockModeBits & 0x80) {\n        if ((blockModeBits & 0x40))\n          console.error('Invalid block layout found.');\n        layout = (blockModeBits & 0x20) ? 8 : 7;\n      } else\n        layout = 9;\n\n      return layout;\n    }\n\n    layout = (blockModeBits & 0x80) ? 6 : 5;\n    return layout;\n  };\n\n  /**\n   * Extracts data regarding how block data are organized\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the first byte id of the current block\n   * @return {Object} contains block related data (void extent, maximum weight, etc;..)\n   */\n  var getBlockInfo = function(u8buffer, blockId) {\n    var blockInfo = CURRENT_BLOCK_INFO;\n    blockInfo.isVoidExtent = false;\n    blockInfo.error = false;\n\n    // Get the 'block mode' represented by the last 11 bits\n    var blockModeBits = readBits(u8buffer, blockId, bitsReadCount, 11);\n    bitsReadCount += 11;\n\n    // Checks the 9 least significant bits\n    // allowing to know if the block is a void-extent block (uniform color)\n    if ((blockModeBits & 0x01FF) === 0x1FC) {\n      blockInfo.isVoidExtent = true;\n      return blockInfo;\n    }\n\n    // Checks the first reserved pattern\n    // (xxxxx0000)\n    if ((blockModeBits & 0xF) === 0) {\n      blockInfo.error = true;\n      console.log('Warning: Block layout is reserved (xxxxx0000)');\n    }\n\n    // Checks the second reserved pattern\n    // (111xxxx00)\n    if ((blockModeBits & 0x3) === 0 &&\n      (blockModeBits & 0x1C0) === 0x1C0) {\n      blockInfo.error = true;\n      console.log('Warning: Block layout is reserved (111xxxx00)');\n    }\n\n    var layout = findBlockLayout(blockModeBits);\n    if (layout < 0)\n      console.error('Invalid block layout found.');\n\n    // Retrieves the R least significant bit according\n    // to the current block layout\n    var R = !!(blockModeBits & 0x10);\n    if (layout < 5)\n      R |= (blockModeBits & 0x3) << 1;\n    else\n      R |= (blockModeBits & 0xC) >> 1;\n\n    if (R < 2 || R > 7)\n      console.error('Invalid block mode. The file is not encoded in ASTC or corrupted.');\n\n    var a = 0;\n    var b = 0;\n    // Computes weights grid dimension\n    // Refers to ASTC specifications(Table 11)\n    switch (layout) {\n      case 0:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = b + 4;\n        blockInfo.height = a + 2;\n        break;\n      case 1:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = b + 8;\n        blockInfo.height = a + 2;\n        break;\n      case 2:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = a + 2;\n        blockInfo.height = b + 8;\n        break;\n      case 3:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x1;\n        blockInfo.width = a + 2;\n        blockInfo.height = b + 6;\n        break;\n      case 4:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x1;\n        blockInfo.width = b + 2;\n        blockInfo.height = a + 2;\n        break;\n      case 5:\n        a = (blockModeBits >> 5) & 0x3;\n        blockInfo.width = 12;\n        blockInfo.height = a + 2;\n        break;\n      case 6:\n        a = (blockModeBits >> 5) & 0x3;\n        blockInfo.width = a + 2;\n        blockInfo.height = 12;\n        break;\n      case 7:\n        blockInfo.width = 6;\n        blockInfo.height = 10;\n        break;\n      case 8:\n        blockInfo.width = 10;\n        blockInfo.height = 6;\n        break;\n      case 9:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 9) & 0x3;\n        blockInfo.width = a + 6;\n        blockInfo.height = b + 6;\n        break;\n      default:\n        console.error('The block layout is not recognized. Layout should be [0-9].');\n    }\n\n    // The dual plane mode bit is the most significant bit\n    blockInfo.dualPlane = (layout !== 9) && (blockModeBits & 0x400);\n    // The high precision mode bit is the second most significant bit\n    blockInfo.highPrecisionRange = (layout !== 9) && (blockModeBits & 0x200);\n\n    // Selects the appropriate weight range\n    if (blockInfo.highPrecisionRange) {\n      var highWeightRanges = [9, 11, 15, 19, 23, 31];\n      blockInfo.maxWeight = highWeightRanges[R - 2];\n    } else {\n      var weightRanges = [1, 2, 3, 4, 5, 7];\n      blockInfo.maxWeight = weightRanges[R - 2];\n    }\n\n    return blockInfo;\n  };\n\n  /**\n   * Decodes a trit in colorData raw data\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} nbBitsPerValue number of bits\n   * on which the integer is encoded\n   * @param  {array} resultStorage contains decoded integer,\n   * the decoded trit will be pushed back at the end of this procedure\n   */\n\n  var lsbDecodingValues = new Uint8Array(5);\n  var msbDecodingValues = new Uint8Array(5);\n\n  var decodeTrit = function(colorData, nbBitsPerValue) {\n    var m = lsbDecodingValues;\n    var t = msbDecodingValues;\n    var T = 0;\n\n    // Refers to ASTC specifications (Table 17)\n    m[0] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T = readBits(colorData, 0, colorDataBitsRead, 2);\n    colorDataBitsRead += 2;\n\n    m[1] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 2) << 2;\n    colorDataBitsRead += 2;\n\n    m[2] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 1) << 4;\n    colorDataBitsRead += 1;\n\n    m[3] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 2) << 5;\n    colorDataBitsRead += 2;\n\n    m[4] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 1) << 7;\n    colorDataBitsRead += 1;\n\n    var C = 0 >>> 0;\n    if (extractBits(T, 2, 4) === 7) {\n      C = (extractBits(T, 5, 7) << 2) | extractBits(T, 0, 1);\n      t[3] = 2;\n      t[4] = 2;\n    } else {\n      C = extractBits(T, 0, 4);\n      if (extractBits(T, 5, 6) === 3) {\n        t[4] = 2;\n        t[3] = extractBits(T, 7, 7);\n      } else {\n        t[4] = extractBits(T, 7, 7);\n        t[3] = extractBits(T, 5, 6);\n      }\n    }\n\n    if (extractBits(C, 0, 1) === 3) {\n      t[2] = 2;\n      t[1] = extractBits(C, 4, 4);\n      t[0] = (extractBits(C, 3, 3) << 1) | (extractBits(C, 2, 2) & ~extractBits(C, 3, 3));\n    } else if (extractBits(C, 2, 3) === 3) {\n      t[2] = 2;\n      t[1] = 2;\n      t[0] = extractBits(C, 0, 1);\n    } else {\n      t[2] = extractBits(C, 4, 4);\n      t[1] = extractBits(C, 2, 3);\n      t[0] = (extractBits(C, 1, 1) << 1) | (extractBits(C, 0, 0) & ~extractBits(C, 1, 1));\n    }\n\n    for (var i = 0; i < 5; ++i) {\n      var idx = resultDecodedStorage.currIndex;\n      resultDecodedStorage[idx] = 1;\n      resultDecodedStorage[idx + 1] = 0;\n      resultDecodedStorage[idx + 2] = nbBitsPerValue;\n      resultDecodedStorage[idx + 3] = t[i];\n      resultDecodedStorage[idx + 4] = 0;\n      resultDecodedStorage[idx + 5] = m[i];\n\n      resultDecodedStorage.currIndex += 6;\n    }\n  };\n\n  /**\n   * Decodes a quint in colorData raw data\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} nbBitsPerValue number of bits\n   * on which the integer is encoded\n   * @param  {array} resultStorage contains decoded integer,\n   * the decoded quint will be pushed back at the end of this procedure\n   */\n  var decodeQuint = function(colorData, nbBitsPerValue) {\n    var m = lsbDecodingValues;\n    var q = msbDecodingValues;\n    var Q = 0;\n\n    // Refers to ASTC specifications (Table 18)\n    m[0] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q = readBits(colorData, 0, colorDataBitsRead, 3);\n    colorDataBitsRead += 3;\n\n    m[1] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q |= readBits(colorData, 0, colorDataBitsRead, 2) << 3;\n    colorDataBitsRead += 2;\n\n    m[2] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q |= readBits(colorData, 0, colorDataBitsRead, 2) << 5;\n    colorDataBitsRead += 2;\n\n    if (extractBits(Q, 1, 2) === 3 && extractBits(Q, 5, 6) === 0) {\n      q[0] = 4;\n      q[1] = 4;\n      q[2] = (extractBits(Q, 0, 0) << 2) | ((extractBits(Q, 4, 4) & ~extractBits(Q, 0, 0)) << 1) | (extractBits(Q, 3, 3) & ~extractBits(Q, 0, 0));\n    } else {\n      var C = 0 >>> 0;\n      if (extractBits(Q, 1, 2) === 3) {\n        q[2] = 4;\n        C = (extractBits(Q, 3, 4) << 3) | ((~extractBits(Q, 5, 6) & 3) << 1) | (extractBits(Q, 0, 0));\n      } else {\n        q[2] = extractBits(Q, 5, 6);\n        C = extractBits(Q, 0, 4);\n      }\n\n      if (extractBits(C, 0, 2) === 5) {\n        q[1] = 4;\n        q[0] = extractBits(C, 3, 4);\n      } else {\n        q[1] = extractBits(C, 3, 4);\n        q[0] = extractBits(C, 0, 2);\n      }\n    }\n\n    for (var i = 0; i < 3; ++i) {\n      var idx = resultDecodedStorage.currIndex;\n      resultDecodedStorage[idx] = 0;\n      resultDecodedStorage[idx + 1] = 1;\n      resultDecodedStorage[idx + 2] = nbBitsPerValue;\n      resultDecodedStorage[idx + 3] = 0;\n      resultDecodedStorage[idx + 4] = q[i];\n      resultDecodedStorage[idx + 5] = m[i];\n\n      resultDecodedStorage.currIndex += 6;\n    }\n  };\n\n  /**\n   * Decodes nbValues of colorData raw data\n   * according to its max range value\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} range max value of the Integere Sequence\n   * @param  {uint} nbValues contains the number of values to decode\n   * @return {array} contains decoded integer\n   */\n  var decodeIntegerSequence = function(colorData, range, nbValues) {\n    var baseIdx = range * 3;\n    var trits = maxWeightQuintsTritsMapper[baseIdx + TRIT_IDX];\n    var quints = maxWeightQuintsTritsMapper[baseIdx + QUINT_IDX];\n    var bits = maxWeightQuintsTritsMapper[baseIdx + BIT_IDX];\n\n    resultDecodedStorage.currIndex = 0;\n\n    var nbDecodedValues = 0;\n    while (nbDecodedValues < nbValues) {\n\n      if (quints === 0 && trits === 0) {\n        var idx = resultDecodedStorage.currIndex;\n        resultDecodedStorage[idx] = trits;\n        resultDecodedStorage[idx + 1] = quints;\n        resultDecodedStorage[idx + 2] = bits;\n        resultDecodedStorage[idx + 3] = 0;\n        resultDecodedStorage[idx + 4] = 0;\n        resultDecodedStorage[idx + 5] = readBits(colorData, 0, colorDataBitsRead, bits);\n        colorDataBitsRead += bits;\n\n        resultDecodedStorage.currIndex += 6;\n\n        nbDecodedValues++;\n      } else if (quints === 1 && trits === 0) {\n        decodeQuint(colorData, bits);\n        nbDecodedValues += 3;\n      } else {\n        decodeTrit(colorData, bits);\n        nbDecodedValues += 5;\n      }\n    }\n  };\n\n  /**\n   * Decodes color from the colorData encoded Integer Sequence\n   * @param  {Uint8Array} colorData encoded color raw data\n   * @param  {array} colorModes contains the color for each partition\n   * @param  {uint} nbPartitions Number of available partitions\n   * @param  {uint} colorDataBits remaining bits number on which color data are encoded\n   * @return {array} decoded endpoints value in the [0...255] range\n   */\n\n  var endpointValuesOutput = new Uint8Array(32);\n\n  var decodeColorValues = function(colorData, colorModes, nbPartitions, colorDataBits) {\n    var trits = 0;\n    var quints = 0;\n    var bits = 0;\n    var i = 0;\n    // Computes the number of endpoint by using the associated class\n    // max endpoint values = 32\n    var nbEndpointValues = 0;\n    for (i = 0; i < nbPartitions; ++i)\n      nbEndpointValues += ((colorModes[i] >> 2) + 1) << 1;\n\n    // Finds the max range for each color endpoints\n    var range = 256;\n    while (--range > 0) {\n\n      var idx = range * 3;\n      trits = maxWeightQuintsTritsMapper[idx + TRIT_IDX];\n      quints = maxWeightQuintsTritsMapper[idx + QUINT_IDX];\n      bits = maxWeightQuintsTritsMapper[idx + BIT_IDX];\n\n      var bitsNbr = getBitsNbrFromEncodedInt(nbEndpointValues, trits, quints, bits);\n      if (bitsNbr <= colorDataBits) {\n        // Some integers share the same encoding\n        // this piece of code finds the smallest one\n        while (--range > 0) {\n          var newIdx = range * 3;\n          var newTrits = maxWeightQuintsTritsMapper[newIdx + TRIT_IDX];\n          var newQuints = maxWeightQuintsTritsMapper[newIdx + QUINT_IDX];\n          var newBits = maxWeightQuintsTritsMapper[newIdx + BIT_IDX];\n\n          if (newTrits !== trits || newQuints !== quints || newBits !== bits)\n            break;\n        }\n\n        range++;\n        break;\n      }\n    }\n\n    // Decodes the integer sequence based on the range and\n    // the number of values\n    var endpointIdx = 0;\n    decodeIntegerSequence(colorData, range, nbEndpointValues);\n\n    for (i = 0; i < nbEndpointValues * 6; i += 6) {\n      var bitLength = resultDecodedStorage[i + BIT_IDX];\n      var bitValue = resultDecodedStorage[i + BIT_IDX + 3];\n\n      // Refers to ASTC specifications(Section 3.11)\n      var result;\n      if (resultDecodedStorage[i + TRIT_IDX]) result = cacheDecodeTrits[bitLength + resultDecodedStorage[i + TRIT_IDX + 3] * 7 + bitValue * 21];\n      else if (resultDecodedStorage[i + QUINT_IDX]) result = cacheDecodeQuints[bitLength + resultDecodedStorage[i + QUINT_IDX + 3] * 6 + bitValue * 30];\n      else result = cacheDecodeSimple[bitLength + bitValue * 9];\n\n      endpointValuesOutput[endpointIdx++] = result;\n    }\n\n    // Makes sure each decoded value is not ambiguous\n    for (i = 0; i < nbEndpointValues; ++i)\n      if (endpointValuesOutput[i] > 255)\n        console.error('Decoded endpoint value can not be above 255.');\n  };\n\n  /**\n   * Computes the two color endpoint values\n   * from the decoded Integer Sequence data\n   * @param  {[type]} endpointColorValues [description]\n   * @param  {[type]} colorMode           [description]\n   */\n  var computeColorEndpointsLDR = function(endpointColorValues, colorMode) {\n    var v = 0;\n    var currIdx = 0;\n\n    switch (colorMode) {\n      case 0:\n        v = readNDecodedColor(endpointColorValues, 2);\n        fillEndpointsWithPixel(0xFF, v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, v[1], v[1], v[1]);\n        endpoints.currIdx += 4;\n        break;\n      case 1:\n        v = readNDecodedColor(endpointColorValues, 2);\n        var L0 = (v[0] >> 2) | (v[1] & 0xC0);\n        var L1 = Math.max(L0 + (v[1] & 0x3F), 0xFF);\n\n        fillEndpointsWithPixel(0xFF, L0, L0, L0);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, L1, L1, L1);\n        endpoints.currIdx += 4;\n        break;\n      case 4:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        fillEndpointsWithPixel(v[2], v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(v[3], v[1], v[1], v[1]);\n        endpoints.currIdx += 4;\n        break;\n      case 5:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n\n        currIdx = endpoints.currIdx;\n\n        fillEndpointsWithPixel(v[2], v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n\n        fillEndpointsWithPixel(v[2] + v[3], v[0] + v[1], v[0] + v[1], v[0] + v[1]);\n        endpoints.currIdx += 4;\n\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      case 6:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        fillEndpointsWithPixel(0xFF, v[0] * v[3] >> 8, v[1] * v[3] >> 8, v[2] * v[3] >> 8);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, v[0], v[1], v[2]);\n        endpoints.currIdx += 4;\n        break;\n      case 8:\n        v = readNDecodedColor(endpointColorValues, 6);\n        if (v[1] + v[3] + v[5] >= v[0] + v[2] + v[4]) {\n          fillEndpointsWithPixel(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n          fillEndpointsWithPixel(0xFF, v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(0xFF, v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n          blueContract(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        break;\n      case 9:\n        v = readNDecodedColor(endpointColorValues, 6);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n        bitTransferSigned(v, 5, 4);\n\n        currIdx = endpoints.currIdx;\n\n        if (v[1] + v[3] + v[5] >= 0) {\n          fillEndpointsWithPixel(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n\n          fillEndpointsWithPixel(0xFF, v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(0xFF, v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n\n          blueContract(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      case 10:\n        v = readNDecodedColor(endpointColorValues, 6);\n\n        fillEndpointsWithPixel(v[4], v[0] * v[3] >> 8, v[1] * v[3] >> 8, v[2] * v[3] >> 8);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(v[5], v[0], v[1], v[2]);\n        endpoints.currIdx += 4;\n        break;\n      case 12:\n        v = readNDecodedColor(endpointColorValues, 8);\n        if (v[1] + v[3] + v[5] >= v[0] + v[2] + v[4]) {\n          fillEndpointsWithPixel(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n          fillEndpointsWithPixel(v[7], v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(v[7], v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n          blueContract(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        break;\n      case 13:\n        v = readNDecodedColor(endpointColorValues, 8);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n        bitTransferSigned(v, 5, 4);\n        bitTransferSigned(v, 7, 6);\n\n        currIdx = endpoints.currIdx;\n\n        if (v[1] + v[3] + v[5] >= 0) {\n          fillEndpointsWithPixel(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n\n          fillEndpointsWithPixel(v[7] + v[6], v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(v[6] + v[7], v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n\n          blueContract(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      default:\n        console.error('Unsupported color endpoint mode. Only LDR modes are supported.');\n    }\n  };\n\n  /**\n   * Unquantizes a single texel returning it to a standard\n   * [0...64] range according to its trit/quint/bit encoding\n   * @param  {uint} val the decoded integer\n   * @return {uint} the unquantized weight in the range [0...64]\n   */\n  var unquantizeTexel = function(i) {\n    var bitLength = resultDecodedStorage[i + BIT_IDX];\n    var bitValue = resultDecodedStorage[i + BIT_IDX + 3];\n\n    // Refers to ASTC specifications (Section 3.11)\n    if (resultDecodedStorage[i + TRIT_IDX]) return cacheUnquantizeTrits[bitLength + resultDecodedStorage[i + TRIT_IDX + 3] * 4 + bitValue * 12];\n    if (resultDecodedStorage[i + QUINT_IDX]) return cacheUnquantizeQuints[bitLength + resultDecodedStorage[i + QUINT_IDX + 3] * 3 + bitValue * 15];\n    return cacheUnquantizeSimple[bitLength + bitValue * 8];\n  };\n\n  /**\n   * Returns weights in a standard range [0...64]\n   * @param  {array} weightValues contains the decoded\n   * Integer Sequence of the weight data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} multidimensional array containing the weights\n   * for both planes\n   */\n\n  var unquantizedOutput = new Uint8Array(2 * 144);\n  var infilledWeightsOutput = new Uint8Array(2 * 144);\n\n  var unquantizeWeights = function(blockInfo, blockWidth, blockHeight, nbWeightValues) {\n\n    var bw = blockInfo.width;\n    var bh = blockInfo.height;\n    var bwh = bw * bh;\n\n    var i = 0;\n    var end = 0;\n\n    if (blockInfo.dualPlane) {\n      end = Math.min(nbWeightValues * 2, bwh);\n      for (i = 0; i < end; ++i) {\n        unquantizedOutput[i] = unquantizeTexel(i * 12);\n        unquantizedOutput[i + 144] = unquantizeTexel(i * 12 + 6);\n      }\n\n    } else {\n      // Unquantizes the whole weight grid\n      end = Math.min(nbWeightValues, bwh);\n      for (i = 0; i < end; ++i) {\n        unquantizedOutput[i] = unquantizeTexel(i * 6);\n      }\n    }\n\n    // Applies the weight infill procedure\n    // Refers to ASTC specifications (Section 3.12)\n    // 3D blocks are not handled for the moment\n    var Ds = ((1024 + (blockWidth / 2)) / (blockWidth - 1)) >>> 0;\n    var Dt = ((1024 + (blockHeight / 2)) / (blockHeight - 1)) >>> 0;\n    var dPlane = (blockInfo.dualPlane) ? 2 : 1;\n\n    for (var planeId = 0; planeId < dPlane; ++planeId) {\n      var idp = planeId * 144;\n      for (var t = 0; t < blockHeight; ++t) {\n        for (var s = 0; s < blockWidth; ++s) {\n          var cs = Ds * s;\n          var ct = Dt * t;\n\n          var gs = (cs * (bw - 1) + 32) >> 6;\n          var gt = (ct * (bh - 1) + 32) >> 6;\n\n          var js = gs >> 4;\n          var fs = gs & 0xF;\n\n          var jt = gt >> 4;\n          var ft = gt & 0x0F;\n\n          var w11 = (fs * ft + 8) >> 4;\n          var w10 = (ft - w11) >>> 0;\n          var w01 = (fs - w11) >>> 0;\n          var w00 = (16 - fs - ft + w11) >>> 0;\n\n          var v0 = js + jt * bw;\n\n          var val = 8;\n          var vid = v0;\n          if (vid < bwh) val += w00 * unquantizedOutput[vid + idp];\n\n          vid = v0 + 1;\n          if (vid < bwh) val += w01 * unquantizedOutput[vid + idp];\n\n          vid = v0 + bw;\n          if (vid < bwh) val += w10 * unquantizedOutput[vid + idp];\n\n          vid = v0 + bw + 1;\n          if (vid < bwh) val += w11 * unquantizedOutput[vid + idp];\n\n          infilledWeightsOutput[t * blockWidth + s + idp] = val >> 4;\n        }\n      }\n    }\n  };\n\n  /**\n   * Decompresses a single void-extent block,\n   * in other words, a block containing only one color\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var decompressVoidExtent = function(u8buffer, blockId, blockInfo, blockWidth, blockHeight) {\n    // Do not read extra data\n    bitsReadCount += 53;\n\n    var r16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var g16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var b16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var a16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n\n    if (bitsReadCount !== 128)\n      console.error('Invalid void-extent bits reading.');\n\n    var nbPixel = blockWidth * blockHeight * 4;\n    for (var i = 0; i < nbPixel; i += 4) {\n      blockPixelsOutput[i] = extractBits(a16, 0, 7);\n      blockPixelsOutput[i + 1] = extractBits(r16, 0, 7);\n      blockPixelsOutput[i + 2] = extractBits(g16, 0, 7);\n      blockPixelsOutput[i + 3] = extractBits(b16, 0, 7);\n    }\n  };\n\n  /**\n   * Decompresses a single block by returning\n   * the error color (0xFF, 0xFF, 0x00, 0xFF)\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var getErrorPixelBlock = function(blockWidth, blockHeight) {\n    var nbPixel = blockWidth * blockHeight * 4;\n    for (var i = 0; i < nbPixel; i += 4) {\n      blockPixelsOutput[i] = 0xFF;\n      blockPixelsOutput[i + 1] = 0xFF;\n      blockPixelsOutput[i + 2] = 0x00;\n      blockPixelsOutput[i + 3] = 0xFF;\n    }\n  };\n\n  /**\n   * Decompresses a single block by retrieving\n   * the block layout as well as the number of partitions,\n   * the color endpoints and weights data.\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var decompressBlock = function(u8buffer, blockId, blockWidth, blockHeight) {\n    bitsReadCount = 0;\n    bitsWrittenCount = 0;\n    colorDataBitsRead = 0;\n    decodedColorValuesIdx = 0;\n\n    var i = 0;\n    var CEM = 0;\n    var blockInfo = getBlockInfo(u8buffer, blockId);\n\n    if (blockInfo.error)\n      return getErrorPixelBlock(blockWidth, blockHeight);\n\n    // Handles the case whenever the block is filled with only one color\n    if (blockInfo.isVoidExtent)\n      return decompressVoidExtent(u8buffer, blockId, blockInfo, blockWidth, blockHeight);\n\n    if (blockInfo.width > blockWidth)\n      console.error('Texel weight grid width can not be larger than the block width.');\n    if (blockInfo.height > blockHeight)\n      console.error('Texel weight grid height can not be larger than the block height.');\n\n    // Extracts the partitions number\n    var nbPartitions = readBits(u8buffer, blockId, bitsReadCount, 2) + 1;\n    bitsReadCount += 2;\n\n    if (nbPartitions > 4)\n      console.error('The block partitions number is too high.');\n    if (nbPartitions === 4 && blockInfo.dualPlane)\n      return getErrorPixelBlock(blockWidth, blockHeight);\n\n    // Reads the extra configuration field\n    // At most 4 modes describing how color data is encoded\n    var colorEndpointModes = [0, 0, 0, 0];\n    var partitionIndex = -1;\n    var planeIndex = -1;\n    var cemBits = 0;\n    if (nbPartitions === 1) {\n      colorEndpointModes[0] = readBits(u8buffer, blockId, bitsReadCount, 4);\n      bitsReadCount += 4;\n      partitionIndex = 0;\n    } else {\n      // Reads 10 bits containing the partition index\n      partitionIndex = readBits(u8buffer, blockId, bitsReadCount, 10);\n      bitsReadCount += 10;\n      // Reads 6 bits containing the cem extra\n      cemBits = readBits(u8buffer, blockId, bitsReadCount, 6);\n      bitsReadCount += 6;\n    }\n    var baseMode = (cemBits & 3);\n\n    // Computes remaining bits containing color endpoint data\n    //var numberWeightBits = getPackedBitSize(blockInfo);\n    var remainingBits = 128 - getPackedBitSize(blockInfo) - bitsReadCount;\n    var dualPlaneSelectorBits = (blockInfo.dualPlane) ? 2 : 0;\n    remainingBits -= dualPlaneSelectorBits;\n\n    // Gets extra bits number according to CEM\n    // mode 0 does not need any extra CEM bits\n    var extraCEMbitsNb = 0;\n    if (baseMode) {\n      if (nbPartitions === 2)\n        extraCEMbitsNb = 2;\n      else if (nbPartitions === 3)\n        extraCEMbitsNb = 5;\n      else if (nbPartitions === 4)\n        extraCEMbitsNb = 8;\n    }\n    remainingBits -= extraCEMbitsNb;\n\n    // Reads color data\n    // read data are written to a buffer for later use\n    var colorDataBits = remainingBits;\n    for (i = 0; i < 16; ++i)\n      colorEndpointData[i] = 0;\n\n    while (remainingBits > 0) {\n      var bitsNb = Math.min(remainingBits, 8);\n      var bits = readBits(u8buffer, blockId, bitsReadCount, bitsNb);\n      bitsReadCount += bitsNb;\n\n      writeBits(colorEndpointData, bits, bitsNb, bitsWrittenCount);\n      bitsWrittenCount += bitsNb;\n\n      remainingBits -= 8;\n    }\n\n    planeIndex = readBits(u8buffer, blockId, bitsReadCount, dualPlaneSelectorBits);\n    bitsReadCount += dualPlaneSelectorBits;\n\n    // Reads extra CEM data\n    if (baseMode) {\n      var extraCEMbits = readBits(u8buffer, blockId, bitsReadCount, extraCEMbitsNb);\n      bitsReadCount += extraCEMbitsNb;\n\n      CEM = (extraCEMbits << 6) | cemBits;\n      CEM >>= 2;\n\n      // Extracts the class selector bit by bit\n      var C = classSelectorBitsArray;\n      var M = colorModeLSB;\n      for (i = 0; i < nbPartitions; ++i) {\n        C[i] = CEM & 1;\n        CEM >>= 1;\n      }\n      // Extracts the color endoint mode low bits\n      /*for (i = 0; i < nbPartitions; ++i) {\n        M[i] = CEM & 3;\n        CEM >>= 2;\n        if (M[i] > 3)\n          console.error(  'Error while extracting the color endpoint mode LSB.'); \n      }*/\n      for (i = 0; i < nbPartitions; ++i) {\n        M[i] = CEM & 3;\n        CEM >>= 2;\n        if (M[i] > 3)\n          console.error('Error while extracting the color endpoint mode LSB.');\n\n        colorEndpointModes[i] = baseMode;\n        if (!(C[i]))\n          colorEndpointModes[i] -= 1;\n        colorEndpointModes[i] <<= 2;\n        colorEndpointModes[i] |= M[i];\n      }\n    } else if (nbPartitions > 1) {\n      CEM = cemBits >> 2;\n      for (i = 0; i < nbPartitions; ++i)\n        colorEndpointModes[i] = CEM;\n    }\n\n    // Makes sure the extracted data obtained until here is correct\n    var blockBitsRead = bitsReadCount + getPackedBitSize(blockInfo);\n\n    for (i = 0; i < nbPartitions; ++i)\n      if (colorEndpointModes[i] >= 16)\n        console.error('The color endpoint mode ' + colorEndpointModes[i] + ' is not correct.');\n\n    if (blockBitsRead < 128)\n      console.error('The current block as not been read entirely. (' + blockBitsRead + ' read)');\n    else if (blockBitsRead > 128)\n      console.error('Too many bits have been read for the current block. (' + blockBitsRead + ' read)');\n\n    // Decodes color data\n    decodeColorValues(colorEndpointData, colorEndpointModes, nbPartitions, colorDataBits);\n\n    // Computes endpoint for all partitions\n    endpoints.currIdx = 0;\n    for (i = 0; i < nbPartitions; i++)\n      computeColorEndpointsLDR(endpointValuesOutput, colorEndpointModes[i]);\n\n    // Reads remaining bits containing packed texel weight data\n    // This code can be factorized with the color data reading above\n    var texelWeightDataIndex = 0;\n    for (i = 0; i < 16; ++i)\n      texelWeightData[texelWeightDataIndex++] = u8buffer[blockId + i];\n\n    // Reverses the textWeightData array\n    // and each byte\n    reverseU8Array(texelWeightData);\n\n    var weightPackedSize = getPackedBitSize(blockInfo);\n    var clearByteStart = (weightPackedSize >> 3) + 1;\n    var nbBytesToClean = 16 - clearByteStart;\n    texelWeightData[clearByteStart - 1] &= (1 << (weightPackedSize % 8)) - 1;\n    for (i = 0; i < nbBytesToClean; ++i)\n      texelWeightData[clearByteStart + i] = 0;\n\n    // Decodes the weight\n    colorDataBitsRead = 0;\n    var nbWeightValues = getNumberWeightValues(blockInfo);\n    decodeIntegerSequence(texelWeightData, blockInfo.maxWeight, nbWeightValues);\n\n    unquantizeWeights(blockInfo, blockWidth, blockHeight, nbWeightValues);\n\n    // Interpolates colors\n    var smallBlock = (blockHeight * blockWidth) < 32;\n    var rnum = precomputeSelectPartition(partitionIndex, nbPartitions);\n    for (var j = 0; j < blockHeight; j++) {\n      for (i = 0; i < blockWidth; i++) {\n        var partition = selectPartition(rnum, i, j, 0, nbPartitions, smallBlock);\n        if (partition >= nbPartitions)\n          console.error('The block partition index can not be larger or equal to the number of partitions.');\n\n        var rowIndex = (j * blockWidth + i) * 4;\n        var endpointBaseIdx = partition * 8;\n        for (var c = 0; c < 4; ++c) {\n          var C0 = endpoints[endpointBaseIdx + c] >>> 0;\n          C0 = replicateBits0816Map[C0];\n\n          var C1 = endpoints[endpointBaseIdx + c + 4] >>> 0;\n          C1 = replicateBits0816Map[C1];\n\n          var plane = 0 >>> 0;\n          if (blockInfo.dualPlane && (((planeIndex + 1) & 3) === c))\n            plane = 1;\n\n          var weight = infilledWeightsOutput[j * blockWidth + i + plane * 144];\n          var color = Math.floor(((C0 * (64 - weight) + C1 * weight + 32) / 64));\n\n          if (color === 65535)\n            blockPixelsOutput[rowIndex + c] = 255;\n          else\n            blockPixelsOutput[rowIndex + c] = Math.round(255.0 * (color / 65536.0));\n        }\n      }\n    }\n  };\n\n  /**\n   * Decompresses a complete buffer containing ASTC file raw data\n   * @param  {ArrayBuffer} contains the compressed ASTC raw data\n   * @return {Object} contains the uncompressed image buffer\n   * as well as the image dimensions\n   */\n  // TODO export\n  var decompress = function(imgBuffer) {\n    var u8buffer = new Uint8Array(imgBuffer);\n\n    // Retrieves the header\n    var header = parseHeader(imgBuffer);\n\n    var imgWidth = header.xSize;\n    var imgHeight = header.ySize;\n    var halfImgHeight = (imgHeight >> 1);\n\n    var blockWidth = header.blockDimX;\n    var blockHeight = header.blockDimY;\n\n    var firstBlockIndex = 16;\n    var blockNb = 0;\n\n    // Initializes temp storages used\n    // in helper functions\n    blockPixelsOutput = new Uint8Array(blockWidth * blockHeight * 4);\n\n    var j = 0;\n    var i = 0;\n    var resultImg = new Uint8ClampedArray(imgWidth * imgHeight * 4);\n\n    for (j = 0; j < imgHeight; j += blockHeight) {\n      for (i = 0; i < imgWidth; i += blockWidth) {\n\n        var currentBlockIndex = firstBlockIndex + blockNb * 16;\n        // Decompresses the current block\n        decompressBlock(u8buffer, currentBlockIndex, blockWidth, blockHeight);\n\n        var widthBound = Math.min(blockWidth, imgWidth - i);\n        var heightBound = Math.min(blockHeight, imgHeight - j);\n        var rowIndex = (j * imgWidth + i) * 4;\n        for (var jj = 0; jj < heightBound; jj++) {\n          var destId = rowIndex + jj * imgWidth * 4;\n          var srcId = jj * blockWidth * 4;\n\n          for (var x = 0; x < widthBound * 4; x += 4) {\n            resultImg[destId + x] = blockPixelsOutput[srcId + x + 1];\n            resultImg[destId + x + 1] = blockPixelsOutput[srcId + x + 2];\n            resultImg[destId + x + 2] = blockPixelsOutput[srcId + x + 3];\n            resultImg[destId + x + 3] = blockPixelsOutput[srcId + x];\n          }\n        }\n\n        ++blockNb;\n      }\n    }\n\n    // Flips the image using the Y-axis\n    for (j = 0; j < halfImgHeight; j++) {\n      for (i = 0; i < imgWidth; i++) {\n        var beginByte = (j * imgWidth + i) * 4;\n        var endByte = ((imgHeight - j - 1) * imgWidth + i) * 4;\n\n        swapCell(resultImg, beginByte, endByte);\n        swapCell(resultImg, beginByte + 1, endByte + 1);\n        swapCell(resultImg, beginByte + 2, endByte + 2);\n        swapCell(resultImg, beginByte + 3, endByte + 3);\n      }\n    }\n\n    var result = {};\n    result.img = resultImg;\n    result.width = imgWidth;\n    result.height = imgHeight;\n\n    return result;\n  };\n\n  module.exports = {\n    decompress: decompress\n  };\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var replicateBits = __webpack_require__(3).replicateBits;\n\n  // Describes how to unpack trit/quint\n  // with no additional bits\n  var WEIGHT_TRIT_RANGE = [0, 32, 63];\n  var WEIGHT_QUINT_RANGE = [0, 16, 32, 47, 63];\n\n  ///////////////////\n  // CACHE UNQUANTIZE\n  ///////////////////\n\n  // -----------------\n  // UNQUANTIZE SIMPLE\n  // -----------------\n  var cacheUnquantizeSimple = new Uint8Array(256 * 8);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var bitLength = 1; bitLength < 8; ++bitLength) {\n\n      var result = replicateBits(bitValue, bitLength, 6);\n      if (result > 32) result++;\n\n      cacheUnquantizeSimple[bitLength + bitValue * 8] = result;\n    }\n  }\n\n  // ----------------\n  // UNQUANTIZE TRITS\n  // ----------------\n  var cacheUnquantizeTrits = new Uint8Array(256 * 3 * 4);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var tri = 0; tri < 3; ++tri) {\n      for (var bitLength = 0; bitLength < 4; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 0:\n            result = WEIGHT_TRIT_RANGE[tri];\n            break;\n          case 1:\n            C = 50;\n            break;\n          case 2:\n            C = 23;\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 6) | (bBit << 2) | bBit;\n            break;\n          case 3:\n            C = 11;\n            var cbBits = (bitValue >> 1) & 3;\n            B = (cbBits << 5) | cbBits;\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 127 : 0;\n          result = tri * C + B;\n          result ^= A;\n          result = (A & 0x20) | (result >> 2);\n        }\n\n        if (result > 32) result++;\n\n        cacheUnquantizeTrits[bitLength + tri * 4 + bitValue * 12] = result;\n      }\n    }\n  }\n\n  // -----------------\n  // UNQUANTIZE QUINTS\n  // -----------------\n  var cacheUnquantizeQuints = new Uint8Array(256 * 5 * 3);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var quint = 0; quint < 5; ++quint) {\n      for (var bitLength = 0; bitLength < 3; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 0:\n            result = WEIGHT_QUINT_RANGE[quint];\n            break;\n          case 1:\n            C = 28;\n            break;\n          case 2:\n            C = 13;\n            var bBits = (bitValue >> 1) & 1;\n            B = (bBits << 6) | (bBits << 1);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 127 : 0;\n          result = quint * C + B;\n          result ^= A;\n          result = (A & 0x20) | (result >> 2);\n        }\n\n        if (result > 32) result++;\n\n        cacheUnquantizeQuints[bitLength + quint * 3 + bitValue * 15] = result;\n      }\n    }\n  }\n\n  ///////////////\n  // CACHE DECODE\n  ///////////////\n\n  // -------------\n  // DECODE SIMPLE\n  // -------------\n  var cacheDecodeSimple = new Uint8Array(256 * 9);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var bitLength = 1; bitLength < 9; ++bitLength) {\n      cacheDecodeSimple[bitLength + bitValue * 9] = replicateBits(bitValue, bitLength, 8);\n    }\n  }\n\n  // ----------------\n  // UNQUANTIZE TRITS\n  // ----------------\n  var cacheDecodeTrits = new Uint8Array(256 * 3 * 7);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var tri = 0; tri < 3; ++tri) {\n      for (var bitLength = 0; bitLength < 7; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 1:\n            C = 204;\n            break;\n          case 2:\n            C = 93;\n            // b000b0bb0\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 8) | (bBit << 4) | (bBit << 2) | (bBit << 1);\n            break;\n          case 3:\n            C = 44;\n            // cb000cbcb\n            var cbBit = (bitValue >> 1) & 3;\n            B = (cbBit << 7) | (cbBit << 2) | cbBit;\n            break;\n          case 4:\n            C = 22;\n            // dcb000dcb\n            var dcbBit = (bitValue >> 1) & 7;\n            B = (dcbBit << 6) | dcbBit;\n            break;\n          case 5:\n            C = 11;\n            // edcb000ed\n            var edcbBit = (bitValue >> 1) & 0xF;\n            B = (edcbBit << 5) | (edcbBit >> 2);\n            break;\n          case 6:\n            C = 5;\n            // fedcb000f\n            var fedcbBit = (bitValue >> 1) & 0x1F;\n            B = (fedcbBit << 4) | (fedcbBit >> 4);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 511 : 0;\n          result = (tri * C + B) >>> 0;\n          result ^= A;\n          result = (A & 0x80) | (result >> 2);\n        }\n\n        cacheDecodeTrits[bitLength + tri * 7 + bitValue * 21] = result;\n      }\n    }\n  }\n\n  // -----------------\n  // UNQUANTIZE QUINTS\n  // -----------------\n  var cacheDecodeQuints = new Uint8Array(256 * 5 * 6);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var quint = 0; quint < 5; ++quint) {\n      for (var bitLength = 0; bitLength < 6; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 1:\n            C = 113;\n            break;\n          case 2:\n            C = 54;\n            // b0000bb00\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 8) | (bBit << 3) | (bBit << 2);\n            break;\n          case 3:\n            C = 26;\n            // cb0000cbc\n            var cbBit = (bitValue >> 1) & 3;\n            B = (cbBit << 7) | (cbBit << 1) | (cbBit >> 1);\n            break;\n          case 4:\n            C = 13;\n            // dcb0000dc\n            var dcbBit = (bitValue >> 1) & 7;\n            B = (dcbBit << 6) | (dcbBit >> 1);\n            break;\n          case 5:\n            C = 6;\n            // edcb0000e\n            var edcbBit = (bitValue >> 1) & 0xF;\n            B = (edcbBit << 5) | (edcbBit >> 3);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 511 : 0;\n          result = (quint * C + B) >>> 0;\n          result ^= A;\n          result = (A & 0x80) | (result >> 2);\n        }\n\n        cacheDecodeQuints[bitLength + quint * 6 + bitValue * 30] = result;\n      }\n    }\n  }\n\n\n  // TOTO module exports\n  module.exports = {\n    cacheUnquantizeSimple: cacheUnquantizeSimple,\n    cacheUnquantizeTrits: cacheUnquantizeTrits,\n    cacheUnquantizeQuints: cacheUnquantizeQuints,\n    cacheDecodeSimple: cacheDecodeSimple,\n    cacheDecodeTrits: cacheDecodeTrits,\n    cacheDecodeQuints: cacheDecodeQuints\n  };\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n  'use strict';\n\n  /**\n   * Creates a binary mask between two given bounds\n   * @param  {int} a starting bit\n   * @param  {int} b ending bit\n   * @return {int} mask integer containing binary 1 between a and b\n   */\n  var createMask = function(a, b) {\n    var r = 0;\n    for (var i = a; i <= b; ++i)\n      r |= 1 << i;\n\n    return r;\n  };\n\n  /**\n   * Applies the Hamming weight algorithm: looks for the number of bits set to 1\n   * @param  {int} value\n   * @return {int} the number of bits set to 1\n   */\n  var popCount = function(value) {\n    var i = 0;\n    for (; value; ++i)\n      value &= value - 1;\n    return i;\n  };\n\n  /**\n   * Extracts bits from a bounded range\n   * @param  {int} value representing the integer value where the bits are extracted\n   * @param  {int} start the index of the starting bit\n   * @param  {int} stop  the index of the ending bit\n   * @return {int} the integer composed by the extracted bits\n   */\n  var extractBits = function(value, start, stop) {\n    return (value & createMask(start, stop)) >> start;\n  };\n\n\n  /**\n   * Replicates the n lower bits until the given bit index\n   * @param  {int} val contains the bits to replicate\n   * @param  {int} bitsNb describes the number of lower bits to replicate\n   * @param  {int} endBit the \"index\" of the included final bit\n   * @return {int} result containing a number made of the replicated bits\n   */\n  var replicateBits = function(val, bitsNb, endBit) {\n    // Extracts the bitsNb lower bits from the val value\n    var extractedBits = val & ((1 << bitsNb) - 1);\n    var result = extractedBits;\n    var resultLength = bitsNb;\n\n    while (resultLength < endBit) {\n\n      var extractedBitsShift = 0;\n      if (bitsNb > endBit - resultLength) {\n        var newShift = endBit - resultLength;\n        extractedBitsShift = bitsNb - newShift;\n        bitsNb = newShift;\n      }\n\n      // Shifts the result to \"add\" the pattern\n      result <<= bitsNb;\n      result |= extractedBits >> extractedBitsShift;\n      resultLength += bitsNb;\n    }\n\n    return result;\n  };\n\n  /**\n   * Transfers one bit from an integer to another\n   * @param  {array} array containing the two cells to transfer\n   * @param  {uint} i1 the index of the first cell\n   * @param  {uint} i2 the index of the second cell\n   */\n  var bitTransferSigned = function(array, i1, i2) {\n    var a = array[i1];\n    var b = array[i2];\n\n    b >>= 1;\n    b |= a & 0x80;\n    a >>= 1;\n    a &= 0x3F;\n    if (a & 0x20)\n      a -= 0x40;\n\n    array[i1] = a;\n    array[i2] = b;\n  };\n\n  /**\n   * Reads at most 30 bits from the given U8Int array\n   * @param  {U8IntArray} u8buffer buffer containing data to read\n   * @param  {int} beginByteId first byte at which the reading should begin\n   * @param  {int} bitsOffset nth bits at which the reading should begin\n   * @param  {int} bitsNb number of bits to read\n   * @return {int} an integer containing the read bits\n   */\n  var readBits = function(u8buffer, beginByteId, bitsOffset, bitsNb) {\n    if (bitsNb > 30)\n      console.error('The reader can not read more than 30 bits in a row.');\n    if (bitsNb <= 0)\n      return 0;\n\n    // Updates the total number of extracted bits\n    // for the current block\n    //bitsReadCount += bitsNb;\n\n    var bitsReadResult = 0;\n    var offsetByteId = beginByteId + Math.floor(bitsOffset / 8);\n    var endByteId = beginByteId + Math.floor((bitsOffset + bitsNb) / 8);\n    var bornInfBit = bitsOffset % 8;\n    var bornSupBit = (bitsOffset + bitsNb - 1) % 8;\n\n    // Simple reading where data lies on the same byte\n    if (offsetByteId === endByteId)\n      return (u8buffer[offsetByteId] & createMask(bornInfBit, bornSupBit)) >> bornInfBit;\n\n    // Recreates the integer by shifting bytes\n    // the created integer is at most a 24bits integer\n    var shift = 8;\n    bitsReadResult += u8buffer[offsetByteId];\n    for (var i = offsetByteId + 1; i <= endByteId; ++i) {\n      bitsReadResult += u8buffer[i] << shift;\n      shift *= 2;\n    }\n\n    bitsReadResult = (bitsReadResult & createMask(bornInfBit, bornInfBit + bitsNb - 1)) >> bornInfBit;\n\n    return bitsReadResult;\n  };\n\n  /**\n   * Write a given value in colorEndpointData at the byte index\n   * computed from the number of bits currently written.\n   * It is important to note that the number of bits to write in\n   * a row never exceed the size of a byte (8 bits)\n   * @param  {Uint8Array} colorEndpointData destination byte array\n   * @param  {int} bits the value to write\n   * @param  {uint} bitsNb the number of bits to write\n   * @param  {uint} bitsWritten the current number of bits written\n   */\n  var writeBits = function(colorEndpointData, bits, bitsNb, bitsWritten) {\n    colorEndpointData[Math.floor(bitsWritten / 8)] = bits;\n  };\n\n  /**\n   * Reverses the bits in a byte\n   * @param  {uint8} b the byte to reverse\n   * @return {uint32} the reversed byte not casted\n   */\n  var reverseByte = function(b) {\n    // Converts x to a 32 bits unsigned integer\n    b = b >>> 0;\n    return ((b * 0x0802 & 0x22110) | (b * 0x8020 & 0x88440)) * 0x10101 >> 16;\n  };\n\n  /**\n   * Reverses each byte just as the global bytes order\n   * @param  {Uint8Array} u8array the array to reverse\n   */\n  var reverseU8Array = function(u8array) {\n    for (var i = 0; i < u8array.length / 2; ++i) {\n      var a = reverseByte(u8array[i]);\n      var b = reverseByte(u8array[u8array.length - 1 - i]);\n\n      u8array[i] = b;\n      u8array[u8array.length - 1 - i] = a;\n    }\n  };\n\n  module.exports = {\n    popCount: popCount,\n    readBits: readBits,\n    writeBits: writeBits,\n    extractBits: extractBits,\n    replicateBits: replicateBits,\n    bitTransferSigned: bitTransferSigned,\n    reverseU8Array: reverseU8Array\n  };\n\n/***/ }\n/******/ ])\n});\n;";
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1459)
      , a = function(t, e) {
        r.call(this, t, "arraybuffer", e)
    };
    a.prototype = n.extend({}, r.prototype, {
        load: function() {
            var t = this.getXHR().response;
            this._defer.resolve(t)
        }
    }),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1465)
      , a = r().anisotropy
      , s = n.osg
      , o = ["magFilter", "minFilter", "wrapS", "wrapT", "textureWidth", "textureHeight", "textureTarget", "internalFormat"]
      , u = {
        getValidOptions: function() {
            return o
        },
        getOptions: function(t) {
            var e = {};
            return e.minFilter = t.getMinFilter(),
            e.magFilter = t.getMagFilter(),
            e.wrapT = t.getWrapT(),
            e.wrapS = t.getWrapS(),
            e.textureWidth = t.getWidth(),
            e.textureHeight = t.getHeight(),
            e.textureTarget = t.getTextureTarget(),
            e.internalFormat = t._internalFormat,
            e.imageFormat = t._imageFormat,
            e
        },
        setOptions: function(t, e) {
            e.setMinFilter(t.minFilter),
            e.setMagFilter(t.magFilter),
            e.setWrapT(t.wrapT),
            e.setWrapS(t.wrapS),
            t.minFilter === s.Texture.LINEAR_MIPMAP_LINEAR && a && e.setMaxAnisotropy(16),
            e.setInternalFormat(t.internalFormat)
        },
        createValidOptionsForMaterial: function(t) {
            var e = u.createValidOptions(t);
            return e.minFilter === s.Texture.NEAREST_MIPMAP_LINEAR ? (e.magFilter = s.Texture.NEAREST,
            e) : e.minFilter === s.Texture.LINEAR_MIPMAP_LINEAR || e.minFilter === s.Texture.LINEAR ? (e.magFilter = s.Texture.LINEAR,
            e) : e.minFilter === s.Texture.NEAREST ? (e.magFilter = s.Texture.NEAREST,
            e) : e.magFilter === s.Texture.LINEAR ? (e.minFilter = s.Texture.LINEAR_MIPMAP_LINEAR,
            e) : (e.magFilter = s.Texture.NEAREST,
            e.minFilter = s.Texture.NEAREST,
            e)
        },
        createValidOptions: function(t) {
            t || (t = {});
            for (var e = o.length, i = 0; i < e; ++i) {
                var n = o[i];
                "string" == typeof t[n] && (t[n] = s.Texture[t[n]])
            }
            return t.magFilter || (t.magFilter = s.Texture.LINEAR),
            t.minFilter || (t.minFilter = s.Texture.LINEAR_MIPMAP_LINEAR),
            t.wrapS || (t.wrapS = s.Texture.REPEAT),
            t.wrapT || (t.wrapT = s.Texture.REPEAT),
            t.textureWidth || (t.textureWidth = 0),
            t.textureHeight || (t.textureHeight = 0),
            t.textureTarget || (t.textureTarget = s.Texture.TEXTURE_2D),
            t.internalFormat || (t.internalFormat = s.Texture.RGBA),
            t
        }
    };
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n, r = i(239), a = i(1466), s = i(1191), o = i(1467), u = function(t, e) {
        var i = r.string(t);
        if (!i)
            return e;
        if (i = i.split(","),
        i.length < 3)
            return e;
        i.length = 3;
        for (var n = 0; n < 3; ++n)
            i[n] = parseFloat(i[n]);
        return i
    }, l = function() {
        if (n)
            return n;
        n = {},
        n.apiVersion = r.string("api_version", void 0),
        n.apiID = r.string("api_id", void 0),
        n.autostart = r.bool("autostart", !1),
        n.uiInfos = r.bool("ui_infos"),
        n.uiSnapshots = r.bool("ui_snapshots", !1),
        n.desc_button = r.number("desc_button"),
        n.stop_button = r.number("stop_button"),
        n.transparent = r.bool("transparent", !1),
        n.camera = r.bool("camera", !0),
        n.navigation = r.string("navigation", "orbit"),
        n.fpsSpeed = r.number("fps_speed", 5),
        n.preload = r.bool("preload"),
        n.autospin = r.number("autospin", 0),
        n.blending = r.number("blending"),
        n.cardboard = r.number("cardboard", 0),
        n.cardboard && (n.camera = !1),
        n.scrollwheel = r.bool("scrollwheel", !0),
        n.annotationCycleAutostart = r.bool("annotation_cycle", !1),
        n.annotationCycleDuration = 1e3 * r.number("annotation_cycle", 5),
        n.annotation = r.number("annotation", 0),
        n.annotationsVisible = r.bool("annotations_visible", !0),
        n.preserveDrawingBuffer = r.bool("preserve_drawing_buffer", !1),
        n.process_material = r.bool("process_material", !1),
        n.hook_prod = r.bool("hook_prod", !1),
        n.hook_beta = r.bool("hook_beta", !1),
        n.hook_staging = r.bool("hook_staging", !1),
        n.hook_processingvm1 = r.bool("hook_processingvm1", !1),
        n.debug3d = r.bool("debug3d", !1),
        n.stats = r.bool("stats", !1),
        n.continuousRender = n.stats || r.bool("continuous_render", !1),
        n.messaging = r.bool("messaging"),
        n.isApp = r.bool("is_app"),
        n.maxTextureSize = r.number("max_texture_size"),
        n.anisotropy = r.bool("anisotropy", !0),
        n.panorama = r.bool("panorama", !1),
        n.shadowTextureSize = r.number("shadow_texture_size"),
        n.shadowPCF = r.string("shadow_PCF", "1Tap(4texFetch)"),
        n.supersample = r.bool("supersample", !0),
        n.cameraShadows = r.bool("camera_shadows", !0),
        n.pixelBudget = r.number("pixel_budget"),
        n.animationAutoplay = r.bool("animation_autoplay", !0),
        n.imageCompression = r.bool("image_compression", !0),
        n.postProcess = r.bool("post_process", !0),
        n.showBones = r.number("show_bones", 0),
        n.cameraFollowBones = r.number("camera_follow_bones", 0),
        n.cameraEasing = r.number("camera_easing"),
        n.cameraEye = u("camera_eye"),
        n.cameraTarget = u("camera_target"),
        n.grainSpeed = r.number("grain_speed", 64),
        n.downloadPicture = r.bool("download_picture", !1),
        n.unitRenderTestLocal = r.bool("unit_render_local", !1),
        n.unitRenderTestScreenshot = r.bool("unit_render_screenshot", !1),
        n.unitRenderTestUID = r.string("unit_render_uid"),
        n.vrMenu = r.bool("vr_menu", !0),
        n.vrLauncherAlphaCardFactor = r.number("vr_launcher_alpha_card_factor", 1),
        n.vrScaleRTT = r.number("vr_scale_rtt", -1),
        n.isCarmel = r.bool("carmel", !1),
        n.useVAO = r.bool("use_vao", !1),
        n.dofRes = r.number("dof_res", 2),
        n.dofAttenuateDistance = r.bool("dof_attenuate_distance", !0),
        n.dofAttenuateSpeed = r.bool("dof_attenuate_speed", !1),
        n.dofTransition = r.bool("dof_transition", !0),
        n.materialShowcase = r.bool("material_showcase", !1),
        n.materialNames = r.string("material_names", "main_material"),
        n.materialEmissive = r.string("material_emissive"),
        n.materialTransparency = r.string("material_transparency"),
        n.materialNormal = r.string("material_normal"),
        n.materialAO = r.string("material_ao"),
        n.materialDiffuse = r.string("material_diffuse"),
        n.materialMetalness = r.string("material_metalness"),
        n.materialRoughness = r.string("material_roughness"),
        n.materialGlossiness = r.string("material_glossiness"),
        n.materialSpecular = r.string("material_specular"),
        n.materialCavity = r.string("material_cavity"),
        n.materialF0 = r.string("material_f0"),
        n.materialDisplacement = r.string("material_displacement"),
        n.materialDisplacementFactor = r.number("material_displacement_factor"),
        a(n);
        var t = !o() && !s() && "1.0.0" !== n.apiVersion;
        return n.mergeMaterials = r.bool("merge_materials", t && !n.materialShowcase),
        n.graphOptimizer = r.bool("graph_optimizer", t),
        n.keepEmptyGeometries = r.bool("keep_empty_geometries", !1),
        n.varyingSorting = r.bool("varying_sorting", !0),
        n.substanceDisplacement = r.bool("substance_displacement", !1),
        n.orbitConstraintPan = r.bool("orbit_constraint_pan", !1),
        n.orbitConstraintZoomIn = r.number("orbit_constraint_zoom_in", 0),
        n.orbitConstraintZoomOut = r.number("orbit_constraint_zoom_out", 1 / 0),
        n.orbitConstraintPitchUp = r.number("orbit_constraint_pitch_up", .5 * Math.PI * .9),
        n.orbitConstraintPitchDown = r.number("orbit_constraint_pitch_down", .5 * -Math.PI * .9),
        n.orbitConstraintYawLeft = r.number("orbit_constraint_yaw_left", -Math.PI),
        n.orbitConstraintYawRight = r.number("orbit_constraint_yaw_right", Math.PI),
        n.normalCompression = r.string("normal_compression", "percep"),
        n
    };
    t.exports = l
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        var e = t || {};
        if (!window.location || !window.location.hash)
            return e;
        var i = window.location.hash.substr(1).split(",");
        return i.forEach(function(t) {
            var i = t.split("=")
              , n = i[0]
              , r = i[1];
            if ("debug3d" === n && (e.debug3d = !0),
            "stats" === n && (e.stats = !0),
            n.match("material_"))
                switch (n = n.substr(9)) {
                case "showcase":
                    e.materialShowcase = void 0 === r ? e.materialShowcase : "0" !== r;
                    break;
                case "names":
                    e.materialNames = r;
                    break;
                case "normal":
                    e.materialNormal = r;
                    break;
                case "emissive":
                    e.materialEmissive = r;
                    break;
                case "transparency":
                    e.materialTransparency = r;
                    break;
                case "diffuse":
                    e.materialDiffuse = r;
                    break;
                case "metalness":
                    e.materialMetalness = r;
                    break;
                case "roughness":
                    e.materialRoughness = r;
                    break;
                case "glossiness":
                    e.materialGlossiness = r;
                    break;
                case "specular":
                    e.materialSpecular = r;
                    break;
                case "cavity":
                    e.materialCavity = r;
                    break;
                case "f0":
                    e.materialF0 = r;
                    break;
                case "ao":
                    e.materialAO = r;
                    break;
                case "displacement":
                    e.materialDisplacement = r;
                    break;
                case "displacement_factor":
                    e.materialDisplacementFactor = void 0 === r ? e.materialDisplacementFactor : Number(r)
                }
        }),
        e
    };
    t.exports = i
}
, function(t, e) {
    "use strict";
    var i = !1
      , n = function(t) {
        return void 0 !== t && (i = t),
        i
    };
    t.exports = n
}
, 245, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1470)
      , a = i(247)
      , s = i(239);
    t.exports = a.extend({
        model: r,
        url: function() {
            var t = this.options.filters.get("modelUID") ? "/i/models/" + this.options.filters.get("modelUID") + "/textures" : "/i/textures";
            return t + s.craft("?", {
                offset: this.options.offset
            })
        },
        isValid: function() {
            this.each(function(t) {
                t.isValid()
            })
        },
        addNewImage: function(t) {
            var e = t.id || n.uniqueId()
              , i = new r({
                images: [{
                    uid: e,
                    url: t.url,
                    width: t.width,
                    height: t.height
                }],
                uid: "tmp_" + e,
                id: e,
                name: t.name || "newImage"
            });
            return this.add(i),
            i
        },
        getImageFromURL: function(t) {
            var e = t.split("/").pop();
            return this.find(function(t) {
                var i = !1;
                return t.get("images").forEach(function(t) {
                    i || t.url.indexOf(e) !== -1 && (i = !0)
                }),
                i
            })
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(220)
      , a = i(238)
      , s = i(1471)
      , o = "/i/textures";
    t.exports = a.extend({
        url: function() {
            return this.isNew() ? o : o + "/" + this.get("uid")
        },
        isValid: function() {
            var t = this.get("name");
            return void 0 === t && console.warn("no name for Texture " + this.id),
            t = t || this.id,
            void 0 === this.get("images") && console.warn("no images for Texture " + t),
            void 0 === this.get("uid") && console.warn("no uid for Texture " + t),
            !0
        },
        getName: function() {
            return this.get("name")
        },
        save: function(t, e) {
            null != t && "object" != typeof t || (e = t);
            var i = new FormData;
            return i.append("imageFile", this.get("imageFile"), this.get("name")),
            i.append("colorSpace", this.get("colorSpace")),
            i.append("modelUid", e.modelUID),
            n.resolve(r.ajax({
                url: this.url(),
                data: i,
                processData: !1,
                contentType: !1,
                type: "POST"
            }))
        },
        saveColorspace: function() {
            return n.resolve(r.ajax({
                url: this.url(),
                data: {
                    colorSpace: this.get("colorSpace")
                },
                type: "PATCH"
            }))
        }
    }).extend(s)
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = i(1191)
      , s = i(1465)
      , o = r.osg
      , u = function(t, e, i, n) {
        var r = i - t
          , a = n - e;
        return r * r + a * a
    }
      , l = function(t) {
        return 0 === (t & t - 1)
    }
      , c = function(t) {
        return l(t.width) && l(t.height)
    }
      , h = {
        getUID: function() {
            return this.get("uid")
        },
        getImages: function() {
            return this.get("images")
        },
        getURL: function() {
            console.error("dont call ImageProxy.getURL")
        },
        findFormat: function(t) {
            if ("N" === t) {
                var e = n.filter(this.get("images"), function(e) {
                    var i = e.options && e.options.format === t && e.options.quality;
                    return "percep" === s().normalCompression ? i && "percep" === i.flag : i && "percep" !== i.flag
                });
                if (e.length)
                    return e
            }
            return n.filter(this.get("images"), function(e) {
                return !e.options || e.options.format === t
            })
        },
        getFilteredImages: function(t) {
            if (!t || a() || !s().imageCompression)
                return this.findFormat();
            var e;
            switch (t) {
            case o.Texture.ALPHA:
                if (e = this.findFormat("A"),
                e.length > 0)
                    return e;
                break;
            case o.Texture.RGB:
                if (e = this.findFormat("RGB"),
                e.length > 0)
                    return e;
                if (e = this.findFormat("N"),
                e.length > 0)
                    return e;
                break;
            case o.Texture.LUMINANCE:
                if (e = this.findFormat("R"),
                e.length > 0)
                    return e;
                if (e = this.findFormat("RGB"),
                e.length > 0)
                    return e;
                if (e = this.findFormat("N"),
                e.length > 0)
                    return e
            }
            return this.findFormat()
        },
        findImageNearestPowerOfTwoUpToResolution: function(t, e, i) {
            return this.findImageNearestUpToResolution(t, e, !0, i)
        },
        findImageNearestUpToResolution: function(t, e, i, n) {
            for (var r, a, s = 1 / 0, o = !1, l = 1 / 0, h = this.getFilteredImages(n), d = 0, p = h.length; d < p; ++d) {
                var f = h[d]
                  , g = u(t, e, f.width, f.height);
                if (g < s && (s = g,
                r = f),
                !(f.width > t || f.height > e))
                    if (i) {
                        var m = c(f);
                        o && !m || (!a || !o && m || g < l || l === 1 / 0 && f.width > a.width && f.height > a.height) && (a = f,
                        o = m,
                        l = g)
                    } else
                        (!a || g < l || l === 1 / 0 && f.width > a.width && f.height > a.height) && (a = f,
                        l = g)
            }
            return a ? a : r
        },
        findImageSmallest: function(t) {
            return this.findImageNearestToResolution(0, 0, t)
        },
        findImageWidget: function() {
            return this.findImageNearestToResolution(0, 0, o.Texture.RGB)
        },
        findImageNearestToResolution: function(t, e, i) {
            for (var n, r = 1 / 0, a = this.getFilteredImages(i), s = 0, o = a.length; s < o; ++s) {
                var l = a[s]
                  , c = u(t, e, l.width, l.height);
                c < r && (r = c,
                n = l)
            }
            return n
        }
    };
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(238);
    t.exports = n.extend({})
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(1198)
      , a = i(1474)
      , s = i(1475)
      , o = i(1476)
      , u = i(1477)
      , l = i(1478)
      , c = i(1479)
      , h = i(1480)
      , d = i(1465)
      , p = r.osg
      , f = r.osgWrappers.osg.functionSortAttributes
      , g = "vtx_"
      , m = "uv_"
      , v = "_mode"
      , _ = "attributes"
      , b = "vertex_mode"
      , x = "triangle_mode"
      , A = {
        Vertex: 1,
        Normal: 2,
        TexCoord: 4,
        Color: 8,
        Triangle: 16,
        Tangent: 32
    }
      , y = {
        quantization: 1,
        prediction: 2,
        delta: 4
    }
      , S = {
        delta: 1,
        highWatermark: 2,
        implicit: 4
    }
      , C = function(t) {
        return t.indexOf("TexCoord") !== -1 ? A.TexCoord : A[t]
    }
      , M = function(t, e, i, n) {
        var r, a = t.vb, u = a.Offset ? a.Offset : 0, l = this.getIndices();
        r = a.Encoding && "varint" === a.Encoding ? c(new Uint8Array(n,u), l.getItemSize() * a.Size, t.type) : new p[t.type](n,u,l.getItemSize() * a.Size),
        1 === r.BYTES_PER_ELEMENT && (r = new Uint16Array(r));
        var d = e[_]
          , f = C("Triangle")
          , g = r
          , m = this.getMode() === p.PrimitiveSet.TRIANGLE_STRIP;
        if (0 === (d & f) || !m && this.getMode() !== p.PrimitiveSet.TRIANGLES)
            return r instanceof Uint16Array == !1 && (g = new Uint16Array(r.buffer,r.byteOffset,r.length),
            g.set(r)),
            l.setElements(g),
            this.setIndices(l),
            this;
        var v = e[x]
          , b = 0;
        if (v & S.implicit && m && (b = o.IMPLICIT_HEADER_LENGTH + r[o.IMPLICIT_HEADER_MASK_LENGTH],
        g = new Uint16Array(r[o.IMPLICIT_HEADER_PRIMITIVE_LENGTH])),
        v & S.delta && s(r, b),
        v & S.implicit && m && o(r, g, b, v & S.highWatermark),
        v & S.highWatermark && h(g, g, i),
        g instanceof Uint16Array == !1) {
            var A = g;
            g = new Uint16Array(A.buffer,A.byteOffset,A.length),
            g.set(A)
        }
        return l.setElements(g),
        this.setIndices(l),
        this
    }
      , w = p.Vec3.create()
      , T = p.Vec3.create()
      , E = function(t, e, i, n, r) {
        var a = "Vertex" === n ? g : m + n.substr(8) + "_"
          , s = t & y.quantization && void 0 !== r[a + "bbl_x"]
          , o = e instanceof Float32Array == !0;
        if (!s && o)
            return e;
        var u = 4 === e.BYTES_PER_ELEMENT ? new Float32Array(e.buffer,e.byteOffset,e.length) : new Float32Array(e.length);
        return s ? (w[0] = r[a + "bbl_x"],
        w[1] = r[a + "bbl_y"],
        T[0] = r[a + "h_x"],
        T[1] = r[a + "h_y"],
        3 === i && (w[2] = r[a + "bbl_z"],
        T[2] = r[a + "h_z"]),
        l(e, u, w, T, i)) : (u.set(e),
        u)
    }
      , I = function(t, e, i, n, r, s) {
        var o, l = t.vb, h = this.getItemSize(), d = l.Size, f = l.Offset ? l.Offset : 0;
        o = l.Encoding && "varint" === l.Encoding ? c(new Uint8Array(s,f), h * d, t.type) : new p[t.type](s,f,h * d);
        var g = i[_]
          , x = C(e);
        if (0 === (g & x))
            return this.setElements(o),
            this;
        if ("Normal" === e)
            return this.setElements(a(o, new Float32Array(3 * d), 3, i.epsilon, i.nphi)),
            this.setItemSize(3),
            this;
        if ("Tangent" === e)
            return this.setElements(a(o, new Float32Array(4 * d), 4, i.epsilon, i.nphi)),
            this.setItemSize(4),
            this;
        var A = null;
        if ("Vertex" === e)
            A = i[b];
        else if (e.indexOf("TexCoord") !== -1) {
            var S = m + e.substr(8) + v;
            A = void 0 !== i[S] ? i[S] : i[b]
        }
        return A & y.prediction && void 0 !== r ? n.then(function() {
            return u(o, h, r.getElements()),
            this.setElements(E(A, o, h, e, i)),
            this
        }
        .bind(this)) : (this.setElements(E(A, o, h, e, i)),
        this)
    }
      , k = function(t, e, i) {
        p.NodeVisitor.call(this),
        this._emptyGeometries = [],
        this._resourceLoader = t,
        this._options = e,
        this._promises = i,
        this._wireframesPromises = []
    };
    k.prototype = p.objectInherit(p.NodeVisitor.prototype, {
        apply: function(t) {
            if (t instanceof p.Geometry == !1)
                return this.traverse(t);
            if (0 === t.getPrimitiveSetList().length && !d().keepEmptyGeometries)
                return void this._emptyGeometries.push(t);
            var e = this._options
              , i = e.wireframeOptions;
            if (i && 1 === t.userDataMap.wireframe) {
                t.setNodeMask(0);
                var r = n.defer();
                this._wireframesPromises.push(r.promise),
                i.nodes.push(t);
                var a = this;
                i.startPromise.then(function() {
                    a.processGeometry(t, i).then(r.resolve.bind(r))
                })
            } else
                this._promises.push(this.processGeometry(t, e))
        },
        processGeometry: function(t, e) {
            var i, r, a = t.userDataMap, s = 0, o = this._options, u = this._resourceLoader, l = o.prefixURL, c = o.bufferMap, h = [], d = t.getPrimitiveSetList(), g = d.length, m = [0];
            for (s = 0; s < g; ++s) {
                var v = d[s];
                if (!(v instanceof p.DrawArrays || v instanceof p.DrawArrayLengths)) {
                    var _ = v.getIndices();
                    _.getInitialBufferArray && (_ = _.getInitialBufferArray());
                    var b = c[_.getInstanceID()];
                    if (b.visited !== !0)
                        if (b.visited = !0,
                        b.inlined)
                            _.setElements(new Uint16Array(b.inlined)),
                            v.setCount(_.getElements().length);
                        else {
                            var x = u.getBinaryArray(l + b.vb.File, e).getPromise();
                            h.push(x),
                            x.then(M.bind(v, b, a, m)),
                            v.getMode() === p.PrimitiveSet.TRIANGLE_STRIP && (r = x,
                            i = _)
                        }
                }
            }
            var A = t.getVertexAttributeList()
              , y = Object.keys(A);
            y.sort(f);
            var S = y.length;
            for (s = 0; s < S; ++s) {
                var C = y[s]
                  , w = A[C];
                w.getInitialBufferArray && (w = w.getInitialBufferArray());
                var T = c[w.getInstanceID()];
                if (T.visited !== !0)
                    if (T.visited = !0,
                    T.inlined)
                        w.setElements(new Float32Array(T.inlined));
                    else {
                        var E = a
                          , k = C.indexOf("_");
                        if (k !== -1) {
                            var F = C.slice(k + 1);
                            E = a["morph_" + F],
                            C = C.slice(0, k)
                        }
                        var D = u.getBinaryArray(l + T.vb.File, e).getPromise()
                          , N = D.then(I.bind(w, T, C, E, r, i));
                        h.push(N)
                    }
            }
            return n.all(h)
        },
        removeEmptyGeometries: function() {
            for (var t = this._emptyGeometries, e = 0, i = t.length; e < i; ++e)
                for (var n = t[e], r = n.getParents(), a = 0, s = r.length; a < s; ++a)
                    r[a].removeChild(n)
        }
    });
    var F = {};
    F.postParse = function(t, e, i) {
        var r = []
          , a = new k(e,i,r);
        t.accept(a),
        a.removeEmptyGeometries();
        var s = i.wireframeOptions;
        if (s) {
            var o = s.deferDownload;
            n.all(a._wireframesPromises).then(o.resolve.bind(o))
        }
        return n.all(r)
    }
    ,
    t.exports = F
}
, function(t, e) {
    "use strict";
    var i = 1.57079632679
      , n = 6.28318530718
      , r = 3.14159265359
      , a = .01745329251
      , s = .25
      , o = 720
      , u = 832
      , l = 47938362584151635e-21
      , c = {}
      , h = function(t, e, h, d, p, f) {
        d = d || s,
        p = p || o;
        var g = Math.cos(d * a)
          , m = 0
          , v = 0
          , _ = c.table;
        if (void 0 === _)
            for (v = (p + 1) * (u + 1) * 3,
            _ = c.table = new Float32Array(v),
            m = 0; m < v; ++m)
                _[m] = 1 / 0;
        var b = r / (p - 1)
          , x = i / (p - 1)
          , A = f ? 3 : 2;
        for (m = 0,
        v = t.length / A; m < v; ++m) {
            var y = m * h
              , S = m * A
              , C = t[S]
              , M = t[S + 1];
            4 !== h || f || (e[y + 3] = 1024 & C ? -1 : 1,
            C &= -1025);
            var w, T, E, I = 3 * (C + p * M);
            if (w = _[I],
            w === 1 / 0) {
                var k = C * b
                  , F = Math.cos(k)
                  , D = Math.sin(k);
                k += x;
                var N = (g - F * Math.cos(k)) / Math.max(1e-5, D * Math.sin(k));
                N > 1 ? N = 1 : N < -1 && (N = -1);
                var R = M * n / Math.ceil(r / Math.max(1e-5, Math.acos(N)));
                w = _[I] = D * Math.cos(R),
                T = _[I + 1] = D * Math.sin(R),
                E = _[I + 2] = F
            } else
                T = _[I + 1],
                E = _[I + 2];
            if (f) {
                var P = t[S + 2] * l
                  , L = Math.sin(P);
                e[y] = L * w,
                e[y + 1] = L * T,
                e[y + 2] = L * E,
                e[y + 3] = Math.cos(P)
            } else
                e[y] = w,
                e[y + 1] = T,
                e[y + 2] = E
        }
        return e
    };
    t.exports = h
}
, function(t, e) {
    "use strict";
    var i = function(t, e) {
        for (var i = e || 0, n = t.length, r = t[i], a = i + 1; a < n; ++a) {
            var s = t[a];
            r = t[a] = r + (s >> 1 ^ -(1 & s))
        }
        return t
    };
    t.exports = i
}
, function(t, e) {
    "use strict";
    var i = function(t, e, n, r) {
        for (var a = t[i.IMPLICIT_HEADER_EXPECTED_INDEX], s = t[i.IMPLICIT_HEADER_MASK_LENGTH], o = new Uint32Array(t.subarray(i.IMPLICIT_HEADER_LENGTH, s + i.IMPLICIT_HEADER_LENGTH)), u = 32 * s - e.length, l = 1 << 31, c = 0; c < s; ++c)
            for (var h = o[c], d = 32, p = c * d, f = c === s - 1 ? u : 0, g = f; g < d; ++g,
            ++p)
                h & l >>> g ? e[p] = t[n++] : e[p] = r ? a : a++;
        return e
    };
    i.IMPLICIT_HEADER_PRIMITIVE_LENGTH = 0,
    i.IMPLICIT_HEADER_MASK_LENGTH = 1,
    i.IMPLICIT_HEADER_EXPECTED_INDEX = 2,
    i.IMPLICIT_HEADER_LENGTH = 3,
    t.exports = i
}
, function(t, e) {
    "use strict";
    var i = function(t, e, i) {
        var n = t.length / e
          , r = new Uint8Array(n)
          , a = i.length - 1;
        r[i[0]] = 1,
        r[i[1]] = 1,
        r[i[2]] = 1;
        for (var s = 2; s < a; ++s) {
            var o = s - 2
              , u = i[o]
              , l = i[o + 1]
              , c = i[o + 2]
              , h = i[o + 3];
            if (1 !== r[h]) {
                r[h] = 1,
                u *= e,
                l *= e,
                c *= e,
                h *= e;
                for (var d = 0; d < e; ++d)
                    t[h + d] = t[h + d] + t[l + d] + t[c + d] - t[u + d]
            }
        }
        return t
    };
    t.exports = i
}
, function(t, e) {
    "use strict";
    var i = function(t, e, i, n, r) {
        for (var a = t.length / r, s = 0; s < a; ++s)
            for (var o = s * r, u = 0; u < r; ++u)
                e[o + u] = i[u] + t[o + u] * n[u];
        return e
    };
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = function(t, e, i) {
        for (var n = new r[i](e), a = 0, s = 0; a !== e; ) {
            var o = 0
              , u = 0;
            do
                o |= (127 & t[s]) << u,
                u += 7;
            while (0 !== (128 & t[s++]));n[a++] = o
        }
        if ("U" !== i[0])
            for (var l = 0; l < e; ++l) {
                var c = n[l];
                n[l] = c >> 1 ^ -(1 & c)
            }
        return n
    };
    t.exports = a
}
, function(t, e) {
    "use strict";
    var i = function(t, e, i) {
        for (var n = i[0], r = t.length, a = 0; a < r; ++a) {
            var s = n - t[a];
            e[a] = s,
            n <= s && (n = s + 1)
        }
        return i[0] = n,
        e
    };
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1482)
      , a = i(1483)
      , s = n.osg
      , o = n.osgDB
      , u = n.osgAnimation
      , l = {}
      , c = {
        wireframe: !0,
        epsilon: !0,
        nphi: !0,
        attributes: !0,
        vertex_mode: !0,
        triangle_mode: !0,
        rigIndex: !0,
        framerate: !0,
        bx: !0,
        by: !0,
        bz: !0,
        hx: !0,
        hy: !0,
        hz: !0,
        ox: !0,
        oy: !0,
        oz: !0,
        ow: !0,
        ot: !0,
        channel_mode: !0
    };
    l.convertUserDataToObject = function(t, e) {
        var i = e || {};
        if (!t)
            return i;
        for (var n = 0, r = t.length; n < r; ++n) {
            var a = t[n]
              , s = a.Name;
            c[s] || s.indexOf("_bbl_") !== -1 || s.indexOf("_h_") !== -1 || s.indexOf("_mode") !== -1 ? i[s] = JSON.parse(a.Value) : i[s] = a.Value
        }
        return i
    }
    ,
    l.UserDataSetVisitor = function(t) {
        s.NodeVisitor.call(this),
        this._uidGeometryMap = {},
        this._promisePolygon = t
    }
    ,
    l.uidGeometryMap = {},
    l.UserDataSetVisitor.prototype = s.objectInherit(s.NodeVisitor.prototype, {
        checkVertexAlpha: function(t, e) {
            var i = e.getItemSize();
            if (3 !== i) {
                var n = e.getElements()
                  , r = !0
                  , s = !0
                  , o = n.length
                  , u = 0;
                for (u = 3; u < o; u += 4) {
                    var l = n[u];
                    if (0 !== l && (r = !1),
                    1 !== l && (s = !1),
                    !r && !r)
                        break
                }
                if (r)
                    for (u = 3; u < o; u += 4)
                        n[u] = 1;
                r || s || (a.hasVertexAlpha = t.userDataMap.hasVertexAlpha = !0)
            }
        },
        apply: function(t) {
            var e = t instanceof s.Geometry;
            if (e && void 0 !== t._uniqueID && (l.uidGeometryMap[t._uniqueID] = t),
            e || t instanceof u.Bone) {
                var i = t.userDataMap = l.convertUserDataToObject(t.getUserData())
                  , n = t;
                if (t.getSourceGeometry && (n = t.getSourceGeometry(),
                l.convertUserDataToObject(n.getUserData(), i)),
                n instanceof u.MorphGeometry)
                    for (var r = n.getMorphTargets(), o = 0, c = r.length; o < c; ++o) {
                        var h = i["morph_" + o] = {};
                        l.convertUserDataToObject(r[o].getUserData(), h)
                    }
            }
            if (e) {
                var d = t.getVertexAttributeList().Color;
                a.hasVertexColor = !!a.hasVertexColor || !!d,
                d && 4 === d.getItemSize() && this._promisePolygon.then(this.checkVertexAlpha.bind(this, t, d))
            }
            return this.traverse(t)
        }
    }),
    l.parse = function(t, e, i) {
        r.OSG_VERSION = t.Version;
        var n = o.parseSceneGraph(t, e);
        return n.then(function(t) {
            var e = new l.UserDataSetVisitor(i);
            return t.accept(e),
            t
        })
    }
    ,
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = {};
    r.OSG_VERSION = -1;
    var a = function(t) {
        var e = n.defer()
          , i = e.promise;
        r["get" + t] = function() {
            return i
        }
        ,
        r["resolve" + t] = function() {
            i.isFulfilled() === !1 && e.resolve.apply(e, arguments)
        }
    };
    a("Polygon"),
    a("Wireframe"),
    a("ModelDisplayed"),
    a("HasAnimation"),
    a("FirstCameraAnimation"),
    a("Material"),
    a("LowResLoaded"),
    a("HighResLoaded");
    var s = n.all([r.getHighResLoaded(), r.getFirstCameraAnimation()]);
    r.getHighResBound = function() {
        return s
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = function() {
        r.StateAttribute.call(this),
        this._diffuseColor = r.Vec3.create(),
        this._diffuseIntensity = r.Vec3.createAndSet(1, 1, 1),
        this._specularColor = r.Vec3.create(),
        this._specularIntensity = 1,
        this._emitColor = r.Vec3.create(),
        this._opacity = 1,
        this._specularHardness = 12.5,
        this._reflection = 0,
        this._shadeless = !1,
        this._cullFace = r.CullFace.DISABLE,
        this._additive = !1,
        this._opaqueEarlyZ = !0,
        this._vertexColorEnable = !1,
        this._vertexAlphaEnable = !1,
        this._vertexColorColorSpace = !1
    };
    a.hasVertexColor = !1,
    a.hasVertexAlpha = !1,
    a.prototype = r.objectLibraryClass(r.objectInherit(r.StateAttribute.prototype, {
        attributeType: "SketchfabMaterial",
        getHash: function() {
            return (this._vertexColorEnable ? "1" : "0") + (this._vertexAlphaEnable ? "1" : "0") + ("srgb" === this._vertexColorColorSpace ? "1" : "0") + (this.attributeType || "0") + (this._diffuseShader || "0") + (this._specularShader || "0") + this._shadeless.toString()
        },
        cloneType: function() {
            return new a
        },
        getShadeless: function() {
            return this._shadeless
        },
        setShadeless: function(t) {
            this._shadeless = t
        },
        getReflection: function() {
            return this._reflection
        },
        setReflection: function(t) {
            this._reflection = t
        },
        getType: function() {
            return this.attributeType
        },
        getTypeMember: function() {
            return this.attributeType
        },
        setVertexColorEnable: function(t) {
            this._vertexColorEnable = t
        },
        getVertexColorEnable: function() {
            return this._vertexColorEnable
        },
        setVertexAlphaEnable: function(t) {
            this._vertexAlphaEnable = t
        },
        getVertexAlphaEnable: function() {
            return this._vertexAlphaEnable
        },
        setVertexColorColorSpace: function(t) {
            this._vertexColorColorSpace = t
        },
        getVertexColorColorSpace: function() {
            return this._vertexColorColorSpace
        },
        setCullFace: function(t) {
            this._cullFace = t
        },
        getCullFace: function() {
            return this._cullFace
        },
        setAdditive: function(t) {
            this._additive = t
        },
        getAdditive: function() {
            return this._additive
        },
        setOpaqueEarlyZ: function(t) {
            this._opaqueEarlyZ = t
        },
        getOpaqueEarlyZ: function() {
            return this._opaqueEarlyZ
        },
        getOrCreateUniforms: function() {
            var t = a;
            if (t.uniforms)
                return t.uniforms;
            var e = {};
            return e.uReflection = r.Uniform.createFloat("uReflection"),
            e.uAdditive = r.Uniform.createInt("uAdditive"),
            t.uniforms = new r.Map(e),
            t.uniforms
        },
        apply: function() {
            var t = this.getOrCreateUniforms();
            t.uReflection.setFloat(this.getReflection()),
            t.uAdditive.setInt(this.getAdditive() ? 1 : 0)
        }
    }), "osgSketchfab", "Material"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(1198)
      , a = i(1485)
      , s = i(1482)
      , o = i(1486)
      , u = r.osg
      , l = function(t) {
        return 0 !== t && (t & ~t + 1) === t
    }
      , c = function(t) {
        return 1 << Math.floor(Math.log2(t))
    }
      , h = function() {
        u.Texture.call(this),
        this._imageProxy = void 0,
        this._convertNPOT = !0,
        this._trueFormat = void 0
    };
    h.WAIT_ANIMATION = !0;
    var d = u.ImageStream.prototype.play;
    u.ImageStream.prototype.play = function() {
        this._status !== u.ImageStream.PLAYING && (o.draw(),
        d.call(this))
    }
    ;
    var p = navigator.userAgent.indexOf("Firefox/46") === -1;
    h.prototype = u.objectLibraryClass(u.objectInherit(u.Texture.prototype, {
        getImageFormat: function() {
            return this._trueFormat || this.getInternalFormat()
        },
        setImage: function(t, e) {
            var i = t instanceof u.Image;
            if (!i || t.isDirty() || t !== this.getImage()) {
                t._alphaInR && this.getInternalFormat() === u.Texture.ALPHA && (this._trueFormat = u.Texture.ALPHA,
                this.setInternalFormat(u.Texture.LUMINANCE));
                var n = t instanceof u.ImageStream;
                if (this._convertNPOT && i && !n) {
                    var r = t.getWidth()
                      , a = t.getHeight();
                    if (!l(r) || !l(a)) {
                        var s = document.createElement("canvas");
                        r = s.width = c(r),
                        a = s.height = c(a);
                        var h = s.getContext("2d");
                        h.drawImage(t.getImage(), 0, 0, r, a),
                        t = s
                    }
                }
                !p && this.hasMipmapFilter() && this.setMinFilter(this.getMagFilter()),
                u.Texture.prototype.setImage.call(this, t, e),
                o.draw()
            }
        },
        applyTexImage2D: function() {
            u.Texture.prototype.applyTexImage2D.apply(this, arguments),
            o.draw()
        },
        getResourceManager: function() {
            return this._resourceManager || i(1197).instance
        },
        setImageProxy: function(t) {
            this._imageProxy = t
        },
        getImageProxy: function() {
            return this._imageProxy
        },
        getImageCount: function() {
            var t = this._imageProxy;
            return t && t.getImages ? t.getImages().length : this._image ? 1 : 0
        },
        setEntryPromiseImage: function(t) {
            t.promise.isFulfilled() === !0 && t.image ? this.setImage(t.image) : t.promise.then(this.setImage.bind(this))
        },
        setImageSmallest: function() {
            var t = this.getImageSmallest();
            if (t)
                return this.setEntryPromiseImage(t),
                t
        },
        setImageMaxSupported: function() {
            var t = this.getImageMaxSupported();
            if (t) {
                var e = h.WAIT_ANIMATION ? s.getFirstCameraAnimation() : n.resolve()
                  , i = n.settle([e, t.promise])
                  , r = this;
                return t.promise = i.then(function() {
                    return r.setImage(t.image),
                    t.image
                }),
                t
            }
        },
        getImageSmallest: function() {
            if (this._imageProxy)
                return this.getResourceImage(this._imageProxy.findImageNearestToResolution(128, 128, this.getImageFormat()))
        },
        getImageJSONMaxSupported: function(t) {
            t = a(void 0 !== t ? t : 1 / 0);
            var e = this._imageProxy.findImageNearestPowerOfTwoUpToResolution(t, t, this.getImageFormat());
            if (e.width !== t && e.height !== t) {
                var i = this._imageProxy.findImageNearestPowerOfTwoUpToResolution(t, t);
                (i.width > e.width || i.height > e.height) && (e = i)
            }
            return e
        },
        getImageMaxSupported: function() {
            if (this._imageProxy)
                return this.getResourceImage(this.getImageJSONMaxSupported())
        },
        getImageWidget: function() {
            if (this._imageProxy)
                return this.getResourceImage(this._imageProxy.findImageWidget(), !0)
        },
        getResourceImage: function(t, e) {
            return !e && t.url && t.width * t.height > 1048576 && (t.options = t.options || {},
            t.options.decodeAsync = !0),
            this.getResourceManager().getOrCreateImage(t.url, t.options)
        },
        getHash: function() {
            return "osgSketchfabTexture"
        }
    }), "osgSketchfab", "Texture"),
    h.dummyTexture = new h,
    h.dummyTexture.setTextureSize(1, 1),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1465)
      , a = n.osg
      , s = function(t) {
        var e = r().maxTextureSize
          , i = Math.min(void 0 === e ? 8192 : e, t);
        return Math.min(i, a.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_SIZE"))
    };
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n, r, a, s, o, u, l = i(1198), c = i(222), h = l.osg, d = {}, p = -1, f = 0, g = 40, m = h.Timer.instance().tick(), v = !1;
    ["hidden", "mozHidden", "msHidden", "webkitHidden"].forEach(function(t) {
        document && document[t] && (o = t,
        u = t.toLowerCase().split("hidden").shift() + "visibilitychange")
    });
    var _ = function() {
        if (s = window.setTimeout(_, g),
        n && !v && !d.isDrawAlreadyQueued() && a && a.canBeEnabled()) {
            var t = h.Timer.instance().tick()
              , e = t - m - g;
            e <= g || (a.enable(),
            p = -1)
        }
    };
    c() || (s = window.setTimeout(_, g));
    var b, x = function(t) {
        if (n && !v && (!r || !document[o])) {
            var e = d.isDrawAlreadyQueued();
            if (e || n.requestRedraw(),
            a && !t && (a.reset(),
            !e)) {
                var i = h.Timer.instance().tick();
                f += i - m,
                p++,
                0 === p ? (p = 0,
                f = 0) : 4 === p && (g = Math.min(200, Math.max(16, f / p)),
                p = 0,
                f = 0),
                m = i
            }
        }
    };
    d.setPoseForScreenshot = function(t) {
        t && !v ? (b = n.getManipulator().update,
        n.getManipulator().update = function() {}
        ) : !t && v && (n.getManipulator().update = b),
        v = t
    }
    ,
    d.isDrawAlreadyQueued = function() {
        return n._requestRedraw
    }
    ,
    d.getPoseForScreenshot = function() {
        return v
    }
    ,
    d.draw = function() {
        x()
    }
    ,
    d.setLoaded = function(t) {
        r = t
    }
    ,
    d.drawSameFrame = function() {
        x(!0)
    }
    ,
    d.setViewer = function(t) {
        n = t
    }
    ,
    d.setSuperSample = function(t) {
        a = t
    }
    ,
    u && document.addEventListener(u, d.draw),
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = function() {
        r.TextureCubeMap.call(this),
        this._imageProxy = void 0
    };
    a.prototype = r.objectLibraryClass(r.objectInherit(r.TextureCubeMap.prototype, {
        getHash: function() {
            return "osgSketchfabTexture"
        }
    }), "osgSketchfab", "TextureCubeMap"),
    t.exports = a
}
, 1472, function(t, e, i) {
    "use strict";
    var n = i(1490)
      , r = i(247)
      , a = i(239);
    t.exports = r.extend({
        comparator: "order",
        model: n,
        _trashbin: [],
        url: function() {
            var t = this.options.filters.get("modelUID")
              , e = "/i/models/" + t + "/animations";
            return e + a.craft("?", {})
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(220)
      , a = i(238)
      , s = "/i/animations";
    t.exports = a.extend({
        defaults: {
            name: "",
            uid: "",
            duration: 0,
            isLoop: !1,
            isEnabled: !0
        },
        url: function() {
            return s + "/" + this.get("uid")
        },
        save: function(t, e) {
            null != t && "object" != typeof t || (e = t);
            var i = new FormData;
            i.append("name", this.get("name")),
            i.append("isLoop", this.get("isLoop")),
            i.append("isEnabled", this.get("isEnabled"));
            var a = r.ajax({
                type: "PATCH",
                url: this.url(),
                data: i,
                cache: !1,
                contentType: !1,
                processData: !1
            });
            return n.resolve(a)
        }
    })
}
, function(t, e, i) {
    "use strict";
    i(1492);
    var n = i(235)
      , r = i(1198)
      , a = i(1482)
      , s = i(258)
      , o = i(1496)
      , u = i(1486)
      , l = i(1481)
      , c = i(255)
      , h = r.osg
      , d = r.osgAnimation
      , p = r.osgWrappers
      , f = p.osg
      , g = s.extend({
        initialize: function() {
            s.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:playing", this.onPlayingChanged, this),
            t.bind("change:speed", this.onSpeedChanged, this),
            t.bind("change:currentUID", this.onCurrentAnimationChanged, this),
            t.bind("seek", this.onSeek, this),
            this._manager = null,
            this._idLoop = 0,
            this._skeletons = [],
            this._viewer = this.options.context.getViewer(),
            this._firstAnimationPlayed = !1,
            this._hookBasicAnimationManager(a.getPolygon()),
            a.getMaterial().then(this._initAnimation.bind(this))
        },
        _initAnimation: function() {
            this._manager && (this.onSpeedChanged(),
            o.init(this._skeletons, this._viewer, this.model))
        },
        _hookBasicAnimationManager: function(t) {
            var e = this.model
              , i = this
              , r = function(t, n) {
                var r = i.getCurrentInstanceAnimation();
                (this._seekTime !== -1 || !this._pause && r) && u.draw();
                var a = d.BasicAnimationManager.prototype.update.call(this, t, n);
                if (r) {
                    var s = Math.max(0, this.getSimulationTime() * this.getTimeFactor() - r.start)
                      , o = 100 * (s % r.duration) / r.duration
                      , l = Math.floor(s / r.duration);
                    l > this._idLoop && (o = 100,
                    i.end(),
                    "one" !== e.get("cycleMode") && (a = d.BasicAnimationManager.prototype.update.call(this, t, n))),
                    this._idLoop = l,
                    e.set("progress", o)
                }
                return a
            }
              , s = function(t) {
                var e = i.getCurrentInstanceAnimation()
                  , n = i.model.get("fps");
                if (e && n > 0) {
                    var r = 1 / n
                      , a = (t - e.start) % r;
                    a > .5 * r ? t += r - a : t -= a
                }
                return d.BasicAnimationManager.prototype.updateManager.call(this, t)
            };
            p.osgAnimation.BasicAnimationManager = function(o, u) {
                var c = o.getJSON();
                return c.Animations ? (f.Object(o, u),
                a.OSG_VERSION < 8 ? n.resolve(u) : this._manager ? (h.error("More than one basicAnimationManager !"),
                n.resolve(u)) : (this._manager = u,
                e.get("playing") || u.togglePause(),
                u.update = r,
                u.updateManager = s,
                t.then(function() {
                    var t = o.getOptions();
                    t.progress = void 0;
                    for (var e = c.Animations.length, n = 0; n < e; ++n) {
                        var r = c.Animations[n]
                          , a = o.setJSON(r["osgAnimation.Animation"].UserDataContainer).readUserDataContainer()
                          , s = l.convertUserDataToObject(a)
                          , u = i.model.getAnimationByUID(s.AnimationUID);
                        if (u) {
                            t.currentAnimationUID = u.get("url");
                            var d = o.setJSON(r).readObject();
                            d.isRejected() ? h.Notify.warn("An Animation failed on the parsing!") : d.then(i.onAddAnimation.bind(i, n, s))
                        }
                    }
                }),
                n.resolve(u))) : n.reject()
            }
            .bind(this)
        },
        onAddAnimation: function(t, e, i) {
            var n = e.AnimationUID;
            i.name = n,
            i.duration || (i.duration = 2.5,
            i.still = !0),
            this._manager.addAnimations([i]),
            0 === i.duration && (this._manager.getAnimations()[n].duration = 2.5);
            var r = this.model;
            r.trigger("change:animations");
            var a = r.getAnimationByUID(n);
            if (a.on("change:isLoop", this.onAnimationChangeLoop.bind(this)),
            a.get("isLoop") && this.onAnimationChangeLoop(a),
            this.model.get("currentUID") === n && this.onCurrentAnimationChanged(),
            !this._firstAnimationPlayed && this.model.get("autoplay")) {
                var s = this.model.getFirstEnabledAnimation();
                void 0 !== s && n === s.get("uid") && (this._firstAnimationPlayed = !0,
                this.model.set("currentUID", n))
            }
        },
        onAnimationChangeLoop: function(t) {
            var e = this._manager.getAnimations()[t.get("uid")];
            this._manager.setAnimationLerpEndStart(e, t.get("isLoop") ? 1 / 30 : 0)
        },
        onCurrentAnimationChanged: function() {
            this._idLoop = 0;
            var t = this._manager;
            if (t.stopAllAnimation(),
            t.resetAllStackedTransforms(),
            this.getCurrentAnimation()) {
                var e = this.getCurrentInstanceAnimation();
                e && (t.playAnimation(e),
                t.setSeekTime(e.start))
            }
            u.draw()
        },
        getCurrentAnimation: function() {
            return this.model.getCurrentAnimation()
        },
        getCurrentInstanceAnimation: function() {
            var t = this.getCurrentAnimation();
            return t ? this._manager.getAnimations()[t.get("uid")] : void 0
        },
        onPlayingChanged: function() {
            if (this._playlistNoLoopEnd) {
                var t = this.model.getFirstEnabledAnimation().get("uid") || "-1";
                this._playlistNoLoopEnd = !1,
                t === this.getCurrentAnimation().get("uid") ? this.model.trigger("seek", 0) : this.model.set("currentUID", t)
            }
            this._manager.togglePause(),
            u.draw()
        },
        onSeek: function(t) {
            var e = this.getCurrentInstanceAnimation();
            if (e) {
                var i = this._manager;
                i.setSeekTime(e.start + e.duration * (t / 100) / i.getTimeFactor()),
                u.draw()
            }
        },
        onSpeedChanged: function() {
            this._manager.setTimeFactor(this.model.get("speed")),
            c.modelViewerAnimationSpeedSelected(this.model.get("speed"))
        },
        end: function() {
            var t = this.model.get("cycleMode");
            if ("one" === t)
                this.model.trigger("cycleMode");
            else if ("all" === t || "none" === t) {
                var e, i = this.model.get("animations"), n = i.indexOf(this.getCurrentAnimation()), r = "-1", a = 0, s = i.length;
                for (a = n + 1; a < s; ++a)
                    if (e = i.at(a),
                    e && e.get("isEnabled")) {
                        r = e.get("uid");
                        break
                    }
                "-1" === r && "all" === t && (r = this.model.getFirstEnabledAnimation() ? this.model.getFirstEnabledAnimation().get("uid") : "-1"),
                "-1" !== r ? this.model.set("currentUID", r) : (this.model.set("playing", !1),
                this.model.trigger("seek", 99.99),
                this._playlistNoLoopEnd = !0)
            }
        }
    });
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(1198)
      , a = i(1481)
      , s = i(1197)
      , o = i(1493)
      , u = i(1494)
      , l = i(1495)
      , c = i(1479)
      , h = i(1478)
      , d = i(1474)
      , p = r.osg
      , f = r.osgDB
      , g = r.osgAnimation
      , m = r.osgWrappers.osgAnimation
      , v = g.Channel
      , _ = function() {}
      , b = f.registry();
    b.registerObject("osgAnimation.Vec3LerpChannelCompressedPacked", _),
    b.registerObject("osgAnimation.Vec3LerpChannelCompressed", _),
    b.registerObject("osgAnimation.Vec3LerpChannelPacked", _),
    b.registerObject("osgAnimation.QuatSlerpChannelCompressedPacked", _),
    b.registerObject("osgAnimation.QuatSlerpChannelCompressed", _),
    b.registerObject("osgAnimation.QuatSlerpChannelPacked", _),
    b.registerObject("osgAnimation.FloatLerpChannelCompressedPacked", _),
    b.registerObject("osgAnimation.FloatLerpChannelCompressed", _),
    b.registerObject("osgAnimation.FloatLerpChannelPacked", _);
    var x = {}
      , A = (new s)._resourceLoader
      , y = "channel_mode"
      , S = {
        quantization: 1,
        prediction: 2,
        delta: 4,
        quat: 8,
        deltaTime: 16
    }
      , C = function(t, e, i, n, r, a) {
        var s, f = e.ItemSize, g = Object.keys(e.Array)[0], m = e.Array[g], v = m.Offset ? m.Offset : 0, _ = m.Size, b = i[y] || 0, x = !!(1 === a ? b & S.deltaTime : b & S.delta), A = new ArrayBuffer(4 * (x ? _ + 2 : _ + 1) * a), C = new Float32Array(A,x ? 4 * a : 0,_ * a);
        return s = m.Encoding && "varint" === m.Encoding ? c(new Uint8Array(t,v), f * _, g) : new p[g](t,v,f * _),
        4 === a && b & S.quat ? (r && (s = o(s, new Float32Array(s.length), f)),
        d(s, C, a, i.epsilon, i.nphi, !0),
        x && (C = new Float32Array(A,0,(_ + 1) * a),
        C[0] = i.ox,
        C[1] = i.oy,
        C[2] = i.oz,
        C[3] = i.ow,
        l(C)),
        C) : (r && 1 !== a ? o(s, C, f) : C.set(s),
        n ? (3 === a && b & S.quantization && h(C, C, [i.bx, i.by, i.bz], [i.hx, i.hy, i.hz], a),
        x && (C = new Float32Array(A,0,(_ + 1) * a),
        3 === a ? (C[0] = i.ox,
        C[1] = i.oy,
        C[2] = i.oz) : C[0] = i.ot,
        u(C, f)),
        C) : C)
    }
      , M = function(t, e, i, r, s, o) {
        var u = t.getJSON();
        if (!(void 0 !== u.TargetName && u.KeyFrames && u.Name && u.KeyFrames.Time && u.KeyFrames.Key))
            return n.reject();
        var l = u.UserDataContainer
          , c = l ? a.convertUserDataToObject(t.setJSON(l).readUserDataContainer()) : x;
        return A.getBinaryArray(t.getOptions().currentAnimationUID).getPromise().then(function(t) {
            var n = C(t, u.KeyFrames.Time, c, r, !1, 1)
              , a = C(t, u.KeyFrames.Key, c, r, s, o);
            return i(a, n, u.TargetName, u.Name, e),
            e
        })
    };
    m.Vec3LerpChannel = function(t, e) {
        return M(t, e, v.createVec3Channel, !1, !1, 3)
    }
    ,
    m.Vec3LerpChannelCompressedPacked = function(t, e) {
        return M(t, e, v.createVec3Channel, !0, !0, 3)
    }
    ,
    m.Vec3LerpChannelCompressed = function(t, e) {
        return M(t, e, v.createVec3Channel, !0, !1, 3)
    }
    ,
    m.Vec3LerpChannelPacked = function(t, e) {
        return M(t, e, v.createVec3Channel, !1, !0, 3)
    }
    ,
    m.QuatSlerpChannel = function(t, e) {
        return M(t, e, v.createQuatChannel, !1, !1, 4)
    }
    ,
    m.QuatSlerpChannelCompressedPacked = function(t, e) {
        return M(t, e, v.createQuatChannel, !0, !0, 4)
    }
    ,
    m.QuatSlerpChannelCompressed = function(t, e) {
        return M(t, e, v.createQuatChannel, !0, !1, 4)
    }
    ,
    m.QuatSlerpChannelPacked = function(t, e) {
        return M(t, e, v.createQuatChannel, !1, !0, 4)
    }
    ,
    m.FloatLerpChannel = function(t, e) {
        return M(t, e, v.createFloatChannel, !1, !1, 1)
    }
    ,
    m.FloatLerpChannelCompressedPacked = function(t, e) {
        return M(t, e, v.createFloatChannel, !0, !0, 1)
    }
    ,
    m.FloatLerpChannelCompressed = function(t, e) {
        return M(t, e, v.createFloatChannel, !0, !1, 1)
    }
    ,
    m.FloatLerpChannelPacked = function(t, e) {
        return M(t, e, v.createFloatChannel, !1, !0, 1)
    }
    ,
    t.exports = {}
}
, function(t, e) {
    "use strict";
    var i = function(t, e, i) {
        for (var n = t.length / i, r = 0; r < n; ++r)
            for (var a = r * i, s = 0; s < i; ++s)
                e[a + s] = t[r + n * s];
        return e
    };
    t.exports = i
}
, function(t, e) {
    "use strict";
    var i = function(t, e) {
        for (var i = e || 1, n = 1, r = t.length / i; n < r; ++n)
            for (var a = (n - 1) * i, s = n * i, o = 0; o < i; ++o)
                t[s + o] += t[a + o];
        return t
    };
    t.exports = i
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        for (var e = 1, i = t.length / 4; e < i; ++e) {
            var n = 4 * (e - 1)
              , r = 4 * e
              , a = t[n]
              , s = t[n + 1]
              , o = t[n + 2]
              , u = t[n + 3]
              , l = t[r]
              , c = t[r + 1]
              , h = t[r + 2]
              , d = t[r + 3];
            t[r] = a * d + s * h - o * c + u * l,
            t[r + 1] = -a * h + s * d + o * l + u * c,
            t[r + 2] = a * c - s * l + o * d + u * h,
            t[r + 3] = -a * l - s * c - o * h + u * d
        }
        return t
    };
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1482)
      , a = i(1497)
      , s = i(1514)
      , o = i(1465)
      , u = i(1515)
      , l = i(1516)
      , c = n.osg
      , h = n.osgUtil
      , d = n.osgAnimation
      , p = h.IntersectionVisitor.prototype.enter;
    h.IntersectionVisitor.prototype.enter = function(t) {
        return !!t._forceEnterIntersection || p.call(this, t)
    }
    ;
    var f = function() {};
    f.prototype = {
        cull: function() {
            return !1
        }
    };
    var g = new f
      , m = function() {
        var t = c.Vec3.create()
          , e = c.Vec3.create();
        return function(i) {
            i.center(t),
            c.Vec3.sub(i.getMax(), i.getMin(), e);
            var n = c.createTexturedBoxGeometry(t[0], t[1], t[2], e[0], e[1], e[2]);
            return n.setName("BoneBox"),
            3 !== o().showBones && n.setCullCallback(g),
            n._isBoneBox = !0,
            n.setNodeMask(s.PICK_GEOMETRY_RIG_BOX | s.SHADOW_BOUNDS),
            n
        }
    }()
      , v = function(t) {
        for (var e = h.GizmoGeometry.createCylinderGeometry(.1 * t, .02 * t, t), i = e.getAttributes().Vertex.getElements(), n = 0, r = i.length / 3; n < r; ++n)
            i[3 * n + 2] += .5 * t;
        return e._isSkeleton = !0,
        e
    }
      , _ = function(t) {
        c.NodeVisitor.call(this),
        this._visitedNodes = {},
        this._drawNames = t;
        var e = c.StateAttribute.OVERRIDE | c.StateAttribute.ON
          , i = this._geoStateSet = new c.StateSet;
        i.setShaderGeneratorName("skeleton", e),
        i.setAttributeAndModes(new c.Depth(c.Depth.ALWAYS), e),
        i.setRenderBinDetails(l.DEBUG_2, "RenderBin"),
        u.set("hasExtra", !0)
    };
    _.prototype = c.objectInherit(c.NodeVisitor.prototype, {
        drawBone: function() {
            var t = c.Vec3.create()
              , e = c.Vec3.createAndSet(0, 0, 1)
              , i = c.Quat.create();
            return function(n) {
                var r = n.getChildren();
                if (r.length)
                    for (var a = 0; a < r.length; ++a) {
                        var s = r[a];
                        if (s instanceof d.Bone != !1) {
                            c.Matrix.transformVec3(s.getMatrix(), c.Vec3.init(t), t);
                            var o = v(c.Vec3.length(t));
                            o.setStateSet(this._geoStateSet),
                            o._boundingBoxComputed = !0,
                            o._boundingSphereComputed = !0;
                            var u = new c.MatrixTransform;
                            c.Quat.makeRotateFromTo(e, c.Vec3.normalize(t, t), i),
                            c.Matrix.setRotateFromQuat(u.getMatrix(), i);
                            var l = c.Uniform.createFloat4("uColor")
                              , h = l.getInternalArray()
                              , p = n.getOrCreateDebugColor();
                            c.Vec3.copy(p, h),
                            h[0] = .9 * p[0],
                            h[1] = .9 * p[1],
                            h[2] = .9 * p[2],
                            h[3] = 1,
                            u.getOrCreateStateSet().addUniform(l);
                            var f = "Debug " + n.getName();
                            u.setName(f),
                            o.setName(f),
                            u.addChild(o),
                            n.addChild(u)
                        }
                    }
            }
        }(),
        apply: function(t) {
            var e = t.getInstanceID();
            this._visitedNodes[e] || (this._visitedNodes[e] = !0,
            t instanceof d.Bone && this._drawNames[t.getName()] && this.drawBone(t),
            this.traverse(t))
        }
    });
    var b = function(t, e) {
        c.NodeVisitor.call(this),
        this._wirePromise = r.getWireframe(),
        this._wireNodes = e.getOrCreateScene().getWireframeNodes(),
        this.nodeMaskOverride = -1,
        this._visitedNodes = {},
        this._drawBoneNames = {},
        this._rigIndexed = [],
        this._boneGeomIndexed = [],
        this._skls = t;
        var i = c.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_UNIFORM_VECTORS");
        this._maxBones = Math.floor((i - 19) / 3),
        d.SkinningAttribute.maxBoneUniformAllowed = 3 * this._maxBones,
        this._maxVA = c.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_ATTRIBS")
    };
    b.prototype = c.objectInherit(c.NodeVisitor.prototype, {
        createSplitRigGeometry: function(t) {
            var e = new d.RigGeometry;
            e.setName("Split (" + t.getInstanceID() + ")"),
            e.setStateSet(t.getStateSet()),
            e.setUserData(t.getUserData()),
            e.userDataMap = t.userDataMap,
            e.setSourceGeometry(t.getSourceGeometry()),
            e._forceEnterIntersection = !0;
            var i = 0
              , n = t.getVertexAttributeList()
              , r = e.getVertexAttributeList()
              , a = Object.keys(n)
              , o = a.length;
            for (i = 0; i < o; ++i) {
                var u = a[i];
                r[u] = n[u]
            }
            var l = n.Bones.getElements()
              , h = new l.constructor(l.length);
            r.Bones = new c.BufferArray(c.BufferArray.ARRAY_BUFFER,h,n.Bones.getItemSize(),(!0)),
            e.userDataMap.wireframe ? this._wireNodes.push(e) : e.setNodeMask(s.NO_PICK_NO_SHADOW_BOUNDS);
            var p = e.userDataMap.rigIndex;
            return void 0 !== p && (this._rigIndexed[p] = e),
            e._boundingSphereComputed = !0,
            e._boundingBoxComputed = !0,
            e
        },
        checkVertex: function(t, e) {
            var i = e.baseBones
              , n = e.baseWeights
              , r = e.mappedUsedBones
              , a = 0;
            return n[t] && !r[i[t]] && a++,
            n[t + 1] && !r[i[t + 1]] && a++,
            n[t + 2] && !r[i[t + 2]] && a++,
            n[t + 3] && !r[i[t + 3]] && a++,
            a
        },
        tagBoneVertex: function(t, e) {
            var i = e.baseBones
              , n = e.baseWeights
              , r = e.mappedUsedBones
              , a = e.boneNameID
              , s = e.boneToName
              , o = i[t];
            n[t] && !r[o] && (a[s[o]] = e.nbUsedBones,
            r[o] = ++e.nbUsedBones),
            e.newBones[t] = r[o] - 1,
            o = i[t + 1],
            n[t + 1] && !r[o] && (a[s[o]] = e.nbUsedBones,
            r[o] = ++e.nbUsedBones),
            e.newBones[t + 1] = r[o] - 1,
            o = i[t + 2],
            n[t + 2] && !r[o] && (a[s[o]] = e.nbUsedBones,
            r[o] = ++e.nbUsedBones),
            e.newBones[t + 2] = r[o] - 1,
            o = i[t + 3],
            n[t + 3] && !r[o] && (a[s[o]] = e.nbUsedBones,
            r[o] = ++e.nbUsedBones),
            e.newBones[t + 3] = r[o] - 1
        },
        splitTriangle: function(t, e, i, n) {
            if (n.currentIdPrimitive++,
            t === e || t === i || e === i || n.processedPrimitive[n.currentIdPrimitive - 1])
                return !0;
            var r = n.nbUsedBones
              , a = this.checkVertex(4 * t, n);
            if (r + a < this._maxBones && (a += this.checkVertex(4 * e, n)),
            r + a < this._maxBones && (a += this.checkVertex(4 * i, n)),
            r + a >= this._maxBones)
                return void (n.finished = !1);
            this.tagBoneVertex(4 * t, n),
            this.tagBoneVertex(4 * e, n),
            this.tagBoneVertex(4 * i, n);
            var s = n.first + n.countIdPrimitive;
            n.countIdPrimitive += 3,
            n.newIndexesElements[s] = t,
            n.newIndexesElements[s + 1] = e,
            n.newIndexesElements[s + 2] = i,
            n.processedPrimitive[n.currentIdPrimitive - 1] = 1
        },
        splitLine: function(t, e, i) {
            if (i.currentIdPrimitive++,
            t === e || i.processedPrimitive[i.currentIdPrimitive - 1])
                return !0;
            var n = i.nbUsedBones
              , r = this.checkVertex(4 * t, i);
            if (n + r < this._maxBones && (r += this.checkVertex(4 * e, i)),
            n + r >= this._maxBones)
                return void (i.finished = !1);
            this.tagBoneVertex(4 * t, i),
            this.tagBoneVertex(4 * e, i);
            var a = i.first + i.countIdPrimitive;
            i.countIdPrimitive += 2,
            i.newIndexesElements[a] = t,
            i.newIndexesElements[a + 1] = e,
            i.processedPrimitive[i.currentIdPrimitive - 1] = 1
        },
        callbackDrawElementsTriangles: function(t, e, i) {
            for (var n = 0; n < t; n += 3)
                this.splitTriangle(e[n], e[n + 1], e[n + 2], i)
        },
        callbackDrawElementsTriangleStrip: function(t, e, i) {
            for (var n = 2, r = 0; n < t; ++n,
            ++r)
                n % 2 ? this.splitTriangle(e[r], e[r + 2], e[r + 1], i) : this.splitTriangle(e[r], e[r + 1], e[r + 2], i)
        },
        callbackDrawElementsLines: function(t, e, i) {
            for (var n = 0; n < t; n += 2)
                this.splitLine(e[n], e[n + 1], i)
        },
        splitPrimitive: function(t, e) {
            t.finished = !0;
            var i = t.baseRig
              , n = t.primitive
              , r = this.createSplitRigGeometry(i);
            t.boneNameID = r._boneNameID,
            t.newBones = r.getVertexAttributeList().Bones.getElements(),
            t.mappedUsedBones = new Uint32Array(e),
            t.nbUsedBones = 0,
            t.currentIdPrimitive = 0,
            t.countIdPrimitive = 0;
            var a = n.getIndices().getElements()
              , s = n.getCount()
              , o = n.getMode();
            if (o === c.PrimitiveSet.TRIANGLE_STRIP ? this.callbackDrawElementsTriangleStrip(s, a, t) : o === c.PrimitiveSet.TRIANGLES ? this.callbackDrawElementsTriangles(s, a, t) : this.callbackDrawElementsLines(s, a, t),
            0 === t.countIdPrimitive)
                return !1;
            var u = new c.DrawElements(o === c.PrimitiveSet.LINES ? c.PrimitiveSet.LINES : c.PrimitiveSet.TRIANGLES,t.newIndexesBuffer);
            u.setFirst(t.first * t.newIndexesElements.BYTES_PER_ELEMENT),
            u.setCount(t.countIdPrimitive),
            t.first += t.countIdPrimitive,
            r.getPrimitives().push(u);
            for (var l = i.getParents(), h = l.length, d = 0; d < h; ++d)
                l[d].addChild(r);
            return !t.finished
        },
        getBoneToNames: function(t, e) {
            for (var i = e.length, n = new Array(i), r = 0; r < i; ++r) {
                var a = e[r];
                n[t[a]] = a
            }
            return n
        },
        splitRigGeometry: function(t) {
            for (var e = t._boneNameID, i = Object.keys(e), n = i.length, r = t.getPrimitives(), a = r.length, s = {
                baseRig: t,
                baseWeights: t.getVertexAttributeList().Weights.getElements(),
                baseBones: t.getVertexAttributeList().Bones.getElements(),
                boneToName: this.getBoneToNames(t._boneNameID, i)
            }, o = 0; o < a; ++o) {
                var u = r[o]
                  , l = u.getMode();
                if (0 !== u.getCount())
                    if (u instanceof c.DrawElements != !1)
                        if (l === c.PrimitiveSet.TRIANGLE_STRIP || l === c.PrimitiveSet.TRIANGLES || l === c.PrimitiveSet.LINES) {
                            var h = u.getIndices()
                              , d = h.getElements()
                              , p = l === c.PrimitiveSet.TRIANGLE_STRIP ? 3 : 1;
                            for (s.newIndexesElements = new d.constructor(u.getCount() * p),
                            s.newIndexesBuffer = new c.BufferArray(c.BufferArray.ELEMENT_ARRAY_BUFFER,s.newIndexesElements,h.getItemSize(),(!0)),
                            s.first = u.getFirst(),
                            s.processedPrimitive = new Uint8Array(u.getCount()),
                            s.primitive = u; this.splitPrimitive(s, n); )
                                ;
                            s.newIndexesBuffer.setElements(s.newIndexesElements.subarray(0, s.first))
                        } else
                            c.error("Split rigged primitives mode not yet handled : ", l);
                    else
                        c.error("Split rigged primitives type not yet handled", u)
            }
        },
        handleRigGeometry: function(t) {
            var e = t._boneNameID
              , i = Object.keys(e)
              , n = i.length
              , r = o().showBones
              , a = t.userDataMap.wireframe
              , u = t.userDataMap.rigIndex;
            if (void 0 !== u && (this._rigIndexed[u] = t),
            1 === r || 2 === r)
                if (a)
                    t.setCullCallback(g);
                else {
                    2 !== r && t.setNodeMask(0);
                    for (var l = this._drawBoneNames, c = 0; c < n; ++c)
                        l[i[c]] = !0
                }
            else
                this._maxBones < n ? (a ? (t._boundingBoxComputed = !0,
                t._boundingSphereComputed = !0,
                t.setNodeMask(0),
                this._wirePromise.then(this.splitRigGeometry.bind(this, t))) : (this.splitRigGeometry(t),
                t.setNodeMask(s.NO_PICK_NO_SHADOW_BOUNDS | s.PICK_GEOMETRY_ANIMATED)),
                t.setCullCallback(g)) : a || t.setNodeMask(s.NO_PICK_NO_SHADOW_BOUNDS | s.PICK_GEOMETRY_ANIMATED);
            this.tagForceIntersection()
        },
        tagForceIntersection: function() {
            for (var t = this._skls[this._skls.length - 1], e = 1 + this.nodePath.indexOf(t); e < this.nodePath.length; ++e)
                this.nodePath[e]._forceEnterIntersection = !0
        },
        popTargetAttribute: function(t, e, i) {
            for (var n = e.getMorphTargets(), r = n.length, a = t.getVertexAttributeList(), s = e.getVertexAttributeList(), o = 0; o < r; ++o) {
                delete n[o].getVertexAttributeList()[i];
                var u = i + "_" + o;
                delete a[u],
                a !== s && delete s[u]
            }
        },
        computeUsedVA: function(t, e, i) {
            var n = Object.keys(t).length - Object.keys(e).length * (i.length - Math.min(4, i.length));
            return t.Color || n++,
            n
        },
        handleMorphGeometry: function(t, e) {
            var i = e.getVertexAttributeList()
              , n = e.getMorphTargets()
              , r = n[0].getVertexAttributeList()
              , a = t.getVertexAttributeList()
              , s = this.computeUsedVA(a, r, n)
              , o = this._maxVA;
            if (!(s <= o || a.Tangent_1 && (this.popTargetAttribute(t, e, "Tangent"),
            s = this.computeUsedVA(a, r, n),
            s <= o) || a.Normal_1 && (this.popTargetAttribute(t, e, "Normal"),
            s = this.computeUsedVA(a, r, n),
            s <= o))) {
                for (var u = n.length; u > 0; ) {
                    var l = n.pop();
                    u = n.length;
                    for (var c = Object.keys(l.getVertexAttributeList()), h = c.length, d = 0; d < h; ++d) {
                        var p = c[d] + "_" + u;
                        delete a[p],
                        a !== i && delete i[p]
                    }
                    if (s = this.computeUsedVA(a, r, n),
                    s <= o)
                        return
                }
                console.warn("Too much vertex attributes !")
            }
        },
        apply: function(t) {
            var e = t.getInstanceID();
            if (!this._visitedNodes[e]) {
                this._visitedNodes[e] = !0;
                var i = t instanceof d.RigGeometry
                  , n = i ? t.getSourceGeometry() : t;
                if (n instanceof d.MorphGeometry && this.handleMorphGeometry(t, n),
                i)
                    this.handleRigGeometry(t);
                else if (t instanceof d.Bone) {
                    var r = t.getBoneBoundingBox();
                    if (r.valid()) {
                        var a = m(r);
                        t.addChild(a);
                        var s = t.userDataMap.rigIndex;
                        void 0 !== s && this._boneGeomIndexed.push(a)
                    }
                } else
                    t instanceof d.Skeleton && this._skls.push(t);
                this.traverse(t)
            }
        }
    });
    var x = {};
    x.DrawBones = _,
    x.hideCullCallback = g,
    x.init = function(t, e, i) {
        var n = new b(t,e)
          , r = e.getOrCreateScene().getRoot();
        c.time("InitGraphAnimation"),
        r.accept(n),
        c.timeEnd("InitGraphAnimation");
        for (var s = n._boneGeomIndexed, o = n._rigIndexed, u = s.length, l = 0; l < u; ++l) {
            var h = s[l];
            h._mostInfluencedRig = o[h.getParents()[0].userDataMap.rigIndex]
        }
        Object.keys(n._drawBoneNames).length > 0 && (e.getViewerOSGJS().getState().getShaderGeneratorProxy().addShaderGenerator("skeleton", new a),
        r.accept(new _(n._drawBoneNames)),
        i.set("notSupported", !0))
    }
    ,
    t.exports = x
}
, function(t, e, i) {
    "use strict";
    var n = i(1498)
      , r = i(1509)
      , a = function() {
        n.apply(this, arguments),
        this.setShaderCompiler(r)
    };
    a.prototype = n.prototype,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1499)
      , a = i(1503)
      , s = i(1504)
      , o = i(1505)
      , u = i(1506)
      , l = i(1507)
      , c = i(1508)
      , h = n.osg
      , d = n.osgShader
      , p = d.ShaderGenerator
      , f = {
        "sketchfabFunctions.glsl": a,
        "sketchfabTextures.glsl": s,
        "lightsPBR.glsl": o,
        "pbrUE4.glsl": u,
        "panoramaSampler.glsl": l,
        "cubemapSampler.glsl": c
    }
      , g = function() {
        p.apply(this, arguments),
        this.setShaderCompiler(r),
        this.getShaderProcessor().addShaders(f)
    };
    g.prototype = h.objectInherit(p.prototype, {
        filterAttributeTypes: function(t) {
            return "osgSketchfab" !== t.libraryName() && "osgShadow" !== t.libraryName() && "osgAnimation" !== t.libraryName() || !(!t.isEnabled || t.isEnabled())
        }
    }),
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1500)
      , a = i(1501)
      , s = i(1502)
      , o = i(1465)
      , u = n.osg
      , l = n.osgShader
      , c = l.Compiler
      , h = l.nodeFactory;
    h.registerNodes(r),
    h.registerNodes(a),
    h.registerNodes(s);
    var d = function() {
        l.Compiler.apply(this, arguments),
        this._isLighted = !!this._material && this._material.getShadeless() === !1,
        this._isVertexColored = !!this._material && this._material.getVertexColorEnable(),
        this._isVertexAlpha = !!this._material && this._material.getVertexAlphaEnable()
    };
    d.prototype = u.objectInherit(c.prototype, {
        sortDeclarations: function(t) {
            if (c.prototype.sortDeclarations.call(this, t),
            !this._fragmentShaderMode && o().varyingSorting)
                for (var e = -1, i = 0, n = t.length; i < n; ++i) {
                    var r = t[i];
                    if (e === -1 && "v" === r[0] && (e = i),
                    r.indexOf("vViewNormal") !== -1) {
                        t[i] = t[e],
                        t[e] = r;
                        break
                    }
                }
        },
        declareTextures: function() {},
        getCompilerName: function() {
            return "Classic"
        },
        getFragmentShaderName: function() {
            var t = this.getCompilerName()
              , e = ""
              , i = this._material.getName();
            return i && (e = i.length),
            t + e
        },
        registerTextureAttributes: function(t, e) {
            var i = t.className();
            return "TextureMaterial" === i ? this.registerTextureMaterial(t, e) : "TextureEnvironment" === i ? this.registerTextureEnvironment(t, e) : "ShadowTexture" === i ? this.registerTextureShadow(t, e) : void 0
        },
        registerTextureMaterial: function(t, e) {
            var i = e;
            if (t.getTexCoordUnit) {
                var n = t.getTexCoordUnit();
                void 0 !== n && (e = n)
            }
            var r = t.getName();
            r && (this._textures[i] = t,
            this._texturesByName[r] = {
                texture: t,
                variable: void 0,
                textureUnit: e,
                index: i
            })
        },
        registerTextureEnvironment: function(t, e) {
            this._textures[e] = t,
            this._texturesByName["TextureEnvironment" + t.getChannel()] = {
                texture: t,
                variable: void 0,
                textureUnit: e
            }
        },
        getOrCreateStateAttributeUniforms: function(t, e) {
            var i = c.prototype.getOrCreateStateAttributeUniforms.call(this, t, e);
            return "SketchfabLight" === t.getType() && (i.lightspecular && (i.lightspecular = i.lightdiffuse),
            i.lightambient && (i.lightambient = this.getOrCreateConstantZero("vec4")),
            "SPOT" !== t.getLightType() && (i.lightinvMatrix = i.lightmatrix)),
            i
        },
        applyEmissive: function(t) {
            var e = this.getOrCreateTextureChannel("EmitColor");
            if (!e)
                return t;
            var i = this.getTextureByName("EmitColor")
              , n = i.texture.getOrCreateUniforms(i.textureUnit).uEmitType
              , r = this.createVariable("vec3");
            return this.getNode("InlineCode").code("%output = %type == 0 ? %color + %emit : %color * %emit;").inputs({
                color: t,
                emit: e,
                type: this.getOrCreateUniform(n.getType(), n.getName())
            }).outputs({
                output: r
            }),
            r
        },
        createFragmentShaderGraph: function() {
            var t;
            if (this._isLighted) {
                var e = this.createLighting()
                  , i = this.getEnvironment();
                e && i ? (t = this.createVariable("vec3"),
                this.getNode("Add").inputs(e, i).outputs(t)) : t = e || i || this.getOrCreateConstantZero("vec3")
            } else
                t = this.getShadelessColor();
            return t = this.applyEmissive(t),
            [this.getFinalFrag(t)]
        },
        createLighting: function() {
            if (this._lights.length) {
                var t = {};
                return t.materialambient = this.getOrCreateMaterialAmbient(),
                t.materialdiffuse = this.getOrCreateMaterialDiffuseColor(),
                t.materialspecular = this.getOrCreateMaterialSpecularColor(),
                t.materialshininess = this.getOrCreateMaterialSpecularHardness(),
                t.normal = this.getOrCreateMaterialNormal(),
                c.prototype.createLighting.call(this, t)
            }
        },
        getFinalFrag: function(t) {
            var e = this.getOrCreateTextureChannel("Opacity")
              , i = this.getNode("glFragColor");
            return e ? this.getFinalRGBA(t, i) : (this.applyAlphaMask(i),
            this.getRGBM(this.getSrgbColor(t), i))
        },
        getRGBM: function(t, e) {
            return this.getNode("EncodeRGBM").inputs({
                color: t,
                range: this.getOrCreateUniform("float", "uRGBMRange")
            }).outputs({
                color: e
            }),
            e
        },
        getFinalRGBA: function(t, e) {
            var i = this.getOrCreateTextureChannel("Opacity")
              , n = this.getAlphaFinalAlpha(i);
            this.applyDiscardTransparentOpaque(i, n, e);
            var r = this.getSrgbColor(this.getPremultAlpha(t, i));
            return this.getNode("InlineCode").code("%color = %drawOpaque == 1 ? %rgbm : vec4(%rgb, %alpha);").inputs({
                rgb: r,
                rgbm: this.getRGBM(r, this.createVariable("vec4")),
                alpha: n,
                drawOpaque: this.getOrCreateUniform("int", "uDrawOpaque")
            }).outputs({
                color: e
            }),
            e
        },
        applyDiscardTransparentOpaque: function(t, e, i) {
            var n = "if(%alphaOriginal == 0.0 || (%drawOpaque == 1 && %alphaFinal < 1.0) || (%drawOpaque == 0 && %alphaFinal >= 1.0)) discard;";
            this.getNode("InlineCode").code(n).inputs({
                alphaOriginal: t,
                alphaFinal: e,
                drawOpaque: this.getOrCreateUniform("int", "uDrawOpaque")
            }).outputs({
                out: i
            })
        },
        getAlphaFinalAlpha: function(t) {
            var e = this.createVariable("float");
            return this.getNode("InlineCode").code("%finalAlpha = %alpha * float(1 - %additive);").inputs({
                alpha: t,
                additive: this.getOrCreateUniform("int", "uAdditive")
            }).outputs({
                finalAlpha: e
            }),
            e
        },
        getShadelessColor: function() {
            return this.getOrCreateMaterialDiffuseColor()
        },
        getVertexAlpha: function(t) {
            if (!this._isVertexAlpha)
                return t;
            var e = this.createVariable("float");
            return this.getNode("InlineCode").code("%out = %alpha * (%hasVertexColor == 1.0 ? %vertexColor.a : 1.0);").inputs({
                hasVertexColor: this.getOrCreateUniform("float", "uArrayColorEnabled"),
                vertexColor: this.getOrCreateVarying("vec4", "vVertexColor"),
                alpha: t
            }).outputs({
                out: e
            }),
            e
        },
        getVertexColor: function(t) {
            if (void 0 !== t) {
                if (!this._isVertexColored)
                    return t;
                var e = this.getOrCreateVarying("vec4", "vVertexColor")
                  , i = this.getOrCreateUniform("float", "uArrayColorEnabled");
                if ("srgb" === this._material.getVertexColorColorSpace()) {
                    var n = this.createVariable("vec3");
                    this.getNode("sRGBToLinear").inputs({
                        color: e
                    }).outputs({
                        color: n
                    }),
                    e = n
                }
                var r = this.createVariable("vec3")
                  , a = ["", "%color.rgb = %diffuse.rgb;", "if ( %hasVertexColor == 1.0)", "  %color *= %vertexColor.rgb;"].join("\n");
                return this.getNode("InlineCode").code(a).inputs({
                    diffuse: t,
                    hasVertexColor: i,
                    vertexColor: e
                }).outputs({
                    color: r
                }).comment("diffuse color = diffuse color * vertex color"),
                r
            }
        },
        getOrCreateMaterialDiffuseColor: function() {
            var t = this.getVariable("materialDiffuseColor");
            if (t)
                return t;
            t = this.createVariable("vec3", "materialDiffuseColor");
            var e = this.getOrCreateTextureChannel("DiffuseColor");
            if (!e)
                return t.setValue("vec3(0.0)");
            var i = this.getOrCreateTextureChannel("DiffuseIntensity") || this.getOrCreateConstantOne("float");
            return this.getNode("Mult").inputs(this.getVertexColor(e), i).outputs(t),
            t
        },
        getOrCreateMaterialNormal: function() {
            return this.getOrCreateGeometryNormal()
        },
        getOrCreateMaterialOpacity: function() {
            return this.getOrCreateTextureChannel("Opacity") || this.getOrCreateConstantOne("float")
        },
        getOrCreateMaterialAmbient: function() {
            return this.getOrCreateConstantOne("vec3")
        },
        getOrCreateMaterialSpecularColor: function() {
            return this.getOrCreateTextureChannel("SpecularColor") || this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialSpecularHardness: function() {
            return this.getOrCreateTextureChannel("SpecularHardness") || this.getOrCreateConstantZero("float")
        },
        applyAlphaMask: function(t) {
            var e = this.getTextureByName("AlphaMask");
            if (void 0 === e)
                return t;
            var i = e.texture
              , n = i.getOrCreateUniforms(e.textureUnit)
              , r = n.AlphaMask
              , a = i.getOrCreateUniforms(e.textureUnit).uDithering
              , s = ["if (%dithering == 1) {", "    float jitterForce = abs(%halton.z) == 2.0 ? 1000.0 : 1.0;", "    vec3 dith = vec3(gl_FragCoord.xy, gl_FragCoord.x + gl_FragCoord.z * jitterForce) + %halton.xyx * 1000.0;", "    dith = fract(dith * 0.1031);", "    dith += dot(dith, dith.yzx + 19.19);", "    if (%alpha * %factor < fract((dith.x + dith.y) * dith.z)) {", "        discard;", "    }", "} else if (%alpha < %factor) {", "    discard;", "}"].join("\n");
            return this.getNode("InlineCode").code(s).inputs({
                alpha: e.variable,
                factor: this.getOrCreateUniform(r.getType(), r.getName()),
                dithering: this.getOrCreateUniform(a.getType(), a.getName()),
                halton: this.getOrCreateUniform("vec4", "uHalton")
            }).outputs({
                out: t
            }),
            t
        },
        getOrCreateNormalMap: function() {
            var t = this.getVariable("normalMap");
            if (t)
                return t;
            t = this.createVariable("vec3", "normalMap");
            var e = this.getTextureByName("NormalMap")
              , i = e.texture
              , n = i.getOrCreateUniforms(e.textureUnit).uFlipY;
            return this.getNode("RGBToNormal").inputs({
                normal: e.variable,
                flipY: this.getOrCreateUniform(n.getType(), n.getName())
            }).outputs({
                normal: t
            }),
            t
        },
        getOrCreateGeometryNormal: function() {
            var t = this.getVariable("geoNormal");
            if (t)
                return t;
            t = this.createVariable("vec3", "geoNormal");
            var e = this.getNormalMapNormal(this.getTextureByName("NormalMap"));
            return e || (e = this.getBumpMapNormal(this.getTextureByName("BumpMap")),
            e || (e = this.getOrCreateNormalizedNormal())),
            this.getNode("SetFromNode").inputs(e).outputs(t),
            t
        },
        getSrgbColor: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("LinearTosRGBWithTest").inputs({
                color: t,
                keepLinear: this.getOrCreateUniform("int", "uOutputLinear")
            }).outputs({
                color: e
            }),
            e
        },
        getTextureEnvironmentSpecular: function() {
            return this._texturesByName.TextureEnvironmentSpecular
        },
        getEnvironment: function() {
            var t = this.getTextureEnvironmentSpecular();
            if (void 0 !== t) {
                var e = t.texture
                  , i = e.getCommonUniforms()
                  , n = this.createVariable("mat3");
                this.getNode("EnvironmentTransformPBR").inputs({
                    inTransform: this.getOrCreateUniform(i.environmentTransform)
                }).outputs({
                    outTransform: n
                });
                var r = this.getEnvironmentDiffuse(n, i)
                  , a = this.getEnvironmentSpecular(n, e, i)
                  , s = this.createVariable("vec3");
                this.getNode("Add").inputs(r, a).outputs(s);
                var o = this.createVariable("vec3");
                return this.getNode("Mult").inputs(s, this.getOrCreateUniform(i.exposure)).outputs(o),
                o
            }
        },
        getEnvironmentDiffuse: function(t, e) {
            var i = this.getOrCreateUniform(e.diffuseSPH);
            i.globalDeclaration = function() {
                return "uniform vec3 " + i.getVariable() + "[9];"
            }
            ;
            var n = this.createVariable("vec3");
            return this.getNode("DiffuseUE4v1").inputs({
                normal: this.getOrCreateMaterialNormal(),
                albedo: this.getOrCreateMaterialDiffuseColor(),
                ao: this.getOrCreateConstantOne("float"),
                envTransform: t,
                sphCoef: i
            }).outputs({
                color: n
            }),
            n
        },
        getEnvironmentSpecular: function(t, e, i) {
            var n = this.createVariable("vec3");
            this.getNode("TextureEnvironmentCube").inputs({
                sampler: this.getOrCreateSampler("samplerCube", i.textureSpecular.getName()),
                envTransform: t,
                normal: this.getOrCreateMaterialNormal(),
                eye: this.getOrCreateNormalizedPosition(),
                texSize: this.getOrCreateUniform(e.getOrCreateUniforms().size)
            }).outputs({
                color: n
            });
            var r = this.createVariable("vec3")
              , a = this.getOrCreateUniform("float", "uReflection");
            return this.getNode("Mult").inputs(n, this.getOrCreateMaterialSpecularColor(), a).outputs(r),
            r
        },
        getNormalMapNormal: function(t) {
            if (void 0 !== t) {
                var e = this.getOrCreateNormalizedNormal()
                  , i = this.getOrCreateNormalMap()
                  , n = t.texture.getOrCreateUniforms(t.textureUnit).NormalMap
                  , r = this.getOrCreateUniform(n.getType(), n.getName())
                  , a = this.createVariable("vec3")
                  , s = "%out.xy = %factor * %input.xy;\n%out.z = %input.z;";
                this.getNode("InlineCode").code(s).inputs({
                    input: i,
                    factor: r
                }).outputs({
                    out: a
                });
                var o = this.createVariable("vec3");
                return this.getNode("NormalTangentSpace").inputs({
                    tangent: this.getOrCreateFrontTangent(),
                    normal: e,
                    texNormal: a
                }).outputs({
                    normal: o
                }),
                o
            }
        },
        getBumpMapNormal: function(t) {
            if (void 0 !== t) {
                var e = this.getOrCreateNormalizedNormal()
                  , i = t.texture.getOrCreateUniforms(t.textureUnit).BumpMap
                  , n = this.getOrCreateUniform(i.getType(), i.getName())
                  , r = this.createVariable("vec2");
                this.getNode("Mult").inputs(t.variable, n).outputs(r);
                var a = this.createVariable("vec3");
                return this.getNode("Bumpmap").inputs({
                    tangent: this.getOrCreateFrontTangent(),
                    normal: e,
                    gradient: r
                }).outputs({
                    normal: a
                }),
                a
            }
        },
        getOrCreateTextureChannelWithoutFactor: function(t) {
            var e = this.getTextureByName(t);
            return e ? e.variable : void 0
        },
        getOrCreateTextureChannelInvertWhiteFactor: function(t) {
            return this.getOrCreateTextureChannel(t, !0)
        },
        getOrCreateTextureChannel: function(t, e) {
            var i = "channel" + t
              , n = this.getVariable(i);
            if (n)
                return n;
            var r = this.getTextureByName(t);
            if (void 0 !== r) {
                var a = r.texture.getOrCreateUniforms(r.textureUnit)
                  , s = a[t]
                  , o = this.getOrCreateUniform(s.getType(), s.getName());
                "SpecularColor" === t && (o = this.applyAdjustSpecular(o));
                var u = r.variable;
                return n = this.createVariable(u.getType(), i),
                e ? this.applyInvertLerpFactor(u, o, n) : (this.getNode("Mult").inputs(u, o).outputs(n),
                n)
            }
        },
        applyAdjustSpecular: function(t) {
            var e = this.getTextureByName("NormalMap");
            if (!e)
                return t;
            var i = this.getOrCreateNormalMap()
              , n = this.createVariable("float");
            return this.getNode("AdjustSpecular").inputs({
                specular: t,
                normal: i
            }).outputs({
                specular: n
            }),
            n
        },
        applyInvertLerpFactor: function(t, e, i) {
            return this.getNode("Blend").mode("MIX").inputs(this.getOrCreateConstantOne(t.getType()), t, e).outputs(i),
            i
        },
        getTextureByName: function(t) {
            var e = this._texturesByName[t];
            if (!e || e.variable)
                return e;
            var i = e.texture
              , n = i.getSamplerName()
              , r = this.getVariable(n);
            void 0 === r && "Texture" === i.getTexture().className() && (r = this.getOrCreateSampler("sampler2D", n));
            var a = i.getName()
              , s = e.textureUnit
              , o = this._fragmentShaderMode ? this.getOrCreateVarying("vec2", "vTexCoord" + s) : this.getOrCreateAttribute("vec2", "TexCoord" + s);
            return e.variable = this.readChannel(a, i, r, o, e.index),
            e
        },
        readChannel: function(t, e, i, n, r) {
            var a;
            switch (t) {
            case "DiffuseColor":
            case "EmitColor":
            case "DiffuseIntensity":
            case "SpecularColor":
                a = this.createTextureChannelsRGB(e, i, n);
                break;
            case "Opacity":
            case "AlphaMask":
                a = this.createTextureChannelsAlphaOpacity(e, i, n, r);
                break;
            case "SpecularHardness":
            case "Displacement":
                a = this.createTextureChannelsR(e, i, n);
                break;
            case "NormalMap":
                a = this.createTextureChannelsRGB(e, i, n);
                break;
            case "BumpMap":
                a = this.createTextureChannelsGradient(e, i, n, r)
            }
            return a
        },
        getLinearTexel: function(t, e) {
            if (!t.getSRGB())
                return e;
            var i = this.createVariable(e.getType());
            return this.getNode("sRGBToLinear").inputs({
                color: e
            }).outputs({
                color: i
            }),
            i
        },
        createTextureChannelsRGB: function(t, e, i) {
            var n = this.createVariable("vec3");
            return this.getNode("TextureRGB").inputs({
                sampler: e,
                uv: i
            }).outputs({
                color: n
            }),
            this.getLinearTexel(t, n)
        },
        createTextureChannelsR: function(t, e, i) {
            var n = this.createVariable("float");
            return this.getNode("TextureIntensity").inputs({
                sampler: e,
                uv: i
            }).outputs({
                color: n
            }),
            this.getLinearTexel(t, n)
        },
        createTextureChannelsAlphaOpacity: function(t, e, i, n) {
            var r = t.getTexture()
              , a = r.getInternalFormat() === u.Texture.ALPHA ? "TextureAlpha" : "TextureIntensity"
              , s = this.createVariable("float");
            this.getNode(a).inputs({
                sampler: e,
                uv: i
            }).outputs({
                color: s
            });
            var o = r.getImageFormat && r.getImageFormat() === u.Texture.ALPHA;
            o || (s = this.getLinearTexel(t, s));
            var l = t.getOrCreateUniforms(n).uInvert
              , c = this.createVariable("float");
            return this.getNode("InlineCode").code("%aout = %invert == 1 ? 1.0 - %alpha : %alpha;").inputs({
                alpha: s,
                invert: this.getOrCreateUniform(l.getType(), l.getName())
            }).outputs({
                aout: c
            }),
            this.getVertexAlpha(c)
        },
        createTextureChannelsGradient: function(t, e, i, n) {
            var r = t.getName()
              , a = t.getOrCreateUniforms(n)["u" + r + "Size"]
              , s = this.createVariable("vec2", "gradient" + r);
            return this.getNode("TextureGradient").setSRGB(t.getSRGB()).inputs({
                sampler: e,
                texSize: this.getOrCreateUniform(a.getType(), a.getName()),
                uv: i
            }).outputs({
                color: s
            }),
            s
        },
        getOrCreateProjectionMatrix: function() {
            var t = this.getVariable("jitteredProjection");
            if (t)
                return t;
            t = this.createVariable("mat4", "jitteredProjection");
            var e = ["", " %projMat = %jitteredProjection;", " float doPerp = %projMat[3][3] == 0.0 ? 1.0 : 0.0;", " float doOrtho = doPerp == 1.0 ? 0.0 : 1.0;", " vec2 halt = (abs(%halton.z) == 2.0 ? 1.0 : 0.0) * (%halton.xy / %renderSize.xy);", " // persp", " %projMat[2][0] += doPerp * halt.x;", " %projMat[2][1] += doPerp * halt.y;", " // ortho", " %projMat[3][0] += doOrtho * halt.x;", " %projMat[3][1] += doOrtho * halt.y;", ""];
            return this.getNode("InlineCode").code(e.join("\n")).inputs({
                jitteredProjection: this.getOrCreateUniform("mat4", "uProjectionMatrix"),
                halton: this.getOrCreateUniform("vec4", "uHalton"),
                renderSize: this.getOrCreateUniform("vec2", "RenderSize")
            }).outputs({
                projMat: t
            }),
            t
        },
        getMatcapUnit: function() {
            var t = this._textureAttributes[11];
            return t && t[0] && "matcap" === t[0].getName() ? 11 : (t = this._textureAttributes[7],
            t && t[0] && "matcap" === t[0].getName() ? 7 : 0)
        },
        assignMatcapTexture: function() {
            var t = this.getMatcapUnit();
            this._textures[t] = this._textureAttributes[t][0]
        },
        getMatcapColor: function(t) {
            var e = "Texture" + this.getMatcapUnit()
              , i = this._variables[e];
            i = i ? i : this.getOrCreateSampler("sampler2D", e);
            var n = this.createVariable("vec2");
            this.getNode("NormalMatcap").inputs({
                normal: t,
                eye: this.getOrCreateNormalizedPosition()
            }).outputs({
                uv: n
            });
            var r = this.createVariable("vec3");
            this.getNode("TextureRGB").inputs({
                sampler: i,
                uv: n
            }).outputs({
                color: r
            });
            var a = this.createVariable("vec3");
            return this.getNode("sRGBToLinear").inputs({
                color: r
            }).outputs({
                color: a
            }),
            a
        },
        getDisplaceLength: function() {
            var t = this.getTextureByName("Displacement")
              , e = t.texture.getOrCreateUniforms(t.textureUnit).Displacement;
            return this.getOrCreateUniform(e.getType(), e.getName())
        },
        getOrCreateDisplacement: function() {
            var t = this.getVariable("displacement");
            if (t)
                return t;
            var e = this.getTextureByName("Displacement");
            if (e) {
                t = this.createVariable("float", "displacement");
                var i = "%out = (%displacement - 0.5) * %factor;";
                return this.getNode("InlineCode").code(i).inputs({
                    displacement: e.variable,
                    factor: this.getDisplaceLength()
                }).outputs({
                    out: t
                }),
                t
            }
        },
        displaceVertex: function(t, e) {
            var i, n = {
                vertex: t,
                displacement: this.getOrCreateDisplacement()
            };
            return o().substanceDisplacement ? i = "%output = %vertex + vec3(0.0, 0.0, 1.0) * (%vertex.z > 0.01 ? %displacement : 0.0);" : (i = "%output = %vertex + normalize(%direction) * %displacement;",
            n.direction = c.prototype.getOrCreateModelNormal.call(this)),
            this.getNode("InlineCode").code(i).inputs(n).outputs({
                output: e
            }),
            e
        },
        displaceNormal: function(t, e) {
            var i = this.getTextureByName("Displacement")
              , n = i.textureUnit
              , r = this.getVariable(i.texture.getSamplerName())
              , a = this.createTextureChannelsGradient(i.texture, r, this.getVariable("TexCoord" + n), n)
              , s = this.createVariable("vec2");
            return this.getNode("Mult").inputs(a, this.getDisplaceLength()).outputs(s),
            this.getNode("Bumpmap").inputs({
                tangent: this.getOrCreateModelTangent(),
                normal: t,
                gradient: s
            }).outputs({
                normal: e
            }),
            e
        },
        getOrCreateModelVertex: function() {
            if (!this.getOrCreateDisplacement())
                return c.prototype.getOrCreateModelVertex.call(this);
            var t = this._variables.displacedVertex;
            if (t)
                return t;
            t = this.createVariable("vec3", "displacedVertex");
            var e = this.createVariable("vec3", "modelVertex");
            return this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uModelMatrix"),
                vec: this.getOrCreateLocalVertex()
            }).outputs({
                vec: e
            }),
            this.displaceVertex(e, t)
        },
        getOrCreateModelNormal: function() {
            if (!this.getOrCreateDisplacement() || this.getTextureByName("NormalMap") || this.getTextureByName("BumpMap"))
                return c.prototype.getOrCreateModelNormal.call(this);
            var t = this._variables.displaceNormal;
            return t ? t : (t = this.createVariable("vec3", "displacedNormal"),
            this.displaceNormal(c.prototype.getOrCreateModelNormal.call(this), t))
        },
        getOrCreateViewVertex: function() {
            if (!this.getOrCreateDisplacement())
                return c.prototype.getOrCreateViewVertex.call(this);
            var t = this._variables.viewVertex;
            return t ? t : (t = this.createVariable("vec4", "viewVertex"),
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uViewMatrix"),
                vec: this.getOrCreateModelVertex()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateViewNormal: function() {
            if (!this.getOrCreateDisplacement())
                return c.prototype.getOrCreateViewNormal.call(this);
            var t = this._variables.viewNormal;
            return t ? t : (t = this.createVariable("vec3", "viewNormal"),
            this.getNode("MatrixMultDirection").inputs({
                matrix: this.getOrCreateUniform("mat4", "uViewMatrix"),
                vec: this.getOrCreateModelNormal()
            }).outputs({
                vec: t
            }),
            t)
        }
    }),
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = n.osgShader
      , s = a.node.NodeFunctions
      , o = a.utils
      , u = function() {
        s.apply(this)
    };
    u.prototype = r.objectInherit(s.prototype, {
        globalFunctionDeclaration: function() {
            return '#pragma include "sketchfabFunctions.glsl"'
        }
    });
    var l = a.node.LinearTosRGB
      , c = function() {
        l.apply(this)
    };
    c.prototype = r.objectInherit(l.prototype, {
        type: "LinearTosRGBWithTest",
        validInputs: ["color", "keepLinear"],
        validOutputs: ["color"],
        computeShader: function() {
            var t = this._outputs.color
              , e = this._inputs.color
              , i = this._inputs.keepLinear
              , n = t.getType() !== e.getType() ? ".rgb" : ""
              , r = ["if(" + i.getVariable() + " == 1 ) {", t.getVariable() + n + "= " + e.getVariable() + n + ";", "} else {", l.prototype.computeShader.call(this) + "}"].join("\n");
            return r
        }
    });
    var h = function() {
        u.apply(this)
    };
    h.prototype = r.objectInherit(u.prototype, {
        type: "NormalTangentSpace",
        validInputs: ["tangent", "normal", "texNormal"],
        validOutputs: ["normal"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("mtexNspaceTangent", this._outputs.normal, [t.tangent, t.normal, t.texNormal])
        }
    });
    var d = function() {
        u.apply(this)
    };
    d.prototype = r.objectInherit(u.prototype, {
        type: "Bumpmap",
        validInputs: ["tangent", "normal", "gradient"],
        validOutputs: ["normal"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("bumpMap", this._outputs.normal, [t.tangent, t.normal, t.gradient])
        }
    });
    var p = function() {
        u.apply(this)
    };
    p.prototype = r.objectInherit(u.prototype, {
        type: "NormalMatcap",
        validInputs: ["normal", "eye"],
        validOutputs: ["uv"],
        computeShader: function() {
            return o.callFunction("normalMatcap", this._outputs.uv, [this._inputs.normal, this._inputs.eye])
        }
    });
    var f = function() {
        u.apply(this)
    };
    f.prototype = r.objectInherit(u.prototype, {
        type: "RGBToNormal",
        validInputs: ["normal", "flipY"],
        validOutputs: ["normal"],
        computeShader: function() {
            return o.callFunction("rgbToNormal", this._outputs.normal, [this._inputs.normal, this._inputs.flipY])
        }
    });
    var g = function() {
        u.apply(this)
    };
    g.prototype = r.objectInherit(u.prototype, {
        type: "AdjustSpecular",
        validInputs: ["specular", "normal"],
        validOutputs: ["specular"],
        computeShader: function() {
            return o.callFunction("adjustSpecular", this._outputs.specular, [this._inputs.specular, this._inputs.normal.getVariable() + ".rgb"])
        }
    }),
    t.exports = {
        LinearTosRGBWithTest: c,
        NormalTangentSpace: h,
        Bumpmap: d,
        NormalMatcap: p,
        AdjustSpecular: g,
        RGBToNormal: f
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = n.osgShader
      , s = a.node.BaseOperator
      , o = function() {
        s.apply(this),
        this._mode = "MIX"
    };
    o.prototype = r.objectInherit(s.prototype, {
        type: "Blend",
        mode: function(t) {
            return this._mode = t,
            this
        },
        computeShader: function() {
            return this[void 0 === this._mode ? "MIX" : this._mode]()
        },
        ADD: function() {
            return this._outputs.getVariable() + " = " + this._inputs[0].getVariable() + " + (" + this._inputs[1].getVariable() + " * " + this._inputs[2].getVariable() + ");"
        },
        MIX: function() {
            return this._outputs.getVariable() + " = mix(" + this._inputs[0].getVariable() + ", " + this._inputs[1].getVariable() + ", " + this._inputs[2].getVariable() + ");"
        },
        MULTIPLY: function() {
            return this._outputs.getVariable() + " = " + this._inputs[0].getVariable() + " * mix( " + this._inputs[0].getType() + "(1.0), " + this._inputs[1].getVariable() + ", " + this._inputs[2].getVariable() + ");"
        }
    }),
    t.exports = {
        Blend: o
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = n.osgShader
      , s = a.node.NodeTextures
      , o = a.utils
      , s = a.node.NodeTextures
      , o = a.utils
      , u = function() {
        s.apply(this)
    };
    u.prototype = r.objectInherit(s.prototype, {
        globalFunctionDeclaration: function() {
            return '#pragma include "sketchfabTextures.glsl"'
        }
    });
    var l = function() {
        u.apply(this),
        this._isSRGB = !1
    };
    l.prototype = r.objectInherit(u.prototype, {
        type: "TextureGradient",
        validInputs: ["sampler", "texSize", "uv"],
        setSRGB: function(t) {
            return this._isSRGB = t,
            this
        },
        computeShader: function() {
            var t = this._inputs
              , e = this._isSRGB ? "textureGradientSRGB" : "textureGradient";
            return o.callFunction(e, this._outputs.color, [t.sampler, t.uv.getVariable() + ".xy", t.texSize])
        }
    });
    var c = function() {
        u.apply(this)
    };
    c.prototype = r.objectInherit(u.prototype, {
        type: "TextureEnvironmentCube",
        validInputs: ["sampler", "envTransform", "normal", "eye", "texSize"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("textureEnvironmentCube", this._outputs.color, [t.sampler, t.envTransform, t.normal, t.eye, t.texSize])
        }
    }),
    t.exports = {
        TextureGradient: l,
        TextureEnvironmentCube: c
    }
}
, function(t, e) {
    t.exports = "float adjustSpecular( const in float specular, const in vec3 normal ) {\n    // Based on The Order : 1886 SIGGRAPH course notes implementation (page 21 notes)\n    float normalLen = length(normal);\n    if ( normalLen < 1.0) {\n        float normalLen2 = normalLen * normalLen;\n        float kappa = ( 3.0 * normalLen -  normalLen2 * normalLen )/( 1.0 - normalLen2 );\n        // http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/\n        // page 91 : they use 0.5/kappa instead\n        return 1.0-min(1.0, sqrt( (1.0-specular) * (1.0-specular) + 1.0/kappa ));\n    }\n    return specular;\n}\n\nvec3 mtexNspaceTangent(const in vec4 tangent, const in vec3 normal, const in vec3 texnormal) {\n    vec3 tang = vec3(0.0,1.0,0.0);\n    float l = length(tangent.xyz);\n    if (l != 0.0) {\n        //normalize reusing length computations\n        // tang =  normalize(tangent.xyz);\n        tang =  tangent.xyz / l;\n    }\n    vec3 B = tangent.w * normalize(cross(normal, tang));\n    return normalize( texnormal.x*tang + texnormal.y*B + texnormal.z*normal);\n}\n\nvec2 normalMatcap(const in vec3 normal, const in vec3 nm_z) {\n    vec3 nm_x = vec3(-nm_z.z, 0.0, nm_z.x);\n    vec3 nm_y = cross(nm_x, nm_z);\n    return vec2(dot(normal.xz, nm_x.xz), dot(normal, nm_y)) * vec2(0.5)  + vec2(0.5) ; //MADD vector form\n}\n\nvec3 rgbToNormal(const in vec3 texel, const in int flipNormalY) {\n    vec3 rgb = texel * vec3(2.0) + vec3(-1.0); // MADD vec form\n    rgb[1] = flipNormalY == 1 ? -rgb[1] : rgb[1];\n    return rgb;\n}\n\nvec3 bumpMap(const in vec4 tangent, const in vec3 normal, const in vec2 gradient) {\n    vec3 outnormal;\n    float l = length(tangent.xyz);\n    if (l != 0.0) {\n        //normalize reusing length computations\n        // vec3 tang =  normalize(tangent.xyz);\n        vec3 tang =  tangent.xyz / l;\n        vec3 binormal = tangent.w * normalize(cross(normal, tang));\n        outnormal = normal + gradient.x * tang + gradient.y * binormal;\n    }\n    else {\n       outnormal = vec3(normal.x + gradient.x, normal.y + gradient.y, normal.z);\n    }\n    return normalize(outnormal);\n}\n"
}
, function(t, e) {
    t.exports = '#pragma include "functions.glsl"\n#pragma include "sketchfabFunctions.glsl"\n\nvec3 cubemapSeamlessFixDirection(const in vec3 direction, const in float size ) {\n    vec3 dir = direction;\n    float scale = 1.0 - 1.0 / size;\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\n    vec3 absDir = abs(dir);\n    float M = max(max(absDir.x, absDir.y), absDir.z);\n\n    if (absDir.x != M) dir.x *= scale;\n    if (absDir.y != M) dir.y *= scale;\n    if (absDir.z != M) dir.z *= scale;\n\n    return dir;\n}\n\n// seamless cubemap for background ( no lod )\nvec3 textureCubeFixed(const in samplerCube texture, const in vec3 direction, const in float scale ) {\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\n    vec3 dir = cubemapSeamlessFixDirection( direction, scale);\n    return LUVToRGB( textureCube( texture, dir ) );\n}\n\nvec3 textureEnvironmentCube( const in samplerCube tex, const in mat3 envTrans, const in vec3 N, const in vec3 V, const in vec2 size ){\n    vec3 R = normalize( (2.0 * clamp( dot( N, V ), 0.0, 1.0 ) ) * N - V);\n    return textureCubeFixed( tex, envTrans * R, size[0] );\n}\n\n// Todo use #idfef and derivatives (dDFx, dDFy, fwidth) extension ?\n// float valuetexture2D(texture, uv);\n// return vec2(dFdx(value), dFdy(value));\nvec2 textureGradient(in sampler2D texture, const in vec2 uv, const in vec2 size) {\n    vec2 step = 1.0 / size;\n    float dx = texture2D(texture, uv - vec2(step.x, 0.0)).r - texture2D(texture, uv + vec2(step.x, 0.0)).r;\n    float dy = texture2D(texture, uv - vec2(0.0, step.y)).r - texture2D(texture, uv + vec2(0.0, step.y)).r;\n    return vec2(dx, dy);\n}\n\n// sighhh\nvec2 textureGradientSRGB(in sampler2D texture, const in vec2 uv, const in vec2 size) {\n    vec2 step = 1.0 / size;\n    float dx = sRGBToLinear(texture2D(texture, uv - vec2(step.x, 0.0)).r) - sRGBToLinear(texture2D(texture, uv + vec2(step.x, 0.0)).r);\n    float dy = sRGBToLinear(texture2D(texture, uv - vec2(0.0, step.y)).r) - sRGBToLinear(texture2D(texture, uv + vec2(0.0, step.y)).r);\n    return vec2(dx, dy);\n}\n'
}
, function(t, e) {
    t.exports = "\r\n// math.glsl\r\n#define PI 3.141593\r\n#define HALF_PI 1.570796\r\n#define EPS .0000001\r\n\r\n// dxtogl.glsl ?\r\n#define saturate(_x) clamp(_x, 0., 1.)\r\n#define atan2(_x, _y) atan(_x, _y)\r\n#define frac(_x) fract(_x)\r\n#define lerp(_x, _y, _t) mix(_x, _y, _t)\r\n\r\n// light_common.glsl\r\n// ATTENUATION\r\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation)\r\n{\r\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\r\n    // TODO find a vector alu instead of 4 scalar\r\n    float constant = lightAttenuation.x;\r\n    float linear = lightAttenuation.y*dist;\r\n    float quadratic = lightAttenuation.z*dist*dist;\r\n    return 1.0 / ( constant + linear + quadratic );\r\n}\r\n\r\n// light PBR glsl\r\n#define G1V(dotNV, k) (1./(dotNV*(1.-k)+k))\r\n\r\nvec4 LightingFuncPrep(const in vec3 N,\r\n                      const in vec3 V,\r\n                      const in float roughness)\r\n{\r\n\r\n    float dotNV = saturate(dot(N,V));\r\n    float alpha = roughness * roughness;\r\n    float k = alpha * .5;\r\n    float visNV = G1V(dotNV,k);\r\n\r\n    vec4 prepSpec;\r\n\r\n    prepSpec.x = alpha;\r\n    prepSpec.y = alpha * alpha;\r\n    prepSpec.z = k;\r\n    prepSpec.w = visNV;\r\n\r\n    return prepSpec;\r\n\r\n}\r\n\r\nvec3 LightingFuncUsePrepGGX(const vec4 prepSpec,\r\n                            const vec3 N,\r\n                            const vec3 V,\r\n                            const vec3 L,\r\n                            const vec3 F0,\r\n                            const float dotNL)\r\n{\r\n\r\n    vec3 H = normalize(V+L);\r\n    float dotNH = saturate(dot(N,H));\r\n    // D\r\n    float alphaSqr = prepSpec.y;\r\n    float denom = dotNH * dotNH *(alphaSqr-1.) + 1.;\r\n    float D = alphaSqr / (PI * denom * denom);\r\n    // F\r\n    float dotLH = saturate(dot(L,H));\r\n    float dotLH5 = pow(1.-dotLH,5.);\r\n    vec3 F = vec3(F0) + (vec3(1.)-F0)*(dotLH5);\r\n    // V\r\n    float visNL = G1V(dotNL, prepSpec.z);\r\n    vec3 specular = D * F * visNL * prepSpec.w;\r\n    return specular;\r\n}\r\n\r\n// pure compute Light PBR\r\nvec3 computeLight(const in vec3 lightColor,\r\n                  const in vec3 albedoColor,\r\n                  const in vec3 normal,\r\n                  const in vec3 viewDir,\r\n                  const in vec3 lightDir,\r\n                  const in vec3 specular,\r\n                  const in vec4 prepSpec,\r\n                  const in float dotNL)\r\n{\r\n    vec3 cSpec = LightingFuncUsePrepGGX(prepSpec, normal, viewDir, lightDir, specular, dotNL);\r\n    return lightColor *  dotNL*(albedoColor + cSpec);\r\n}\r\n\r\n// STANDARD call for each light\r\n//direction, dist, NDL, attenuation, compute diffuse, compute specular\r\nvec3 computeSpotLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n\r\n    const in vec3  lightSpotDirection,\r\n    const in vec4  lightAttenuation,\r\n    const in vec4  lightSpotPosition,\r\n    const in float lightCosSpotCutoff,\r\n    const in float lightSpotBlend,\r\n\r\n    const in mat4 lightMatrix,\r\n    const in mat4 lightInvMatrix,\r\n\r\n    out vec3 eyeLightPos,\r\n    out vec3 eyeLightDir,\r\n    out float NdotL,\r\n    out bool lighted)\r\n{\r\n    lighted = false;\r\n    eyeLightPos = vec3(lightMatrix * lightSpotPosition);\r\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\r\n    // compute dist\r\n    float dist = length(eyeLightDir);\r\n    // compute attenuation\r\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    if (attenuation != 0.0)\r\n    {\r\n        // compute direction\r\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n        if (lightCosSpotCutoff > 0.0)\r\n        {\r\n            //compute lightSpotBlend\r\n            vec3 lightSpotDirectionEye = normalize(mat3(vec3(lightInvMatrix[0]), vec3(lightInvMatrix[1]), vec3(lightInvMatrix[2]))*lightSpotDirection);\r\n\r\n            float cosCurAngle = dot(-eyeLightDir, lightSpotDirectionEye);\r\n            float diffAngle = cosCurAngle - lightCosSpotCutoff;\r\n            float spot = 1.0;\r\n            if ( diffAngle < 0.0 ) {\r\n                spot = 0.0;\r\n            } else {\r\n                if ( lightSpotBlend > 0.0 )\r\n                    spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightCosSpotCutoff) / (lightSpotBlend));\r\n            }\r\n\r\n            if (spot > 0.0)\r\n            {\r\n                // compute NdL\r\n                NdotL = dot(eyeLightDir, normal);\r\n                if (NdotL > 0.0)\r\n                {\r\n                    lighted = true;\r\n                    return spot * attenuation *computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir, specular, prepSpec,  NdotL);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computePointLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n\r\n    const in vec4 lightPosition,\r\n    const in vec4 lightAttenuation,\r\n\r\n    const in mat4 lightMatrix,\r\n\r\n    out vec3 eyeLightPos,\r\n    out vec3 eyeLightDir,\r\n    out float NdotL,\r\n    out bool lighted)\r\n{\r\n\r\n    eyeLightPos =  vec3(lightMatrix * lightPosition);\r\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\r\n    float dist = length(eyeLightDir);\r\n    // compute dist\r\n    // compute attenuation\r\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    if (attenuation != 0.0)\r\n    {\r\n        // compute direction\r\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n        // compute NdL\r\n        NdotL = dot(eyeLightDir, normal);\r\n        if (NdotL > 0.0)\r\n        {\r\n            lighted = true;\r\n            return  attenuation * computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir,  specular, prepSpec,  NdotL);\r\n        }\r\n    }\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computeSunLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n\r\n    const in vec4 lightPosition,\r\n\r\n    const in mat4 lightMatrix,\r\n\r\n    out vec3 eyeLightDir,\r\n    out float NdotL,\r\n    out bool lighted)\r\n{\r\n\r\n    lighted = false;\r\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\r\n    // compute NdL   // compute NdL\r\n    NdotL = dot(eyeLightDir, normal);\r\n    if (NdotL > 0.0)\r\n    {\r\n        lighted = true;\r\n        return computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir, specular, prepSpec,  NdotL);\r\n    }\r\n    return vec3(0.0);\r\n}\r\n"
}
, function(t, e) {
    t.exports = '#pragma include "functions.glsl"\r\n#define LUV\r\n\r\nfloat specularOcclusion(const in int occlude, const in float ao, const in vec3 N, const in vec3 V) {\r\n    if(occlude == 0)\r\n        return 1.0;\r\n    // Yoshiharu Gotanda\'s specular occlusion approximation:\r\n    // cf http://research.tri-ace.com/Data/cedec2011_RealtimePBR_Implementation_e.pptx pg59\r\n    float d = dot( N, V ) + ao;\r\n    return clamp((d * d) - 1.0 + ao, 0.0, 1.0);\r\n}\r\n\r\nfloat adjustRoughnessNormalMap( const in float roughness, const in vec3 normal ) {\r\n    // Based on The Order : 1886 SIGGRAPH course notes implementation (page 21 notes)\r\n    float normalLen = length(normal);\r\n    if ( normalLen < 1.0) {\r\n        float normalLen2 = normalLen * normalLen;\r\n        float kappa = ( 3.0 * normalLen -  normalLen2 * normalLen )/( 1.0 - normalLen2 );\r\n        // http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/\r\n        // page 91 : they use 0.5/kappa instead\r\n        return min(1.0, sqrt( roughness * roughness + 1.0/kappa ));\r\n    }\r\n    return roughness;\r\n}\r\n\r\nfloat adjustRoughnessGeometry( const in float roughness, const in vec3 normal ) {\r\n    // Geometric Specular Aliasing (slide 43)\r\n    // http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf\r\n// #ifdef GL_OES_standard_derivatives\r\n//     vec3 vDx = dFdx( normal.xyz );\r\n//     vec3 vDy = dFdy( normal.xyz );\r\n//     return max(roughness, pow( clamp( max( dot( vDx, vDx ), dot( vDy, vDy ) ), 0.0, 1.0 ), 0.333 ));\r\n// #else\r\n    return roughness;\r\n// #endif\r\n}\r\n\r\nmat3 environmentTransformPBR( const in mat4 tr ) {\r\n    // TODO trick from animation matrix transpose?\r\n    vec3 x = vec3(tr[0][0], tr[1][0], tr[2][0]);\r\n    vec3 y = vec3(tr[0][1], tr[1][1], tr[2][1]);\r\n    vec3 z = vec3(tr[0][2], tr[1][2], tr[2][2]);\r\n    mat3 m = mat3(x, y, z);\r\n    return m;\r\n}\r\n\r\nvec3 evaluateDiffuseSphericalHarmonics( const in vec3 s[9], const in mat3 envTrans, const in vec3 N ) {\r\n    vec3 n = envTrans * N;\r\n    // https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\r\n    vec3 result = (s[0]+s[1]*n.y+s[2]*n.z+s[3]*n.x+s[4]*n.y*n.x+s[5]*n.y*n.z+s[6]*(3.0*n.z*n.z-1.0)+s[7]*(n.z*n.x)+s[8]*(n.x*n.x-n.y*n.y));\r\n    return max(result, vec3(0.0));\r\n}\r\n\r\n// Frostbite, Lagarde paper p67\r\n// http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf\r\nfloat linRoughnessToMipmap( const in float roughnessLinear ) {\r\n    return sqrt(roughnessLinear);\r\n}\r\n\r\nvec3 integrateBRDF( const in vec3 specular, const in float r, const in float NoV, const in sampler2D tex ) {\r\n    vec4 rgba = texture2D( tex, vec2(NoV, r) );\r\n    float b = (rgba[3] * 65280.0 + rgba[2] * 255.0);\r\n    float a = (rgba[1] * 65280.0 + rgba[0] * 255.0);\r\n    const float div = 1.0/65535.0;\r\n    return (specular * a + b) * div;\r\n}\r\n\r\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\r\n// TODO should we use somehow specular f0 ?\r\nvec3 integrateBRDFApprox( const in vec3 specular, const in float roughness, const in float NoV ) {\r\n    const vec4 c0 = vec4( -1, -0.0275, -0.572, 0.022 );\r\n    const vec4 c1 = vec4( 1, 0.0425, 1.04, -0.04 );\r\n    vec4 r = roughness * c0 + c1;\r\n    float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\r\n    vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\r\n    return specular * AB.x + AB.y;\r\n}\r\n\r\nvec3 computeIBLDiffuseUE4( const in vec3 normal, const in vec3 albedo, const in mat3 envTrans, const in vec3 sphHarm[9] ) {\r\n    return albedo * evaluateDiffuseSphericalHarmonics( sphHarm, envTrans, normal ) ;\r\n}\r\n\r\n// basically whether it\'s panorama or cubemap we load the adequate glsl\r\n// and we set samplerEnv and prefilterEnvMap\r\n#ifdef CUBEMAP\r\n#pragma include "cubemapSampler.glsl" "CUBEMAP"\r\n#define samplerEnv samplerCube\r\n#define prefilterEnvMap prefilterEnvMapCube\r\n\r\n#else\r\n#ifdef PANORAMA\r\n#pragma include "panoramaSampler.glsl" "PANORAMA"\r\n#define samplerEnv sampler2D\r\n#define prefilterEnvMap prefilterEnvMapPanorama\r\n\r\n#else\r\n// in case there is no environment node ?\r\nvec3 prefilterEnvMap( const in float rLinear, const in vec3 R, const in sampler2D tex, const in vec2 lodRange, const in vec2 size ) {\r\n    return vec3(0.0);\r\n}\r\n#define samplerEnv sampler2D\r\n#endif // PANORAMA\r\n\r\n#endif // CUBEMAP\r\n\r\nvec3 getSpecularDominantDir( const in vec3 N, const in vec3 R, const in float realRoughness ) {\r\n    float smoothness = 1.0 - realRoughness;\r\n    float lerpFactor = smoothness * ( sqrt( smoothness ) + realRoughness );\r\n    // The result is not normalized as we fetch in a cubemap\r\n    return mix( N, R, lerpFactor );\r\n}\r\n\r\n// samplerEnv and prefilterEnvMap are both defined above (cubemap or panorama)\r\nvec3 computeIBLSpecularUE4(\r\n    const in vec3 N,\r\n    const in vec3 V,\r\n    const in float rLinear,\r\n    const in vec3 specular,\r\n    const in mat3 envTrans,\r\n    const in samplerEnv texEnv,\r\n    const in vec2 lodRange,\r\n    const in vec2 size,\r\n    const in vec3 frontNormal\r\n    #ifdef MOBILE\r\n    ){\r\n    #else\r\n    ,const in sampler2D texBRDF ) {\r\n    #endif\r\n\r\n    float rough = max( rLinear, 0.0);\r\n\r\n    float NoV = dot( N, V );\r\n    vec3 R = normalize( NoV * 2.0 * N - V);\r\n    R = getSpecularDominantDir(N, R, rLinear);\r\n    // could use that, especially if NoV comes from shared preCompSpec\r\n    //vec3 R = reflect(-V, N);\r\n\r\n    vec3 prefilteredColor = prefilterEnvMap( rough, envTrans * R, texEnv, lodRange, size );\r\n    // http://marmosetco.tumblr.com/post/81245981087\r\n    // marmoset uses 1.3, we force it to 1.0\r\n    float factor = clamp( 1.0 + dot(R, frontNormal), 0.0, 1.0 );\r\n    prefilteredColor *= factor * factor;\r\n    #ifdef MOBILE\r\n    return prefilteredColor * integrateBRDFApprox( specular, rough, NoV );\r\n    #else\r\n    return prefilteredColor * integrateBRDF( specular, rough, NoV, texBRDF );\r\n    #endif\r\n}\r\n'
}
, function(t, e) {
    t.exports = "vec2 computeUVForMipmap( const in float level, const in vec2 uv, const in float size, const in float maxLOD ) {\r\n\r\n    // width for level\r\n    float widthForLevel = exp2( maxLOD-level);\r\n\r\n    // the height locally for the level in pixel\r\n    // to opimitize a bit we scale down the v by two in the inputs uv\r\n    float heightForLevel = widthForLevel * 0.5;\r\n\r\n\r\n    // compact version\r\n    float texelSize = 1.0/size;\r\n    vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, heightForLevel - 2.0);\r\n    uvSpaceLocal.y += size - widthForLevel;\r\n    return uvSpaceLocal * texelSize;\r\n}\r\n\r\n//for y up\r\nvec2 normalToPanoramaUVY( const in vec3 dir ) {\r\n    float n = length(dir.xz);\r\n\r\n    // to avoid bleeding the max(-1.0,dir.x / n) is needed\r\n    vec2 pos = vec2( (n>0.0000001) ? max(-1.0,dir.x / n) : 0.0, dir.y);\r\n\r\n    // fix edge bleeding\r\n    if ( pos.x > 0.0 ) pos.x = min( 0.999999, pos.x );\r\n\r\n    pos = acos(pos) * 0.3183098861837907; // inv_pi\r\n\r\n    pos.x = (dir.z > 0.0) ? pos.x*0.5 : 1.0-(pos.x*0.5);\r\n\r\n    // shift u to center the panorama to -z\r\n    pos.x = mod(pos.x-0.25+1.0, 1.0 );\r\n    pos.y = 1.0-pos.y;\r\n    return pos;\r\n}\r\n\r\nvec3 texturePanorama(const in sampler2D texture, const in vec2 uv) {\r\n    vec4 rgba = texture2D(texture, uv );\r\n#ifdef FLOAT\r\n    return rgba.rgb;\r\n#endif\r\n#ifdef RGBM\r\n    return RGBMToRGB( rgba );\r\n#endif\r\n#ifdef LUV\r\n    return LUVToRGB( rgba );\r\n#endif\r\n}\r\n\r\nvec3 texturePanoramaLod(const in sampler2D texture, const in vec2 size, const in vec3 direction, const in float lodInput, const in float maxLOD ) {\r\n    float lod = min( maxLOD, lodInput );\r\n    vec2 uvBase = normalToPanoramaUVY( direction );\r\n\r\n    // // we scale down v here because it avoid to do twice in sub functions\r\n    // uvBase.y *= 0.5;\r\n\r\n    float lod0 = floor(lod);\r\n    vec2 uv0 = computeUVForMipmap(lod0, uvBase, size.x, maxLOD );\r\n    vec3 texel0 = texturePanorama( texture, uv0.xy);\r\n\r\n    float lod1 = ceil(lod);\r\n    vec2 uv1 = computeUVForMipmap(lod1, uvBase, size.x, maxLOD );\r\n    vec3 texel1 = texturePanorama( texture, uv1.xy);\r\n\r\n    return mix(texel0, texel1, fract( lod ) );\r\n}\r\n\r\nvec3 prefilterEnvMapPanorama( const in float rLinear, const in vec3 R, const in sampler2D tex, const in vec2 lodRange, const in vec2 size ){\r\n    return texturePanoramaLod( tex, size, R, linRoughnessToMipmap(rLinear) * lodRange[1], lodRange[0] );\r\n}\r\n"
}
, function(t, e) {
    t.exports = "// has to be before anything else, just after glsl language version\r\n// it's require. enable just allow\r\nvec3 textureCubemapLod(const in samplerCube texture, const in vec3 dir, const in float lod ) {\r\n    vec4 rgba = textureCubeLodEXT( texture, dir, lod );\r\n#ifdef FLOAT\r\n    return rgba.rgb;\r\n#endif\r\n#ifdef RGBM\r\n    return RGBMToRGB( rgba );\r\n#endif\r\n#ifdef LUV\r\n    return LUVToRGB( rgba );\r\n#endif\r\n}\r\n\r\nvec3 textureCubeLodEXTFixed(const in samplerCube texture, const in vec2 size, const in vec3 direction, const in float lodInput, const in float maxLod ) {\r\n    vec3 dir = direction;\r\n    float lod = min( maxLod, lodInput );\r\n\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float scale = 1.0 - exp2(lod) / size.x;\r\n    vec3 absDir = abs(dir);\r\n    float M = max(max(absDir.x, absDir.y), absDir.z);\r\n\r\n    if (absDir.x != M) dir.x *= scale;\r\n    if (absDir.y != M) dir.y *= scale;\r\n    if (absDir.z != M) dir.z *= scale;\r\n\r\n    return textureCubemapLod( texture, dir, lod );\r\n}\r\n\r\nvec3 prefilterEnvMapCube( const in float rLinear, const in vec3 R, const in samplerCube tex, const in vec2 lodRange, const in vec2 size ){\r\n    float lod = linRoughnessToMipmap(rLinear) * lodRange[1]; //( uEnvironmentMaxLod - 1.0 );\r\n    return textureCubeLodEXTFixed( tex, size, R, lod, lodRange[0] );\r\n}\r\n"
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1510)
      , a = n.osg
      , s = function() {
        r.apply(this, arguments),
        this._isVertexColored = !1
    };
    s.prototype = a.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "Skeleton"
        },
        initTextureAttributes: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.getNode("SetFromNode").inputs(this.getOrCreateUniform("vec4", "uColor")).outputs(t),
            [t]
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1511)
      , a = n.osg
      , s = function() {
        r.apply(this, arguments),
        this._isVertexAlpha = !!this._material && this._material.getVertexAlphaEnable(),
        this._isVertexColored = this._isVertexAlpha
    };
    s.prototype = a.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "EarlyZ"
        },
        registerTextureMaterial: function(t, e) {
            var i = t.getName();
            "AlphaMask" !== i && "Opacity" !== i && "Displacement" !== i || r.prototype.registerTextureMaterial.call(this, t, e)
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {},
        createDepthColor: function() {
            var t = this.createVariable("vec4")
              , e = ["if(%drawOpaque == 1 && %alpha < 1.0) discard;", "float depth = (-%fragEye.z * %fragEye.w - %nearFar.x) / (%nearFar.y - %nearFar.x);", "%color = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * depth);", "%color -= %color.yzww * vec4(1.0/255.0, 1.0/255.0, 1.0/255.0, 0.0);", "%color.a = %drawOpaque == 1 ? 1.0 : %alpha;"].join("\n");
            return this.getNode("InlineCode").code(e).inputs({
                fragEye: this.getOrCreateVarying("vec4", "vViewVertex"),
                nearFar: this.getOrCreateUniform("vec2", "uNearFar"),
                drawOpaque: this.getOrCreateUniform("int", "uDrawOpaque"),
                alpha: this.getOrCreateTextureChannel("Opacity") || this.createVariable("float").setValue("1.0")
            }).outputs({
                color: t
            }),
            t
        },
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.applyAlphaMask(t),
            this.getNode("SetFromNode").inputs(this.createDepthColor()).outputs(t),
            [t]
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1499)
      , a = i(1512)
      , s = i(1513)
      , o = n.osg
      , u = n.osgShader
      , l = u.Compiler
      , c = u.nodeFactory;
    c.registerNodes(a),
    c.registerNodes(s);
    var h = function() {
        r.apply(this, arguments)
    };
    h.prototype = o.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "PBR"
        },
        getTextureEnvironmentSpecular: function() {
            return this._texturesByName.TextureEnvironmentSpecularPBR
        },
        getTextureEnvironmentIntegrateBRDF: function() {
            return this._texturesByName.TextureEnvironmentIntegrateBRDF
        },
        getEnvironmentDiffuse: function(t, e) {
            var i = this.getOrCreateUniform(e.diffuseSPH);
            i.globalDeclaration = function() {
                return "uniform vec3 " + i.getVariable() + "[9];"
            }
            ;
            var n = this.createVariable("vec3");
            this.getNode("DiffuseUE4v1").inputs({
                normal: this.getOrCreateMaterialNormal(),
                albedo: this.getOrCreateMaterialDiffusePBR(),
                envTransform: t,
                sphCoef: i
            }).outputs({
                color: n
            });
            var r = this.createVariable("vec3");
            return this.getNode("Mult").inputs(n, this.getOrCreateMaterialAOPBR()).outputs(r),
            r
        },
        getEnvironmentSpecular: function(t, e, i) {
            var n;
            this.getTextureEnvironmentIntegrateBRDF() && (n = this.getOrCreateSampler("sampler2D", i.textureIntegrateBRDF.getName()));
            var r = {
                normal: this.getOrCreateMaterialNormal(),
                eye: this.getOrCreateNormalizedPosition(),
                roughness: this.getOrCreateMaterialRoughness(),
                specular: this.getOrCreateMaterialSpecularPBR(),
                envTransform: t,
                integrateBRDF: n,
                texSize: this.getOrCreateUniform(e.getOrCreateUniforms().size),
                frontNormal: this.getOrCreateNormalizedNormal(),
                lodRange: this.getOrCreateUniform(e.getOrCreateUniforms().lodRange)
            }
              , a = "";
            e.getIsCubemap() ? (a = "SpecularUE4v1Cubemap",
            r.texSpec = this.getOrCreateSampler("samplerCube", i.textureSpecularPBR.getName())) : (a = "SpecularUE4v1Panorama",
            r.texSpec = this.getOrCreateSampler("sampler2D", i.textureSpecularPBR.getName()));
            var s = this.createVariable("vec3");
            this.getNode(a).inputs(r).outputs({
                color: s
            });
            var o = this.createVariable("vec3");
            return this.getNode("Mult").inputs(s, this.getOrCreateMaterialAOSpecularPBR()).outputs(o),
            o
        },
        readChannel: function(t, e, i, n, a) {
            var s = r.prototype.readChannel.apply(this, arguments);
            if (s)
                return s;
            switch (t) {
            case "DiffusePBR":
            case "AlbedoPBR":
            case "SpecularPBR":
                s = this.createTextureChannelsRGB(e, i, n);
                break;
            case "GlossinessPBR":
            case "RoughnessPBR":
            case "MetalnessPBR":
            case "SpecularF0":
            case "CavityPBR":
                s = this.createTextureChannelsR(e, i, n);
                break;
            case "AOPBR":
                s = this.createTextureChannelsAOPBR(e, i, n, a)
            }
            return s
        },
        createTextureChannelsAOPBR: function(t, e, i, n) {
            var r = this.createTextureChannelsR(t, e, i);
            if (r) {
                var a = t.getOrCreateUniforms(n).uOccludeSpecular;
                this._unifAOSpec = this.getOrCreateUniform(a.getType(), a.getName())
            }
            return r
        },
        getOrCreateMaterialSpecularF0: function() {
            var t = this.getVariable("materialSpecularf0");
            if (t)
                return t;
            t = this.createVariable("float", "materialSpecularf0");
            var e = this.getOrCreateTextureChannel("SpecularF0");
            if (!e)
                return t.setValue("0.04");
            var i = this.createVariable("float").setValue("0.0")
              , n = this.createVariable("float").setValue("0.08");
            return this.getNode("Blend").mode("MIX").inputs(i, n, e).outputs(t),
            t
        },
        getOrCreateMaterialAOPBR: function() {
            return this.getOrCreateTextureChannelInvertWhiteFactor("AOPBR") || this.getOrCreateConstantOne("float")
        },
        getOrCreateMaterialAOSpecularPBR: function() {
            var t = this.getVariable("materialAO");
            if (t)
                return t;
            t = this.createVariable("float", "materialAO");
            var e = this._unifAOSpec;
            return e ? (this.getNode("SpecularOcclusion").inputs({
                occlude: e,
                ao: this.getOrCreateMaterialAOPBR(),
                normal: this.getOrCreateGeometryNormal(),
                eye: this.getOrCreateNormalizedPosition()
            }).outputs({
                ao: t
            }),
            t) : t.setValue("1.0")
        },
        getOrCreateMaterialCavityPBR: function() {
            return this.getOrCreateTextureChannelInvertWhiteFactor("CavityPBR") || this.getOrCreateConstantOne("float")
        },
        getShadelessColor: function() {
            var t = this.createVariable("vec3")
              , e = this.getOrCreateTextureChannel("AlbedoPBR") || this.getOrCreateTextureChannel("DiffusePBR");
            return this.getNode("Mult").inputs(this.getVertexColor(e), this.getOrCreateMaterialAOPBR()).outputs(t),
            t
        },
        getOrCreateMaterialAlbedo: function() {
            var t = this.getVariable("materialAlbedo");
            if (t)
                return t;
            t = this.createVariable("vec3", "materialAlbedo");
            var e = this.getOrCreateTextureChannel("AlbedoPBR") || this.getOrCreateTextureChannel("DiffusePBR") || this.getOrCreateConstantZero("vec3");
            return this.getNode("SetFromNode").inputs(this.getVertexColor(e)).outputs(t),
            t
        },
        getOrCreateMaterialDiffusePBR: function() {
            var t = this.getVariable("materialDiffusePBR");
            if (t)
                return t;
            t = this.createVariable("vec3", "materialDiffusePBR");
            var e = this.getOrCreateTextureChannel("MetalnessPBR");
            if (e) {
                var i = "%out = %albedo * (1.0 - %metal);";
                this.getNode("InlineCode").code(i).inputs({
                    albedo: this.getOrCreateMaterialAlbedo(),
                    metal: e
                }).outputs({
                    out: t
                })
            } else
                this.getNode("SetFromNode").inputs(this.getOrCreateMaterialAlbedo()).outputs(t);
            return t
        },
        getOrCreateMaterialRoughness: function() {
            var t = this.getVariable("materialRoughness");
            if (t)
                return t;
            t = this.createVariable("float", "materialRoughness");
            var e = this.getOrCreateTextureChannel("RoughnessPBR");
            e || (e = this.getOrCreateTextureChannel("GlossinessPBR"),
            e && (e = this.getRoughnessFromGlossiness(e))),
            e = e ? this.getMinRoughness(e) : this.createVariable("float").setValue("0.2");
            var i = e;
            return this._texturesByName.NormalMap && (i = this.createVariable("float"),
            this.getNode("AdjustRoughnessNmap").inputs({
                roughness: e,
                normal: this.getOrCreateNormalMap()
            }).outputs({
                roughness: i
            })),
            this.getNode("AdjustRoughnessGeometry").inputs({
                roughness: i,
                normal: this.getOrCreateNormalizedNormal()
            }).outputs({
                roughness: t
            }),
            t
        },
        getOrCreateMaterialSpecularPBR: function() {
            var t = this.getOrCreateTextureChannel("SpecularPBR");
            if (t)
                return t;
            var e = this.getVariable("materialSpecularPBR");
            if (e)
                return e;
            e = this.createVariable("vec3", "materialSpecularPBR");
            var i = this.getOrCreateTextureChannel("MetalnessPBR");
            if (!i)
                return e.setValue("vec3(0.05)");
            var n = "%out = mix( vec3(%f0), %albedo, %metal);";
            return this.getNode("InlineCode").code(n).inputs({
                metal: i,
                albedo: this.getOrCreateMaterialAlbedo(),
                f0: this.getOrCreateMaterialSpecularF0()
            }).outputs({
                out: e
            }),
            e
        },
        createCommonLightingVars: function(t, e) {
            if (0 === this._lights.length)
                return {};
            var i = r.prototype.createCommonLightingVars.call(this, t, e)
              , n = this.createVariable("vec4", "prepSpec");
            i.prepSpec = n;
            var a = o.objectMix({}, t);
            return a.normal || (a.normal = this.getOrCreateMaterialNormal()),
            a.eyeVector || (a.eyeVector = this.getOrCreateNormalizedPosition()),
            this.getNode("PrepSpecLightPBR").inputs(a).outputs({
                prepSpec: n
            }),
            i
        },
        createLighting: function() {
            if (this._lights.length) {
                var t = {
                    DIRECTION: "SunLightPBR",
                    SPOT: "SpotLightPBR",
                    POINT: "PointLightPBR",
                    HEMI: "SunLightPBR"
                }
                  , e = {};
                return e.materialambient = this.getOrCreateMaterialAmbient(),
                e.normal = this.getOrCreateMaterialNormal(),
                e.materialalbedopbr = this.getOrCreateMaterialDiffusePBR(),
                e.materialspecularf0 = this.getOrCreateMaterialSpecularF0(),
                e.materialroughnesspbr = this.getOrCreateMaterialRoughness(),
                e.materialspecularpbr = this.getOrCreateMaterialSpecularPBR(),
                l.prototype.createLighting.call(this, e, t)
            }
        },
        getRoughnessFromGlossiness: function(t) {
            var e = this.createVariable("float")
              , i = "%out = 1.0 - %input;";
            return this.getNode("InlineCode").code(i).inputs({
                input: t
            }).outputs({
                out: e
            }),
            e
        },
        getMinRoughness: function(t) {
            var e = this.createVariable("float")
              , i = "%out = max(1.e-4, %input);";
            return this.getNode("InlineCode").code(i).inputs({
                input: t
            }).outputs({
                out: e
            }),
            e
        },
        getFinalFrag: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("Mult").inputs(t, this.getOrCreateMaterialCavityPBR()).outputs(e),
            r.prototype.getFinalFrag.call(this, e)
        }
    }),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = n.osgShader
      , s = a.node.NodeFunctions
      , o = a.utils
      , u = function() {
        s.apply(this)
    };
    u.prototype = r.objectInherit(s.prototype, {
        validOutputs: ["color"],
        globalFunctionDeclaration: function() {
            return '#pragma include "lightsPBR.glsl"'
        }
    });
    var l = function(t) {
        return "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    }
      , c = function() {
        u.apply(this)
    };
    c.prototype = r.objectInherit(u.prototype, {
        type: "PointLightPBR",
        validInputs: ["normal", "eyeVector", "materialalbedopbr", "prepSpec", "materialspecularpbr", "lightdiffuse", "lightposition", "lightattenuation", "lightmatrix", "lighted", "lightEyePos", "lightEyeDir", "lightNDL"],
        computeShader: function() {
            return o.callFunction("computePointLightPBRShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, this._inputs.materialalbedopbr, this._inputs.prepSpec, this._inputs.materialspecularpbr, l(this._inputs.lightdiffuse), this._inputs.lightposition, this._inputs.lightattenuation, this._inputs.lightmatrix, this._inputs.lightEyePos, this._inputs.lightEyeDir, this._inputs.lightNDL, this._inputs.lighted])
        }
    });
    var h = function() {
        u.apply(this)
    };
    h.prototype = r.objectInherit(u.prototype, {
        type: "SpotLightPBR",
        validInputs: ["normal", "eyeVector", "materialalbedopbr", "prepSpec", "materialspecularpbr", "lightdiffuse", "lightdirection", "lightattenuation", "lightposition", "lightspotCutOff", "lightspotBlend", "lightmatrix", "lightinvMatrix", "lighted", "lightEyePos", "lightEyeDir", "lightNDL"],
        computeShader: function() {
            return o.callFunction("computeSpotLightPBRShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, this._inputs.materialalbedopbr, this._inputs.prepSpec, this._inputs.materialspecularpbr, l(this._inputs.lightdiffuse), this._inputs.lightdirection, this._inputs.lightattenuation, this._inputs.lightposition, this._inputs.lightspotCutOff, this._inputs.lightspotBlend, this._inputs.lightmatrix, this._inputs.lightinvMatrix, this._inputs.lightEyePos, this._inputs.lightEyeDir, this._inputs.lightNDL, this._inputs.lighted])
        }
    });
    var d = function() {
        u.apply(this)
    };
    d.prototype = r.objectInherit(u.prototype, {
        type: "SunLightPBR",
        validInputs: ["normal", "eyeVector", "materialalbedopbr", "prepSpec", "materialspecularpbr", "lightdiffuse", "lightposition", "lightmatrix", "lighted", "lightEyeDir", "lightNDL"],
        computeShader: function() {
            return o.callFunction("computeSunLightPBRShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, this._inputs.materialalbedopbr, this._inputs.prepSpec, this._inputs.materialspecularpbr, l(this._inputs.lightdiffuse), this._inputs.lightposition, this._inputs.lightmatrix, this._inputs.lightEyeDir, this._inputs.lightNDL, this._inputs.lighted])
        }
    });
    var p = function() {
        s.apply(this)
    };
    p.prototype = r.objectInherit(s.prototype, {
        type: "prepSpecLightPBR",
        validInputs: ["normal", "eyeVector", "materialroughnesspbr"],
        validOutputs: ["prepSpec"],
        globalFunctionDeclaration: function() {
            return '#pragma include "lightsPBR.glsl"'
        },
        computeShader: function() {
            return o.callFunction("LightingFuncPrep", this._outputs.prepSpec, [this._inputs.normal, this._inputs.eyeVector, this._inputs.materialroughnesspbr])
        }
    }),
    t.exports = {
        PrepSpecLightPBR: p,
        PointLightPBR: c,
        SpotLightPBR: h,
        SunLightPBR: d
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = n.osgShader
      , s = a.node.NodeFunctions
      , o = a.utils
      , u = function() {
        s.apply(this)
    };
    u.prototype = r.objectInherit(s.prototype, {
        type: "DiffuseUE4v1",
        validInputs: ["normal", "albedo", "envTransform", "sphCoef"],
        validOutputs: ["color"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("computeIBLDiffuseUE4", this._outputs.color, [t.normal, t.albedo, t.envTransform, t.sphCoef])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    });
    var l = function() {
        s.apply(this)
    };
    l.prototype = r.objectInherit(s.prototype, {
        type: "SpecularUE4v1Panorama",
        validInputs: ["normal", "eye", "roughness", "specular", "envTransform", "texSpec", "lodRange", "texSize", "frontNormal"],
        validOutputs: ["color"],
        computeShader: function() {
            var t = this._inputs
              , e = [t.normal, t.eye, t.roughness, t.specular, t.envTransform, t.texSpec, t.lodRange, t.texSize, t.frontNormal];
            return t.integrateBRDF && e.push(t.integrateBRDF),
            o.callFunction("computeIBLSpecularUE4", this._outputs.color, e)
        },
        isMobileString: function() {
            return this._inputs.integrateBRDF ? "" : "#define MOBILE"
        },
        getDefines: function() {
            return [this.isMobileString(), "#define PANORAMA"]
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    });
    var c = function() {
        l.apply(this)
    };
    c.prototype = r.objectInherit(l.prototype, {
        type: "SpecularUE4v1Cubemap",
        getDefines: function() {
            return [this.isMobileString(), "#define CUBEMAP"]
        },
        getExtensions: function() {
            return ["#extension GL_EXT_shader_texture_lod : require"]
        }
    });
    var h = function() {
        s.apply(this)
    };
    h.prototype = r.objectInherit(s.prototype, {
        type: "EnvironmentTransformPBR",
        validInputs: ["inTransform"],
        validOutputs: ["outTransform"],
        computeShader: function() {
            return o.callFunction("environmentTransformPBR", this._outputs.outTransform, [this._inputs.inTransform])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    });
    var d = function() {
        s.apply(this)
    };
    d.prototype = r.objectInherit(s.prototype, {
        type: "AdjustRoughnessNmap",
        validInputs: ["roughness", "normal"],
        validOutputs: ["roughness"],
        computeShader: function() {
            return o.callFunction("adjustRoughnessNormalMap", this._outputs.roughness, [this._inputs.roughness, this._inputs.normal])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    });
    var p = function() {
        s.apply(this)
    };
    p.prototype = r.objectInherit(s.prototype, {
        type: "AdjustRoughnessGeometry",
        validInputs: ["roughness", "normal"],
        validOutputs: ["roughness"],
        computeShader: function() {
            return o.callFunction("adjustRoughnessGeometry", this._outputs.roughness, [this._inputs.roughness, this._inputs.normal])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    });
    var f = function() {
        s.apply(this)
    };
    f.prototype = r.objectInherit(s.prototype, {
        type: "SpecularOcclusion",
        validInputs: ["occlude", "ao", "normal", "eye"],
        validOutputs: ["ao"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("specularOcclusion", this._outputs.ao, [t.occlude, t.ao, t.normal, t.eye])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    }),
    t.exports = {
        DiffuseUE4v1: u,
        SpecularUE4v1Panorama: l,
        SpecularUE4v1Cubemap: c,
        EnvironmentTransformPBR: h,
        AdjustRoughnessNmap: d,
        AdjustRoughnessGeometry: p,
        SpecularOcclusion: f
    }
}
, function(t, e) {
    "use strict";
    var i = {};
    i.PICK_GEOMETRY_FIXED = 1,
    i.PICK_GEOMETRY_ANIMATED = 2,
    i.PICK_GEOMETRY_RIG_BOX = 4,
    i.PICK_GIZMO_LIGHT = 8,
    i.SHADOW_CAST = 16,
    i.SHADOW_BOUNDS = 32,
    i.PICK_GEOMETRY_SLOW = i.PICK_GEOMETRY_FIXED | i.PICK_GEOMETRY_ANIMATED,
    i.PICK_GEOMETRY_FAST = i.PICK_GEOMETRY_FIXED | i.PICK_GEOMETRY_RIG_BOX,
    i.PICK_GEOMETRY = i.PICK_GEOMETRY_FIXED | i.PICK_GEOMETRY_ANIMATED | i.PICK_GEOMETRY_RIG_BOX,
    i.PICK = i.PICK_GEOMETRY | i.PICK_GIZMO_LIGHT,
    i.SHADOW = i.SHADOW_BOUNDS | i.SHADOW_CAST,
    i.PICK_GEOMETRY_SHADOW = i.PICK_GEOMETRY | i.SHADOW,
    i.NO_SHADOW = ~i.SHADOW,
    i.NO_PICK = ~i.PICK,
    i.NO_PICK_NO_SHADOW_CAST = ~(i.PICK | i.SHADOW_CAST),
    i.NO_PICK_NO_SHADOW_BOUNDS = ~(i.PICK | i.SHADOW_BOUNDS),
    i.NO_PICK_NO_SHADOW = ~(i.PICK | i.SHADOW),
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(238)
      , r = i(1191)
      , a = i(1465)
      , s = new n({
        hasTransparency: !1,
        hasExtra: !1
    })
      , o = {}
      , u = 0;
    s.registerStateSetTransparency = function(t) {
        var e = t.getInstanceID();
        o[e] || (o[e] = !0,
        u++,
        s.set("hasTransparency", u > 0))
    }
    ,
    s.registerStateSetOpaque = function(t) {
        var e = t.getInstanceID();
        o[e] && (o[e] = !1,
        u--,
        s.set("hasTransparency", u > 0))
    }
    ;
    var l = !1
      , c = !1
      , h = function() {
        s.set("hasExtra", l || c || a().debug3d || r())
    };
    s.setHotspot = function(t) {
        c = t,
        h()
    }
    ,
    s.setWireframe = function(t) {
        l = t,
        h()
    }
    ,
    h(),
    t.exports = s
}
, function(t, e) {
    "use strict";
    var i = {};
    i.OPAQUE_BIN = 0,
    i.BACKGROUND = 1,
    i.TRANSPARENT_BIN_NO_EARLYZ_PRE = 9,
    i.TRANSPARENT_BIN = 10,
    i.TRANSPARENT_BIN_NO_EARLYZ_POST = 11,
    i.EXTRA = 19,
    i.EDITOR_GIZMO = i.HOTSPOT = 20,
    i.GRID = i.TOOLTIP = i.VR_MENU = 21,
    i.WIREFRAME = i.VR_CURSOR = 22,
    i.OUTLINE = 23,
    i.DEBUG = 24,
    i.DEBUG_2 = 25,
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1518)
      , a = i(1520)
      , s = {
        FeatureName: "manipulator",
        ModelType: r,
        ViewListType: [a]
    }
      , o = n.create(s);
    o.prototype.getManipulator = function() {
        return this._views[0]._switchManipulator
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(238)
      , a = i(1465);
    i(1519);
    var s = n.osg
      , o = r.extend({
        defaults: {
            webVR: !1,
            indexManipulator: "fps" === a().navigation ? 1 : 0,
            node: void 0,
            eyeCamera: s.Vec3.create(),
            targetCamera: s.Vec3.create(),
            minSpeed: .1
        },
        getName: function() {
            return "Manipulator"
        },
        init: function(t) {
            this._viewer = t.getViewer()
        },
        getCameraPosition: function(t, e) {
            var i = this._viewer.getFeaturesManager();
            if (i.getCameraWithoutAutospin(t, e),
            0 !== this.get("indexManipulator") && this.get("node")) {
                var n = this.get("node").getMinimumBound()
                  , r = s.Vec3.distance(n.center(), t)
                  , a = Math.max(.1 * n.radius(), r);
                s.Vec3.sub(e, t, e),
                s.Vec3.normalize(e, e),
                s.Vec3.mult(e, a, e),
                s.Vec3.add(t, e, e)
            }
        },
        saveCameraPosition: function() {
            this.getCameraPosition(this.get("eyeCamera"), this.get("targetCamera"))
        },
        validateEyeTarget: function(t, e) {
            var i = s.Vec3.distance(e, t);
            if (i <= 1e-8)
                return !1;
            var n = this.get("node").getMinimumBound().radius();
            return i <= .001 * n && (s.Vec3.sub(e, t, e),
            s.Vec3.mult(e, .01 * n / i, e),
            s.Vec3.add(t, e, e)),
            !0
        },
        getJSON: function() {
            return {
                position: s.Vec3.copy(this.get("eyeCamera"), s.Vec3.create()),
                target: s.Vec3.copy(this.get("targetCamera"), s.Vec3.create())
            }
        }
    });
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = new r.BoundingSphere;
    r.Node.prototype.getMinimumBound = function(t) {
        t || (t = a),
        t.init();
        var e = this.getBoundingBox();
        e.valid() && t.expandByBoundingBox(e);
        var i = this.getBound();
        return i.radius() < t.radius() ? i : t
    }
    ,
    t.exports = r.Node
}
, function(t, e, i) {
    "use strict";
    var n = i(258)
      , r = i(1521)
      , a = i(1465)
      , s = n.extend({
        initialize: function() {
            n.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:indexManipulator", this.onIndexManipulatorChanged, this),
            t.bind("change:node", this.onNodeChanged, this),
            t.bind("change:minSpeed", this.onNodeChanged, this),
            t.bind("change:webVR", this.setVR, this),
            this._switchManipulator = new r,
            this._viewer = this.options.context.getViewer(),
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._viewerOSGJS.setupManipulator(this._switchManipulator),
            this.onIndexManipulatorChanged()
        },
        setVR: function() {
            var t = this._viewerOSGJS.getManipulator()
              , e = this.model.get("webVR");
            t.setDelay(e ? 1 : .15);
            var i = this._viewerOSGJS.getEventProxy();
            if (this._viewerOSGJS.requestContinuousUpdate(!0),
            e) {
                this.lastMode = this.model.get("indexManipulator");
                var n = i.WebVR.getHmd()
                  , a = !!n
                  , s = !a;
                if (!s) {
                    var o = n.displayName.toLowerCase();
                    o.indexOf("cardboard") === -1 && o.indexOf("samsung") === -1 || (s = !0)
                }
                i.Hammer.setEnable(!1),
                i.WebVR.setEnable(a),
                i.DeviceOrientation.setEnable(!a),
                this.model.set("indexManipulator", r.FPS)
            } else
                i.DeviceOrientation.setEnable(!1),
                i.WebVR.setEnable(!1),
                i.Hammer.setEnable(!0),
                void 0 !== this.lastMode && this.model.set("indexManipulator", this.lastMode);
            var u = this._viewer.getFeatures();
            !u || u.webVR && u.webVR.getModel().get("modeLauncher") || t.computeHomePosition()
        },
        onIndexManipulatorChanged: function() {
            this._switchManipulator.setManipulatorIndex(this.model.get("indexManipulator"))
        },
        onNodeChanged: function() {
            var t = this._switchManipulator;
            t.setNode(this.model.get("node"));
            var e = t.getManipulatorList()[r.ORBIT]
              , i = t.getHomeBound().radius();
            e.setMinSpeed(this.model.get("minSpeed") * i),
            0 === a().orbitConstraintZoomIn && e.setLimitZoomIn(.001 * i)
        }
    });
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1522)
      , a = i(1523)
      , s = i(1486)
      , o = i(1465)
      , u = n.osg
      , l = n.osgGA
      , c = l.OrbitManipulator.Interpolator.prototype
      , h = c.reset;
    c.reset = function() {
        h.call(this),
        this._epsilon = .01
    }
    ;
    var d = c.set;
    c.set = function() {
        d.apply(this, arguments),
        this._epsilon >= 0 && !this.isDone() && s.draw()
    }
    ;
    var p = c.setTarget;
    c.setTarget = function() {
        this._isOrbitPan && o().orbitConstraintPan || (p.apply(this, arguments),
        this._epsilon >= 0 && !this.isDone() && s.draw())
    }
    ;
    var f = c.addTarget;
    c.addTarget = function() {
        f.apply(this, arguments),
        this._epsilon >= 0 && !this.isDone() && s.draw()
    }
    ,
    c.isDone = function() {
        for (var t = Math.abs(this._epsilon), e = 0, i = this._current.length; e < i; ++e)
            if (Math.abs(this._target[e] - this._current[e]) > t)
                return !1;
        return !0
    }
    ;
    var g = c.update;
    c.update = function(t) {
        var e = g.call(this, t);
        if (this._epsilon >= 0)
            if (this.isDone())
                for (var i = 0, n = this._current.length; i < n; ++i)
                    this._current[i] = this._target[i];
            else
                s.draw();
        return e
    }
    ;
    var m = function() {
        for (var t = Math.abs(this._epsilon), e = 0, i = this._current.length; e < i; ++e)
            if (1 === Math.abs(this._target[e]) || Math.abs(this._target[e] - this._current[e]) > t)
                return !1;
        return !0
    }
      , v = function(t) {
        t.isDone = m.bind(t)
    }
      , _ = function() {
        l.SwitchManipulator.call(this),
        this._boundStrategy = l.Manipulator.COMPUTE_HOME_USING_SPHERE | l.Manipulator.COMPUTE_HOME_USING_BBOX,
        this.init()
    };
    _.prototype = u.objectInherit(l.SwitchManipulator.prototype, {
        init: function() {
            l.SwitchManipulator.prototype.setManipulatorIndex.call(this, 0);
            var t = new a(this._boundStrategy);
            t.getRotateInterpolator()._epsilon = .1,
            t.getPanInterpolator()._epsilon = .1,
            t.getZoomInterpolator()._epsilon = .001,
            t.getPanInterpolator()._isOrbitPan = !0;
            var e = new r(this._boundStrategy);
            e.getLookPositionInterpolator()._epsilon = .1,
            e.getSideInterpolator()._epsilon = .001,
            v(e.getSideInterpolator()),
            e.getForwardInterpolator()._epsilon = .001,
            v(e.getForwardInterpolator()),
            e.getPanInterpolator()._epsilon = .001,
            v(e.getPanInterpolator()),
            e.getZoomInterpolator()._epsilon = .001,
            v(e.getZoomInterpolator()),
            this.addManipulator(t, "ORBIT"),
            this.addManipulator(e, "FPS"),
            void 0 !== o().cameraEasing && this.setDelay(1 - o().cameraEasing)
        },
        getOrbitManipulator: function() {
            return this._manipulatorList[_.ORBIT]
        },
        getFirstPersonManipulator: function() {
            return this._manipulatorList[_.FPS]
        },
        _setManipulatorDelay: function(t, e) {
            t.setDelay(e);
            for (var i = t._controllerList, n = Object.keys(i), r = 0, a = n.length; r < a; ++r) {
                var s = i[n[r]];
                void 0 !== s._delay && (s._delay = e)
            }
        },
        setDelay: function(t) {
            this._setManipulatorDelay(this._manipulatorList[_.ORBIT], t),
            this._setManipulatorDelay(this._manipulatorList[_.FPS], t)
        },
        addManipulator: function(t, e) {
            l.SwitchManipulator.prototype.addManipulator.call(this, t),
            e && (_[e] = this.getManipulatorList().length - 1)
        },
        setManipulatorIndex: function() {
            var t = u.Vec3.create()
              , e = u.Vec3.create();
            return function(i) {
                if (i !== this.getCurrentManipulatorIndex()) {
                    var n = _.ORBIT || 0
                      , r = this.getCurrentManipulator();
                    l.SwitchManipulator.prototype.setManipulatorIndex.call(this, i);
                    var a = this.getCurrentManipulator();
                    r.getEyePosition(e),
                    r.getTarget(t),
                    i === n ? (a.setTarget(t),
                    a.setEyePosition(e)) : (a.setEyePosition(e),
                    a.setTarget(t))
                }
            }
        }(),
        setEyePosition: function(t, e) {
            this.getCurrentManipulator().setEyePosition(t, e),
            s.draw()
        },
        getEyePosition: function(t) {
            return this.getCurrentManipulator().getEyePosition(t)
        },
        setTarget: function(t) {
            this.getCurrentManipulator().setTarget(t),
            s.draw()
        },
        getTarget: function(t) {
            return this.getCurrentManipulator().getTarget(t)
        },
        setDistance: function(t) {
            this.getCurrentManipulatorIndex() === _.ORBIT && (this.getCurrentManipulator().setDistance(t),
            s.draw())
        },
        getDistance: function() {
            return this.getCurrentManipulator().getDistance()
        },
        computeHomePosition: function(t) {
            l.SwitchManipulator.prototype.computeHomePosition.call(this, t),
            s.draw()
        }
    }),
    t.exports = _
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1465)
      , a = n.osg
      , s = n.osgGA
      , o = function(t) {
        s.FirstPersonManipulator.call(this, t);
        var e = Math.max(0, Math.min(4, r().fpsSpeed / 25));
        this._stepFactor = e,
        this.getControllerList().StandardMouseKeyboard._stepFactor = e,
        this._postMultRotate = a.Quat.create(),
        this._resetInitialVR = !1,
        this._lookPosition._delay = .25
    };
    o.prototype = a.objectInherit(s.FirstPersonManipulator.prototype, {
        getPostMultRotate: function() {
            return this._postMultRotate
        },
        setResetInitialRotationVR: function(t) {
            this._resetInitialVR = t,
            t || a.Quat.init(this._postMultRotate)
        },
        setNode: function(t) {
            s.FirstPersonManipulator.prototype.setNode.call(this, t);
            var e = this.getHomeBound();
            e && e.valid() && (this._distance = this.getHomeDistance(e))
        },
        setInitialPoseVR: function() {
            var t = a.Quat.create()
              , e = a.Matrix.create()
              , i = a.Vec3.createAndSet(0, 0, 1);
            return function(n, r) {
                a.Matrix.makeLookAt(n, r, i, e),
                a.Matrix.inverse(e, e),
                a.Matrix.getRotate(e, t),
                t[1] = t[0] = 0,
                a.Quat.normalize(t, t),
                a.Quat.copy(t, this._postMultRotate),
                this.setEyePosition(n),
                this.setResetInitialRotationVR(!0)
            }
        }(),
        setPoseVR: function() {
            var t = a.Vec3.create();
            return function(e, i) {
                this._resetInitialVR && (a.Quat.inverse(e, this._vrRot),
                this._vrRot[0] = this._vrRot[1] = 0,
                a.Quat.normalize(this._vrRot, this._vrRot),
                a.Quat.mult(this._vrRot, this._postMultRotate, this._postMultRotate)),
                a.Quat.mult(this._postMultRotate, e, this._vrRot),
                a.Quat.transformVec3(this._postMultRotate, i, t),
                this._resetInitialVR ? (a.Vec3.init(this._vrTrans),
                this._resetInitialVR = !1) : a.Vec3.sub(t, this._vrPos, this._vrTrans),
                a.Vec3.copy(t, this._vrPos),
                this._vrEnable = !0
            }
        }()
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1482)
      , a = i(1465)
      , s = .99
      , o = n.osg
      , u = n.osgGA
      , l = function(t) {
        u.OrbitManipulator.call(this, t),
        r.getFirstCameraAnimation().then(function() {
            this.setLimitYawLeft(a().orbitConstraintYawLeft),
            this.setLimitYawRight(a().orbitConstraintYawRight),
            this.setLimitPitchDown(a().orbitConstraintPitchDown),
            this.setLimitPitchUp(a().orbitConstraintPitchUp),
            this.setLimitZoomOut(a().orbitConstraintZoomOut),
            a().orbitConstraintZoomIn > 0 && (this.setLimitZoomIn(a().orbitConstraintZoomIn),
            this.setAutoPushTarget(!1))
        }
        .bind(this))
    };
    l.prototype = o.objectInherit(u.OrbitManipulator.prototype, {
        setEyePosition: function() {
            var t = o.Vec3.create()
              , e = o.Vec3.create()
              , i = o.Vec3.create();
            return function(n, r) {
                var a = this._rotation
                  , u = this._target;
                if (o.Vec3.sub(n, u, t),
                o.Vec3.normalize(t, t),
                r) {
                    var l = o.Vec3.dot(t, this._upz);
                    if (Math.abs(l) > s) {
                        var c = Math.sqrt((1 - s * s) / (t[0] * t[0] + t[1] * t[1]));
                        t[0] *= c,
                        t[1] *= c,
                        t[2] = s * Math.sign(l)
                    }
                }
                o.Vec3.cross(t, this._upz, e),
                o.Vec3.normalize(e, e),
                o.Vec3.cross(e, t, i),
                o.Vec3.normalize(i, i),
                a[0] = e[0],
                a[1] = t[0],
                a[2] = i[0],
                a[3] = 0,
                a[4] = e[1],
                a[5] = t[1],
                a[6] = i[1],
                a[7] = 0,
                a[8] = e[2],
                a[9] = t[2],
                a[10] = i[2],
                a[11] = 0,
                a[12] = 0,
                a[13] = 0,
                a[14] = 0,
                a[15] = 1,
                this._distance = o.Vec3.distance(n, u)
            }
        }()
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1525)
      , a = i(1549)
      , s = a.extend({
        getName: function() {
            return "Material"
        }
    })
      , o = {
        FeatureName: "material",
        ModelType: s,
        ViewListType: [r]
    }
      , u = n.create(o);
    u.prototype.getSceneLights = function() {
        return this._views[0].getSceneLights()
    }
    ,
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(216)
      , a = i(1198)
      , s = i(1482)
      , o = i(258)
      , s = i(1482)
      , u = i(1465)
      , l = i(1197)
      , c = i(1526)
      , h = i(1540)
      , d = i(1541)
      , p = i(1484)
      , f = i(1542)
      , g = i(1543)
      , u = i(1465)
      , m = i(1544)
      , v = i(1547)
      , _ = a.osg
      , b = o.extend({
        getName: function() {
            return "MaterialManagerView3D"
        },
        initialize: function() {
            o.prototype.initialize.apply(this, arguments),
            this.model.bind("change", this.render, this),
            g.bind("change:mask", this.cleanAndApplyMaterials, this),
            this._sceneLights = [],
            this._defaultStateSet = void 0,
            this._defaultMaterial = void 0,
            this._renderingPaths = new h;
            var t = this.createImageCollection();
            this.model.setImageCollection(t.resource),
            this.model.imageCollection.isValid(),
            this.init()
        },
        init: function() {
            var t = this.options.context
              , e = t.getScene();
            this._viewer = t.getViewer(),
            this.resourceDefer = n.defer(),
            e.addResourcePromise(this.resourceDefer.promise),
            s.getPolygon().then(this.initSceneGraph.bind(this))
        },
        createImageCollection: function() {
            return this.getResourceManager().getOrCreateImageCollection()
        },
        getResourceManager: function() {
            return this._resourceManager || l.instance
        },
        getOrCreateDefaultStateSet: function() {
            return void 0 === this._defaultStateSet && (this._defaultStateSet = new _.StateSet,
            this._defaultStateSet._uniqueID = 0),
            this._defaultStateSet
        },
        getOrCreateDefaultMaterial: function(t, e) {
            var i = this.getOrCreateDefaultStateSet();
            if (void 0 === this._defaultMaterial) {
                if (this._defaultMaterial = e.getMaterialByStateSet(i),
                this._defaultMaterial) {
                    var n = e.getUniqueMaterialName(i.getAttributeMap().Material, i, t);
                    this._defaultMaterial.set("name", n)
                } else
                    this._defaultMaterial = e.createMaterial(t, i);
                this._defaultMaterial.setStateSet(i)
            }
            return t.setStateSet(i),
            this._defaultMaterial
        },
        processSceneGraph: function(t, e) {
            var i = new c(e)
              , n = i.apply(t);
            return t.accept(this._renderingPaths),
            this.fixWrongRootEditUser(t, this._renderingPaths),
            this.pruneSceneGraph(this._renderingPaths),
            0 === n.getMaterials().length && this.getOrCreateDefaultMaterial(t, e),
            this._renderingPaths.getPathList().forEach(function(t) {
                var i = t.some(function(t) {
                    var e = t.getStateSet();
                    return e && e.getAttribute("SketchfabMaterial")
                });
                if (!i) {
                    var n = t[t.length - 1];
                    this.getOrCreateDefaultMaterial(n, e)
                }
            }
            .bind(this)),
            this._sceneLights = n.getLights(),
            n
        },
        getSceneLights: function() {
            return this._sceneLights
        },
        fixWrongRootEditUser: function(t, e) {
            var i = this.model
              , n = this.hasWrongRootEditUser(i);
            if (n) {
                n.rootMaterialToKeep = !0;
                var a = {};
                if (r.each(i.attributes, function(t) {
                    a[t.get("stateSetID")] = t
                }),
                2 === r.size(i.attributes)) {
                    var s = r.filter(i.attributes, function(t) {
                        return t.get("stateSet") !== n.get("stateSet")
                    })[0];
                    for (var o in n.attributes.channels)
                        n.attributes.channels[o].attributes.texture && (s.attributes.channels[o].attributes.texture = n.attributes.channels[o].attributes.texture)
                } else
                    for (var u = n, l = e.getStateSetPathList(), c = 0, h = l.length; c < h; c++) {
                        var p = l[c];
                        if (p[0] === u.attributes.stateSet)
                            for (var f = p.length - 1; f--; ) {
                                var g = p[f];
                                i.removeMaterialByStateSetID(g._uniqueID)
                            }
                    }
                var m = new d(a);
                t.accept(m),
                0 !== m.removedStateSet.length && (m.removedStateSet = m.removedStateSet.filter(function(t, e, i) {
                    var n = i.lastIndexOf(t) === e;
                    return n && m.keepedStateSet.indexOf(t) === -1
                }),
                r.each(m.removedStateSet, function(t) {
                    i.removeMaterialByStateSetID(t)
                }))
            }
        },
        initSceneGraph: function() {
            var t = this.options.context
              , e = this.model
              , i = t.getScene()
              , n = i.getRoot();
            if (_.time("initSceneGraph - createa saved materials"),
            u().process_material === !1)
                for (var r = t.getModel().get("options").materials, a = Object.keys(r), o = 0, l = a.length; o < l; ++o)
                    e.addMaterial(r[a[o]]);
            _.timeEnd("initSceneGraph - createa saved materials"),
            _.time("initSceneGraph - processSceneGraph");
            var c = this.processSceneGraph(n, e);
            _.timeEnd("initSceneGraph - processSceneGraph"),
            _.time("initSceneGraph - apply materials"),
            e.removeUnboundMaterial();
            var h = this._viewer.getFeatures().shadingStyle
              , d = !1;
            if (h) {
                var p = h.getModel();
                d = p.get("vertexColorEnable") && p.get("vertexAlphaEnable")
            }
            e.tagVertexColorMaterial(n, d),
            this._requestTextures(),
            e._style = c.getStyle();
            var f = c.hasMetallicWorkflow();
            void 0 !== f && e.setWorkFlowMetalSpec(f, !1),
            e.overrideMaterialChannels(u()),
            this.applyMaterials(),
            this.setWireframeStateSets(),
            _.timeEnd("initSceneGraph - apply materials"),
            v.optimize(this._renderingPaths, this.model.attributes, this._viewer),
            s.resolveMaterial()
        },
        setWireframeStateSets: function() {
            var t = 0
              , e = this.model
              , i = !u().mergeMaterials
              , n = {}
              , r = {}
              , a = this._renderingPaths.getPathList()
              , s = a.length;
            for (t = 0; t < s; ++t) {
                var o = a[t]
                  , l = o[o.length - 1];
                if (l instanceof _.Geometry != !1) {
                    var c = l.getVertexAttributeList().Vertex;
                    c && (r[c.getInstanceID()] = o)
                }
            }
            var h = this._renderingPaths.getWireframePathList()
              , d = this.options.context.getScene().getWireframeNodes()
              , p = d.length;
            for (t = 0; t < p; ++t) {
                var f = d[t]
                  , g = f.getVertexAttributeList()
                  , v = r[g.Vertex.getInstanceID()];
                if (v) {
                    var b, x = v[v.length - 1], A = e.findFirstMaterial(v), y = A.getChannels().Displacement, S = x.getVertexAttributeList();
                    if (i) {
                        b = new m,
                        S.Normal && (g.Normal = S.Normal);
                        for (var C = Object.keys(S), M = 0, w = C.length; M < w; ++M) {
                            var T = C[M];
                            T.indexOf("TexCoord") !== -1 && (g[T] = S[T])
                        }
                        b.textureAttributeMapList = A.get("stateSet").textureAttributeMapList
                    } else if (y.isEffective()) {
                        var E = y.getTexture().getUID();
                        b = n[E] = n[E] || new m;
                        var I = "TexCoord" + y.getTexCoordUnit();
                        S.Normal && (g.Normal = S.Normal),
                        S[I] && (g[I] = S[I]);
                        var k = A.get("stateSet").getTextureAttribute(0, "Texture");
                        b.setTextureAttributeAndModes(0, k)
                    } else
                        b = n["static"] = n["static"] || new m;
                    f.setStateSet(b)
                } else {
                    d.splice(t, 1),
                    t--,
                    p--;
                    for (var F = f.getParents(), D = 0, N = F.length; D < N; ++D)
                        F[D].removeChild(f);
                    for (var R = 0; R < h.length; ++R) {
                        var P = h[R];
                        P[P.length - 1] === f && (h.splice(R, 1),
                        R--)
                    }
                }
            }
        },
        pruneSceneGraph: function(t) {
            for (var e = t.getStateSetMapNodes(), i = t.getStateSetPathList(), n = t.getStateSetMap(), r = {}, a = 0, s = i.length; a < s; a++) {
                var o = i[a];
                if (o.length > 0) {
                    var u = o.length - 1
                      , l = o[u];
                    r[l._uniqueID] = l
                }
            }
            for (var c = 0, h = 0, d = Object.keys(e), p = 0, f = d.length; p < f; p++) {
                var g = d[p];
                if (void 0 === r[g]) {
                    this.model.removeMaterialByStateSet(n[g]),
                    h++;
                    for (var m = 0, v = e[g].length; m < v; m++) {
                        var _ = e[g][m];
                        _.setStateSet(void 0),
                        c += v
                    }
                }
            }
        },
        hasWrongRootEditUser: function(t) {
            var e;
            return r.size(t.attributes) > 1 && r.values(t.attributes)[0].get("version") < 2 && (e = r.find(t.attributes, function(t) {
                if (t.attributes && t.attributes.name) {
                    var e = t.attributes.name.toLowerCase();
                    if (e.indexOf("root") !== -1 || e.indexOf("ollada visual") !== -1) {
                        var i = r.find(t.attributes.channels, function(t) {
                            return void 0 !== t.getTexture()
                        });
                        if (void 0 !== i)
                            return !0
                    }
                }
                return !1
            })),
            e
        },
        cleanAndApplyMaterials: function() {
            r.each(this.model.attributes, function(t) {
                t.get("stateSet") && t.trigger("change:stateSet")
            }),
            this.applyMaterials()
        },
        applyMaterials: function() {
            r.each(this.model.attributes, function(t) {
                t.trigger("apply")
            })
        },
        _requestTexture: function(t, e, i) {
            if (t) {
                var n = t.getChannels()[e]
                  , r = n.getTexture();
                if (r && n.isEffective()) {
                    var a = r.getTextureProxy();
                    if (a) {
                        var s = a.getImageCount();
                        if (0 === s)
                            return void n.setColor(_.Vec3.createAndSet(.9, .9, .9));
                        var o = i ? a.getImageSmallest() : a.getImageMaxSupported();
                        return o.promise
                    }
                }
            }
        },
        _requestAllTextures: function(t, e) {
            var i = this
              , n = []
              , a = new window.Set;
            return f.forEach(function(s) {
                r.each(t, function(t) {
                    var r = i._requestTexture(t, s, e);
                    r && !a.has(r) && (a.add(r),
                    n.push(r))
                })
            }),
            n
        },
        _resolvePromiseTextures: function(t, e, i) {
            for (var n = (new Date).getTime() - e, r = 0, a = 0, o = t.length; a < o; ++a)
                t[a] !== !0 && r++;
            var u = i ? s.resolveLowResLoaded : s.resolveHighResLoaded;
            u({
                time: r > 0 ? n : 0,
                count: r
            })
        },
        requestAllLowResTextures: function(t) {
            return this._requestAllTextures(t, !0)
        },
        requestAllHighResTextures: function(t) {
            return this._requestAllTextures(t, !1)
        },
        _resolvePromiseLowResTextures: function(t, e) {
            return this._resolvePromiseTextures(t, e, !0)
        },
        _resolvePromiseHighResTextures: function(t, e) {
            return this._resolvePromiseTextures(t, e, !1)
        },
        _requestTextures: function() {
            var t = this
              , e = this.options.context
              , i = e.getViewer()
              , r = u()
              , a = r.preload;
            p.WAIT_ANIMATION = !a;
            var s = this.model.toJSON()
              , o = this.requestAllLowResTextures(s)
              , l = (new Date).getTime();
            a || i.setFakePrimaryProgress(o);
            var c = e.getFeatures().quality;
            c && c.getModel().trigger("updateTexelPolicy"),
            n.settle(o).then(function() {
                t._resolvePromiseLowResTextures(o, l);
                var e = (new Date).getTime()
                  , r = t.requestAllHighResTextures(s);
                i.setFakeProgress(r, !a),
                n.settle(r).then(function() {
                    t._resolvePromiseHighResTextures(r, e),
                    a === !0 && t.resourceDefer.resolve()
                }),
                a || t.resourceDefer.resolve()
            })
        },
        getOrCreateTexelInfos: function() {
            if (this._infoTex)
                return this._infoTex;
            var t = this._infoTex = {
                missingResolution: !1,
                count: 0,
                size: 0,
                min: 1 / 0,
                max: -(1 / 0)
            }
              , e = this.model.attributes
              , i = {};
            return f.forEach(function(n) {
                r.each(e, function(e) {
                    if (e) {
                        var r = e.getChannels()[n]
                          , a = r.getTexture();
                        if (a && r.isEffective()) {
                            var s = a.getTextureProxy();
                            if (s && !i[s.getInstanceID()]) {
                                i[s.getInstanceID()] = !0;
                                var o = 1
                                  , u = s.getInternalFormat();
                                u === _.Texture.RGB ? o = .75 : u !== _.Texture.LUMINANCE && u !== _.Texture.ALPHA || (o = .25);
                                var l = s.getImageJSONMaxSupported();
                                t.count++,
                                t.size += o * l.width * l.height;
                                var c = Math.max(l.width, l.height);
                                if (t.min = Math.min(c, t.min),
                                t.max = Math.max(c, t.max),
                                !t.missingResolution && (l.width > 512 || l.height > 512)) {
                                    var h = s.getImageJSONMaxSupported(512);
                                    512 !== h.width && 512 !== h.height && (t.missingResolution = !0)
                                }
                            }
                        }
                    }
                })
            }),
            t
        },
        render: function() {
            return this
        }
    });
    t.exports = b
}
, function(t, e, i) {
    "use strict";
    var n = i(1527)
      , r = i(1528)
      , a = i(1481)
      , s = function(t) {
        this._materialManager = t
    };
    s.prototype = {
        apply: function(t) {
            var e = new n;
            t.accept(e);
            var i = e.getSource()
              , s = e.getAuthoringTool();
            i = i ? i.toLowerCase() : "default";
            var o = r[i] ? r[i] : r["default"]
              , u = new o(this._materialManager,s);
            t.accept(u),
            u.postApply(t),
            "q3d" === i && (u._style = "shadeless");
            var l = t.getUserData() || [];
            return l.push({
                Name: "source",
                Value: i
            }, {
                Name: "authoringTool",
                Value: s
            }),
            t.setUserData(l),
            t.userDataMap = a.convertUserDataToObject(l),
            u
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = r.osg
      , s = function() {
        a.NodeVisitor.call(this, a.NodeVisitor.TRAVERSE_ALL_CHILDREN)
    };
    s.prototype = a.objectInherit(a.NodeVisitor.prototype, {
        getSource: function() {
            return this._source
        },
        getAuthoringTool: function() {
            return this._authoringTool
        },
        extractSource: function(t) {
            var e = n.find(t, function(t) {
                return "source" === t.Name
            });
            if (e)
                return e.Value
        },
        checkStateSet: function(t) {
            t && t.getUserData() && (this._source = this.extractSource(t.getUserData()))
        },
        checkNode: function(t) {
            var e = t.getUserData();
            if (!e && "LightSource" === t.className()) {
                var i = t.getLight();
                i && (e = i.getUserData())
            }
            var r = this;
            e && n.each(e, function(t) {
                "source" === t.Name ? r._source = t.Value : "authoring_tool" === t.Name && (r._authoringTool = t.Value)
            })
        },
        apply: function(t) {
            this.checkNode(t),
            this._source || this.checkStateSet(t.getStateSet()),
            this._source || this.traverse(t)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1529)
      , r = i(1533)
      , a = i(1534)
      , s = i(1535)
      , o = i(1536)
      , u = i(1537)
      , l = i(1538)
      , c = i(1539);
    t.exports = {
        "default": a,
        wavefront: l,
        blender: n,
        ksp: n,
        lightwave: o,
        minecraft: u,
        collada: r,
        fbx: s,
        substancepainter: r,
        mineways: u,
        gltf: c
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = i(1530)
      , s = i(1532)
      , o = r.osg
      , u = function() {
        a.apply(this, arguments)
    };
    u.prototype = o.objectInherit(a.prototype, {
        cyclesNodeToMaterial: function(t, e, i, n, r, a, s, u) {
            var l = t.nodes[r];
            if (void 0 !== l) {
                void 0 === u && (u = r);
                var c = "setChannel" + n;
                if (void 0 === e[c])
                    return void o.warn("material has not method " + c);
                if (!(s && a && l.inputs) && l.value)
                    return void e[c](u, l.value);
                for (var h = 0; h < l.inputs.length; h++) {
                    var d = l.inputs[h];
                    if (d.name === a) {
                        var p = d.default_value;
                        if (void 0 !== p)
                            if (Array.isArray(p))
                                if ("Opacity" === u || "Transparent BSDF" === u || "Glass BSDF" === u)
                                    if ("Color" === a) {
                                        var f = p[0] * p[1] * p[2] * p[3];
                                        1 === f && (f = .15),
                                        e[c](u, f)
                                    } else
                                        e[c](u, p);
                                else
                                    "SpecularPBR" === u ? "Color" === a ? e[c](u, p) : (p = p[0] * p[1] * p[2] * p[3],
                                    e[c](u, p)) : "Color" === a && "NormalMap" === u || e[c](u, p);
                            else
                                "setChannelColor" !== u && "Color" !== n && ("Strength" === a && "Emission" === r && (p /= 10),
                                e[c](u, p));
                        if (d.links && "SpecularPBR" !== u) {
                            for (var g = 0; g < d.links.length; g++) {
                                var m = d.links[g];
                                if (m.from_node) {
                                    var v = t.nodes[m.from_node];
                                    if (v) {
                                        var _ = v.texture_slot;
                                        if (p = i.getTextureAttribute(_, "Texture")) {
                                            e.setChannelTexture(u, this.createTextureModelFromTextureOSG(p));
                                            var b = e.getChannels()[u];
                                            b.resetTextureFormat(),
                                            b.setTexCoordUnit(_),
                                            b.setEnable(!0),
                                            this._texturesAssigned.push(p)
                                        }
                                    }
                                    void 0 !== v && void 0 !== p || o.warn("Missing Texture linked in " + r + " node destined to " + u)
                                }
                            }
                            return
                        }
                    }
                }
                l = this.findNodeByValueCyclesMetadata(t.nodes, r),
                l && l.value && e[c](u, l.value)
            }
        },
        findNodeByValueCyclesMetadata: function(t, e) {
            for (var i = Object.keys(t), n = 0; n < i.length; n++) {
                var r = i[n]
                  , a = t[r];
                if (a instanceof Object) {
                    var s = this.findNodeByValueCyclesMetadata(a, e);
                    if (void 0 !== s)
                        return s
                } else if (a === e)
                    return t
            }
        },
        metaDataToMaterial: function(t, e, i, n, r, a) {
            if (void 0 !== t[n]) {
                void 0 === r && (r = n);
                var s = "setChannel" + i;
                return void 0 === e[s] ? void o.warn("material has not method " + s) : void (void 0 === a || a === !0 ? e[s](r, JSON.parse(t[n])) : e[s](r, t[n]))
            }
        },
        setTextureFromBlender: function(t, e, i, n, r) {
            var a = t.getChannels()[e];
            a.setFactor(r);
            var s = this.createTextureModelFromTextureOSG(n);
            a.setTexture(s),
            a.resetTextureFormat(),
            a.setTexCoordUnit(i),
            a.setEnable(!0)
        },
        processDefaultMaterial: function(t, e) {
            e.removeAttribute("Material");
            for (var i = 0, n = e.getNumTextureAttributeLists(); i < n; i++)
                e.removeTextureAttribute(i, "Texture");
            t.setStateSet(void 0)
        },
        processLightSource: function(t) {
            var e = t.getLight();
            if (e && void 0 !== e.getUserData() && e.typeID !== s.typeID) {
                var i = e.getUserData()
                  , n = this.convertUserDataToObject(i)
                  , r = new s;
                "AREA" !== n.Type && "SUN" !== n.Type && "HEMI" !== n.Type || (n.Type = "DIRECTION"),
                r.setLightType(n.Type),
                void 0 !== n.SpotSize && r.setSpotCutoff(90 * JSON.parse(n.SpotSize) / Math.PI),
                void 0 !== n.SpotBlend && r.setSpotBlend(JSON.parse(n.SpotBlend)),
                o.Vec3.mult(JSON.parse(n.Color), JSON.parse(n.Energy), r.getDiffuse());
                var a = 1 / JSON.parse(n.Distance);
                r.setQuadraticAttenuation(Math.abs(a) === 1 / 0 ? 0 : a),
                t.setLight(r),
                r._node = t,
                this._lights.push(r)
            }
        },
        processCyclesGraph: function(t, e, i) {
            var n;
            try {
                n = JSON.parse(i.NodeTree)
            } catch (r) {
                return o.warn("error in blender cycle graph json " + r),
                !0
            }
            if (void 0 === n)
                return !0;
            this._texturesAssigned = [],
            this.cyclesNodeToMaterial(n, t, e, "Color", "Diffuse BSDF", "Color", !0, "DiffusePBR"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Diffuse BSDF", "Roughness", !0, "RoughnessPBR"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Diffuse BSDF", "Normal", !0, "NormalMap"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Glossy BSDF", "Color", !0, "SpecularPBR"),
            t.setChannelFactor("SpecularPBR", 1),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Glossy BSDF", "Roughness", !0, "RoughnessPBR"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Glossy BSDF", "Normal", !0, "NormalMap"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Bump", "Height", !0, "NormalMap"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Bump", "Strength", !0, "NormalMap"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Emission", "Color", !0, "EmitColor"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Emission", "Strength", !0, "EmitColor"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Ambient Occlusion", "Color", !0, "AOPBR"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Ambient Occlusion", "Strength", !0, "AOPBR"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Transparency", "Strength", !0, "Opacity"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Transparent BSDF", "Color", !0, "Opacity"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Glass BSDF", "Color", !0, "Opacity");
            for (var a = [], s = 0, u = e.getNumTextureAttributeLists(); s < u; s++) {
                var l = e.getTextureAttribute(s, "Texture");
                l && this._texturesAssigned.indexOf(l) === -1 && a.push(l)
            }
            return this.assignPBRTextureFromFilenames(a, t),
            t.setWorkFlowMetalSpec(!1, !1),
            t.setWorkFlowRoughGloss(!0, !1),
            !1
        },
        processMaterial: function(t, e, i) {
            var r = this.createMaterial(t, e)
              , a = e.getAttribute("Material")
              , s = this.convertUserDataToObject(a ? a.getUserData() : void 0)
              , u = !0;
            s.NodeTree && (u = this.processCyclesGraph(r, e, s)),
            u && (this.metaDataToMaterial(s, r, "Color", "DiffuseColor"),
            this.metaDataToMaterial(s, r, "Factor", "DiffuseIntensity", "DiffuseColor"),
            r.setChannelEnable("DiffuseColor", !0),
            this.metaDataToMaterial(s, r, "Color", "SpecularColor"),
            this.metaDataToMaterial(s, r, "Factor", "SpecularIntensity", "SpecularColor"),
            r.setChannelEnable("SpecularColor", !0),
            this.metaDataToMaterial(s, r, "Factor", "Emit", "EmitColor"),
            r.setChannelEnable("EmitColor", !0),
            this.metaDataToMaterial(s, r, "Factor", "SpecularHardness"),
            r.setChannelEnable("SpecularHardness", !0),
            void 0 !== s.Translucency && (r.setChannelFactor("Opacity", 1 - JSON.parse(s.Translucency)),
            r.setChannelEnable("Opacity", !0)),
            void 0 !== i.Shadeless && r.set("shadeless", i.Shadeless));
            var l = n.chain(e.getUserData()).map(function(t) {
                var e = t.Name.substr(0, 2)
                  , i = parseInt(e, 10);
                if (!isNaN(i))
                    return i
            }).without(void 0).uniq().sortBy(function(t) {
                return t
            }).value();
            e.removeAttribute("Material");
            var c = {}
              , h = ["DiffuseColor", "DiffuseIntensity", "SpecularColor", "Normal", "Bump", "Translucency", "Alpha", "EmitColor", "SpecularHardness"]
              , d = this;
            n.each(l, function(t) {
                var i = n.chain(e.getUserData()).filter(function(e) {
                    var i = e.Name.substr(0, 2)
                      , n = parseInt(i, 10);
                    return n === t
                }).value();
                n.each(i, function(t) {
                    var i = t.Name.substr(0, 2)
                      , a = parseInt(i, 10)
                      , s = e.getTextureAttribute(a, "Texture");
                    if (void 0 === s)
                        return void o.warn("missing texture");
                    c[a] = s;
                    var u = t.Name.substr(3);
                    if (n.includes(h, u) === !0) {
                        var l = parseFloat(t.Value);
                        "DiffuseColor" === u ? void 0 !== r.getChannels().DiffuseColor.getTexture() && void 0 === r.getChannels().DiffuseIntensity.getTexture() && (u = "DiffuseIntensity") : "Alpha" === u ? u = "Opacity" : "Translucency" === u ? (u = "Opacity",
                        l = 1 - l) : "Normal" === u ? u = "NormalMap" : "Bump" === u && (u = "BumpMap"),
                        d.setTextureFromBlender(r, u, a, s, l)
                    } else
                        "UsePremultiplyAlpha" === u ? o.warn("UsePremultiplyAlpha not supported") : "UseAlpha" === u ? o.warn("UseAlpha not supported") : o.warn("channel " + u + " not supported")
                })
            }),
            n.each(Object.keys(c), function(t) {
                if (void 0 !== c[t]) {
                    var i = t
                      , n = parseInt(i, 10);
                    e.removeTextureAttribute(n, "Texture")
                }
            }),
            "ksp" === s.source && (r.attributes.name.toLowerCase().indexOf("wheel") === -1 ? r.getChannels().MetalnessPBR.setFactor(1) : r.getChannels().SpecularF0.setFactor(0),
            r.attributes.name.toLowerCase().indexOf("fairing") !== -1 && r.getChannels().Opacity.setFactor(.25)),
            r.setStateSet(e)
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = i(215)
      , s = i(386)
      , o = i(387)
      , u = i(1531)
      , l = i(1464)
      , c = r.osg
      , h = function(t, e) {
        c.NodeVisitor.call(this, c.NodeVisitor.TRAVERSE_ALL_CHILDREN),
        this._lights = [],
        this._materials = [],
        this._materialManager = t,
        this._stateSetsProcessed = {},
        this._authoringTool = e,
        this._style = "",
        this._hasMetal = void 0,
        this._globalEnforceRoughness = void 0,
        this._dictionary = a.channelNames,
        this._dictionaryKeys = Object.keys(a.channelNames)
    };
    h.prototype = c.objectInherit(c.NodeVisitor.prototype, {
        getStyle: function() {
            return this._style
        },
        hasMetallicWorkflow: function() {
            return this._hasMetal
        },
        getLights: function() {
            return this._lights
        },
        getMaterials: function() {
            return this._materials
        },
        copyDiffuse: function(t) {
            var e = t.getChannels().DiffuseColor
              , i = t.getChannels().AlbedoPBR
              , n = t.getChannels().DiffusePBR
              , r = e.getColor()
              , a = e.getFactor()
              , s = e.getTexture();
            r && (i.setColor(r),
            n.setColor(r)),
            i.setFactor(a),
            n.setFactor(a),
            s && (i.setTexture(s),
            n.setTexture(s))
        },
        matchNameAgainstDict: function(t, e, i) {
            for (var n = o(t), r = 0; r < e.length; r++) {
                var a = e[r]
                  , u = s(n, a);
                if (u < i && u < a.length)
                    return !0
            }
            return !1
        },
        channelTextureExtract: function(t, e) {
            var i = t.getChannels()[e];
            if (i) {
                var n = i.getTexture();
                if (n)
                    return n.getImage().getName()
            }
        },
        channelTextureMatch: function(t, e, i, n) {
            var r = this.channelTextureExtract(t, e);
            return r && this.matchNameAgainstDict(r, i, n)
        },
        hasTextureChannel: function(t, e) {
            var i = this.channelTextureExtract(t, e);
            return void 0 !== i
        },
        channelTextureCopy: function(t, e, i) {
            var n, r = t.getChannels(), a = this.channelTextureExtract(t, e);
            if (a)
                for (var s = i.length; s--; )
                    n = r[i[s]],
                    n.setTexture(r[e].getTexture().clone())
        },
        checkPBRSlot: function(t) {
            if (t)
                for (var e = 0; e < this._dictionaryKeys.length; e++) {
                    var i = this._dictionaryKeys[e]
                      , n = this._dictionary[i];
                    if (this.matchNameAgainstDict(t, n, a.maxLevenshteinDistance))
                        return i
                }
        },
        assignPBRTextureFromFilenames: function(t, e) {
            t.forEach(function(t) {
                var i = t.getName()
                  , n = this.checkPBRSlot(i);
                if (void 0 === n && t.getImage() && (i = t.getImage().getURL(),
                n = this.checkPBRSlot(i)),
                void 0 !== n) {
                    var r, a = e.getChannels();
                    r = a[n],
                    void 0 === r.getTexture() && r.setTexture(this.createTextureModelFromTextureOSG(t))
                }
            }, this)
        },
        checkChannelsAndSetWorkFlowRoughGloss: function(t) {
            if (t) {
                var e = t.getChannels()
                  , i = this.hasTextureChannel(t, "GlossinessPBR")
                  , n = this.hasTextureChannel(t, "SpecularPBR")
                  , r = this.hasTextureChannel(t, "RoughnessPBR")
                  , a = this.hasTextureChannel(t, "BumpMap");
                a && e.BumpMap.setFactor(10),
                this.hasTextureChannel(t, "MetalnessPBR") && (this._hasMetal = !0),
                r && e.RoughnessPBR.setFactor(1),
                i && e.GlossinessPBR.setFactor(1),
                n && (e.SpecularPBR.setFactor(1),
                void 0 === this._hasMetal && (this._hasMetal = !1)),
                t.setWorkFlowRoughGloss(r || this._globalEnforceRoughness || !r && !i && void 0 === this._globalEnforceRoughness, !1)
            }
        },
        setChannelsFromImagesNames: function(t, e, i) {
            for (var n = 0, r = e.length; n < r; n++)
                for (var s = 0, o = i.length; s < o; s++) {
                    var l = i[s].get("name");
                    if (this.matchNameAgainstDict(l, this._dictionary[e[n]], a.maxLevenshteinDistance)) {
                        var c = t.getChannels()[e[n]];
                        c.setTexture(new u({
                            image: i[s]
                        })),
                        c.setFactor(1),
                        t.setChannelEnable(c.get("name"), !0)
                    }
                }
        },
        getPBRChannels: function(t) {
            var e = [];
            return n.each(t.getChannels(), function(t, i) {
                i.indexOf("PBR") !== -1 && e.push(i)
            }),
            e
        },
        checkForPBRTextureFromChannelsAndFilenames: function(t) {
            if (t) {
                for (var e = this.getPBRChannels(t), i = e.length; i--; )
                    if (void 0 !== this.channelTextureExtract(t, e[i]))
                        return;
                this.channelTextureCopy(t, "DiffuseColor", ["AlbedoPBR", "DiffusePBR"]),
                this.channelTextureCopy(t, "DiffuseIntensity", ["AOPBR"]);
                var n = this._dictionary;
                this.channelTextureMatch(t, "SpecularColor", n.MetalnessPBR, 2) ? this.channelTextureCopy(t, "SpecularColor", ["MetalnessPBR"]) : this.channelTextureMatch(t, "SpecularHardness", n.MetalnessPBR, 2) ? this.channelTextureCopy(t, "SpecularHardness", ["MetalnessPBR"]) : this.channelTextureMatch(t, "SpecularColor", n.SpecularPBR, 2) ? this.channelTextureCopy(t, "SpecularColor", ["SpecularPBR"]) : this.channelTextureMatch(t, "SpecularHardness", n.SpecularPBR, 2) && this.channelTextureCopy(t, "SpecularHardness", ["SpecularPBR"]),
                this.channelTextureMatch(t, "SpecularColor", n.RoughnessPBR, 2) ? this.channelTextureCopy(t, "SpecularColor", ["RoughnessPBR"]) : this.channelTextureMatch(t, "SpecularHardness", n.RoughnessPBR, 2) ? this.channelTextureCopy(t, "SpecularHardness", ["RoughnessPBR"]) : this.channelTextureMatch(t, "SpecularColor", n.GlossinessPBR, 2) ? this.channelTextureCopy(t, "SpecularColor", ["GlossinessPBR"]) : this.channelTextureMatch(t, "SpecularHardness", n.GlossinessPBR, 2) && this.channelTextureCopy(t, "SpecularHardness", ["GlossinessPBR"])
            }
        },
        checkForPBRTextureFromMaterialAndFilenames: function(t) {
            if (t) {
                var e = []
                  , i = this;
                n.each(t.getChannels(), function(n, r) {
                    i.channelTextureExtract(t, r) || e.push(r)
                });
                for (var r = [], a = this._materialManager.getImageCollection(), s = t.get("name").toLowerCase(), o = 0; o < a.length; o++)
                    a.models[o].get("name").toLowerCase().indexOf(s) !== -1 && r.push(a.models[o]);
                this.setChannelsFromImagesNames(t, e, r)
            }
        },
        hasMaterialAttributes: function(t) {
            return t.getAttribute("Material")
        },
        processDefaultMaterial: function(t, e) {
            e.removeAttribute("Material");
            for (var i = 0, n = e.getNumTextureAttributeLists(); i < n; i++)
                e.removeTextureAttribute(i, "Texture")
        },
        convertUserDataToObject: function(t) {
            var e = {};
            return t ? (t.forEach(function(t) {
                var i = t.Name
                  , n = t.Value;
                e[i] = n
            }),
            e) : e
        },
        getMetaData: function(t) {
            if (t && t.getUserData())
                return this.convertUserDataToObject(t.getUserData())
        },
        getTextureLists: function(t) {
            for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                var n = t.getTextureAttribute(i, "Texture");
                void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                e[i] = n)
            }
            return e
        },
        setMaterialChannelTexture: function(t, e, i, n, r) {
            t.removeTextureAttribute(i, "Texture");
            var a = e.getChannels()[n];
            a.setTexture(r),
            a.resetTextureFormat(),
            a.setTexCoordUnit(i),
            a.setEnable(!0)
        },
        createMaterial: function(t, e) {
            var i = this._materialManager.createMaterial(t, e);
            return this._materials.push(i),
            i
        },
        createTextureModelFromTextureOSG: function(t) {
            var e = l.getOptions(t)
              , i = t.getImage()
              , r = i.getURL()
              , a = this._materialManager.getImageCollection()
              , s = a.getImageFromURL(r);
            return s ? new u(n.extend(e, {
                image: s
            })) : void c.error("SceneProcessorVisitor.createTextureModelFromTextureOSG can't find image " + r + " image collections")
        },
        mapTexturesOnMaterial: function(t, e) {
            for (var i = this.getTextureLists(t), n = t.getNumTextureAttributeLists(), r = function(t, e, i, n, r) {
                if (void 0 !== n) {
                    var a = this.createTextureModelFromTextureOSG(n);
                    this.setMaterialChannelTexture(t, e, i, r, a)
                }
            }
            .bind(this), a = 0, s = n; a < s; a++) {
                var o = a
                  , u = t.getTextureAttribute(a, "Texture");
                void 0 !== u && (1 === n ? r(t, e, o, i[o], "DiffuseColor") : n >= 2 && (0 === o ? r(t, e, o, i[o], "EmitColor") : 1 === o ? r(t, e, o, i[o], "DiffuseColor") : 2 === o && r(t, e, o, i[o], "SpecularColor")))
            }
        },
        postApply: function() {},
        applyExistingMaterial: function(t, e) {
            if (t) {
                var i = t.getInstanceID()
                  , n = this._stateSetsProcessed[i];
                this._stateSetsProcessed[i] = !0;
                var r = this._materialManager.getMaterialByStateSet(t);
                if (r)
                    return n === !0 ? r : (r.set("name", this._materialManager.getUniqueMaterialName(t.getAttributeMap().Material, t, e)),
                    r.setStateSet(t),
                    this._materials.push(r),
                    r)
            }
        },
        processLightSource: function() {},
        removeDuplicateTexCoordUnit: function(t, e) {
            if (e instanceof c.Geometry != !1 && t) {
                var i = t.get("texCoordUnitList");
                if (1 !== i.length) {
                    var r = "TexCoord"
                      , a = e.getVertexAttributeList();
                    i.sort();
                    for (var s = !0, o = [], u = [], l = i.length - 1; l >= 0; --l) {
                        for (var h = i[l], d = a[r + h], p = 0; p < l; ++p)
                            if (d === a[r + i[p]]) {
                                s = !1;
                                break
                            }
                        var f = i[p];
                        o[h] = f,
                        u.push(f)
                    }
                    s || (t.set("texCoordUnitList", n.uniq(u)),
                    n.each(t.getChannels(), function(t) {
                        var e = t.getTexCoordUnit();
                        void 0 !== e && t.setTexCoordUnit(o[e])
                    }))
                }
            }
        },
        apply: function(t) {
            t.typeID === c.LightSource.typeID && this.processLightSource(t);
            var e = t.getStateSet();
            if (e) {
                var i = this.applyExistingMaterial(e, t);
                if (!i) {
                    var n = this.getMetaData(e);
                    n ? this.processMaterial(t, e, n) : this.hasMaterialAttributes(e) && this.processDefaultMaterial(t, e),
                    i = this._materialManager.getMaterialByStateSet(e),
                    this.checkForPBRTextureFromChannelsAndFilenames(i),
                    this._materialManager.getImageCollection().length && (this.checkForPBRTextureFromMaterialAndFilenames(i),
                    this.checkChannelsAndSetWorkFlowRoughGloss(i))
                }
                this.removeDuplicateTexCoordUnit(i, t)
            }
            this.traverse(t)
        }
    }),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = i(238)
      , s = i(1464)
      , o = i(1197)
      , u = r.osg
      , l = n.invert(u.Texture)
      , c = ["magFilter", "minFilter", "wrapS", "wrapT", "textureTarget", "internalFormat"]
      , h = a.extend({
        initialize: function() {
            if (a.prototype.initialize.apply(this, arguments),
            !this.attributes.image)
                return void u.error("no image found in attributes, TextureModel invalid");
            var t = s.createValidOptionsForMaterial(this.attributes);
            this.set(t),
            this.setTextureProxyFromValidOptions(t),
            this.bind("change:image", this.updateTextureProxy, this)
        },
        getImage: function() {
            return this.get("image")
        },
        setImage: function(t) {
            this.set("image", t)
        },
        getResourceManager: function() {
            return this._resourceManager || o.instance
        },
        getTextureProxy: function() {
            return this.get("textureProxy")
        },
        getURL: function() {
            console.trace("dont call TextureModel.getURL")
        },
        setTextureProxyFromValidOptions: function(t) {
            var e = this.get("image").getUID()
              , i = this.getResourceManager().getOrCreateTextureProxy(e, t);
            i && this.set("textureProxy", i.resource)
        },
        updateTextureProxy: function() {
            this.setTextureProxyFromValidOptions(s.createValidOptionsForMaterial(this.attributes))
        },
        getUID: function() {
            return this.getImage().getUID()
        },
        getJSON: function() {
            for (var t = {}, e = 0, i = c.length; e < i; ++e) {
                var n = c[e];
                t[n] = l[this.get(n)]
            }
            return t.texCoordUnit = this.get("texCoordUnit"),
            t.uid = this.getUID(),
            t
        }
    });
    h.createFromTexture = function() {
        console.error("dont call TextureModel.createFromTexture")
    }
    ,
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = function() {
        r.Light.apply(this, arguments)
    };
    a.prototype = r.objectLibraryClass(r.objectInherit(r.Light.prototype, {
        attributeType: "SketchfabLight"
    }), "osgSketchfab", "Light");
    var s = r.Vec3.create();
    r.LightSource.prototype.computeBoundingSphere = function(t) {
        if (r.Node.prototype.computeBoundingSphere.call(this, t),
        !t.valid())
            return t;
        if (void 0 !== this._light && this._referenceFrame === r.Transform.RELATIVE_RF) {
            var e = this._light.getPosition();
            0 !== e[3] && t.expandByVec3(r.Vec3.mult(e, 1 / e[3], s))
        }
        return t
    }
    ,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1530)
      , a = n.osg
      , s = function() {
        r.apply(this, arguments)
    };
    s.prototype = a.objectInherit(r.prototype, {
        processMaterial: function(t, e, i) {
            var n, r = this.createMaterial(t, e), a = ["lambert", "blinn", "phong"], s = function(t, e, n) {
                for (var r = a.length, s = "_" + t + "_" + e; r--; )
                    if (void 0 !== i[a[r] + s]) {
                        var o = i[a[r] + s];
                        return n ? o : JSON.parse(o)
                    }
            }, o = "color";
            n = s("emission", o),
            void 0 !== n && (r.setChannelColor("EmitColor", n),
            r.setChannelEnable("EmitColor", !0)),
            n = s("diffuse", o),
            void 0 !== n && (r.setChannelColor("DiffuseColor", n),
            r.setChannelEnable("DiffuseColor", !0)),
            n = s("specular", o),
            void 0 !== n && (r.setChannelColor("SpecularColor", n),
            r.setChannelEnable("SpecularColor", !0)),
            o = "amount",
            n = s("shininess", o),
            void 0 !== n && (r.setChannelFactor("SpecularHardness", 128 * n),
            r.setChannelEnable("SpecularHardness", !0));
            var u = 1;
            n = s("transparency", "amount"),
            void 0 !== n && (u = n),
            r.setChannelFactor("Opacity", u),
            r.setChannelEnable("Opacity", !0),
            e.removeAttribute("Material");
            var l, c, h = [];
            !function() {
                for (var t = 0; t < e.getNumTextureAttributeLists(); t++) {
                    var i = e.getTextureAttribute(t, "Texture");
                    void 0 !== i && ("TextureMaterial" === i.className() && (i = i.getTexture()),
                    h[t] = i)
                }
            }();
            var d = function(t, i, n) {
                e.removeTextureAttribute(t, "Texture");
                var a = r.getChannels()[n];
                a.setTexture(this.createTextureModelFromTextureOSG(i)),
                a.resetTextureFormat(),
                a.setTexCoordUnit(t),
                a.setEnable(!0)
            }
            .bind(this);
            if (o = "unit",
            n = s("emissive", o),
            void 0 !== n && (l = n,
            c = h[l],
            void 0 !== c && d(l, c, "EmitColor")),
            n = s("diffuse", o),
            void 0 !== n && (l = n,
            c = h[l],
            void 0 !== c && d(l, c, "DiffuseColor")),
            n = s("specular", o),
            void 0 !== n && (l = n,
            c = h[l],
            void 0 !== c && d(l, c, "SpecularColor")),
            void 0 !== i.extra_shininess_unit && (l = JSON.parse(i.extra_shininess_unit),
            c = h[l],
            void 0 !== c && d(l, c, "SpecularColor")),
            n = s("transparency", o),
            void 0 !== n && (l = n,
            c = h[l],
            void 0 !== c)) {
                var p = s("transparency", "alphamask");
                p ? (d(l, c, "Opacity"),
                c = r.getChannels().Opacity.getTexture(),
                r.getChannels().Opacity.setTransparency("alphaMask")) : (d(l, c, "Opacity"),
                c = r.getChannels().Opacity.getTexture(),
                r.getChannels().Opacity.setTransparency("alphaBlend"))
            }
            void 0 !== i.extra_bump_unit && (l = JSON.parse(i.extra_bump_unit),
            c = h[l],
            void 0 !== c && d(l, c, "BumpMap"),
            i.extra_bump_amount && (n = JSON.parse(i.extra_bump_amount),
            r.setChannelFactor("BumpMap", n))),
            void 0 !== i.extra_normal_unit && (l = JSON.parse(i.extra_normal_unit),
            c = h[l],
            void 0 !== c && d(l, c, "NormalMap"),
            i.extra_normal_amount && (n = JSON.parse(i.extra_normal_amount),
            r.setChannelFactor("NormalMap", n))),
            e.removeAttribute("Material"),
            r.setStateSet(e)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1530)
      , a = n.osg
      , s = function() {
        r.apply(this, arguments)
    };
    s.prototype = a.objectInherit(r.prototype, {
        processMaterial: function(t, e) {
            return this.processDefaultMaterial(t, e)
        },
        processDefaultMaterial: function(t, e) {
            var i = this.createMaterial(t, e)
              , n = e.getAttribute("Material");
            return void 0 !== n && (i.setChannelColor("EmitColor", n.getAmbient()),
            i.setChannelColor("DiffuseColor", n.getDiffuse()),
            i.setChannelColor("SpecularColor", n.getSpecular()),
            i.setChannelFactor("SpecularHardness", n.getShininess()),
            i.setChannelFactor("Opacity", n.getDiffuse()[3]),
            i.setChannelEnable("EmitColor", !0),
            i.setChannelEnable("DiffuseColor", !0),
            i.setChannelEnable("SpecularColor", !0),
            i.setChannelEnable("SpecularHardness", !0),
            i.setChannelEnable("Opacity", !0),
            e.removeAttribute("Material")),
            this.mapTexturesOnMaterial(e, i),
            i.setStateSet(e),
            i
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = i(1530)
      , s = i(1532)
      , o = r.osg
      , u = function() {
        a.apply(this, arguments)
    };
    u.prototype = o.objectInherit(a.prototype, {
        setChannelsFromMetaData: function(t, e, i, r) {
            n.each(r, function(n, r) {
                if (void 0 !== t[r]) {
                    var a = JSON.parse(t[r]);
                    e[i](n, a),
                    e.setChannelEnable(n, !0)
                }
            })
        },
        setMaterialChannelTexture: function(t, e, i, n, r) {
            t.removeTextureAttribute(i, "Texture");
            var a = e.getChannels()[r];
            a.setTexture(this.createTextureModelFromTextureOSG(n)),
            a.resetTextureFormat(),
            a.setTexCoordUnit(i),
            a.setFactor(1),
            a.setEnable(!0)
        },
        getReferencedTextures: function(t) {
            for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                var n = t.getTextureAttribute(i, "Texture");
                void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                e[i] = n)
            }
            return e
        },
        processLightSource: function(t) {
            var e = t.getLight();
            if (e) {
                var i = e.getUserData();
                if (void 0 !== i && e.typeID !== s.typeID) {
                    var n = this.convertUserDataToObject(i)
                      , r = new s;
                    if ("directional" === n.Type)
                        r.setLightType("DIRECTION");
                    else if ("point" === n.Type)
                        r.setLightType("POINT");
                    else {
                        if ("spot" !== n.Type)
                            return;
                        r.setLightType("SPOT")
                    }
                    if ("spot" === n.Type) {
                        r.setSpotCutoff(JSON.parse(n.OuterAngle) / 2);
                        var a = JSON.parse(n.InnerAngle) / JSON.parse(n.OuterAngle);
                        r.setSpotBlend(a !== a || Math.abs(a) === 1 / 0 ? .5 : Math.min(a, 1))
                    }
                    o.Vec3.mult(JSON.parse(n.Color), JSON.parse(n.Intensity) / 100, r.getDiffuse());
                    var u = 1 / JSON.parse(n.DecayStart);
                    r.setQuadraticAttenuation(Math.abs(u) === 1 / 0 ? 0 : u),
                    r._node = t,
                    this._lights.push(r)
                }
            }
        },
        processMaterial: function(t, e, i) {
            var r = this.createMaterial(t, e)
              , a = {
                LambertDiffuseColor: "DiffuseColor",
                LambertEmissiveColor: "EmitColor",
                PhongSpecularColor: "SpecularColor"
            }
              , s = {
                sDiffuse: "DiffuseColor",
                sNormalMap: "NormalMap",
                sBump: "BumpMap",
                sEmissive: "EmitColor",
                sSpecular: "SpecularColor",
                sOpacity: "Opacity",
                sAo: "AOPBR",
                sRoughness: "RoughnessPBR",
                sMetallic: "MetalnessPBR"
            }
              , u = {
                LambertDiffuseFactor: "DiffuseColor",
                LambertBumpFactor: "BumpMap",
                LambertEmissiveFactor: "EmitColor",
                PhongSpecularFactor: "SpecularColor",
                PhongShininess: "SpecularHardness"
            };
            this.setChannelsFromMetaData(i, r, "setChannelColor", a),
            this.setChannelsFromMetaData(i, r, "setChannelFactor", u),
            e.removeAttribute("Material");
            var l = this.getReferencedTextures(e);
            if (n.each(s, function(t, n) {
                if (void 0 !== i[n]) {
                    var a = JSON.parse(i[n])
                      , s = l[a];
                    void 0 !== s && this.setMaterialChannelTexture(e, r, a, s, t)
                }
            }
            .bind(this)),
            i.LambertBumpFactor && !i.sBump && r.getChannels().BumpMap.setEnable(!1),
            "Tilt Brush" === this._authoringTool) {
                var c = r.getChannels()
                  , h = c.EmitColor;
                h.set("type", "multiplicative"),
                h.getTexture() || 0 === h.getColor()[0] && 0 === h.getColor()[1] && 0 === h.getColor()[2] && h.setColor(o.Vec3.createAndSet(1, 1, 1)),
                c.SpecularF0.setFactor(0),
                c.RoughnessPBR.setFactor(1);
                var d = i.BlendMode;
                "AlphaMask" === d ? (c.Opacity.setFactor(i.LambertTransparencyFactor || 0),
                c.Opacity.setTransparency("alphaMask")) : "AdditiveBlend" === d ? (c.Opacity.setFactor(1 - (i.LambertTransparencyFactor || 0)),
                c.Opacity.setTransparency("additive")) : c.Opacity.setEnable(!1)
            }
            r.setStateSet(e)
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1530)
      , a = n.osg
      , s = function() {
        r.apply(this, arguments)
    };
    s.prototype = a.objectInherit(r.prototype, {
        processMaterial: function(t, e, i) {
            var n, r, s = this.createMaterial(t, e), o = function(t) {
                for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                    var n = t.getTextureAttribute(i, "Texture");
                    void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                    e[i] = n)
                }
                return e
            }(e), u = function(t, e, i, n) {
                t.removeTextureAttribute(e, "Texture");
                var r = s.getChannels()[n];
                r.setTexture(this.createTextureModelFromTextureOSG(i)),
                r.resetTextureFormat(),
                r.setTexCoordUnit(0),
                r.setEnable(!0)
            }
            .bind(this);
            void 0 !== i.diffuse && (n = JSON.parse(i.diffuse),
            r = o[n],
            void 0 !== r && u(e, n, r, "DiffuseColor")),
            void 0 !== i.specular && (n = JSON.parse(i.specular),
            r = o[n],
            void 0 !== r && u(e, n, r, "SpecularColor")),
            void 0 !== i.transparency && (n = JSON.parse(i.transparency),
            r = o[n],
            void 0 !== r && (u(e, n, r, "Opacity"),
            e.setRenderingHint("TRANSPARENT_BIN"),
            e.setTextureAttributeAndModes(n, r),
            e.setAttributeAndModes(new a.BlendFunc("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")))),
            e.removeAttribute("Material"),
            s.setStateSet(e)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1530)
      , a = i(1538)
      , s = i(1532)
      , o = n.osg
      , u = function() {
        r.apply(this, arguments)
    };
    u.prototype = o.objectInherit(a.prototype, {
        isSelfIlluminationSurface: function(t) {
            if (!t.length)
                return !1;
            var e = t[0]
              , i = e.getImage().getURL().split("/").pop().split(".").shift();
            return !!(i.match("carrot_crop_(.*)") || i.match("crops_(.*)") || "fern" === i || "dead_shrub" === i || "flower_red" === i || "flower_yellow" === i || "lilypad" === i || "mushroom_brown" === i || "mushroom_red" === i || i.match("netherwart_(.*)") || i.match("potato_crop_(.*)") || i.match("sapling_(.*)") || "tall_grass" === i || "torch" === i || "torch_flame" === i)
        },
        getReferencedTextures: function(t) {
            for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                var n = t.getTextureAttribute(i, "Texture");
                void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                e[i] = n)
            }
            return e
        },
        setMaterialChannelTexture: function(t, e, i, n, r, a, s) {
            t.removeTextureAttribute(i, "Texture");
            var u = e.getChannels()[r]
              , l = this.createTextureModelFromTextureOSG(n);
            l.set("wrapT", o.Texture[a]),
            l.set("wrapS", o.Texture[a]),
            s && (l.set("minFilter", o.Texture.NEAREST_MIPMAP_LINEAR),
            l.set("magFilter", o.Texture.NEAREST),
            l.updateTextureProxy()),
            u.setTexture(l),
            u.resetTextureFormat(),
            u.setTexCoordUnit(0),
            u.setEnable(!0)
        },
        processMaterial: function(t, e, i) {
            var n = this.createMaterial(t, e)
              , r = {
                kd: "DiffuseColor"
            }
              , a = {
                tr: "Opacity",
                d: "Opacity"
            };
            this.setChannelsFromMetaData(i, n, "setChannelColor", r),
            this.setChannelsFromMetaData(i, n, "setChannelFactor", a),
            void 0 !== i.ka && (n.setChannelFactor("EmitColor", .1),
            n.setChannelEnable("EmitColor", !0)),
            n.setChannelColor("SpecularColor", o.Vec3.create()),
            n.setChannelEnable("SpecularColor", !0),
            n.setChannelFactor("SpecularHardness", 1),
            n.setChannelEnable("SpecularHardness", !0),
            this.verifyOpacity(n),
            e.removeAttribute("Material");
            var u, l, c = "mineways" === i.source, h = this.getReferencedTextures(e), d = this.isSelfIlluminationSurface(h), p = d ? "CLAMP_TO_EDGE" : "REPEAT";
            if (void 0 !== i.map_kd && (u = JSON.parse(i.map_kd),
            l = h[u],
            void 0 !== l && this.setMaterialChannelTexture(e, n, u, l, "DiffuseColor", p, c)),
            d || (void 0 !== i.map_ke ? (u = JSON.parse(i.map_ke),
            l = h[u],
            void 0 !== l && (this.setMaterialChannelTexture(e, n, u, l, "EmitColor", p, c),
            n.setChannelFactor("EmitColor", 1))) : void 0 !== i.map_ka ? (u = JSON.parse(i.map_ka),
            l = h[u],
            void 0 !== l && this.setMaterialChannelTexture(e, n, u, l, "EmitColor", p, c)) : (u = JSON.parse(i.map_kd),
            l = h[u],
            void 0 !== l && (this.setMaterialChannelTexture(e, n, u, l, "EmitColor", p, c),
            n.setChannelFactor("EmitColor", .1)))),
            d && (n.set("shadeless", !0),
            n.setChannelFactor("EmitColor", 0),
            n.setChannelEnable("EmitColor", !0)),
            void 0 !== i.map_d && (u = JSON.parse(i.map_d),
            l = h[u],
            void 0 !== l)) {
                this.setMaterialChannelTexture(e, n, u, l, "Opacity", p, c);
                var f = n.getChannels().Opacity;
                c ? (f.getTexture().set("internalFormat", o.Texture.ALPHA),
                n.attributes.name.toLowerCase().indexOf("leaves") !== -1 && (f.setTransparency("alphaMask"),
                n.setChannelFactor("Opacity", .2))) : (f.getTexture().set("internalFormat", o.Texture.LUMINANCE),
                f.setTransparency("alphaBlend")),
                n.set("cullFace", o.CullFace.BACK)
            }
            if (n.setChannelFactor("RoughnessPBR", 1),
            n.setChannelFactor("SpecularF0", 0),
            e.removeAttribute("Material"),
            n.setStateSet(e),
            !this._lights.length) {
                var g = new o.MatrixTransform;
                o.Matrix.makeRotate(Math.PI / 6, 1, 1, 0, g.getMatrix());
                var m = new s;
                m.setLightType("DIRECTION"),
                o.Vec3.set(1, 1, 1, m.getDiffuse()),
                m._node = g,
                this._lights.push(m)
            }
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = i(1530)
      , s = r.osg
      , o = function() {
        a.apply(this, arguments)
    };
    o.prototype = s.objectInherit(a.prototype, {
        verifyOpacity: function(t) {
            var e = t.getChannels().Opacity.getFactor();
            e < .001 && (e = 1),
            t.setChannelFactor("Opacity", e)
        },
        setChannelsFromMetaData: function(t, e, i, r) {
            n.each(r, function(n, r) {
                if (void 0 !== t[r]) {
                    var a = JSON.parse(t[r]);
                    e[i](n, a),
                    e.setChannelEnable(n, !0)
                }
            })
        },
        processMaterial: function(t, e, i) {
            var n = this.createMaterial(t, e)
              , r = {
                kd: "DiffuseColor",
                ka: "EmitColor",
                ks: "SpecularColor"
            }
              , a = {
                ns: "SpecularHardness",
                tr: "Opacity",
                d: "Opacity"
            };
            this.setChannelsFromMetaData(i, n, "setChannelColor", r),
            this.setChannelsFromMetaData(i, n, "setChannelFactor", a),
            this.verifyOpacity(n),
            e.removeAttribute("Material");
            var s, o, u = function(t) {
                for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                    var n = t.getTextureAttribute(i, "Texture");
                    void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                    e[i] = n)
                }
                return e
            }(e), l = function(t, e, i, r) {
                t.removeTextureAttribute(e, "Texture");
                var a = n.getChannels()[r];
                a.setTexture(this.createTextureModelFromTextureOSG(i)),
                a.resetTextureFormat(),
                a.setTexCoordUnit(0),
                a.setEnable(!0)
            }
            .bind(this);
            void 0 !== i.map_ka && (s = JSON.parse(i.map_ka),
            o = u[s],
            void 0 !== o && l(e, s, o, "EmitColor")),
            void 0 !== i.map_kd && (s = JSON.parse(i.map_kd),
            o = u[s],
            void 0 !== o && l(e, s, o, "DiffuseColor")),
            void 0 !== i.map_occlusion && (s = JSON.parse(i.map_occlusion),
            o = u[s],
            void 0 !== o && l(e, s, o, "DiffuseIntensity")),
            void 0 !== i.map_d && (s = JSON.parse(i.map_d),
            o = u[s],
            void 0 !== o && (l(e, s, o, "Opacity"),
            n.getChannels().Opacity.setTransparency("alphaBlend"))),
            void 0 !== i.map_ks && (s = JSON.parse(i.map_ks),
            o = u[s],
            void 0 !== o && l(e, s, o, "SpecularColor")),
            void 0 !== i.map_ns && (s = JSON.parse(i.map_ns),
            o = u[s],
            void 0 !== o && l(e, s, o, "SpecularHardness")),
            void 0 !== i.map_normal && (s = JSON.parse(i.map_normal),
            o = u[s],
            void 0 !== o && l(e, s, o, "NormalMap")),
            void 0 !== i.bump && (s = JSON.parse(i.bump),
            o = u[s],
            void 0 !== o && l(e, s, o, "BumpMap")),
            n.setStateSet(e)
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(216)
      , a = i(1530)
      , s = n.osg
      , o = function() {
        a.apply(this, arguments)
    };
    o.prototype = s.objectInherit(a.prototype, {
        setChannelsFromMetaData: function(t, e, i, n) {
            r.each(n, function(n, r) {
                if (void 0 !== t[r]) {
                    var a = JSON.parse(t[r]);
                    e[i](n, a),
                    e.setChannelEnable(n, !0),
                    "MetalnessPBR" === n && (this._hasMetal = !0),
                    "SpecularPBR" === n && void 0 === this._hasMetal ? (e.setChannelFactor(n, 1),
                    this._hasMetal = !1) : "EmitColor" === n ? e.setChannelFactor(n, 1) : "GlossinessPBR" === n && void 0 === this._globalEnforceRoughness ? this._globalEnforceRoughness = !1 : "RoughnessPBR" === n && (this._globalEnforceRoughness = !0)
                }
            }
            .bind(this))
        },
        setMaterialChannelTexture: function(t, e, i, n, r) {
            t.removeTextureAttribute(i, "Texture");
            var a = e.getChannels()[r]
              , s = this.createTextureModelFromTextureOSG(n);
            a.setTexture(s),
            a.resetTextureFormat(),
            a.setTexCoordUnit(i),
            a.setFactor(1),
            a.setEnable(!0),
            "AOPBR" === r && (a.set("occludeSpecular", !0),
            a = e.getChannels().CavityPBR,
            a.setTexture(this.createTextureModelFromTextureOSG(n)),
            a.resetTextureFormat(),
            a.setTexCoordUnit(i),
            a.setFactor(1),
            a.setEnable(!0))
        },
        getReferencedTextures: function(t) {
            for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                var n = t.getTextureAttribute(i, "Texture");
                void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                e[i] = n)
            }
            return e
        },
        processMaterial: function(t, e, i) {
            var n = this.createMaterial(t, e);
            e.removeAttribute("Material");
            var a = {
                DiffuseFactor: "DiffuseColor",
                SpecularPBRFactor: "SpecularPBR",
                EmissiveFactor: "EmitColor"
            }
              , o = {
                MetallicFactor: "MetalnessPBR",
                RoughnessFactor: "RoughnessPBR",
                GlossinessPBRFactor: "GlossinessPBR"
            }
              , u = {
                sDiffuse: "DiffuseColor",
                sMetallic: "MetalnessPBR",
                sRoughness: "RoughnessPBR",
                sSpecularPBR: "SpecularPBR",
                sGlossinessPBR: "GlossinessPBR",
                sNormalMap: "NormalMap",
                sBump: "BumpMap",
                sEmissive: "EmitColor",
                sAO: "AOPBR"
            }
              , l = this.getReferencedTextures(e);
            if (this.setChannelsFromMetaData(i, n, "setChannelColor", a),
            this.setChannelsFromMetaData(i, n, "setChannelFactor", o),
            r.each(u, function(t, r) {
                if (void 0 !== i[r]) {
                    var a = JSON.parse(i[r])
                      , s = l[a];
                    void 0 !== s && this.setMaterialChannelTexture(e, n, a, s, t)
                }
            }
            .bind(this)),
            this.hasTextureChannel(n, "DiffuseColor") && void 0 !== i.blendMode) {
                var c = n.getChannels().Opacity
                  , h = n.getChannels().DiffuseColor.getTexture().clone();
                h.set("internalFormat", s.Texture.ALPHA),
                h.updateTextureProxy(),
                c.setTexture(h),
                c.setTexCoordUnit(n.getChannels().DiffuseColor.getTexCoordUnit()),
                "alphaBlend" === i.blendMode ? c.setFactor(1) : "alphaMask" === i.blendMode && (c.setTransparency("alphaMask"),
                c.setFactor(i.cutoff || 0))
            }
            n.getChannels().NormalMap.set("flipY", void 0 !== i.yUp && JSON.parse(i.yUp) === !1),
            this._authoringTool.toLowerCase().indexOf("unity") !== -1 && n.set("cullFace", s.CullFace.BACK),
            this.copyDiffuse(n),
            n.setStateSet(e)
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = function() {
        r.NodeVisitor.call(this, r.NodeVisitor.TRAVERSE_ALL_CHILDREN),
        this._paths = [],
        this._pathsStateSet = [],
        this._currentStateSet = [],
        this._stateSetMap = {},
        this._stateSetMapNodes = {},
        this._wireframePaths = [],
        this._noGeometryPaths = [],
        this.nodeMaskOverride = -1
    };
    a.prototype = r.objectInherit(r.NodeVisitor.prototype, {
        getPathList: function() {
            return this._paths
        },
        getStateSetMap: function() {
            return this._stateSetMap
        },
        getStateSetMapNodes: function() {
            return this._stateSetMapNodes
        },
        getStateSetPathList: function() {
            return this._pathsStateSet
        },
        getWireframePathList: function() {
            return this._wireframePaths
        },
        getNoGeometryPathList: function() {
            return this._noGeometryPaths
        },
        apply: function(t) {
            var e = t.getStateSet();
            if (e) {
                var i = e._uniqueID;
                this._stateSetMap[i] ? this._stateSetMapNodes[i].push(t) : (this._stateSetMap[i] = e,
                this._stateSetMapNodes[i] = []),
                this._currentStateSet.push(e)
            }
            t instanceof r.Geometry ? t.userDataMap && t.userDataMap.wireframe ? this._wireframePaths.push(this.nodePath.slice(0)) : (this._pathsStateSet.push(this._currentStateSet.slice(0)),
            this._paths.push(this.nodePath.slice(0))) : (this.traverse(t),
            0 === t.getChildren().length && this._noGeometryPaths.push(this.nodePath.slice(0))),
            e && this._currentStateSet.pop()
        }
    }),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = function(t) {
        r.NodeVisitor.call(this, r.NodeVisitor.TRAVERSE_ALL_CHILDREN),
        this.stateSetStack = [],
        this.countGeometryStack = {},
        this.removedStateSet = [],
        this.keepedStateSet = [],
        this.deep = 0,
        this.materialRootList = t || {}
    };
    a.prototype = r.objectInherit(r.NodeVisitor.prototype, {
        getCurrentStateSet: function() {
            return this.stateSetStack[this.stateSetStack.length - 1]
        },
        getCurrentGeometryCount: function() {
            return void 0 === this.countGeometryStack[this.getCurrentStateSet().getInstanceID()] && (this.countGeometryStack[this.getCurrentStateSet().getInstanceID()] = 0),
            this.countGeometryStack[this.getCurrentStateSet().getInstanceID()]
        },
        setCurrentGeometryCount: function(t) {
            this.countGeometryStack[this.getCurrentStateSet().getInstanceID()] = t
        },
        updateStateSetGeometryCount: function(t) {
            var e = this.getCurrentGeometryCount();
            e += t,
            this.setCurrentGeometryCount(e)
        },
        logTree: function(t, e) {
            for (var i = ""; t--; )
                i += "    ";
            r.log(i + e)
        },
        apply: function(t) {
            var e = t.getStateSet();
            if (e && (this.stateSetStack.push(e),
            this.deep++,
            this.logTree(this.deep, e._uniqueID + " >>>")),
            this.traverse(t),
            t instanceof r.Geometry && (this.updateStateSetGeometryCount(1),
            this.logTree(this.deep, " Geom")),
            e) {
                if (this.logTree(this.deep, e._uniqueID + " <<< geom children num " + this.getCurrentGeometryCount()),
                0 === this.getCurrentGeometryCount())
                    this.removedStateSet.push(e._uniqueID);
                else {
                    var i = !0
                      , n = e._uniqueID
                      , a = this.stateSetStack.length;
                    if (a-- > 1)
                        for (; a-- > 0; ) {
                            var s = this.stateSetStack[a]
                              , o = this.materialRootList[s._uniqueID];
                            if (o && o.rootMaterialToKeep)
                                if (2 === this.materialRootList.size) {
                                    var u = this.materialRootList[n];
                                    if (u)
                                        for (var l in o.attributes.channels)
                                            o.attributes.channels[l].attributes.texture && (u.attributes.channels[l].attributes.texture = o.attributes.channels[l].attributes.texture)
                                } else
                                    o.rootMaterialDidOverride = !0,
                                    e._uniqueID = o.attributes.stateSetID,
                                    i = !1,
                                    this.keepedStateSet.push(o.attributes.stateSetID)
                        }
                    i ? this.keepedStateSet.push(n) : this.removedStateSet.push(n)
                }
                this.stateSetStack.pop(),
                this.deep--
            }
        }
    }),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1543)
      , a = n.osg
      , s = ["Displacement", "Opacity", "DiffuseColor", "DiffusePBR", "AlbedoPBR", "SpecularColor", "DiffuseIntensity", "SpecularPBR", "MetalnessPBR", "GlossinessPBR", "RoughnessPBR", "NormalMap", "BumpMap", "AOPBR", "EmitColor", "CavityPBR", "SpecularHardness", "SpecularF0"]
      , o = function(t) {
        switch (t) {
        case "Opacity":
        case "Displacement":
            return r.LIT | r.SHADELESS | r.MATCAP;
        case "EmitColor":
            return r.LIT | r.SHADELESS;
        case "NormalMap":
        case "BumpMap":
            return r.LIT | r.MATCAP;
        case "DiffusePBR":
        case "AlbedoPBR":
        case "AOPBR":
        case "CavityPBR":
            return r.PBR;
        case "SpecularPBR":
        case "MetalnessPBR":
        case "GlossinessPBR":
        case "RoughnessPBR":
        case "SpecularF0":
            return r.PBR_LIT;
        case "DiffuseColor":
        case "DiffuseIntensity":
            return r.CLASSIC;
        case "SpecularColor":
        case "SpecularHardness":
            return r.CLASSIC_LIT
        }
    }
      , u = function(t) {
        switch (t) {
        case "DiffuseColor":
        case "DiffusePBR":
        case "AlbedoPBR":
        case "EmitColor":
        case "SpecularColor":
        case "SpecularPBR":
            return !0;
        default:
            return !1
        }
    }
      , l = function(t) {
        switch (t) {
        case "DiffuseColor":
        case "DiffuseIntensity":
        case "SpecularColor":
        case "NormalMap":
        case "EmitColor":
        case "DiffusePBR":
        case "AlbedoPBR":
        case "SpecularPBR":
            return a.Texture.RGB;
        case "SpecularHardness":
        case "BumpMap":
        case "GlossinessPBR":
        case "RoughnessPBR":
        case "MetalnessPBR":
        case "SpecularF0":
        case "AOPBR":
        case "CavityPBR":
        case "Displacement":
            return a.Texture.LUMINANCE;
        default:
        case "Opacity":
            return a.Texture.ALPHA
        }
    }
      , c = function(t) {
        var e = {};
        switch (t) {
        case "NormalMap":
        case "SpecularPBR":
            break;
        case "SpecularHardness":
        case "BumpMap":
        case "GlossinessPBR":
        case "RoughnessPBR":
        case "MetalnessPBR":
        case "SpecularF0":
        case "AOPBR":
        case "CavityPBR":
        case "Displacement":
            break;
        case "DiffuseColor":
        case "DiffuseIntensity":
        case "SpecularColor":
        case "EmitColor":
        case "DiffusePBR":
        case "AlbedoPBR":
            e.LUMINANCE = "Luminance",
            e.RGB = "RGB";
            break;
        default:
        case "Opacity":
            e.ALPHA = "Alpha",
            e.LUMINANCE = "Luminance"
        }
        return e
    }
      , h = function(t) {
        var e = {};
        return e.NEAREST = "Nearest",
        e.LINEAR = "Bilinear",
        "Displacement" !== t && (e.LINEAR_MIPMAP_LINEAR = "Trilinear"),
        e
    }
      , d = function(t) {
        for (var e = {}, i = 0, n = s.length; i < n; ++i) {
            var r = s[i];
            e[r] = t(r)
        }
        return function(t) {
            return e[t]
        }
    };
    s.getShadingMask = d(o),
    s.isSRGB = d(u),
    s.getDefaultFormat = d(l),
    s.getPossibleFormat = d(c),
    s.getPossibleFiltering = d(h),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(238)
      , r = new n;
    r.PBR_LIT = 1,
    r.CLASSIC_LIT = 2,
    r.PBR_SHADELESS = 4,
    r.CLASSIC_SHADELESS = 8,
    r.MATCAP = 16,
    r.LIT = r.PBR_LIT | r.CLASSIC_LIT,
    r.SHADELESS = r.PBR_SHADELESS | r.CLASSIC_SHADELESS,
    r.PBR = r.PBR_LIT | r.PBR_SHADELESS,
    r.CLASSIC = r.CLASSIC_LIT | r.CLASSIC_SHADELESS,
    r.set("mask", r.PBR_LIT),
    r.on("change:mask", function() {
        var t = r.get("mask");
        switch (t) {
        case r.PBR_LIT:
        case r.CLASSIC_LIT:
        case r.PBR_SHADELESS:
        case r.CLASSIC_SHADELESS:
        case r.MATCAP:
            break;
        default:
            console.error("Invalid ShadingGlobal mask value !" + t)
        }
    }),
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1545)
      , a = i(1516)
      , s = n.osg
      , o = function() {
        s.StateSet.call(this),
        this._colorUniform = s.Uniform.createFloat4(s.Vec4.createAndSet(1, 0, 0, 0), "uColor"),
        this._callbackColor = new r(this._colorUniform,1),
        this.init()
    };
    o.prototype = s.objectInherit(s.StateSet.prototype, {
        setRenderBinVR: function(t) {
            this.setRenderBinDetails(t ? a.TRANSPARENT_BIN_NO_EARLYZ_POST : a.WIREFRAME, "RenderBin")
        },
        init: function() {
            this.setRenderBinDetails(a.WIREFRAME, "RenderBin"),
            this.setAttributeAndModes(new s.Depth(s.Depth.LEQUAL)),
            this.setAttributeAndModes(new s.BlendFunc(s.BlendFunc.ONE,s.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            this.setShaderGeneratorName("wireframe"),
            this.addUniform(this._colorUniform),
            this.addUpdateCallback(this._callbackColor)
        },
        setWireframeColorSmooth: function(t) {
            this._callbackColor.setColorTarget(t)
        },
        setWireframeColor: function(t) {
            this._colorUniform.setFloat4(t)
        },
        setWireframeEnable: function(t, e) {
            t ? (this._callbackColor._finished === !0 && (this._colorUniform.setFloat3(e),
            this._colorUniform.getInternalArray()[3] = 0),
            this._callbackColor.show(e[3])) : this._callbackColor.hide()
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1546)
      , a = i(1486)
      , s = n.osg
      , o = function(t, e) {
        this._colorUniform = t,
        this._colorDelta = s.Vec4.create(),
        this._lastRatio = 0,
        r.call(this, e),
        this._finished = !0,
        this._disableAfterFinished = !1,
        this._finishCallback = void 0,
        this._lastFrame = 0
    };
    o.prototype = s.objectInherit(r.prototype, {
        hide: function() {
            s.Vec3.init(this._colorDelta)[3] = -this._colorUniform.getInternalArray()[3],
            this._disableAfterFinished = !0,
            this._lastRatio = 0,
            this.reset()
        },
        show: function(t) {
            s.Vec3.init(this._colorDelta)[3] = void 0 !== t ? t : 1 - this._colorUniform.getInternalArray()[3],
            this._disableAfterFinished = !1,
            this._lastRatio = 0,
            this.reset()
        },
        setColorTarget: function(t) {
            s.Vec4.sub(t, this._colorUniform.getInternalArray(), this._colorDelta),
            this._disableAfterFinished = !1,
            this._lastRatio = 0,
            this.reset()
        },
        smoothStep: function(t) {
            return t * t * (3 - 2 * t)
        },
        setFinishCallback: function(t) {
            this._finishCallback = t
        },
        finished: function() {
            this._disableAfterFinished === !0 && this._finishCallback && this._finishCallback()
        },
        update: function(t, e) {
            if (this._finished === !0)
                return !0;
            a.draw();
            var i = e.getFrameStamp()
              , n = i.getFrameNumber();
            if (this._lastFrame === n)
                return !0;
            this._lastFrame = n;
            var r = i.getSimulationTime()
              , s = this.interpolate(r, t, e);
            s = this.smoothStep(s);
            var o = s - this._lastRatio;
            this._lastRatio = s;
            var u = this._colorUniform.getInternalArray()
              , l = this._colorDelta;
            return u[0] += l[0] * o,
            u[1] += l[1] * o,
            u[2] += l[2] * o,
            u[3] += l[3] * o,
            !0
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1486)
      , r = function(t) {
        this._duration = void 0 === t ? 1 : t,
        this.reset()
    };
    r.prototype = {
        getDuration: function() {
            return this._duration
        },
        setDuration: function(t) {
            this._duration = t
        },
        reset: function() {
            this._startTime = -1,
            this._finished = !1,
            this._ratio = 0,
            n.draw()
        },
        finished: function() {},
        interpolate: function(t, e, i) {
            if (this._finished)
                return 1;
            this._startTime < 0 && (this._startTime = t);
            var n = Math.min(this._duration, t - this._startTime)
              , r = 0 === this._duration ? 1 : n / this._duration;
            return this._ratio = r,
            (r >= 1 || 0 === this._duration) && (this._finished = !0,
            this.finished(e, i)),
            r
        },
        update: function(t, e) {
            return this.interpolate(e.getFrameStamp().getSimulationTime(), t, e),
            !0
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(235)
      , a = i(1482)
      , s = i(1516)
      , o = i(1542)
      , u = i(1543)
      , l = i(1548)
      , c = i(1465)
      , h = i(1481)
      , d = n.osg
      , p = n.osgAnimation
      , f = r.defer()
      , g = window.sketchfabViewerStats = {
        promiseReady: f.promise,
        geometryCountBefore: 0,
        geometryCountAfter: 0,
        materialCountBefore: 0,
        materialCountAfter: 0
    }
      , m = {
        splitLimit: 65536,
        limitMergePerMaterial: 100,
        isTransparent: !1,
        isWireframe: !1,
        protectedGeometries: {},
        channelTargetNames: {},
        bakedGeometriesFromID: {},
        parentCountFromID: {},
        childrenCountFromID: {},
        multiParentPathFromGeometryID: {},
        animatedFromID: {},
        reports: g
    }
      , v = {};
    v[d.PrimitiveSet.POINTS] = !0,
    v[d.PrimitiveSet.LINES] = !0,
    v[d.PrimitiveSet.TRIANGLES] = !0;
    var _ = {};
    _[d.PrimitiveSet.POINTS] = !0,
    _[d.PrimitiveSet.LINES] = !0,
    _[d.PrimitiveSet.TRIANGLES] = !0,
    _[d.PrimitiveSet.TRIANGLE_STRIP] = !0;
    var b, x, A = {
        Vertex: 1,
        Normal: 1,
        Tangent: 1
    }, y = function(t, e) {
        var i = t[t.length - 1]
          , n = e[e.length - 1];
        return n.getVertexAttributeList().Vertex.getElements().length - i.getVertexAttributeList().Vertex.getElements().length
    }, S = function(t) {
        return t === s.TRANSPARENT_BIN
    }, C = function(t) {
        return t.getVertexAttributeList().Vertex.getElements().length / 3
    }, M = function(t) {
        return t[t.length - 1].getVertexAttributeList().Vertex.getElements().length / 3
    }, w = function(t) {
        var e = t.getStateSet();
        return e && e.getAttribute("SketchfabMaterial") ? e : void 0
    }, T = function(t, e) {
        for (var i = e || 0, n = t.length - 1; n >= i; --n) {
            var r = w(t[n]);
            if (r)
                return r
        }
    }, E = function(t) {
        for (var e = 0, i = t.length; e < i; ++e)
            t[e].removeChildren()
    }, I = function(t) {
        for (var e = 0, i = t.length - 1; e < i; ++e)
            t[e].addChild(t[e + 1])
    }, k = function(t) {
        for (var e = t.length, i = 0; i < e; ++i)
            E(t[i])
    }, F = function(t) {
        var e = t[t.length - 1].getInstanceID()
          , i = m.multiParentPathFromGeometryID;
        return Boolean(i[e])
    }, D = function(t, e, i) {
        var n = e.getVertexAttributeList().Vertex.getElements()
          , r = t.getVertexAttributeList().Vertex.getElements();
        e.getVertexAttributeList().Vertex.setElements(r.subarray(i, i + n.length)),
        t._boundingBox.copy(e.getBoundingBox()),
        t._boundingBoxComputed = !0;
        var a = e.getBoundingSphere()
          , s = t._boundingSphere;
        s.set(d.Vec3.copy(a.center(), s.center()), a.radius()),
        t._boundingSphereComputed = !0,
        e.getVertexAttributeList().Vertex.setElements(n),
        e.dirtyBound()
    }, N = function(t) {
        var e = d.Matrix.create();
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[4] = t[4],
        e[5] = t[5],
        e[6] = t[6],
        e[8] = t[8],
        e[9] = t[9],
        e[10] = t[10],
        d.Matrix.inverse(e, e),
        d.Matrix.transpose(e, e),
        e
    }, R = function(t, e, i, n) {
        var r = m.bakedGeometriesFromID[e.getInstanceID()];
        r || (m.bakedGeometriesFromID[i.getInstanceID()] = !0);
        var a = i.getElements();
        n && (a = a.subarray(n));
        var s = e.getElements();
        if (r || d.Matrix.isIdentity(t))
            return void (i !== e && a.set(s));
        for (var o = e.getItemSize(), u = d.Vec3.create(), l = Math.min(s.length, a.length), c = 0; c < l; c += o)
            u[0] = s[c],
            u[1] = s[c + 1],
            u[2] = s[c + 2],
            d.Matrix.transformVec3(t, u, u),
            a[c] = u[0],
            a[c + 1] = u[1],
            a[c + 2] = u[2],
            4 === o && (a[c + 3] = s[c + 3])
    }, P = function(t, e, i, n) {
        var r = i.getIndices()
          , a = r.getElements()
          , s = a.length
          , o = 0
          , u = i.getMode()
          , l = t[u]
          , c = l.primitive
          , h = c.getIndices().getElements()
          , p = c.getCount()
          , f = _[u] && !m.isTransparent
          , g = p;
        if (u === d.PrimitiveSet.TRIANGLE_STRIP && f) {
            var v = h[p - 1]
              , b = a[0] + n
              , x = v !== b && 0 !== p ? 2 : 0
              , A = p % 2;
            x && (h[p] = v,
            h[p + 1] = b),
            A && (h[p + x] = b),
            g += x + A,
            h.set(a, g)
        } else
            h.set(a, g);
        c.setCount(g + s);
        var y = g + s;
        for (o = g; o < y; ++o)
            h[o] += n;
        f || (i.setIndices(c.getIndices()),
        i.setCount(s),
        i.setFirst(g * h.BYTES_PER_ELEMENT),
        m.isTransparent || e.push(i))
    }, L = function(t, e, i, n) {
        for (var r = i.length, a = m.isTransparent, s = 0; s < r; ++s) {
            var o = i[s]
              , u = o.getMode();
            if (o instanceof d.DrawElements)
                P(t.DrawElements, e, o, n);
            else if (o instanceof d.DrawArrays) {
                var l = t.DrawArrays[u];
                a ? o.first += n : l && l.primitive.count === n && 0 === o.getFirst() ? l.primitive.count += o.getCount() : e.push(new d.DrawArrays(u,o.getFirst() + n,o.getCount()))
            } else
                o instanceof d.DrawArrayLengths && (a ? o.first += n : e.push(new d.DrawArrayLengths(u,o.getFirst() + n,o.getArrayLengths().slice())))
        }
    }, O = function(t) {
        for (var e = t[t.length - 1], i = [{
            nbVertex: M(e),
            pathList: [e]
        }], n = t.length - 1; n > 0; --n) {
            var r = t[n - 1]
              , a = t[n]
              , s = i[i.length - 1]
              , o = M(r)
              , u = s.nbVertex;
            o + u >= m.splitLimit ? i.push({
                nbVertex: M(a),
                pathList: [a]
            }) : (s.nbVertex += o,
            s.pathList.push(r))
        }
        return i
    }, V = function(t, e, i) {
        for (var n = F(t), r = 0, a = i.length; r < a; ++r) {
            var s, o = i[r];
            if (n)
                if (o instanceof d.DrawElements) {
                    var u = o.getIndices()
                      , l = u.getElements()
                      , c = new l.constructor(l)
                      , h = new d.BufferArray(d.BufferArray.ELEMENT_ARRAY_BUFFER,c,u.getItemSize(),(!0));
                    s = new d.DrawElements(o.getMode(),h)
                } else
                    o instanceof d.DrawArrays ? s = new d.DrawArrays(o.getMode(),o.getFirst(),o.getCount()) : o instanceof d.DrawArrayLengths && (s = new d.DrawArrayLengths(o.getMode(),o.getFirst(),o.getArrayLengths().slice()));
            else
                s = o;
            e.push(s)
        }
    }, B = function(t, e, i) {
        for (var n = e * i, r = t.length, a = n; a < r; ++a)
            t[a] = 1
    }, U = function(t, e) {
        g.geometryCountAfter++;
        var i = t[t.length - 1]
          , n = new d.Geometry;
        n.setName(i.getName()),
        V(t, n.getPrimitiveSetList(), i.getPrimitiveSetList());
        for (var r = d.computeLocalToWorld(t), a = N(r), s = e !== C(i), o = F(t), u = n.getVertexAttributeList(), l = i.getVertexAttributeList(), c = Object.keys(l), h = 0, p = c.length; h < p; ++h) {
            var f, v = c[h], _ = l[v], b = A[v], x = _.getItemSize();
            if (s ? (f = new Float32Array(e * x),
            b || f.set(_.getElements()),
            "Color" === v && B(f, _.getElements().length / x, x)) : b && o ? f = new Float32Array(_.getElements().length) : u[v] = _,
            f && (u[v] = new d.BufferArray(d.BufferArray.ARRAY_BUFFER,f,x,(!0))),
            b) {
                var y = "Vertex" === v ? r : a;
                R(y, _, u[v], 0)
            }
        }
        return m.isTransparent && D(n, i, 0),
        n
    }, G = function(t, e, i) {
        for (var n = e[e.length - 1], r = t.getVertexAttributeList(), a = n.getVertexAttributeList(), s = Object.keys(a), o = d.computeLocalToWorld(e), u = N(o), l = s.length, c = 0; c < l; ++c) {
            var h = s[c]
              , p = r[h]
              , f = a[h]
              , g = p.getElements()
              , m = i * f.getItemSize();
            if (A[h]) {
                var v = "Vertex" === h ? o : u;
                R(v, f, p, m)
            } else
                g.set(f.getElements(), m)
        }
    }, z = function(t, e, i) {
        for (var n = Object.keys(e), r = 0, a = n.length; r < a; ++r) {
            var s = n[r];
            if (!t[s]) {
                var o = e[s].getItemSize()
                  , u = new Float32Array(i * o)
                  , l = new d.BufferArray(d.BufferArray.ARRAY_BUFFER,u,o,(!0));
                t[s] = l,
                "Color" === s && B(u, 0, o)
            }
        }
    }, H = function(t, e, i, n) {
        for (var r = e.DrawElements, a = e.DrawArrays, s = m.isTransparent, o = 0, u = i.length; o < u; ++o) {
            var l = i[o]
              , c = l.getMode();
            if (l instanceof d.DrawElements) {
                var h = r[c];
                if (!h) {
                    var p = l.getIndices().getItemSize()
                      , f = new d.BufferArray(d.BufferArray.ELEMENT_ARRAY_BUFFER,new Uint16Array,p,(!0));
                    h = r[c] = {
                        primitive: new d.DrawElements(c,f),
                        lastElement: -1,
                        initCount: 0
                    },
                    t.push(h.primitive)
                }
                var g = h.primitive;
                if (c === d.PrimitiveSet.TRIANGLE_STRIP && _[c] && !s) {
                    var b = l.getIndices().getElements()
                      , x = b[0] + n
                      , A = h.lastElement !== x && 0 !== g.getCount() ? 2 : 0
                      , y = g.getCount() % 2;
                    g.setCount(g.getCount() + l.getCount() + A + y),
                    h.lastElement = b[b.length - 1] + n
                } else
                    g.setCount(g.getCount() + l.getCount())
            } else
                l instanceof d.DrawArrays && v[c] && !s && (a[c] || (a[c] = {
                    primitive: new d.DrawArrays(c,0,0),
                    initCount: 0
                },
                t.push(a[c].primitive)))
        }
    }, j = function(t) {
        for (var e = {
            DrawElements: {},
            DrawArrays: {}
        }, i = m.isTransparent, n = 0, r = t.length; n < r; ++n) {
            var a = t[n]
              , s = a.getMode();
            if (a instanceof d.DrawElements) {
                var o = a.getIndices().getElements();
                e.DrawElements[s] = {
                    primitive: a,
                    lastElement: o[o.length - 1],
                    initCount: a.getCount()
                }
            } else
                a instanceof d.DrawArrays && v[s] && !i && (e.DrawArrays[s] = {
                    primitive: a,
                    first: a.getFirst(),
                    initCount: a.getCount()
                })
        }
        return e
    }, W = function(t, e) {
        for (var i = Object.keys(t), n = 0, r = i.length; n < r; ++n) {
            var a = t[i[n]]
              , s = a.primitive
              , o = s.getIndices()
              , u = o.getElements();
            o.setElements(new e(s.getCount())),
            o.getElements().set(u),
            s.setIndices(o),
            s.setCount(u.length)
        }
    }, q = function(t, e, i, n) {
        for (var r = t.getVertexAttributeList(), a = t.getPrimitiveSetList(), s = C(t), o = n, u = 0, l = e.length; u < l; ++u) {
            var c = e[u]
              , h = c[c.length - 1];
            z(r, h.getVertexAttributeList(), s),
            H(a, i, h.getPrimitiveSetList(), o),
            o += M(c)
        }
        W(i.DrawElements, s >= 65536 ? Uint32Array : Uint16Array)
    }, Y = function(t) {
        for (var e = t.DrawElements, i = Object.keys(e), n = m.isTransparent, r = 0, a = i.length; r < a; ++r) {
            var s = e[i[r]];
            !n && _[i[r]] || s.primitive.setCount(s.initCount)
        }
    }, Q = function(t, e) {
        var i = t.pathList
          , n = i.pop()
          , r = C(n[n.length - 1])
          , a = U(n, t.nbVertex);
        if (e.addChild(a),
        0 !== i.length) {
            var s = a.getPrimitiveSetList()
              , o = j(s);
            q(a, i, o, r);
            for (var u = m.isTransparent, l = 0, c = i.length; l < c; ++l) {
                var h = i[l];
                G(a, h, r);
                var p = h[h.length - 1];
                if (u || F(h)) {
                    g.geometryCountAfter++;
                    var f = new d.Geometry;
                    f.setName(p.getName()),
                    V(h, f.getPrimitiveSetList(), p.getPrimitiveSetList()),
                    u && (f.attributes = f._attributes = a.getVertexAttributeList(),
                    e.addChild(f),
                    D(f, p, 3 * r)),
                    p = f
                }
                var v = p.getPrimitiveSetList();
                L(o, s, v, r),
                r += M(h)
            }
            Y(o)
        }
    }, X = function(t) {
        var e = t.localRoot;
        t.renderPathList.sort(y);
        for (var i = O(t.renderPathList), n = i.length, r = 0; r < n; ++r)
            Q(i[r], e)
    }, K = function(t) {
        var e = t.localRoot
          , i = e.getStateSet();
        m.isTransparent = Boolean(i && S(i.getBinNumber())),
        t.renderPathList.length > m.limitMergePerMaterial && (m.isTransparent = !1),
        X(t)
    }, J = function(t, e, i) {
        var n;
        n = m.isWireframe ? t[t.length - 1].getStateSet() : T(t);
        var r = n.getInstanceID()
          , a = e[r];
        a || (e[r] = a = {
            localRoot: new d.Node,
            renderPathList: []
        },
        a.localRoot.setStateSet(n),
        a.localRoot.setName(n.getName()),
        i.addChild(a.localRoot)),
        a.renderPathList.push(t),
        t[0] === i && t.shift()
    }, Z = function(t, e) {
        var i = {}
          , n = 0
          , r = t.length;
        for (n = 0; n < r; ++n)
            J(t[n], i, e);
        var a = Object.keys(i)
          , s = a.length;
        for (n = 0; n < s; ++n)
            K(i[a[n]])
    }, $ = function(t) {
        for (var e = !1, i = m.channelTargetNames, n = 0, r = t.length; n < r; ++n) {
            var a, s = t[n], o = !1;
            if (s instanceof p.Bone)
                a = p.UpdateBone;
            else {
                if (!(s instanceof d.MatrixTransform))
                    continue;
                a = p.UpdateMatrixTransform,
                o = !0
            }
            for (var u = s.getUpdateCallbackList(), l = u.length - 1; l >= 0; --l) {
                var c = u[l];
                c instanceof a != !1 && (i[c.getName()] || !o ? e = !0 : (c.update(s),
                s.removeUpdateCallback(c)))
            }
        }
        var h = t[t.length - 1];
        return e || h instanceof p.RigGeometry || h instanceof p.MorphGeometry
    }, tt = function() {
        var t = [];
        return function(e) {
            return t[0] = e,
            $(t)
        }
    }();
    n.osgDB.Input.prototype.getJSON = function() {
        return x = this,
        this._json.Animations && (b = this._json),
        this._json
    }
    ;
    var et = function(t) {
        var e = m.channelTargetNames;
        if (!b || !b.Animations || a.OSG_VERSION < 8)
            return e;
        for (var i = t.getFeatures().animation.getModel(), n = b.Animations, r = 0, s = n.length; r < s; ++r) {
            var o = n[r]["osgAnimation.Animation"]
              , u = x.setJSON(o.UserDataContainer).readUserDataContainer()
              , l = h.convertUserDataToObject(u);
            if (i.getAnimationByUID(l.AnimationUID))
                for (var c = o.Channels, d = 0, p = c.length; d < p; ++d) {
                    var f = c[d];
                    e[f[Object.keys(f)[0]].TargetName] = 1
                }
        }
        return e
    }
      , it = function(t, e) {
        for (var i = m.protectedGeometries, n = t.length - 1; n >= 0; --n) {
            var r = t[n]
              , a = r.length
              , s = r[a - 1];
            if (void 0 !== s._uniqueID && i[s._uniqueID])
                e.push(r),
                t.splice(n, 1);
            else if (s instanceof d.Geometry || s instanceof p.Bone)
                $(r) && (e.push(r),
                t.splice(n, 1));
            else {
                for (var o = a - 2; o >= 0; --o)
                    if (r[o]instanceof p.Bone) {
                        e.push(r);
                        break
                    }
                t.splice(n, 1)
            }
        }
    }
      , nt = function(t, e, i) {
        it(t.getPathList(), e),
        g.geometryCountAfter += e.length,
        it(t.getNoGeometryPathList(), e),
        it(t.getWireframePathList(), i)
    }
      , rt = function(t) {
        for (var e = m.parentCountFromID, i = m.childrenCountFromID, n = m.multiParentPathFromGeometryID, r = 0, a = t.length; r < a; ++r) {
            for (var s = t[r], o = !1, u = 0, l = s.length; u < l; ++u) {
                var c = s[u]
                  , h = c.getInstanceID();
                e[h] = c.getParents().length,
                i[h] = c.getChildren().length,
                o = o || c.getParents().length > 1
            }
            n[s[s.length - 1].getInstanceID()] = o
        }
    }
      , at = function(t) {
        rt(t.getPathList()),
        rt(t.getNoGeometryPathList()),
        rt(t.getWireframePathList())
    }
      , st = function(t) {
        k(t.getPathList()),
        k(t.getNoGeometryPathList()),
        k(t.getWireframePathList())
    }
      , ot = function(t, e, i, n) {
        var r = 0
          , a = t.length
          , s = i.length
          , o = !1;
        for (r = a - 1; r >= 0; --r) {
            var u = t[r];
            I(u);
            var l = u[0] === e;
            T(u, l ? 1 : 0) || (o = !0),
            l || e.addChild(u[0])
        }
        for (r = s - 1; r >= 0; --r) {
            var c = i[r];
            I(c),
            n.push(c[c.length - 1]),
            c[0] !== e && e.addChild(c[0])
        }
        o || e.setStateSet(void 0)
    }
      , ut = function(t, e, i) {
        m.isWireframe = !0;
        var n = t.getChildren()
          , r = n.length;
        Z(e, t);
        for (var a = n.length, s = r; s < a; ++s)
            i.push(n[s])
    }
      , lt = function(t, e) {
        var i = t.length;
        if (0 !== i)
            for (var n = t[0].indexOf(e), r = Boolean(e.getStateSet()) ? 0 : 1, a = 0; a < i; ++a) {
                var s = t[a];
                s.splice(0, n + r)
            }
    }
      , ct = function(t) {
        for (var e = t.getUpdateCallbackList(), i = 0, n = e.length; i < n; ++i) {
            var r = e[i];
            if (r instanceof p.BasicAnimationManager)
                return t.removeUpdateCallback(r),
                r
        }
    }
      , ht = function(t) {
        for (var e, i, n = t.getPathList(), r = n[0][0], a = r, s = []; ; ) {
            e = w(a) || e,
            i = i || ct(a);
            var o = a.getChildren();
            if (1 !== o.length)
                break;
            if (o[0]instanceof p.Skeleton)
                break;
            if (o[0]instanceof d.Geometry)
                break;
            if (tt(a))
                break;
            s.push(a),
            a = o[0]
        }
        if (r.removeChildren(),
        i && r.addUpdateCallback(i),
        r === a)
            return a;
        for (var u = a.getParents(), l = 0, c = u.length; l < c; ++l)
            u[l].removeChild(a);
        a.removeChildren(),
        r.setStateSet(void 0),
        a.setStateSet(e);
        var h = d.computeLocalToWorld(s);
        if (d.Matrix.isIdentity(h))
            r.addChild(a);
        else {
            var f = new d.MatrixTransform;
            f.setName("Optim - RootMatrix"),
            d.Matrix.copy(h, f.getMatrix()),
            r.addChild(f),
            f.addChild(a)
        }
        return lt(n, a),
        lt(t.getWireframePathList(), a),
        lt(t.getNoGeometryPathList(), a),
        a
    }
      , dt = function(t) {
        for (var e = t.getFeatures().hotspot.getModel().get("hotspots"), i = e.length, n = m.protectedGeometries, r = 0; r < i; ++r) {
            var a = e.at(r).get("geometryUid");
            a >= 0 && (n[a] = !0)
        }
    };
    m.optimizeNodes = function(t, e) {
        g.geometryCountBefore = t.getPathList().length,
        d.WebGLCaps.instance().getWebGLExtension("OES_element_index_uint") && (m.splitLimit = 4294967296);
        var i = e.getOrCreateScene().getWireframeNodes();
        i.length = 0;
        var n = []
          , r = []
          , s = t.getPathList()
          , o = t.getWireframePathList();
        et(e);
        var u = ht(t);
        if (at(t),
        st(t),
        dt(e),
        nt(t, n, r),
        Z(s, u),
        ot(n, u, r, i),
        o.length > 0) {
            var l = i.slice(0);
            a.getWireframe().then(function() {
                for (var t = i.length = l.length, e = 0; e < t; ++e)
                    i[e] = l[e];
                d.time("optimizer - wireframe"),
                ut(u, o, i),
                d.timeEnd("optimizer - wireframe")
            })
        }
    }
    ,
    m.mergeMaterials = function(t, e) {
        for (var i = {}, n = {}, r = o.length, a = Object.keys(t), s = a.length, l = 0; l < s; ++l) {
            var c = t[a[l]]
              , h = c.get("stateSet");
            if (!h)
                return;
            var p = c.getChannels()
              , f = u.get("mask")
              , m = [];
            m.push(c.get("cullFace") ? 1 : 0),
            f & u.LIT && m.push(c.get("shadeless") ? 1 : 0),
            f === u.CLASSIC_LIT && m.push(c.get("reflection")),
            f !== u.MATCAP && m.push(c.get("hasVertexColor") ? 1 : 0),
            p.Opacity.isEffective() && m.push(c.get("hasVertexAlpha") ? 1 : 0);
            for (var v = 0; v < r; ++v) {
                var _ = o[v]
                  , b = p[_];
                b.isEnableEffective() && m.push(_ + (b.isEffective() ? JSON.stringify(b.getJSON()) : b.getFactor()))
            }
            m = m.join(" / "),
            i[m] ? n[h.getInstanceID()] = i[m] : i[m] = h
        }
        var x = Object.keys(n).length;
        if (g.materialCountBefore = s,
        g.materialCountAfter = s - x,
        0 !== x) {
            var A = function() {
                d.NodeVisitor.call(this)
            };
            A.prototype = d.objectInherit(d.NodeVisitor.prototype, {
                apply: function(t) {
                    var e = t.getStateSet();
                    if (e) {
                        var i = n[e.getInstanceID()];
                        i && t.setStateSet(i)
                    }
                    this.traverse(t)
                }
            });
            var y = e.getOrCreateScene().getRoot();
            y.accept(new A)
        }
    }
    ,
    m.optimize = function(t, e, i) {
        f.resolve(g),
        (c().graphOptimizer || c().mergeMaterials) && (d.time("optimizer"),
        c().mergeMaterials && (d.time("optimizer - materials"),
        m.mergeMaterials(e, i),
        d.timeEnd("optimizer - materials")),
        c().graphOptimizer && (d.time("optimizer - nodes"),
        m.optimizeNodes(t, i),
        d.timeEnd("optimizer - nodes")),
        c().graphOptimizer && l.logMessage("Geometry count : before " + g.geometryCountBefore + ", after " + g.geometryCountAfter),
        c().mergeMaterials && l.logMessage("Material count : before " + g.materialCountBefore + ", after " + g.materialCountAfter),
        d.timeEnd("optimizer"))
    }
    ,
    t.exports = m
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = !1
      , s = r.Timer.prototype.tick
      , o = function() {
        this.children = [],
        this.timerMessage = "",
        this.message = "",
        this.start = s(),
        this.parent = this
    }
      , u = {}
      , l = {}
      , c = new o
      , h = c;
    r.time = function(t) {
        var e = u[t] = new o;
        h.children.push(e),
        e.parent = h,
        h = e,
        e.timerMessage = t
    }
    ,
    r.timeEnd = function(t) {
        var e = u[t];
        h = e.parent || c,
        e.message = t + " : " + (s() - e.start).toFixed(2) + "ms",
        a && l.showMessage()
    }
    ;
    var d = function(t, e) {
        var i = t.children
          , n = "";
        t !== c && i.length > 0 && (n = e + t.timerMessage + "\n");
        for (var r = t === c ? "" : "  |  ", a = 0; a < i.length; ++a)
            n += d(i[a], e + r) + "\n";
        var s = t.parent === c && t.timerMessage ? "\n" : "";
        return n + (e + t.message) + s
    };
    l.showMessage = function() {
        console.log("%c" + d(c, ""), "color:purple"),
        a = !0,
        c.children.length = 0
    }
    ,
    l.logBound = function(t) {
        var e = t.getMinimumBound()
          , i = e.center(r.Vec3.create())
          , n = "Bound center : [ " + i[0] + ", " + i[1] + ", " + i[2] + " ]\n";
        n += "Bound radius : " + e.radius() + "\n";
        var a = t.getBoundingBox();
        n += "Bbox min : [ " + a._min[0] + ", " + a._min[1] + ", " + a._min[2] + " ]\n",
        n += "Bbox max : [ " + a._max[0] + ", " + a._max[1] + ", " + a._max[2] + " ]\n",
        l.logMessage(n)
    }
    ,
    l.logMessage = function(t) {
        var e = new o((!0));
        e.message = t,
        h.children.push(e),
        e.parent = h
    }
    ,
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(234)
      , r = i(216)
      , a = i(1198)
      , s = i(1191)
      , o = i(1550)
      , u = i(1555)
      , l = i(1561)
      , c = i(1562)
      , h = i(1197)
      , d = i(1531)
      , p = a.osg
      , f = 1
      , g = function() {
        p.NodeVisitor.call(this, p.NodeVisitor.TRAVERSE_PARENTS),
        this._material = void 0,
        this._manager = void 0
    };
    g.prototype = p.objectInherit(p.NodeVisitor.prototype, {
        setManager: function(t) {
            this._manager = t
        },
        reset: function() {
            this.nodePath.length = 0,
            this._material = void 0
        },
        apply: function(t) {
            if (!this._material) {
                var e = t.getStateSet();
                e && (this._material = this._manager.getMaterialByStateSet(e)),
                this._material || this.traverse(t)
            }
        }
    });
    var m = function(t, e) {
        p.NodeVisitor.call(this),
        this._manager = t,
        this._useVertexAlpha = e,
        this._stackMaterial = []
    };
    m.prototype = p.objectInherit(p.NodeVisitor.prototype, {
        apply: function(t) {
            var e = t.getStateSet()
              , i = e && this._manager.getMaterialByStateSet(e);
            if (i && this._stackMaterial.push(i),
            t instanceof p.Geometry && this._stackMaterial.length > 0) {
                var n = this._stackMaterial[this._stackMaterial.length - 1];
                t.getVertexAttributeList().Color && (n.set("hasVertexColor", !0),
                !n.get("hasVertexAlpha") && t.userDataMap.hasVertexAlpha && (n.set("hasVertexAlpha", !0),
                n.getChannels().Opacity.set("vertexAlphaEnable", this._useVertexAlpha))),
                n.getChannels().Displacement.get("geometryList").push(t)
            }
            this.traverse(t),
            i && this._stackMaterial.pop()
        }
    });
    var v = n.Model.extend({
        initialize: function() {
            this._materialByStateSetID = {},
            this._materialNames = {
                material_: 0
            }
        },
        getImageCollection: function() {
            return this.imageCollection || a.osg.error("ImageCollection not initialized in MaterialManager, somewhing wrong"),
            this.imageCollection
        },
        setImageCollection: function(t) {
            this.imageCollection = t
        },
        setNewMaterial: function(t, e) {
            this.attributes[t] = e;
            var i = e.get("stateSetID");
            void 0 !== i && (this._materialByStateSetID[i] = e)
        },
        addMaterial: function(t) {
            var e = new o
              , i = this.getImageCollection();
            return e.setMaterialJSON(t, i),
            new u({
                model: e
            }),
            this.setNewMaterial(t.id, e),
            e
        },
        getMaterialStateID: function(t) {
            if (void 0 !== t._materialID)
                return t._materialID;
            var e = t.getUserData();
            if (e)
                for (var i = e.length - 1; i >= 0; --i)
                    if ("UniqueID" === e[i].Name) {
                        t._materialID = parseInt(e[i].Value, 10);
                        break
                    }
            return void 0 === t._materialID && (void 0 !== t._uniqueID ? t._materialID = t._uniqueID : (a.osg.warn("v0 StateSet detected"),
            t._materialID = f++)),
            t._materialID
        },
        getMaterialByStateSetID: function(t) {
            return void 0 !== t ? this._materialByStateSetID[t] : void 0
        },
        getMaterialByStateSet: function(t) {
            return this.getMaterialByStateSetID(this.getMaterialStateID(t))
        },
        removeMaterialByStateSetID: function(t) {
            var e = this;
            r.filter(this.attributes, function(e) {
                return e.get("stateSetID") === t
            }).forEach(function(t) {
                delete e.attributes[t.get("id")]
            })
        },
        removeMaterialByStateSet: function(t) {
            for (var e = this.attributes, i = Object.keys(e), n = 0, r = i.length; n < r; ++n) {
                var a = i[n]
                  , s = e[a];
                if (s.get("stateSet") === t)
                    return void delete e[a]
            }
        },
        removeUnboundMaterial: function() {
            var t = this.attributes;
            r.each(t, function(e) {
                e.get("stateSet") || delete t[e.get("id")]
            })
        },
        createMaterial: function(t, e) {
            void 0 === e && (e = t.getOrCreateStateSet());
            var i = new o;
            new u({
                model: i
            });
            var n = this.findTexCoordChannels(t)
              , r = l();
            return i.set("id", r),
            i.set("stateSetID", this.getMaterialStateID(e)),
            i.set("name", this.getUniqueMaterialName(e.getAttributeMap().Material, e, t)),
            i.setTexCoordUnitList(n),
            this.setNewMaterial(r, i),
            i
        },
        findTexCoordChannels: function() {
            var t = new c;
            return function(e) {
                return t.reset(),
                e.accept(t),
                t.getTexCoordList()
            }
        }(),
        getUniqueMaterialName: function(t, e, i) {
            var n = this._materialNames
              , r = t && t.getAttribute() ? t.getAttribute().getName() : void 0;
            if (void 0 === r && (r = void 0 !== e.getName() ? e.getName() : i.getName()),
            void 0 === r)
                return "material_" + n.material_++;
            var a = n[r];
            return void 0 === a ? n[r] = 0 : r += "_" + n[r]++,
            r
        },
        getJSON: function() {
            var t = {}
              , e = this.attributes;
            return r.each(e, function(e) {
                t[e.get("id")] = e.getJSON()
            }),
            t
        },
        setWorkFlowMetalSpec: function(t, e) {
            for (var i = this.attributes, n = Object.keys(i), r = 0, a = n.length; r < a; ++r)
                i[n[r]].setWorkFlowMetalSpec(t, e)
        },
        setWorkFlowRoughGloss: function(t, e) {
            for (var i = this.attributes, n = Object.keys(i), r = 0, a = n.length; r < a; ++r)
                i[n[r]].setWorkFlowRoughGloss(t, e)
        },
        overrideMaterialChannels: function(t) {
            if (!s() && t.materialShowcase) {
                var e = t.materialDisplacement
                  , i = t.materialDisplacementFactor
                  , n = t.materialNormal
                  , a = t.materialDiffuse
                  , o = t.materialMetalness
                  , u = t.materialRoughness
                  , l = t.materialGlossiness
                  , c = t.materialSpecular
                  , h = t.materialEmissive
                  , d = t.materialTransparency
                  , p = t.materialCavity
                  , f = t.materialAO
                  , g = t.materialF0
                  , m = t.materialNames || "main_material"
                  , v = m.split(";")
                  , _ = this;
                if (t.substanceDisplacement && void 0 !== e) {
                    var b = this.attributes["ae605e73-2987-4b0f-b25b-bdf1dc02e6ed"];
                    b || (b = r.find(this.attributes, function(t) {
                        return "Sides" === t.get("name")
                    })),
                    b && this._replaceChannelURL(b.getChannels(), "Displacement", e, !0, i)
                }
                r.each(this.attributes, function(t) {
                    if (v.indexOf(t.get("name")) !== -1) {
                        var r = t.getChannels();
                        a && (_._replaceChannelURL(r, "DiffuseColor", a),
                        _._replaceChannelURL(r, "AlbedoPBR", a),
                        _._replaceChannelURL(r, "DiffusePBR", a)),
                        void 0 !== g && (g.length ? _._replaceChannelURL(r, "SpecularF0", g) : (r.SpecularF0.reset(),
                        r.SpecularF0.setFactor(.5))),
                        void 0 !== n && _._replaceChannelURL(r, "NormalMap", n, !0),
                        void 0 !== e && _._replaceChannelURL(r, "Displacement", e, !0, i),
                        void 0 !== p && _._replaceChannelURL(r, "CavityPBR", p, !0),
                        void 0 !== h && _._replaceChannelURL(r, "EmitColor", h, !0),
                        void 0 !== d && _._replaceChannelURL(r, "Opacity", d, !0),
                        void 0 !== f && (_._replaceChannelURL(r, "AOPBR", f, !0),
                        _._replaceChannelURL(r, "DiffuseIntensity", f, !0)),
                        (c || o) && (_._replaceChannelURL(r, "SpecularPBR", c),
                        _._replaceChannelURL(r, "MetalnessPBR", o),
                        t.setWorkFlowMetalSpec(Boolean(o))),
                        (u || l) && (_._replaceChannelURL(r, "RoughnessPBR", u),
                        _._replaceChannelURL(r, "GlossinessPBR", l),
                        t.setWorkFlowRoughGloss(Boolean(u)))
                    }
                })
            }
        },
        _replaceChannelURL: function(t, e, i, n, r) {
            var a = t[e];
            if (!i || !i.length)
                return void a.setEnable(!1);
            var s = h.instance
              , o = this.getImageCollection();
            s.getOrCreateImage(i).promise.then(function(t) {
                var e = t.getImage()
                  , s = o.addNewImage({
                    url: e.src,
                    width: e.naturalWidth,
                    height: e.naturalHeight,
                    name: i
                })
                  , u = new d({
                    image: s
                });
                a.setTexture(u),
                n && a.setEnable(!0),
                a.setFactor(void 0 === r ? 1 : r)
            })
        },
        tagVertexColorMaterial: function(t, e) {
            var i = new m(this,e);
            t.accept(i)
        },
        findFirstMaterial: function() {
            var t = new g;
            return function(e) {
                var i = e.length
                  , n = e[i - 1];
                if (n._mostInfluencedRig)
                    return t.reset(),
                    t.setManager(this),
                    n._mostInfluencedRig.accept(t),
                    t._material;
                for (var r = i - 1; r >= 0; --r) {
                    var a = e[r].getStateSet();
                    if (a) {
                        var s = this.getMaterialByStateSet(a);
                        if (s)
                            return s
                    }
                }
            }
        }()
    });
    t.exports = v
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(216)
      , a = i(238)
      , s = i(1551)
      , o = i(1552)
      , u = i(1467)
      , l = i(1542)
      , c = n.osg
      , h = 3
      , d = r.invert(c.CullFace)
      , p = function() {
        var t = {};
        return [{
            name: "DiffuseColor",
            displayName: "Diffuse",
            color: u() ? c.Vec3.createAndSet(1, 1, 1) : c.Vec3.createAndSet(.5, .5, .5),
            factor: 1,
            enable: !0
        }, {
            name: "DiffuseIntensity",
            displayName: "Lightmap",
            color: c.Vec3.createAndSet(1, 1, 1),
            factor: 1,
            enable: !0
        }, {
            name: "SpecularColor",
            displayName: "Specular Color",
            color: c.Vec3.createAndSet(.5, .5, .5),
            factor: 0,
            enable: !0
        }, {
            name: "SpecularHardness",
            displayName: "Glossiness",
            factor: 12.5,
            enable: !0
        }, {
            name: "Displacement",
            displayName: "Displacement",
            factor: 0,
            enable: !0
        }, {
            name: "NormalMap",
            displayName: "Normal map",
            factor: 1,
            enable: !1,
            flipY: !0
        }, {
            name: "BumpMap",
            displayName: "Bump map",
            factor: 1,
            enable: !1
        }, {
            name: "Opacity",
            displayName: "Transparency",
            factor: 1,
            type: "alphaBlend",
            enable: !0
        }, {
            name: "EmitColor",
            displayName: "Emission",
            color: c.Vec3.createAndSet(1, 1, 1),
            factor: 0,
            enable: !0,
            type: "additive"
        }, {
            name: "DiffusePBR",
            displayName: "Albedo",
            color: c.Vec3.createAndSet(1, 1, 1),
            factor: 1,
            enable: !1
        }, {
            name: "AlbedoPBR",
            displayName: "Base Color",
            color: c.Vec3.createAndSet(1, 1, 1),
            factor: 1,
            enable: !0
        }, {
            name: "SpecularPBR",
            displayName: "Specular",
            color: c.Vec3.createAndSet(1, 1, 1),
            factor: .05,
            enable: !1
        }, {
            name: "GlossinessPBR",
            displayName: "Glossiness",
            factor: .4,
            enable: !1
        }, {
            name: "RoughnessPBR",
            displayName: "Roughness",
            factor: .6,
            enable: !0
        }, {
            name: "MetalnessPBR",
            displayName: "Metalness",
            factor: 0,
            enable: !0
        }, {
            name: "SpecularF0",
            displayName: "Specular F0",
            factor: .5,
            enable: !0
        }, {
            name: "AOPBR",
            displayName: "Ambient Occlusion",
            factor: 1,
            enable: !1,
            occludeSpecular: !1
        }, {
            name: "CavityPBR",
            displayName: "Cavity",
            factor: 1,
            enable: !1
        }].forEach(function(e) {
            var i = e.name;
            t[i] = new s[i].model(e)
        }, t),
        t
    }
      , f = function() {
        return {
            version: h,
            shadeless: !1,
            id: "0",
            stateSetID: 0,
            name: "noname",
            channels: p(),
            texCoordUnitList: [],
            cullFace: c.CullFace.DISABLE,
            reflection: u() ? .1 : .3,
            hasVertexColor: !1,
            hasVertexAlpha: !1
        }
    }
      , g = a.extend({
        defaults: function() {
            return f()
        },
        setMaterial: function(t) {
            this.set(t),
            r.each(t.channels, function(t, e) {
                this.getChannels()[e].set(t)
            }, this)
        },
        setMaterialJSON: function(t, e) {
            void 0 !== t.version && this.set("version", t.version),
            void 0 !== t.shadeless && this.set("shadeless", t.shadeless),
            void 0 !== t.id && this.set("id", t.id),
            void 0 !== t.stateSetID && this.set("stateSetID", t.stateSetID),
            void 0 !== t.name && this.set("name", t.name),
            void 0 !== t.texCoordUnitList && this.set("texCoordUnitList", t.texCoordUnitList),
            void 0 !== t.reflection && this.set("reflection", t.reflection),
            void 0 !== t.cullFace && this.set("cullFace", c.CullFace[t.cullFace]);
            var i = t.channels;
            if (i)
                for (var n = this.getChannels(), r = l.length, a = 0; a < r; ++a) {
                    var s = l[a]
                      , o = i[s];
                    if (o) {
                        var u = n[s];
                        u && u.setChannelJSON(o, e)
                    }
                }
        },
        getChannels: function() {
            return this.get("channels")
        },
        setStateSet: function(t) {
            return this.set("stateSet", t),
            this
        },
        setTexCoordUnitList: function(t) {
            return this.set("texCoordUnitList", t)
        },
        setChannelEnable: function(t, e) {
            var i = this.get("channels");
            return i[t] ? (i[t].setEnable(e),
            this) : this
        },
        setChannelColor: function(t, e) {
            var i = this.get("channels");
            return i[t] ? (i[t].setColor(e),
            this) : this
        },
        setChannelTexture: function(t, e) {
            var i = this.get("channels");
            return i[t] ? (i[t].setTexture(e),
            this) : this
        },
        setChannelFactor: function(t, e) {
            var i = this.get("channels");
            return i[t] ? (i[t].setFactor(e),
            this) : this
        },
        cleanMaterialJSON: function(t) {
            r.forEach(t.channels, function(t) {
                o.prototype.cleanChannelJSON(t)
            })
        },
        getJSON: function() {
            var t = {};
            t.version = h,
            t.stateSetID = this.get("stateSetID"),
            t.shadeless = this.get("shadeless"),
            t.id = this.get("id"),
            t.name = this.get("name"),
            t.texCoordUnitList = this.get("texCoordUnitList"),
            t.cullFace = d[this.get("cullFace")],
            t.reflection = this.get("reflection");
            var e = {};
            return r.each(this.get("channels"), function(t, i) {
                e[i] = t.getJSON()
            }),
            t.channels = e,
            t
        },
        copyDualChannel: function(t, e) {
            var i = this.getChannels()
              , n = i[t]
              , r = i[e]
              , a = r.getTexture()
              , s = "MetalnessPBR" === t || "SpecularPBR" === t
              , o = "NormalMap" === t || "BumpMap" === t;
            a ? (a = a.clone(),
            (s || o) && (a.setImage(a.getImage()),
            a.set("internalFormat", "NormalMap" === t || "SpecularPBR" === t ? c.Texture.RGB : c.Texture.LUMINANCE),
            a.updateTextureProxy()),
            n.setTexture(a)) : s || n.setColor(r.getColor()),
            o || n.setFactor(r.getFactor())
        },
        getWorkFlowPBRMetalSpec: function() {
            return this.getChannels().MetalnessPBR.getEnable()
        },
        getWorkFlowPBRRoughGloss: function() {
            return this.getChannels().RougnessPBR.getEnable()
        },
        setWorkFlowRoughGloss: function(t, e) {
            var i = t ? "GlossinessPBR" : "RoughnessPBR"
              , n = t ? "RoughnessPBR" : "GlossinessPBR"
              , r = this.getChannels();
            r[i].setEnable(!1),
            r[n].setEnable(!0),
            e && this.copyDualChannel(n, i, r)
        },
        setWorkFlowMetalSpec: function(t, e) {
            var i = t ? "DiffusePBR" : "AlbedoPBR"
              , n = t ? "SpecularPBR" : "MetalnessPBR"
              , r = t ? "AlbedoPBR" : "DiffusePBR"
              , a = t ? "MetalnessPBR" : "SpecularPBR"
              , s = this.getChannels();
            s[i].setEnable(!1),
            s[n].setEnable(!1),
            s.SpecularF0.setEnable(t),
            s[r].setEnable(!0),
            s[a].setEnable(!0),
            e && (this.copyDualChannel(r, i),
            this.copyDualChannel(a, n))
        }
    });
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1552)
      , a = i(1553);
    i(1554);
    var s = n.osg
      , o = {};
    o.view = a,
    o.model = r;
    var u = {}
      , l = u.view = a
      , c = u.model = r.extend({
        _checkEffective: function() {
            if (!this.isActivated() || !this.getEnable())
                return 0;
            var t = this.getName()
              , e = this.getTexture()
              , i = this.getFactor();
            if (0 === i) {
                var n = !1;
                switch (t) {
                case "DiffusePBR":
                case "AlbedoPBR":
                case "SpecularPBR":
                case "GlossinessPBR":
                case "RoughnessPBR":
                case "MetalnessPBR":
                case "SpecularF0":
                    n = !0
                }
                return n ? 2 : 0
            }
            return "AOPBR" !== t && "CavityPBR" !== t || e ? 1 : 0
        },
        isEffective: function() {
            return 1 === this._checkEffective()
        },
        isEnableEffective: function() {
            return 0 !== this._checkEffective()
        }
    })
      , h = {};
    h.view = a.extend({
        initialize: function() {
            a.prototype.initialize.apply(this, arguments),
            this.model.on("change:type", this.changeType, this),
            this.model.on("change:invert", this.updateChannel, this),
            this.model.on("change:vertexAlphaEnable", this.updateChannel, this),
            this._isMasking = "alphaMask" === this.model.getTransparency()
        },
        updateChannel: function() {
            var t = this.model.getTexture()
              , e = t ? t.getTextureProxy() : void 0;
            if (e) {
                var i = t.getImage()
                  , n = t.getImage().getName() || e.getImage().getURL()
                  , r = n.toLowerCase()
                  , o = i.get("alpha") === !1 || r.indexOf("jpg") !== -1 || r.indexOf("jpeg") !== -1;
                o && (t.set("internalFormat", s.Texture.LUMINANCE),
                t.updateTextureProxy())
            }
            a.prototype.updateChannel.call(this)
        },
        changeType: function() {
            var t = "alphaMask" === this.model.getTransparency();
            if (t !== this._isMasking) {
                this._isMasking = t;
                var e = this.model.getTexture();
                if (e && e.get("magFilter") !== s.Texture.NEAREST) {
                    var i = e.get("minFilter")
                      , n = i;
                    t && i === s.Texture.LINEAR_MIPMAP_LINEAR ? n = s.Texture.LINEAR : t || i !== s.Texture.LINEAR || (n = this._blendFilter),
                    n && (e.set("minFilter", i),
                    e.set("magFilter", i === s.Texture.LINEAR_MIPMAP_LINEAR ? s.Texture.LINEAR : i),
                    e.updateTextureProxy())
                }
            }
            this.updateChannel()
        }
    });
    var d = {
        alphaMask: 1,
        alphaBlend: 1,
        additive: 1,
        dithering: 1
    };
    h.model = r.extend({
        defaults: function() {
            var t = r.prototype.defaults.apply(this, arguments);
            return t.type = "alphaBlend",
            t.invert = !1,
            t.vertexAlphaEnable = !1,
            t
        },
        getTransparency: function() {
            return this.get("type")
        },
        setTransparency: function(t) {
            return d[t] ? void this.set("type", t) : void s.error("Invalid transparency type given : " + t)
        },
        setChannelJSON: function(t, e) {
            r.prototype.setChannelJSON.call(this, t, e),
            t.type && this.setTransparency(t.type),
            void 0 !== t.invert && this.set("invert", t.invert)
        },
        getJSON: function() {
            var t = r.prototype.getJSON.apply(this);
            return t.type = this.get("type"),
            t.invert = this.get("invert"),
            t
        },
        isEffective: function() {
            if (!this.isActivated() || !this.getEnable())
                return !1;
            var t = this.getTransparency()
              , e = this.getFactor()
              , i = this.getTexture()
              , n = !i && !this.get("vertexAlphaEnable");
            return ("alphaMask" !== t || 0 !== e && !n) && ("alphaBlend" !== t && "dithering" !== t || 1 !== e || !n)
        }
    });
    var p = {};
    p.view = l.extend({
        initialize: function() {
            l.prototype.initialize.apply(this, arguments),
            this.model.on("change:occludeSpecular", this.updateChannel, this)
        }
    }),
    p.model = c.extend({
        defaults: function() {
            var t = c.prototype.defaults.call(this);
            return t.occludeSpecular = !1,
            t
        },
        setChannelJSON: function(t, e) {
            c.prototype.setChannelJSON.call(this, t, e),
            void 0 !== t.occludeSpecular && this.set("occludeSpecular", t.occludeSpecular)
        },
        getJSON: function() {
            var t = c.prototype.getJSON.apply(this);
            return t.occludeSpecular = this.get("occludeSpecular"),
            t
        }
    });
    var f = {};
    f.view = a.extend({}),
    f.model = r.extend({
        isEffective: function() {
            return !(!this.isActivated() || !this.getEnable()) && !(0 === this.getFactor() || !this.getTexture())
        }
    });
    var g = {};
    g.view = a.extend({
        updateChannel: function() {
            a.prototype.updateChannel.call(this);
            for (var t = this.model.isEffective() ? this.model.getFactor() : 0, e = this.model.get("geometryList"), i = 0, n = e.length; i < n; ++i) {
                var r = e[i];
                r._displacementFactor = Math.max(r._displacementFactor || 0, t),
                r.dirtyBound()
            }
        }
    }),
    g.model = r.extend({
        defaults: function() {
            var t = r.prototype.defaults.apply(this, arguments);
            return t.geometryList = [],
            t
        },
        setTexture: function(t) {
            return t.get("minFilter") === s.Texture.LINEAR_MIPMAP_LINEAR && (t.set("minFilter", s.Texture.LINEAR),
            t.updateTextureProxy()),
            r.prototype.setTexture.call(this, t)
        },
        isEffective: function() {
            return !(!this.isActivated() || !this.getEnable()) && (!(0 === this.getFactor() || !this.getTexture()) && 0 !== s.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_TEXTURE_IMAGE_UNITS"))
        }
    });
    var m = {};
    m.view = a.extend({
        initialize: function() {
            a.prototype.initialize.apply(this, arguments),
            this.model.on("change:flipY", this.updateChannel, this)
        }
    }),
    m.model = r.extend({
        defaults: function() {
            var t = r.prototype.defaults.call(this);
            return t.flipY = !1,
            t
        },
        getJSON: function() {
            var t = r.prototype.getJSON.apply(this);
            return t.flipY = this.get("flipY"),
            t
        },
        setChannelJSON: function(t, e) {
            r.prototype.setChannelJSON.call(this, t, e),
            void 0 !== t.flipY && this.set("flipY", t.flipY)
        },
        isEffective: function() {
            return !(!this.isActivated() || !this.getEnable()) && !(0 === this.getFactor() || !this.getTexture())
        }
    });
    var v = {};
    v.view = a.extend({
        initialize: function() {
            a.prototype.initialize.apply(this, arguments),
            this.model.on("change:type", this.updateChannel, this)
        }
    }),
    v.model = r.extend({
        defaults: function() {
            var t = r.prototype.defaults.apply(this, arguments);
            return t.type = "additive",
            t
        },
        getJSON: function() {
            var t = r.prototype.getJSON.apply(this);
            return t.type = this.get("type"),
            t
        },
        setChannelJSON: function(t, e) {
            r.prototype.setChannelJSON.call(this, t, e),
            void 0 !== t.type && this.set("type", t.type)
        },
        isEffective: function() {
            return !(!this.isActivated() || !this.getEnable()) && (0 !== this.getFactor() || "additive" !== this.get("type"))
        }
    });
    var _ = {
        DiffusePBR: u,
        AlbedoPBR: u,
        SpecularPBR: u,
        GlossinessPBR: u,
        RoughnessPBR: u,
        MetalnessPBR: u,
        SpecularF0: u,
        CavityPBR: u,
        DiffuseColor: o,
        SpecularColor: o,
        DiffuseIntensity: o,
        SpecularHardness: o,
        Displacement: g,
        NormalMap: m,
        AOPBR: p,
        BumpMap: f,
        EmitColor: v,
        Opacity: h
    };
    t.exports = _
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(238)
      , a = i(1542)
      , s = i(1543)
      , o = i(1531)
      , u = i(216)
      , l = n.osg
      , c = function(t) {
        return t[0] + t[1] + t[2] < 1e-4
    }
      , h = function(t) {
        return t[0] + t[1] + t[2] > 2.9999
    }
      , d = r.extend({
        defaults: function() {
            return {
                texture: void 0,
                color: l.Vec3.createAndSet(1, 1, 1),
                factor: 1,
                enable: !0
            }
        },
        initialize: function() {
            r.prototype.initialize.apply(this, arguments),
            this.get("color") && this.get("texture") && this.set("color", void 0)
        },
        createTextureModel: function(t, e) {
            var i = e.get(t.uid);
            return i ? new o(u.extend(t, {
                image: i
            })) : void l.error("can't find ImageProxy " + t.uid)
        },
        setChannelJSON: function(t, e) {
            if (void 0 !== t.enable && this.setEnable(t.enable),
            void 0 !== t.factor && this.setFactor(t.factor),
            t.texture) {
                var i = this.createTextureModel(t.texture, e);
                i ? this.setTexture(i) : this.setColor(t.color || l.Vec3.createAndSet(1, 1, 1))
            } else
                t.color && this.setColor(t.color)
        },
        getName: function() {
            return this.get("name")
        },
        setFactor: function(t) {
            return this.set("factor", t),
            this.trigger("setFactor")
        },
        getFactor: function() {
            return this.get("factor")
        },
        getTexture: function() {
            return this.get("texture")
        },
        setTexture: function(t) {
            return this.set("color", void 0),
            this.set("texture", t),
            this.trigger("setTexture")
        },
        setTexCoordUnit: function(t) {
            var e = this.get("texture");
            void 0 !== e && (e.set("texCoordUnit", t),
            this.trigger("change:uv"))
        },
        setEnable: function(t) {
            return this.set("enable", t)
        },
        getEnable: function() {
            return this.get("enable")
        },
        getTexCoordUnit: function() {
            var t = this.get("texture");
            if (t)
                return t.get("texCoordUnit")
        },
        getColor: function() {
            return this.get("color")
        },
        setColor: function(t) {
            return this.set("texture", void 0),
            this.set("color", l.Vec3.copy(t, this.get("color") || l.Vec3.create())),
            this.trigger("setColor")
        },
        removeTexture: function() {
            this.setColor(l.Vec3.one)
        },
        reset: function() {
            return this.removeTexture(),
            this.set("factor", 1),
            this.trigger("updateChannels")
        },
        getJSON: function() {
            var t = {}
              , e = this.get("texture");
            void 0 !== e && (t.texture = e.getJSON());
            var i = this.get("color");
            return void 0 !== i && (t.color = i),
            t.factor = this.get("factor"),
            t.enable = this.get("enable"),
            t
        },
        resetTextureFormat: function() {
            var t = this.getTexture();
            t && (t.set("internalFormat", a.getDefaultFormat(this.getName())),
            t.updateTextureProxy())
        },
        isEffective: function() {
            if (!this.isActivated() || !this.getEnable())
                return !1;
            var t = .01
              , e = this.getName()
              , i = this.getColor()
              , n = this.getFactor();
            return "SpecularHardness" === e || !(n < t) && ((!i || !c(i)) && !("DiffuseIntensity" === e && i && h(i) && n > 1 - t))
        },
        isEnableEffective: function() {
            return this.isEffective()
        },
        isActivated: function() {
            return !!(a.getShadingMask(this.getName()) & s.get("mask"))
        },
        shouldDisplayGUIWarningOnDeletion: function() {
            if (!this.getEnable())
                return !1;
            var t = s.get("mask") & s.CLASSIC ? s.CLASSIC : s.PBR;
            return !!(a.getShadingMask(this.getName()) & t)
        }
    });
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(258)
      , r = i(1486)
      , a = n.extend({
        initialize: function() {
            n.prototype.initialize.apply(this, arguments),
            this.model.on("change:enable", this.updateChannel, this),
            this.model.on("change:uv", this.changeTexCoord, this),
            this.model.on("setFactor", this.updateChannel, this),
            this.model.on("setColor", this.updateChannel, this),
            this.model.on("setTexture", this.updateChannel, this),
            this.model.on("updateChannels", this.updateChannel, this),
            this.model.on("all", r.draw)
        },
        getStateSetContext: function() {
            return this.options.stateSetContext
        },
        updateChannel: function() {
            var t = this.getStateSetContext();
            if (this.model.getTexture() && void 0 === this.model.getTexCoordUnit()) {
                var e = t._material.get("texCoordUnitList");
                this.model.setTexCoordUnit(e && e.length > 0 ? e[0] : 0)
            }
            t.updateChannel(this.model)
        },
        apply: function() {
            this.updateChannel()
        },
        changeTexCoord: function() {
            this.getStateSetContext().setTexCoord(this.model)
        }
    });
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = r.Geometry.prototype.computeBoundingBox;
    r.Geometry.prototype.computeBoundingBox = function(t) {
        a.call(this, t);
        var e = this._displacementFactor = this._displacementFactor || 0;
        if (e) {
            var i = t.getMin()
              , n = t.getMax();
            i[0] -= e,
            i[1] -= e,
            i[2] -= e,
            n[0] += e,
            n[1] += e,
            n[2] += e
        }
        return t
    }
    ;
    var s = r.Geometry.prototype.computeBoundingSphere;
    r.Geometry.prototype.computeBoundingSphere = function(t) {
        s.call(this, t);
        var e = this._displacementFactor = this._displacementFactor || 0;
        return e && t.set(t.center(), t.radius() * e),
        t
    }
    ,
    t.exports = r.Geometry
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(258)
      , a = i(1551)
      , s = i(1556)
      , o = i(1486)
      , u = i(1542)
      , l = r.extend({
        initialize: function() {
            r.prototype.initialize.apply(this, arguments),
            this.model.bind("change:stateSet", this.stateSet, this),
            this.model.bind("change:shadeless", this.onShadeless, this),
            this.model.bind("change:cullFace", this.onCullFace, this),
            this.model.bind("change:reflection", this.onReflection, this),
            this.model.bind("apply", this.apply, this),
            this.model.bind("change", o.draw),
            this._context = new s(this.model),
            this._views = {};
            for (var t = this.model.get("channels"), e = u.length, i = 0; i < e; ++i) {
                var n = u[i]
                  , l = t[n];
                this._views[n] = new a[n].view({
                    model: l,
                    stateSetContext: this._context
                }),
                l.bind("change:enable", this.onEnableChanged, this)
            }
        },
        getStateSetContext: function() {
            return this._context
        },
        stateSet: function() {
            var t = this.model.get("stateSet");
            return t.setName(this.model.get("name")),
            this.getStateSetContext().setStateSet(t),
            this
        },
        apply: function() {
            n.each(this._views, function(t) {
                t.apply()
            }, this),
            this.onShadeless(),
            this.onCullFace(),
            this.onReflection()
        },
        onShadeless: function() {
            var t = this.model.get("shadeless");
            this.getStateSetContext().setShadeless(t)
        },
        onCullFace: function() {
            var t = this.model.get("cullFace");
            this.getStateSetContext().setCullface(t)
        },
        onReflection: function() {
            var t = this.model.get("reflection");
            this.getStateSetContext().setReflection(t)
        },
        onEnableChanged: function(t, e) {
            if (e === !0) {
                var i = t.getName()
                  , n = this.model.getChannels();
                "BumpMap" === i ? n.NormalMap.setEnable(!1) : "NormalMap" === i && n.BumpMap.setEnable(!1),
                "GlossinessPBR" === i ? n.RoughnessPBR.setEnable(!1) : "RoughnessPBR" === i && n.GlossinessPBR.setEnable(!1),
                "AlbedoPBR" === i || "MetalnessPBR" === i ? (n.DiffusePBR.setEnable(!1),
                n.SpecularPBR.setEnable(!1)) : "DiffusePBR" !== i && "SpecularPBR" !== i || (n.AlbedoPBR.setEnable(!1),
                n.MetalnessPBR.setEnable(!1))
            }
            return this
        }
    });
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1557)
      , a = i(1483)
      , s = i(1558)
      , o = i(1559)
      , u = i(1516)
      , l = i(1542)
      , c = i(1560)
      , h = i(1515)
      , d = i(1482)
      , p = n.osg
      , f = p.Texture.textureNull
      , g = new p.CullFace(p.CullFace.BACK)
      , m = new p.CullFace(p.CullFace.DISABLE)
      , v = function(t) {
        this._stateSet = void 0,
        this._material = t,
        this._channelTextureMaterialActive = {},
        this._channelTextureMaterialCache = {},
        this._channelTextureMaterialColorCache = {},
        this._channelTextureColorCache = {},
        this._channelCanvasColorCache = {},
        this._channelNameToTextureUnit = {},
        this._maxTextureUnit = o()
    }
      , _ = {
        "0,0,0": null,
        "255,255,255": null
    }
      , b = {
        "0,0,0": null,
        "255,255,255": null
    };
    v.prototype = {
        isActive: function(t) {
            return void 0 !== this._channelTextureMaterialActive[t]
        },
        getSketchfabMaterial: function() {
            return this._stateSet.getAttribute("SketchfabMaterial")
        },
        setStateSetAlphaBlending: function() {
            this._stateSet && (this._stateSet.setRenderBinDetails(u.TRANSPARENT_BIN, "DepthSortedBin"),
            h.registerStateSetTransparency(this._stateSet))
        },
        setStateSetOpaque: function() {
            this._stateSet && (this._stateSet.setRenderBinDetails(u.OPAQUE_BIN, "RenderBin"),
            h.registerStateSetOpaque(this._stateSet))
        },
        setCullface: function(t) {
            this._stateSet && (this._stateSet.setAttributeAndModes(t ? g : m),
            this.getSketchfabMaterial().setCullFace(t ? p.CullFace.BACK : p.CullFace.DISABLE))
        },
        setShadeless: function(t) {
            this._stateSet && this.getSketchfabMaterial().setShadeless(t)
        },
        setReflection: function(t) {
            this._stateSet && this.getSketchfabMaterial().setReflection(t)
        },
        getAvailableTextureUnit: function() {
            var t = this._stateSet
              , e = t.getNumTextureAttributeLists()
              , i = 0;
            for (i = 0; i <= e; i++) {
                6 === i && i++;
                var n = t.getTextureAttribute(i, "Texture");
                if (void 0 === n || n === f)
                    break
            }
            return i < this._maxTextureUnit ? i : -1
        },
        getStateSet: function() {
            return this._stateSet
        },
        setStateSet: function(t) {
            this._stateSet = t;
            var e = t.getAttribute("SketchfabMaterial");
            void 0 === e && (e = new a,
            t.setAttributeAndModes(e),
            e.setName(t.getName()));
            for (var i = 0, n = t.getNumTextureAttributeLists(); i < n; i++)
                t.removeTextureAttribute(i, "Texture")
        },
        enableAlphaBlending: function() {
            this._stateSet && this.setStateSetAlphaBlending()
        },
        disableTransparency: function() {
            this._stateSet && this.setStateSetOpaque()
        },
        setTexCoord: function(t) {
            if (this._stateSet) {
                var e = t.getTexCoordUnit()
                  , i = t.getName()
                  , n = this._channelTextureMaterialActive[i];
                n && n.setTexCoordUnit(e)
            }
        },
        getOrCreateTextureMaterial: function(t, e, i) {
            var n = this._channelTextureMaterialCache[t];
            n ? n.setTexture(e) : n = this._channelTextureMaterialCache[t] = new s(e,t);
            var r = "unknown" === i || void 0 === i;
            return n.setSRGB(r ? void 0 : "srgb" === i),
            n
        },
        getOrCreateTextureMaterialColor: function(t, e) {
            var i = this._channelTextureMaterialColorCache[t]
              , n = "Opacity" === t ? p.Texture.LUMINANCE : l.getDefaultFormat(t)
              , a = l.isSRGB(t);
            a && (e = c.linearToSrgb(e));
            var o, u = [Math.round(255 * e[0]), Math.round(255 * e[1]), Math.round(255 * e[2])].join(","), h = n === p.Texture.LUMINANCE ? b : _, d = h[u];
            return null === d ? (o = document.createElement("canvas"),
            r.setCanvasFromVec3(e, o),
            d = h[u] = new p.Texture,
            d.setImage(o)) : void 0 === d && (o = this._channelCanvasColorCache[t],
            o || (o = this._channelCanvasColorCache[t] = document.createElement("canvas")),
            r.setCanvasFromVec3(e, o),
            d = this._channelTextureColorCache[t],
            d || (d = this._channelTextureColorCache[t] = new p.Texture),
            d.setImage(o)),
            i ? (i.setTexture(d),
            i.dirty()) : i = this._channelTextureMaterialColorCache[t] = new s(d,t),
            d.setInternalFormat(n),
            i.setSRGB(a),
            i
        },
        setTextureMaterialToStateSet: function(t, e, i) {
            var n = t.getName()
              , r = this.getTextureUnitFromChannelName(n)
              , a = t.getTexCoordUnit();
            if (void 0 === a && (a = 0),
            e.setTexCoordUnit(a),
            !(r < 0 && (r = this.getAvailableTextureUnit(),
            r < 0))) {
                if ("Opacity" === n) {
                    var s = t.getTransparency()
                      , o = "alphaMask" === s || "dithering" === s;
                    e.setName(o ? "AlphaMask" : "Opacity"),
                    e.setInvert(!i && t.get("invert")),
                    e.setDithering("dithering" === s)
                } else
                    "NormalMap" === n ? e.setFlipY(t.get("flipY")) : "AOPBR" === n ? e.setOccludeSpecular(t.get("occludeSpecular")) : "EmitColor" === n && e.setEmitType(t.get("type"));
                this.setTextureToUnit(e, r, n),
                this._channelTextureMaterialActive[n] = e,
                e.setFactor(t.getFactor())
            }
        },
        setTextureToUnit: function(t, e, i) {
            "Opacity" === i || "Displacement" === i ? this._stateSet.setTextureAttributeAndModes(e, t, p.StateAttribute.PROTECTED) : this._stateSet.setTextureAttributeAndModes(e, t),
            this._channelNameToTextureUnit[i] = e
        },
        setTexture: function(t) {
            if (this._stateSet) {
                var e = t.getTexture()
                  , i = e.getImage()
                  , n = e.getTextureProxy();
                if (i && n) {
                    var r = i.get("colorSpace")
                      , a = t.getName();
                    this.setTextureMaterialToStateSet(t, this.getOrCreateTextureMaterial(a, n, r));
                    var s = d.getLowResLoaded()
                      , o = n.setImageMaxSupported.bind(n);
                    return s.isFulfilled() ? o() : void n.setImageSmallest().promise.then(function() {
                        s.then(o)
                    })
                }
            }
        },
        setColor: function(t, e) {
            if (this._stateSet) {
                var i = this.getOrCreateTextureMaterialColor(t.getName(), e || t.getColor());
                this.setTextureMaterialToStateSet(t, i, !0)
            }
        },
        getTextureUnitFromChannelName: function(t) {
            var e = this._channelNameToTextureUnit[t];
            if (void 0 === e || e < 0)
                return -1;
            var i = this._stateSet.getTextureAttribute(e, "Texture");
            if (i && i !== f) {
                var n = i.getName();
                if (n === t || "Opacity" === t && "AlphaMask" === n)
                    return e
            }
            return -1
        },
        disableChannel: function(t) {
            if (this._stateSet) {
                var e = t.getName()
                  , i = this.getTextureUnitFromChannelName(e);
                i < 0 && (i = this.getAvailableTextureUnit()),
                i < 0 || this.setTextureToUnit(f, i, e)
            }
        },
        setChannelEnable: function() {
            var t = p.Vec3.create();
            return function(e, i) {
                return i === !1 ? this.disableChannel(e) : e.isEffective() ? e.getTexture() ? this.setTexture(e) : e.getColor() ? this.setColor(e) : void 0 : this.setColor(e, t)
            }
        }(),
        setChannelOpacity: function(t, e) {
            var i = t.getTransparency()
              , n = "additive" === i
              , r = "alphaBlend" === i
              , a = "alphaMask" === i
              , s = "dithering" === i;
            if (this._stateSet) {
                var o = this.getSketchfabMaterial();
                o.setAdditive(n);
                var u = !e || a || s;
                !u && r && 1 === t.getFactor() && (u = !!t.getTexture() || t.get("vertexAlphaEnable")),
                o.setOpaqueEarlyZ(u)
            }
            return e === !1 ? this.disableTransparency() : a || s ? this.disableTransparency() : r || n ? this.enableAlphaBlending() : void p.warn("Unknow alpha type : " + i)
        },
        updateChannel: function(t) {
            var e = t.isEnableEffective();
            this.setChannelEnable(t, e),
            "Opacity" === t.getName() && this.setChannelOpacity(t, e),
            this.checkInterChannelOptimizations(t)
        },
        checkInterChannelOptimizations: function(t) {
            var e = this._material.getChannels()
              , i = t.getName();
            if ("DiffuseIntensity" === i || "DiffuseColor" === i) {
                var n = e.DiffuseIntensity
                  , r = e.DiffuseColor;
                if (r.isEffective() === !1)
                    return void this.setChannelEnable(n, !1);
                this.setChannelEnable(r, n.getEnable() === !1 || n.getFactor() > 0),
                this.setChannelEnable(n, n.isEffective())
            }
        }
    },
    t.exports = v
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        var e = Math.round(100 * t[0])
          , i = Math.round(100 * t[1])
          , n = Math.round(100 * t[2])
          , r = "rgb(" + e + "%, " + i + "%, " + n + "% )"
          , a = document.createElement("canvas");
        a.width = a.height = 1;
        var s = a.getContext("2d");
        s.fillStyle = r,
        s.fillRect(0, 0, 1, 1);
        var o = new Image;
        return o.src = a.toDataURL(),
        o
    }
      , n = function(t, e) {
        var i = Math.round(255 * t[0])
          , n = Math.round(255 * t[1])
          , r = Math.round(255 * t[2]);
        e.width = e.height = 1;
        var a = e.getContext("2d")
          , s = a.createImageData(1, 1);
        s.data[0] = i,
        s.data[1] = n,
        s.data[2] = r,
        s.data[3] = 255,
        a.putImageData(s, 0, 0)
    }
      , r = function(t) {
        return 1 === t.width && 1 === t.height
    }
      , a = function(t) {
        var e = document.createElement("canvas");
        e.width = e.height = 1;
        var i = e.getContext("2d");
        i.drawImage(t, 0, 0);
        var n = i.getImageData(0, 0, 1, 1);
        return [n.data[0] / 255, n.data[1] / 255, n.data[2] / 255]
    };
    t.exports = {
        createImageFromVec3: i,
        isImageColor: r,
        getColorFromImage: a,
        setCanvasFromVec3: n
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1484)
      , a = i(1542)
      , s = n.osg
      , o = function(t, e) {
        this._texture = t,
        this._channelName = e,
        this._factor = 1,
        this._texCoordUnit = void 0,
        this._sRGB = !0,
        this._samplerName = "sTexture" + e,
        this._emitType = "additive",
        this._dithering = !1,
        this._flipY = !1,
        this._invert = !1,
        this._occludeSpecular = !1
    };
    o.ChannelType = ["AlphaMask"].concat(a),
    o.uniforms = [],
    o.prototype = s.objectLibraryClass(s.objectInherit(s.Texture.prototype, {
        attributeType: "Texture",
        channelType: o.ChannelType,
        getImage: function() {
            return this._texture.getImage()
        },
        cloneType: function() {
            return new o(new r)
        },
        isTextureNull: function() {
            return this._texture.isTextureNull()
        },
        setChannelName: function(t) {
            this._channelName = t
        },
        getChannelType: function() {
            return this.channelType
        },
        setFactor: function(t) {
            this._factor = t
        },
        getFactor: function() {
            return this._factor
        },
        setTexture: function(t) {
            this._texture = t
        },
        getTexture: function() {
            return this._texture
        },
        setTexCoordUnit: function(t) {
            this._texCoordUnit = t
        },
        getTexCoordUnit: function() {
            return this._texCoordUnit
        },
        getType: function() {
            return this.attributeType
        },
        getTypeMember: function() {
            return this.attributeType
        },
        setFlipY: function(t) {
            this._flipY = t
        },
        getFlipY: function() {
            return this._flipY
        },
        setDithering: function(t) {
            this._dithering = t
        },
        getDithering: function() {
            return this._dithering
        },
        setEmitType: function(t) {
            this._emitType = "additive" === t ? 0 : 1
        },
        getEmitType: function() {
            return this._emitType
        },
        setInvert: function(t) {
            this._invert = t
        },
        getInvert: function() {
            return this._invert
        },
        setOccludeSpecular: function(t) {
            this._occludeSpecular = t
        },
        getOccludeSpecular: function() {
            return this._occludeSpecular
        },
        getName: function() {
            return this._channelName
        },
        setName: function(t) {
            this._channelName = t
        },
        setSRGB: function(t) {
            return t === !0 ? void (this._sRGB = !0) : t === !1 ? void (this._sRGB = !1) : void (this._sRGB = a.isSRGB("AlphaMask" === this._channelName ? "Opacity" : this._channelName))
        },
        getSRGB: function() {
            return this._sRGB
        },
        getOrCreateUniformSharedOnTextureUnit: function() {
            var t = o.uniformsSharedOnTextureUnit;
            if (t)
                return t;
            var e = {};
            return o.ChannelType.forEach(function(t) {
                var i = "sTexture" + t;
                e[i] || (e[i] = s.Uniform.createInt(0, i));
                var n = "u" + t + "Factor";
                if (e[t] = s.Uniform.createFloat(n),
                "BumpMap" === t || "Displacement" === t) {
                    var r = "u" + t + "Size";
                    e[r] = s.Uniform.createFloat2(s.Vec2.create(), r)
                } else
                    "NormalMap" === t ? e.uFlipY = s.Uniform.createInt("uFlipY") : "AOPBR" === t ? e.uOccludeSpecular = s.Uniform.createInt("uOccludeSpecular") : "Opacity" === t || "AlphaMask" === t ? (e.uInvert = s.Uniform.createInt("uInvert"),
                    "AlphaMask" === t && (e.uDithering = s.Uniform.createInt("uDithering"))) : "EmitColor" === t && (e.uEmitType = s.Uniform.createInt("uEmitType"))
            }),
            o.uniformsSharedOnTextureUnit = new s.Map(e),
            o.uniformsSharedOnTextureUnit
        },
        getOrCreateUniforms: function(t) {
            var e = o.uniforms;
            if (e[t])
                return e[t];
            var i = this.getOrCreateUniformSharedOnTextureUnit();
            return e[t] = i,
            e[t]
        },
        getSamplerName: function() {
            return this._samplerName
        },
        apply: function(t, e) {
            void 0 !== this._texture && this._texture.apply(t);
            var i = this._channelName;
            if (i) {
                var n = this.getOrCreateUniforms(e);
                n[i].getInternalArray()[0] !== this._factor && n[i].setFloat(this._factor);
                var r = n[this.getSamplerName()];
                if (r.getInternalArray()[0] !== e && r.setInt(e),
                "BumpMap" === i || "Displacement" === i) {
                    var a = n["u" + i + "Size"].getInternalArray();
                    a[0] = this._texture.getWidth(),
                    a[1] = this._texture.getHeight()
                } else
                    "NormalMap" === i ? n.uFlipY.setInt(this.getFlipY() ? 1 : 0) : "AOPBR" === i ? n.uOccludeSpecular.setInt(this.getOccludeSpecular() ? 1 : 0) : "Opacity" === i || "AlphaMask" === i ? (n.uInvert.setInt(this.getInvert() ? 1 : 0),
                    "AlphaMask" === i && n.uDithering.setInt(this.getDithering() ? 1 : 0)) : "EmitColor" === i && n.uEmitType.setInt(this.getEmitType())
            }
        },
        getHash: function() {
            var t = [this.className()]
              , e = this._channelName
              , i = this.getTexture();
            return void 0 !== i && (e += ":" + i.getInternalFormat()),
            t.push(e),
            [t.join(", "), this._texCoordUnit, this._sRGB].join(" / ")
        }
    }), "osgSketchfab", "TextureMaterial"),
    s.setTypeID(o),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = function() {
        return r.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS")
    };
    t.exports = a
}
, function(t, e) {
    "use strict";
    var i = {}
      , n = 2.4;
    i.linearToSrgb1 = function(t) {
        var e = 0;
        return t < .0031308 ? t > 0 && (e = 12.92 * t) : e = 1.055 * Math.pow(t, 1 / n) - .055,
        e
    }
    ,
    i.srgbToLinear1 = function(t) {
        var e = 0;
        return t < .04045 ? t >= 0 && (e = t * (1 / 12.92)) : e = Math.pow((t + .055) * (1 / 1.055), n),
        e
    }
    ,
    i.linearToSrgb = function(t, e) {
        var n = e || new Array(t.length);
        return n[0] = i.linearToSrgb1(t[0]),
        n[1] = i.linearToSrgb1(t[1]),
        n[2] = i.linearToSrgb1(t[2]),
        n.length > 3 && t.length > 3 && (n[3] = t[3]),
        n
    }
    ,
    i.srgbToLinear = function(t, e) {
        var n = e || new Array(t.length);
        return n[0] = i.srgbToLinear1(t[0]),
        n[1] = i.srgbToLinear1(t[1]),
        n[2] = i.srgbToLinear1(t[2]),
        n.length > 3 && t.length > 3 && (n[3] = t[3]),
        n
    }
    ,
    i.encodeRGBM = function(t, e, i) {
        i[3] = Math.min(1, Math.max(t[0] / e, i[1] / e, i[2] / e, 1e-6)),
        i[3] = Math.ceil(255 * i[3]) / 255;
        var n = 1 / (e * i[3]);
        return i[0] = t[0] * n,
        i[1] = t[1] * n,
        i[2] = t[2] * n,
        i
    }
    ,
    i.decodeRGBM = function(t, e, i) {
        var n = e * t[3];
        return i[0] = n * i[0],
        i[1] = n * i[1],
        i[2] = n * i[2],
        i
    }
    ,
    i.rgbToHex = function(t) {
        var e = {
            r: 255 * t.r,
            g: 255 * t.g,
            b: 255 * t.b
        }
          , i = "#" + (16777216 | e.b | e.g << 8 | e.r << 16).toString(16).substr(1);
        return i
    }
    ,
    t.exports = i
}
, function(t, e) {
    "use strict";
    t.exports = function() {
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(t) {
            var e = 16 * Math.random() | 0
              , i = "x" === t ? e : 3 & e | 8;
            return i.toString(16)
        })
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = function() {
        r.NodeVisitor.call(this, r.NodeVisitor.TRAVERSE_ALL_CHILDREN),
        this._texCoordList = []
    };
    a.prototype = r.objectInherit(r.NodeVisitor.prototype, {
        getTexCoordList: function() {
            for (var t = [], e = this._texCoordList, i = 0, n = e.length; i < n; ++i)
                1 === e[i] && t.push(i);
            return t
        },
        reset: function() {
            this._texCoordList = []
        },
        apply: function(t) {
            if (void 0 !== t.getVertexAttributeList)
                for (var e = this._texCoordList, i = Object.keys(t.getVertexAttributeList()), n = 0, r = i.length; n < r; ++n) {
                    var a = i[n];
                    a.indexOf("TexCoord") !== -1 && (e[parseInt(a.substring(8))] = 1)
                }
            this.traverse(t)
        }
    }),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1564)
      , a = i(1565)
      , s = {
        FeatureName: "shadingStyle",
        ModelType: r,
        ViewListType: [a]
    }
      , o = n.create(s);
    o.prototype.getNode = function() {
        return this._views[0]._nodeBlending
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(238)
      , r = i(1482)
      , a = i(1467)
      , s = i(1465)
      , o = n.extend({
        defaults: function() {
            return {
                renderer: "classic",
                style: "lit",
                hasWireframe: !0,
                wireframeEnable: !1,
                wireframeColor: "000000FF",
                hasVertexColor: !1,
                hasVertexAlpha: !1,
                vertexColorEnable: !0,
                vertexAlphaEnable: !!a(),
                vertexColorColorSpace: a() ? "srgb" : "linear",
                blendingEasingDuration: 1,
                blendingPauseDuration: 2.5,
                webVR: !1
            }
        },
        getName: function() {
            return "ShadingStyle"
        },
        init: function(t) {
            this.set("hasWireframe", !!t.getScene().getWireframeSize());
            var e = t.getModel().get("options")
              , i = e.shading;
            i && i.type && (this.set("style", i.type),
            this.set("renderer", i.renderer));
            var n = e.wireframe;
            n && (void 0 !== n.enable && this.set("wireframeEnable", n.enable),
            n.color && n.enable && this.set("wireframeColor", n.color));
            var o = i && i.vertexColor;
            o && (this.set("vertexColorEnable", o.enable),
            this.set("vertexColorColorSpace", o.colorSpace),
            void 0 !== o.useAlpha && this.set("vertexAlphaEnable", o.useAlpha));
            var u = s().blending;
            void 0 !== u && (this.set("style", "blending"),
            this.set("blendingPauseDuration", Math.abs(u))),
            a() && r.getMaterial().then(function() {
                var e = t.getFeatures().material.getModel();
                this.set("renderer", "pbr", {
                    copyChannel: !0,
                    overrideTexture: !1
                }),
                e._style && this.set("style", e._style)
            }
            .bind(this))
        },
        setWireframeColorSmooth: function(t) {
            this.trigger("setWireframeColorSmooth", t)
        },
        getJSON: function() {
            return {
                shading: {
                    type: this.get("style"),
                    renderer: this.get("renderer"),
                    vertexColor: {
                        enable: this.get("vertexColorEnable"),
                        useAlpha: this.get("vertexAlphaEnable"),
                        colorSpace: this.get("vertexColorColorSpace")
                    }
                },
                wireframe: {
                    enable: this.get("wireframeEnable"),
                    color: this.get("wireframeColor")
                }
            }
        }
    });
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(235)
      , a = i(1198)
      , s = i(1482)
      , o = i(258)
      , u = i(1544)
      , l = i(1566)
      , c = i(1569)
      , h = i(1514)
      , d = i(1498)
      , p = i(1570)
      , f = i(1572)
      , g = i(1573)
      , m = i(1574)
      , v = i(1576)
      , _ = i(1578)
      , b = i(1580)
      , x = i(1543)
      , A = i(1486)
      , y = i(1515)
      , S = i(1483)
      , C = a.osg
      , M = o.extend({
        initialize: function(t) {
            o.prototype.initialize.apply(this, arguments);
            var e = this.model;
            e.bind("change:webVR", this.onWebVRChanged, this),
            e.bind("change:renderer", this.onRendererChanged, this),
            e.bind("change:style", this.onShadingChanged, this),
            e.bind("change:wireframeEnable", this.onWireframeEnableChanged, this),
            e.bind("change:wireframeColor", this.onWireframeColorChanged, this),
            e.bind("change:vertexColorEnable", this.onVertexColorChanged, this),
            e.bind("change:vertexAlphaEnable", this.onVertexColorChanged, this),
            e.bind("change:vertexColorColorSpace", this.onVertexColorChanged, this),
            e.bind("change:blendingPauseDuration", this.onBlendingPauseDurationChanged, this),
            e.bind("change:blendingTransitionDuration", this.onBlendingTransitionDurationChanged, this),
            e.bind("setWireframeColorSmooth", this.onSetWireframeColorSmooth, this),
            this._viewer = t.context.getViewer();
            var i = this._viewer
              , n = i.getViewerOSGJS()
              , a = this._generatorProxy = n.getState().getShaderGeneratorProxy();
            a.addShaderGenerator("classic-lit", new d),
            a.addShaderGenerator("classic-shadeless", new p),
            a.addShaderGenerator("classic-blending", new f),
            a.addShaderGenerator("pbr-lit", new g),
            a.addShaderGenerator("pbr-shadeless", new m),
            a.addShaderGenerator("pbr-blending", new v),
            a.addShaderGenerator("classic-matcap", new _),
            a.addShaderGenerator("pbr-matcap", new _),
            a.addShaderGenerator("wireframe", new b),
            this._rootStateSet = n.getSceneData().getOrCreateStateSet(),
            this._scene = n.getSceneData(),
            this._rootStateSet.setShaderGeneratorName(this.getCompilerName()),
            this.updateShadingGlobal(),
            this._nodeBlending = new l(e.get("blendingDuration")),
            this._nodeBlending.setName("ShadingStyle - Node Blending"),
            this.initBlendingPreset(t.context, "classic"),
            this.initBlendingPreset(t.context, "pbr"),
            this.initNodeBlending();
            var u = t.context.getScene();
            this._hasWireframe = !!u.getWireframeSize(),
            this._wireframeNodes = u.getWireframeNodes(),
            s.getPolygon().then(function() {
                this.model.set("hasVertexColor", S.hasVertexColor),
                this.model.set("hasVertexAlpha", S.hasVertexAlpha),
                S.hasVertexColor === !1 && this.model.set("vertexColorEnable", !1),
                S.hasVertexAlpha === !1 && this.model.set("vertexAlphaEnable", !1),
                this.onVertexColorChanged()
            }
            .bind(this)),
            r.all([s.getMaterial(), s.getWireframe()]).then(this.initWireframe.bind(this))
        },
        onWebVRChanged: function() {
            for (var t = this._wireframeNodes, e = 0, i = t.length; e < i; ++e)
                t[e].getStateSet().setRenderBinVR(this.model.get("webVR"))
        },
        initBlending: function(t, e) {
            var i = this._generatorProxy.getShaderGenerator(e + "-blending");
            i.setGraphicContext(t.getViewer().getViewerOSGJS().getGraphicContext()),
            i.addShader(c.DEFAULT),
            i.addShader(c.MATCAP | c.WIREFRAME),
            i.addShader(c.MATCAP | c.GEOMETRY | c.WIREFRAME),
            i.addShader(c.DEFAULT & ~c.DIFFUSE),
            i.addShader(c.DEFAULT)
        },
        initNodeBlending: function() {
            var t = this
              , e = function(e) {
                if ("matcap" !== t.model.get("style")) {
                    var i = t._generatorProxy.getShaderGenerator(t.model.get("renderer") + "-blending");
                    e === !0 ? i.onSameShader() : (i.toNextShader(),
                    t.onBlendingShader())
                }
            };
            this._nodeBlending.setFinishCallback(e);
            var i = this.model.get("style");
            this._nodeBlending.setEnable("blending" === i),
            "matcap" === i && this._nodeBlending.setMatcapEnable(!0)
        },
        initBlendingPreset: function(t, e) {
            var i = this._generatorProxy.getShaderGenerator(e + "-blending");
            i.setGraphicContext(t.getViewer().getViewerOSGJS().getGraphicContext()),
            i.addShader(c.DEFAULT),
            i.addShader(c.MATCAP | c.WIREFRAME),
            i.addShader(c.MATCAP | c.GEOMETRY | c.WIREFRAME),
            i.addShader(c.DEFAULT & ~c.DIFFUSE),
            i.addShader(c.DEFAULT)
        },
        initWireframe: function() {
            for (var t = this._wireframeNodes, e = t.length, i = this.model.get("wireframeEnable") === !0 ? h.NO_PICK_NO_SHADOW : 0, n = 0; n < e; ++n) {
                var r = t[n];
                r.setNodeMask(i)
            }
            if (e > 0) {
                var a = t[0].getStateSet();
                a || (a = new u,
                t[0].setStateSet(a)),
                a.getUpdateCallbackList()[0].setFinishCallback(this.setWireframeNodesMask.bind(this, 0))
            }
            this.onWireframeColorChanged(),
            this.model.get("wireframeEnable") === !0 && this.onWireframeEnableChanged()
        },
        onBlendingPauseDurationChanged: function() {
            this._nodeBlending.setPauseDuration(this.model.get("blendingPauseDuration"))
        },
        onBlendingTransitionDurationChanged: function() {
            this._nodeBlending.setTransitionDuration(this.model.get("blendingTransitionDuration"))
        },
        onBlendingShader: function() {
            var t = this._generatorProxy.getShaderGenerator(this.getCompilerName()).getNextShader()
              , e = 0 !== (t & c.WIREFRAME);
            this.model.set("wireframeEnable", e),
            e && this.model.set("wireframeColor", "ffffff66"),
            this.model.trigger("nextBlendingShader", t)
        },
        getCompilerName: function() {
            return this.model.get("renderer") + "-" + this.model.get("style")
        },
        updateShadingGlobal: function() {
            var t, e = this.model.get("style"), i = this.model.get("renderer"), n = "lit" === e || "blending" === e;
            t = "matcap" === e ? x.MATCAP : "pbr" === i && n ? x.PBR_LIT : "pbr" === i && "shadeless" === e ? x.PBR_SHADELESS : "classic" === i && n ? x.CLASSIC_LIT : x.CLASSIC_SHADELESS,
            x.set("mask", t)
        },
        copyChannels: function(t, e, i) {
            var r = {
                DiffusePBR: "DiffuseColor",
                AlbedoPBR: "DiffuseColor",
                AOPBR: "DiffuseIntensity"
            };
            n.each(r, function(n, r) {
                var a = e.getChannels()
                  , s = a[r]
                  , o = a[n];
                "pbr" === t ? o.getTexture() ? s.getTexture() && !i || s.setTexture(o.getTexture().clone()) : s.getTexture() || s.setColor(o.getColor()) : (e.getWorkFlowPBRMetalSpec() && "DiffusePBR" !== r || !e.getWorkFlowPBRMetalSpec() && "AlbedoPBR" !== r) && (s.getTexture() ? s.getTexture() && !i || o.setTexture(s.getTexture().clone()) : o.getTexture() || o.setColor(s.getColor()))
            })
        },
        onRendererChanged: function(t, e, i) {
            this.onShadingChanged();
            var r = this.model.get("renderer")
              , a = void 0 === i.copyChannel || i.copyChannel
              , s = void 0 === i.overrideTexture || i.overrideTexture
              , o = this._viewer.getFeatures().material;
            if (!o)
                return void C.error("The renderer has been changed before the material feature is initialized");
            var u = o.getModel().attributes
              , l = this;
            a && n.each(u, function(t) {
                l.copyChannels(r, t, s)
            }),
            A.draw()
        },
        onShadingChanged: function() {
            this.updateShadingGlobal();
            var t = this.model.get("style");
            this.model.set("hasWireframe", this._hasWireframe && "blending" !== t),
            this._nodeBlending.setEnable("blending" === t),
            this._rootStateSet.setShaderGeneratorName(this.getCompilerName()),
            "matcap" === t && this._nodeBlending.setMatcapEnable(!0),
            "blending" !== t && (this._wireEnable = void 0),
            "blending" === t ? (this._wireEnable = this.model.get("wireframeEnable"),
            this._wireColor = this.model.get("wireframeColor"),
            this.onBlendingShader()) : void 0 !== this._wireEnable && (this.model.set("wireframeEnable", this._wireEnable),
            this._wireEnable && this.model.set("wireframeColor", this._wireColor)),
            A.draw()
        },
        onWireframeColorChanged: function() {
            for (var t = this._wireframeNodes, e = 0, i = t.length; e < i; ++e)
                t[e].getStateSet().setWireframeColor(this.getRGBA())
        },
        onSetWireframeColorSmooth: function(t) {
            var e = this.model;
            e.off("change:wireframeColor", this.onWireframeColorChanged, this),
            e.set("wireframeColor", t),
            e.bind("change:wireframeColor", this.onWireframeColorChanged, this);
            for (var i = this._wireframeNodes, n = 0, r = i.length; n < r; ++n)
                i[n].getStateSet().setWireframeColorSmooth(this.getRGBA());
            e.off("change:wireframeColor", this.onWireframeColorChanged, this),
            e.set("wireframeColor", t),
            e.on("change:wireframeColor", this.onWireframeColorChanged, this)
        },
        setWireframeNodesMask: function(t) {
            for (var e = this._wireframeNodes, i = 0, n = e.length; i < n; ++i)
                e[i].setNodeMask(t);
            y.setWireframe(0 !== t)
        },
        onWireframeEnableChanged: function() {
            this.setWireframeNodesMask(h.NO_PICK_NO_SHADOW);
            for (var t = this._wireframeNodes, e = 0, i = t.length; e < i; ++e)
                t[e].getStateSet().setWireframeEnable(this.model.get("wireframeEnable"), this.getRGBA())
        },
        getRGBA: function() {
            var t = C.Vec4.create();
            return function(e) {
                var i = e || this.model.get("wireframeColor");
                return t[0] = parseInt(i.substr(0, 2), 16) / 255,
                t[1] = parseInt(i.substr(2, 2), 16) / 255,
                t[2] = parseInt(i.substr(4, 2), 16) / 255,
                t[3] = parseInt(i.substr(6, 2), 16) / 255,
                t
            }
        }(),
        onVertexColorChanged: function() {
            for (var t = this.model.get("vertexColorEnable"), e = t && this.model.get("vertexAlphaEnable"), i = this.model.get("vertexColorColorSpace"), n = this._viewer.getFeatures().material.getModel().attributes, r = Object.keys(n), a = 0, s = r.length; a < s; ++a) {
                var o = n[r[a]]
                  , u = o.get("stateSet").getAttribute("SketchfabMaterial");
                u.setVertexColorEnable(t && o.get("hasVertexColor")),
                u.setVertexColorColorSpace(i);
                var l = e && o.get("hasVertexAlpha");
                u.setVertexAlphaEnable(l),
                o.getChannels().Opacity.set("vertexAlphaEnable", l)
            }
            A.draw()
        }
    });
    t.exports = M
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1197)
      , a = i(1546)
      , s = i(1567)
      , o = i(1486)
      , u = n.osg
      , l = function(t, e, i) {
        a.call(this, i),
        this._pauseDuration = void 0 === e ? 2.5 : e,
        this._blendUniform = t,
        this._finishCallback = void 0,
        this._finished = !0,
        this._inPause = !1
    };
    l.prototype = u.objectInherit(a.prototype, {
        smoothStep: function(t) {
            return t * t * (3 - 2 * t)
        },
        setPauseDuration: function(t) {
            this._pauseDuration = t
        },
        setFinishCallback: function(t) {
            this._finishCallback = t
        },
        changeBlend: function() {
            this._inPause = !1,
            this.reset(),
            this._finishCallback()
        },
        update: function(t, e) {
            if (this._finished === !0)
                return !0;
            o.draw();
            var i = e.getFrameStamp().getSimulationTime();
            if (this._inPause === !0) {
                if (i < this._startTime + this._pauseDuration + this._duration)
                    return !0;
                this.changeBlend()
            }
            var n = this.interpolate(i, t, e);
            return this._finished === !0 && (this._finished = !1,
            this._inPause = !0,
            this._finishCallback(!0)),
            n = this.smoothStep(n),
            this._blendUniform.getInternalArray()[0] = n,
            !0
        }
    });
    var c = function(t, e) {
        u.Node.call(this),
        this._blendUniform = u.Uniform.createFloat1(0, "uBlend"),
        this._callbackUpdate = new l(this._blendUniform,t,e),
        this._textureMatcap = void 0;
        var i = u.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS");
        this._matcapUnit = i > 11 ? 11 : 7,
        this.init()
    };
    c.prototype = u.objectInherit(u.Node.prototype, {
        setPauseDuration: function(t) {
            this._callbackUpdate.setPauseDuration(t)
        },
        setTransitionDuration: function(t) {
            this._callbackUpdate.setDuration(t)
        },
        setEnable: function(t) {
            this.setMatcapEnable(t),
            this._callbackUpdate._finished = !t
        },
        setMatcapEnable: function(t) {
            var e = this.getOrCreateStateSet();
            t === !0 ? e.setTextureAttributeAndModes(this._matcapUnit, this._textureMatcap, u.StateAttribute.OVERRIDE | u.StateAttribute.ON) : e.removeTextureAttribute(this._matcapUnit, "Texture")
        },
        setFinishCallback: function(t) {
            this._callbackUpdate.setFinishCallback(t)
        },
        init: function() {
            var t = s()
              , e = this._resourceManager || r.instance
              , i = e.getOrCreateTexture(t);
            this._textureMatcap = i.texture,
            i.texture.setName("matcap"),
            this.getOrCreateStateSet().addUniform(this._blendUniform),
            this.addUpdateCallback(this._callbackUpdate)
        }
    }),
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    t.exports = function() {
        return i(1568)
    }
}
, function(t, e) {
    t.exports = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QtoRXhpZgAATU0AKgAAAAgABwESAAMAAAABAAEAAAEaAAUAAAABAAAAYgEbAAUAAAABAAAAagEoAAMAAAABAAIAAAExAAIAAAAeAAAAcgEyAAIAAAAUAAAAkIdpAAQAAAABAAAApAAAANAACvyAAAAnEAAK/IAAACcQQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykAMjAxNDowNToyMiAxNDozMDozNwAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAIAKADAAQAAAABAAAIAAAAAAAAAAAGAQMAAwAAAAEABgAAARoABQAAAAEAAAEeARsABQAAAAEAAAEmASgAAwAAAAEAAgAAAgEABAAAAAEAAAEuAgIABAAAAAEAAAoxAAAAAAAAAEgAAAABAAAASAAAAAH/2P/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicgIiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAHgAeAMBIQACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APOqK7zjCnRxySyLHEjPIxwqqMkn0AoGdXp3gO8mQS6ncx2EZGQhG+Q9P4QcDv1ORjpXRW+jeFNMIItHu5FYkPdSbvwKjCn8qQGjBrVlaDbZadawL6QwKv8AIVcXxXcdMHHpigY59WsL0bb7TbS4U9poFf8AmKqXHhbwhq+SbOSykYgmS0l2/gFOVA+gpW7Acvq3wu1O2jafSLmPU4QMlFHlyjqT8pJBxgdDkk9K4eWKWCV4po3jlQ7WR1Ksp9CD0NNMGhlFMQUUCCjFAzS0fRbnWLkxw4SJOZZm+6g/qfQf/XNdlbPpvhyDyrBA9yVw9y4+dvp6D2HoM5PNSOxUkv7m8fLOQDUsUJPJyTRcqxfit/arkdrntSuFi5HY7u1WRpxHIBFFwsTRSXVmwKsSBSatpmkeLbYxajEIrwLtjvIwBImOgP8AeX2PqcYPNAHk3iPwzfeGr4QXSh4XyYLhPuSj29CO47fQgnFxVJktBRTELitDSdKl1W78pDsjUbpZSOEX/H0FSUkdLealDY2y6fp67IU/Nj3JPc1nwq0jbmJJNK5SRrW8PStSCHpxU3HY0IYPatO3tsnpRcdjatbHOOK0l00bfu0XCxXuNOG37tc9e2jRNuXIIp3JsVzPa6pZSaXqkYkgk/NT2ZT2IryrxF4fuPD2pNbSnzIXG6CcDiRfX2I7jt9MEtCaMfFFUTYkRGkdURSzMQFA6k11U7x6Fpi2cW3z3+aZwfvN/gOg/wDrmobLSMiAGR9zck1tWsXSpuWkbNtF04rUgi9qVx2NGCLpxWvaQ8jilcdjo7KEccVrLEoXpUSY0ivcwLtPFcxqkIw3FXF3RLRxOoqYnLLwRUdzBB4n0V7CYKLqMFraRjjY/pn0PQ9fXqBVpkNHlskTwyvFIpSRGKspHII4INFVck2PD8Ki4lvZMbbZcqD/AHz0/Ln8cVSu7pry9ZicgGobLSL9onSt60TpUtmiRtW0fStWCPjpU3KSNCGOtW1GCKVx2N6zYDFaYYEdal6iaILmQBDzXMapIMNVR2E0cRqjAlqwLe7a0vlYHAJrRMhozvG1ki6hDqUIAjvUy4HaRcA9u4IPud1FURYpSv8AYfDcSchpiZGGfXgfoBWLacnJ71DZokb9mOlb9ovAqGzRI27Zela0CVLZaRoRJV2LilcdjRhm21bF3gdaLhYqXN58p5rnNRucg81SZLRyeoSZzzXM3jYORVJmbRfvD/aXg6dPmZ7dlnUA46cHP/AS1FWmQ0cz4kfyo4IAeERV/IVnWZ6Vm2aJHQ2Xaugs+1Q2aJG5a9q2IBwKhs0SNCJatKKVx2Hb9tRvcEDrTuFihc3RweaxLycnPNNMho568k61gXbda0TIaL2gN9otrq1Y/LLE8Z/EEUVaZm0cx4qb/TPxqjZt0rNs0SOhsm6V0Nm3Ss2zVI3bVulbFu3SobNEjThYYFWgwxSuOxDI+KpTSUXCxm3EvB5rHupetUmQ0Yl2/WsK7frWiZm0XvCr/wCm/jRVozaOe8T/ADrDMOjIrfmKzLOTpWbZpFHQWcnSt+zl6c1m2bJG7ay9K2LebpUNmiRpRTDHWrAn461Nx2IpJuOtUppvencGjLuJvesi6m681SZDRiXUvWsO7l681omZSRpeHH8qK4uD0SNn/IUVomZNGbqcZudEjfktHlCcenT9CK5q1kwcHsazkzWKN2zm6c1vWk/TmsmzaKNu1uOnNa8Fz05qGzRIvx3PHWpxdcdam5diN7n3qnNc9eaaYrGbcXHB5rJubjrzVJmbRi3U/XmsS5mycDvWqZlJHQWoNp4dlbkNKRGDj15P6A0VomZNFa0xIsts2MSrx9R0/r+lclewtZ3rKRgE1nJmsUW7WfpzW3a3PTmsmzaKNm2uunNakN305rNs1SL0d571L9s461Ny7DXvPeqkt3x1oTE0Z89115rKubnrzVpmbRj3Nz15qpZxteXqqOQDWsWYyR0eqOFMVqmNsK8/7x6/0/WitUYtFJMqwIOCDkGo9bsVv7X7VEBvHDgdjWcmaxOVikaJ9jcEVq29z05rFs3ijVgu+nNaUN5x1rNs1SLiXvvUovfepuXYa1771WkvPemmJooTXfHWs24uuvNWmZyRmSzGR9q8k10uj2y6dZm6kA8w8RqR1NaxMJIjclmLMSWJySe5orZMxaAVYgkMTHjcrcMvqKzkaxMfW9EBH2m25Q88fyrn0laNtrcEVizeJehusd6vxXnvWTNootJe+9SfbfeouaWGte+9QSXnvTTJaKct371RedpG2rkk1pEykje0bR8D7Vc8IPXv9K07iYzMDjaq8KvoK2iYSKxorVGLHCniokaQJ4pCmRgMp+8p6Gs/UdBhvVMttw3Up3FYtm8Vc5i4sbmzchkOBUa3BU4ORU2UiruG5Mt371J9r96zcGaKohpu/eoWuieBkmmoMTqIlgtLm7cBEODXS6foUVmolueW6hO5q15E67s0JpDIQMbVH3VHQVXNaxMZDDRWqMGAqRaiRcCQVIvByDg1jI6IkjiOdds8Sv79DWfceHrK4yY22k9mFYt2N0k1ZmdJ4SfP7twR7Gov+ESuvQ0e1YvYRZLH4SfP7xwB7mtG38PWVvgyNuI7KKOdsapxjsaCCOBdsEapx16mo2yTknJPrVxIkRmozW0TCRGaK2Rzvc//2QD/7RaUUGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAA8cAVoAAxslRxwCAAACAAAAOEJJTQQlAAAAAAAQzc/6fajHvgkFcHaurwXDTjhCSU0EOgAAAAAA5QAAABAAAAABAAAAAAALcHJpbnRPdXRwdXQAAAAFAAAAAFBzdFNib29sAQAAAABJbnRlZW51bQAAAABJbnRlAAAAAENscm0AAAAPcHJpbnRTaXh0ZWVuQml0Ym9vbAAAAAALcHJpbnRlck5hbWVURVhUAAAAAQAAAAAAD3ByaW50UHJvb2ZTZXR1cE9iamMAAAAMAFAAcgBvAG8AZgAgAFMAZQB0AHUAcAAAAAAACnByb29mU2V0dXAAAAABAAAAAEJsdG5lbnVtAAAADGJ1aWx0aW5Qcm9vZgAAAAlwcm9vZkNNWUsAOEJJTQQ7AAAAAAItAAAAEAAAAAEAAAAAABJwcmludE91dHB1dE9wdGlvbnMAAAAXAAAAAENwdG5ib29sAAAAAABDbGJyYm9vbAAAAAAAUmdzTWJvb2wAAAAAAENybkNib29sAAAAAABDbnRDYm9vbAAAAAAATGJsc2Jvb2wAAAAAAE5ndHZib29sAAAAAABFbWxEYm9vbAAAAAAASW50cmJvb2wAAAAAAEJja2dPYmpjAAAAAQAAAAAAAFJHQkMAAAADAAAAAFJkICBkb3ViQG/gAAAAAAAAAAAAR3JuIGRvdWJAb+AAAAAAAAAAAABCbCAgZG91YkBv4AAAAAAAAAAAAEJyZFRVbnRGI1JsdAAAAAAAAAAAAAAAAEJsZCBVbnRGI1JsdAAAAAAAAAAAAAAAAFJzbHRVbnRGI1B4bEBSAAAAAAAAAAAACnZlY3RvckRhdGFib29sAQAAAABQZ1BzZW51bQAAAABQZ1BzAAAAAFBnUEMAAAAATGVmdFVudEYjUmx0AAAAAAAAAAAAAAAAVG9wIFVudEYjUmx0AAAAAAAAAAAAAAAAU2NsIFVudEYjUHJjQFkAAAAAAAAAAAAQY3JvcFdoZW5QcmludGluZ2Jvb2wAAAAADmNyb3BSZWN0Qm90dG9tbG9uZwAAAAAAAAAMY3JvcFJlY3RMZWZ0bG9uZwAAAAAAAAANY3JvcFJlY3RSaWdodGxvbmcAAAAAAAAAC2Nyb3BSZWN0VG9wbG9uZwAAAAAAOEJJTQPtAAAAAAAQAEgAAAABAAIASAAAAAEAAjhCSU0EJgAAAAAADgAAAAAAAAAAAAA/gAAAOEJJTQPyAAAAAAAKAAD///////8AADhCSU0EDQAAAAAABAAAAHg4QklNBBkAAAAAAAQAAAAeOEJJTQPzAAAAAAAJAAAAAAAAAAABADhCSU0nEAAAAAAACgABAAAAAAAAAAI4QklNA/UAAAAAAEgAL2ZmAAEAbGZmAAYAAAAAAAEAL2ZmAAEAoZmaAAYAAAAAAAEAMgAAAAEAWgAAAAYAAAAAAAEANQAAAAEALQAAAAYAAAAAAAE4QklNA/gAAAAAAHAAAP////////////////////////////8D6AAAAAD/////////////////////////////A+gAAAAA/////////////////////////////wPoAAAAAP////////////////////////////8D6AAAOEJJTQQAAAAAAAACAAE4QklNBAIAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAA4QklNBDAAAAAAAAkBAQEBAQEBAQEAOEJJTQQtAAAAAAAGAAEAAAAUOEJJTQQIAAAAAAAaAAAAAQAAAkAAAAJAAAAAAgAAgAAAAACAAAE4QklNBB4AAAAAAAQAAAAAOEJJTQQaAAAAAANDAAAABgAAAAAAAAAAAAAIAAAACAAAAAAHAG0AYQB0AGMAYQBwADEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAABudWxsAAAAAgAAAAZib3VuZHNPYmpjAAAAAQAAAAAAAFJjdDEAAAAEAAAAAFRvcCBsb25nAAAAAAAAAABMZWZ0bG9uZwAAAAAAAAAAQnRvbWxvbmcAAAgAAAAAAFJnaHRsb25nAAAIAAAAAAZzbGljZXNWbExzAAAAAU9iamMAAAABAAAAAAAFc2xpY2UAAAASAAAAB3NsaWNlSURsb25nAAAAAAAAAAdncm91cElEbG9uZwAAAAAAAAAGb3JpZ2luZW51bQAAAAxFU2xpY2VPcmlnaW4AAAANYXV0b0dlbmVyYXRlZAAAAABUeXBlZW51bQAAAApFU2xpY2VUeXBlAAAAAEltZyAAAAAGYm91bmRzT2JqYwAAAAEAAAAAAABSY3QxAAAABAAAAABUb3AgbG9uZwAAAAAAAAAATGVmdGxvbmcAAAAAAAAAAEJ0b21sb25nAAAIAAAAAABSZ2h0bG9uZwAACAAAAAADdXJsVEVYVAAAAAEAAAAAAABudWxsVEVYVAAAAAEAAAAAAABNc2dlVEVYVAAAAAEAAAAAAAZhbHRUYWdURVhUAAAAAQAAAAAADmNlbGxUZXh0SXNIVE1MYm9vbAEAAAAIY2VsbFRleHRURVhUAAAAAQAAAAAACWhvcnpBbGlnbmVudW0AAAAPRVNsaWNlSG9yekFsaWduAAAAB2RlZmF1bHQAAAAJdmVydEFsaWduZW51bQAAAA9FU2xpY2VWZXJ0QWxpZ24AAAAHZGVmYXVsdAAAAAtiZ0NvbG9yVHlwZWVudW0AAAARRVNsaWNlQkdDb2xvclR5cGUAAAAATm9uZQAAAAl0b3BPdXRzZXRsb25nAAAAAAAAAApsZWZ0T3V0c2V0bG9uZwAAAAAAAAAMYm90dG9tT3V0c2V0bG9uZwAAAAAAAAALcmlnaHRPdXRzZXRsb25nAAAAAAA4QklNBCgAAAAAAAwAAAACP/AAAAAAAAA4QklNBBQAAAAAAAQAAAAUOEJJTQQMAAAAAAwIAAAAAQAAAKAAAACgAAAB4AABLAAAAAvsABgAAf/Y/+0ADEFkb2JlX0NNAAH/7gAOQWRvYmUAZIAAAAAB/9sAhAAMCAgICQgMCQkMEQsKCxEVDwwMDxUYExMVExMYEQwMDAwMDBEMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAQ0LCw0ODRAODhAUDg4OFBQODg4OFBEMDAwMDBERDAwMDAwMEQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCACgAKADASIAAhEBAxEB/90ABAAK/8QBPwAAAQUBAQEBAQEAAAAAAAAAAwABAgQFBgcICQoLAQABBQEBAQEBAQAAAAAAAAABAAIDBAUGBwgJCgsQAAEEAQMCBAIFBwYIBQMMMwEAAhEDBCESMQVBUWETInGBMgYUkaGxQiMkFVLBYjM0coLRQwclklPw4fFjczUWorKDJkSTVGRFwqN0NhfSVeJl8rOEw9N14/NGJ5SkhbSVxNTk9KW1xdXl9VZmdoaWprbG1ub2N0dXZ3eHl6e3x9fn9xEAAgIBAgQEAwQFBgcHBgU1AQACEQMhMRIEQVFhcSITBTKBkRShsUIjwVLR8DMkYuFygpJDUxVjczTxJQYWorKDByY1wtJEk1SjF2RFVTZ0ZeLys4TD03Xj80aUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm9ic3R1dnd4eXp7fH/9oADAMBAAIRAxEAPwDkkkklaa6kkkiQBJMAckpKUpVV23WtppY625/0Kq2l7z/VYyXLZ6T9V8jLY3Kz3HCw3Dc0R+nsH/B1v/ma3f6a7/rdK6CrL6d0qk0dNpbjtdo9w1sf/wAdc79Lb/1CVppxcL6kdTtAf1C2vp1Z/Md+lu/7aqcKq/8Arl/9ha9H1Z+q2IJubdnvHe6wtb/2zjej/wBN9iq29UutOhKGH3P5cgqncqt6Fi6Y3TsSqOCKWE/572vf/wBJWG9eazRjWMHg1ob/ANSAuebWTzKM2pJNO+Ousfo9rHjwc0OH/SBUH/sDLBGV03Etnkmlgd/nsa16yG0+SI2g9ktFJ7/qd9U8wTji7p7z3psLmz/xOV6zf8z01idQ/wAXvWKAbOnW1dTqH5jf0N3/AGza51Nn9jI/62tpguZwSrdGffURMpfVT5pbVbRc6i+t9N7Pp02NLHt/rVv2vUV6vlN6V1ugY/VcduQ0fQefbYwn86m9kW1f2HLjev8A1IzemsfmdOc7qHT2jc6APtFTf+FqZ/SK2/6ahv8AxlH+ESvuiuzzSSQIcAQZB1BHCSKFJJJJKf/Q5JJOloBJ0A5KtMFKg6AAkkgAASSToGtaPpOcun6X0SjprW5vU2tszB7qsYw5lR7Ot/Ntyf8AwKj/AI1Q6N09nTaW9Sy2/rbxOPW7/BNI/nHD/uRa3/tiv/hFWzOoWX2EAoWmm7ndXtueYcST3VNu55lxlCqZKuVMQtNMq61arrTVsVqtiVppiytHZUpMrVmutC1UwronsrNeNPZGpplX6cfyStVNAYnkmdh+S2m4unCZ+MI4StVPPPodWZbojYvUbKXAEkELQvxudFlZVESjaKc76yfVKjqYf1LorG1Zp91+G2GsuP51lP5lOW7/ALayf5Fv6RcJBBIILXNJa5rgQQQdrmua73Ne130mr0XHzX0WAEqj9augs6pS/rHT2fr1bd2XQ3m9jR/PMb/3LpZ/7EU/8LXWlsqnh0k4IIBBkHUEJJy2n//R5RanQsBl9zszIE42KRDTw+36TGf1Kv52z/razWMfY9tdY3WPIaxvi5x2tC386yvAw68Kky2oQ537zjrZZ/berFsQDX6p1F91pEySVVpaqzCXv3HurtLULXU2aWK7UxApartTU200mqYrNbFCpitVsStNL1sVqpihW1WamoWmmzj1rSx6wqdAWjRCVqpO2sQmdWCERJMsqc/IqELIy6xqt3I4WPmRqpAVpDz2YyJS6d1F9FoEwQdETM7rHucWP3DsnWimr9buj14eU3qOI0Nws5xJY3iq/wCnZUP3ar/5+n/r1awF3mOKeq9Pu6bkOhmQ2Gv/AHHj3U3D/irfcuFsqtqsfTc3ZdU51drPBzTse3/OCIKCH//SyOhUg5L8p30cVkt/4x8sZ/ms9Ryq9SyTbcRPdX8b9X6Nu4dkPc8/Afomf9QsQvL7SVMStAbVAV+gKlQFoUBNJXAN2lqu0tVWkcK9SELXU2Kmq1W1BqCt1tQtNM2NVisIbAjsCFpps0mFdpes9hhWGWQlaqdFtghJ1ghUxd5qL79EtEcLLIt0KyMuwaqzffzqsvJtmU60ENDLdysfJPK0cl8yszIPKIK0hfp2SargJ7qv9bsUM6hXnMHszq5f/wAbVFdn+fX6L0EP2Wg+a0+sNGV9XjZy7EsZaP6rv0Fv/nxqcCtIf//Tyupu9LBx6v3KmD5locfyrDpMmVsdfdGngAPuWNQeE8lIDo0LRo7LNoPC0aDwmkrwHRp7K/Ss+gq/SU21wDeqVqsKrUVbrQtNNhgRWhDYjNCVppcKW+FE6KDnJWqkhtQbLvNQe9V7HpWilXXKhfZyi2vVG56NoIa971nXuVu53KoXOTgVpDUudBnwWzhH1+l5dB19SiwD4hpc3/pNWHe7lbHQXbgW9nNI+8QnArCH/9TE6/rr4gH71i0HhbfVh6mJTZ+9W374hYFJgx4IksgDqUOWjQ5ZVDloUP4TCV4Dq0OV+lyyqH8K/S9NJXAOpU5W63LOqerdb0LXU6DHIzXqkyxFFiFppsl6E9ygbEN1iVqpT3KtY9SfYq1j0bRTC16pXORrXqna9EFaQgucqNzke56o3PTgVpDXvdytnoJiXfutJ+4SsC10lbnTT6WBk2/u0vj4lpa3/pOTwVhD/9XHcPW6ZHelzm/I+9v/AFS50+y4g+K6PBIL30Hi5un9Zvub/wBHcsPqdBquJ800lnAZ0vWhS9ZFNivU2JpK8B2KbFepsWPTartNqYSvAdiqxWq7Vk1Wq1Xcm2uAdRlqKLVnMuRBchaabxtUHWqp6yi65K1Unfaq1lqG+5V7LUbQQytsVO2xK21VLbU4FaQxusVG6xEtsVK6xOBWELA77QB4rdvPo9HLPzsh7WD4D9K//qFj9NqNtwPmtPq1gNzMdv0cdsH+u+HO/wA1uxPBWEP/1sFpc0hzTDmkFp8xwpdWx25FIyGDR4kjwP5zf7LlEKxivb7qLP5u3gns7sf7X0VGS2QHl2k1uLT2VuqxE6tgPpsLgIhUa7EwlkAdeq1XKrlj1Wq3XcmErwHYruVllyx67lYZemkrwHXbepi/zWW2/wA0QXoWmnR9fzUXXqh6/mom/wA0rVTcfegWXKs+9AfeiCghNZcqttqHZd5qtZd5pwKwhe21VXOL3Bo5KjZar3SsF91gJEyU8FYQ6fS6mYtDsqwSKxIHi78xn9pyquc57i95l7iXOPiTqVazbWnbj1H9FTyRw5/Bd/Y+i1VSngsZD//XwgnhMFIKItsJ9rcyr0bP51o9jj+cB+b/AF2rns/AsosJAW4Ed7asxnp3QLez+A74/wAtRksgDybLI0Vmu5Gz+lWUvJAhZ8uYYcITSvGm7pMuR23rKbajNuTDa8U6jb/NTF/mswXqQvQtfTpeuom9UPXTG9K1U3HX+aE+9VHXoTrvNELS2H3KvZah73PMN1V/A6XZc8EiU8LCwwcKy+wEiVvu24dXoVfzzhD3D80H83+u5Jorw2enTBt4c/s34fy1XP5U4MZDCITFSKiVIGMv/9DDCkFEKQUJbgXClCYKQUZZAlbaHN9O4eozsfzh/wCSVTK6NVc0voIcO47j4hHCm0kEEGCOCOUwsgecv6ZdUTAKrFlrOWrsPUDxFrRYPHgoNmDhW+LD5j/yKHEfNPtg7aPKeqRyn9ZdE/oVTvoOafmEI/V49gClxx7K9uXSThesl6pPC3R9XndwEVnQqm/Tc0fMJcceyvbl1k86Ba86NKtUdNvtIkFdBXg4VXi8+Q/8kjeoGCKmhg8eSlxfRXABvq0cXo9dLQ+8ho7DufgFbdaGt9Okemzufzj/AORTOJJJJknknlQKIQWKiVMqJTwxliVEqRUSpAxl/9k4QklNBCEAAAAAAFUAAAABAQAAAA8AQQBkAG8AYgBlACAAUABoAG8AdABvAHMAaABvAHAAAAATAEEAZABvAGIAZQAgAFAAaABvAHQAbwBzAGgAbwBwACAAQwBTADYAAAABADhCSU0PoAAAAAAA+G1hbmlJUkZSAAAA7DhCSU1BbkRzAAAAzAAAABAAAAABAAAAAAAAbnVsbAAAAAMAAAAAQUZTdGxvbmcAAAAAAAAAAEZySW5WbExzAAAAAU9iamMAAAABAAAAAAAAbnVsbAAAAAEAAAAARnJJRGxvbmdMAgJNAAAAAEZTdHNWbExzAAAAAU9iamMAAAABAAAAAAAAbnVsbAAAAAQAAAAARnNJRGxvbmcAAAAAAAAAAEFGcm1sb25nAAAAAAAAAABGc0ZyVmxMcwAAAAFsb25nTAICTQAAAABMQ250bG9uZwAAAAAAADhCSU1Sb2xsAAAACAAAAAAAAAAAOEJJTQ+hAAAAAAAcbWZyaQAAAAIAAAAQAAAAAQAAAAAAAAABAAAAADhCSU0EBgAAAAAABwAIAQEAAQEA/+ER0mh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4NCjx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4NCgk8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPg0KCQk8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE0LTA1LTIyVDA5OjM0OjQ4KzAyOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE0LTA1LTIyVDE0OjMwOjM3KzAyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxNC0wNS0yMlQxNDozMDozNyswMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9qcGVnIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk0NTFBOUUwQUNFMUUzMTE4QjgyOUY3NThGQTE4QTkxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjY4NDJDMThEODNFMUUzMTE4QjgyOUY3NThGQTE4QTkxIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6Njg0MkMxOEQ4M0UxRTMxMThCODI5Rjc1OEZBMThBOTEiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSI+DQoJCQk8eG1wTU06SGlzdG9yeT4NCgkJCQk8cmRmOlNlcT4NCgkJCQkJPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6Njg0MkMxOEQ4M0UxRTMxMThCODI5Rjc1OEZBMThBOTEiIHN0RXZ0OndoZW49IjIwMTQtMDUtMjJUMDk6MzQ6NDgrMDI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDUzYgKFdpbmRvd3MpIi8+DQoJCQkJCTxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo2OTQyQzE4RDgzRTFFMzExOEI4MjlGNzU4RkExOEE5MSIgc3RFdnQ6d2hlbj0iMjAxNC0wNS0yMlQwOTozODo0MiswMjowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4NCgkJCQkJPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOkQ3NTFDMUI1OTFFMUUzMTE4QjgyOUY3NThGQTE4QTkxIiBzdEV2dDp3aGVuPSIyMDE0LTA1LTIyVDE0OjMwOjM3KzAyOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPg0KCQkJCQk8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvanBlZyIvPg0KCQkJCQk8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9qcGVnIi8+DQoJCQkJCTxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo5NDUxQTlFMEFDRTFFMzExOEI4MjlGNzU4RkExOEE5MSIgc3RFdnQ6d2hlbj0iMjAxNC0wNS0yMlQxNDozMDozNyswMjowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4NCgkJCQk8L3JkZjpTZXE+DQoJCQk8L3htcE1NOkhpc3Rvcnk+DQoJCQk8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpENzUxQzFCNTkxRTFFMzExOEI4MjlGNzU4RkExOEE5MSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2ODQyQzE4RDgzRTFFMzExOEI4MjlGNzU4RkExOEE5MSIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjY4NDJDMThEODNFMUUzMTE4QjgyOUY3NThGQTE4QTkxIi8+DQoJCQk8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPg0KCQkJCTxyZGY6QmFnPg0KCQkJCQk8cmRmOmxpPjFGNjdDMjc4QzkwQUVCRUQ1NDE4RjhCRTJCRUM4NkJGPC9yZGY6bGk+DQoJCQkJPC9yZGY6QmFnPg0KCQkJPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+DQoJCTwvcmRmOkRlc2NyaXB0aW9uPg0KCTwvcmRmOlJERj4NCjwveDp4bXBtZXRhPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPD94cGFja2V0IGVuZD0ndyc/Pv/iDFhJQ0NfUFJPRklMRQABAQAADEhMaW5vAhAAAG1udHJSR0IgWFlaIAfOAAIACQAGADEAAGFjc3BNU0ZUAAAAAElFQyBzUkdCAAAAAAAAAAAAAAABAAD21gABAAAAANMtSFAgIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEWNwcnQAAAFQAAAAM2Rlc2MAAAGEAAAAbHd0cHQAAAHwAAAAFGJrcHQAAAIEAAAAFHJYWVoAAAIYAAAAFGdYWVoAAAIsAAAAFGJYWVoAAAJAAAAAFGRtbmQAAAJUAAAAcGRtZGQAAALEAAAAiHZ1ZWQAAANMAAAAhnZpZXcAAAPUAAAAJGx1bWkAAAP4AAAAFG1lYXMAAAQMAAAAJHRlY2gAAAQwAAAADHJUUkMAAAQ8AAAIDGdUUkMAAAQ8AAAIDGJUUkMAAAQ8AAAIDHRleHQAAAAAQ29weXJpZ2h0IChjKSAxOTk4IEhld2xldHQtUGFja2FyZCBDb21wYW55AABkZXNjAAAAAAAAABJzUkdCIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAEnNSR0IgSUVDNjE5NjYtMi4xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYWVogAAAAAAAA81EAAQAAAAEWzFhZWiAAAAAAAAAAAAAAAAAAAAAAWFlaIAAAAAAAAG+iAAA49QAAA5BYWVogAAAAAAAAYpkAALeFAAAY2lhZWiAAAAAAAAAkoAAAD4QAALbPZGVzYwAAAAAAAAAWSUVDIGh0dHA6Ly93d3cuaWVjLmNoAAAAAAAAAAAAAAAWSUVDIGh0dHA6Ly93d3cuaWVjLmNoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGRlc2MAAAAAAAAALklFQyA2MTk2Ni0yLjEgRGVmYXVsdCBSR0IgY29sb3VyIHNwYWNlIC0gc1JHQgAAAAAAAAAAAAAALklFQyA2MTk2Ni0yLjEgRGVmYXVsdCBSR0IgY29sb3VyIHNwYWNlIC0gc1JHQgAAAAAAAAAAAAAAAAAAAAAAAAAAAABkZXNjAAAAAAAAACxSZWZlcmVuY2UgVmlld2luZyBDb25kaXRpb24gaW4gSUVDNjE5NjYtMi4xAAAAAAAAAAAAAAAsUmVmZXJlbmNlIFZpZXdpbmcgQ29uZGl0aW9uIGluIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAdmlldwAAAAAAE6T+ABRfLgAQzxQAA+3MAAQTCwADXJ4AAAABWFlaIAAAAAAATAlWAFAAAABXH+dtZWFzAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAACjwAAAAJzaWcgAAAAAENSVCBjdXJ2AAAAAAAABAAAAAAFAAoADwAUABkAHgAjACgALQAyADcAOwBAAEUASgBPAFQAWQBeAGMAaABtAHIAdwB8AIEAhgCLAJAAlQCaAJ8ApACpAK4AsgC3ALwAwQDGAMsA0ADVANsA4ADlAOsA8AD2APsBAQEHAQ0BEwEZAR8BJQErATIBOAE+AUUBTAFSAVkBYAFnAW4BdQF8AYMBiwGSAZoBoQGpAbEBuQHBAckB0QHZAeEB6QHyAfoCAwIMAhQCHQImAi8COAJBAksCVAJdAmcCcQJ6AoQCjgKYAqICrAK2AsECywLVAuAC6wL1AwADCwMWAyEDLQM4A0MDTwNaA2YDcgN+A4oDlgOiA64DugPHA9MD4APsA/kEBgQTBCAELQQ7BEgEVQRjBHEEfgSMBJoEqAS2BMQE0wThBPAE/gUNBRwFKwU6BUkFWAVnBXcFhgWWBaYFtQXFBdUF5QX2BgYGFgYnBjcGSAZZBmoGewaMBp0GrwbABtEG4wb1BwcHGQcrBz0HTwdhB3QHhgeZB6wHvwfSB+UH+AgLCB8IMghGCFoIbgiCCJYIqgi+CNII5wj7CRAJJQk6CU8JZAl5CY8JpAm6Cc8J5Qn7ChEKJwo9ClQKagqBCpgKrgrFCtwK8wsLCyILOQtRC2kLgAuYC7ALyAvhC/kMEgwqDEMMXAx1DI4MpwzADNkM8w0NDSYNQA1aDXQNjg2pDcMN3g34DhMOLg5JDmQOfw6bDrYO0g7uDwkPJQ9BD14Peg+WD7MPzw/sEAkQJhBDEGEQfhCbELkQ1xD1ERMRMRFPEW0RjBGqEckR6BIHEiYSRRJkEoQSoxLDEuMTAxMjE0MTYxODE6QTxRPlFAYUJxRJFGoUixStFM4U8BUSFTQVVhV4FZsVvRXgFgMWJhZJFmwWjxayFtYW+hcdF0EXZReJF64X0hf3GBsYQBhlGIoYrxjVGPoZIBlFGWsZkRm3Gd0aBBoqGlEadxqeGsUa7BsUGzsbYxuKG7Ib2hwCHCocUhx7HKMczBz1HR4dRx1wHZkdwx3sHhYeQB5qHpQevh7pHxMfPh9pH5Qfvx/qIBUgQSBsIJggxCDwIRwhSCF1IaEhziH7IiciVSKCIq8i3SMKIzgjZiOUI8Ij8CQfJE0kfCSrJNolCSU4JWgllyXHJfcmJyZXJocmtyboJxgnSSd6J6sn3CgNKD8ocSiiKNQpBik4KWspnSnQKgIqNSpoKpsqzysCKzYraSudK9EsBSw5LG4soizXLQwtQS12Last4S4WLkwugi63Lu4vJC9aL5Evxy/+MDUwbDCkMNsxEjFKMYIxujHyMioyYzKbMtQzDTNGM38zuDPxNCs0ZTSeNNg1EzVNNYc1wjX9Njc2cjauNuk3JDdgN5w31zgUOFA4jDjIOQU5Qjl/Obw5+To2OnQ6sjrvOy07azuqO+g8JzxlPKQ84z0iPWE9oT3gPiA+YD6gPuA/IT9hP6I/4kAjQGRApkDnQSlBakGsQe5CMEJyQrVC90M6Q31DwEQDREdEikTORRJFVUWaRd5GIkZnRqtG8Ec1R3tHwEgFSEtIkUjXSR1JY0mpSfBKN0p9SsRLDEtTS5pL4kwqTHJMuk0CTUpNk03cTiVObk63TwBPSU+TT91QJ1BxULtRBlFQUZtR5lIxUnxSx1MTU19TqlP2VEJUj1TbVShVdVXCVg9WXFapVvdXRFeSV+BYL1h9WMtZGllpWbhaB1pWWqZa9VtFW5Vb5Vw1XIZc1l0nXXhdyV4aXmxevV8PX2Ffs2AFYFdgqmD8YU9homH1YklinGLwY0Njl2PrZEBklGTpZT1lkmXnZj1mkmboZz1nk2fpaD9olmjsaUNpmmnxakhqn2r3a09rp2v/bFdsr20IbWBtuW4SbmtuxG8eb3hv0XArcIZw4HE6cZVx8HJLcqZzAXNdc7h0FHRwdMx1KHWFdeF2Pnabdvh3VnezeBF4bnjMeSp5iXnnekZ6pXsEe2N7wnwhfIF84X1BfaF+AX5ifsJ/I3+Ef+WAR4CogQqBa4HNgjCCkoL0g1eDuoQdhICE44VHhauGDoZyhteHO4efiASIaYjOiTOJmYn+imSKyoswi5aL/IxjjMqNMY2Yjf+OZo7OjzaPnpAGkG6Q1pE/kaiSEZJ6kuOTTZO2lCCUipT0lV+VyZY0lp+XCpd1l+CYTJi4mSSZkJn8mmia1ZtCm6+cHJyJnPedZJ3SnkCerp8dn4uf+qBpoNihR6G2oiailqMGo3aj5qRWpMelOKWpphqmi6b9p26n4KhSqMSpN6mpqhyqj6sCq3Wr6axcrNCtRK24ri2uoa8Wr4uwALB1sOqxYLHWskuywrM4s660JbSctRO1irYBtnm28Ldot+C4WbjRuUq5wro7urW7LrunvCG8m70VvY++Cr6Evv+/er/1wHDA7MFnwePCX8Lbw1jD1MRRxM7FS8XIxkbGw8dBx7/IPci8yTrJuco4yrfLNsu2zDXMtc01zbXONs62zzfPuNA50LrRPNG+0j/SwdNE08bUSdTL1U7V0dZV1tjXXNfg2GTY6Nls2fHadtr724DcBdyK3RDdlt4c3qLfKd+v4DbgveFE4cziU+Lb42Pj6+Rz5PzlhOYN5pbnH+ep6DLovOlG6dDqW+rl63Dr++yG7RHtnO4o7rTvQO/M8Fjw5fFy8f/yjPMZ86f0NPTC9VD13vZt9vv3ivgZ+Kj5OPnH+lf65/t3/Af8mP0p/br+S/7c/23////bAEMAAgEBAgEBAgICAgICAgIDBQMDAwMDBgQEAwUHBgcHBwYHBwgJCwkICAoIBwcKDQoKCwwMDAwHCQ4PDQwOCwwMDP/bAEMBAgICAwMDBgMDBgwIBwgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDP/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APzrz/jx3pep9cfzpMf3vy9acTub6dq/RD4sQf8AAqMYzSk4b8OPegNk/jikwG/MCMemOKVs7v8APNIThc+gFKBlqYCE5C9fypeh57GkA+bH459acBg1PMVysQt+uKCWJ/pXqH7Nv7GfxF/ax1Fk8F6C82lwymG61u+f7LpNkw6h7hgdzLkExwrJKAQdmK+9fgT/AMEhfhT8G4YdQ+Iuq3XxG1qPDtZqz6fo0DdQPLRvPn2n+KSRY3H3ocEilcaifmz8MfhP4p+NniVtH8G+G9e8VapHhpLXSbCW8e3U9Hk8sERpwfnfCjHJr60+D/8AwQr+L3jdIrjxhqvhL4c2cn34ru7/ALW1FB2IhtSYDx2a5RhwMA5x9/8A/C8tD+GXheHQfDOm6T4f0SzJ+z6dpdpHZ2cH+5FEqoucDoOa4LxP+1RLK7bbjH0NLmHynF/Dr/ght8E/BSRy+LvGPjnxldRjDpBLBo9jL6kxIks6/hc9+/WvZPCP7FP7MHwwVV0/4Q+Db3Z31sT67vPqRfSTA/TGPYDivFda/aQmuC3+kN+dYdx8dLq5+7JJ19anTqVyn2PoOq/C/wADIqaH8P8A4e6Ksf3V07w3ZWgX6COJRXS2P7S2m6Wm21htbdRxiKNUA/ACvgw/Fe/uDx5h/GpYviRqL/xP+dSuVbIOU++m/aV03VF23UVrcL3EsSuP1FZ+qT/Cv4gRtHrnw8+HeuRyfeXUfDVjdKw9/MiaviO1+Imor1L9OOa2tO+KF/Dj/WYHvQ4we6KV1sz6Q8VfsA/sp/FmPbqXwb8G2G7BB0Hz9A2/QWEkIH0xj2xXjvxJ/wCDev4GeP4ppvBfjjx94IvZVxDFcyW+tafCeefKdIp27dbnoPXmqei/Gy6tyu5pB+JFd14W/aCniK/6Qw/4FU8i6Nr5/wBIfM+tj41+N/8Awbs/HH4fJPdeCNS8G/FKwj4iisr0aPqkgz1a3uyIF4wcLdOeoweM/Fvxa+DXjD4A+Kl0Tx14V8ReDdXk3GK01rTpbGS5VThni8xQJUz/ABx7lPY1+9ngv9pWaNk3XGfqa9Ll+KPhv4w+EJvDvi/RtD8UeH73AuNM1mxivrOf/fhlVkb8QaOarHZ3/B/5fgHLB76H80fVcH8qMf734V+0/wC0x/wb9fB/4629zqvwn12++FmvybpF0+Vn1TQZ35bb5cj/AGi33Ngbo5WjjH3YDgCvzA/a+/4J8/Fr9hjV1j+InhWWz0i4mEFn4i0+T7boeoOSQojulA2O2G2xTrFMQpPl45qo4hN8r0fZ/wBailRaV1qjxY9fxxSqwwB70Bcrzz/WgcL0/XrW3MY8opbOMHH4UIMrn/IpuDvH1o3Y49qokPusfpRnKevPSlUZX/Z/nRtz8vcjmgBN2Cfm2846UpLZHGOfzoZdo/8ArUe360AJg84HfNBPyf7tKB8vNGdzDv3pXAT7uPY0Dls/e5/KnDjvmnBD6YqeYtRGjkY9sU7Bpdqnv0r0X9m79mHxV+1P44bR/DdvHDbWe2TU9Vugy2ekxNnDSMOWdtrbIl+dyrEYVXdI5i+VnFeEfBmrfELxTY6HoWmX2sa1qUnlWllZwmae4bGTtVewUFmY4CqpYkKCR9//ALL/APwSd8O/Di2t/EHxiuLfXdVUCSPwzZ3H/EutD1Aup0INy44zHGVhyCC1wrcesfBr4VeA/wBiPwVNYeF4jc6xexBNU127Vft+pkENtyMiKEMAVhQ7RtBYyPukbgPin+0dJeSSKJzjpgGp5i+U908Y/tE2XhnSbfTdLjtLDT9PiFva2lpEsFvaxrwsccaAKiDsqgAeleJeN/2j5rx5P37Hr3rxHX/idda7cFY3Y5PXNUrK3ku33SszVPMXyHc6r8VLzV5f3bSNu75qjHdXeoPmSQ8+lVdL0zIHHauk03S9u35anmK5CCx0ot97n3NbVjpGdvH6Vb07Seny1t2Gk/7NHMPkZQtNIxztrUtdEyPu1q2Gkbu3Stmy0bOOKOYfIYttoeR/WtC18P7v4a6Kw0HJ+7/9atzTvDW4/do5g5Dj4fC+SPl/SrkPhVh0BHuK76y8Jbv4f0rUtvBu4fc/SjmDkPObOxvLE5jkb1rpNB8c3ukuofzPlPWuq/4QjI+5+lVrvwPgfcp8xPIdb4E+OU1k8f75l/GvbPDPxk03xt4dutG1y0sdW0nVIGtb2xvYEuLW8icYeOWNwVdGBwVYEEda+T7rwnNZsWj3Rn2q1oviy70CZVZmUDvnilJRkrSQo3i7o8//AG6v+Df3w38S7S+8W/s93Vr4d1jDzz+DNQuj/Zl633itjcPlrVz8wEUpaAlkVWtkU5/J3x/8PNe+E/jfVPDPijRdU8O+ItFm8i/03Ubdre5tXwGG5GGcMpVlYZV1ZWUsrAn9/Phr8dJbFkBmOPQmp/2tP2RPhj/wUk+HK6b4vtV0/wAUWEJj0TxRYxr/AGno55YJk4E9uSTvt5DsbcWUxyBZVlc0NtV+K/zG1GXk/wAD+eIx4/Dmgpke56mvZP20/wBhzx7+wf8AFJfDXjWzhltb8PNouuWQZtN1+BSNzwseVkTcokgfEkRZc7keKSTx/wAsA/0rojNSV0c7i1oRMS52/nSZ549qkKkCmgZ/izWnMQ4gRtIJoHIpAuFC0gHyYI981RA4Jhx7U4ISOlO24H6U8LuNY83Y3URioAMU5U3CnhcV3f7Of7PmsftKfEu38P6WwtLaNRcalqMke6LTLYHDSEZG5z91I8gu5Ayqh3SOY0UTX/ZO/ZP1r9qbxs9rayNpXh3Syr6zrLR7ks0PIijHR7hxnanQAFmIUc/oK2t+GP2c/hza+FPCNlDpej2ALLGG3S3ErAB55n6ySvgbnPYKo2qqquPqOr+Hf2evhpZ+E/C1uthpOmIQis26a4kb780r4G+VyMs2AOgAVVVR80fFX4yy6ndSBZdzMT361HMXGB1fxS+OkuoXEn74tuPrXmMmr3GvXBaRm2ntnrWDavLqs5kkO7PIFdTothkLxWfOaKBf0bTuF4rrNH03lap6NYdK6zR9O+7xUcxoqZPpOm5A/wAK6TTNLwRxUWk6d0rptM04EDilzsrkG6bpeAOOlbljpmRU2m6Zx92tzTdNI2+lT7Qr2ZFp2k5KjHP863dO0feR8tWNN0zpXRaPo+dvp9KnmH7Mr6VoO/Hy11Gj+Gd4A29auaHoe/bx+ldtoHhvdt+X9KOcfIYuk+Ed235f0roLHwVkfd/Suw0PwruC/L+ldVpvg7hfl/Snzk+zPM18DfL9z9Khu/AgI+5+Yr2VPBwZfufpUF34PBH3f0q+cn2Z4JrHgfCn93+lcX4j8GcN8n6V9H614OGG+X9K4XxP4T2q3y/pT5iXTPne8guPD8+6Nm2g9PSuu+H/AMXptMnTMhXb71c8YeFtob5a8u8RadJpVy0kLbdp7d6vnM3TPpvxv4f8EfthfB2+8C/EDS4da0HUgrlC/lz2U6giO5t5MZinTcdrr2LKQyM6t+Kn/BQX/gn34o/YG+KUem6jK+ueD9cZ38O+I0i2Raii4LQzKOIruMEb4+jDDplSQv6T+APixJpV0gaQqwPrXtHibR/B/wC1z8GtU8A+OrFdU0DWowJFRwlxaSrkx3NvIQfLnjY5V8EdVYMjOjGz5o/8OS43Vmfz5spFNYDgHPNeu/tn/sfeJf2JPjfeeD/EDLqFnKhvNE1mKIx2+uWRYhZlXJ2SKfkliJJjkBGXRo5JPJtoda2UjJxISpH/AOqmbfT/APVVhlI6c0zyweo/WtOYzcSRUC//AKqcEJPTFOEYFOALVg5HRGJb8N+GL/xl4isNH0mzlv8AVNUnS1tLeM/NNI5woyeAPViQFGSSACa/RH4e+B9H/ZA+DMfh2wmgutUuMXOsaigIbULraRxkAiKMEpGpxhckje7lvJ/+CfvwXh+Hng2f4l6vCF1HVYpLbQkcfNbWvKy3Hs0pBRTwfLDEErNVL9oL4xNdXMy+ZleQBms3I1VMwvjR8YZNQu5R5pYsTXltnJJqtyZJM8ngelZNxqkmu6i0jHK545610mg2f3aycjZUze0Ky+7XZaHY5I4zWJoNl93NdnoVicrx2qOY0jTNjRLDIXius0bT/X0rN0OxBC11mj2WQvFRzmipl7SrDAHHaul0zTcY4qtpNhwtdJpen421HOaezJtNseB/hW9pun4H8qbYWHHNb2m2PA4NT7Qr2ZJpum52/LXUaLpnK/LVPSrHJH0rrNDsMlflpe0K9mavh3SVO35a9A8M6IDt+WsLw3Ycr8teieFtPAC8Ue0D2ZteG/D6sF+X9K7LTfDSlV+WofDOnABeK7TS9Pwn9axr4jkWgRo3epip4aBX7v6VXu/DChPu/pXZLbKopk9ksi9O1cMcbJM0dGLPLtb8MqFPy/pXA+KvD2Eb5f0r3DW9MXY3Fee+LNOGxq9WjW543OapRsz598a6CAG+WvHfHWi7Q/GfpX0Z4507h+K8X8fafzJx610KRhyHz74mjk0m6MsfBzXTfCv4uSaZeR/vMEHvWf48sdvmfjXlt9qkmhal5qs23dmrUzNwPqz9pf4B+H/+Cg/7Olx4Q1Se1sdesi174c1iRSTo99twCxUFjbygCOZADuTDAeZHEy/iX458Dax8NfGereHfEWnXGka9oN3JYahZzYL200bFWXIJVhnkMpKspDKSpBP63fAr4xtZ3MWZO4B/SvLP+Cyf7Klv8U/h/bfGzw5bq2s6BDFY+Ko4l+a9seEgvMDkvbsVjc4JMDoSVS1wdIyszF0z8zim0+1Ndd9TMu2mmIGtYyMnEeEx96u3/Z7+D8vx0+Lel+Ht0sNjIxudSnj4a3s48GVgezHKxqeQHlTPGa4sEA8fnX1/+xV4JT4Y/A3UPFV0u3UvFjlYCw+aOyhZlUc8jzJPMY9mVYTXO5HVGmdv+0F8SLfQdLXT7JIbO0tIVgggiG2OCJFCoijsqqoAA6ACvjf4g+MJNe1Ro1c8nnmu+/aC+JLXl5P+8zuJ7141pTG9umkblmORWTkbxpnS+H7XO3iu40C0xt4rlvD1tnb19K7rw/a421lKdjaNM6bQLXJHFdroNj92uc0C24Xiu30C16etZOobRpm9odmPlrr9EtOny1i6Jafdrr9Gs/u4Has3UNFTNTSbLlcda6XTLAkLx+lUNIs+F4/Sum0u04HFZ85oqZa06x29sVvaXZcLj1qvptpW5p1rwOP0qfaFezLul2eCPoK6nQ7QZWsnTLVcrXTaNFgil7Qr2R1Ph22yV4r0PwxAPlrhdAXBWu+8OMMr3o9oHsj0DwzEFK+/auusl2w1xvh+4CBa67Tpt8f4VzYh3VyZQsWqKKa77BXGSZ+tKCjfSvPfFqqQ1d1rd5tjb+KvPvFtyu1ufWvUwukSZRueXeOIx83414r8QExv4/OvYvG9z8r/AI14v49uFYP+NdiqGMqZ4r49jGXx3zXjXjaMNv8Axr2Xx5LuL9+a8c8aN9/61pGdzF0zA8F+MpNB1dUZvlB4yfevrj4D/Ea08TaNNpepw2+oafqFu9pd2lwu+G7gkQpJE6/xI6MykdwxFfDPiC4a1ufMU42mvV/gF8TGtb6D95jaR3raMjGVM+MP2x/2bbj9lH9ojX/BpaefS4GF7otzMcte6bMS0Dk/xOuGhdsAGWCXHGK8v2Z71+ln/BVv4Qx/Gf8AZl0rx/YxB9a+H8wW6ZR80+mXLIj5xyxinMLjsiPctxkmvzVI3Hpz61qpGEqZreDPCV1488WaXodi2271i7isonxkRNIwXef9lc7j7A19mfHzxJZ+DPDFvo+mr9n0/TbaOztYs/6uGNQiL+CqBXiH7CnhVdQ+Ld5rky7ofDWnSSxtjgTzZhQH6xm4P1QfUX/2n/G5murhd33ciueUjqjA8J+JHiVtX1lkDdWJPNL4cTAU1zAuzfavJJ97nFdd4cThawlM6I0zs/DsX3cDt613fh6DO3881xvhyPO2u+8Ow5K1jKodEaZ13h+DG3H6V3GgW2dv0rk/D8X3a7nQLfhaxdQ3jTOm0O14Wux0S2yBXOaFB0xXY6Hbn5eKylUNo0zd0i1xiul0u3xj/CsnR7XkcV1GlQA4rP2hoqZf0624HH/1q3NNteelVNNg6f41uWNuVxx70vaFqmXNNgwBXQaZF2rNsYCD0+lbVhGyDpUe0H7M6LQ22kV2Wg3WwrXEaaxTHzdu9dJpl4Ux9KftA9mei6Jf7Qv06Zrp9O1bYBzXnGmapt2jIrcstdwBz+tP2ncTpnfR6yuKr3mtLsPNcoPEKhfvVWvfEAx96lHlMvYRNDXNZ+U89q4PxXrWVb5qsa34i+VvmrhPFHiHKt81bKZLpnPeNdTyG+bNeOeOdS3B/wDGu28Y65lW5/WvJvGmqbt/zVsqhjKmefeN7vJbtXknjG43M/416J4xvM7+a8u8V3G8tW0ZmEqZwHidtxY/U1V+HnihtG1pVLcBhipPEkvLVxct/wDYNVjk3Y+bmto1DnlTPv74HaxpvxE8GX3h3Wo/tmj65ZTabfwZx51vNG0UqZ90Zhntmvya+Jnw8vvhL8Q9f8K6owk1Dw3qFxpk8gXas7QyMnmKP7rhQ6nuGByc1+gf7MPjow3duPM64HWvCf8Agrb8Ol0D9o/T/FFvHtt/G+jw3ErAYDXdti2lAHtCtmxPUmQ555O0ZGEoDP2R9NHhf4Ca1qxXy5ta1JkB/vQwRgJ+Ukk4rwX9ojxS09/Md38Rr6K0JP8AhE/2XvC9qPl8zTzefX7Q7z/ykH4Yr4++NerfaNWkXP3nx+tcspnXCmYfh753H+1zXe+HRgL7/wD664Lw2dyrXfeHOQD7VhKodMKZ3nhtM7a77w6nC/nXB+HG5XFd94cXdtrCVQ6Y0zuvDq/d213Xh2MNtrh/Drbdu3mu78Ppkr/KsZVDeNM7PQV+7XZaJExC1yOgjbtrs9Dj+79KxdQ3jTOn0iDha6nS4uRXPaNDwtdVpEQyKz9oaxpGzpsOe9bdlB9fWs/TEyRjritzT4sgf4Vn7Q09kW7KHaP1rVtIvaq1pCRWnbR5/wAKPaFezLNo236Y4rVs7jy6y4gRVhJdn0Io9oHszobXU9o+9V6HWtv8VcoL/wAscmhtY296PaE+yOubxDhetZ994jwp+btXMXOuY/iNZWoeIOPvVoqhnKmbOt+Jflb5q4jxH4k3Bvm/WodZ8QHDfNXG+INeJDZatFUM5Uin4r1rIf5v1rzLxbqmQ3PrW74l1fcG+avP/Eup53VtGoc8qZy3iq93Fq868Szkhv1rrvEl1u3fNXA+I7jLNnr9a2jUMZUzj/Elx97261wevSfMW/iBzXYeIps7hmuH8QSZVv1reNQ5Z0z1n9nnxY1vewfN/EO9d/8A8FOPDi+NP2WPDPiBF8y58M62sbE/8s7a6iZJD+M0VqP/ANQrwP4K60bfVVXd0bGPxr6j+M9mPHv7D3j6xYeZ5Gkf2l7j7HLHdkj04gP4ZreMzmlTPCvjFL/Yvww0ezXgWemW1vj0CQooH5Cvh/4oX3na83+9mvtj9p6X7PpJj7IgXH0FfCvxAn3eIMepNcs5nZCmafh59m0133htvu+nFedeHpeVz/nrXe+HZslcVzykdcaZ6N4cblef0rv/AA0c4PtXnPhuTbtHtXfeHZOV9a55VDphTPRvDjY2/lXdaB0X6Zrz/wAOTDC13Xh2b7v9K55VDpjTO+0EglfoM122hNkL+tcJoEu5V9uldroUvC/41jKZ0RpnaaJ0Wus0hBj8K5DRGJx/n0rrNIYYXk1nKoaxpnT6YvH6V0NigwOlc7pcv3e3HrXR6b0WodQ1VI1rRM1oW0ZHQCqdk+QK1LdS3/6qj2hXsgA2+1Nd8f41LMu3296qXD7f/rUe0D2ZHPc7B/8AXqnc3/FF1cYFZV7d7f8A9dX7Un2Q+81PH8VYep6sQDlutJqF5gVgapqBXPP41cahnKkR6xq5wea5HW9Wzu5q5q2ofe5rldbvuvPatI1DGVMyde1HO7muH8QXu8Nk8Vu67f8A3q4zX73Jb5s/jW8ahzypnOeILvdurhvEN1kMK6bxBeE7u1cTr8+d3at41DnnTOX8Qz7Q3NcTr8+C3+NdRr91979K4fX7jKtjpXRGRyzpl74Zaj5Ov4/26+1PhwR4l+C3ibTG+ZdS0O+syPUSW0kZ/wDQq+EvAV3t8R8eor7l/ZjuBd6OYT92WMofxBH9a6Y1DlqUz55/aek8/St/99Qw/EV8J+P32+IT/vda+5vjY/8Aavw70u7+8LrT7efPqGiVv618M/FFPs+vlu2+uWcjrp0y54en3ba77w5PkCvNfD9zkr/nNd34cufumuWVQ64Uz0vw3cbtueK9A8N3WCv9PrXmPh67yF/xrvvDlztxXNKZ2QpnpnhufIX6V3nh6fbt5/8ArV5n4cu/u8/jXeeHb3p/jXPKodUKZ6VoFxwv0rtdBuSAteceH7vOPeu20K6GFzWMqh0RpnoWiXGNtdbo8uNv+fSuC0S9zt/pXV6NedDWLqG0aR3Okz4A/nXRafc8AVxel3uQvzV0Gm3ykCs/aGqpHYWF2CK1Le9VRXK2eoYTrWhFqean2pfsjdnvgV/D1qjdXS7aqPqXy1Tn1Dk9KPai9kOvLoLWPfXeBjNPvb4YNY1/e5FV7Ql0yvqN3jNc7ql7jPJq7qd78vWuc1O/znnmtFUMpUyhq+ocfxEVymtXuA2K09XveTXKaze/erWNQxlTMnXL37w/lXG67dZzg1ua3fcNXG67e8Nz+tbxqHPOmYeu3f3q4nX7r71dBrt5ndzXE6/e4Lc10Rmcs6Zz+vXvDVw+v3WN1dF4gvc7ua4jX73Bb5q6YVDjqUy34Cn3+Ix/vCvub9mG6+z6R5x4EaFz9ACa+D/hj++8QBu28V9ufCq9/sP4ReINQJ2rY6Rd3R9gkDvn9K6oSOScDxG5k/4SP9njQJR83l2P2b3Hks0P8o6+LfjdZmDVHP8AdYkfnX2P8Fbr+3Pg3qmnt80mnXhcD+7HKgK/+PpJXy5+0ToP2e+n+X7rGuWpI66dM878P3eNtd14du8ba8z0K7w2D1H867bw9e7SorllM7adM9S8OXmNvPPau88N3mNteV+Hr/bt5ru/Dt9jb2rllUO2nTPVfD19gL81d34fv8kc15V4e1Hlee1dx4f1HO2uaVQ6o0z1TQb7O3mu00K/xt+avLdA1L7uDXaaHqf3fmrnlUOqNM9P0XUdyrzxXV6TqGSvze9eZ6Nq3A6V1mk6v0/xrF1DeNM9G0nUuOv/ANeug07VNo/+vXnum6vwK3LDV8d6zdQ1jSO+tdW6c1ch1XH8VcXa6zjHzVcTWcD71T7Q09idXJquR1H5VWn1T3rBfWAV61Xn1fcPvdKPaC9ka17qfFY9/qC5PvVO61fIJzWPf6qP71UqhDpFjUtQ25+auc1bUuvPak1DVchue1c9qmr4B5zWiqGTpEWr6jkH6Vyus6jyas6tqeQxzXLazquA30raNQwlTKOuah97muP1zU8lutaGt6pjdXH67qYIb5q6ITOWVMy9e1HIbmuL1/UN27/GtbXtUxuri9e1Ldu5xXTCoctSmY+vahjPNcTrt9w3NbWvah97muL12/LMdvUmuqEjjqUzuPgnb/adWRuu5819feLNR/4RL9k7xdcN8vn6YbEerfaXS3I/KU/hmvl39njRzcXsGF6kDpXv37XGtDw78ANF0hW2za1qSuR/fhgjZmH/AH8eA11U5HFUpnlH7N2qiz8Y3WmyNiPWLR0Uessf7xc/8BEo+rCvO/2pfCBjup2C+p6fWtPw/q83hzW7PULfmaxmS4RSeGKkHafY4wfYmvQ/2j/DEPiDQ1v7X95bXUK3EL4+9G67lP5EVz1JHXTgfArZsNVkj9811Og3/C89sVl/E7RW0fWmk29GOar6FqGdpz/9euOpI7qdM9S0DUMba7rQNUwF+leT6DqW3b81dtoGpbNvNclSZ2U6Z614e1Lhea7bQdVOVryXQdVyV+au10LV87ef/r1yyqHZTpnrWgaqCB82K7HQ9VxjmvJ9D1b7vNddomtkAYaueVQ64Uz1jRtX4HNdRpWsYA5ryvSNcxty1dNpWucLhqwlUOmNM9Q07WuB83vW5ZazgD5q8007XM4+atuz1wEDn9aydQ1VM9EttawOtW4dcwPvVwVtr3H3qtJ4gAH3qj2hfsjtxroA+9+tRTa0B/FXHnX8D71Ml18H+Kj2geyOluda2/xVlX+tYHWsK51zg81mXmvYz83arVQh0zV1HWslvmrn9U1ng/NVDUNcyD83b1rA1TWsZ5rSNQylTLGq6x15rl9Z1n730qPVda4bn9a5fWNaxnn9a6I1DmnTDWtXAz81cfrWrZDc1JrOs/e/xrktb1jJbn9a6ITOWpTINa1cc81xmuangtzVvW9W3bua4/WtVzuy1dVOZxVKZR13U/vc1y4lOoapHGOfm5FSa5qfXmp/hrpbaxrSvjcN3H0rrpyOOpTPpX9lzww0l3bnb6dqvftp+J11b4nWOjRtmHw7p8cbL6TzYlcj6oYB9VNd5+ztoVt4Z8Py6pfN5NnYwPc3D4+5EilmP4KpNfPHivxDceMfE2oavdjbdapcyXcig5CF2LbB7LnaPQAV2QkcNSBUjTJ+vJr1f4a3q+OPhldaPN811o5Jjz1eBySPrtbcPYFBXlSLn+ddB8PvFbeCPFdrf7Wa3GYblF5MkLffHuRwwH95FrnqSOqnA8R/aI+H7WV5P8nc9q8OsLhrC4aJuNp/MV95/tK/DOPUbNru38uaGVBIkicq6kZDA+hBBFfEvxH8MSaHq0kgUqA3PFcVSR3U4mpoep4KnNdloOq52815XouqYI5611+i6tkLzxXHOR3U6Z6voWr/AHea7LRNZzt5ryXQ9Z9W/Guu0bWfu/NXLOZ3U6Z65omt7cfN2rrtF1wELz+FeRaLruMYauq0jXduPmrllI64Uz1zSNb+781dHpmvYx8xryfSvEHC/NXRab4iAA+bt61zyqHTGmerad4gPHzfrWxZ+IR/e/WvL7DxDgdf1rWs/EHH3qyczdUz0y28Qjj5qtR+I+nP615zB4ix/FVqLxJ/tfrUe0LVM77/AISHI+9UcviHj7361xLeI93U/rUcviLj7360e0H7M6+41/A68Vm3fiHI+9+tctceIP8Aa/Ws288Q4/izVqoZumdHf6/x1rC1LXuD81Yd94gyPvVh6j4hxu+atY1DCVM1tV1373P61zOr6397ms/U9fyD8361zeq691/xrojI550y1rOt8HmuT1rWvvc/rUWr631+auW1nWs5+auqEzjqUxdb1jO7muQ1vV8huafrOscn5q5PWNY2Z5rqpyOGpTEv7xry4Ea53MQOK9r/AGePArXd5B8mdxHavIPh14ek17V1chtpYY47V9qfs4fD2HTLFby4McNvAhklkf5ViRRlmJ7AAEk+grspyOGpE0/j54gXwH8IrTQYG23niBgZQOsdtGQW+m9wijPBUSCvAJFwf5V1XxU8dP8AEjxzeaptkS3bEFnGw5ht0yEGOxPLkdNztiuYYZz7c1205HDUih8Qz7dqsQpjmowuasRrg/SsKkjopxPSPhjrEfjHwvL4cvMNcWqNJZFuskXJaP6rywH90kdEr56/aO+EDWlzNtj4ySOK9J0y+n0u+gureRobi3cSRuv8LDp9foeD06V6F4r0az+MXgs6hbxrHcINl1CP+WEmPz2nqD6cdQQOGpI9ClFn5vahaSaBqDRsGC579q19G1Pbtwa9H+OXwhksLqb93tYE9q8bVpdJujHJxg9a46kjvpwPSNF1j7vzV1eka3tx83avKtJ1fbt+aum0jWtuPmrjnI76cD1nR9cwBzXTaVr3T5q8l0nXOR81dJpmv/7X61yymdlOmetaZ4g7bq6DTfEXA+b9a8n03xDuA+at2x8QdPmrnlM6qdM9WsfEW3+Kta18Tf7X615ZZeIsD71alt4mwB8361hKodEaZ6fb+Jc/xVZj8R8ferzWDxLn+KrEfiPj735Go9oaezPRP+Ek/wBr9ajk8R5H3h+Brgm8S8fepknib/a/Wj2gOmdtceJMfxVQuvEme9cfN4n4+9iqN14lA/iq1MzdM6m98RZzz+tYeoeIsfxfrXO3viTj71ZF/wCIx/ereMznnTN3UvEPXk1zuqeIMhvm/WsfUfEOd3zGsHU/EHX5q6ITOWpTNHVNd4PzVzGsa4Wz81U9U13cOD+tc3qeuZLfNXVCRxVIljV9Yxnmsezjk13UViQFlzyR3qjLdPqdwIo/mY1658EvhXJqN3C3lnLEcYrrpyOGpA9A/Z2+FTXtxBmM7cg9Ote3fG7xUng/wnD4VsWC3V8iyX5U8xRdUiz2L8MR12gdVerXh+1s/gr4G/tK4jSS6ceXaQHrcS4799q9WPpgdSAfI9X1C41nUri8upmuLq5kMssjdXY8n6fQcAAAYFd1ORwVImfKufx4qCRf06ircq5P1FV35OPauynI8+pEdCMNViNcr9eahi5T+VWEXc1ZVGa04kka7vxrc8GeKLjwdrC3UK+ZG48u4gY/LOh6g+h7g9j6jIONEMN+lTxJ0+nNcNRno0onWfFj4Y2PxA8PrqWm7ZoLgEg4wyHurDsw7j8RkYJ+O/jF8HpdMupGWNlZST0r648E+MZ/CF43yfaLO5wLi2J+Vx/eHow7HvnB46XPih8JNP8AHuh/2hprJcQzA4bb8yHurDswyOP5ggnhqSPSpxPzpAm0u5Mcnyn+da2navjaM16Z8XfgdLptxLiFlP0ryG+0640KZlkVtqmud2l6nUrx1ex2em61nHzVv6Zr3+1Xmthqm3HzVsWGtYI+auOpGSO6jKEup6hp/iHGPmrcsfEW0D5q8tstewPvfrWtZeIMD71ccpM74RPUrPxJ0/oa0rbxJx979a8vtPEfvWhb+JN38Vc8pHTGmenQ+I+PvVNH4myPvfrXm8PiPP8AF+tWI/EpA+9U8xt7M9C/4SbH8VNk8TZ/iH51wX/CS/5zTH8TD+9SUw9mdxP4myPvfjmqNz4k4+9+tcbL4kwPvVTn8SjH3quMjKVM6278SZz81ZN94kwOv61zF14i/wBqsu88RZz81dEZHNOB0V/4hyDz+tYOpa91+asW+8QZ/i/WsXUNcJ6NXVTkcdSKRralrvJ+asZrmXUrjy4uSetVrS2uNdn2xhtpPXHWvXPhJ8F5dTnjzEWJI7V105HDUjch+EPwpk1G6jdo2ZmI7V9efC34d2Pw+8OtqmpHybe3UEnHzMeyKO7HoB/IZIg+GXwt0/wBof8AaWpFbe3hAySMsxxwqj+JjjoPQnoCRk+PPG9x41vkLKbeyteLa2ByIweNx9XI6nt0HHXrpyOGpEo+OvGNx451xrqYeTEqmO3gU5S3j/uj1J6k9yewAUYDrg/jVuUYJ+maglGT9c13U5HnVEVXTA+nSq8q4NWnGDn86rzjCV3U2edUiSQjBH0qZF/lUcfU1LG2Vz+lZ1DSluTRc1OvK1HGMGp415X864qkj0qJLGMN+lbHhXxPd+FL5pLcho5ABNA/Mcy+/uOcEcj6Eg5MQ2j8jU8PK1wVGejTR1viPwNpPxY0qSaxXbOq5lt3x5kPv7r/ALQ49cHIHzb8YP2c5LSWRlh465Ar2/T7ybT7tZreWSGaDlJEbaw/z+o46V1tt4m07xfbfZtajjt7hhtF0ifu3/3lH3T7jj/dFcdRnoU0fnT4o+G91oU7FUYYPpWCl1JZvtkDKffvX318T/2Z47+FprdEkjkXcjIQysOxBHBHuK+ePiJ+zpNYvJ/o7D8KzWKtpPVDlgebWm7M8btNZ/2q0rbXOOf50zXPhleaRI2xXX2IrDngurB/njbjuBVclKr8LMfbYig/fTOwttc/2v8A61XYddwM7q4KLV9vGfwNWo9Ywep/OueeBOmnmx3kev8AvUw19tv3zXCx64wH3v1qRfEGwda53gWdcc2jY7j+3mP8VNfxEQPvfrXFnXwaa+v/AO1il9RkV/asDsJdf/2qq3HiDJ+9XIya7jvVaXXNx4bP61vDAyOepm8TqbrXgB94/nWbd6+PX9ax4TdXz4jjbB7kVuaH8OLzVnXcrNu7YrX2NOn8TOf61Xrfw1/kZcmpSXj7Y1LHpW54Y+H954guF3qxBI4xXpXw9/Z6mvpI/wBwx59K+hvhj+zTHYwrNcRxxxxjc7OcKg7kk8Ae5o9snpFGscO171R3Z5L8Iv2eZLyWPMJwcckV9HeHPBmk/CfSY7i+UNcMuYrdMeZMf6L/ALR464ycAzT+J9P8H232fRY47i4UY+0un7tP90H7x9z8vswrk7+6l1C6kmuJJJppeXkdtzMf8/lW0GY1ES+LPFN54svhLcMFjjBWCBOI4V9vc4GWPJx6AAYz8NVqb7n05qtL92u2mzz6iK0gwtQTDI/OrMq/e+lQy8mu6mzzqxVnXn9ahkHLfSrEi5UZqF+ld1M82ruCDK/jUyHIx6k4qGMZH41YiPzfjU1CqJOo5qzGMVVT7v4Vaj6muGqelTJYhkfhViLkCoIug+lWIui/SuGoz0qZIozU0H3h9P8AGoVOAPck1YiOWauGoehT3NXQfEt54fO23m/cuctC43RP9V9fcYPvWvPc6F4wj8u+t/sEzcFseZC349V+hBA9a5qHqPzqeMctXHUZ30zP8Y/sx2usWzT2ixTQtna8RDofoRxXkPjH9liaFnK2+evQV7tYX82my+ZbzSwMQMlGK5+uOo9jW3beOJ5l23lva3i9CSnlufxXj/x2uWV76HdBJ7nxH4k/Zwmt2b/R2/75rktR+B11as22ORfoDX6Ezr4f1kf6RZz27N1+USKPx4P6VnXnwm8N6uN0V1ajd/z0Bj/9CAqVja0NpEyy3DVPiij88bj4W38LceZx7VXb4daip6N+VfoFc/s06Zd/6mW1kz/clVqpyfso27n5Yw34A1X9rVlpoZf6vYV9/vPgkfDrUS3Ib8qsW3wsv5jhvMr7uj/ZRgQ/NGo+oFXLf9mnTbQZmktI/XfKq/zNP+1qz00BcP4Vb3+8+G9N+B11csN0cjfUV1nhv9nK4nZf3Df9819mWfwl8N6SAZLq1P8A1zBk/wDQQa0YE8P6MP3FnPcMvqFjU/jyf0qHjK095Gsctw9L4Yo+bPBn7LE0zLutz+Ir1/wZ+zDa6TbrPdCKGJMEvIQij6k12s/jaeMbbO3tbFexVfMb824/QViX2oT6lN5lzNJO4HBkctgegz0H0qoSb1Zc420RqwXGheD4/Lsbf7fMvAbHlxA/U8t+Ax71j694lvNfO24l/dKcpCg2xJ9F9fc5PvUMnaoJurfSuqmcE9iCX731quTkfQ4qzJ99arM29WPvXZTOCoRSjhvzqvMNwNWZTw30qvP/AENd1M8+oV3OWH0qu44+tWXODVeQ4H0rupnnVUQSfd/Gq7jC/jU8p27vpUMpyD9a7qZ5lU//2Q==";
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1499)
      , a = n.osg
      , s = r.prototype
      , o = function() {
        r.apply(this, arguments),
        this.assignMatcapTexture(),
        this._outputs = [],
        this._index = o.DEFAULT
    }
      , u = o;
    u.DIFFUSE = 1,
    u.SPECULAR = 2,
    u.ROUGHNESS = 4,
    u.GEOMETRY = 8,
    u.EMIT = 16,
    u.ENVIRONMENT = 32,
    u.MATCAP = 64,
    u.WIREFRAME = 128,
    u.DEFAULT = u.DIFFUSE | u.SPECULAR | u.ROUGHNESS | u.GEOMETRY | u.EMIT | u.ENVIRONMENT,
    o.prototype = a.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "Blending"
        },
        setOutputs: function(t, e) {
            this._outputs[0] = t,
            this._outputs[1] = e
        },
        computeShader: function(t) {
            return this._index = t,
            t & o.MATCAP ? this.getMatcapFragment() : this.getDefaultFragment()
        },
        createFragmentShaderGraph: function() {
            var t = this.computeShader(this._outputs[0])
              , e = this._outputs[1] !== this._outputs[0] ? this.computeShader(this._outputs[1]) : t
              , i = this.createVariable("vec3");
            return this.getNode("Blend").mode("MIX").inputs(t, e, this.getOrCreateUniform("float", "uBlend")).outputs(i),
            [this.getFinalFrag(i)]
        },
        getDefaultFragment: function() {
            var t, e = this.createLighting(), i = this._index & u.ENVIRONMENT ? this.getEnvironment() : void 0;
            return e && i ? (t = this.createVariable("vec3"),
            this.getNode("Add").inputs(e, i).outputs(t)) : t = e || i || this.getOrCreateConstantZero("vec3"),
            this._index & u.EMIT && (t = this.applyEmissive(t)),
            t
        },
        getOrCreateMaterialDiffuseColor: function() {
            return this._index & u.DIFFUSE ? s.getOrCreateMaterialDiffuseColor.call(this) : this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialSpecularColor: function() {
            return this._index & u.SPECULAR ? s.getOrCreateMaterialSpecularColor.call(this) : this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialSpecularHardness: function() {
            return this._index & u.SPECULAR ? s.getOrCreateMaterialSpecularHardness.call(this) : this.getOrCreateConstantOne("float")
        },
        getOrCreateMaterialNormal: function() {
            return this._index & u.GEOMETRY ? s.getOrCreateMaterialNormal.call(this) : this.getOrCreateNormalizedNormal()
        },
        getMatcapFragment: function() {
            return this.getMatcapColor(this.getOrCreateMaterialNormal())
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1498)
      , r = i(1571)
      , a = function() {
        n.apply(this, arguments),
        this.setShaderCompiler(r)
    };
    a.prototype = n.prototype,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1499)
      , a = n.osg
      , s = function() {
        r.apply(this, arguments),
        this._isLighted = !1
    };
    s.prototype = a.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "Shadeless"
        },
        registerTextureMaterial: function(t, e) {
            switch (t.getName()) {
            case "AlphaMask":
            case "Opacity":
            case "DiffuseColor":
            case "EmitColor":
            case "DiffuseIntensity":
            case "Displacement":
                r.prototype.registerTextureMaterial.call(this, t, e)
            }
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {}
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1498)
      , a = i(1569)
      , s = n.osg
      , o = function() {
        r.apply(this, arguments),
        this._CompilerBlending = a,
        this._stackShader = [],
        this._indexShader = 0,
        this._onSameShader = !0,
        this._gl = null
    };
    o.prototype = s.objectInherit(r.prototype, {
        setGraphicContext: function(t) {
            this._gl = t
        },
        getNextIndexShader: function() {
            return this._indexShader === this._stackShader.length - 1 ? 0 : this._indexShader + 1
        },
        onSameShader: function() {
            this._onSameShader = !0
        },
        toNextShader: function() {
            this._indexShader = this.getNextIndexShader(),
            this._onSameShader = !1
        },
        getNextShader: function() {
            return this._stackShader[this.getNextIndexShader()]
        },
        getCurrentShader: function() {
            return this._stackShader[this._indexShader]
        },
        addShader: function(t) {
            this._stackShader.push(t)
        },
        compileAllShaders: function(t, e, i, n) {
            for (var r = this._stackShader, a = r.length, o = this._gl, u = {
                getGraphicContext: function() {
                    return o
                },
                applyProgram: function() {}
            }, l = this.getShaderProcessor(), c = 0, h = 2 * a; c < h; ++c) {
                var d = r[c % a]
                  , p = c < a ? d : r[(c + 1) % a]
                  , f = t + d + p;
                if (this._cache.has(f) !== !0) {
                    var g = new this._CompilerBlending(i,n,l);
                    g.setOutputs(d, p);
                    var m = g.createFragmentShader()
                      , v = g.createVertexShader()
                      , _ = new s.Program(new s.Shader(s.Shader.VERTEX_SHADER,v),new s.Shader(s.Shader.FRAGMENT_SHADER,m));
                    _.hash = f,
                    _.setActiveUniforms(this.getActiveUniforms(e, i, n)),
                    _.generated = !0,
                    _.apply(u),
                    this._cache.set(f, _)
                }
            }
        },
        getOrCreateProgram: function(t) {
            var e = this.getNextShader()
              , i = this._onSameShader === !0 ? e : this.getCurrentShader()
              , n = ""
              , r = []
              , a = [];
            n += this.getActiveAttributeList(t, r),
            n += this.getActiveTextureAttributeList(t, a);
            var s = n + i + e
              , o = this._cache.get(s);
            return void 0 !== o ? o : (this.compileAllShaders(n, t, r, a),
            this._cache.get(s))
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1498)
      , r = i(1511)
      , a = function() {
        n.apply(this, arguments),
        this.setShaderCompiler(r)
    };
    a.prototype = n.prototype,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1573)
      , r = i(1575)
      , a = function() {
        n.apply(this, arguments),
        this.setShaderCompiler(r)
    };
    a.prototype = n.prototype,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1511)
      , a = n.osg
      , s = function() {
        r.apply(this, arguments),
        this._isLighted = !1
    };
    s.prototype = a.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "ShadelessPBR"
        },
        registerTextureMaterial: function(t, e) {
            switch (t.getName()) {
            case "AlphaMask":
            case "Opacity":
            case "EmitColor":
            case "DiffusePBR":
            case "AlbedoPBR":
            case "CavityPBR":
            case "AOPBR":
            case "Displacement":
                r.prototype.registerTextureMaterial.call(this, t, e)
            }
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {}
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1573)
      , a = i(1572)
      , s = i(1577)
      , o = n.osg
      , u = function() {
        r.apply(this, arguments),
        this._CompilerBlending = s,
        this._stackShader = [],
        this._indexShader = 0,
        this._onSameShader = !0,
        this._gl = null
    }
      , l = a.prototype;
    u.prototype = o.objectInherit(r.prototype, {
        setGraphicContext: l.setGraphicContext,
        getNextIndexShader: l.getNextIndexShader,
        onSameShader: l.onSameShader,
        toNextShader: l.toNextShader,
        getNextShader: l.getNextShader,
        getCurrentShader: l.getCurrentShader,
        addShader: l.addShader,
        compileAllShaders: l.compileAllShaders,
        getOrCreateProgram: l.getOrCreateProgram
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1569)
      , a = i(1511)
      , s = n.osg
      , o = r
      , u = o.prototype
      , l = a.prototype
      , c = function() {
        a.apply(this, arguments),
        this.assignMatcapTexture(),
        this._outputs = [],
        this._index = o.DEFAULT
    };
    c.prototype = s.objectInherit(a.prototype, {
        getCompilerName: function() {
            return "BlendingPBR"
        },
        getOrCreateMaterialAlbedo: function() {
            return this._index & o.DIFFUSE ? l.getOrCreateMaterialAlbedo.call(this) : this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialDiffusePBR: function() {
            return this._index & o.DIFFUSE ? l.getOrCreateMaterialDiffusePBR.call(this) : this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialRoughness: function() {
            return this._index & o.ROUGHNESS ? l.getOrCreateMaterialRoughness.call(this) : this.getOrCreateConstant("float", "defRough").setValue("0.2")
        },
        getOrCreateMaterialSpecularPBR: function() {
            return this._index & o.SPECULAR ? l.getOrCreateMaterialSpecularPBR.call(this) : this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialSpecularF0: function() {
            return this._index & o.SPECULAR ? l.getOrCreateMaterialSpecularF0.call(this) : this.getOrCreateConstant("float", "defF0").setValue("0.04")
        },
        setOutputs: u.setOutputs,
        computeShader: u.computeShader,
        createFragmentShaderGraph: u.createFragmentShaderGraph,
        getDefaultFragment: u.getDefaultFragment,
        getMatcapFragment: u.getMatcapFragment,
        getOrCreateMaterialNormal: u.getOrCreateMaterialNormal
    }),
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(1498)
      , r = i(1579)
      , a = function() {
        n.apply(this, arguments),
        this.setShaderCompiler(r)
    };
    a.prototype = n.prototype,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1499)
      , a = n.osg
      , s = function() {
        r.apply(this, arguments),
        this._isLighted = !1,
        this._isVertexAlpha = !!this._material && this._material.getVertexAlphaEnable(),
        this._isVertexColored = this._isVertexAlpha,
        this.assignMatcapTexture()
    };
    s.prototype = a.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "Matcap"
        },
        registerTextureMaterial: function(t, e) {
            switch (t.getName()) {
            case "AlphaMask":
            case "Opacity":
            case "NormalMap":
            case "BumpMap":
            case "Displacement":
                r.prototype.registerTextureMaterial.call(this, t, e)
            }
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getMatcapColor(this.getOrCreateGeometryNormal());
            return [this.getFinalFrag(t)]
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1498)
      , r = i(1581)
      , a = function() {
        n.apply(this, arguments),
        this.setShaderCompiler(r)
    };
    a.prototype = n.prototype,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1499)
      , a = n.osg
      , s = function() {
        r.apply(this, arguments),
        this._isVertexColored = !1
    };
    s.prototype = a.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "Wireframe"
        },
        registerTextureMaterial: function(t, e) {
            var i = t.getName();
            "Displacement" === i && r.prototype.registerTextureMaterial.call(this, t, e)
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.getNode("InlineCode").code("%out = vec4( %color.rgb * %color.a, %color.a);").inputs({
                color: this.getOrCreateUniform("vec4", "uColor")
            }).outputs({
                out: t
            }),
            [t]
        },
        declareScreenVertex: function(t) {
            var e = this.getOrCreateViewVertex()
              , i = this.createVariable("vec4");
            return this.getNode("InlineCode").code("%out = %pos; %out[3] += 0.005 / %proj[1][1];").inputs({
                proj: this.getOrCreateUniform("mat4", "uProjectionMatrix"),
                pos: e
            }).outputs({
                out: i
            }),
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uProjectionMatrix"),
                vec: i
            }).outputs({
                vec: t
            }),
            t
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1583)
      , a = i(1584)
      , s = {
        FeatureName: "fov",
        ModelType: r,
        ViewListType: [a]
    };
    t.exports = n.create(s)
}
, function(t, e, i) {
    "use strict";
    var n = i(238)
      , r = n.extend({
        defaults: {
            fov: 45
        },
        getName: function() {
            return "Fov"
        },
        init: function(t) {
            var e = t.getModel().get("options");
            e.scene && e.scene.fov && this.set("fov", e.scene.fov)
        },
        getJSON: function() {
            return {
                fov: this.get("fov")
            }
        }
    });
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(258)
      , a = i(1486)
      , s = n.osg
      , o = r.extend({
        initialize: function() {
            r.prototype.initialize.apply(this, arguments),
            this.model.bind("change:fov", this.onFovChanged, this),
            this._dolly = !1,
            this.onFovChanged(),
            this._dolly = !0
        },
        onFovChanged: function() {
            var t = this.options.context.getViewer()
              , e = t.getCamera()
              , i = e.getViewport()
              , n = i.width() / i.height();
            if (s.Matrix.makePerspective(this.model.get("fov"), n, 1, 1e3, e.getProjectionMatrix()),
            this._dolly) {
                var r = this.options.context.getViewer().getViewerOSGJS().getManipulator()
                  , o = r.getCurrentManipulator();
                if (o) {
                    var u = o.getHomeBound();
                    u && r.setDistance(o.getHomeDistance(u))
                }
            }
            var l = t.getFeatures().manipulator;
            l && l.getModel().saveCameraPosition(),
            a.draw()
        }
    });
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1586)
      , a = i(1587)
      , s = {
        FeatureName: "quality",
        ModelType: r,
        ViewListType: [a]
    };
    t.exports = n.create(s)
}
, function(t, e, i) {
    "use strict";
    var n = i(285)
      , r = i(238)
      , a = i(1465)
      , s = i(1191)
      , o = r.extend({
        defaults: function() {
            var t = 1;
            return n.any ? t = 0 : s() && (t = 2),
            {
                level: t
            }
        },
        getBudget: function() {
            var t = a();
            return void 0 !== t.pixelBudget ? 0 === t.pixelBudget ? 1 / 0 : t.pixelBudget : this.getBudgetFromLevel(this.get("level"))
        },
        getBudgetFromLevel: function(t) {
            return 0 === t ? 2048 : 1 === t ? 8192 : 1 / 0
        },
        getName: function() {
            return "Quality"
        }
    });
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(258)
      , r = i(1482)
      , a = i(1465)
      , s = i(1485)
      , o = i(1198)
      , u = o.osg
      , l = function(t) {
        return 0 === (t & t - 1)
    }
      , c = function(t) {
        return 1 << Math.floor(Math.log2(t))
    }
      , h = function(t) {
        return 1 << Math.ceil(Math.log2(t))
    }
      , d = function(t) {
        if (l(t))
            return t;
        var e = c(t);
        return t / e - 1 > .75 ? h(t) : e
    }
      , p = u.Timer.instance()
      , f = ["glframe"]
      , g = n.extend({
        initialize: function() {
            n.prototype.initialize.apply(this, arguments);
            var t = this.options.context;
            this._viewer = t.getViewer(),
            this._fMaterial = t.getFeatures().material,
            this._version = t.getModel().get("options").version,
            this.model.bind("change:level", this.onLevelChanged, this),
            this.model.bind("updateTexelPolicy", this.updateTexelPolicy, this),
            this._qualityReady = !1,
            this._maxSize = s(1 / 0),
            this._timers = {},
            r.getHighResBound().then(this.initTimers.bind(this))
        },
        initTimers: function() {
            for (var t = 0, e = f.length; t < e; ++t)
                this._timers[f[t]] = {
                    accumValue: 0,
                    accumSamples: 0,
                    accumStart: p.tick(),
                    averageValue: 0
                };
            var i = u.TimerGPU.instance();
            i.setFrameAverageCount(20),
            i.setCallback(this.callbackGPU.bind(this))
        },
        callbackGPU: function(t, e) {
            if (this._viewer.getViewerOSGJS().callbackTimerGPU(t, e),
            "glframe" === e) {
                var i = this._timers[e];
                i.accumValue += t / 1e6,
                i.accumSamples++;
                var n = p.tick();
                if (n - i.accumStart >= 2e3) {
                    i.averageValue = i.accumValue / i.accumSamples,
                    i.accumValue = 0,
                    i.accumStart = n,
                    i.accumSamples = 0;
                    var r = this._viewer.getFeatures().postProcess.getModel();
                    i.averageValue < 10 ? r.set("dofQuality", 3) : i.averageValue < 12 ? r.set("dofQuality", Math.max(r.get("dofQuality"), 2)) : i.averageValue < 14 ? r.set("dofQuality", Math.max(r.get("dofQuality"), 1)) : i.averageValue > 17 && r.set("dofQuality", 0)
                }
            }
        },
        getMaterials: function() {
            return this._fMaterial.getModel().attributes
        },
        onLevelChanged: function() {
            this.updateTexelPolicy();
            var t = this._fMaterial._views[0];
            this._viewer.setFakeSecondaryProgress(t.requestAllHighResTextures(this._fMaterial.getModel().attributes), 0),
            this._fMaterial._views[0].cleanAndApplyMaterials()
        },
        getOrCreateTexelInfos: function() {
            return this._fMaterial._views[0].getOrCreateTexelInfos()
        },
        getMaxSizeFromBudget: function(t) {
            var e = t * t
              , i = this.getOrCreateTexelInfos();
            if (0 === i.count || i.size <= e)
                return this._maxSize;
            var n = Math.min(this._maxSize, Math.sqrt(e / i.count));
            return n = d(n),
            this._version < 2 && (n < 1024 ? n = 512 : n >= 1024 && n < 2048 && (n = 2048)),
            i.max <= n || i.size <= n * n ? this._maxSize : n
        },
        updateTexelPolicy: function() {
            var t = this.getOrCreateTexelInfos();
            0 === t.count || t.missingResolution || (this._qualityReady || (this._qualityReady = !0,
            this.initAvailableQuality()),
            a().maxTextureSize = this.getMaxSizeFromBudget(this.model.getBudget()))
        },
        initAvailableQuality: function() {
            var t = this.getMaxSizeFromBudget(this.model.getBudgetFromLevel(0))
              , e = this.getMaxSizeFromBudget(this.model.getBudgetFromLevel(1))
              , i = {
                low: !0,
                mid: e !== t,
                high: e !== this._maxSize
            }
              , n = this.model.get("level");
            i.high || 2 !== n || (n = 1),
            i.mid || 1 !== n || (n = 0),
            this.model.off(null, this.onLevelChanged, this),
            this.model.set("level", n),
            this.model.on("change:level", this.onLevelChanged, this),
            this.model.trigger("qualityReady", i)
        }
    });
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1589)
      , a = i(1590)
      , s = {
        FeatureName: "autospin",
        ModelType: r,
        ViewListType: [a]
    }
      , o = n.create(s);
    o.prototype.getNode = function() {
        return this._views[0]._nodeAutospin
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(234)
      , r = i(1465)
      , a = n.Model.extend({
        defaults: {
            enable: !1,
            paused: !1,
            speed: .6
        },
        getName: function() {
            return "Autospin"
        },
        init: function() {
            var t = r();
            void 0 !== t.autospin && (this.set("enable", !!t.autospin),
            this.set("speed", t.autospin))
        }
    });
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(258)
      , a = i(1591)
      , s = n.osg
      , o = r.extend({
        initialize: function() {
            r.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:enable", this.onEnableChanged, this),
            t.bind("change:paused", this.onPausedChanged, this),
            t.bind("change:speed", this.onSpeedChanged, this),
            this._nodeAutospin = new s.MatrixTransform,
            this._nodeAutospin.setName("Feature - Autospin"),
            this._callbackAutospin = new a(t.get("speed"),1,1),
            this._nodeAutospin.addUpdateCallback(this._callbackAutospin),
            t.get("enable") === !1 && this._callbackAutospin.deactivate()
        },
        onEnableChanged: function() {
            this.model.get("enable") === !0 ? this._callbackAutospin.resume() : this._callbackAutospin.deactivate()
        },
        onPausedChanged: function() {
            this.model.get("enable") !== !1 && (this.model.get("paused") === !0 ? this._callbackAutospin.pause() : this._callbackAutospin.resume())
        },
        onSpeedChanged: function() {
            this._callbackAutospin.setSpeed(this.model.get("speed"))
        }
    });
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1486)
      , a = n.osg
      , s = function(t, e, i) {
        this._speed = void 0 !== t ? t : -.6,
        this._fadeStart = void 0 !== e ? e : 2,
        this._fadeEnd = void 0 !== i ? i : 2,
        this._enable = !0,
        this._rotation = 0,
        this._lastTime = -1,
        this._startTime = 0,
        this._endTime = 0,
        this._checkIfFinished = !1,
        this._fixedCenter = void 0
    };
    s.prototype = {
        setSpeed: function(t) {
            this._speed = t
        },
        setFadeStart: function(t) {
            this._fadeStart = t
        },
        setFadeEnd: function(t) {
            this._fadeEnd = t
        },
        deactivate: function() {
            this._enable = !1
        },
        resume: function() {
            this._enable = !0,
            this._checkIfFinished = !1;
            var t = Math.max((this._endTime - this._lastTime) / this._fadeEnd, 0);
            this._startTime = this._lastTime - this._fadeStart * t,
            this._endTime = this._lastTime,
            r.draw()
        },
        pause: function() {
            var t = Math.min((this._lastTime - this._startTime) / this._fadeStart, 1);
            this._endTime = this._lastTime + this._fadeEnd * t,
            this._checkIfFinished = !0
        },
        smoothStep: function(t) {
            return t * t * (3 - 2 * t)
        },
        update: function() {
            var t = a.Matrix.create();
            return function(e, i) {
                if (this._enable === !1)
                    return !0;
                r.draw();
                var n = i.getFrameStamp().getSimulationTime();
                if (this._checkIfFinished === !0 && this._endTime < n)
                    return this._enable = !1,
                    this._checkIfFinished = !1,
                    this._lastTime = -1,
                    !0;
                if (this._lastTime < 0)
                    return this._lastTime = n,
                    this._startTime = n,
                    !0;
                var s = n - this._lastTime;
                this._lastTime = n,
                this._endTime > n ? this._rotation += s * this.smoothStep((this._endTime - n) / this._fadeEnd) : n - this._startTime < this._fadeStart ? this._rotation += s * this.smoothStep((n - this._startTime) / this._fadeStart) : this._rotation += s;
                var o = e.getMatrix();
                a.Matrix.makeRotate(-this._rotation * this._speed, 0, 0, 1, o);
                var u = e.getChildren();
                if (u.length > 0) {
                    if (!this._fixedCenter) {
                        var l = u[0].getMinimumBound();
                        l.valid() && (this._fixedCenter = a.Vec3.create(),
                        a.Vec3.copy(l.center(), this._fixedCenter))
                    }
                    var c = this._fixedCenter || u[0].getMinimumBound().center()
                      , h = c[0]
                      , d = c[1]
                      , p = c[2];
                    a.Matrix.makeTranslate(-h, -d, -p, t),
                    a.Matrix.preMult(o, t),
                    a.Matrix.makeTranslate(h, d, p, t),
                    a.Matrix.postMult(t, o)
                }
                return e.dirtyBound(),
                !0
            }
        }()
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1593)
      , a = i(1594)
      , s = {
        FeatureName: "orientation",
        ModelType: r,
        ViewListType: [a]
    }
      , o = n.create(s);
    o.prototype.getNode = function() {
        return this._views[0]._nodeOrientation
    }
    ,
    o.prototype.getNodeGrid = function() {
        return this._views[0]._nodeGrid
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(234)
      , r = i(1198)
      , a = r.osg
      , s = n.Model.extend({
        defaults: {
            matrix: a.Matrix.create(),
            showGizmo: !1
        },
        getName: function() {
            return "Orientation"
        },
        init: function(t) {
            var e = t.getModel().get("options").orientation.matrix;
            e && this.set("matrix", e)
        },
        getJSON: function() {
            return {
                matrix: this.get("matrix")
            }
        }
    });
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(258)
      , a = i(1595)
      , s = i(1596)
      , o = n.osg
      , u = n.osgUtil
      , l = r.extend({
        initialize: function() {
            r.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:matrix", this.onMatrixChanged, this),
            t.bind("change:showGizmo", this.onGizmoShowChanged, this),
            t.bind("turn", this.onTurn, this),
            t.bind("reset", this.onReset, this);
            var e = this.options.context;
            this._viewer = e.getViewer();
            var i = this._viewer.getViewerOSGJS().getManipulator();
            this._nodeGrid = new s,
            this._nodeGrid.setName("Node grid"),
            this._nodeOrientation = new o.MatrixTransform,
            this._nodeOrientation.setName("Feature - Orientation"),
            this._nodeOrientation.addChild(this._nodeGrid),
            this._nodeGizmo = new o.MatrixTransform,
            this._nodeGizmo.setCullingActive(!1),
            this._nodeGizmo.editMask = u.NodeGizmo.PICK_ARC,
            this._gizmoTra = new o.MatrixTransform,
            this._gizmoTra.setReferenceFrame(o.Transform.ABSOLUTE_RF),
            this._gizmoTra.addChild(this._nodeGizmo),
            this._callbackOrientation = new a(i,.5,this,e.getScene().getRoot()),
            this._nodeOrientation.addUpdateCallback(this._callbackOrientation),
            this._callbackOrientation.rotateNode(this._nodeOrientation);
            var n = this.model.get("matrix");
            this._nodeOrientation.setMatrix(n),
            o.Matrix.makeRotateFromQuat(o.Matrix.getRotate(n, o.Quat.create()), this._nodeGizmo.getMatrix())
        },
        onReset: function() {
            o.Matrix.setRotateFromQuat(this.model.get("matrix"), o.Quat.identity),
            this.onMatrixChanged()
        },
        onTurn: function(t, e) {
            var i = "right" === e ? 1 : -1
              , n = "x" === t ? i : 0
              , r = "y" === t ? i : 0
              , a = "z" === t ? i : 0
              , s = o.Matrix.makeRotate(-Math.PI / 2, n, r, a, o.Matrix.create());
            o.Matrix.postMult(s, this.model.get("matrix")),
            this.onMatrixChanged()
        },
        onGizmoShowChanged: function() {
            var t = this.model.get("showGizmo")
              , e = this._viewer.getFeaturesManager();
            if (e) {
                var i = e.getNodeGizmo();
                i && (o.Matrix.makeRotateFromQuat(o.Matrix.getRotate(this.model.get("matrix"), o.Quat.create()), this._nodeGizmo.getMatrix()),
                i.setForcePicking(t),
                i.setRotateInLocal(!t),
                i.setTranslateInLocal(!t),
                i.attachToMatrixTransform(t ? this._nodeGizmo : null),
                this._nodeGrid.showGridTemporary(t ? 0 : 5),
                this._callbackOrientation.setGizmoMode(t))
            }
        },
        onMatrixChanged: function() {
            this.model.get("showGizmo") || this._nodeGrid.showGridTemporary(5);
            var t = this._callbackOrientation;
            t.setQuatTarget(o.Matrix.getRotate(this.model.get("matrix"), o.Quat.create()))
        }
    });
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1546)
      , a = i(1486)
      , s = n.osg
      , o = function(t, e, i, n) {
        this._model = i.model,
        this._manipulator = t,
        this._applyWithoutTranslation = !1,
        this._quatCurrent = s.Matrix.getRotate(this._model.get("matrix"), s.Quat.create()),
        this._quatTarget = s.Quat.create(),
        this._quatStart = s.Quat.create(),
        this._nodeGrid = i._nodeGrid,
        r.call(this, e),
        this._finished = !0,
        this._nodeGizmo = i._nodeGizmo,
        this._gizmoTra = i._gizmoTra,
        this._gizmoMode = !1,
        this._rootModel = n,
        this._features = i.options.context.getFeatures()
    };
    o.prototype = s.objectInherit(r.prototype, {
        setQuatTarget: function(t) {
            s.Quat.copy(this._quatCurrent, this._quatStart),
            s.Quat.copy(t, this._quatTarget),
            this.reset(),
            this._gizmoMode = !1
        },
        setGizmoMode: function(t) {
            this._gizmoMode = t
        },
        getQuatTarget: function() {
            return this._quatTarget
        },
        getQuatStart: function() {
            return this._quatStart
        },
        smoothStep: function(t) {
            return t * t * (3 - 2 * t)
        },
        update: function(t, e) {
            if (this._gizmoMode)
                return s.Matrix.getRotate(this._nodeGizmo.getMatrix(), this._quatCurrent),
                this.rotateNode(t),
                !0;
            if (this._finished)
                return !0;
            a.draw();
            var i = e.getFrameStamp().getSimulationTime()
              , n = this.interpolate(i, t, e);
            return n = this.smoothStep(n),
            s.Quat.slerp(n, this._quatStart, this._quatTarget, this._quatCurrent),
            this.rotateNode(t),
            this._finished && (s.Matrix.makeRotateFromQuat(this._quatCurrent, this._nodeGizmo.getMatrix()),
            this._gizmoMode = this._model.get("showGizmo")),
            !0
        },
        rotateNode: function() {
            var t = s.Matrix.create();
            return function(e) {
                var i = e.getMatrix();
                s.Matrix.makeRotateFromQuat(this._quatCurrent, i);
                var n = this._gizmoTra.getMatrix()
                  , r = this._rootModel.getMinimumBound()
                  , a = r.center()
                  , o = a[0]
                  , u = a[1]
                  , l = a[2];
                if (s.Matrix.makeTranslate(-o, -u, -l, n),
                s.Matrix.preMult(i, n),
                s.Matrix.makeTranslate(o, u, l, n),
                s.Matrix.postMult(n, i),
                this._nodeGrid) {
                    s.Matrix.inverse(i, t);
                    var c = this._nodeGrid.getMatrix()
                      , h = s.Matrix.create()
                      , d = r.radius();
                    s.Matrix.makeScale(d, d, d, h),
                    s.Matrix.makeTranslate(a[0], a[1], a[2], c),
                    s.Matrix.preMult(c, h),
                    s.Matrix.postMult(t, c)
                }
                this.updateShadows(),
                e.dirtyBound()
            }
        }(),
        updateShadows: function() {
            var t = this._features.lighting;
            if (t)
                for (var e = t.getModel().get("lights"), i = 0, n = e.length; i < n; ++i)
                    e[i].dirty()
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1545)
      , a = i(1597)
      , s = i(1598)
      , o = i(1599)
      , u = i(1600)
      , l = i(1601)
      , c = i(1514)
      , h = i(1516)
      , d = n.osg
      , p = function(t) {
        d.MatrixTransform.call(this),
        this._colorUniform = d.Uniform.createFloat4(d.Vec4.createAndSet(.5, .5, .5, 0), "uColor"),
        t && d.Vec4.copy(t, this._colorUniform.get()),
        this._callbackColor = new r(this._colorUniform,1),
        this._timeGrid = 0,
        this.init()
    };
    p.prototype = d.objectInherit(d.MatrixTransform.prototype, {
        init: function() {
            this._visible = !1,
            this.addChild(d.createGridGeometry(-1, -1, 0, 2, 0, 0, 0, 2, 0, 10, 10)),
            this.addChild(d.createAxisGeometry(1)),
            this._boundingSphereComputed = !0,
            this._boundingBoxComputed = !0;
            var t = this.getOrCreateStateSet();
            t.setAttributeAndModes(new d.Depth(d.Depth.LEQUAL)),
            t.setAttributeAndModes(new d.BlendFunc(d.BlendFunc.ONE,d.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            t.setRenderBinDetails(h.GRID, "RenderBin"),
            t.addUniform(this._colorUniform),
            t.setAttributeAndModes(a.createShader(s, o, "orientation-grid", "Grid")),
            this.getChildren()[1].getOrCreateStateSet().setAttributeAndModes(a.createShader(u, l, "orientation-axis", "OrientationAxis")),
            this.addUpdateCallback(this._callbackColor),
            this.setNodeMask(0)
        },
        showGridTemporary: function(t) {
            this._visible = !0,
            this.setNodeMask(c.NO_PICK_NO_SHADOW),
            this._callbackColor.show(),
            window.clearTimeout(this._timeGrid),
            t && (this._timeGrid = window.setTimeout(this.hideGrid.bind(this), 1e3 * t))
        },
        isVisible: function() {
            return this._visible
        },
        hideGrid: function() {
            this._timeGrid = 0,
            this._visible = !1,
            this._callbackColor.hide()
        }
    }),
    t.exports = p
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = new n.osgShader.ShaderProcessor
      , s = function() {
        this._shaderCache = {}
    };
    s.prototype = {
        getShaderProcessor: function() {
            return a
        },
        getOrCreateShader: function(t, e, i, n, r) {
            var a = "";
            r && (a = r.toString());
            var s = i + a
              , o = this._shaderCache[s];
            return o || (o = this.createShader(t, e, i, n, r),
            this._shaderCache[s] = o),
            o
        },
        createShader: function(t, e, i, n, s) {
            var o = "#define SHADER_NAME " + n + "\n";
            if (s)
                if (Array.isArray(s))
                    for (var u = 0; u < s.length; u++)
                        o += "#define " + s[u] + "\n";
                else
                    o += "#define " + s + "\n";
            var l = {};
            return l[i + "-vert"] = o + t,
            l[i + "-frag"] = o + e,
            a.addShaders(l),
            new r.Program(new r.Shader(r.Shader.VERTEX_SHADER,a.getShader(i + "-vert")),new r.Shader(r.Shader.FRAGMENT_SHADER,a.getShader(i + "-frag")))
        }
    },
    t.exports = new s
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);\n}\n"
}
, function(t, e) {
    t.exports = "uniform vec4 uColor;\n\nvoid main(void) {\n  gl_FragColor = vec4(uColor.xyz * uColor.a, uColor.a);\n}\n"
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\nattribute vec4 Color;\nvarying vec4 vColor;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n    vColor = Color;\n    gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);\n}\n"
}
, function(t, e) {
    t.exports = "uniform vec4 uColor;\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vec4( vec3(vColor) * uColor.a, uColor.a);\n}\n"
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1603)
      , a = i(1604)
      , s = {
        FeatureName: "cameraAnimation",
        ModelType: r,
        ViewListType: [a]
    }
      , o = n.create(s);
    o.prototype.getNode = function() {
        return this._views[0]._nodeCameraAnimation
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(234)
      , r = i(1198)
      , a = r.osg
      , s = n.Model.extend({
        defaults: {
            eye: a.Vec3.create(),
            target: a.Vec3.create(),
            duration: 1
        },
        getName: function() {
            return "Camera animation"
        },
        setTargetAndEye: function(t, e, i) {
            return this.set("target", t),
            this.set("eye", e),
            this.trigger("setTargetAndEye", i)
        }
    });
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(258)
      , a = i(1605)
      , s = n.osg
      , o = r.extend({
        initialize: function() {
            r.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:duration", this.onDurationChanged, this),
            t.bind("setTargetAndEye", this.onTargetAndEyeChanged, this);
            var e = this.options.context.getViewer().getViewerOSGJS().getManipulator();
            this._callbackCameraAnimation = new a(e,t.get("duration")),
            this._nodeCameraAnimation = new s.Node,
            this._nodeCameraAnimation.setName("Feature - CameraAnimation"),
            this._nodeCameraAnimation.addUpdateCallback(this._callbackCameraAnimation)
        },
        onDurationChanged: function() {
            this._callbackCameraAnimation.setDuration(this.model.get("duration"))
        },
        onTargetAndEyeChanged: function(t) {
            this._callbackCameraAnimation.setTargetAndEye(this.model.get("target"), this.model.get("eye"), t)
        }
    });
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1482)
      , a = i(1546)
      , s = i(1521)
      , o = i(1486)
      , u = n.osg
      , l = n.osgAnimation
      , c = function(t, e) {
        this._fpsDist = -1,
        this._manipulator = t,
        this._eyeEnd = u.Vec3.create(),
        this._eyeDeltaLen = 0,
        this._targetEnd = u.Vec3.create(),
        this._targetDeltaLen = 0,
        this._lastRatio = 0,
        this._preventFlip = !1,
        a.call(this, e),
        this._finished = !0
    };
    c.prototype = u.objectInherit(a.prototype, {
        setTargetAndEye: function() {
            var t = u.Vec3.create();
            return function(e, i, n) {
                if (this._preventFlip = n,
                this._finished) {
                    var r = this._manipulator.getManipulatorList()[s.FPS];
                    this._fpsDist = r.getDistance()
                }
                u.Vec3.copy(i, this._eyeEnd),
                this._manipulator.getEyePosition(t),
                this._eyeDeltaLen = u.Vec3.length(u.Vec3.sub(i, t, t)),
                u.Vec3.copy(e, this._targetEnd),
                this._manipulator.getTarget(t),
                this._targetDeltaLen = u.Vec3.length(u.Vec3.sub(e, t, t)),
                this._lastRatio = 0,
                this.reset()
            }
        }(),
        update: function() {
            var t = u.Vec3.create()
              , e = u.Vec3.create()
              , i = u.Vec3.create()
              , n = u.Vec3.create();
            return function(a, c) {
                if (this._finished === !0)
                    return !0;
                o.draw();
                var h = this._manipulator
                  , d = h.getCurrentManipulatorIndex();
                d === s.FPS && h.setManipulatorIndex(s.ORBIT);
                var p = c.getFrameStamp().getSimulationTime()
                  , f = this.interpolate(p, a, c);
                f = l.easeOutQuart(f);
                var g = f - this._lastRatio;
                this._lastRatio = f;
                var m = this._manipulator;
                if (m.getEyePosition(t),
                m.getTarget(e),
                u.Vec3.sub(this._targetEnd, e, i),
                u.Vec3.normalize(i, i),
                u.Vec3.add(e, u.Vec3.mult(i, g * this._targetDeltaLen, n), n),
                m.setTarget(n),
                u.Vec3.sub(this._eyeEnd, t, i),
                u.Vec3.normalize(i, i),
                u.Vec3.add(t, u.Vec3.mult(i, g * this._eyeDeltaLen, n), n),
                m.setEyePosition(n, this._preventFlip),
                d === s.FPS) {
                    var v = h.getDistance();
                    h.setManipulatorIndex(d),
                    h.getCurrentManipulator().setDistance(this._finished ? this._fpsDist : v)
                }
                return this._finished === !0 && r.resolveFirstCameraAnimation(),
                !0
            }
        }()
    }),
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1195)
      , a = i(1607)
      , s = i(1612)
      , o = {
        FeatureName: "environment",
        ModelType: a,
        ViewListType: [s]
    }
      , u = r.create(o);
    u.prototype = n.extend({}, r.prototype, {
        getNode: function() {
            return this._views[0].getNodeEnvironment()
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1482)
      , r = i(234)
      , a = i(1608)
      , s = i(1610)
      , o = i(1467)
      , u = i(1611)
      , l = r.Model.extend({
        _trashbin: [],
        getRandomEnvironment: function() {
            var t = [{
                uid: "591b2c2db5744df1803a09d477f5a2c7",
                brightness: 2.1385
            }, {
                uid: "2fa15e0b1cee45a5b02605a288934e1b",
                brightness: 4.063
            }, {
                uid: "16cdcddf277d423d99094f8db0c731e9",
                brightness: 2.0569
            }, {
                uid: "956bb00775a044e7afdd1c17f6bdab63",
                brightness: 2.246
            }, {
                uid: "d348dfd2a8104ab0b8528f885d645eb3",
                brightness: 2.1402
            }];
            return t[Math.round(Math.random() * (t.length - 1))]
        },
        defaults: function() {
            var t = this.getRandomEnvironment();
            return {
                enable: o(),
                exposure: t.brightness,
                backgroundEnable: !1,
                backgroundExposure: 1,
                rotation: 0,
                uid: t.uid,
                blur: .1
            }
        },
        init: function(t) {
            this._context = t,
            this._viewer = t.getViewer();
            var e = t.getModel().get("options").environment;
            e && (void 0 !== e.enable && this.set("enable", e.enable),
            void 0 !== e.exposure && this.set("exposure", e.exposure),
            void 0 !== e.rotation && this.set("rotation", e.rotation),
            void 0 !== e.uid && this.set("uid", e.uid),
            void 0 !== e.blur && this.set("blur", e.blur),
            void 0 !== e.backgroundExposure && this.set("backgroundExposure", e.backgroundExposure));
            var i = t.getModel().get("user").uid;
            this.environmentCollection = this.createCollection(i),
            this.environmentCollection.fetch({
                remove: !1
            }),
            this.checkEnvironmentValidity(),
            o() && n.getPolygon().then(this.updateEnvironmentConfig.bind(this))
        },
        updateEnvironmentConfig: function() {
            var t = this.getEnvironment();
            if (t) {
                var e = u(this._viewer.getRootUserData().source)[t.get("uid")];
                e ? (this.set("exposure", parseFloat(e.environmentExposure)),
                this.set("backgroundExposure", parseFloat(e.brightness)),
                this.set("rotation", parseFloat(e.rotation))) : this.set("exposure", parseFloat(t.get("brightness")) || 1);
                var i = this._viewer.getRootUserData();
                o() && "Tilt Brush" === i.authoringTool && (this.set("uid", "3e2ad3e1f1ea47679f045a7eb0e6af49"),
                this.set("exposure", .5))
            }
        },
        getEnvironmentCollection: function() {
            return this.environmentCollection
        },
        checkEnvironmentValidity: function() {
            var t = this.getEnvironmentCollection()
              , e = this.get("uid")
              , i = t.find(function(t) {
                return e === t.get("uid")
            });
            if (!i) {
                var n = this._context.getModel().get("uid")
                  , r = parseInt(n.toLowerCase(), 16) || 0
                  , a = t.at(r % t.length);
                a ? this.set("uid", a.get("uid")) : this.set("enable", !1)
            }
        },
        createCollection: function(t) {
            return new a([],{
                filters: new s({
                    userUID: t
                })
            })
        },
        getName: function() {
            return "Environment"
        },
        setEnvironment: function(t) {
            return this.setEnvironmentUID(t.uid)
        },
        setEnvironmentUID: function(t) {
            t && this.set("uid", t)
        },
        getEnvironment: function() {
            var t = this.get("uid");
            return this.environmentCollection.find(function(e) {
                return e.get("uid") === t
            })
        },
        getJSON: function() {
            var t = {};
            return t.uid = this.get("uid"),
            t.enable = this.get("enable"),
            t.exposure = this.get("exposure"),
            t.rotation = this.get("rotation"),
            t.blur = this.get("blur"),
            t.backgroundExposure = this.get("backgroundExposure"),
            t
        }
    });
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1609)
      , r = i(247);
    t.exports = r.extend({
        model: n,
        url: function() {
            return "undefined" == typeof this.options.filters ? "/i/environments" : "/i/users/" + this.options.filters.get("userUID") + "/environments"
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(238)
      , a = i(385);
    t.exports = r.extend(n.extend({}, a, {
        url: function() {
            return "/i/environments/" + this.get("uid")
        }
    }))
}
, 245, function(t, e) {
    "use strict";
    var i = {
        "2e9c3708feb74137b0436f946b8b66b8": {
            rotation: 1.6,
            environmentExposure: 4.27,
            brightness: 1.12
        },
        "5efd61a025f6400886ab975e2ac3d9c5": {
            rotation: 3.15,
            environmentExposure: 1.19,
            brightness: 1.21
        },
        "80fba9759ab94307a782f38d359b8ea8": {
            rotation: 1.57,
            environmentExposure: 14.19,
            brightness: 1
        },
        "268447ca0a954f44b06d1387863d114e": {
            rotation: 6.25,
            environmentExposure: 2.1,
            brightness: 1
        },
        "003c1543cd754a19a0e14bc89726ccf5": {
            rotation: 1.82,
            environmentExposure: 1,
            brightness: 1
        },
        "3e2ad3e1f1ea47679f045a7eb0e6af49": {
            rotation: .3,
            environmentExposure: .59,
            brightness: 1
        },
        "2fa15e0b1cee45a5b02605a288934e1b ": {
            rotation: .68,
            environmentExposure: 4,
            brightness: 1
        },
        "9190e8da70694ef3b9d1d0c01541917e": {
            rotation: 3.24,
            environmentExposure: 2.5,
            brightness: .57
        },
        "749a0594343e4ff9a2875cb411d0ad1a": {
            rotation: 4.73,
            environmentExposure: .5,
            brightness: 1
        },
        f2dabeb04674446696486eea67028bd8: {
            rotation: 4.71,
            environmentExposure: .76,
            brightness: 1.5
        },
        df380da788ee444885722735039b0c09: {
            rotation: .27,
            environmentExposure: 1.4,
            brightness: 1.46
        },
        "16cdcddf277d423d99094f8db0c731e9": {
            rotation: 3.73,
            environmentExposure: 2.4,
            brightness: .53
        },
        c281dff366844cbc8b33179337037f42: {
            rotation: 3.64,
            environmentExposure: 7,
            brightness: .53
        }
    }
      , n = {
        substancepainter: i
    }
      , r = {}
      , a = function(t) {
        return n[t] || r
    };
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(285)
      , a = i(235)
      , s = i(1198)
      , o = i(258)
      , u = i(1482)
      , l = i(1613)
      , c = i(1197)
      , h = i(1470)
      , d = i(1543)
      , p = i(1465)
      , f = i(1486)
      , g = p().panorama
      , m = s.osg
      , v = o.extend({
        initialize: function() {
            o.prototype.initialize.apply(this, arguments),
            this._viewer = this.options.context.getViewer(),
            this._environment = new l,
            this._environment.setName("Feature - Environment"),
            this._backgroundLoaded = {},
            this.model.bind("change:enable", this.onEnableChanged, this),
            this.model.bind("change:exposure", this.onExposureChanged, this),
            this.model.bind("change:backgroundExposure", this.onExposureChanged, this),
            this.model.bind("change:rotation", this.onRotationChanged, this),
            this.model.bind("change:uid", this.onUIDChanged, this),
            this.model.bind("change:backgroundEnable", this.onBackgroundEnableChanged, this),
            this.model.bind("change:blur", this.onBlurChanged, this),
            d.bind("change:mask", this.onEnvironmentChanged, this),
            this.model.bind("change", f.draw),
            this.resourceDefer = a.defer(),
            this.options.context.getScene().addResourcePromise(this.resourceDefer.promise),
            this.initEnvironment(),
            this.initRotateEnvironment()
        },
        initEnvironment: function() {
            this.onRotationChanged(),
            this.onExposureChanged(),
            this.onEnableChanged()
        },
        initRotateEnvironment: function() {
            if (this._viewer.getViewerOSGJS()) {
                this._mouseKeyboard = this._viewer.getViewerOSGJS().getEventProxy().StandardMouseKeyboard,
                this._rotEnv = !1,
                this.mx_ = 0;
                var t = this.options.context.getViewer().getCanvas();
                t.addEventListener("mousedown", this.onMouseDown.bind(this)),
                t.addEventListener("mouseup", this.onMouseUp.bind(this)),
                t.addEventListener("mouseout", this.onMouseUp.bind(this)),
                t.addEventListener("mousemove", this.onMouseMove.bind(this)),
                u.getModelDisplayed().then(this.initOnTriplePan.bind(this))
            }
        },
        initOnTriplePan: function() {
            var t = this._viewer.getViewerOSGJS().getEventProxy();
            if (t.Hammer && t.Hammer._hammer) {
                var e = t.Hammer._hammer
                  , i = e.handlers.panstart
                  , n = e.handlers.panmove
                  , r = e.handlers.panend
                  , a = e.handlers.pinchend;
                if (1 === i.length && 1 === n.length && 1 === r.length && 1 === a.length) {
                    var s = i[0]
                      , o = n[0]
                      , u = r[0]
                      , l = a[0];
                    e.off("panstart", s),
                    e.off("panmove", o),
                    e.off("panmove", u),
                    this._evProxy = {
                        altKey: !0,
                        shiftKey: !1,
                        ctrlKey: !1
                    },
                    e.on("panstart", this.onPanStart.bind(this, s)),
                    e.on("panmove", this.onPanMove.bind(this, o, l)),
                    e.on("panend", this.onPanEnd.bind(this, u))
                }
            }
        },
        onPanStart: function(t, e) {
            return e.pointers.length < 3 ? t(e) : (this._evProxy.pageX = e.center.x,
            void this.onMouseDown(this._evProxy))
        },
        onPanMove: function(t, e, i) {
            return i.pointers.length < 3 ? t(i) : (this._evProxy.pageX = i.center.x,
            this._rotEnv || (this.onMouseDown(this._evProxy),
            e(i)),
            void this.onMouseMove(this._evProxy))
        },
        onPanEnd: function(t, e) {
            this.onMouseUp(),
            t(e)
        },
        onMouseDown: function(t) {
            t.altKey && (this._rotEnv = !0,
            this._mouseKeyboard.setEnable(!1),
            this.mx_ = t.pageX)
        },
        onMouseMove: function() {
            var t = m.Matrix.create()
              , e = m.Matrix.create();
            return function(i) {
                if (this._rotEnv) {
                    var n = !i.ctrlKey
                      , r = !i.shiftKey;
                    f.draw();
                    var a = (i.pageX - this.mx_) / 100;
                    if (this.mx_ = i.pageX,
                    n) {
                        var s = (this.model.get("rotation") + a) % (2 * Math.PI);
                        this.model.set("rotation", s < 0 ? s + 2 * Math.PI : s)
                    }
                    if (r) {
                        var o = this.options.context
                          , u = o.getFeatures().lighting;
                        if (!u)
                            return;
                        var l = o.getScene().getRoot().getMinimumBound().center();
                        m.Matrix.makeRotate(-a % (2 * Math.PI), 0, 0, 1, t),
                        m.Matrix.preMult(t, m.Matrix.makeTranslate(-l[0], -l[1], -l[2], e)),
                        m.Matrix.postMult(m.Matrix.makeTranslate(l[0], l[1], l[2], e), t);
                        for (var c = u.getModel().get("lights"), h = 0, d = c.length; h < d; ++h) {
                            var p = c[h];
                            p.isAttachedToCamera() || (m.Matrix.postMult(t, p.get("matrix")),
                            p.dirty())
                        }
                    }
                }
            }
        }(),
        onMouseUp: function() {
            this._rotEnv = !1
        },
        onUIDChanged: function() {
            this.model.updateEnvironmentConfig(),
            this.onEnvironmentChanged()
        },
        getNodeEnvironment: function() {
            return this._environment
        },
        getResourceManager: function() {
            return this._resourceManager || c.instance
        },
        onEnableChanged: function() {
            this.model.get("enable") ? this._environment.enable() : this._environment.disable(),
            this.onEnvironmentChanged()
        },
        onExposureChanged: function() {
            this._environment.setExposure(this.model.get("exposure")),
            this._environment.setBackgroundExposure(this.model.get("backgroundExposure"))
        },
        onRotationChanged: function() {
            this._environment.updateRotation(this.model.get("rotation"))
        },
        onBlurChanged: function() {
            this.abortLastDownloadEnv(),
            this.model.get("backgroundEnable") && this.onBackgroundEnableChanged()
        },
        onBackgroundEnableChanged: function() {
            if (this.model.get("backgroundEnable"))
                return this.setBackground()
        },
        resolvePreload: function() {
            this.resourceDefer && (this.resourceDefer.resolve(),
            this.resourceDefer = void 0)
        },
        onEnvironmentChanged: function() {
            var t = this.getEnvironment();
            return t && this.model.get("enable") ? (this._onlyLowRes = !0,
            void this.setEnvironment(t).then(function() {
                var e = t.get("uid") === this.model.get("uid");
                p().preload && e || this.resolvePreload(),
                e && (this._onlyLowRes = !1,
                this.setEnvironment(t)["finally"](this.resolvePreload.bind(this)))
            }
            .bind(this))) : void this.resolvePreload()
        },
        getEnvironment: function() {
            return this.model.getEnvironment()
        },
        getName: function() {
            return "Environment3D"
        },
        abortLastDownloadEnv: function() {
            for (var t = this.model.get("uid"), e = this.model.get("blur"), i = this.getResourceManager()._resourceLoader._processing, n = 0, r = i.length; n < r; ++n) {
                var a = i[n]
                  , s = a.getXHR();
                s && (void 0 !== a._envUID && a._envUID !== t && s.abort(),
                void 0 !== a._envBlur && a._envBlur !== e && s.abort())
            }
        },
        setEnvironment: function(t) {
            this.abortLastDownloadEnv();
            var e = [];
            if (d.get("mask") & d.LIT) {
                var i = d.get("mask") & d.PBR;
                this._environment.setIsPBR(i),
                this._environment.setDiffuseSPH(t.get("diffuseSPH")),
                i ? this.setEnvironmentPBR(t, e) : this.setEnvironmentOld(t, e)
            }
            return this.model.get("backgroundEnable") && e.push(this.onBackgroundEnableChanged()),
            0 === e.length && e.push(a.resolve()),
            this.wrapPromises(e)
        },
        setEnvironmentPBR: function(t, e) {
            var i = this._environment
              , a = t.get("textures")
              , s = !1;
            m.WebGLCaps.instance().getWebGLExtension("EXT_shader_texture_lod") && (s = !0),
            g && (s = !1);
            var o = n.find(a, {
                encoding: "luv",
                type: "specular_ue4",
                format: s ? "cubemap" : "panorama"
            })
              , u = this.getImageRes(o)
              , l = {
                cubemap: s,
                panoramaLUV: !s,
                cubemapLUV: s,
                size: u.width,
                minFilter: s ? m.Texture.LINEAR_MIPMAP_LINEAR : m.Texture.LINEAR,
                magFilter: m.Texture.LINEAR,
                wrapS: m.Texture.CLAMP_TO_EDGE,
                wrapT: m.Texture.CLAMP_TO_EDGE,
                transferToGPU: !0
            }
              , c = this.getResourceManager().getOrCreateTexture(u.file, l);
            this.markLastXHR(this.model.get("uid")),
            c.texture.setFlipY(!s);
            var h = this.getPromiseTexture(c);
            if (h.then(i.setSpecularPBRTexture.bind(i, c.texture, o.limitSize)),
            e.push(h),
            !r.any) {
                var d = n.find(a, {
                    type: "brdf_ue4"
                });
                l = {
                    integrateBRDFLUV: !0,
                    minFilter: m.Texture.NEAREST,
                    magFilter: m.Texture.NEAREST,
                    wrapS: m.Texture.CLAMP_TO_EDGE,
                    wrapT: m.Texture.CLAMP_TO_EDGE,
                    transferToGPU: !0
                };
                var p = this.getResourceManager().getOrCreateTexture(this.getImageRes(d).file, l);
                this.markLastXHR(this.model.get("uid")),
                p.texture.setFlipY(!1);
                var f = this.getPromiseTexture(p);
                f.then(i.setIntegrateBRDFTexture.bind(i, p.texture)),
                e.push(f)
            }
        },
        getBackgroundResource: function(t, e, i) {
            var r, a = n.find(t, {
                encoding: "luv",
                type: "background",
                format: "cubemap"
            });
            return r = void 0 !== i ? this.getClosestBlur(a, i) : this.getImageRes(a, 512),
            e.cubemap = !0,
            e.cubemapLUV = !0,
            e.size = r.width,
            e.minFilter = m.Texture.LINEAR,
            e.magFilter = m.Texture.LINEAR,
            e.wrapS = m.Texture.CLAMP_TO_EDGE,
            e.wrapT = m.Texture.CLAMP_TO_EDGE,
            e.transferToGPU = !0,
            r
        },
        setEnvironmentOld: function(t, e) {
            var i = this._environment
              , n = {}
              , r = this.getBackgroundResource(t.get("textures"), n)
              , a = this.getResourceManager().getOrCreateTexture(r.file, n);
            this.markLastXHR(this.model.get("uid"));
            var s = this.getPromiseTexture(a);
            s.then(i.setSpecularTexture.bind(i, a.texture)),
            e.push(s)
        },
        setBackground: function() {
            var t = this.getEnvironment();
            if (!t)
                return a.reject();
            var e = {}
              , i = this.getBackgroundResource(t.get("textures"), e, this.model.get("blur"))
              , n = this._backgroundLoaded;
            if (this.getRequestLowRes()) {
                if (n[i.file])
                    return n[i.file];
                i = this.getBackgroundResource(t.get("textures"), e, 1)
            }
            var r = this._environment
              , s = this.getResourceManager().getOrCreateTexture(i.file, e);
            this.markLastXHR(this.model.get("uid"), this.model.get("blur"));
            var o = this.getPromiseTexture(s);
            return o.then(function() {
                r.setBackgroundTexture(s.texture, i.width),
                n[i.file] = s
            }),
            u.getHighResLoaded().then(this._viewer.setFakeSecondaryProgress.bind(this._viewer, o, 0)),
            o
        },
        markLastXHR: function(t, e) {
            var i = this.getResourceManager()._resourceLoader._processing;
            if (i.length > 0) {
                var n = i[i.length - 1];
                n._envUID = t,
                void 0 === e || this.getRequestLowRes() || (n._envBlur = e)
            }
        },
        wrapPromises: function(t) {
            var e = a.settle(t);
            return u.getHighResLoaded().then(this._viewer.setFakeSecondaryProgress.bind(this._viewer, e, 0)),
            e
        },
        getPromiseTexture: function(t) {
            return this._onlyLowRes || p().preload ? t.promise : a.all([t.promise, u.getFirstCameraAnimation()])
        },
        getRequestLowRes: function() {
            return this._onlyLowRes && !p().preload
        },
        getImageRes: function(t, e) {
            var i = new h(t);
            if (this.getRequestLowRes())
                return i.findImageSmallest();
            var n = void 0 !== e ? e : 1 / 0;
            return i.findImageNearestPowerOfTwoUpToResolution(n, n)
        },
        getClosestBlur: function(t, e) {
            for (var i = t.images, n = 0, r = 1 / 0, a = 0, s = i.length; a < s; ++a) {
                var o = Math.abs(i[a].blur - e);
                o < r && (n = a,
                r = o)
            }
            return i[n]
        }
    });
    t.exports = v
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1614)
      , a = i(1618)
      , s = i(1619)
      , o = i(1514)
      , u = n.osg
      , l = function() {
        u.Node.call(this),
        this._isPBR = !1,
        this._textureSpecular = void 0,
        this._textureSpecularUnit = 6,
        this._textureSpecularPBR = void 0,
        this._textureIntegrateBRDF = void 0,
        this._textureSpecularPBRUnit = 6,
        this._textureIntegrateBRDFUnit = 8,
        this._environmentBackground = new r,
        this._uniforms = s(),
        this._adjustRotation = u.Matrix.makeRotate(Math.PI / 2, 1, 0, 0, u.Matrix.create()),
        this._root = new u.MatrixTransform,
        u.Matrix.preMult(this._root.getMatrix(), this._adjustRotation),
        this.getOrCreateStateSet()
    };
    l.prototype = u.objectInherit(u.Node.prototype, {
        getBackground: function() {
            return this._environmentBackground
        },
        getUniforms: function() {
            return this._uniforms
        },
        createCameraNode: function() {
            var t = {}
              , e = this
              , i = function() {
                this.cull = function(i, n) {
                    u.Matrix.getPerspective(e._mainCamera.getProjectionMatrix(), t),
                    u.Matrix.makePerspective(t.fovy, t.aspectRatio, 1, 1e3, n.getCurrentProjectionMatrix()),
                    u.Matrix.copy(e._mainCamera.getViewMatrix(), n.getCurrentModelViewMatrix()),
                    u.Matrix.setTrans(n.getCurrentModelViewMatrix(), 0, 0, 0);
                    var r = n.getCurrentModelViewMatrix();
                    return u.Matrix.mult(r, e._root.getMatrix(), e._uniforms.environmentTransform.getInternalArray()),
                    !0
                }
            }
              , n = new u.Camera;
            return n.setName("Environment - Camera"),
            n.setCullCallback(new i),
            n.setReferenceFrame(u.Transform.ABSOLUTE_RF),
            n
        },
        init: function(t) {
            this._mainCamera = t,
            this._uniforms.getKeys().forEach(function(t) {
                var e = this._uniforms[t];
                this.getStateSet().addUniform(e)
            }
            .bind(this));
            var e = this.createCameraNode();
            e.setNodeMask(o.NO_PICK_NO_SHADOW),
            this.addChild(e),
            e.addChild(this._root),
            this._root.addChild(this._environmentBackground),
            this.updateTextureUnits()
        },
        enable: function() {
            this.setTexturesStateSet()
        },
        removeTexturesStateSet: function() {
            var t = this.getStateSet();
            t && (this._isPBR ? (this._textureSpecularPBR && t.removeTextureAttribute(this._textureSpecularPBRUnit, this._textureSpecularPBR.getTypeMember()),
            this._textureIntegrateBRDF && t.removeTextureAttribute(this._textureIntegrateBRDFUnit, this._textureIntegrateBRDF.getTypeMember())) : this._textureSpecular && t.removeTextureAttribute(this._textureSpecularUnit, this._textureSpecular.getTypeMember()))
        },
        setTexturesStateSet: function() {
            var t = this.getStateSet();
            t && (this._isPBR ? (this._textureSpecularPBR && t.setTextureAttributeAndModes(this._textureSpecularPBRUnit, this._textureSpecularPBR),
            this._textureIntegrateBRDF && t.setTextureAttributeAndModes(this._textureIntegrateBRDFUnit, this._textureIntegrateBRDF)) : this._textureSpecular && t.setTextureAttributeAndModes(this._textureSpecularUnit, this._textureSpecular))
        },
        hide: function() {
            this.removeTexturesStateSet()
        },
        disable: function() {
            this.hide()
        },
        setExposure: function(t) {
            this._uniforms.exposure.setFloat(t)
        },
        setBackgroundExposure: function(t) {
            this._environmentBackground.setExposure(t)
        },
        updateRotation: function(t) {
            u.Matrix.makeRotate(-t, 0, 0, 1, this._root.getMatrix()),
            u.Matrix.preMult(this._root.getMatrix(), this._adjustRotation)
        },
        setBackgroundTexture: function(t, e) {
            this._environmentBackground.setEnvironment(t, e)
        },
        showBackground: function() {
            this._environmentBackground.showEnvironment()
        },
        hideBackground: function() {
            this._environmentBackground.hide()
        },
        setDiffuseSPH: function(t) {
            this.getUniforms().diffuseSPH.setInternalArray(this.initSPH(t))
        },
        setSpecularTexture: function(t) {
            this._textureSpecular = new a(t,"Specular"),
            this.updateTextureUnits(),
            this.getUniforms().textureSpecular.setInt(this._textureSpecularUnit)
        },
        setSpecularPBRTexture: function(t, e) {
            this._textureSpecularPBR = new a(t,"SpecularPBR");
            var i = "TextureCubeMap" === t.className();
            this._textureSpecularPBR.setIsCubemap(i),
            this._textureSpecularPBR.updateLodRange(e),
            this.updateTextureUnits(),
            this.getUniforms().textureSpecularPBR.setInt(this._textureSpecularPBRUnit)
        },
        setIntegrateBRDFTexture: function(t) {
            this._textureIntegrateBRDF = new a(t,"IntegrateBRDF"),
            this.updateTextureUnits(),
            this.getUniforms().textureIntegrateBRDF.setInt(this._textureIntegrateBRDFUnit)
        },
        updateTextureUnits: function() {
            this.setTexturesStateSet()
        },
        setIsPBR: function(t) {
            this._isPBR = t
        },
        initSPH: function(t) {
            for (var e = 1 / (2 * Math.sqrt(Math.PI)), i = -(.5 * Math.sqrt(3 / Math.PI)), n = -i, r = i, a = .5 * Math.sqrt(15 / Math.PI), s = -a, o = .25 * Math.sqrt(5 / Math.PI), u = s, l = .25 * Math.sqrt(15 / Math.PI), c = [e, e, e, i, i, i, n, n, n, r, r, r, a, a, a, s, s, s, o, o, o, u, u, u, l, l, l], h = t.slice(0, 27), d = 0; d < 27; ++d)
                h[d] *= c[d];
            return h
        }
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1597)
      , a = i(1615)
      , s = i(1616)
      , o = i(1617)
      , u = i(1516)
      , l = i(1486)
      , c = n.osg
      , h = 5
      , d = function() {
        c.Node.call(this),
        this._geometry = c.createTexturedBoxGeometry(0, 0, 0, h, h, h),
        this._uniforms = o(),
        this._show = "NONE",
        this._bgEnv = null,
        this._bgFixed = null,
        this._texRatio = 1,
        this._canvasWidth = 1,
        this._canvasHidth = 1,
        this.init(),
        this.hide()
    };
    d.prototype = c.objectInherit(c.Node.prototype, {
        init: function() {
            var t = this._geometry
              , e = t.getOrCreateStateSet();
            e.setAttributeAndModes(new c.Depth(c.Depth.LEQUAL,1,1,(!1)), c.StateAttribute.PROTECTED),
            e.setRenderBinDetails(u.BACKGROUND, "RenderBin"),
            e.setAttributeAndModes(r.createShader(a, s, "environment-background", "Environment"));
            for (var i = this._uniforms, n = Object.keys(i), o = 0, l = n.length; o < l; ++o)
                e.addUniform(i[n[o]]);
            this.addChild(t)
        },
        getUniforms: function() {
            return this._uniforms
        },
        rescale: function(t, e) {
            t && (this._canvasWidth = t),
            e && (this._canvasHeight = e);
            var i = this._canvasWidth / this._canvasHeight
              , n = this._uniforms.scale.getInternalArray();
            i >= this._texRatio ? (n[0] = 1,
            n[1] = this._texRatio / i) : (n[0] = i / this._texRatio,
            n[1] = 1)
        },
        getBackground: function() {
            return this._bgFixed
        },
        getEnvironment: function() {
            return this._bgEnv
        },
        hide: function() {
            this._show = "NONE",
            this._update()
        },
        showColor: function() {
            this._show = "COLOR",
            this._update()
        },
        showEnvironment: function() {
            this._show = "ENV",
            this._update()
        },
        setEnvironment: function(t, e) {
            this._bgEnv = t,
            void 0 !== e && this._uniforms.size.setFloat(e),
            this._update()
        },
        setExposure: function(t) {
            this._uniforms.backgroundExposure.setFloat(t)
        },
        showBackground: function() {
            this._show = "FIXED",
            this._update()
        },
        setBackground: function(t) {
            this._texRatio = t.getWidth() / t.getHeight(),
            this._bgFixed = t,
            this._update()
        },
        _update: function() {
            return l.draw(),
            "ENV" !== this._show ? void this._geometry.setNodeMask(0) : (this._geometry.setNodeMask(-1),
            void (this._bgEnv && this._geometry.getOrCreateStateSet().setTextureAttributeAndModes(0, this._bgEnv)))
        }
    }),
    t.exports = d
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\n\nuniform vec4 uHalton;\nuniform vec2 RenderSize;\n\nvarying vec3 vLocalVertex;\n\nvoid main(void)\n{\n    vLocalVertex = Vertex.rgb;\n\n    mat4 projectionMatrix = uProjectionMatrix;\n    vec2 halt = (abs(uHalton.z) == 2.0 ? 1.0 : 0.0) * (uHalton.xy / RenderSize);\n    projectionMatrix[2][0] += halt.x;\n    projectionMatrix[2][1] += halt.y;\n\n    gl_Position = (projectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0))).xyww;\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec3 vLocalVertex;\n\n// common stuffs\nuniform int uOutputLinear;\nuniform float uRGBMRange;\n\nuniform samplerCube uTexture0;\nuniform float uEnvironmentExposure;\nuniform float uBackgroundExposure;\nuniform float uSize;\n\n#pragma include "functions.glsl"\n#pragma include "sketchfabTextures.glsl"\n\nvoid main(void) {\n\n  vec3 color = textureCubeFixed( uTexture0, normalize( vLocalVertex.xyz ), uSize ) * uEnvironmentExposure * uBackgroundExposure;\n\n  if( uOutputLinear == 0 )\n    color = linearTosRGB(color);\n\n  gl_FragColor = encodeRGBM(color, uRGBMRange);\n}\n'
}
, function(t, e, i) {
    "use strict";
    var n, r = i(1198), a = r.osg, s = function() {
        if (n)
            return n;
        var t = {
            texture0: a.Uniform.createInt1(0, "uTexture0"),
            backgroundExposure: a.Uniform.createFloat(1, "uBackgroundExposure"),
            size: a.Uniform.createFloat(1, "uSize"),
            color: a.Uniform.createFloat3(a.Vec3.createAndSet(0, 0, 1), "uBackgroundColor"),
            scale: a.Uniform.createFloat2(a.Vec2.createAndSet(1, 1), "uFixedScale")
        };
        return n = new a.Map(t)
    };
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1619)
      , a = n.osg
      , s = function(t, e) {
        this._texture = t,
        this._channel = e || "Specular",
        this._isCubemap = !1,
        this._commonUniforms = r()
    };
    s.uniforms = {},
    s.prototype = a.objectLibraryClass(a.objectInherit(a.Texture.prototype, {
        attributeType: "Texture",
        channelType: ["Specular", "SpecularPBR", "IntegrateBRDF"],
        getUniformName: function(t) {
            return "uTextureEnvironment" + this.getChannel() + t
        },
        getOrCreateUniforms: function() {
            var t = s.uniforms
              , e = this.getChannel();
            if (!t[e]) {
                var i = this._texture
                  , n = {
                    size: a.Uniform.createFloat2([i.getWidth(), i.getHeight()], this.getUniformName("TextureSize"))
                };
                t[e] = new a.Map(n)
            }
            return t[e]
        },
        setIsCubemap: function(t) {
            this._isCubemap = t
        },
        getIsCubemap: function() {
            return this._isCubemap
        },
        getCommonUniforms: function() {
            return this._commonUniforms
        },
        getTexture: function() {
            return this._texture
        },
        getChannel: function() {
            return this._channel
        },
        cloneType: function() {
            return new s(new a.Texture)
        },
        getHash: function() {
            return "osgSketchfabTextureEnvironment" + this.getChannel()
        },
        updateLodRange: function(t) {
            var e = this.getOrCreateUniforms()
              , i = Math.log(this._texture.getWidth()) / Math.LN2
              , n = i - Math.log(t) / Math.LN2;
            if (e.lodRange) {
                var r = e.lodRange.getInternalArray();
                r[0] = i,
                r[1] = n
            } else
                e.lodRange = a.Uniform.createFloat2([i, n], this.getUniformName("LodRange"))
        },
        apply: function(t, e) {
            var i = this._texture;
            void 0 !== i && i.apply(t);
            var n = this.getOrCreateUniforms(e)
              , r = n.size.getInternalArray();
            r[0] = i.getWidth(),
            r[1] = i.getHeight()
        }
    }), "osgSketchfab", "TextureEnvironment"),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n, r = i(1198), a = r.osg, s = function() {
        if (n)
            return n;
        var t = {
            environmentTransform: a.Uniform.createMatrix4(a.Matrix.create(), "uEnvironmentTransform"),
            exposure: a.Uniform.createFloat1(1, "uEnvironmentExposure"),
            diffuseSPH: a.Uniform.createFloat3Array(new Float32Array(27), "uDiffuseSPH"),
            textureSpecular: a.Uniform.createInt1(7, "sEnvironmentSpecular"),
            textureSpecularPBR: a.Uniform.createInt1(6, "sSpecularPBR"),
            textureIntegrateBRDF: a.Uniform.createInt1(7, "sIntegrateBRDF")
        };
        return n = new a.Map(t)
    };
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1621)
      , a = i(1622)
      , s = {
        FeatureName: "outline",
        ModelType: r,
        ViewListType: [a]
    }
      , o = n.create(s);
    o.prototype.getNode = function() {
        return this._views[0]._nodeOutline
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(234)
      , a = n.osg
      , s = r.Model.extend({
        defaults: {
            color: a.Vec3.createAndSet(1, 0, 1)
        },
        getName: function() {
            return "Outline"
        }
    });
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(258)
      , r = i(1623)
      , a = i(1625)
      , s = n.extend({
        initialize: function() {
            n.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:color", this.onColorChanged, this);
            var e = this.options.context.getViewer().getViewerOSGJS();
            e.getState().getShaderGeneratorProxy().addShaderGenerator("outline", new a),
            this._nodeOutline = new r(e,t.get("color")),
            this._nodeOutline.setName("Feature - Outline")
        },
        onColorChanged: function() {
            this._nodeOutline.setColor(this.model.get("color"))
        }
    });
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1514)
      , a = i(1516)
      , s = i(1624)
      , o = i(1486)
      , u = n.osg
      , l = n.osgUtil
      , c = function(t, e) {
        u.Node.call(this),
        this._viewer = t,
        this._color = void 0 !== e ? e : u.Vec3.createAndSet(1, 0, 1),
        this._timeoutDuration = 1e4,
        this._nodeProxy = new u.Node,
        this._outlineScene = new u.Node,
        this._timer = void 0,
        this._sobel = void 0,
        this._paths = void 0,
        this._width = t.getCanvasWidth(),
        this._height = t.getCanvasHeight(),
        this.init()
    };
    c.prototype = u.objectInherit(u.Node.prototype, {
        setColor: function(t) {
            this._color = t
        },
        clearOutlineScene: function() {
            for (var t = this._outlineScene, e = t.getChildren(), i = 0, n = e.length; i < n; ++i)
                e[i].removeChildren();
            t.removeChildren()
        },
        setScene: function() {
            var t = function(t) {
                this._path = t
            };
            return t.prototype = {
                update: function(t) {
                    return t.setMatrix(u.computeLocalToWorld(this._path)),
                    !0
                }
            },
            function(e) {
                this.clearOutlineScene();
                for (var i = this._outlineScene, n = 0, r = e.length; n < r; ++n) {
                    var a = e[n]
                      , o = new u.MatrixTransform;
                    i.addChild(o),
                    o.addChild(a[a.length - 1]),
                    s(a) ? o.addUpdateCallback(new t(a)) : o.setMatrix(u.computeLocalToWorld(a))
                }
            }
        }(),
        hideOutline: function() {
            this._nodeProxy.setNodeMask(0),
            void 0 !== this._timer && (clearTimeout(this._timer),
            this._timer = void 0)
        },
        showOutline: function() {
            this._nodeProxy.setNodeMask(r.NO_PICK_NO_SHADOW),
            void 0 !== this._timer && clearTimeout(this._timer);
            var t = this;
            this._timer = setTimeout(function() {
                t._timer = void 0,
                t._nodeProxy.setNodeMask(0),
                o.draw()
            }, this._timeoutDuration)
        },
        getOrCreateTextureRTT: function() {
            var t = this._viewer
              , e = t.getCanvasWidth()
              , i = t.getCanvasHeight();
            if (this.textureRTT)
                return this.textureRTT.setTextureSize(e, i),
                this.textureRTT;
            var n = this.textureRTT = new u.Texture;
            return n.setTextureSize(e, i),
            n.setInternalFormat(u.Texture.RGBA),
            n.setMinFilter(u.Texture.NEAREST),
            n.setMagFilter(u.Texture.NEAREST),
            n
        },
        createCamera: function(t) {
            var e = this.createSubGraphRTT(t);
            return e.getOrCreateStateSet().setShaderGeneratorName("outline", u.StateAttribute.OVERRIDE | u.StateAttribute.ON),
            e.setName("Outline Camera"),
            e
        },
        createSubGraphRTT: function(t) {
            var e = this.getOrCreateTextureRTT()
              , i = new u.Camera;
            return i.setViewport(new u.Viewport(0,0,e.getWidth(),e.getHeight())),
            i.setClearColor(u.Vec4.create()),
            i.setRenderOrder(u.Camera.PRE_RENDER, 0),
            i.attachTexture(u.FrameBufferObject.COLOR_ATTACHMENT0, e),
            i.attachRenderBuffer(u.FrameBufferObject.DEPTH_ATTACHMENT, u.FrameBufferObject.DEPTH_COMPONENT16),
            i.addChild(t),
            i
        },
        createComposer: function(t) {
            var e = new l.Composer;
            return e.addPass(new l.Composer.Filter.InputTexture(this.getOrCreateTextureRTT())),
            e.addPass(t),
            e.renderToScreen(this._viewer.getCanvasWidth(), this._viewer.getCanvasHeight()),
            e.build(),
            e
        },
        createRttAndComposer: function(t) {
            var e = this.createCamera(this._outlineScene);
            this._nodeProxy.addChild(e),
            this._nodeProxy.addChild(this.createComposer(t))
        },
        init: function() {
            this.addChild(this._nodeProxy),
            this._nodeProxy.setNodeMask(0);
            var t = new u.CullFace(u.CullFace.DISABLE);
            this._outlineScene.getOrCreateStateSet().setAttributeAndModes(t, u.StateAttribute.OVERRIDE | u.StateAttribute.ON);
            var e = this._sobel = new l.Composer.Filter.SobelFilter;
            e.setColor(this._color),
            e.setFactor(.25),
            e.getOrCreateStateSet().setAttributeAndModes(new u.BlendFunc(u.BlendFunc.ONE,u.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            e.getOrCreateStateSet().setRenderBinDetails(a.OUTLINE, "RenderBin"),
            this.createRttAndComposer(e),
            this._nodeProxy.addUpdateCallback(this)
        },
        update: function(t) {
            var e = this._viewer;
            if (e.getCanvasWidth() === this._width && e.getCanvasHeight() === this._height)
                return !0;
            this._width = e.getCanvasWidth(),
            this._height = e.getCanvasHeight();
            var i = t.getChildren()
              , n = i[0]
              , r = this.getOrCreateTextureRTT();
            return n.setViewport(new u.Viewport(0,0,r.getWidth(),r.getHeight())),
            n.attachTexture(u.FrameBufferObject.COLOR_ATTACHMENT0, r),
            t.removeChild(i[1]),
            t.addChild(this.createComposer(this._sobel)),
            !0
        }
    }),
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = n.osgAnimation
      , s = function(t) {
        for (var e = 0, i = t.length; e < i; ++e) {
            var n, s = t[e];
            if (s instanceof a.Bone)
                n = a.UpdateBone;
            else {
                if (!(s instanceof r.MatrixTransform))
                    continue;
                n = a.UpdateMatrixTransform
            }
            for (var o = s.getUpdateCallbackList(), u = 0, l = o.length; u < l; ++u)
                if (o[u]instanceof n)
                    return !0
        }
        return !1
    };
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1498)
      , r = i(1626)
      , a = function() {
        n.apply(this, arguments),
        this.setShaderCompiler(r)
    };
    a.prototype = n.prototype,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1510)
      , a = n.osg
      , s = function() {
        r.apply(this, arguments)
    };
    s.prototype = a.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "Outline"
        },
        registerTextureMaterial: function(t, e) {
            var i = t.getName();
            "Displacement" === i && r.prototype.registerTextureMaterial.call(this, t, e)
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {},
        createFragmentShaderGraph: function() {
            var t = this.createVariable("vec4").setValue("vec4(1.0, 0.0, 1.0, 1.0)")
              , e = this.getNode("glFragColor");
            return this.getNode("SetFromNode").inputs(t).outputs(e),
            [e]
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1628)
      , a = i(1632)
      , s = {
        FeatureName: "background",
        ModelType: r,
        ViewListType: [a]
    };
    t.exports = n.create(s)
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1482)
      , a = i(238)
      , s = i(1629)
      , o = i(1631)
      , u = i(1465)
      , l = i(1467)
      , c = n.osg
      , h = "51af6a870cce449eb75b0345feebaebb"
      , d = c.Vec3.createAndSet(.2, .2, .2)
      , p = a.extend({
        _trashbin: [],
        defaults: function() {
            return {
                enable: l() ? "environment" : "fixed",
                enableVR: !1,
                uid: h,
                color: c.Vec3.createAndSet(.2, .2, .2),
                webVR: !1
            }
        },
        init: function(t) {
            var e = t.getModel().get("user").uid;
            this.backgroundCollection = this.createCollection(e),
            this.backgroundCollection.fetch({
                remove: !1
            });
            var i = t.getModel().get("options").background;
            i && (i.enable && this.set("enable", i.enable),
            void 0 !== i.enableVR && this.set("enableVR", i.enableVR),
            i.uid && this.set("uid", i.uid),
            i.color && this.set("color", i.color)),
            u().transparent && this.set("enable", "none");
            var n = t.getViewer();
            l() && r.getPolygon().then(function() {
                "Tilt Brush" === n.getRootUserData().authoringTool && (this.set("enable", "color"),
                this.set("color", c.Vec3.create()))
            }
            .bind(this))
        },
        createCollection: function(t) {
            return new s([],{
                filters: new o({
                    userUID: t
                })
            })
        },
        getName: function() {
            return "Background"
        },
        setBackground: function(t) {
            return this.setBackgroundUID(t.uid)
        },
        setBackgroundUID: function(t) {
            t && this.set("uid", t)
        },
        getBackground: function() {
            if (this.backgroundCollection) {
                var t = this.get("uid")
                  , e = this.backgroundCollection.find(function(e) {
                    return e.get("uid") === t || e.get("id") === t
                });
                return e ? e : void this.set("uid", h)
            }
        },
        getEnableType: function() {
            var t = this.get("enable");
            return !this.get("webVR") || this.get("enableVR") && "environment" === t ? t : "color"
        },
        getColor: function() {
            return !this.get("webVR") || this.get("enableVR") && "color" === this.get("enable") ? this.get("color") : d
        },
        getJSON: function() {
            var t = {}
              , e = this.getBackground();
            return t.enable = this.get("enable"),
            t.enableVR = this.get("enableVR"),
            t.uid = e ? e.get("uid") : h,
            t.color = this.get("color"),
            t
        }
    });
    t.exports = p
}
, function(t, e, i) {
    "use strict";
    var n = i(1630)
      , r = i(247)
      , a = i(239);
    t.exports = r.extend({
        model: n,
        url: function() {
            var t = this.options.filters.get("userUID") ? "/i/users/" + this.options.filters.get("userUID") + "/backgrounds" : "/i/backgrounds";
            return t + a.craft("?", {
                offset: this.options.offset
            })
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(238)
      , a = i(1471);
    t.exports = r.extend({
        save: function(t, e) {
            null != t && "object" != typeof t || (e = t);
            var i = new FormData;
            return i.append("imageFile", this.get("imageFile")),
            i.append("modelUid", e.modelUID),
            n.ajax({
                url: this.url(),
                data: i,
                processData: !1,
                contentType: !1,
                type: "POST"
            })
        },
        url: function() {
            return this.isNew() ? "/i/backgrounds" : "/i/backgrounds/" + this.get("uid")
        }
    }).extend(a)
}
, 245, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(235)
      , a = i(1198)
      , s = i(1482)
      , o = i(258)
      , u = i(1197)
      , l = i(1485)
      , c = i(1486)
      , h = a.osg
      , d = o.extend({
        initialize: function() {
            o.prototype.initialize.apply(this, arguments),
            this.model.bind("change:enable", this.onEnableChanged, this),
            this.model.bind("change:enableVR", this.onEnableChanged, this),
            this.model.bind("change:webVR", this.onEnableChanged, this),
            this.model.bind("change:uid", this.onBackgroundChanged, this),
            this.model.bind("change", c.draw),
            this._viewer = this.options.context.getViewer();
            var t = this.options.context.getFeatures().environment;
            t && (this.resourceDefer = r.defer(),
            this.options.context.getScene().addResourcePromise(this.resourceDefer.promise),
            this._modelEnvironment = t.getModel(),
            this._nodeBackground = t.getNode().getBackground(),
            this._nodeBackground.addUpdateCallback(this),
            this.onEnableChanged())
        },
        getResourceManager: function() {
            return this._resourceManager || u.instance
        },
        onBackgroundChanged: function() {
            var t = this.model.getBackground();
            if (t) {
                var e = this.options.context.getViewer()
                  , i = Math.max(l(e.getWidth()), l(e.getHeight()))
                  , n = t.findImageNearestToResolution(i, i)
                  , r = n.url;
                return this.getResources(r)
            }
        },
        getResources: function(t) {
            var e = {
                minFilter: h.Texture.LINEAR,
                magFilter: h.Texture.LINEAR,
                transferToGPU: !0,
                convertNPOT: !1
            }
              , i = this.getResourceManager()._resourceLoader._processing;
            i.length && n.forEach(i, function(t) {
                t._options && t._options.cancelableBackground && t._options.uid !== this.model.get("uid") && t.abortImage()
            }
            .bind(this));
            var r = this.getResourceManager().getOrCreateTexture(t, n.extend({}, e, {
                cancelableBackground: !0,
                uid: this.model.get("uid")
            }));
            r.promise.then(function(t) {
                this._nodeBackground.setBackground(t),
                this._nodeBackground.rescale(this._viewWidth, this._viewHeight),
                this.model.trigger("backgroundUpdated", t),
                "fixed" === this.model.getEnableType() && this._nodeBackground.showBackground()
            }
            .bind(this));
            var a = this.options.context.getViewer();
            return this.resourceDefer ? (r.promise["finally"](this.resourceDefer.resolve.bind(this.resourceDefer)),
            this.resourceDefer = void 0) : s.getHighResLoaded().then(a.setFakeSecondaryProgress.bind(a, r.promise, 0)),
            r.promise
        },
        onEnableChanged: function() {
            var t = this.model.getEnableType();
            this._modelEnvironment.set("backgroundEnable", "environment" === t),
            "color" === t ? this._nodeBackground.showColor() : "fixed" === t ? this._nodeBackground.getBackground() ? this._nodeBackground.showBackground() : void 0 !== this.model.get("uid") && this.onBackgroundChanged() : "environment" === t ? this._nodeBackground.showEnvironment() : "none" === t && this._nodeBackground.hide(),
            this.resourceDefer && this.resourceDefer.resolve()
        },
        requireBiggerTexture: function() {
            var t = this.options.context.getViewer()
              , e = Math.max(l(t.getWidth()), l(t.getHeight()))
              , i = this.model.getBackground();
            if (i) {
                var n = i.findImageNearestUpToResolution(e, e);
                if (void 0 !== this._nodeBackground && !this._nodeBackground.getBackground())
                    return !1;
                if (n.width < this._nodeBackground.getBackground().getWidth())
                    return !1
            }
            return !0
        },
        update: function() {
            if ("fixed" !== this.model.getEnableType())
                return !0;
            var t = this._viewer.getCamera().getViewport()
              , e = t.width()
              , i = t.height();
            return this._viewWidth === e && this._viewHeight === i || (this._viewWidth = e,
            this._viewHeight = i,
            this.requireBiggerTexture() === !0 && this.onBackgroundChanged(),
            this._nodeBackground.rescale(e, i)),
            !0
        }
    });
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1634)
      , a = i(1636)
      , s = {
        FeatureName: "hotspot",
        ModelType: r,
        ViewListType: [a]
    }
      , o = n.create(s);
    o.prototype.getNode = function() {
        return this._views[0]._nodeHotspot
    }
    ,
    o.prototype.getNodeProxy = function() {
        return this._views[0]._proxyHotspot
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(234)
      , r = i(1198)
      , a = i(216)
      , s = i(1635)
      , o = i(449)
      , u = i(450)
      , l = i(1197)
      , c = i(1465)
      , h = i(1624)
      , d = r.osg
      , p = r.osgAnimation
      , f = function(t) {
        var e = d.Vec3.create()
          , i = d.Vec3.create();
        t.getFeatures().manipulator.getModel().getCameraPosition(e, i),
        this.set("eye", e),
        this.set("target", i);
        var n = t.getScreenShot(128, 1)
          , r = n.toDataURL("image/jpeg");
        this.set("uidImage", void 0),
        this.set("imageFile", s(r)),
        this.set("preview", r)
    }
      , g = n.Model.extend({
        defaults: {
            webVR: !1,
            visible: c().annotationsVisible,
            hotspots: new o([]),
            currentHotspotIndex: -1
        },
        getName: function() {
            return "Hotspot"
        },
        getResourceManager: function() {
            return this._resourceManager || l.instance
        },
        init: function(t) {
            var e = this.get("hotspots");
            e.on("remove", this.onRemove, this);
            var i = this._viewer = t.getViewer();
            this.hotspotsToBeDeleted = [];
            var n = t.getModel().get("options")
              , r = n.hotspot
              , o = r && r.hotspots && a.keyBy(r.hotspots, "uid")
              , u = this.getResourceManager().getOrCreateHotspotCollection().resource;
            u.each(function(t) {
                t.collection = null;
                var n = t.get("images")[0];
                n && (t.set("uidImage", n.uid),
                t.set("imageFile", s(n.url)),
                t.set("preview", n.url),
                t.set("refreshAction", f.bind(t, i)));
                var r = o && o[t.get("uid")];
                r && (t.set("geometryUid", r.geometryUid),
                t.set("indices", r.indices),
                t.set("barycentricWeights", r.barycentricWeights),
                t.set("localPosition", r.localPosition)),
                e.add(t)
            })
        },
        onRemove: function(t) {
            t.isNew() || this.hotspotsToBeDeleted.push(t)
        },
        setUpdateCallback: function(t) {
            this.callback = t
        },
        updateHotspotHit: function(t, e) {
            this._viewer.getFeaturesManager().getScenePositionFromHit(e, t.get("position"));
            var i = e.nodepath[e.nodepath.length - 1]
              , n = void 0 !== i._uniqueID ? i._uniqueID : -1
              , r = i instanceof p.RigGeometry || i instanceof p.MorphGeometry
              , a = r || h(e.nodepath);
            t.set("geometryUid", a ? n : -1);
            var s = e.TriangleIntersection
              , o = t.get("indices");
            o[0] = r ? s.i1 : -1,
            o[1] = r ? s.i2 : -1,
            o[2] = r ? s.i3 : -1;
            var u = t.get("barycentricWeights");
            u[0] = r ? s.r1 : 0,
            u[1] = r ? s.r2 : 0,
            u[2] = r ? s.r3 : 0;
            var l = t.get("localPosition");
            l[0] = a ? e.point[0] : 0,
            l[1] = a ? e.point[1] : 0,
            l[2] = a ? e.point[2] : 0
        },
        createHotspot: function(t) {
            var e = this.get("hotspots")
              , i = new u;
            return i.set("uid", "tmp_" + a.uniqueId()),
            this.updateHotspotHit(i, t),
            e.add(i, {
                sort: !1
            }),
            i.set("order", e.indexOf(i)),
            i.set("refreshAction", f.bind(i, this._viewer)),
            i.get("refreshAction")(),
            e.trigger("select", i),
            i
        },
        getJSON: function() {
            var t = [];
            return this.get("hotspots").each(function(e) {
                t.push({
                    uid: e.get("uid"),
                    geometryUid: e.get("geometryUid"),
                    indices: e.get("indices"),
                    barycentricWeights: e.get("barycentricWeights"),
                    localPosition: e.get("localPosition")
                })
            }),
            {
                hotspots: t
            }
        }
    });
    t.exports = g
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        var e, i = window.WebKitBlobBuilder || window.MozBlobBuilder || window.BlobBuilder;
        e = t.split(",")[0].indexOf("base64") >= 0 ? window.atob(t.split(",")[1]) : window.decodeURI(t.split(",")[1]);
        for (var n = t.split(",")[0].split(":")[1].split(";")[0], r = new ArrayBuffer(e.length), a = new Uint8Array(r), s = 0; s < e.length; s++)
            a[s] = e.charCodeAt(s);
        var o;
        if (void 0 !== window.Blob)
            o = new Blob([a],{
                type: n
            });
        else if (void 0 !== i) {
            var u = new i;
            u.append(r),
            o = u.getBlob(n)
        }
        return o
    };
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(1198)
      , a = i(258)
      , s = i(1482)
      , o = i(1197)
      , u = i(1597)
      , l = i(1637)
      , c = i(1514)
      , h = i(1486)
      , d = i(1516)
      , p = i(1191)
      , f = i(255)
      , g = i(215)
      , m = i(233)
      , v = i(1515)
      , _ = i(1639)
      , b = i(1481)
      , x = i(1640)
      , A = i(1641)
      , y = i(1642)
      , S = i(1643)
      , C = i(1644)
      , M = i(1645)
      , w = r.osg
      , T = a.extend({
        initialize: function() {
            a.prototype.initialize.apply(this, arguments),
            this._hotspots = this.model.get("hotspots"),
            this._hotspots.on("sort", h.draw),
            this._hotspots.on("remove", this.onHotspotRemoved, this),
            this._hotspots.on("add", this.onHotspotAdded, this),
            this._hotspots.on("select", this.onHotspotSelected, this),
            this.model.on("change:visible", this.onVisible, this),
            this._lastSuccessHit = void 0;
            var t = this.options.context;
            this._viewer = t.getViewer(),
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._manipulator = this._viewerOSGJS.getManipulator(),
            this._mouseKeyboard = this._viewerOSGJS.getEventProxy().StandardMouseKeyboard,
            this._idDragging = -1,
            this._dragHotspotStarted = !1,
            this._lastHoveredIndex = -1,
            this._dragCamera = !1,
            this._lastCoordNotDragging = w.Vec2.create(),
            this._nodeHotspot = new w.Node,
            this._nodeHotspot.setName("Feature - Hotspot"),
            this._proxyHotspot = new w.Node,
            this._proxyHotspot.setName("Hotspot - Proxy"),
            this._proxyHotspot.setNodeMask(0),
            this._nodeHotspot.addChild(this._proxyHotspot),
            this.initHotspotProxy(),
            this.initEventHandlers(),
            this._hotspots.each(this.onHotspotAdded.bind(this)),
            v.setHotspot(this._hotspots.length > 0),
            s.getModelDisplayed().then(this.hotspotReady.bind(this))
        },
        getScreenThresholdHover: function() {
            return 20 * this._viewerOSGJS.getCanvasPixelRatio()
        },
        onVisible: function() {
            this._proxyHotspot.setNodeMask(this.model.get("visible") ? c.NO_SHADOW : 0),
            h.draw()
        },
        initEventHandlers: function() {
            var t = this._viewer.getCanvas();
            p() && t.addEventListener("dblclick", this.onDoubleClick.bind(this)),
            t.addEventListener("mousemove", this.onPointerMove.bind(this)),
            t.addEventListener("touchmove", this.onPointerMove.bind(this)),
            t.addEventListener("mousedown", this.onPointerDown.bind(this)),
            t.addEventListener("touchstart", this.onPointerDown.bind(this)),
            t.addEventListener("touchend", this.onPointerUp.bind(this)),
            t.addEventListener("touchcancel", this.onPointerOut.bind(this)),
            t.addEventListener("mouseup", this.onPointerUp.bind(this)),
            t.addEventListener("mouseout", this.onPointerOut.bind(this))
        },
        hotspotReady: function() {
            this.onVisible();
            var t = this._viewer.getFeatures().postProcess.getCamera()._textureDepth;
            t && this._proxyHotspot.getOrCreateStateSet().setTextureAttributeAndModes(0, t),
            h.draw()
        },
        initHotspotProxy: function() {
            this._proxyHotspot.setCullCallback(this);
            var t = this._proxyHotspot.getOrCreateStateSet();
            t.setRenderBinDetails(d.HOTSPOT, "RenderBin"),
            t.setAttributeAndModes(new w.Depth(w.Depth.DISABLE)),
            t.setAttributeAndModes(new w.BlendFunc(w.BlendFunc.ONE,w.BlendFunc.ONE_MINUS_SRC_ALPHA));
            var e = o.instance.getOrCreateTexture(l.HOTSPOT);
            t.addUniform(w.Uniform.createInt(0, "uTextureDepth")),
            t.addUniform(w.Uniform.createInt(1, "uTextureHotspot")),
            t.setTextureAttributeAndModes(1, e.texture),
            t.setAttributeAndModes(u.createShader(x, A, "hotspot", "Hotspot")),
            t.setAttributeAndModes(new w.CullFace(w.CullFace.DISABLE)),
            _.initCardShader(u.createShader(y, S, "tooltip", "VRTooltip")),
            _.initLineShader(u.createShader(C, M, "hotspotline", "VRHotspotLine"))
        },
        onDoubleClick: function(t) {
            var e = this._viewer.getOptions().widgetAPI.getTabbedWidget();
            if ("annotations" === e.get()) {
                var i = g.maxHotspotsPerModel[m.me().get("account")];
                if (this._hotspots.length >= i) {
                    var n = "You have reached the maximum number of annotations allowed by your plan (" + i + ").";
                    return m.me().canUpgradeToPro() && (n += '<br><a class="button btn-medium btn-primary upgrade-link" href="/plans" data-title="maximum-annotation-upgrade" target="_blank">Upgrade to add more annotations</a>'),
                    void this.model.trigger("hotspot-error", n)
                }
                var r = this.pickNearestSurface(t);
                r && (this.model.createHotspot(r),
                f.annotationEditorCreateButtonClicked(this.options.context.getModel().get("uid")))
            }
        },
        getColorHotspot: function(t) {
            return this._proxyHotspot.getChildren()[t].getColor()
        },
        setHotspotHovered: function(t, e) {
            e >= 0 && w.Vec3.copy(t ? _.COLOR_HOVERED : _.COLOR_NORMAL, this.getColorHotspot(e))
        },
        getCanvasCoord: function(t, e) {
            return t.touches ? (e[0] = t.touches[0].clientX - n(t.target).offset().left + (window.scrollX || 0),
            e[1] = t.touches[0].clientY - n(t.target).offset().top + (window.scrollY || 0)) : (e[0] = void 0 === t.offsetX ? t.layerX : t.offsetX,
            e[1] = void 0 === t.offsetY ? t.layerY : t.offsetY),
            e
        },
        updateCameraDragged: function() {
            var t = w.Vec2.create();
            return function(e) {
                this._dragCamera = this._dragCamera || w.Vec2.distance(this._lastCoordNotDragging, this.getCanvasCoord(e, t)) > 5
            }
        }(),
        onPointerDown: function(t) {
            this._idDragging = this.pickHotspot(t),
            this._dragHotspotStarted = !1,
            this._dragCamera = !1,
            this.getCanvasCoord(t, this._lastCoordNotDragging),
            p() && this._idDragging >= 0 && this._mouseKeyboard.setEnable(!1)
        },
        onPointerOut: function() {
            this._dragCamera = !0,
            this.onPointerUp()
        },
        onPointerUp: function() {
            this._dragCamera ? this._idDragging >= 0 && (this._lastSuccessHit && this.model.updateHotspotHit(this._hotspots.at(this._idDragging), this._lastSuccessHit),
            w.Vec3.copy(_.COLOR_NORMAL, this.getColorHotspot(this._idDragging)),
            h.draw(),
            f.annotationEditorPositionMoved(this.options.context.getModel().get("uid"))) : this._hotspots.trigger("select", this._hotspots.at(this._idDragging)),
            this._dragHotspotStarted = !1,
            this._dragCamera = !1,
            this._idDragging = -1
        },
        onPointerMove: function(t) {
            if (this.updateCameraDragged(t),
            p() && this._idDragging >= 0)
                return void this.dragHotspot(t);
            var e = this.pickHotspot(t);
            this.getCanvasCoord(t, this._lastCoordNotDragging),
            this.setHotspotHovered(0, this._lastHoveredIndex),
            this.setHotspotHovered(1, e),
            this._lastHoveredIndex !== e && (this._lastHoveredIndex = e,
            h.draw())
        },
        dragHotspot: function(t) {
            this._dragHotspotStarted = !0;
            var e = this.pickNearestSurface(t)
              , i = this._hotspots.at(this._idDragging);
            if (w.Vec3.copy(e ? _.COLOR_DRAG_OK : _.COLOR_DRAG_FAIL, this.getColorHotspot(this._idDragging)),
            e)
                this._lastSuccessHit = e,
                this.model.updateHotspotHit(i, e);
            else {
                var n = this._viewer.getFeaturesManager()
                  , r = void 0 === t.offsetX ? t.layerX : t.offsetX
                  , a = void 0 === t.offsetY ? t.layerY : t.offsetY
                  , s = n.canvasCoordToGL(r, a, w.Vec3.create());
                s[2] = n.getScreenPositionFromScenePoint(i.get("position"), w.Vec3.create())[2],
                n.getScenePositionFromScreenPoint(s, i.get("position")),
                i.set("geometryUid", -1)
            }
            h.draw()
        },
        onHotspotSelected: function() {
            var t = w.Vec3.create()
              , e = w.Vec3.create();
            return function(i) {
                if (i) {
                    var n = this._viewer.getFeaturesManager();
                    n && (w.Vec3.copy(i.get("eye"), t),
                    w.Vec3.copy(i.get("target"), e),
                    n.applyAutospinToCamera(t, e),
                    n.focusOnTargetAndEye(e, t, 1.5),
                    h.draw())
                }
            }
        }(),
        onHotspotAdded: function(t) {
            var e = new _(this._hotspots.indexOf(t));
            e.setCardVisibilityListener(this._onCardVisibilityChange.bind(this)),
            this._proxyHotspot.addChild(e),
            h.draw()
        },
        _onCardVisibilityChange: function(t, e) {
            e ? this._viewer.trigger("annotationFocus", t.getIndex()) : this._viewer.trigger("annotationBlur", t.getIndex())
        },
        onHotspotRemoved: function() {
            this.setHotspotHovered(0, this._lastHoveredIndex),
            this._lastHoveredIndex = -1;
            var t = this._proxyHotspot.getChildren();
            this._proxyHotspot.removeChild(t[t.length - 1]),
            h.draw()
        },
        pickNearestSurface: function(t) {
            var e = void 0 === t.offsetX ? t.layerX : t.offsetX
              , i = void 0 === t.offsetY ? t.layerY : t.offsetY
              , n = this._viewer.getFeaturesManager();
            if (n)
                return n.computeNearestIntersection2D(e, i, c.PICK_GEOMETRY_SLOW, this._viewer.getOrCreateScene().getRoot())
        },
        screenDistanceToHotspot: function() {
            var t = w.Vec3.create();
            return function(e, i) {
                var n = this._viewer.getFeaturesManager();
                return n.getScreenPositionFromScenePoint(this._hotspots.at(e).get("lastComputedScenePosition"), t),
                w.Vec2.distance(i, t)
            }
        }(),
        pickHotspot: function() {
            var t = w.Vec2.create();
            return function(e) {
                var i = this._viewer.getFeaturesManager();
                if (!i || !this.model.get("visible"))
                    return -1;
                this.getCanvasCoord(e, t),
                i.canvasCoordToGL(t[0], t[1], t);
                for (var n = 1 / 0, r = this._hotspots.length, a = -1, s = this.getScreenThresholdHover(), o = 0; o < r; ++o) {
                    var u = this.screenDistanceToHotspot(o, t);
                    u < s && u < n && (n = u,
                    a = o)
                }
                return a
            }
        }(),
        updateScenePositionHotspot: function() {
            var t = w.Vec3.create()
              , e = w.Matrix.create();
            return function(i) {
                var n = i.get("lastComputedScenePosition")
                  , r = i.get("geometryUid");
                if (r < 0)
                    return w.Vec3.copy(i.get("position"), n);
                var a = b.uidGeometryMap[r];
                if (!a)
                    return w.Vec3.copy(i.get("position"), n);
                var s = i.get("indices")
                  , o = s[0]
                  , u = s[1]
                  , l = s[2];
                if (a.getWorldMatrix(this._nodeHotspot, e),
                o < 0)
                    return void w.Matrix.transformVec3(e, i.get("localPosition"), n);
                var c = a.getVertexAttributeList().Vertex.getElements()
                  , h = c.length / 3;
                if (o >= h || u >= h || l >= h)
                    return w.Vec3.copy(i.get("position"), n);
                var d = i.get("barycentricWeights")
                  , p = d[0]
                  , f = d[1]
                  , g = d[2];
                if (w.Vec3.init(n),
                a.computeTransformedVertex)
                    a.computeTransformedVertex(o, t),
                    w.Vec3.mult(t, p, t),
                    w.Vec3.add(t, n, n),
                    a.computeTransformedVertex(u, t),
                    w.Vec3.mult(t, f, t),
                    w.Vec3.add(t, n, n),
                    a.computeTransformedVertex(l, t),
                    w.Vec3.mult(t, g, t),
                    w.Vec3.add(t, n, n);
                else {
                    var m = 3 * o
                      , v = 3 * u
                      , _ = 3 * l;
                    n[0] = p * c[m] + f * c[v] + g * c[_],
                    n[1] = p * c[m + 1] + f * c[v + 1] + g * c[_ + 1],
                    n[2] = p * c[m + 2] + f * c[v + 2] + g * c[_ + 2]
                }
                return w.Matrix.transformVec3(e, n, n),
                n
            }
        }(),
        cull: function() {
            var t = w.Matrix.create()
              , e = w.Quat.create()
              , i = w.Vec3.create()
              , n = w.Vec3.create()
              , r = w.Vec3.create()
              , a = w.Vec3.create()
              , s = w.Matrix.create();
            return function() {
                if (this.model.callback && this.model.callback(),
                this._lastHoveredIndex >= 0 && this._idDragging === -1) {
                    var o = this._viewer.getFeaturesManager();
                    o.canvasCoordToGL(this._lastCoordNotDragging[0], this._lastCoordNotDragging[1], r),
                    this.screenDistanceToHotspot(this._lastHoveredIndex, r) >= this.getScreenThresholdHover() && this.setHotspotHovered(0, this._lastHoveredIndex)
                }
                var u = this._hotspots
                  , l = this._proxyHotspot.getChildren()
                  , c = l.length
                  , h = this._viewer.getFeatures()
                  , d = h.webVR.getModel().get("worldFactor")
                  , p = this.model.get("webVR");
                this._manipulator.getEyePosition(i);
                var f = this._viewer.getCamera()
                  , g = .02 * this._viewerOSGJS.getCanvasClientWidth() * w.Matrix.getScale(f.getProjectionMatrix(), a)[0];
                this._nodeHotspot.getWorldMatrix(void 0, s);
                var m = w.Matrix.create();
                w.Matrix.inverse(s, m),
                w.Matrix.transformVec3(m, i, n),
                w.Matrix.mult(f.getViewMatrix(), s, t),
                w.Matrix.inverse(t, t),
                w.Matrix.makeRotateFromQuat(w.Matrix.getRotate(t, e), t);
                for (var v = 0; v < c; ++v) {
                    var _ = l[v]
                      , b = u.at(v);
                    this.updateScenePositionHotspot(b),
                    p ? _.updatePositionVR(b, g, n, i, d, s) : _.updatePosition(b, t, g, n)
                }
                return !0
            }
        }()
    });
    t.exports = T
}
, function(t, e, i) {
    "use strict";
    t.exports = {
        HOTSPOT: i(1638)
    }
}
, function(t, e) {
    t.exports = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAEACAMAAADyTj5VAAABQVBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////Z2dmMjIxUVFQsLCwUFBQICAj////////////////r6+uGhoYYGBgAAADr6+v////////z8/N7e3sAAAB7e3v///+5ubkTExO2trb////9/f1+fn59fX37+/tjY2NkZGR/f3+2trYSEhLz8/P///96enr///88PDxra2tVVVWioqKxsbGAgIAgICCRkZG/v7+FhYX////29vbY2Nji4uLMzMzt7e0YGBj///+Li4tWVlb///////8oKCgODg4HBwf///8VFRX///////8XFxe4uLhjY2MNDQ3z8/N5eXkYGBj///9TU1MrKysTExMFBQX///////////////9v9ljGAAAAa3RSTlMACyxIXGx3fAo5Zn+ADUd6e0oCOwMTZ3NnbnV8fmgVKHlwb3eAbzN+eHJ9cTVse2sngXV0fHh3dWx7d0tzOJGimbvEqoizzG7/993m1e55LmhvW251en99fHYMeG15eXVyeCludHx+PT4ObYnIUCAAABJrSURBVHgB7MvDmhwAEIDBMf+xbdt+/8dKssr2+N5f170cd5wut8fr8/t9Xo/b5XTc0TZsSIFgKIwQDgUDqocNKRKNcSeeiNjQO4RkSmYhlkrb0DmkTJYvuXyhWCqXS8VCPseXSlXjsCHV6nxoNFttodXs8CFW0zdsSN0e//QHw/aN4ajPP72utmFDGvNhMm0/MJ3xYaxr2JDmPWCxbD+xWgC9uaZhQ6rGgPWm/dRmDcSqeoYNKV0BFtv2C9sFUEkrGDbupfhn135pxz8pLcOGFIkB+/YbeyAWUTFsXEsA/em7fjgCJx3DhhSIA+f2W2cgHlAwbFy7AJ2/tNrHshs3EIVh5+y9vXLCSu9gYAZoQD/IgXP2+7+HSbGrUKhL+R6ls7lpPrUabCaAD3YPYkphzZPrjtL3zxPbnnN5EWElq2JRaZNFTB5NeFLOezVRbDMm14h7nRXU1d23oIqUYvDU1nJ8KJZ8cvnt0xDW7ICFNU8vF35yX5QOAEUVduKWXRSeMyCLA4/pNVIHoIqCmSrWsAEAWe7DzgCMKAnrcJrfzkpTLHn7enr8Q1hz4s4A/HA9Xf78nsh42ETR8VAk4alAD6qYAyCK2Ul54T4ompikhhcVSucJ4AjXGJ59FWveuZ4ehSWxsy6b53qy9OM9UaHXbQdOoohwpFh1MTvqQRUd2jVZFgXoxSyZKPb2LAewaWIDqsUzDH11adsOtMdFZg5AA6qdAVvFkncvv/vp4TJPNfPF5dJ3V+HJzZ83uipS9N7OivAMHwBR9NmDLg5dzOwwRFFuLZu+VidoN8ijosEcgA777UtZxZL3Lr/7Miw56DbuLN7Pl0t/WcWSCl0VczV0keHsJSTRIXg0EdHFEqCIYoN+63yIosM2v/6/iFCTD4D5nTjDsYolv15+91tYk+/fe367XPrrKlYGpxcSG7DLIgIGPYjCgJRqCnIfGXbLrRVVeOoL/q9GrEAWRYfoX+ujIqVQ5gD0MGdtijXXTxH8Hh7k3gD8frn063titlZlsZ1PHTjrNTokg64Kw1NUcUAHoJve+Xys1UTilpMqzpB9/pMiChz+tXvBvooln13yRBuAJ9dr7wsnQxcFAEwWDZpPtSYMPEUUB3iGJDxF7WN5ng6qyEAuO0BRxBwA8HUYq3jZAfjjcumfzxUDMF0kbima8Dk26HKNcuwpHQCiOIBmoQHbi3Xe9LXKeEwUBnjSQyENQF/Fyz4F/HW59O/niTOwicJjqQMmCQOSWQRMETMVEMXJl25A0Wts6Gvlb+pCBRCFvy0/d6mPOQAb9PlUMIXwIjDoLwLX218WHgNMEoWZLomlFU0cfh9rUPQaZ38+l2tk73yTa2wlxaCu1XwRCPOt1hSPvA30dPFt4Hr768IDmCQKzChiHTJNNGj+SFDkGnG2rogO0QehasKza2+Z1wGIt0rHIh7ZCJoDoG+HzN0mUSSbRw6SiIdvuUHLWo0t+a0KJgpg89fbkvBpGS/Q+YDqX4skPAUoQg0fgPnQFCd08ehWsA+AvhV8AhjX9KQJGK3uA3lD1GPoW8EH/ci5A4daYwCtAagi2FxfSTTgKHUAJtao+Xb9kGrMASjAaQdYxZp/bkcJwgD860cJ/whHIrrYlBrrAIjiwCOLEPEkVYQ2/31JGHiyJGYjZ7GGD8CEpEVIx8FhvMhx8FgGQBG7T8BhYg2PwVBFmueuco14BhibKuYmkCzsAGAkWTwDvao15gD4W860CO0DITPrBxA+fm3C4rbFN14jvnANc6KKGV3E/9i7b6eGoSCIwyY2ZHhSrZ4OOnKmJDvnbP//PTkeN3NSqZvf9p8xrt/tnpxcGML4qQzxQ09OToTQn4Rtp31QhHAgRPYzPClEOBDqs/C6xevyGTIixyL7YciOPERA5FfIhDjdYVEcED6ETJS8nRY2jNPCJEJ4Efp5+K59XIxwI7R6gfqThpuyXgDhQmgFI632/4KRdksWjCB8CL1i6LrzG3euPyuGughHwqiJu+31B8PhoN+7lSVjCFdCJIzWl9WsjwPCpxCZ6EWjE4RbQWUyQqY6Ozc/XSyVFqfzc7NVhBNBCCFOVzAQLIYgWAxBsBiCYDEEwWIIgsUQBIshCBZDECyGIFgMQbAYgmAxBMFiCILFEIS9GPLC3HngOIwDQfBnYiaKovT/51wQTLgRtNe83BsdCqPR0HLYUOKb0BOWoaKWnNMWEdMWsahQqk2ETyxipbacUzCJGr/xa5TcUrQ6l21q9Y3QEdjGkDffhJ7wDBWqAZk20QZP7moRKxEoLlH55NyocfHEJArfuDXSdueNF/+HEDqCbWOI+Cb0hG2oqKxMkwis3BaxMoDiEocsAIOQHQcmUVhhmDWKAntEeid0BPvGEPVN6AnbUDHgCnECh0mc3O3wCb15FnerCty5/5bgEKsR+lFjNImjP8nANGtMmEdtQDAJYIQwgfpO6Aj2jSHqm9ATrqGizkPsCRZRVm/RIp4EWCUcoghqE0SbkAwIBiH/MPSE5hHHZ443pHdCR7BvDFHfhJ5wDBUSoOwRA6JPAHOVMIjC2mMuMaHtECsJxmaNG4JHFJjy9YXQEewbQ9Q3oSc8Q8VKBY4togN+jRNah+ISF/QSSt0xbVCLPHx2+wCaS2QgrcOzQ5TvA87hWEmOP2sMWQX1hGeoEO2GT1znBAgesW4BFxSXuHjCWU2iAgOAtNV5A/x9NXlCNAj9p/QX3I75ZN8Y8r4ALEPFSgKKT8gTFYf4HNcuu4b+x1iTUEHDTufD7kOck8kmgFHaBMY7oSMwjSHGAjAMFXqCvkHcPLkNQu47LyguUXsvIQ0geUQFRnxucnOj8wBUu/PKJ9klMiv3HxJ0wxji3wUYhgrdC6dJrNQMZINYgr5aT0jVI1QJ6BEHUPXQ6dW4t/bVAGKdQHIIeU743oeOYN8Y8r4ALEOFFvcIyQWXRwy+KVs1ml2jwtCvXo0IHFbnarHoMO0a9XcPdnrvQ0ewbwx5XwCOoWIVX98ahCTD5RG6ANo/UEOHc8Dw+zhhep3rUKpXQwLEF0JGsGsMMRaAYagIcv9vETWsV165PCL1JwNmj95WtbqO69ns44ZTHm8bhFhGPCLI4dkhVCQ+3mvoCPaNIe8LwDNURID7yekRBc7ULoBgESv9ASyiwuzpAjjMGgG48wSaR8iTX3+rGK11IJs1am+lw4+d6wj2jSHvC8AzVBRYGbvE6dVYuaCYRGWlbZs2bo9Qa6pLZFaqQ0gj5YcaOoJ9Y8j7AvAMFQFWbo84Tp7cxayx0qG4ROfJjBs1EgDZJORFIJ8oQ5QpDlH15awXQkfwPzeGqA2j/g9rCGIQf9bmcewQv7Z358ZhADEQBDNT/mHJbr4DvhK58GBMXR0S6D98Y2LIiokhKyaGrJgYsmJiyIqJISsmhqyYGLJiYsiKiSErJoasmBiyYmLIiokhKyaGrNhsNpsfLoasmBiyYmLIiokhKyaGrJgYsmJiyIqJISsmhqyYGLJiYsiKiSErJoasmBiyYmLICuaxN9HEEAqWUiCG1AIxpBSIIa1ADGkFYkgqEENykcQQD9rFEL2JKoZYmIcCMSQUiCGpQAwphWJIKxBDUoEYUosihnjQqxiiNxHEEAvzUCCGlAIxJBWIIalADIlFEEMsEENqEcQQD3oXQyQ/ghhiYR4KxJBSIIakAjEkFYghqUAMSQViSCySGMJBz2II3kQQQyxYUoEYkgrEkFYEMcQCMSQViCGpQAxpRRJDOOhdDJH8CGIIBUsqEENSgRiSCsSQVCCGpAIxJBWIIa1IYggHvYshkh9BDKFgSQViSCoQQ1KBGJIKxJBUIIakAjGkFUUM4aB3MURvIoghFCypQAxJBWJIKhBDUoEYkgrEkFQghsSiiCEc9C6G6E0EMYSCJRWIIalADEkFYkgqFENKoRhSCsSQWAQxhIPexRC9iSCGULCkQjGkFIohqVAMKYViSCkUQ0KhGBKLIIZw0LMYojcQxBAKllgohpRCMaQUiiGlUAwphWJIKRRDYlHEEA56F0N8L4ohFOahQAwJBWJIKRRDQqEYUgrFkFIohrQiiSEc9C6GSH4kMcTCPBRB86BQDPmEN4oYYlHEEIsihlhUMYTP3sQQvYkshliYhyKIIRRBDKEoYohFEUMsihhiUcQQiyiGeNCzGKI3kcQQC/NQFDHEooghFkUMsShiiEURQyyKGGKRxBAO2sSQZ72JJIZYmIeiiCEWRQyxKGKIRRFDLIoYYlHEEIskhnDQsxiiN5HEEAvzUBQxxKKIIRZFDLEoYohFEUMsihhikcQQDvrLxJCJIXz2/xZDVkwMWTExZMXEkBUTQ1ZMDFkxMWTFxJAVE0NWTAxZMTFkxcSQFRNDVkwMWTExZMXEkM1mMzFkxcSQFRNDVkwMWTExZMXEkBUTQ1ZMDFkxMWTFxJAVE0NWTAxZMTFkxcSQFRNDVjCPvYkihlhUMcSCJRRBDKEoYohFEUMsihhiUcQQiy6GeJ6zGKI3UcQQiySGWLiEooghFkUMsShiiEURQyyKGGKRxBDOcxZD9CaKGGKRxBALl1AUMcSiiCEWRQyxKGKIRRFDLJoY4nm6GKI3UcQQiy6GWLCEIoghFEEMoShiiEURQyySGGLRxRDOcxZD9CaKGGKRxBALl1AUMcSiiCEWRQyxKGKIRRFDLJIYwnnOYojeRBFDLJIYYuESiiKGWBQxxKKIIRZFDLEoYohFEkM4z1kM0ZsoYohFEkMsXEJRxBCLIoZYFDHEooghFkUMsUhiiOe5iyECHlEMsShiCIV5KIoYQlHEEIokhlBEMYQiiCEUSQzhPHcxRMAjiiEWRQyhYAlFEkMoihhCkcQQiiqGUAQxhKKIIZznLoYIeEQxxKKIIRQsoUhiCEURQyiSGELRxBCKJIZQFDGE89zFEAGPKoZQBDGEgiUUSQyhSGIIRRJDKJoYQpHEEIoihnCeuxgi4BHFEIoihlCwhCKJIRRJDKFIYghFEkMokhhCkcQQznMXQ8Q1mhhCkcQQCpZQKIZ8zhtJDKFIYghFEkMokhjCee5iiN5EEUMsihhCYV6KJIZQJDHEooghFkUMoUhiCEUSQzjPXQzRmyhiCEUSQyhYUpHEEIokhlAkMcSiiCEUSQyhSGKI57mLIXoTQQyhSGIIBUsqkhhCkcQQiiiGUBQxhCKJIRRFDOE8dzFEb6KIIRRJDKFgSUUSQyyKGGKhGJIKxZBSBDHEooghnucuhuhNBAXj/YX597+RxZD33yqIIRRBDGH+XzFkxcSQFRNDVkwMWTExZMXEkBUTQ1ZMDFkxMWTFxJAVE0NWTAxZMTFkxcSQFRNDVkwM2Ww2E0NWTAxZMTFkxcSQFRNDVkwMWTExZMXEkBUTQ1ZMDFkxMWTFxJAVE0NWTAxZMTFkBfOyN1HEEIokhlAkMYTCJRRJDKEIYghFEkMoohhCEcQQP3sXQ/QmihhCkcQQiiSGULiUIokhFEUMoUhiCEUTQyiCGOJn72KI3kQRQyiSGEKRxBAKl1QUMcSiiCEUSQyhUAxpRRBD/OxdDJHjKGIIRRJDKJIYQuFSiiSGUBQxhCKJIRRNDKEoYoifvYsheBNJDKFIYohFEUMoXEqRxBCLIoZQJDGEooghFEkM8bN3MQSOI4khFFUMsQhiCAVLKJIYQpHEEIokhlAUMYSiiCF+9i6GyHE0MYRCMSQWQQyhYAlFEUMokhhC0cQQiiKGUBQxxM/exRA5jiaGWBQxxKKIIRTmoShiCEUSQyiiGEIRxBCKIob42bsYIseRxBALxZBUBDGEwrwURQyhSGIIhWJILIIYQhHEED97F0PkOJIYYqEYkooghlCYl6KIIRRJDKFoYghFEkMoghjiZ+9iiBxHEUMsFCNSEcQQCvNSJDGEIokhFEkMsShiiEUQQ/zsXQyR4yhiiEURQyyKGEJhXookhlAkMYQiiSEUSQyhSGIIn72LIXIcRQyxUAxJRdA8KMw/540khlAkMYQiiSEUSQzhs3cxRG+iiCEWRQyhSGIIBUsqkhhiUcQQiyKGUCQxhCKJIXz2LoboTRQxhCKJIRRJDKFwKUUSQyiSGGJRxBCKJIZQFDHEz97FEL2JIoZQJDHEooghFC6lSGIIhWJIK4IYYlHEEIsghvjZuxiiN1HEEIokhlAkMYTCJRVFDKEIYghFEUMsEENSUcUQP3sSQ5iqYLy/ENH4/je6GPLuWyGGhCKIIX7254shKyaGrJgYsmJiyIqJISsmhqyYGLJiYsiKiSErJoasmBiyYmLIiokhKyaGrJgYsmKz2Ww2m81ms9lsNpvN5i9hYcq53zAZMgAAAABJRU5ErkJggg=="
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1514)
      , a = i(1516)
      , s = n.osg
      , o = n.osgUtil
      , u = 1.5
      , l = .2
      , c = .01
      , h = 1
      , d = .5
      , p = 0
      , f = 1
      , g = 2
      , m = 3
      , v = 4
      , _ = 5
      , b = 6
      , x = s.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0)
      , A = s.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0)
      , y = o.GizmoGeometry.createCylinderGeometry(.0025, .0025, 1, 8, 1, !1, !1)
      , S = new s.MatrixTransform;
    S.getMatrix()[14] = .5,
    S.addChild(y),
    y._boundingBoxComputed = !0,
    y._boundingSphereComputed = !0;
    var C = function(t) {
        s.Node.call(this),
        this._idHotspot = t,
        this._hotspotMT = new s.MatrixTransform,
        this._cardMT = new s.MatrixTransform,
        this._lineToCardMT = new s.MatrixTransform,
        this._hotspotMT.addChild(x),
        this._cardMT.addChild(A),
        this.addChild(this._hotspotMT),
        this.addChild(this._lineToCardMT),
        this.addChild(this._cardMT),
        this._cardMT.setNodeMask(0),
        this._lineToCardMT.setNodeMask(0),
        this._worldTeleportPos = void 0,
        this._cardInitialized = !1,
        this._texCard = new s.Texture,
        this._texCard.setTextureSize(1, 1),
        this._canTeleport = !1,
        this._uAlpha = void 0,
        this._uPaginate = void 0,
        this._color = void 0,
        this._statusCard = p,
        this._lineToCardMT.addChild(S),
        this._cardMT._boundingBoxComputed = !0,
        this._cardMT._boundingSphereComputed = !0,
        this._hotspotMT._boundingBoxComputed = !0,
        this._hotspotMT._boundingSphereComputed = !0,
        this.init()
    };
    C.COLOR_NORMAL = s.Vec3.createAndSet(1, 1, 1),
    C.COLOR_HOVERED = s.Vec3.createAndSet(0, .8, 1),
    C.COLOR_DRAG_OK = s.Vec3.createAndSet(0, .4, 1),
    C.COLOR_DRAG_FAIL = s.Vec3.createAndSet(.8, .2, .2),
    C.initCardShader = function(t) {
        var e = A.getOrCreateStateSet();
        e.setAttributeAndModes(t),
        e.addUniform(s.Uniform.createFloat4(s.Vec4.create(), "uHoveredArea")),
        e.setRenderBinDetails(a.TOOLTIP, "RenderBin")
    }
    ,
    C.initLineShader = function(t) {
        var e = y.getOrCreateStateSet();
        e.setAttributeAndModes(t),
        e.addUniform(s.Uniform.createFloat4(s.Vec4.createAndSet(.03, .59, .78, .4), "uLineColor")),
        e.setRenderBinDetails(a.TOOLTIP, "RenderBin")
    }
    ,
    C.prototype = s.objectInherit(s.Node.prototype, {
        init: function() {
            var t = this.getOrCreateStateSet();
            t.addUniform(s.Uniform.createFloat(this._idHotspot, "uHotspotIndex"));
            var e = A.getOrCreateStateSet();
            this._uHoveredArea = e.getUniform("uHoveredArea").getInternalArray();
            var i = s.Uniform.createFloat3(s.Vec3.createAndSet(1, 1, 1), "uColor");
            this._color = i.getInternalArray(),
            t.addUniform(i);
            var n = this._cardMT.getOrCreateStateSet();
            n.setTextureAttributeAndModes(1, this._texCard);
            var r = s.Uniform.createFloat4("uPaginate");
            this._uPaginate = r.getInternalArray(),
            n.addUniform(r);
            var a = s.Uniform.createFloat1(1, "uAlpha");
            this._uAlpha = a.getInternalArray(),
            n.addUniform(a),
            this._texCard.setMinFilter(s.Texture.LINEAR_MIPMAP_LINEAR),
            this._texCard.setMagFilter(s.Texture.LINEAR)
        },
        getIndex: function() {
            return this._idHotspot
        },
        getHotspotMatrix: function() {
            return this._hotspotMT.getMatrix()
        },
        getColor: function() {
            return this._color
        },
        isFullyVisibleCard: function() {
            return 0 !== this._cardMT.getNodeMask() && 1 === this._uAlpha[0]
        },
        isVisibleCard: function() {
            return 0 !== this._cardMT.getNodeMask()
        },
        canTeleport: function() {
            return this._canTeleport && !this.isFullyVisibleCard()
        },
        setWorldTeleportPosition: function() {
            var t = s.Vec3.create()
              , e = s.Vec3.create()
              , i = s.Vec3.create()
              , n = s.Matrix.create();
            return function(r, a, o) {
                if (!this.isFullyVisibleCard()) {
                    var l = this._cardMT.getMatrix();
                    this.getWorldMatrix(void 0, n),
                    this._worldTeleportPos = s.Vec3.copy(a, this._worldTeleportPos || s.Vec3.create()),
                    s.Vec3.copy(a, i),
                    i[2] += u * o,
                    s.Vec3.sub(r, i, e),
                    e[2] = 0,
                    s.Vec3.normalize(e, e),
                    s.Vec3.mult(e, h * o, e),
                    s.Vec3.add(i, e, e),
                    this.lookToWorld(l, e, i, o, n),
                    s.Matrix.preMultScale(l, s.Vec3.set(1, .5625, 1, t)),
                    e[2] += .28125 * o;
                    var c = this._lineToCardMT.getMatrix();
                    this.lookToWorld(c, r, e, 1, n),
                    s.Matrix.preMultScale(c, s.Vec3.set(1, 1, s.Vec3.distance(r, e), t)),
                    this._cardMT.dirtyBound()
                }
            }
        }(),
        setCardVisibilityListener: function(t) {
            this._cardVisibilityListener = t
        },
        setVisibleCard: function(t) {
            this._cardMT.setNodeMask(t ? -1 : 0),
            this._lineToCardMT.setNodeMask(t ? r.NO_PICK : 0),
            this._uAlpha[0] = 1,
            this._cardVisibilityListener && this._cardVisibilityListener(this, t)
        },
        setHovered: function(t) {
            s.Vec3.copy(t ? C.COLOR_HOVERED : C.COLOR_NORMAL, this.getColor()),
            this.isFullyVisibleCard() || (this._cardMT.setNodeMask(t ? r.NO_PICK : 0),
            this._lineToCardMT.setNodeMask(t ? r.NO_PICK : 0),
            this._uAlpha[0] = .1)
        },
        getNbPage: function() {
            return Math.abs(this._uPaginate[3])
        },
        getCurrentPage: function() {
            return this._uPaginate[2]
        },
        setPage: function(t) {
            var e = this.getNbPage()
              , i = Math.min(e - 1, Math.max(0, t))
              , n = this._statusCard === m ? l : c;
            this._uPaginate[0] = i > 0 ? n : 0;
            var r = this._statusCard === v ? l : c;
            this._uPaginate[1] = i < e - 1 ? r : 0,
            this._uPaginate[2] = i,
            this._uPaginate[3] = Math.abs(this._uPaginate[3]) * (this.isAreaHovered() ? -1 : 1)
        },
        isAreaHovered: function() {
            return this._statusCard === g || this._statusCard === _ || this._statusCard === b
        },
        initCard: function(t) {
            var e = t.canvas;
            this._cardInitialized = !0,
            this._texCard.setImage(e),
            this._uPaginate[3] = Math.floor(e.width / 1024),
            this._clickabeAreas = t.metaData,
            this.setPage(0)
        },
        updateCardHit: function(t) {
            var e = t && t.point;
            t && t.nodepath.indexOf(this._cardMT) !== -1 ? e[0] < -.3 ? this._statusCard = m : e[0] > .3 ? this._statusCard = v : this.isInRectangle(e, this._clickabeAreas.closeButton) ? (this._statusCard = g,
            s.Vec4.copy(this._clickabeAreas.closeButton, this._uHoveredArea)) : this.isInRectangle(e, this._clickabeAreas.nextButton) ? (this._statusCard = _,
            s.Vec4.copy(this._clickabeAreas.nextButton, this._uHoveredArea)) : this.isInRectangle(e, this._clickabeAreas.prevButton) ? (this._statusCard = b,
            s.Vec4.copy(this._clickabeAreas.prevButton, this._uHoveredArea)) : this._statusCard = f : this._statusCard = p,
            this.setPage(this.getCurrentPage())
        },
        isInRectangle: function(t, e) {
            return t[0] > e[0] && t[0] < e[1] && t[1] < e[2] && t[1] > e[3]
        },
        onCardHit: function(t) {
            this._statusCard === p || this._statusCard === g ? this.setVisibleCard(!1) : this._statusCard === _ ? t.goToNextHotspot() : this._statusCard === b ? t.goToPrevHotspot() : this._statusCard === m ? this.setPage(this.getCurrentPage() - 1) : this._statusCard === v ? this.setPage(this.getCurrentPage() + 1) : this.setPage(this.getCurrentPage())
        },
        lookToWorld: function() {
            var t = s.Vec3.create()
              , e = s.Vec3.createAndSet(0, 0, -1)
              , i = s.Matrix.makeRotate(Math.PI, 1, 0, 0, s.Matrix.create());
            return function(n, r, a, o, u) {
                s.Matrix.makeLookAt(r, a, e, n),
                s.Matrix.mult(i, n, n),
                s.Matrix.preMult(n, u),
                s.Matrix.inverse(n, n),
                s.Matrix.preMultScale(n, s.Vec3.set(o, o, o, t))
            }
        }(),
        updatePositionVR: function() {
            var t = s.Vec3.create();
            return function(e, i, n, r, a, o) {
                var u = this._hotspotMT.getMatrix()
                  , l = e.get("lastComputedScenePosition")
                  , c = s.Vec3.distance(n, l)
                  , h = c / i;
                s.Matrix.transformVec3(o, l, t),
                h = Math.max(.75 * h, .1 * a),
                this.lookToWorld(u, t, r, h, o);
                var p = this._worldTeleportPos ? s.Vec2.distance(r, this._worldTeleportPos) : 1 / 0
                  , f = p < d * a;
                this._canTeleport = !f,
                !this._cardInitialized && e.get("cardCanvas") && this.initCard(e.get("cardCanvas")),
                this._hotspotMT.dirtyBound()
            }
        }(),
        updatePosition: function() {
            var t = s.Vec3.create();
            return function(e, i, n, r) {
                var a = this._hotspotMT.getMatrix()
                  , o = e.get("lastComputedScenePosition")
                  , u = s.Vec3.distance(r, o) / n;
                s.Matrix.copy(i, a),
                s.Matrix.preMultScale(a, s.Vec3.set(u, u, u, t)),
                s.Matrix.setTrans(a, o[0], o[1], o[2]),
                this.isVisibleCard() && this.setVisibleCard(!1),
                this._hotspotMT.dirtyBound()
            }
        }()
    }),
    t.exports = C
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform float uHotspotIndex;\n\n// icon size 48 pixel width and 2 pixel padding between them\nconst vec2 ICON_SIZE = 48.0 / vec2(512.0, -256.0);\nconst vec2 ICON_AND_PADDING = ICON_SIZE + 2.0 / vec2(512.0, -256.0);\n\nvoid main(void) {\n  vec2 offset = vec2(mod(uHotspotIndex, 10.0), floor(uHotspotIndex / 10.0));\n  vTexCoord0 = vec2(TexCoord0.x, 1.0 - TexCoord0.y) * ICON_SIZE + offset * ICON_AND_PADDING;\n\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = uProjectionMatrix * vViewPos;\n}\n"
}
, function(t, e) {
    t.exports = "varying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureHotspot;\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\nuniform vec3 uColor;\n\nconst float BIAS_VISIBILITY = 0.05;\n\nvoid main(void) {\n  float fragDepth = (-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize), vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\n  float alpha = (fragDepth - BIAS_VISIBILITY < depth) ? 1.0 : 0.1;\n\n  gl_FragColor = vec4(uColor, 1.0) * texture2D(uTextureHotspot, vTexCoord0);\n  gl_FragColor.a *= alpha;\n\n  gl_FragColor.rgb *= gl_FragColor.a;\n}\n"
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = uProjectionMatrix * vViewPos;\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureHotspot;\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\n\nuniform vec4 uPaginate; // [ left hint, right hint, currentPage, nbPage (< 0 hover on close) ]\nuniform vec4 uHoveredArea;\nuniform float uAlpha;\n\n#pragma include "functions.glsl"\n\n// signed distance to a 2D rounded box\nfloat sdRoundBox( const in vec2 p, const in vec2 b, const in float r ) {\n    vec2 q = abs(p) - b;\n    vec2 m = vec2( min(q.x,q.y), max(q.x,q.y) );\n    float d = (m.x > 0.0) ? length(q) : m.y; \n    return d - r;\n}\n\nvoid main(void) {\n  float fragDepth = (-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize), vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\n  float alpha = fragDepth < depth ? 1.0 : 0.1;\n\n  vec2 uv = vec2((uPaginate.z + vTexCoord0.x) / abs(uPaginate.w), vTexCoord0.y);\n  vec4 color = texture2D(uTextureHotspot, uv);\n  color.a *= alpha;\n\n  float lerpValue = step(-uPaginate.x, -vTexCoord0.x);\n  lerpValue += step(1.0 - uPaginate.y, vTexCoord0.x);\n\n  // vTexCoord is [0, 1]\n  float round = 0.005;\n  float left = uHoveredArea.x + 0.5 + round;\n  float right = uHoveredArea.y + 0.5 - round;\n  float top = uHoveredArea.z + 0.5 - round;\n  float bottom = uHoveredArea.w + 0.5 + round;\n  \n  vec2 halfSize = abs(vec2(left - right, top - bottom) * 0.5);  \n  vec2 center = vec2(halfSize.x + left, halfSize.y + bottom);\n\n  lerpValue += step(0.0, -uPaginate.w) * max(0.0, -sign(sdRoundBox( vTexCoord0 - center, halfSize, round)));\n\n  color.rgb = mix(color.rgb, color.rgb + vec3(0.03, 0.59, 0.78), max(min(lerpValue, 1.0), 0.0)); // min/max not necessary\n\n  color.rgb = sRGBToLinear(color.rgb);\n\n  color.a *= uAlpha;\n  color.rgb *= color.a;\n\n  gl_FragColor = linearTosRGB(color);\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"
}
, function(t, e) {
    t.exports = 'uniform vec4 uLineColor;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n    vec4 color = sRGBToLinear(uLineColor);\n    color.rgb *= color.a;\n    gl_FragColor = linearTosRGB(color);\n}\n'
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1647)
      , a = i(1660)
      , s = {
        FeatureName: "lighting",
        ModelType: r,
        ViewListType: [a]
    }
      , o = n.create(s);
    o.prototype.getNode = function() {
        return this._views[0].getNode()
    }
    ,
    o.prototype.getNodeLight = function() {
        return this._views[0].getNodeLight()
    }
    ,
    o.prototype.getNodeShadow = function() {
        return this._views[0].getNodeShadow()
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1482)
      , a = i(238)
      , s = i(1648)
      , o = i(1659)
      , u = i(1467)
      , l = i(1465)
      , c = n.osg
      , h = a.extend({
        defaults: function() {
            return {
                enable: !u(),
                select: -1,
                lights: [new s(0), new s(1), new s(2)],
                webVR: !1,
                forceShadowRedraw: !1
            }
        },
        getName: function() {
            return "Lighting"
        },
        getDefaultFalloff: function() {
            var t = this._root.getMinimumBound().radius();
            return t < 0 ? 0 : 3.90625 / (t * t)
        },
        setConfigAndDefaultFalloff: function(t) {
            for (var e = this.get("lights"), i = this.getDefaultFalloff(), n = 0, r = e.length; n < r; ++n)
                t && e[n].set(t[n]),
                e[n].set("falloff", i);
            this.dirtyScene()
        },
        initPresetThreePointLight: function() {
            this.setConfigAndDefaultFalloff(o.ThreePointLight())
        },
        initPresetFullMoonNight: function() {
            this.setConfigAndDefaultFalloff(o.FullMoonNight())
        },
        initPresetLowKeyLight: function() {
            this.setConfigAndDefaultFalloff(o.LowKeyLight())
        },
        initPresetEvilGenius: function() {
            this.setConfigAndDefaultFalloff(o.EvilGenius())
        },
        initPresetFairyCamp: function() {
            this.setConfigAndDefaultFalloff(o.FairyCamp())
        },
        initPreset2HeadLightV1: function() {
            this.setConfigAndDefaultFalloff(o.TwoHeadLightV1())
        },
        init: function(t) {
            this._viewer = t.getViewer(),
            this._root = t.getScene().getRoot();
            var e = t.getModel().get("options")
              , i = e.lighting;
            if (i && i.lights) {
                this._ignoreSceneLights = !0;
                var n = this.get("lights");
                void 0 !== i.enable && this.set("enable", i.enable);
                for (var a = e.version, s = l(), o = 0; o < 3; ++o) {
                    var u = i.lights[o];
                    (void 0 === u.castShadows || a < 1 && u.attachedToCamera) && (u.castShadows = !1),
                    n[o].set(u),
                    void 0 !== s.shadowTextureSize && n[o].set("shadowSize", s.shadowTextureSize)
                }
                n[0].get("falloff") && n[1].get("falloff") && n[2].get("falloff") || this.dirtyScene()
            }
            r.getModelDisplayed().then(this.initDepthTexture.bind(this))
        },
        initDepthTexture: function() {
            for (var t = this._viewer.getFeatures().postProcess.getCamera(), e = this.get("lights"), i = 0; i < 3; ++i)
                e[i].setDepthTexture(t._textureDepth)
        },
        dirtyScene: function() {
            var t = new c.BoundingSphere;
            this._root.getMinimumBound(t),
            t.radius() > 0 ? this.recomputeLightsPosition(t) : this._viewer && r.getModelDisplayed().then(this.recomputeLightsPosition.bind(this, t))
        },
        recomputeLightsPosition: function(t) {
            var e = this.get("lights")
              , i = .8 * t.radius()
              , n = t.center()
              , r = c.Matrix.create();
            c.Matrix.makeTranslate(n[0], n[1], n[2], r);
            for (var a = this.getDefaultFalloff(), s = 0; s < 3; ++s) {
                var o = e[s]
                  , u = o.get("matrix")
                  , l = o.get("falloff");
                l || o.set("falloff", a),
                c.Matrix.postMult(r, u),
                "DIRECTION" !== o.get("type") && "HEMI" !== o.get("type") || c.Matrix.preMultTranslate(u, c.Vec3.createAndSet(0, 0, i)),
                o.dirty()
            }
        },
        initLights: function(t) {
            var e = 0
              , i = this.get("lights");
            for (e = 0; e < 3; ++e)
                i[e].setScene(this._root);
            var n = t.length;
            for (e = 0; e < n; ++e)
                t[e]._node.setNodeMask(0);
            if (this._ignoreSceneLights)
                return this.trigger("lightsReady");
            if (u()) {
                if (0 === n)
                    return this.initPresetThreePointLight(),
                    this.trigger("lightsReady");
                this.set("enable", !0)
            } else {
                for (e = 0; e < 3; ++e)
                    i[e].set("castShadows", !1);
                if (0 === n)
                    return this.initPreset2HeadLightV1(),
                    this.trigger("lightsReady");
                if (n > 3)
                    return this.initPresetThreePointLight(),
                    this.trigger("lightsReady")
            }
            t.sort(function(t, e) {
                return c.Vec3.length(t.getDiffuse()) - c.Vec3.length(e.getDiffuse())
            });
            var r = c.Vec3.create();
            for (e = 0; e < 3; ++e) {
                var a = t[e]
                  , s = i[e];
                if (a) {
                    var o = a.getLightType();
                    s.set("type", o),
                    s.set("attachedToCamera", !1),
                    "SPOT" === o && (s.set("angle", Math.min(90, a.getSpotCutoff())),
                    s.set("hardness", a.getSpotBlend()));
                    var l = a.getDiffuse()
                      , h = Math.max(l[0], l[1], l[2], 1);
                    s.set("intensity", h),
                    c.Vec3.mult(l, 1 / h, s.get("color"));
                    var d = a.getGround()
                      , p = Math.max(d[0], d[1], d[2], 1);
                    s.set("intensityGround", p),
                    c.Vec3.mult(d, 1 / p, s.get("ground")),
                    s.set("falloff", a.getQuadraticAttenuation());
                    var f = a._node;
                    f.setNodeMask(-1);
                    var g = f.getWorldMatrices()[0];
                    f.setNodeMask(0);
                    var m = s.get("matrix");
                    c.Matrix.getScale(g, r),
                    c.Matrix.makeScale(r[0], r[1], r[2], m),
                    c.Matrix.inverse(m, m),
                    c.Matrix.postMult(g, m)
                } else
                    s.set("falloff", this.getDefaultFalloff()),
                    s.set("type", "NONE")
            }
            return this.trigger("lightsReady")
        },
        getJSON: function() {
            var t = {}
              , e = this.get("lights");
            return t.enable = this.get("enable"),
            t.lights = [e[0].getJSON(), e[1].getJSON(), e[2].getJSON()],
            t
        }
    });
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(238)
      , r = i(1198)
      , a = i(1532)
      , s = i(1649)
      , o = i(1514)
      , u = i(1543)
      , l = i(1465)
      , c = i(1486)
      , h = i(1559)
      , d = i(1657)
      , p = r.osg
      , f = r.osgUtil;
    r.osgShadow.ShadowMap.prototype._preventTextureBindingDuringShadowCasting = function() {
        for (var t = h(), e = p.StateAttribute.OVERRIDE | p.StateAttribute.ON, i = 0; i < t; i++)
            this._casterStateSet.setTextureAttributeAndModes(i, p.Texture.textureNull, e)
    }
    ;
    var g = n.extend({
        defaults: function() {
            return {
                type: "NONE",
                intensity: 1,
                intensityGround: 1,
                enable: !0,
                color: p.Vec3.createAndSet(1, 1, 1),
                ground: p.Vec3.createAndSet(.3, .2, .2),
                matrix: p.Matrix.create(),
                matrixPrev: p.Matrix.create(),
                falloff: 0,
                angle: 45,
                hardness: .5,
                attachedToCamera: !1,
                castShadows: !0,
                shadowBias: .005,
                shadowSize: 1024
            }
        },
        initialize: function() {
            n.prototype.initialize.apply(this, arguments),
            u.bind("change:mask", this.dirty, this),
            this.createNode(arguments[0])
        },
        createNode: function(t) {
            this._node = new p.MatrixTransform,
            this._node.setName("Lighting - Light " + t),
            this._node.getOrCreateStateSet().setAttributeAndModes(new p.Depth(p.Depth.DISABLE)),
            this._light = new a(t),
            this._light.setName("skfb" + this._light.getTypeMember()),
            p.Vec3.init(this._light.getAmbient()),
            this._light.setLinearAttenuation(0),
            this._lightSource = new p.LightSource,
            this._lightSource.setName("Lighting - LightSource " + t),
            this._lightSource.setLight(this._light),
            this._node.addChild(this._lightSource),
            this._mtQuad = new p.MatrixTransform,
            this._mtQuad.setName("Lighting - TransformIcon " + t),
            this._quadGeom = s.createIconGeometry(),
            this._quadGeom.setName("Lighting -  GeomIcon " + t),
            this._mtQuad.addChild(this._quadGeom),
            this._pointGeom = new s.createPointGeometry,
            this._dirGeom = new s.createDirectionalGeometry(5),
            this._spotGeom = new s.createSpotGeometry(5),
            this._hemiGeom = new s.createHemiGeometry(4),
            this._hemiGeom.getOrCreateStateSet().addUniform(p.Uniform.createFloat4(p.Vec4.createAndSet(0, 0, 1, 1), "uGround")),
            this._scale = new p.MatrixTransform,
            this._scale.addChild(this._mtQuad),
            this._scale.addChild(this._dirGeom),
            this._scale.addChild(this._hemiGeom),
            this._scale.setName("Lighting - ScaleIcon " + t),
            this._geoProxy = new p.Node,
            this._geoProxy.setName("Lighting - GeometryProxy " + t),
            this._geoProxy.addChild(this._scale),
            this._geoProxy.addChild(this._spotGeom),
            this._geoProxy.addChild(this._pointGeom);
            var e = this._geoProxy.getOrCreateStateSet();
            e.addUniform(p.Uniform.createFloat4(p.Vec4.createAndSet(1, 1, 1, 1), "uColor")),
            e.addUniform(p.Uniform.createInt(1, "uEnable")),
            e.addUniform(p.Uniform.createInt(0, "uAttachedToCamera")),
            e.addUniform(p.Uniform.createInt(0, "uTextureDepth")),
            this._node.addChild(this._geoProxy),
            this._dirty = !0,
            this._castShadows = !1,
            this._enableShadow = h() > 12;
            var i = new r.osgShadow.ShadowSettings;
            i.setLight(this._light),
            i.setShadowCastShaderGeneratorName("ShadowCastSkfb"),
            i.setCastsShadowDrawTraversalMask(o.SHADOW_CAST | o.SHADOW_BOUNDS),
            i.setCastsShadowBoundsTraversalMask(o.SHADOW_BOUNDS),
            i.userShadowCasterVisitor = !1;
            var n = l();
            if (i.kernelSizePCF = n.shadowPCF,
            this._cameraShadows = n.cameraShadows,
            i.fakePCF = !1,
            this._shadowMap = new r.osgShadow.ShadowMap(i),
            this._shadowMap.setTextureUnitBase(12),
            this._shadowMap.setEnabled(!1),
            l().stats) {
                var u = this._shadowMap.getCamera()
                  , c = d.getTimerGPU();
                u.setInitialDrawCallback(function() {
                    c.start("ShadowMap"),
                    c.start("ShadowMap" + t)
                }),
                u.setFinalDrawCallback(function() {
                    c.end("ShadowMap" + t),
                    c.end("ShadowMap")
                })
            }
            this._scene = null
        },
        setDepthTexture: function(t) {
            t && this._geoProxy.getOrCreateStateSet().setTextureAttributeAndModes(0, t)
        },
        setScene: function(t) {
            this._scene = t
        },
        getShadowMap: function() {
            return this._shadowMap
        },
        isCastingShadows: function() {
            return this._enableShadow && this._castShadows
        },
        getLightSource: function() {
            return this._lightSource
        },
        getNodeScale: function() {
            return this._scale
        },
        getNodeQuad: function() {
            return this._mtQuad
        },
        getNode: function() {
            return this._node
        },
        dirty: function() {
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        },
        updateNode: function() {
            if (this._dirty) {
                this._dirty = !1;
                var t = this._node
                  , e = this._light
                  , i = this.get("type");
                if ("NONE" === i)
                    return t.editMask = 0,
                    t.setNodeMask(0),
                    e.setEnabled(!1),
                    void (this._castShadows = !1);
                var n = "HEMI" === i && u.get("mask") & u.PBR;
                n && (i = "DIRECTION");
                var r = this.get("enable")
                  , a = this.get("falloff");
                e.setLightType(i),
                e.setSpotCutoff("SPOT" === i ? this.get("angle") : 180),
                e.setEnabled(r),
                e.setConstantAttenuation("DIRECTION" !== i ? 1 : a),
                e.setQuadraticAttenuation("DIRECTION" !== i ? a : 0),
                e.setSpotBlend(this.get("hardness")),
                p.Matrix.copy(this.get("matrix"), t.getMatrix()),
                t.dirtyBound(),
                p.Vec3.mult(this.get("color"), this.get("intensity"), e.getDiffuse()),
                p.Vec3.copy(e.getDiffuse(), e.getSpecular()),
                p.Vec3.mult(this.get("ground"), this.get("intensityGround"), e.getGround()),
                this._castShadows = this.get("castShadows") && ("DIRECTION" === i || "SPOT" === i) && !n,
                this.getShadowMap().setTextureSize(this.get("shadowSize")),
                this.getShadowMap().setBias(this.get("shadowBias")),
                this.isAttachedToCamera() ? (t.setReferenceFrame(p.Transform.ABSOLUTE_RF),
                p.Matrix.makeIdentity(this._scale.getMatrix()),
                t.setCullingActive(!1),
                t.editMask = f.NodeGizmo.PICK_ARC,
                this._cameraShadows || (this._castShadows = !1)) : (t.setReferenceFrame(p.Transform.RELATIVE_RF),
                t.setCullingActive(!0),
                t.editMask = "POINT" === i ? f.NodeGizmo.PICK_ARROW | f.NodeGizmo.PICK_PLANE : f.NodeGizmo.PICK_GIZMO),
                t.setNodeMask(o.PICK_GIZMO_LIGHT);
                var s = this._scene.getMinimumBound()
                  , l = s.radius()
                  , c = this.multUI_ ? this.multUI_ : s.radius2() / 1e3
                  , h = Math.pow(a * c, .125);
                h = Math.min(Math.max(h, 0), 1);
                var d = .05 * l * h + .8 * l * (1 - h);
                "SPOT" === i && this._spotGeom.updateCone(e.getSpotCutoff() * Math.PI / 180, d),
                "POINT" === i && this._pointGeom.updateRadius(d),
                this._dirGeom.setNodeMask(r && "DIRECTION" === i ? o.NO_PICK_NO_SHADOW : 0),
                this._spotGeom.setNodeMask(r && "SPOT" === i ? o.NO_PICK_NO_SHADOW : 0),
                this._hemiGeom.setNodeMask(r && "HEMI" === i ? o.NO_PICK_NO_SHADOW : 0),
                this._pointGeom.setNodeMask(r && "POINT" === i ? o.NO_PICK_NO_SHADOW : 0),
                p.Vec3.copy(e.getGround(), this._hemiGeom.getOrCreateStateSet().getUniform("uGround").getInternalArray()),
                p.Vec3.copy(e.getDiffuse(), this._geoProxy.getOrCreateStateSet().getUniform("uColor").getInternalArray());
                var g = this._geoProxy.getOrCreateStateSet();
                g.getUniform("uEnable").setInt(0 | r),
                g.getUniform("uAttachedToCamera").setInt(0 | this.isAttachedToCamera()),
                this._quadGeom.setLightType(i)
            }
        },
        setLightUnit: function(t) {
            this._light.getLightNumber() !== t && (this._light.setLightNumber(t),
            this._light.setName("skfb" + this._light.getTypeMember()),
            this._shadowMap.dirty())
        },
        setIconVisibility: function(t) {
            this._geoProxy.setNodeMask(t ? -1 : 0)
        },
        isAttachedToCamera: function() {
            var t = this.get("type");
            return ("DIRECTION" === t || "HEMI" === t) && this.get("attachedToCamera")
        },
        resetPosition: function() {
            p.Matrix.makeIdentity(this._node.getMatrix()),
            this._scene && p.Matrix.preMultTranslate(this._node.getMatrix(), this._scene.getMinimumBound().center()),
            c.draw()
        },
        getJSON: function() {
            var t = {};
            return t.type = this.get("type"),
            t.enable = this.get("enable"),
            t.color = this.get("color"),
            t.intensity = this.get("intensity"),
            t.ground = this.get("ground"),
            t.intensityGround = this.get("intensityGround"),
            t.matrix = this.get("matrix"),
            t.falloff = this.get("falloff"),
            t.attachedToCamera = this.get("attachedToCamera"),
            t.angle = this.get("angle"),
            t.hardness = this.get("hardness"),
            t.castShadows = this.get("castShadows"),
            t.shadowBias = this.get("shadowBias"),
            t.shadowSize = this.get("shadowSize"),
            t
        }
    });
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1197)
      , a = i(1597)
      , s = i(1650)
      , o = i(1655)
      , u = i(1656)
      , l = n.osg
      , c = {}
      , h = function(t, e) {
        if (c[t])
            return c[t];
        var i = t.toLowerCase();
        return c[t] = a.createShader(o, u, i, e, t),
        c[t]
    }
      , d = function() {
        return h("LINE", "LightingLineGizmo")
    }
      , p = function() {
        return h("HEMI", "LightingHemiGizmo")
    }
      , f = function() {
        return h("ICON", "LightingIcon")
    }
      , g = new l.BlendFunc(l.BlendFunc.ONE,l.BlendFunc.ONE_MINUS_SRC_ALPHA)
      , m = {}
      , v = function(t) {
        if (m[t])
            return m[t];
        var e = s[t];
        e || (e = s.DIRECTION);
        var i = r.instance
          , n = i.getOrCreateTexture(e);
        return m[t] = n.texture,
        n.texture
    }
      , _ = {};
    _.createIconGeometry = function() {
        var t = l.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0)
          , e = t.getOrCreateStateSet();
        return e.setTextureAttributeAndModes(1, v("DIRECTION")),
        e.addUniform(l.Uniform.createInt(1, "uTextureIcon")),
        e.setAttributeAndModes(g),
        e.setAttributeAndModes(f()),
        t.setLightType = function(t) {
            e.setTextureAttributeAndModes(1, v(t))
        }
        ,
        t
    }
    ,
    _.createDirectionalGeometry = function(t) {
        for (var e = void 0 === t ? -1 : -t, i = e / 15, n = 5, r = 6 * n, a = 2 * Math.PI, s = new Float32Array(6 * r), o = 0; o < n; ++o) {
            var u = 6 * o
              , c = a * o / n;
            s[u] = s[u + 3] = Math.cos(c) * i,
            s[u + 1] = s[u + 4] = Math.sin(c) * i,
            s[u + 5] = e
        }
        var h = new l.DrawArrays(l.PrimitiveSet.LINES,0,r)
          , p = new l.Geometry;
        return p.getAttributes().Vertex = new l.BufferArray(l.BufferArray.ARRAY_BUFFER,s,3),
        p.getPrimitives().push(h),
        p.getOrCreateStateSet().setAttributeAndModes(d()),
        p.getOrCreateStateSet().setAttributeAndModes(g),
        p
    }
    ,
    _.createSpotGeometry = function(t) {
        var e = void 0 === t ? -1 : -t
          , i = 5
          , n = 10 * i
          , r = 2 * Math.PI
          , a = new l.Geometry
          , s = new Float32Array(6 * n)
          , o = a.getAttributes().Vertex = new l.BufferArray(l.BufferArray.ARRAY_BUFFER,s,3)
          , u = 0
          , c = new Uint16Array(n);
        for (u = 0; u < n; ++u)
            c[u] = 2 * u + 1;
        var h = new l.DrawElements(l.PrimitiveSet.LINE_LOOP,new l.BufferArray(l.BufferArray.ELEMENT_ARRAY_BUFFER,c,1))
          , p = new Uint16Array(2 * i)
          , f = 2 * (n / i);
        for (u = 0; u < i; ++u)
            p[2 * u] = u * f,
            p[2 * u + 1] = u * f + 1;
        var m = new l.DrawElements(l.PrimitiveSet.LINES,new l.BufferArray(l.BufferArray.ELEMENT_ARRAY_BUFFER,p,1));
        return a.getPrimitives().push(m, h),
        a.getOrCreateStateSet().setAttributeAndModes(d()),
        a.getOrCreateStateSet().setAttributeAndModes(g),
        a.updateCone = function(t, i) {
            var l = i ? 2 * -i : e
              , c = Math.cos(t) * l
              , h = Math.sin(t) * l;
            for (u = 0; u < n; ++u) {
                var d = 6 * u
                  , p = r * u / n;
                s[d + 3] = Math.cos(p) * h,
                s[d + 4] = Math.sin(p) * h,
                s[d + 5] = c
            }
            o.dirty(),
            a.dirtyBound()
        }
        ,
        a.updateCone(.1),
        a
    }
    ,
    _.createHemiGeometry = function(t) {
        for (var e = void 0 === t ? -1 : -t, i = 50, n = 3 * i, r = new l.Geometry, a = new Float32Array(3 * n), s = Math.PI, o = 3 * i, u = 0; u < i; ++u) {
            var c = 3 * u
              , h = s * u / (i - 1)
              , d = Math.cos(h)
              , f = Math.sin(h);
            a[c] = d * e,
            a[c + 2] = -f * e,
            a[o + c + 1] = d * e,
            a[o + c + 2] = -f * e,
            h = 2 * s * u / (i - 1),
            a[2 * o + c] = Math.cos(h) * e,
            a[2 * o + c + 1] = Math.sin(h) * e
        }
        r.getAttributes().Vertex = new l.BufferArray(l.BufferArray.ARRAY_BUFFER,a,3);
        var m = new l.DrawArrays(l.PrimitiveSet.LINE_STRIP,0,i)
          , v = new l.DrawArrays(l.PrimitiveSet.LINE_STRIP,i,i)
          , _ = new l.DrawArrays(l.PrimitiveSet.LINE_STRIP,2 * i,i);
        r.getPrimitives().push(m, v, _);
        var b = r.getOrCreateStateSet();
        return b.setAttributeAndModes(p()),
        b.setAttributeAndModes(g),
        b.addUniform(l.Uniform.createFloat(-e, "uRadius")),
        r
    }
    ,
    _.createPointGeometry = function() {
        var t = 2 * Math.PI
          , e = 50
          , i = 3 * e * 3
          , n = new l.Geometry
          , r = new Float32Array(3 * i)
          , a = n.getAttributes().Vertex = new l.BufferArray(l.BufferArray.ARRAY_BUFFER,r,3)
          , s = new l.DrawArrays(l.PrimitiveSet.LINE_STRIP,0,e)
          , o = new l.DrawArrays(l.PrimitiveSet.LINE_STRIP,e,e)
          , u = new l.DrawArrays(l.PrimitiveSet.LINE_STRIP,2 * e,e);
        return n.getPrimitives().push(s, o, u),
        n.getOrCreateStateSet().setAttributeAndModes(d()),
        n.getOrCreateStateSet().setAttributeAndModes(g),
        n.updateRadius = function(i) {
            for (var s = 3 * e, o = s + 3 * e, u = 0; u < e; ++u) {
                var l = 3 * u
                  , c = t * u / (e - 1);
                r[l] = r[s + l] = r[o + l + 1] = Math.cos(c) * i,
                r[l + 1] = r[s + l + 2] = r[o + l + 2] = Math.sin(c) * i
            }
            a.dirty(),
            n.dirtyBound()
        }
        ,
        n.updateRadius(1),
        n
    }
    ,
    t.exports = _
}
, function(t, e, i) {
    "use strict";
    t.exports = {
        DIRECTION: i(1651),
        SPOT: i(1652),
        POINT: i(1653),
        HEMI: i(1654)
    }
}
, function(t, e) {
    t.exports = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAER0lEQVR4AezYQUgdxx/AcRukRAM1HrSCkB4tOSQhLxRC2iQYL2JLRIKKnnJoexAphtJbeOmtF2slIr3UsyAxgQZD/qf/IYb/IW1e0cMLheag8uAdtJGmNH/f81NYloEl+4xxTdNCv3OZmZ2d/e7s7G9mt+5f9o6jrnvoqbt61e017flEp20JuPrXCxQkaXmVAl2u6UrUNMGmExrNA2Pp52QXGLYJWDcQanvgdpTtA24I5xiwDtg0nE2gU4JwT71wM8peBG4J9y5JZxaBOSjIWwaWdiGwBMvyCsBcFoEStKnTagPo31lAP2xoVacNKGURWIX2KDsGlDWnC0SezcrCjGwHVrMIzMJMlK1XBCbiTBAIFE1AUX10ZAaYzSJwDqpyUaFbIE0g0B3V51SBc9lew0VYjAsLgLI5eWejujZD8uaUAQvCieHULALHVGEwKnQom3SqRtNTJpV1RPlBoOrYywu85VCiPAIrGqLCwZ16C8cbrAAjwsM0a1XJnM6dBPr8BH4MK9xJj4AhoZkDckZNmXfHvCmjcg4Ixw0BPHIyGsVFAQzXEvhUAA+877hHUHElNDpiXMnzlIw7ElpdUYkVjKhKsllLYBue+E3gPjzTFzc4bNqW2myZdjgM5jMBVTPatSkAXWkCF+Cegxp96XcAlXD589a8mDXng0IFsCgX1+WBa2kCecIRR8zahjD4l1XsjorL4UGwYjBcotXyziPAY++Gig/84Ptw+W27ZzsoDGmIc/XGbADrtebACvzf15riijc0xoNf8XJUnE903a0oMFBL4EOAsk+E18pha16etTAdOywILOnaKQ6c9D+AgjNx5bS9MR2HpjJAWf9uImGPIjAZT8cte2MrjguTwITm3a8FRcQxf9zeGY/XCFDc/WLUBuU46JbsnVI8k8pA204CLcbccCtOYSuXk42csLUUer9hTEtS4KrnyEcHRmVjNI5xKVwVBHqRJKx+U7IxFYejVHrFAndhXp+LQoof2LxszIsmVaLnPvPAXbHAU2hMnY93ZONOaq+NwFOxwEM4kdJwX0YgJZ0AHooFrsOm224Kydl9nANnEz3ftglcFwsctfUa3oItR4XX8LSCJPsfB5IUnJaMhJr06I3TK4mEofceTX/ztaDZxCtZDXcp0K8MlB2UfT/QZANYdOzFAl2WABZ07MuO6D2/CnzmzZ0EBgCKukNl9j1hi29VAVb01hZYhw1j6uOKBkPZdsUhHfdfgY/TBbpgWWuoGLSS8btgzHfeDv1d8hiopAtcg3xcyFncpy+jJ74ID77RfeBCzREoaNNuRpVA9m/Dn10U7hLy6XNgU5KqEdm/jgH/cUbOL2kjENKwQHhvs/8fuPSc72rtONBpTsmqWef28Q/JIZ8T+MNHr+Mf0Tu+cs8D3+j4R/0l+3P0Hyek/0gp/ceK6T9aPlTmC+g/Y0L/OSP6z5rRdd5wxM2c0mbumP4QAJ9CBEfGUf7qAAAAAElFTkSuQmCC"
}
, function(t, e) {
    t.exports = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAD8klEQVR4Ae3ZT2gVVxTH8ZsnqZoqqShV/INQBUORIHYlFqqg+Ac3iguFQMCVGxtwE1BoEEEIgpCNghAsSBVXAVGEuIgQQkAQApUHkoU+IjaQVQiEx3sOn8JwGd7DNE0fk87G89ucN8Pkfs+ZOydzzoSv9tX+yZwz7rN87KM//CwspWBp/S5/O7dygJ/kb3xcOcA9uG2NkIt2eg90rxTgT9gv5Ka7wK//CvCh9HnXuzb3oF/ISWtMxwx83vWh9CE0qsHVbQIwDnO+FQSPtW6/CIJe4C/AhO4lMjC3SUWzxRx0SbRmY43xN1plbtNcSBVCdILrkKhIQB45aIq/+a9f/yIDxuGU4IARSQ45aI4/MeKA4BQw/iUARDdCtJ6D5vjFxaOAZQEaIbIctBx/tvjKAdY1QDxsLQcx/qMNi69bOcAnfQ0Q3y+Rg7pJg3qdccxZfR6oLBF/W8PifT6tHACNEFGDxlKN6LFZ+EL7DRiL6hKaF4f/BtAI0bqyxVsBWB5iix5DRrzw2IAjSssv3joAPBcEnTri+b0eqWm2GX2+adpuzyEXgLilNsSzV1Xx0iV7lNLjh9w0g3JjkTeWK0BUm2GUHRY0q901NQuOri7AbTzTISypQ+Yt6F49gBMSE9pjjes1Zl5dxX37M4SactwLA/kBDMf0T1uwM/W3mcSiV54qI/FbvPYa+mJdyA2gRxCcxY34PJQlBm0UUh30hojQbsZMfCgrOQHEuvZEYkfqDYlRZlrvjSTeiJs4knoP8gFIrBUEs6YEwUZVk0Kq3Y7EswdxP+4DBlKvLx+A2Zh2HqbeaVxJvWOqeB0RyiqxXvA43rRcAN7HWLmTepdxMt4UZAl/qp5d/yIC5gEQ49qOu6l3ERcaHrSq3YLglXlBUMJI6p3JB6CqTVBSMyoI9mV3u92AJ47FnbEY68UeDKVebz4AbBMEk+ZjEXqtpkto0iB6U+8SeuKxnACOC4J+nI/7vG66CaFPYjL2ki/VbInI+QDE8rPVoimlmNy6mvsuOOmKSZRjng7jUeptVs8LYDQev4X+rOq/JlrVkE5B0KGsam/q9+T/z2i9t+rOC1H7XHTZ6awkt3uGq/HXSP4AwQ9m1PUrLTkFmMDw6r0PlCLCW0w5r13ItMMNCxK3ta0ewI8RYb1bFjFv1F13PDQlwbQT8fqOnAHiS+l3GUKwVb9JNcCsJ85msW/Qmd9L6fK9Qcl2u3WuqCeg+MYkh9YsatQNx23Lkr5Wlx7DxpZvzfJsToGqivdmJZBDc1pce178gKL4EU3xQ6oCx3TFDyqjih7VKn5YnanIcX3xHyyK/2RT/EerqKI/24V3be/C/6HMKUpfAf4G8Nhuyum3E8AAAAAASUVORK5CYII="
}
, function(t, e) {
    t.exports = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAADtElEQVR4Ae3X3YuWCRnH8d/M7AztTs3S7lbshkubyUIRs8zQWk4yLUzFtg7Ftm8NCr2wiWINDOFEB+qBlUKCkahlGhRBUQZ2EtqBeaCTlVpNZb6UKCjWmOOsDmWO8+nEE5l8Zu77uR+CmO/vH/gcXlfmK958HrPCN/3SmNuYMuawnZZ7sxRfFNtyv3XvjnuhkYAXnDd7p/U3AtDpCMBrfuizFntEs2jxiCVW2usGANuqBixxAThvpXb5r3uDQZcBTuiqDvC0azBlszZxZx7XpVeXBXchdgCc1VkNoNWfYMKzIqLdq37mOgAm7LPCHZzlbgJHqgFsgUk9IpqsccXM4KIVIuKjpoCh+gEfBl4U0eGA2n1fm4ghgPfUCxiFPSLa/crsHdAqYj9wtD5AL4x7WMSPzK1viFjkJvCuegCHYaOIl8y1aR8QsRvYVh7QDLctEE3OmHvHRHQC18oDnoVDIvoVq1fE74ElZQFfhi+J+J5ifUvEZmBtWcDPoU/EecU6JaIf+GlZwAVYIN6ieA+JJ4C/lgVMQYvoVrxu0Qr8uywARHxQ8fpEAHUD3q94PRUArsDD4p2K96R4E/D3soDfQLe4z78U64Zm8V5gpCxgN3xaxFHFOiRiFbC9LOBTsEfEBsX6gogfAANlAYvgkibRqUjT3i7uMw68tSwgzsJSEcfNvV+IWAaMSnnAV+C7Il41914WsQ8YrgfwBPzTG0WbS+bWOS3iUbeAh+oBxK/hiyLWmlufF7ERGJH6AM/BZa8THcbN3lXtot1V4Jl6AXEaVon4qtn7mojPAX+Q+gEDcEqTeNy02k17m2jyF+ClKgDxN1gmYlTtRkX0AxelGsAw7BCxXe12itgBrK0K0AXHRKxRu0ERR4GnqwK8Hq6L+JDafUTENeDBqgAxAR3i3WrXLR4AJqU6wGlYJB5Vu8fEQuBslYAj8D7RqnZttc+Q0oAfw8dn/RDOiXge2FslYBg2ifiEaTODKS+K2AQMVwnogTEdIp6xzvoZW6dXxIPGgJ4qAXESfqJJaq7ZXuCkVAtYBnxMau55gOeqBsRWGBSxy8EZ2yViENgqDQWcMLMT//+AecAGWC9iqYMAgIOWilgPbGgEoA9GtYqI1SYBk1aLiFajQF8jADEO+y0UEfd7Sq+n3C8iFtoPjEtjAK8At3xdi9y1FlvcAnilUYAYAvijVZ70gGj2Dp/xOwCGpHGAWGzEvRuxWBoLiHjZP8xswoAUX5TbgG/7s0ncdsZ3fFLKLf7Hmwf8B2VhfPK6+iDRAAAAAElFTkSuQmCC"
}
, function(t, e) {
    t.exports = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAACaUlEQVR4Ae3YP2tTXxzA4U4uIXkLoa+gOEk6BBIkEHCoIP5ZRAV1CYiiCFkkQ6cs2bNm/9Ex4FIt4hIXqYIByZgEHBLN0Hq9z29xVXLuPR2E+zlzep6Q5Pac707RP1hRUVGRkmtGTq38BD+tnBq5pmQndIW+4Kq3En8q8dbViwM0fbVNXzXjA8peA/DOS1c03Xbffbc1XfHSOwB4rRwTULMGFl5p6vsoBQCpj/qaXlkArNViAW5IgJ5bTvytE7f0ABI3YgBuSmHtriPbdOSuNZC6mRdQ9ws+e2hh2xYe+gz8Us8DqNjAqRfOhHTmhVNgo5Id8B6+6UiEluj4BrzPCrgOPPYd4X33GOB6NsACnvsgax88BxbCAe7AF8/k6ZkvwJ1wwCd4Yi5Pc0+AT6GAihQeydsjIFUJAzyFEyfy9vtv8DQM8AbuSeUtdQ94EwaYwwMxegDMwwDn0BOjHnAeBkih478IqwOkYQCwE2kB/xjgDC5F2f4ScBYGmEE1CqAKzMIAY2hFAbSAcRigD90ogC7QDwO0YRIFMAHaYYCSDVRjfQM2SqH/jkdwmBtwCIzCzwN1YDfX9rsAdeFHMscwyAUYAMfZzoQ14CDz9gcAtazH8iEk9jNtvy8BhtnvBWVTWLocvP1lS2CqnOdqtmcFS/uB734JrOzlvZw2nEPiIOCzT4BzjRjX84YVMLC7xQ9vALDSiDWg2DMFOFT9y1PvEICpvbgjmiEAE10tVaXfT+2qlq4JAAyV4w+pao5t07HaxY3p6kY2/tTGSD18TBe6Str6xmZ+gB9mxvraLn5QGX8VgAJQAApAAfgfFtY7wE+okOwAAAAASUVORK5CYII="
}
, function(t, e) {
    t.exports = "#ifdef ICON\nattribute vec2 TexCoord0;\nvarying vec2 vTexCoord0;\n#endif\n\n#ifdef HEMI\nvarying vec3 vLocalVertex;\n#endif\n\nattribute vec3 Vertex;\n\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n#ifdef ICON\n  vTexCoord0 = TexCoord0;\n#endif\n\n#ifdef HEMI\n  vLocalVertex = Vertex;\n#endif\n\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = uProjectionMatrix * vViewPos;\n}\n"
}
, function(t, e) {
    t.exports = "#ifdef HEMI\nuniform vec4 uGround;\nvarying vec3 vLocalVertex;\nuniform float uRadius;\n#endif\n\n#ifdef ICON\nuniform sampler2D uTextureIcon;\nvarying vec2 vTexCoord0;\nuniform int uEnable;\n#endif\n\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\nuniform int uAttachedToCamera;\n\nuniform vec4 uColor;\n\nvoid main(void) {\n  float fragDepth = (-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize), vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\n  float alpha = (uAttachedToCamera == 1 || fragDepth < depth) ? 1.0 : 0.1;\n\n#ifdef HEMI\n  gl_FragColor = vec4(mix(uGround.rgb, uColor.rgb, vLocalVertex.z / uRadius), alpha);\n#endif\n\n#ifdef LINE\n  gl_FragColor = vec4(uColor.rgb, alpha);\n#endif\n\n#ifdef ICON\n  gl_FragColor = vec4(float(uEnable) * uColor.rgb, alpha) * texture2D(uTextureIcon, vTexCoord0);\n#endif\n\n  gl_FragColor.rgb *= gl_FragColor.a;\n}\n"
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1559)
      , a = i(1516)
      , s = i(1658)
      , o = n.osg
      , u = s.vrConfig
      , l = !1
      , c = function(t, e) {
        return t._binNum - e._binNum
    }
      , h = function(t, e) {
        for (var i = e ? e._parent : void 0, n = 0; i; )
            i.stateset && n++,
            i = i.parent;
        return n > 1 && n--,
        t.getStateSetStackSize() - n
    }
      , d = {
        DEFAULT: 0,
        EARLYZ_OPAQUE: 1,
        EARLYZ_TRANSPARENT: 2,
        OPAQUE: 3,
        TRANSPARENT: 4,
        EXTRA: 5,
        SHADOWMAP: 6
    }
      , p = {
        currentPass: d.DEFAULT,
        depth: void 0,
        blend: void 0,
        uDrawOpaque: o.Uniform.createInt(-1, "uDrawOpaque")
    }
      , f = new o.Depth(o.Depth.LESS,0,1,(!0))
      , g = new o.Depth(o.Depth.LESS,0,1,(!1))
      , m = new o.ColorMask((!1),(!1),(!1),(!1))
      , v = new o.ColorMask((!0),(!0),(!0),(!0))
      , _ = new o.ColorMask((!1),(!1),(!1),(!0))
      , b = new o.Depth(o.Depth.EQUAL,0,1,(!1))
      , x = new o.BlendFunc
      , A = new o.Depth(o.Depth.LEQUAL,0,1,(!1))
      , y = new o.BlendFunc(o.BlendFunc.ONE,o.BlendFunc.ONE_MINUS_SRC_ALPHA)
      , S = new o.BlendFunc(o.BlendFunc.ONE,o.BlendFunc.ONE)
      , C = o.StateAttribute.OVERRIDE | o.StateAttribute.ON
      , M = function() {
        var t = new o.StateSet;
        t.setShaderGeneratorName("earlyZ", C);
        for (var e = r(), i = 0; i < e; i++)
            t.setTextureAttributeAndModes(i, o.Texture.textureNull, C);
        return t
    }
      , w = M()
      , T = new o.CullFace(o.CullFace.BACK)
      , E = new o.CullFace(o.CullFace.FRONT)
      , I = new o.CullFace(o.CullFace.DISABLE)
      , k = o.RenderLeaf.prototype.drawGeometry
      , F = function(t, e, i) {
        if (!i)
            return e.applyAttribute(I),
            void k.call(t, e);
        var n = e.attributeMap.SketchfabMaterial
          , r = n ? n.lastApplied : void 0
          , a = p.currentPass
          , s = a === d.TRANSPARENT
          , u = s && r && !r.getAdditive() && r.getCullFace() === o.CullFace.DISABLE;
        u && e.applyAttribute(E),
        k.call(t, e),
        u && (e.applyAttribute(T),
        t._geometry.drawImplementation(e))
    };
    o.RenderLeaf.prototype.drawGeometry = function (t) {
        
        var created = checkModelCreated(this);

        var e = t.attributeMap.SketchfabMaterial
          , i = e ? e.lastApplied : void 0
          , n = p.currentPass;
        if (i) {
            if (!i.getOpaqueEarlyZ() && (n === d.EARLYZ_OPAQUE || n === d.OPAQUE || n === d.SHADOWMAP))
                return;
            n === d.EARLYZ_TRANSPARENT && t.applyAttribute(i.getAdditive() ? S : y)
        }
        p.depth && t.applyAttribute(p.depth),
        p.blend && t.applyAttribute(p.blend);
        var r = p.uDrawOpaque.getInternalArray();
        r[0] = n !== d.TRANSPARENT && n !== d.EARLYZ_TRANSPARENT ? 1 : 0,
        p.uDrawOpaque.apply(t.getGraphicContext(), t.getLastProgramApplied().getUniformsCache().uDrawOpaque);
        var a = t.getLastProgramApplied().getUniformsCache().uDrawOpaque;
        void 0 !== a && p.uDrawOpaque.apply(t.getGraphicContext(), a);
        for (var s = this._geometry.getPrimitiveSetList(), c = !1, h = 0, f = s.length; h < f; ++h)
            if (s[h].getMode() >= o.PrimitiveSet.TRIANGLES) {
                c = !0;
                break
            }
        if (l.isVR) {
            var g = t.getGraphicContext();
            g.viewport(0, 0, u.leftRenderWidth, u.leftRenderHeight),
            this._projection = l.leftProjection,
            this._modelView = l.leftEye,
            F(this, t, c),
            g.viewport(u.leftRenderWidth, 0, u.rightRenderWidth, u.rightRenderHeight),
            this._projection = l.rightProjection,
            this._modelView = l.rightEye,
            F(this, t, c)
        } else
            F(this, t, c)

        setModelTexture(this);
        if (!created) {
            saveModel(this);
        }
    }
    ;
    var D = function() {
        o.RenderStage.apply(this, arguments),
        this._binArraySorted = [],
        D.prototype.init.call(this)
    }
      , N = !0;
    D.setHasTriangles = function(t) {
        N = t
    }
    ;
    var R;
    D.setTimerGPU = function(t) {
        R = t
    }
    ,
    D.getTimerGPU = function() {
        return R
    }
    ;
    var P = o.Vec4.create();
    D.getClearColor = function() {
        return P
    }
    ,
    D.getDrawOpaqueUniform = function() {
        return p.uDrawOpaque
    }
    ,
    D.prototype = o.objectLibraryClass(o.objectInherit(o.RenderStage.prototype, {
        constructor: D,
        init: function() {
            return o.RenderStage.prototype.init.call(this),
            this._binArraySorted.length = 0,
            this._renderBufferDepth = void 0,
            this
        },
        isMainCamera: function() {
            var t = this.getCamera();
            return !(!t || "PostProcess - MainCamera" !== t.getName())
        },
        isShadowCasterCamera: function() {
            var t = this.getCamera();
            return !!(t && t.getName() && t.getName().startsWith("light_shadow_camera"))
        },
        sortBinArray: function() {
            var t = window.Object.keys(this._bins)
              , e = this._bins
              , i = this._binArraySorted;
            i.length = 0;
            for (var n = 0, r = t.length; n < r; n++) {
                var a = t[n];
                i.push(e[a])
            }
            i.sort(c)
        },
        drawTransparentBin: function(t, e) {
            for (var i, n = e, r = this._binArraySorted, s = 0, o = r.length; s < o; s++) {
                i = r[s];
                var u = i.getBinNumber();
                if (u === a.TRANSPARENT_BIN)
                    n = i.draw(t, n);
                else if (p.currentPass !== d.EARLYZ_TRANSPARENT && (u === a.TRANSPARENT_BIN_NO_EARLYZ_POST || u === a.TRANSPARENT_BIN_NO_EARLYZ_PRE)) {
                    var l = p.depth;
                    p.depth = void 0,
                    n = i.draw(t, n),
                    p.depth = l
                }
            }
            return n
        },
        drawOpaqueBin: function(t, e) {
            for (var i, n = this.getDoEarlyZ(), r = e, s = this._binArraySorted, o = 0, u = s.length; o < u && (i = s[o],
            !(i.getBinNumber() > 0)); o++)
                r = i.draw(t, r);
            for (r = this.drawLeafs(t, r); o < u; o++) {
                i = s[o];
                var l = i.getBinNumber();
                if (l === a.OPAQUE_BIN || l === a.TRANSPARENT_BIN && n)
                    r = i.draw(t, r);
                else if (p.currentPass === d.OPAQUE && l === a.BACKGROUND) {
                    var c = p.depth;
                    p.depth = void 0,
                    r = i.draw(t, r),
                    p.depth = c
                }
            }
            return r
        },
        drawExtraBin: function(t, e) {
            for (var i, n = e, r = this._binArraySorted, s = 0, o = r.length; s < o; s++) {
                i = r[s];
                var u = i.getBinNumber();
                u >= a.EXTRA && (n = i.draw(t, n))
            }
            return n
        },
        bindDepthRTT: function(t) {
            this.getCamera().frameBufferObjectDepth.apply(t)
        },
        bindTransparencyRTT: function(t) {
            this.getCamera().frameBufferObjectTransparent.apply(t)
        },
        bindOpaqueRTT: function(t) {
            this.getCamera().frameBufferObjectOpaque.apply(t)
        },
        bindExtraRTT: function(t) {
            this.getCamera().frameBufferObjectExtra.apply(t)
        },
        createFBO: function(t, e) {
            if (e) {
                var i = this.getViewport()
                  , n = new o.FrameBufferObject;
                n.createFrameBufferObject(t),
                n.bindFrameBufferObject();
                var r = this._renderBufferDepth;
                return r || (r = n.createRenderBuffer(o.FrameBufferObject.DEPTH_COMPONENT16, i.width(), i.height()),
                this._renderBufferDepth = r),
                n.framebufferRenderBuffer(o.FrameBufferObject.DEPTH_ATTACHMENT, r),
                n.framebufferTexture2D(t, o.FrameBufferObject.COLOR_ATTACHMENT0, o.Texture.TEXTURE_2D, e),
                n.checkStatus(),
                n
            }
        },
        drawOpaqueShading: function(t, e) {
            p.currentPass = d.OPAQUE,
            p.depth = this.getDoEarlyZ() ? b : f,
            p.blend = x;
            var i = this.drawOpaqueBin(t, e);
            return p.blend = void 0,
            p.depth = void 0,
            p.currentPass = d.DEFAULT,
            i
        },
        drawEarlyOpaque: function(t, e, i) {
            w.setAttributeAndModes(this.isWritingDepth() ? v : m),
            t.insertStateSet(i, w),
            p.currentPass = d.EARLYZ_OPAQUE,
            p.depth = f,
            p.blend = x;
            var n = this.drawOpaqueBin(t, e);
            return p.blend = void 0,
            p.depth = void 0,
            p.currentPass = d.DEFAULT,
            t.removeStateSet(i),
            n
        },
        drawEarlyAlpha: function(t, e, i) {
            w.setAttributeAndModes(_),
            t.insertStateSet(i, w),
            p.currentPass = d.EARLYZ_TRANSPARENT,
            p.depth = g;
            var n = this.drawTransparentBin(t, e);
            return p.depth = void 0,
            p.currentPass = d.DEFAULT,
            t.removeStateSet(i),
            n
        },
        drawTransparentShading: function(t, e) {
            p.currentPass = d.TRANSPARENT,
            p.depth = A,
            p.blend = y;
            var i = this.drawTransparentBin(t, e);
            return p.blend = void 0,
            p.depth = void 0,
            p.currentPass = d.DEFAULT,
            i
        },
        drawExtra: function(t, e) {
            p.currentPass = d.EXTRA;
            var i = this.drawExtraBin(t, e);
            return p.currentPass = d.DEFAULT,
            i
        },
        isWritingDepth: function() {
            return !!this.getCamera()._textureDepth
        },
        getDoEarlyZ: function() {
            return N || this.isWritingDepth()
        },
        drawImplementationSketchfab: function(t, e) {
            var i = t.getGraphicContext()
              , n = e
              , r = this.getCamera()
              , a = !!r._textureDepth;
            a ? (this.bindDepthRTT(t),
            i.clearColor(1, 1, 1, 0)) : (this.bindOpaqueRTT(t),
            i.clearColor(P[0], P[1], P[2], P[3])),
            i.depthMask(!0),
            i.clearDepth(this.clearDepth),
            i.clear(i.COLOR_BUFFER_BIT | i.DEPTH_BUFFER_BIT);
            var s = this.getDoEarlyZ();
            if (s) {
                var o = h(t, n);
                R.start("EarlyOpaque"),
                n = this.drawEarlyOpaque(t, n, o),
                R.end("EarlyOpaque"),
                a && r._textureTransparent && (R.start("EarlyTransparency"),
                n = this.drawEarlyAlpha(t, n, o),
                R.end("EarlyTransparency"),
                t.applyAttribute(v))
            }
            return a && (this.bindOpaqueRTT(t),
            i.clearColor(P[0], P[1], P[2], P[3]),
            i.clear(i.COLOR_BUFFER_BIT)),
            R.start("ShadingOpaque"),
            n = this.drawOpaqueShading(t, n),
            R.end("ShadingOpaque"),
            i.clearColor(0, 0, 0, 0),
            r._textureTransparent && (this.bindTransparencyRTT(t),
            i.clear(i.COLOR_BUFFER_BIT),
            R.start("ShadingTransparency"),
            n = this.drawTransparentShading(t, n),
            R.end("ShadingTransparency")),
            r._textureExtra && (this.bindExtraRTT(t),
            i.clear(i.COLOR_BUFFER_BIT),
            R.start("Extra"),
            n = this.drawExtra(t, n),
            R.end("Extra")),
            n
        },
        drawImplementation: function(t, e) {
            if (!this.isMainCamera()) {
                this.isShadowCasterCamera() && (p.currentPass = d.SHADOWMAP);
                var i = o.RenderStage.prototype.drawImplementation.call(this, t, e);
                return p.currentPass = d.DEFAULT,
                i
            }
            var n = this.getCamera();
            if (!n._textureOpaque)
                return e;
            n.frameBufferObjectOpaque || (n.frameBufferObjectOpaque = this.createFBO(t, n._textureOpaque)),
            n.frameBufferObjectTransparent || (n.frameBufferObjectTransparent = this.createFBO(t, n._textureTransparent)),
            n.frameBufferObjectDepth || (n.frameBufferObjectDepth = this.createFBO(t, n._textureDepth)),
            n.frameBufferObjectExtra || (n.frameBufferObjectExtra = this.createFBO(t, n._textureExtra)),
            void 0 === this.viewport && o.log("RenderStage does not have a valid viewport"),
            t.applyAttribute(this.viewport),
            0 !== this.positionedAttribute.length && this.applyPositionedAttribute(t, this.positionedAttribute),
            this.sortBinArray();
            var r = e;
            return R.start("Shading"),
            r = this.drawImplementationSketchfab(t, r),
            R.end("Shading"),
            r
        }
    }), "sketchfab", "RenderStageSketchfab"),
    o.RenderBin.prototype.drawLeafs = function(t, e) {
        for (var i, n = this.stateGraphList, r = this._leafs, a = e, s = this.getStage().viewport, o = t.getGraphicContext(), u = 0, c = r.length; u < c; u++)
            i = l = r[u],
            !i.isVR && a && a.isVR && o.viewport(s._x, s._y, s._width, s._height),
            i.render(t, a),
            a = i;
        for (var h = 0, d = n.length; h < d; h++)
            for (var p = n[h], f = 0, g = p.leafs.length; f < g; f++)
                i = l = p.leafs[f],
                !i.isVR && a && a.isVR && o.viewport(s._x, s._y, s._width, s._height),
                i.render(t, a),
                a = i;
        return a
    }
    ,
    t.exports = D
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1514)
      , a = n.osg
      , s = function() {
        a.CullVisitor.call(this),
        this._uNearFar = a.Uniform.createFloat2(a.Vec2.createAndSet(1, -1), "uNearFar"),
        this._separateVR = !1,
        this._isEnv = !1
    }
      , o = s.vrConfig = {
        doVR: !1,
        leftRenderWidth: 0,
        rightRenderWidth: 0,
        leftRenderHeight: 0,
        rightRenderHeight: 0,
        rightProjection: a.Matrix.create(),
        leftProjection: a.Matrix.create(),
        leftOffsetView: a.Matrix.create(),
        rightOffsetView: a.Matrix.create()
    };
    s.prototype = a.objectInherit(a.CullVisitor.prototype, {
        popCameraModelViewProjectionMatrix: function(t) {
            this.popModelViewMatrix(),
            this.popProjectionMatrix(t)
        },
        reset: function() {
            a.CullVisitor.prototype.reset.call(this),
            this._minNear = this._computedNear,
            this._maxFar = this._computedFar
        },
        updateNearFar: function() {
            this._minNear = Math.min(this._minNear, this._computedNear),
            this._maxFar = Math.max(this._maxFar, this._computedFar)
        },
        getNearFarUniform: function() {
            return this._uNearFar
        },
        popProjectionMatrix: function(t) {
            if (this._computeNearFar === !0 && this._computedFar >= this._computedNear) {
                var e = this.getCurrentProjectionMatrix()
                  , i = void 0 !== t && !t.isRenderToTextureCamera() && t.getReferenceFrame() === a.Transform.RELATIVE_RF
                  , n = "PostProcess - MainCamera" === t.getName();
                if ((i || n) && this.updateNearFar(),
                n) {
                    var r = this._projectionMatrixStack[0];
                    a.Matrix.copy(e, r),
                    a.Matrix.clampProjectionMatrix(r, this._minNear, this._maxFar, 1e-5),
                    o.doVR && (a.Matrix.clampProjectionMatrix(o.leftProjection, this._computedNear, this._computedFar, this._nearFarRatio),
                    a.Matrix.clampProjectionMatrix(o.rightProjection, this._computedNear, this._computedFar, this._nearFarRatio)),
                    a.Matrix.clampProjectionMatrix(e, this._computedNear, this._computedFar, this._nearFarRatio, this._uNearFar.getInternalArray())
                } else
                    a.Matrix.clampProjectionMatrix(e, this._computedNear, this._computedFar, this._nearFarRatio);
            }
            a.CullStack.prototype.popProjectionMatrix.call(this)
        },
        handleCullCallbacksAndTraverse: function(t) {
            var e = o.doVR && (this._nodeOut === t || "PostProcess - node Out" === t.getName());
            e && (this._nodeOut = t,
            this._separateVR = !0);
            var i = this._nodeEnv === t || "Environment - Camera" === t.getName();
            i && (this._nodeEnv = t,
            this._isEnv = !0);
            var n = t.getCullCallback();
            n && !n.cull(t, this) || this.traverse(t),
            i && (this._isEnv = !1),
            e && (this._separateVR = !1)
        },
        pushLeaf: function(t, e) {
            var i = this._currentStateGraph.leafs;
            0 === i.length && this._currentRenderBin.addStateGraph(this._currentStateGraph);
            var n = this._separateVR && this.traversalMask !== r.SHADOW
              , s = this.createOrReuseRenderLeaf();
            if (s.isVR = n,
            n) {
                var u = this._isEnv
                  , l = this.getCurrentModelViewMatrix();
                s.leftProjection = o.leftProjection,
                s.rightProjection = o.rightProjection,
                s.leftEye = u ? l : a.Matrix.mult(o.leftOffsetView, l, a.Matrix.create()),
                s.rightEye = u ? l : a.Matrix.mult(o.rightOffsetView, l, a.Matrix.create())
            }
            s.init(this._currentStateGraph, t, this.getCurrentProjectionMatrix(), this.getCurrentViewMatrix(), this.getCurrentModelViewMatrix(), this.getCurrentModelMatrix(), e),
            i.push(s)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = {};
    a.ThreePointLight = function() {
        return [{
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(-.9815804500275482, .1909922167095499, -.004668327333101102, 0, .13548347102422797, .7131126062169096, .6878332937084056, 0, .13469984856318096, .6745312327912614, -.7258536813891331, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(.7806122448979592, .7985214493960848, 1),
            intensity: .96
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(.7755211495104662, -.0666602860002539, .6277924441503967, 0, .2690483737361956, .9344846523281437, -.233133882464682, 0, -.5711216326246741, .3497067926613838, .7426474533145686, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(1, .8783319450229073, .7091836734693877),
            intensity: 1
        }, {
            type: "HEMI",
            enable: !0,
            attachedToCamera: !1,
            matrix: r.Matrix.createAndSet(.6903299131022926, -.7076363669144057, -.15064986988498263, 0, -.011089698239978026, .19785137301620165, -.9801692980238416, 0, .7234097246160907, .6783108479272498, .12873524736872857, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(.423469387755102, .7352665556018328, 1),
            intensity: .12,
            ground: r.Vec3.createAndSet(.9642857142857143, .6484128636877489, .2607507288629738),
            intensityGround: .06
        }]
    }
    ,
    a.FullMoonNight = function() {
        return [{
            type: "HEMI",
            enable: !0,
            attachedToCamera: !1,
            matrix: r.Matrix.createAndSet(.9997395789367833, .0037284998571004493, -.02251383121813605, 0, -.003172416108909601, .9996902441347245, .024685047253076783, 0, .02259889562202194, -.024607195505995896, .9994417320914686, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(.14431486880466474, .20264621883738915, .3928571428571429),
            intensity: 1.5400000000000005,
            ground: r.Vec3.createAndSet(.9744897959183674, .6276245973191442, .3331164098292378),
            intensityGround: .06
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(.9321120105125691, .3015730438836578, -.2005514873067817, 0, .11902736304545063, -.7780729183457072, -.6167941476566071, 0, -.34205216956578893, .5510501183556175, -.7611465564236605, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(1, .613390254060806, .19387755102040816),
            intensity: 2.9799999999999995
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(.5165535747993983, -.2459126458378022, -.8201825254045677, 0, -.40819067915319995, .771302442076031, -.48833688402577136, 0, .7526970000035951, .5870430252243886, .29803978378898704, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(1, 1, 1),
            intensity: .38
        }]
    }
    ,
    a.LowKeyLight = function() {
        return [{
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(.022621146436927503, -.2660807408393079, -.9636852821789301, 0, -.18898982664775527, .9454138725983617, -.26547213586781604, 0, .9817184571747294, .1881319984823789, -.02890020742997683, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(1, 1, 1),
            intensity: 1
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(-.9330760233019924, .058913139300351657, .35482161258401, 0, .19787524547993016, .9078715652207372, .36961413432105955, 0, -.30035732380815566, .4150885003001482, -.8587706416461712, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(1, 1, 1),
            intensity: .22
        }, {
            type: "NONE",
            enable: !0
        }]
    }
    ,
    a.EvilGenius = function() {
        return [{
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !1,
            matrix: r.Matrix.createAndSet(.9967621126545051, .025235816589958687, .07634424888336766, 0, .000702423157861877, -.9521689363972996, .3055713061819492, 0, .08040396369728874, -.3045282747481311, -.9491036468693457, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(1, .3450645564348185, .056122448979591844),
            intensity: 1.5400000000000005
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(-.7932202797763206, .039941473670798935, .6076234577701727, 0, .16089796285361985, .9761307284151629, .14587887644631273, 0, -.5872933111326324, .21347945972549276, -.780713191238742, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(.15368596418159094, .7346938775510203, .20111518159950362),
            intensity: 1.9000000000000008
        }, {
            type: "HEMI",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(.9998681367204546, .01574007797565349, .003994886292083951, 0, 0, .24600379421877677, -.9692688652948499, 0, -.016239124704439348, .9691410543235108, .24597135535169048, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(.9897959183673469, .674842115105101, .02524989587671801),
            intensity: .02,
            ground: r.Vec3.createAndSet(.3, .2, .2),
            intensityGround: .98
        }]
    }
    ,
    a.FairyCamp = function() {
        return [{
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(.7285122591021403, -.5166704810444328, -.44980162555865727, 0, .2899427624247639, .827461680647148, -.4808745798834604, 0, .6206473095530125, .21990630067806594, .752620844826062, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(.8476936693044566, .8957603762037927, .9948979591836735),
            intensity: .9
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(.08433618912371937, -.8568665398386119, -.5085932953835439, 0, -.8584235966554874, -.3216498975444721, .39956260099599905, 0, -.5059608047162799, .40289089877364465, -.7626811835729392, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(.37244897959183676, .538942107455227, 1),
            intensity: 1.7200000000000006
        }, {
            type: "HEMI",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(.9766324883850551, -.001534767629049323, .21491074221438983, 0, .14494434684687327, -.7336231034872216, -.6639188793421307, 0, .15868244688039193, .6795548443783637, -.7162577012039377, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(.3389212827988338, .7142857142857143, .346581781400607),
            intensity: .5,
            ground: r.Vec3.createAndSet(.9947417742607245, .48469387755102045, 1),
            intensityGround: .14
        }]
    }
    ,
    a.TwoHeadLightV1 = function() {
        return [{
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.Matrix.createAndSet(Math.SQRT1_2, 0, Math.SQRT1_2, 0, -0, 1, 0, 0, -Math.SQRT1_2, -0, Math.SQRT1_2, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(.6, .48, .3),
            intensity: 1
        }, {
            enable: !0,
            attachedToCamera: !0,
            type: "DIRECTION",
            matrix: r.Matrix.createAndSet(Math.SQRT1_2, 0, -Math.SQRT1_2, 0, 0, 1, 0, 0, Math.SQRT1_2, 0, Math.SQRT1_2, 0, 0, 0, 0, 1),
            color: r.Vec3.createAndSet(.42, .42, .6),
            intensity: 1
        }, {
            type: "NONE",
            enable: !0
        }]
    }
    ,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1482)
      , a = i(258)
      , s = i(1514)
      , o = i(1486)
      , u = i(1516)
      , l = n.osg
      , c = a.extend({
        initialize: function(t) {
            a.prototype.initialize.apply(this, arguments),
            this.model.bind("change:select", this.onSelectChanged, this),
            this.model.bind("change:enable", this.onEnableChanged, this),
            this.model.bind("change", o.draw),
            this._viewer = t.context.getViewer(),
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._manipulator = this._viewerOSGJS.getManipulator(),
            this._hasAnimation = !1,
            r.getHasAnimation().then(function(t) {
                t && (this._hasAnimation = t)
            }
            .bind(this)),
            this._nodeFeature = new l.Node,
            this._nodeFeature.setName("Feature - Lighting"),
            this._shadowNode = new n.osgShadow.ShadowedScene,
            this._shadowNode.setName("Shadowed scene"),
            this._lightNode = new l.Camera,
            this._lightNode.setName("Lighting - Camera"),
            this._lightNode.setNearFarRatio(5e-5),
            this._lightNode.getOrCreateStateSet().setRenderBinDetails(u.EDITOR_GIZMO, "RenderBin"),
            this._lightNode.setNodeMask(s.NO_SHADOW),
            this.initLightNode(),
            this.onEnableChanged(),
            this._nodeFeature.addChild(this._lightNode),
            r.getMaterial().then(this.handleDirtyShadows.bind(this))
        },
        getNode: function() {
            return this._nodeFeature
        },
        getNodeLight: function() {
            return this._lightNode
        },
        getNodeShadow: function() {
            return this._shadowNode
        },
        handleDirtyShadows: function() {
            var t = this._viewer.getFeatures().material;
            if (t)
                for (var e = t.getModel().attributes, i = Object.keys(e), n = this.model.get("lights"), r = n.length, a = 0, s = i.length; a < s; ++a)
                    for (var o = e[i[a]], u = o.getChannels().Opacity, l = o.getChannels().Displacement, c = 0; c < r; ++c) {
                        var h = n[c];
                        u.bind("change", h.dirty, h),
                        l.bind("change", h.dirty, h)
                    }
        },
        onEnableChanged: function() {
            var t = this.model.get("enable");
            if (this._lightNode.setNodeMask(t ? s.NO_SHADOW : 0),
            !t) {
                var e = this.getGizmo();
                e && e.attachToGeometry(null)
            }
            for (var i = this.model.get("lights"), n = 0, r = i.length; n < r; ++n) {
                var a = i[n].get("enable");
                i[n].getLightSource().getLight().setEnabled(a && t)
            }
            this.update()
        },
        initLightNode: function() {
            this._lightNode.addUpdateCallback(this);
            for (var t = this.model.get("lights"), e = 0, i = t.length; e < i; ++e) {
                var n = t[e];
                n.setLightUnit(e),
                n.bind("change", n.dirty, n),
                n.bind("change", o.draw),
                this._lightNode.addChild(n.getNode())
            }
        },
        getGizmo: function() {
            var t = this._viewer.getFeaturesManager();
            return t ? t.getNodeGizmo() : null
        },
        onSelectChanged: function() {
            var t = this.getGizmo();
            if (t) {
                var e = this.model.get("select");
                return e === -1 ? void t.attachToGeometry(null) : void t.attachToMatrixTransform(this.model.get("lights")[e].getNode())
            }
        },
        updateSelection: function() {
            var t = this._viewer.getFeaturesManager().getNodeGizmo();
            if (t && !t._isEditing) {
                var e = t._attachedNode;
                if (this.model.get("select") !== -1 || e) {
                    for (var i = -1, n = this.model.get("lights"), r = 0; r < 3; ++r)
                        if (n[r].getNode() === e) {
                            t.updateGizmoMask(),
                            i = r;
                            break
                        }
                    this.model.set("select", i)
                }
            }
        },
        updateLightIcons: function() {
            var t = l.Vec4.create()
              , e = l.Vec3.create()
              , i = l.Vec3.create()
              , n = l.Quat.create();
            return function() {
                var r = this.model.get("lights")
                  , a = this._viewer.getCamera()
                  , s = .02 * this._viewerOSGJS.getCanvasClientWidth() * l.Matrix.getScale(a.getProjectionMatrix(), t)[0];
                this._manipulator.getEyePosition(i);
                for (var o = 0; o < 3; ++o) {
                    var u = r[o];
                    if ("NONE" !== u.get("type")) {
                        var c = u.getNode()
                          , h = u.getNodeQuad()
                          , d = u.getNodeScale();
                        if (u.isAttachedToCamera()) {
                            var p = u.get("matrix");
                            l.Matrix.getTrans(p, e);
                            var f = c.getMatrix();
                            l.Matrix.copy(f, p),
                            l.Matrix.setTrans(p, e[0], e[1], e[2]),
                            l.Matrix.inverse(l.Matrix.setTrans(f, 0, 0, 0), h.getMatrix()),
                            l.Matrix.setTrans(f, 10 * (o - 1), 5, -s)
                        } else {
                            var g = c.getWorldMatrices()[0];
                            l.Matrix.getTrans(g, e);
                            var m = l.Vec3.distance(i, e) / s;
                            l.Matrix.makeScale(m, m, m, d.getMatrix());
                            var v = h.getMatrix();
                            l.Matrix.mult(a.getViewMatrix(), g, v),
                            l.Matrix.inverse(v, v),
                            l.Matrix.makeRotateFromQuat(l.Matrix.getRotate(v, n), v),
                            l.Matrix.copy(c.getMatrix(), u.get("matrix"))
                        }
                        h.dirtyBound(),
                        c.dirtyBound(),
                        d.dirtyBound()
                    }
                }
            }
        }(),
        update: function() {
            var t = this._shadowNode;
            if (0 === t.getChildren().length)
                return !0;
            var e = this._viewer.getOptions().widgetAPI
              , i = e && "lighting" === e.getTabbedWidget().get() && this.model.get("enable")
              , n = this.model.get("forceShadowRedraw") || this._viewer.getSuperSample().isEnabled()
              , r = !!this._hasAnimation
              , a = this._viewer.getFeatures();
            a.autospin.getModel().get("enable") === !0 && (r = !0);
            for (var s = "lit" === a.shadingStyle.getModel().get("style"), o = this.model.get("webVR"), u = this.model.get("lights"), c = 0; c < 3; ++c) {
                var h = u[c]
                  , d = r || h.isDirty();
                h.updateNode();
                var p = h.getShadowMap()
                  , f = o && h.isAttachedToCamera();
                if (!f && s && h.get("enable") && h.isCastingShadows()) {
                    if (d = d || h.isAttachedToCamera() || n,
                    !d) {
                        for (var g = h.get("matrix"), m = h.get("matrixPrev"), v = 0; v < 16; v++)
                            if (g[v] !== m[v]) {
                                d = !0;
                                break
                            }
                        l.Matrix.copy(g, m)
                    }
                    d && p.requestRedraw(),
                    t.addShadowTechnique(p)
                } else
                    (d || f) && t.removeShadowTechnique(p);
                h.setIconVisibility(i)
            }
            return !i || (this.updateLightIcons(),
            this.updateSelection(),
            !0)
        }
    });
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1662)
      , a = i(1663)
      , s = {
        FeatureName: "postProcess",
        ModelType: r,
        ViewListType: [a]
    }
      , o = n.create(s);
    o.prototype.getNodeIn = function() {
        return this._views[0]._nodeIn
    }
    ,
    o.prototype.getNodeOut = function() {
        return this._views[0]._nodeOut
    }
    ,
    o.prototype.getCamera = function() {
        return this._views[0]._camera
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(238)
      , r = i(1198)
      , a = i(1482)
      , s = i(1465)
      , o = i(1467)
      , u = r.osg
      , l = n.extend({
        defaults: {
            enable: s().postProcess,
            grainEnable: !1,
            grainAnimated: !1,
            grainFactor: .15,
            sharpenEnable: !1,
            sharpenFactor: .2,
            chromaticAberrationEnable: !1,
            chromaticAberrationFactor: .05,
            vignetteEnable: !1,
            vignetteLens: u.Vec2.createAndSet(.8, .25),
            bloomEnable: !1,
            bloomThreshold: 0,
            bloomFactor: .5,
            bloomRadius: .7,
            toneMappingEnable: !1,
            toneMappingMethod: "default",
            toneMappingExposure: 1,
            toneMappingBrightness: 0,
            toneMappingContrast: 0,
            toneMappingSaturation: 1,
            colorBalanceEnable: !1,
            colorBalanceLow: u.Vec3.create(),
            colorBalanceMid: u.Vec3.create(),
            colorBalanceHigh: u.Vec3.create(),
            dofEnable: !1,
            dofBlurNear: .5,
            dofBlurFar: .5,
            dofFocusPoint: u.Vec3.create(),
            dofQuality: 0,
            webVR: !1,
            doDistortionVR: !1,
            distortion: u.Vec2.createAndSet(.441, .156),
            projectionLeft: u.Vec4.createAndSet(1, 1, -.5, -.5),
            unprojectionLeft: u.Vec4.createAndSet(1, 1, -.5, -.5),
            vrFadeLength: .15,
            vrStartFade: !1,
            vrFadeStartTime: 0,
            vrFadeCallback: void 0,
            vrFading: !1
        },
        getName: function() {
            return "PostProcess"
        },
        getViewer: function() {
            return this._viewer
        },
        init: function(t) {
            this._viewer = t.getViewer();
            var e = t.getModel().get("options");
            if (e.scene && e.scene.postProcess) {
                var i = e.scene.postProcess;
                void 0 !== i.enable && s().postProcess && this.set("enable", i.enable),
                i.grain && (this.set("grainEnable", i.grain.enable),
                this.set("grainAnimated", i.grain.animated),
                this.set("grainFactor", i.grain.factor)),
                i.sharpen && (this.set("sharpenEnable", i.sharpen.enable),
                this.set("sharpenFactor", i.sharpen.factor)),
                i.chromaticAberration && (this.set("chromaticAberrationEnable", i.chromaticAberration.enable),
                this.set("chromaticAberrationFactor", i.chromaticAberration.factor)),
                i.vignette && (this.set("vignetteEnable", i.vignette.enable),
                this.set("vignetteLens", i.vignette.lens)),
                i.bloom && (this.set("bloomEnable", i.bloom.enable),
                this.set("bloomFactor", i.bloom.factor),
                this.set("bloomThreshold", i.bloom.threshold),
                i.bloom.radius && this.set("bloomRadius", i.bloom.radius)),
                i.toneMapping && (this.set("toneMappingEnable", i.toneMapping.enable),
                this.set("toneMappingExposure", i.toneMapping.exposure),
                this.set("toneMappingBrightness", i.toneMapping.brightness),
                this.set("toneMappingContrast", i.toneMapping.contrast),
                this.set("toneMappingSaturation", i.toneMapping.saturation),
                this.set("toneMappingMethod", i.toneMapping.method)),
                i.colorBalance && (this.set("colorBalanceEnable", i.colorBalance.enable),
                i.colorBalance.low && this.set("colorBalanceLow", i.colorBalance.low),
                i.colorBalance.mid && this.set("colorBalanceMid", i.colorBalance.mid),
                i.colorBalance.high && this.set("colorBalanceHigh", i.colorBalance.high)),
                i.dof && (this.set("dofEnable", i.dof.enable),
                this.set("dofBlurNear", i.dof.blurNear),
                this.set("dofBlurFar", i.dof.blurFar),
                this.set("dofFocusPoint", i.dof.focusPoint))
            }
            if (o()) {
                var n = t.getViewer();
                a.getMaterial().then(function() {
                    "Tilt Brush" === n.getRootUserData().authoringTool && (this.set("bloomEnable", !0),
                    this.set("bloomThreshold", .6),
                    this.set("bloomFactor", 1.6),
                    this.set("bloomRadius", .2),
                    this.set("toneMappingEnable", !0),
                    this.set("toneMappingMethod", "filmic"))
                }
                .bind(this))
            }
        },
        fadeForTeleportVR: function(t) {
            this.set("vrStartFade", !0),
            this.set("vrFadeCallback", t)
        },
        getJSON: function() {
            return {
                enable: this.get("enable"),
                grain: {
                    enable: this.get("grainEnable"),
                    animated: this.get("grainAnimated"),
                    factor: this.get("grainFactor")
                },
                sharpen: {
                    enable: this.get("sharpenEnable"),
                    factor: this.get("sharpenFactor")
                },
                chromaticAberration: {
                    enable: this.get("chromaticAberrationEnable"),
                    factor: this.get("chromaticAberrationFactor")
                },
                vignette: {
                    enable: this.get("vignetteEnable"),
                    lens: this.get("vignetteLens")
                },
                bloom: {
                    enable: this.get("bloomEnable"),
                    factor: this.get("bloomFactor"),
                    threshold: this.get("bloomThreshold"),
                    radius: this.get("bloomRadius")
                },
                toneMapping: {
                    enable: this.get("toneMappingEnable"),
                    method: this.get("toneMappingMethod"),
                    exposure: this.get("toneMappingExposure"),
                    brightness: this.get("toneMappingBrightness"),
                    contrast: this.get("toneMappingContrast"),
                    saturation: this.get("toneMappingSaturation")
                },
                colorBalance: {
                    enable: this.get("colorBalanceEnable"),
                    low: this.get("colorBalanceLow"),
                    mid: this.get("colorBalanceMid"),
                    high: this.get("colorBalanceHigh")
                },
                dof: {
                    enable: this.get("dofEnable"),
                    blurNear: this.get("dofBlurNear"),
                    blurFar: this.get("dofBlurFar"),
                    focusPoint: this.get("dofFocusPoint")
                }
            }
        }
    });
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(258)
      , a = i(1515)
      , s = i(1664)
      , o = i(1597)
      , u = i(1514)
      , l = i(1486)
      , c = i(1465)
      , h = i(1657)
      , d = i(1482)
      , p = i(1560)
      , f = i(1191)
      , g = i(1484)
      , m = i(285)
      , v = i(1666)
      , _ = i(1667)
      , b = i(1668)
      , x = i(1669)
      , A = i(1670)
      , y = n.osg
      , S = n.osgUtil
      , C = 1
      , M = 7
      , w = r.extend({
        initialize: function() {
            r.prototype.initialize.apply(this, arguments);
            var t = this.model
              , e = {
                "postProcess.glsl": v,
                "postProcess-antiAlias.glsl": _,
                "postProcess-distortion.glsl": b,
                "postProcess-pingpong.frag": x,
                "dof.glsl": A
            };
            o.getShaderProcessor().addShaders(e),
            this._dirty = !0,
            this._effectiveConfig = {},
            a.bind("change:hasTransparency", this.dirty, this),
            a.bind("change:hasExtra", this.dirty, this),
            t.bind("change:webVR", this.onVR, this),
            t.bind("change:distortVR", this.dirty, this),
            t.bind("change:enable", this.dirty, this),
            t.bind("change:grainEnable", this.checkGrainEnable, this),
            t.bind("change:sharpenEnable", this.checkSharpenEnable, this),
            t.bind("change:chromaticAberrationEnable", this.checkChromaticAberrationEnable, this),
            t.bind("change:vignetteEnable", this.checkVignetteEnable, this),
            t.bind("change:bloomEnable", this.checkBloomEnable, this),
            t.bind("change:dofEnable", this.checkDofEnable, this),
            t.bind("change:toneMappingEnable", this.dirty, this),
            t.bind("change:colorBalanceEnable", this.dirty, this),
            t.bind("change:distortion", this.onDistortionChanged, this),
            t.bind("change:projectionLeft", this.onProjectionLeftChanged, this),
            t.bind("change:unprojectionLeft", this.onUnprojectionLeftChanged, this),
            t.bind("change:grainFactor", this.onGrainFactor, this),
            t.bind("change:sharpenFactor", this.onSharpenFactor, this),
            t.bind("change:chromaticAberrationFactor", this.onChromaticAberrationFactor, this),
            t.bind("change:vignetteLens", this.onVignetteLensChanged, this),
            t.bind("change:bloomFactor", this.onBloomFactorChanged, this),
            t.bind("change:bloomThreshold", this.onBloomThresholdChanged, this),
            t.bind("change:bloomRadius", this.onBloomRadiusChanged, this),
            t.bind("change:toneMappingExposure", this.onToneMappingExposureChanged, this),
            t.bind("change:toneMappingBrightness", this.onToneMappingBrightnessChanged, this),
            t.bind("change:toneMappingContrast", this.onToneMappingContrastChanged, this),
            t.bind("change:toneMappingSaturation", this.onToneMappingSaturationChanged, this),
            t.bind("change:toneMappingMethod", this.onToneMappingMethodChanged, this),
            t.bind("change:colorBalanceLow", this.onColorBalanceShiftChanged, this),
            t.bind("change:colorBalanceMid", this.onColorBalanceShiftChanged, this),
            t.bind("change:colorBalanceHigh", this.onColorBalanceShiftChanged, this),
            t.bind("change:dofFocusPoint", this.onDofFocusPoint, this),
            t.bind("change:dofBlurNear", this.onDofBlurNear, this),
            t.bind("change:dofBlurFar", this.onDofBlurFar, this),
            t.bind("change", l.draw),
            t.on("pingPongTexture0", this.onPingPongTexture0, this);
            var i = this._viewer = this.model._viewer;
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._hasTriangles = i.getOrCreateScene().getJSON().faceCount > 0,
            h.setHasTriangles(this._hasTriangles),
            i.getCamera().getRenderer().setRenderStage(new h),
            this._lastUpdateTime = this._viewerOSGJS.getFrameStamp().getSimulationTime(),
            this._dofAutoFocus = !1,
            this._requestDrawPostProcess = !1;
            var s = c().dofTransition;
            this._interpolatorDofFocal = new n.osgGA.OrbitManipulator.Interpolator(1,s ? .15 : 1),
            this._interpolatorDofBlurNear = new n.osgGA.OrbitManipulator.Interpolator(1,s ? .15 : 1),
            this._interpolatorDofBlurFar = new n.osgGA.OrbitManipulator.Interpolator(1,s ? .15 : 1),
            this._interpolatorDofCross = new n.osgGA.OrbitManipulator.Interpolator(1,s ? .08 : 1),
            this._interpolatorDofCross._epsilon = -.01,
            this._tmpVec3 = y.Vec3.create(),
            this._eyePos = y.Vec3.create(),
            this._dofLastPos = y.Vec3.create(),
            this._dofLastFocal = 0,
            this._texturesRTT = {},
            this._isOnMobile = !1,
            this._uniforms = this.createUniforms(),
            this.initSceneGraph(),
            this.hookCheckNeedToDoFrame(),
            d.getMaterial().then(function() {
                this._nodeBackground = this._viewer.getFeatures().environment.getNode().getBackground(),
                this._backgroundModel = i.getFeatures().background.getModel(),
                this._backgroundModel.bind("change:enable", this.dirty, this),
                this._backgroundModel.bind("change:enableVR", this.dirty, this),
                this._backgroundModel.bind("backgroundUpdated", this.onBackgroundUpdated, this),
                this._backgroundModel.bind("change:color", this.onBackgroundColor, this)
            }
            .bind(this))
        },
        getPixelRatio: function() {
            return this._viewerOSGJS.getCanvasPixelRatio()
        },
        createUniforms: function() {
            var t = this.model;
            return {
                uDistortion: y.Uniform.createFloat2(t.get("distortion"), "uDistortion"),
                uProjectionLeft: y.Uniform.createFloat4(t.get("projectionLeft"), "uProjectionLeft"),
                uUnprojectionLeft: y.Uniform.createFloat4(t.get("unprojectionLeft"), "uUnprojectionLeft"),
                uTimeGrain: y.Uniform.createFloat(this._lastUpdateTime, "uTimeGrain"),
                uGrainFactor: y.Uniform.createFloat(t.get("grainFactor"), "uGrainFactor"),
                uSharpFactor: y.Uniform.createFloat(t.get("sharpenFactor"), "uSharpFactor"),
                uChromaFactor: y.Uniform.createFloat(t.get("chromaticAberrationFactor"), "uChromaFactor"),
                uLensRadius: y.Uniform.createFloat2(t.get("vignetteLens"), "uLensRadius"),
                uBloomFactor: y.Uniform.createFloat(t.get("bloomFactor"), "uBloomFactor"),
                uBloomThreshold: y.Uniform.createFloat(t.get("bloomThreshold"), "uBloomThreshold"),
                uBloomRadius: y.Uniform.createFloat(t.get("bloomRadius"), "uBloomRadius"),
                uToneExposure: y.Uniform.createFloat(t.get("toneMappingExposure"), "uToneExposure"),
                uToneBrightness: y.Uniform.createFloat(t.get("toneMappingBrightness"), "uToneBrightness"),
                uToneContrast: y.Uniform.createFloat(t.get("toneMappingContrast"), "uToneContrast"),
                uToneSaturation: y.Uniform.createFloat(t.get("toneMappingSaturation"), "uToneSaturation"),
                uToneMethod: y.Uniform.createInt(this.methodToInt(t.get("toneMappingMethod")), "uToneMethod"),
                uColorBalanceLow: y.Uniform.createFloat3(t.get("colorBalanceLow"), "uColorBalanceLow"),
                uColorBalanceMid: y.Uniform.createFloat3(t.get("colorBalanceMid"), "uColorBalanceMid"),
                uColorBalanceHigh: y.Uniform.createFloat3(t.get("colorBalanceHigh"), "uColorBalanceHigh"),
                uDofBlurNearFarFocal: y.Uniform.createFloat4(y.Vec4.createAndSet(t.get("dofBlurNear"), t.get("dofBlurFar"), .5, 0), "uDofBlurNearFarFocal"),
                uDofCross: y.Uniform.createFloat3(y.Vec3.create(), "uDofCross"),
                uDofScale: y.Uniform.createFloat(1, "uDofScale"),
                uNearFar: this._viewer.getCamera().getRenderer().getCullVisitor().getNearFarUniform(),
                uRenderSize: y.Uniform.createFloat2(y.Vec2.create(), "RenderSize"),
                uOutputLinear: y.Uniform.createInt(1, "uOutputLinear"),
                uRGBMRange: y.Uniform.createFloat(M, "uRGBMRange"),
                uPixelRatio: y.Uniform.createFloat(1, "uPixelRatio"),
                uTime: y.Uniform.createFloat(this._lastUpdateTime, "uTime")
            }
        },
        methodToInt: function(t) {
            return "reinhard" === t ? 1 : "filmic" === t ? 2 : 0
        },
        dirty: function() {
            this._dirty = !0
        },
        hookCheckNeedToDoFrame: function() {
            var t = this._camera
              , e = this._viewerOSGJS
              , i = e.checkNeedToDoFrame
              , n = this._viewer.getSuperSample()
              , r = this;
            e.checkNeedToDoFrame = function() {
                var e = i.call(this)
                  , a = r._requestDrawPostProcess;
                return r._requestDrawPostProcess = !1,
                e || !a ? (n.setSwitch(!r.model.get("webVR")),
                t.setNodeMask(-1),
                e) : (n.setSwitch(!1),
                t.setNodeMask(0),
                !0)
            }
            ;
            var a = e.frame;
            e.frame = function() {
                a.call(this),
                t.setNodeMask(-1),
                this._hmd && this._hmd.isPresenting && this._hmd.capabilities.hasExternalDisplay && (n.setSwitch(!1),
                t.setNodeMask(0),
                this.getCamera().getRenderer().draw())
            }
        },
        getSupportedFloatTexture: function() {
            var t = y.WebGLCaps.instance();
            return t.hasLinearHalfFloatRTT() ? y.Texture.HALF_FLOAT : t.hasHalfFloatRTT() ? y.Texture.HALF_FLOAT : t.hasLinearFloatRTT() ? y.Texture.FLOAT : t.hasFloatRTT() ? y.Texture.FLOAT : y.Texture.UNSIGNED_BYTE
        },
        initSceneGraph: function() {
            var t = this._uniforms;
            this._nodeIn = new y.Node,
            this._nodeIn.setName("PostProcess - node In"),
            this._nodeIn.addUpdateCallback(this);
            var e = this._nodeIn.getOrCreateStateSet();
            e.addUniform(t.uOutputLinear),
            e.addUniform(t.uRGBMRange),
            e.addUniform(t.uPixelRatio),
            e.addUniform(h.getDrawOpaqueUniform()),
            e.addUniform(t.uNearFar),
            e.addUniform(t.uDofBlurNearFarFocal),
            e.addUniform(t.uTime),
            this._nodeOut = new y.Node,
            this._nodeOut.setName("PostProcess - node Out"),
            this._camera = this.createMainCamera(),
            this._nodeIn.addChild(this._camera),
            this._camera.addChild(this._nodeOut)
        },
        isEffectiveGrain: function() {
            return !this.model.get("webVR") && this.model.get("grainEnable") && this.model.get("grainFactor") >= 5e-4
        },
        isEffectiveSharpen: function() {
            return !this.model.get("webVR") && this.model.get("sharpenEnable") && this.model.get("sharpenFactor") >= 5e-4
        },
        isEffectiveChromaticAberration: function() {
            return !this.model.get("webVR") && this.model.get("chromaticAberrationEnable") && this.model.get("chromaticAberrationFactor") >= .001
        },
        isEffectiveVignette: function() {
            return !this.model.get("webVR") && this.model.get("vignetteEnable") && this.model.get("vignetteLens")[1] <= .5 * Math.sqrt(2)
        },
        isEffectiveBloom: function() {
            return (!this.model.get("webVR") || !m.any) && this.model.get("bloomEnable") && this.model.get("bloomFactor") >= .01
        },
        isEffectiveToneMapping: function() {
            return this.model.get("toneMappingEnable")
        },
        isEffectiveColorBalance: function() {
            return this.model.get("colorBalanceEnable")
        },
        isEffectiveDof: function() {
            return !this.model.get("webVR") && this.model.get("dofEnable") && (this.model.get("dofBlurNear") >= .01 || this.model.get("dofBlurFar") >= .01)
        },
        checkGrainEnable: function() {
            this._effectiveConfig.useGrain !== this.isEffectiveGrain() && this.dirty()
        },
        checkSharpenEnable: function() {
            this._effectiveConfig.useSharpen !== this.isEffectiveSharpen() && this.dirty()
        },
        checkChromaticAberrationEnable: function() {
            this._effectiveConfig.useChromaticAberration !== this.isEffectiveChromaticAberration() && this.dirty()
        },
        checkVignetteEnable: function() {
            this._effectiveConfig.useVignette !== this.isEffectiveVignette() && this.dirty()
        },
        checkBloomEnable: function() {
            this._effectiveConfig.useBloom !== this.isEffectiveBloom() && this.dirty()
        },
        checkDofEnable: function() {
            this._effectiveConfig.useDof !== this.isEffectiveDof() && this.dirty()
        },
        onDistortionChanged: function() {
            this._uniforms.uDistortion.setFloat2(this.model.get("distortion"))
        },
        onProjectionLeftChanged: function() {
            this._uniforms.uProjectionLeft.setFloat4(this.model.get("projectionLeft"))
        },
        onUnprojectionLeftChanged: function() {
            this._uniforms.uUnprojectionLeft.setFloat4(this.model.get("unprojectionLeft"))
        },
        onGrainFactor: function() {
            this._uniforms.uGrainFactor.setFloat(this.model.get("grainFactor")),
            this.checkGrainEnable()
        },
        onSharpenFactor: function() {
            this._uniforms.uSharpFactor.setFloat(this.model.get("sharpenFactor")),
            this.checkSharpenEnable()
        },
        onChromaticAberrationFactor: function() {
            this._uniforms.uChromaFactor.setFloat(this.model.get("chromaticAberrationFactor")),
            this.checkChromaticAberrationEnable()
        },
        onVignetteLensChanged: function() {
            this._uniforms.uLensRadius.setFloat2(this.model.get("vignetteLens")),
            this.checkVignetteEnable()
        },
        onBloomFactorChanged: function() {
            this._uniforms.uBloomFactor.setFloat(this.model.get("bloomFactor")),
            this.checkBloomEnable()
        },
        onBloomThresholdChanged: function() {
            this._uniforms.uBloomThreshold.setFloat(this.model.get("bloomThreshold")),
            this.checkBloomEnable()
        },
        onBloomRadiusChanged: function() {
            this._uniforms.uBloomRadius.setFloat(this.model.get("bloomRadius")),
            this.checkBloomEnable()
        },
        onColorBalanceShiftChanged: function() {
            this._uniforms.uColorBalanceLow.setFloat3(this.model.get("colorBalanceLow")),
            this._uniforms.uColorBalanceMid.setFloat3(this.model.get("colorBalanceMid")),
            this._uniforms.uColorBalanceHigh.setFloat3(this.model.get("colorBalanceHigh"))
        },
        onToneMappingExposureChanged: function() {
            this._uniforms.uToneExposure.setFloat(this.model.get("toneMappingExposure"))
        },
        onToneMappingBrightnessChanged: function() {
            this._uniforms.uToneBrightness.setFloat(this.model.get("toneMappingBrightness"))
        },
        onToneMappingContrastChanged: function() {
            this._uniforms.uToneContrast.setFloat(this.model.get("toneMappingContrast"))
        },
        onToneMappingSaturationChanged: function() {
            this._uniforms.uToneSaturation.setFloat(this.model.get("toneMappingSaturation"))
        },
        onToneMappingMethodChanged: function() {
            this._uniforms.uToneMethod.setInt(this.methodToInt(this.model.get("toneMappingMethod")))
        },
        computeFocalDistance: function() {
            var t = y.Vec4.create();
            return function() {
                var e = this.model.get("dofFocusPoint");
                y.Vec3.copy(e, t)[3] = 1;
                var i = this._viewer.getCamera();
                y.Matrix.transformVec4(i.getViewMatrix(), t, t),
                y.Matrix.transformVec4(i.getProjectionMatrix(), t, t);
                var n = this._uniforms.uNearFar.getInternalArray();
                return (t[3] - n[0]) / (n[1] - n[0])
            }
        }(),
        showDofCross: function() {
            this._interpolatorDofCross.getCurrent()[0] = 1,
            this._interpolatorDofCross.setTarget(0),
            y.Vec3.copy(this.model.get("dofFocusPoint"), this._dofLastPos),
            this._dofLastFocal = this._interpolatorDofFocal.getCurrent()[0],
            l.draw()
        },
        onDofFocusPoint: function() {
            this._interpolatorDofFocal.setTarget(this.computeFocalDistance()),
            this.showDofCross(),
            this._dofAutoFocus = !1
        },
        onDofBlurNear: function() {
            this._interpolatorDofBlurNear.setTarget(this.model.get("dofBlurNear")),
            this.checkDofEnable()
        },
        onDofBlurFar: function() {
            this._interpolatorDofBlurFar.setTarget(this.model.get("dofBlurFar")),
            this.checkDofEnable()
        },
        getOrCreateTextureRTT: function(t, e, i, n) {
            e = e || "default",
            t = t || 1,
            n = n || y.Texture.UNSIGNED_BYTE,
            i = i || y.Texture.NEAREST;
            var r = Math.max(1, Math.round(this._viewerOSGJS.getCanvasWidth() / t))
              , a = Math.max(1, Math.round(this._viewerOSGJS.getCanvasHeight() / t))
              , s = e + t + "_" + n + "_" + i
              , o = this._texturesRTT[s];
            return o ? (o.setTextureSize(r, a),
            o) : (o = this._texturesRTT[s] = new y.Texture,
            o.setInternalFormatType(n),
            o.setTextureSize(r, a),
            o.setInternalFormat(y.Texture.RGBA),
            o.setMinFilter(i),
            o.setMagFilter(i),
            o.setName(s),
            o.divisor = t,
            o)
        },
        getOrCreateTextureOpaque: function(t) {
            return this.getOrCreateTextureRTT(1, "opaque", t)
        },
        getOrCreateTextureTransparent: function() {
            return this.getOrCreateTextureRTT(1, "transparent", y.Texture.NEAREST, this.getSupportedFloatTexture())
        },
        getOrCreateTextureDepth: function() {
            return this.getOrCreateTextureRTT(1, "depth", y.Texture.NEAREST)
        },
        getOrCreateTextureExtra: function() {
            return this.getOrCreateTextureRTT(1, "extra")
        },
        createMainCamera: function() {
            var t = new y.Camera;
            return t.setName("PostProcess - MainCamera"),
            t.setRenderOrder(y.Camera.PRE_RENDER, 0),
            t.getOrCreateStateSet().addUniform(this._uniforms.uRenderSize),
            t.attachRenderBuffer(y.FrameBufferObject.DEPTH_ATTACHMENT, y.FrameBufferObject.DEPTH_COMPONENT16),
            t
        },
        createCameraAA: function(t, e) {
            var i = new y.Camera;
            return i.setName(t),
            i.setRenderOrder(y.Camera.PRE_RENDER, 0),
            i.attachTexture(y.FrameBufferObject.COLOR_ATTACHMENT0, e),
            i.setClearMask(0),
            i
        },
        createFilter: function(t, e, i, n) {
            t = t || {};
            var r = new s([],[],o.getShaderProcessor());
            r.setPostProcessConfiguration(t);
            var a = n || new S.Composer.Filter.Custom(r.createFragmentShader(),e);
            return i && a.setVertexShader(i),
            a
        },
        addCompositeBackground: function(t, e) {
            "fixed" === this._backgroundModel.getEnableType() && (t.useComposeBackground = !0,
            e.TextureFixed = this._nodeBackground.getBackground() || g.dummyTexture,
            e.TextureFixed.divisor = -1,
            e.uFixedScale = this._nodeBackground.getUniforms().scale,
            e.TextureDepth = this._camera._textureDepth)
        },
        addMergeOpacityPass: function(t, e) {
            var i = {
                isPassMergeOpacity: !0,
                RGBMTexture0: M,
                RGBMTextureTransparent: void 0,
                encodeRGBM: e.outputInSRGB ? null : M
            }
              , n = {
                uOutputLinear: y.Uniform.createInt(e.outputInSRGB ? 0 : 1, "uOutputLinear"),
                Texture0: e.inputTexture,
                TextureTransparent: this._camera._textureTransparent
            };
            e.composeBackground && this.addCompositeBackground(i, n);
            var r = this.getOrCreateTextureRTT(1, "mergeableOpacity", e.outputFiltering)
              , a = t.addPass(this.createFilter(i, n), r);
            return a.setFragmentName("MergeOpacity"),
            e.composeBackground && (this._stateSetCompositeBG = a.getStateSet()),
            r
        },
        getPackFunc: function(t) {
            return ["vec4 pack( const in vec4 col ) {", "    vec4 rgbm;", "    vec3 color = col.rgb / " + t + ";", "    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );", "    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;", "    rgbm.rgb = color / rgbm.a;", "    return rgbm;", "}"].join("\n")
        },
        getUnpackFunc: function(t) {
            return ["vec4 unpack( const in sampler2D tex, const in vec2 uv ) {", "    vec4 col = texture2D(tex, uv);", "    return vec4(" + t + " * col.rgb * col.a, 1.0);", "}"].join("\n");
        },
        updateDofScaleUniform: function() {
            var t = c().dofRes || 2 * this.getPixelRatio();
            this._uniforms.uDofScale.getInternalArray()[0] = .0015 * this._viewerOSGJS._canvasHeight / t
        },
        addDofPass: function(t, e) {
            this.updateDofScaleUniform();
            var i = this.getSupportedFloatTexture() === y.Texture.HALF_FLOAT
              , n = c().dofRes || 2 * this.getPixelRatio()
              , r = this._uniforms.uDofScale
              , a = {
                isPassDofDownsampleCoC: !0
            }
              , s = {
                TextureDepth: this._camera._textureDepth,
                uDofScale: r
            }
              , o = this.getOrCreateTextureRTT(n, "dofCoC", y.Texture.NEAREST)
              , u = t.addPass(this.createFilter(a, s), o);
            u.setFragmentName("DofDownsampleCoC"),
            a = {
                isPassDofDilateNearH: !0
            },
            s = {
                TextureCoC: o,
                TextureDepth: this._camera._textureDepth,
                uDofScale: r
            };
            var l = this.getOrCreateTextureRTT(n, "dofTmpCoCOrBlurred", y.Texture.NEAREST);
            u = t.addPass(this.createFilter(a, s), l),
            u.setFragmentName("DofNearDilateH"),
            a = {
                isPassDofDilateNearV: !0
            },
            s = {
                TextureCoC: l,
                TextureDepth: this._camera._textureDepth,
                uDofScale: r
            };
            var h = o;
            u = t.addPass(this.createFilter(a, s), h),
            u.setFragmentName("DofNearDilateV");
            var d;
            a = {
                isPassDofDownsampleColor: !0,
                colorWithCoC: i
            },
            s = {
                TextureColor: e.inputTexture
            },
            i && (s.TextureCoC = h),
            d = this.getOrCreateTextureRTT(n, "dofDownsampleColor", y.Texture.NEAREST, i ? y.Texture.HALF_FLOAT : y.Texture.UNSIGNED_BYTE),
            u = t.addPass(this.createFilter(a, s), d),
            u.setFragmentName("DofDownsampleColor"),
            a = {
                isPassDofBlurCircular: !0,
                colorWithCoC: i
            },
            s = {
                TextureColor: d,
                uDofScale: r
            },
            i || (s.TextureCoC = h);
            var p = l;
            u = t.addPass(this.createFilter(a, s), p),
            u.setFragmentName("DofBlurCircular"),
            a = {
                isPassDofCombine: !0,
                RGBMTexture0: M,
                RGBMTexture1: M,
                RGBMTexture2: M,
                encodeRGBM: e.outputInSRGB ? null : M
            },
            s = {
                uDofBlurNearFarFocal: this._uniforms.uDofBlurNearFarFocal,
                uOutputLinear: y.Uniform.createInt(e.outputInSRGB ? 0 : 1, "uOutputLinear"),
                Texture0: e.inputTexture,
                TextureBlurred: p,
                TextureCoCDilated: h,
                TextureDepth: this._camera._textureDepth,
                uDofScale: r
            },
            e.composeBackground && this.addCompositeBackground(a, s);
            var f = this.getOrCreateTextureRTT(1, "dof", e.outputFiltering);
            return u = t.addPass(this.createFilter(a, s), f),
            u.setFragmentName("DofCombine"),
            e.composeBackground && (this._stateSetCompositeBG = u.getStateSet()),
            f
        },
        addBloomPass: function(t, e) {
            var i = this.getPackFunc(C.toExponential())
              , n = this.getUnpackFunc(C.toExponential())
              , r = y.Texture.LINEAR
              , a = "none" !== this._backgroundModel.getEnableType()
              , s = {
                isPassBright: !0,
                RGBMTexture0: M,
                encodeRGBM: C,
                testDepthBloom: a
            }
              , o = {
                uBloomThreshold: this._uniforms.uBloomThreshold,
                uOutputLinear: y.Uniform.createInt(1, "uOutputLinear"),
                Texture0: e.inputTexture
            };
            s && (o.TextureDepth = this._camera._textureDepth);
            var u = t.addPass(this.createFilter(s, o), this.getOrCreateTextureRTT(1, "bloom", r));
            u.setFragmentName("BloomExtractBright");
            var l = 2 * this.getPixelRatio()
              , c = 2 * l
              , h = 2 * c
              , d = 2 * h
              , p = 2 * d
              , f = this._isOnMobile ? void 0 : this.getOrCreateTextureRTT(l, "blurH", r)
              , g = this.getOrCreateTextureRTT(c, "blurH", r)
              , m = this.getOrCreateTextureRTT(h, "blurH", r)
              , v = this.getOrCreateTextureRTT(d, "blurH", r)
              , _ = this._isOnMobile ? void 0 : this.getOrCreateTextureRTT(p, "blurH", r);
            this._isOnMobile || (t.addPass(new S.Composer.Filter.VBlur(3,(!0),n,i), this.getOrCreateTextureRTT(l, "blurV", r)),
            t.addPass(new S.Composer.Filter.HBlur(3,(!0),n,i), f)),
            t.addPass(new S.Composer.Filter.VBlur(5,(!0),n,i), this.getOrCreateTextureRTT(c, "blurV", r)),
            t.addPass(new S.Composer.Filter.HBlur(5,(!0),n,i), g),
            t.addPass(new S.Composer.Filter.VBlur(7,(!0),n,i), this.getOrCreateTextureRTT(h, "blurV", r)),
            t.addPass(new S.Composer.Filter.HBlur(7,(!0),n,i), m),
            t.addPass(new S.Composer.Filter.VBlur(9,(!0),n,i), this.getOrCreateTextureRTT(d, "blurV", r)),
            t.addPass(new S.Composer.Filter.HBlur(9,(!0),n,i), v),
            this._isOnMobile || (t.addPass(new S.Composer.Filter.VBlur(11,(!0),n,i), this.getOrCreateTextureRTT(p, "blurV", r)),
            t.addPass(new S.Composer.Filter.HBlur(11,(!0),n,i), _));
            var b = {
                isPassAdditive: !0,
                isOnMobile: this._isOnMobile,
                RGBMTexture0: M,
                RGBMTexture1: C,
                RGBMTexture2: C,
                RGBMTexture3: C,
                RGBMTexture4: C,
                RGBMTexture5: C,
                encodeRGBM: e.outputInSRGB ? null : M
            }
              , x = {
                uBloomFactor: this._uniforms.uBloomFactor,
                uBloomRadius: this._uniforms.uBloomRadius,
                uOutputLinear: y.Uniform.createInt(e.outputInSRGB ? 0 : 1, "uOutputLinear"),
                Texture0: e.inputTexture,
                Texture1: f,
                Texture2: g,
                Texture3: m,
                Texture4: v,
                Texture5: _
            };
            e.composeBackground && this.addCompositeBackground(b, x);
            var A = this.getOrCreateTextureRTT(1, "bloom", e.outputFiltering);
            return u = t.addPass(this.createFilter(b, x), A),
            u.setFragmentName("BloomMergeAdditive"),
            e.composeBackground && (this._stateSetCompositeBG = u.getStateSet()),
            A
        },
        addMergeablePass: function(t, e) {
            var i = this._effectiveConfig
              , n = {
                isPassMergeable: !0,
                useChromaticAberration: i.useChromaticAberration,
                useVignetteMergeable: i.useVignetteMergeable,
                useToneMapping: i.useToneMapping,
                useColorBalance: i.useColorBalance,
                RGBMTexture0: M
            }
              , r = {
                uOutputLinear: y.Uniform.createInt(e.outputInSRGB ? 0 : 1, "uOutputLinear"),
                Texture0: e.inputTexture
            };
            e.composeBackground && this.addCompositeBackground(n, r),
            n.useChromaticAberration && (r.uChromaFactor = this._uniforms.uChromaFactor),
            n.useVignetteMergeable && (r.uLensRadius = this._uniforms.uLensRadius),
            n.useToneMapping && (r.uToneExposure = this._uniforms.uToneExposure,
            r.uToneBrightness = this._uniforms.uToneBrightness,
            r.uToneContrast = this._uniforms.uToneContrast,
            r.uToneSaturation = this._uniforms.uToneSaturation,
            r.uToneMethod = this._uniforms.uToneMethod),
            n.useColorBalance && (r.uColorBalanceLow = this._uniforms.uColorBalanceLow,
            r.uColorBalanceMid = this._uniforms.uColorBalanceMid,
            r.uColorBalanceHigh = this._uniforms.uColorBalanceHigh);
            var a = this.getOrCreateTextureRTT(1, "mergeable", e.outputFiltering)
              , s = t.addPass(this.createFilter(n, r), a);
            return s.setFragmentName("PostProcessMergeable"),
            e.composeBackground && (this._stateSetCompositeBG = s.getStateSet()),
            a
        },
        addDistortionVR: function(t, e) {
            var i = this._camera
              , n = {
                isPassDistortionVR: !0,
                RGBMTexture0: null,
                useTextureExtra: !!i._textureExtra,
                encodeRGBM: null
            }
              , r = {
                uOutputLinear: y.Uniform.createInt(1, "uOutputLinear"),
                Texture0: e.inputTexture,
                TextureExtra: this._camera._textureExtra,
                uDistortion: this._uniforms.uDistortion,
                uProjectionLeft: this._uniforms.uProjectionLeft,
                uUnprojectionLeft: this._uniforms.uUnprojectionLeft
            }
              , a = this.getOrCreateTextureRTT(1, "distortion", y.Texture.LINEAR)
              , s = t.addPass(this.createFilter(n, r), a);
            return s.setFragmentName("DistortionVR"),
            a
        },
        addSuperSamplePass: function(t) {
            var e = this._camera
              , i = this._backgroundModel.getEnableType()
              , n = "none" !== i
              , r = this._effectiveConfig.useSharpen
              , a = this._effectiveConfig.useVignetteSuperSample
              , u = {
                isPassSuperSample: !0,
                background: i,
                useAntiAlias: n && this._hasTriangles,
                useSharpen: r,
                useVignetteSuperSample: a,
                useTextureExtra: !!e._textureExtra,
                testDepthSharpen: r && n,
                RGBMTexture0: null,
                encodeRGBM: null
            }
              , l = this.getOrCreateTextureRTT(1, "Antialias2", y.Texture.LINEAR)
              , c = this.createCameraAA("Antialias2", l)
              , h = this.getOrCreateTextureRTT(1, "Antialias1", y.Texture.LINEAR)
              , d = this.createCameraAA("Antialias1", h)
              , p = {
                uOutputLinear: y.Uniform.createInt(1, "uOutputLinear")
            };
            r && (p.uSharpFactor = this._uniforms.uSharpFactor),
            a && (p.uLensRadius = this._uniforms.uLensRadius);
            var f = d.getOrCreateStateSet()
              , g = c.getOrCreateStateSet()
              , m = 2;
            !u.testDepthSharpen && n || this.addTextureToPingPong(f, g, m++, "TextureDepth", e._textureDepth),
            u.useTextureExtra && this.addTextureToPingPong(f, g, m++, "TextureExtra", e._textureExtra);
            var v = this._viewer.getSuperSample();
            v.canBeEnabled() && v.setCanBeEnabled(n);
            var _ = new s([],[],o.getShaderProcessor());
            _.setPostProcessConfiguration(u),
            this._antialiasFilter = new S.Composer.Filter.PingPong(d,h,c,l,_.createFragmentShader(),p),
            this._antialiasFilter.setFragmentName("Antialias"),
            t.addPass(this._antialiasFilter),
            this.addFinalPass(t)
        },
        addTextureToPingPong: function(t, e, i, n, r) {
            t.addUniform(y.Uniform.createInt(i, n)),
            e.addUniform(y.Uniform.createInt(i, n)),
            t.setTextureAttributeAndModes(i, r),
            e.setTextureAttributeAndModes(i, r)
        },
        addFinalPass: function(t) {
            var e = {}
              , i = [];
            this._effectiveConfig.useGrain && (e.uGrainFactor = this._uniforms.uGrainFactor,
            e.uTimeGrain = this._uniforms.uTimeGrain,
            i.push("#define GRAIN")),
            this._effectiveConfig.useDof && (e.uDofCross = this._uniforms.uDofCross,
            i.push("#define DOF_CROSS"));
            var n = o.getShaderProcessor().getShader("postProcess-pingpong.frag", i)
              , r = new S.Composer.Filter.Custom(n,e);
            r.setFragmentName("PassTroughFinal"),
            t.addPass(r)
        },
        addAntiAliasPassVR: function(t, e) {
            var i = {
                isPassFinalPassVR: !0,
                useAntiAlias: !!this._hasTriangles,
                hasBackground: !0,
                RGBMTexture0: null,
                encodeRGBM: null
            }
              , n = y.Uniform.createFloat(0, "uVrFadeFactor");
            this._uVrFadeFactor = n.getInternalArray();
            var r = {
                uOutputLinear: y.Uniform.createInt(1, "uOutputLinear"),
                Texture0: e.inputTexture,
                uVrFadeFactor: n
            };
            if (!this.model.get("doDistortionVR")) {
                var a = this._camera;
                i.useTextureExtra = !!a._textureExtra,
                r.TextureExtra = this._camera._textureExtra
            }
            var s = t.addPass(this.createFilter(i, r));
            s.setFragmentName("AntiAliasVR")
        },
        onPingPongTexture0: function(t) {
            this._antialiasFilter && (this._antialiasFilter._cameraRtt0.setNodeMask(t ? -1 : 0),
            this._antialiasFilter._cameraRtt1.setNodeMask(t ? 0 : -1))
        },
        updateEffectiveConfig: function() {
            var t = this._effectiveConfig
              , e = this.model.get("enable");
            t.useTransparency = a.get("hasTransparency") || this.model.get("webVR") || f(),
            t.useDof = e && this.isEffectiveDof(),
            t.useBloom = e && this.isEffectiveBloom(),
            t.useGrain = e && this.isEffectiveGrain(),
            t.useSharpen = e && this.isEffectiveSharpen(),
            t.useChromaticAberration = e && this.isEffectiveChromaticAberration(),
            t.useToneMapping = e && this.isEffectiveToneMapping(),
            t.useColorBalance = e && this.isEffectiveColorBalance(),
            t.hasPassMergeable = t.useChromaticAberration || t.useToneMapping || t.useColorBalance;
            var i = this._backgroundModel.getEnableType();
            "fixed" !== i || t.hasPassMergeable || t.useBloom || t.hasTransparency || (t.hasPassMergeable = !0),
            t.useVignette = e && this.isEffectiveVignette();
            var n = t.hasPassMergeable && ("environment" === i || "color" === i);
            return t.useVignetteMergeable = n && t.useVignette,
            t.useVignetteSuperSample = !n && t.useVignette,
            this._effectiveConfig
        },
        needDepthTexture: function() {
            if (f())
                return !0;
            var t = this._effectiveConfig;
            if (t.useDof || t.useBloom || t.useSharpen)
                return !0;
            if (this._viewer.getFeatures().hotspot.getModel().get("hotspots").length > 0)
                return !0;
            var e = this._backgroundModel.getEnableType();
            return "none" === e || "fixed" === e || this.model.get("webVR")
        },
        needExtraTexture: function() {
            return a.get("hasExtra") || this.model.get("webVR")
        },
        createComposer: function() {
            var t = this.updateEffectiveConfig()
              , e = !(t.useTransparency || t.useDof || t.useBloom || t.hasPassMergeable)
              , i = this._camera
              , n = i._textureOpaque = this.getOrCreateTextureOpaque(e ? y.Texture.LINEAR : y.Texture.NEAREST);
            i._textureExtra = this.needExtraTexture() ? this.getOrCreateTextureExtra() : void 0,
            i._textureTransparent = t.useTransparency ? this.getOrCreateTextureTransparent() : void 0,
            i._textureDepth = this.needDepthTexture() ? this.getOrCreateTextureDepth() : void 0;
            var r = new S.Composer
              , a = r.addPass(new S.Composer.Filter.InputTexture(n));
            a.setFragmentName("InputTexture");
            var s = {
                inputTexture: n,
                inputInSRGB: e,
                outputFiltering: y.Texture.LINEAR,
                outputInSRGB: !0
            };
            return this._uniforms.uOutputLinear.setInt(e ? 0 : 1),
            this._uniforms.uRGBMRange.setFloat(e ? -1 : M),
            this.onBackgroundColor(),
            e || (t.useTransparency && (s.outputInSRGB = s.composeBackground = !t.useDof && !t.useBloom && !t.hasPassMergeable,
            s.outputFiltering = !t.useBloom && !t.hasPassMergeable || t.useDof ? y.Texture.LINEAR : y.Texture.NEAREST,
            s.inputTexture = this.addMergeOpacityPass(r, s)),
            t.useDof && (s.outputInSRGB = s.composeBackground = !t.useBloom && !t.hasPassMergeable,
            s.outputFiltering = t.useBloom || t.hasPassMergeable ? y.Texture.NEAREST : y.Texture.LINEAR,
            s.inputTexture = this.addDofPass(r, s)),
            t.useBloom && (s.outputInSRGB = s.composeBackground = !t.hasPassMergeable,
            s.outputFiltering = t.hasPassMergeable ? y.Texture.NEAREST : y.Texture.LINEAR,
            s.inputTexture = this.addBloomPass(r, s)),
            t.hasPassMergeable && (s.outputInSRGB = s.composeBackground = !0,
            s.outputFiltering = y.Texture.LINEAR,
            s.inputTexture = this.addMergeablePass(r, s))),
            this.model.get("webVR") ? (this.model.get("doDistortionVR") && (s.inputTexture = this.addDistortionVR(r, s)),
            this.addAntiAliasPassVR(r, s)) : this.addSuperSamplePass(r),
            r.renderToScreen(this._viewerOSGJS.getCanvasWidth(), this._viewerOSGJS.getCanvasHeight()),
            r.build(),
            r
        },
        resetCameraAttachments: function() {
            var t = this._camera;
            t.resetAttachments(),
            t.frameBufferObjectOpaque && (t.frameBufferObjectOpaque.reset(),
            t.frameBufferObjectOpaque = void 0),
            t.frameBufferObjectTransparent && (t.frameBufferObjectTransparent.reset(),
            t.frameBufferObjectTransparent = void 0),
            t.frameBufferObjectDepth && (t.frameBufferObjectDepth.reset(),
            t.frameBufferObjectDepth = void 0),
            t.frameBufferObjectExtra && (t.frameBufferObjectExtra.reset(),
            t.frameBufferObjectExtra = void 0),
            t.attachRenderBuffer(y.FrameBufferObject.DEPTH_ATTACHMENT, y.FrameBufferObject.DEPTH_COMPONENT16)
        },
        createPathStandard: function() {
            var t = this.createComposer();
            t.setNodeMask(u.NO_PICK_NO_SHADOW),
            t.setName("PostProcess - Composer"),
            this.resetCameraAttachments();
            var e = this._nodeIn;
            if (2 === e.getChildren().length && e.removeChild(e.getChildren()[1]),
            e.addChild(t),
            c().stats) {
                for (var i = !this.model.get("webVR"), n = h.getTimerGPU(), r = t.getChildren(), a = r.length, s = 0; s < a; ++s) {
                    var o = r[s]
                      , l = o.getName();
                    !i || s !== a - 3 && s !== a - 2 || (l = "Antialias"),
                    o.setInitialDrawCallback(n.start.bind(n, l)),
                    o.setFinalDrawCallback(n.end.bind(n, l))
                }
                r[a - 1].setRenderOrder(y.Camera.POST_RENDER, 0),
                this._camera.setFinalDrawCallback(function() {
                    n.start("PostProcess")
                });
                var d = this._viewerOSGJS.getCamera();
                d.setInitialDrawCallback(n.start.bind(n, "Total GL")),
                d.setFinalDrawCallback(function() {
                    n.end("PostProcess"),
                    n.end("Total GL")
                })
            }
        },
        onVR: function() {
            var t = this.model.get("webVR")
              , e = this._viewer.getSuperSample();
            e.setSwitch(!t),
            e.reset(),
            e.setCanBeEnabled(!t),
            this.dirty()
        },
        onEffectChanged: function() {
            return l.draw(),
            this.updateSizeUniforms(),
            this.createPathStandard()
        },
        onBackgroundUpdated: function(t) {
            if (this._stateSetCompositeBG) {
                var e = this._stateSetCompositeBG.getUniform("TextureFixed");
                e && this._stateSetCompositeBG.setTextureAttributeAndModes(e.getInternalArray()[0], t)
            }
        },
        onBackgroundColor: function() {
            var t = h.getClearColor();
            if ("color" !== this._backgroundModel.getEnableType())
                return void y.Vec4.init(t);
            y.Vec3.copy(this._backgroundModel.getColor(), t),
            t[3] = 1,
            1 === this._uniforms.uOutputLinear.getInternalArray()[0] && p.srgbToLinear(t, t);
            var e = this._uniforms.uRGBMRange.getInternalArray()[0];
            e > 0 && p.encodeRGBM(t, e, t)
        },
        updateGrain: function(t) {
            if (this._effectiveConfig.useGrain && this.model.get("grainAnimated")) {
                this._requestDrawPostProcess = !0;
                var e = t.getSimulationTime()
                  , i = c().grainSpeed / 1e3;
                i > 0 && e - this._lastUpdateTime >= i && (this._uniforms.uTimeGrain.setFloat(e / 1e3),
                this._lastUpdateTime = e)
            }
        },
        updateDof: function(t) {
            if (this.isEffectiveDof()) {
                var e = this._uniforms.uNearFar.getInternalArray();
                if (!(e[0] > e[1])) {
                    var i = this._viewerOSGJS.getManipulator();
                    i.getEyePosition(this._tmpVec3);
                    var n = i.getHomeBound()
                      , r = n.radius()
                      , a = y.Vec3.distance(this._tmpVec3, this._eyePos) / r
                      , s = a >= .01 && c().dofAttenuateSpeed ? 0 : 1
                      , o = i.getHomeDistance(i.getHomeBound());
                    if (c().dofAttenuateDistance) {
                        var l = (y.Vec3.distance(this._tmpVec3, n.center()) - r) / (o - r);
                        s *= Math.max(0, Math.min(1, 1 - l))
                    }
                    this._interpolatorDofBlurNear.setTarget(this.model.get("dofBlurNear") * s),
                    this._interpolatorDofBlurFar.setTarget(this.model.get("dofBlurFar") * s);
                    var h = this._viewer.getFeaturesManager()
                      , p = this._uniforms.uDofCross.getInternalArray();
                    if (d.getFirstCameraAnimation().isFulfilled() && this._dofInitialized) {
                        if (this._dofAutoFocus || a > .01) {
                            var f = this._viewerOSGJS.getCanvasClientWidth()
                              , g = this._viewerOSGJS.getCanvasClientHeight();
                            this._dofAutoFocus = a > 1e-5;
                            var m = this._dofAutoFocus ? u.PICK_GEOMETRY_FAST : u.PICK_GEOMETRY_SLOW
                              , v = h.computeNearestIntersection2D(.5 * f, .5 * g, m);
                            if (v || (v = h.computeNearestIntersection2D(f * p[0], g * p[1], m)),
                            v && (h.getWorldPositionFromHit(v, this.model.get("dofFocusPoint")),
                            this._interpolatorDofFocal.setTarget(this.computeFocalDistance())),
                            y.Vec3.copy(this._tmpVec3, this._eyePos),
                            this._dofAutoFocus)
                                this._interpolatorDofCross.getCurrent()[0] = 0;
                            else {
                                var _ = y.Vec3.distance(this.model.get("dofFocusPoint"), this._dofLastPos)
                                  , b = this._interpolatorDofFocal.getCurrent()[0];
                                _ > .1 * r && Math.abs(b - this._dofLastFocal) > .075 && s > .1 && this.showDofCross()
                            }
                        }
                    } else
                        this._dofInitialized = !0,
                        this._interpolatorDofFocal.setTarget(this.computeFocalDistance()),
                        y.Vec3.copy(this._tmpVec3, this._eyePos);
                    h.getScreenPositionFromWorldPoint(this.model.get("dofFocusPoint"), p),
                    p[0] /= this._viewerOSGJS.getCanvasWidth(),
                    p[1] /= this._viewerOSGJS.getCanvasHeight();
                    var x = t.getDeltaTime();
                    this._interpolatorDofBlurNear.update(x),
                    this._interpolatorDofBlurFar.update(x),
                    this._interpolatorDofFocal.update(x),
                    this._interpolatorDofCross.update(x);
                    var A = this._uniforms.uDofBlurNearFarFocal.getInternalArray();
                    A[0] = this._interpolatorDofBlurNear.getCurrent()[0],
                    A[1] = this._interpolatorDofBlurFar.getCurrent()[0],
                    A[2] = this._interpolatorDofFocal.getCurrent()[0],
                    A[3] = this.model.get("dofQuality") ? 1 : 0,
                    this._uniforms.uDofCross.getInternalArray()[2] = this._interpolatorDofCross.getCurrent()[0],
                    this._interpolatorDofCross.isDone() || (this._requestDrawPostProcess = !0)
                }
            }
        },
        getNewSize: function(t, e) {
            return Math.max(1, Math.round(e / t))
        },
        updateSizeUniforms: function() {
            var t = this._uniforms.uRenderSize.getInternalArray();
            t[0] = this._viewerOSGJS.getCanvasWidth(),
            t[1] = this._viewerOSGJS.getCanvasHeight(),
            this._uniforms.uPixelRatio.setFloat(this.getPixelRatio())
        },
        resizePostProcess: function(t, e, i, n) {
            for (var r = this._nodeIn.getChildren()[1], a = r.getChildren(), s = 0, o = a.length; s < o; ++s) {
                var u = a[s]
                  , c = 1;
                u.isRenderToTextureCamera() && (c = u.getAttachments()[y.FrameBufferObject.COLOR_ATTACHMENT0].texture.divisor,
                c || (y.warn("missing divisor for texture, the rtt texture wasn't created by the postprocess feature!"),
                c = 1));
                var h = this.getNewSize(c, i)
                  , d = this.getNewSize(c, n)
                  , p = u.getStateSet()
                  , f = p.getUniform("RenderSize");
                if (f) {
                    var g = f.getInternalArray();
                    g[0] = h,
                    g[1] = d
                }
                var m = u.getViewport();
                m && m.setViewport(0, 0, h, d);
                for (var v = 0; v < p.getNumTextureAttributeLists(); v++) {
                    var _ = p.getTextureAttribute(v, "Texture");
                    _ && (_.divisor || y.warn("missing divisor for texture, the rtt texture wasn't created by the postprocess feature!"),
                    _.divisor > 0 && _.setTextureSize(this.getNewSize(_.divisor, i), this.getNewSize(_.divisor, n)))
                }
            }
            this.updateSizeUniforms(),
            this.updateDofScaleUniform(),
            l.draw(),
            this.resetCameraAttachments()
        },
        updateDirtyEffect: function() {
            var t = this._viewerOSGJS.getCanvasWidth()
              , e = this._viewerOSGJS.getCanvasHeight();
            if (this._width && this._height || (this._width = this._height = -1),
            t !== this._width || e !== this._height) {
                this._dirty || this.resizePostProcess(this._width, this._height, t, e);
                var i = this._camera;
                i._textureOpaque && i._textureOpaque.setTextureSize(t, e),
                i._textureTransparent && i._textureTransparent.setTextureSize(t, e),
                i._textureDepth && i._textureDepth.setTextureSize(t, e),
                i._textureExtra && i._textureExtra.setTextureSize(t, e),
                this._width = t,
                this._height = e,
                this._dirty || this._viewerOSGJS.frame()
            }
            this._dirty && (this.onEffectChanged(),
            this._dirty = !1)
        },
        updateFade: function(t) {
            var e = this.model.get("vrFading");
            if (this.model.get("vrStartFade") && !e && (this.model.set("vrStartFade", !1),
            e = !0,
            this.model.set("vrFading", !0),
            this.model.set("vrFadeStartTime", t.getSimulationTime())),
            e) {
                var i = this.model.get("vrFadeStartTime")
                  , n = this.model.get("vrFadeLength")
                  , r = t.getSimulationTime()
                  , a = (r - i) / n
                  , s = this.model.get("vrFadeCallback");
                r > i + n && (a = 1 - (a - 1),
                s && (s(),
                this.model.set("vrFadeCallback", void 0))),
                a >= 0 ? this._uVrFadeFactor[0] = a : (this._uVrFadeFactor[0] = 0,
                this.model.set("vrFading", !1))
            }
        },
        update: function(t, e) {
            var i = e.getFrameStamp();
            if (this._viewer.getSuperSample().isEnabled() && this._uniforms.uTime.setFloat(i.getSimulationTime() / 1e3),
            this.model.get("webVR")) {
                var n = this._viewer.getFeatures().webVR.getModel()
                  , r = n.get("worldFactor") / n.get("boundingBox").radius();
                this._camera.setNearFarRatio(r > 0 ? .005 * Math.max(.1, r) : .005)
            } else
                this._camera.setNearFarRatio(.005);
            return this.updateGrain(i),
            this.updateDof(i),
            this._uVrFadeFactor && this.updateFade(i),
            this.updateDirtyEffect(),
            !0
        }
    });
    t.exports = w
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1499)
      , a = i(1665)
      , s = n.osg
      , o = n.osgShader
      , u = o.nodeFactory;
    u.registerNodes(a);
    var l = function() {
        r.apply(this, arguments),
        this.config = {}
    };
    l.prototype = s.objectInherit(r.prototype, {
        getFragmentShaderName: function() {
            return ""
        },
        setPostProcessConfiguration: function(t) {
            this.config = t,
            this._customVertexShader = !0
        },
        createFragmentShaderGraph: function() {
            var t = this.config
              , e = [];
            return t.isPassMergeable ? this.createFragmentMergeable(e) : t.isPassMergeOpacity ? this.createMergeOpacity(e) : t.isPassDofDownsampleCoC ? this.createFragmentDofDownsampleCoC(e) : t.isPassDofDownsampleColor ? this.createFragmentDofDownsampleColor(e) : t.isPassDofDilateNearH || t.isPassDofDilateNearV ? this.createFragmentDofDilateNear(e) : t.isPassDofBlurCircular ? this.createFragmentDofBlurCircular(e) : t.isPassDofCombine ? this.createFragmentDofCombine(e) : t.isPassBright ? this.createFragmentBright(e) : t.isPassAdditive ? this.createFragmentAdditive(e) : t.isPassSuperSample ? this.createFragmentSuperSample(e) : t.isPassDistortionVR ? this.createFragmentDistortionVR(e) : t.isPassFinalPassVR ? this.createFragmentAntiAliasVR(e) : e
        },
        getFetch0x0y0: function() {
            return this._fetch0x0y0 ? this._fetch0x0y0 : (this._fetch0x0y0 = this.textureFetch(this.getOrCreateSampler("sampler2D", "Texture0"), this.getOrCreateVarying("vec2", "vTexCoord0")),
            this._fetch0x0y0)
        },
        createFragmentDistortionVR: function(t) {
            return t.push(this.getFragColor(this.createDistortion())),
            t
        },
        createFragmentAntiAliasVR: function(t) {
            var e = this.config.useAntiAlias ? this.createAntiAlias() : this.getFetch0x0y0();
            return this.config.useTextureExtra && (e = this.createComposeExtra(e, this.createVariable("float").setValue("1.0"))),
            e = this.createFade(e),
            t.push(this.getFragColor(e)),
            t
        },
        createFade: function(t) {
            var e = this.createVariable(t.getType())
              , i = "%outColor = mix( %inColor, %black, clamp(%fadeFactor, 0.0, 1.0) );";
            return this.getNode("InlineCode").code(i).inputs({
                inColor: t,
                fadeFactor: this.getOrCreateUniform("float", "uVrFadeFactor"),
                black: this.getOrCreateConstantZero(t.getType())
            }).outputs({
                outColor: e
            }),
            e
        },
        createMergeOpacity: function(t) {
            var e = this.createVariable("vec3")
              , i = this.textureFetch(this.getOrCreateSampler("sampler2D", "TextureTransparent"), this.getOrCreateVarying("vec2", "vTexCoord0"));
            return this.getNode("InlineCode").code("%outcolor = %opaque.rgb * (1.0 - %transparent.a) + %transparent.rgb;").inputs({
                opaque: this.getFetch0x0y0(),
                transparent: i
            }).outputs({
                outcolor: e
            }),
            t.push(this.getFragColor(e)),
            t
        },
        createFragmentSuperSample: function(t) {
            var e = this.config
              , i = e.useAntiAlias ? this.createAntiAlias() : this.getFetch0x0y0();
            e.useSharpen && (i = this.createSharpen(i));
            var n = "none" === e.background ? this.getOrCreateAlpha() : this.createVariable("float").setValue("1.0");
            return e.useVignetteSuperSample && (n = i = this.createVignette(i, n)),
            e.useTextureExtra && (i = n = this.createComposeExtra(i, n)),
            i = this.createSuperSample(i),
            t.push(this.getFragColor(i, n)),
            t
        },
        createFragmentDofDownsampleCoC: function(t) {
            var e = this.getNode("glFragColor");
            return this.getNode("DofDownsampleCoC").inputs({
                samplerDepth: this.getOrCreateSampler("sampler2D", "TextureDepth"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                dofBlurNearFarFocal: this.getOrCreateUniform("vec4", "uDofBlurNearFarFocal")
            }).outputs({
                color: e
            }),
            t.push(e),
            t
        },
        createFragmentDofDownsampleColor: function(t) {
            var e = this.getNode("glFragColor");
            return this.getNode("DofDownsampleColor").inputs({
                samplerColor: this.getOrCreateSampler("sampler2D", "TextureColor"),
                samplerCoC: this.config.colorWithCoC ? this.getOrCreateSampler("sampler2D", "TextureCoC") : void 0,
                uv: this.getOrCreateVarying("vec2", "vTexCoord0")
            }).outputs({
                color: e
            }),
            t.push(e),
            t
        },
        createFragmentDofDilateNear: function(t) {
            var e = this.getNode("glFragColor");
            return this.getNode("DofDilateNear").setVertical(!!this.config.isPassDofDilateNearV).inputs({
                samplerCoC: this.getOrCreateSampler("sampler2D", "TextureCoC"),
                samplerDepth: this.getOrCreateSampler("sampler2D", "TextureDepth"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                dofScale: this.getOrCreateUniform("float", "uDofScale"),
                dofBlurNearFarFocal: this.getOrCreateUniform("vec4", "uDofBlurNearFarFocal")
            }).outputs({
                color: e
            }),
            t.push(e),
            t
        },
        createFragmentDofBlurCircular: function(t) {
            var e = this.getNode("glFragColor");
            return this.getNode("DofBlurCircular").inputs({
                samplerColor: this.getOrCreateSampler("sampler2D", "TextureColor"),
                samplerCoC: this.getOrCreateSampler("sampler2D", this.config.colorWithCoC ? "TextureColor" : "TextureCoC"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                time: this.getOrCreateUniform("float", "uTime"),
                dofScale: this.getOrCreateUniform("float", "uDofScale"),
                dofBlurNearFarFocal: this.getOrCreateUniform("vec4", "uDofBlurNearFarFocal")
            }).outputs({
                color: e
            }),
            t.push(e),
            t
        },
        createFragmentDofCombine: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("DofCombine").inputs({
                color: this.getFetch0x0y0(),
                samplerBlur: this.getOrCreateSampler("sampler2D", "TextureBlurred"),
                samplerCoC: this.getOrCreateSampler("sampler2D", "TextureCoCDilated"),
                samplerDepth: this.getOrCreateSampler("sampler2D", "TextureDepth"),
                range: this.getOrCreateUniform("float", "uRGBMRange"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                dofScale: this.getOrCreateUniform("float", "uDofScale"),
                dofBlurNearFarFocal: this.getOrCreateUniform("vec4", "uDofBlurNearFarFocal")
            }).outputs({
                color: e
            }),
            t.push(this.getFragColor(e)),
            t
        },
        createFragmentBright: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("ExtractBright").inputs({
                color: this.getFetch0x0y0(),
                threshold: this.getOrCreateUniform("float", "uBloomThreshold"),
                alpha: this.config.testDepthBloom ? this.getOrCreateAlpha() : void 0
            }).outputs({
                color: e
            }),
            t.push(this.getFragColor(e)),
            t
        },
        getFactoredTex: function(t, e, i) {
            var n = this.textureFetch(this.getOrCreateSampler("sampler2D", "Texture" + t), e)
              , r = this.createVariable("vec4");
            return this.getNode("Mult").inputs(n, i || this.createVariable("float").setValue("1.0")).outputs(r),
            r
        },
        getRadiusFactored: function(t, e) {
            var i = this.createVariable("float").setValue(t.toExponential())
              , n = this.createVariable("float").setValue((2 * e - t).toExponential())
              , r = this.createVariable("float");
            return this.getNode("Blend").mode("MIX").inputs(i, n, this.getOrCreateUniform("float", "uBloomRadius")).outputs(r),
            r
        },
        createFragmentAdditive: function(t) {
            var e = this.getOrCreateVarying("vec2", "vTexCoord0")
              , i = this.config.isOnMobile
              , n = []
              , r = i ? 1 : .6;
            i || n.push(this.getFactoredTex(1, e, this.getRadiusFactored(1.1, r))),
            n.push(this.getFactoredTex(2, e, this.getRadiusFactored(i ? 1.5 : .9, r))),
            n.push(this.getFactoredTex(3, e, this.getRadiusFactored(i ? 1 : .6, r))),
            n.push(this.getFactoredTex(4, e, this.getRadiusFactored(i ? .5 : .3, r))),
            i || n.push(this.getFactoredTex(5, e, this.getRadiusFactored(.1, r)));
            var a = this.createVariable("vec4");
            this.getNode("Add").inputs(n).outputs(a);
            var s = this.createVariable("vec4");
            return this.getNode("Blend").mode("ADD").inputs(this.getFetch0x0y0(), a, this.getOrCreateUniform("float", "uBloomFactor")).outputs(s),
            t.push(this.getFragColor(s)),
            t
        },
        createFragmentMergeable: function(t) {
            var e, i = this.config;
            return i.useChromaticAberration ? e = this.createChromaticAberration() : (e = this.createVariable("vec3"),
            this.getNode("SetFromNode").inputs(this.getFetch0x0y0()).outputs(e)),
            i.useVignetteMergeable && (e = this.createVignette(e)),
            i.useColorBalance && (e = this.createColorBalance(e)),
            i.useToneMapping && (e = this.createToneMapping(e)),
            t.push(this.getFragColor(e)),
            t
        },
        getFragColor: function(t, e) {
            var i = this.getNode("glFragColor");
            this.config.useComposeBackground && (t = this.createComposeBackgroundFixed(t, this.getOrCreateAlpha()));
            var n = this.getSrgbColor(t);
            return this.config.encodeRGBM ? this.getNode("EncodeRGBM").inputs({
                color: n,
                range: this.createVariable("float").setValue(this.config.encodeRGBM.toExponential())
            }).outputs({
                color: i
            }) : this.getNode("SetAlpha").inputs({
                color: n,
                alpha: e || this.getFetch0x0y0()
            }).outputs({
                color: i
            }),
            i
        },
        createSuperSample: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("SuperSample").inputs({
                color: t,
                sampler: this.getOrCreateSampler("sampler2D", "Texture1"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                halton: this.getOrCreateUniform("vec4", "uHalton")
            }).outputs({
                color: e
            }),
            e
        },
        createComposeExtra: function(t, e) {
            var i = this.createVariable("vec4");
            return this.getNode("ComposeExtra").inputs({
                color: t,
                alpha: e,
                extra: this.textureFetch(this.getOrCreateSampler("sampler2D", "TextureExtra"), this.getOrCreateVarying("vec2", "vTexCoord0"))
            }).outputs({
                color: i
            }),
            i
        },
        createComposeBackgroundColor: function(t, e, i) {
            var n = this.createVariable("vec3");
            return this.getNode("ComposeBackgroundColor").inputs({
                color: t,
                backgroundColor: i || this.getOrCreateUniform("vec3", "uBackgroundColor"),
                alpha: e
            }).outputs({
                color: n
            }),
            n
        },
        createComposeBackgroundFixed: function(t, e) {
            var i = this.createVariable("vec3");
            this.getNode("InlineCode").code("%color = texture2D(%tex, (%uv - 0.5) * %scale + 0.5).rgb;").inputs({
                tex: this.getOrCreateSampler("sampler2D", "TextureFixed"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                scale: this.getOrCreateUniform("vec2", "uFixedScale")
            }).outputs({
                color: i
            });
            var n = this.createVariable("vec3");
            return this.getNode("sRGBToLinear").inputs({
                color: i
            }).outputs({
                color: n
            }),
            this.createComposeBackgroundColor(t, e, n)
        },
        createAntiAlias: function() {
            var t = this.createVariable("vec3");
            return this.getNode("AntiAlias").inputs({
                sampler: this.getOrCreateSampler("sampler2D", "Texture0"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                texSize: this.getOrCreateUniform("vec2", "RenderSize")
            }).outputs({
                color: t
            }),
            t
        },
        createDistortion: function() {
            var t = this.createVariable("vec3");
            return this.getNode("Distortion").inputs({
                sampler: this.getOrCreateSampler("sampler2D", "Texture0"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                distortion: this.getOrCreateUniform("vec2", "uDistortion"),
                projectionLeft: this.getOrCreateUniform("vec4", "uProjectionLeft"),
                unprojectionLeft: this.getOrCreateUniform("vec4", "uUnprojectionLeft"),
                samplerExtra: this.config.useTextureExtra ? this.getOrCreateSampler("sampler2D", "TextureExtra") : void 0
            }).outputs({
                color: t
            }),
            t
        },
        createSharpen: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("Sharpen").inputs({
                color: t,
                sampler: this.getOrCreateSampler("sampler2D", "Texture0"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                factor: this.getOrCreateUniform("float", "uSharpFactor"),
                pixelRatio: this.getOrCreateUniform("float", "uPixelRatio"),
                alpha: this.config.testDepthSharpen ? this.getOrCreateAlpha() : void 0
            }).outputs({
                color: e
            }),
            e
        },
        createToneMapping: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("ToneMapping").inputs({
                color: t,
                exposure: this.getOrCreateUniform("float", "uToneExposure"),
                brightness: this.getOrCreateUniform("float", "uToneBrightness"),
                contrast: this.getOrCreateUniform("float", "uToneContrast"),
                saturation: this.getOrCreateUniform("float", "uToneSaturation"),
                method: this.getOrCreateUniform("int", "uToneMethod")
            }).outputs({
                color: e
            }),
            e
        },
        createColorBalance: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("ColorBalance").inputs({
                color: t,
                lowRGB: this.getOrCreateUniform("vec3", "uColorBalanceLow"),
                midRGB: this.getOrCreateUniform("vec3", "uColorBalanceMid"),
                highRGB: this.getOrCreateUniform("vec3", "uColorBalanceHigh")
            }).outputs({
                color: e
            }),
            e
        },
        createVignette: function(t, e) {
            var i = t;
            if (e) {
                var n = this.createVariable("vec4");
                this.getNode("SetAlpha").inputs({
                    color: t,
                    alpha: e
                }).outputs({
                    color: n
                }),
                i = n
            }
            var r = this.createVariable(i.getType());
            return this.getNode("Vignette").inputs({
                color: i,
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                lens: this.getOrCreateUniform("vec2", "uLensRadius")
            }).outputs({
                color: r
            }),
            r
        },
        createChromaticAberration: function() {
            var t = this.createVariable("vec3");
            return this.getNode("ChromaticAberration").inputs({
                sampler: this.getOrCreateSampler("sampler2D", "Texture0"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                factor: this.getOrCreateUniform("float", "uChromaFactor"),
                range: this.getOrCreateUniform("float", "uRGBMRange")
            }).outputs({
                color: t
            }),
            t
        },
        getOrCreateAlpha: function() {
            var t = this.getVariable("alpha");
            return t ? t : (t = this.createVariable("float", "alpha"),
            this.getNode("TextureAlpha").inputs({
                sampler: this.getOrCreateSampler("sampler2D", "TextureDepth"),
                uv: this.getOrCreateVarying("vec2", "vTexCoord0")
            }).outputs({
                color: t
            }),
            t)
        },
        textureFetch: function(t, e) {
            var i = t.getVariable()
              , n = this.createVariable("vec4");
            this.getNode("TextureRGBA").inputs({
                sampler: t,
                uv: e
            }).outputs({
                color: n
            });
            var r = n
              , a = this.config["RGBM" + i];
            if (a) {
                var s = this.createVariable("vec3");
                this.getNode("DecodeRGBM").inputs({
                    color: n,
                    range: this.createVariable("float").setValue(a.toExponential())
                }).outputs({
                    color: s
                }),
                r = this.createVariable("vec4"),
                this.getNode("SetAlpha").inputs({
                    color: s,
                    alpha: this.createVariable("float").setValue("1.0")
                }).outputs({
                    color: r
                })
            }
            return r
        }
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = n.osgShader
      , s = a.node.BaseOperator
      , o = a.utils
      , u = function() {
        s.apply(this)
    };
    u.prototype = r.objectInherit(s.prototype, {
        validOutputs: ["color"],
        globalFunctionDeclaration: function() {
            return '#pragma include "postProcess.glsl"'
        }
    });
    var l = function(t) {
        return t.getType && "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    }
      , c = function(t) {
        return t.getType && "vec4" === t.getType() ? t.getVariable() + ".a" : t
    }
      , h = function() {
        u.apply(this)
    };
    h.prototype = r.objectInherit(u.prototype, {
        type: "AntiAlias",
        validInputs: ["sampler", "uv", "texSize"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("fxaa", l(this._outputs.color), [t.sampler, t.uv, t.texSize])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "postProcess-antiAlias.glsl"'
        }
    });
    var d = function() {
        u.apply(this)
    };
    d.prototype = r.objectInherit(u.prototype, {
        type: "SuperSample",
        validInputs: ["color", "sampler", "uv", "texSize", "halton"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("supersample", l(this._outputs.color), [l(t.color), t.sampler, t.uv, t.texSize, t.halton])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "postProcess-antiAlias.glsl"'
        }
    });
    var p = function() {
        u.apply(this)
    };
    p.prototype = r.objectInherit(u.prototype, {
        type: "ToneMapping",
        validInputs: ["color", "exposure", "brightness", "contrast", "saturation", "method"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("toneMapping", this._outputs.color, [l(t.color), t.exposure, t.brightness, t.contrast, t.saturation, t.method])
        }
    });
    var f = function() {
        u.apply(this)
    };
    f.prototype = r.objectInherit(u.prototype, {
        type: "ColorBalance",
        validInputs: ["color", "lowRGB", "midRGB", "highRGB"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("colorBalance", this._outputs.color, [l(t.color), t.lowRGB, t.midRGB, t.highRGB])
        }
    });
    var g = function() {
        u.apply(this)
    };
    g.prototype = r.objectInherit(u.prototype, {
        type: "ExtractBright",
        validInputs: ["color", "threshold"],
        computeShader: function() {
            var t = this._inputs
              , e = [l(t.color), t.threshold];
            return t.alpha && e.push(t.alpha),
            o.callFunction("extractBright", this._outputs.color, e)
        }
    });
    var m = function() {
        u.apply(this)
    };
    m.prototype = r.objectInherit(u.prototype, {
        type: "Vignette",
        validInputs: ["color", "uv", "lens"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("vignette", this._outputs.color, [t.color, t.uv, t.lens])
        }
    });
    var v = function() {
        u.apply(this)
    };
    v.prototype = r.objectInherit(u.prototype, {
        type: "ChromaticAberration",
        validInputs: ["sampler", "uv", "factor", "range"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("chromaticAberration", l(this._outputs.color), [t.sampler, t.uv, t.factor, t.range])
        }
    });
    var _ = function() {
        u.apply(this)
    };
    _.prototype = r.objectInherit(u.prototype, {
        type: "Sharpen",
        validInputs: ["color", "sampler", "uv", "texSize", "factor", "pixelRatio"],
        computeShader: function() {
            var t = this._inputs
              , e = [l(t.color), t.sampler, t.uv, t.texSize, t.factor, t.pixelRatio];
            return t.alpha && e.push(t.alpha),
            o.callFunction("sharpen", this._outputs.color, e)
        }
    });
    var b = function() {
        u.apply(this)
    };
    b.prototype = r.objectInherit(u.prototype, {
        type: "ComposeExtra",
        validInputs: ["color", "alpha", "extra"],
        validOutputs: ["color"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("composeExtra", this._outputs.color, [l(t.color), c(t.alpha), t.extra])
        }
    });
    var x = function() {
        u.apply(this)
    };
    x.prototype = r.objectInherit(u.prototype, {
        type: "ComposeBackgroundColor",
        validInputs: ["color", "alpha", "backgroundColor"],
        validOutputs: ["color"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("composeBackgroundColor", this._outputs.color, [l(t.color), c(t.alpha), t.backgroundColor])
        }
    });
    var A = function() {
        u.apply(this)
    };
    A.prototype = r.objectInherit(u.prototype, {
        type: "Distortion",
        validInputs: ["sampler", "uv", "distortion", "projectionLeft", "unprojectionLeft"],
        computeShader: function() {
            var t = this._inputs
              , e = [t.sampler, t.uv, t.distortion, t.projectionLeft, t.unprojectionLeft];
            return t.samplerExtra && e.push(t.samplerExtra),
            o.callFunction("distortion", l(this._outputs.color), e)
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "postProcess-distortion.glsl"'
        }
    });
    var y = function() {
        u.apply(this)
    };
    y.prototype = r.objectInherit(u.prototype, {
        type: "DofDownsampleCoC",
        validInputs: ["samplerDepth", "uv", "dofBlurNearFarFocal"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("dofDownsampleCoC", this._outputs.color, [t.samplerDepth, t.uv, t.dofBlurNearFarFocal])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "dof.glsl"'
        }
    });
    var S = function() {
        u.apply(this)
    };
    S.prototype = r.objectInherit(u.prototype, {
        type: "DofDownsampleColor",
        validInputs: ["samplerColor", "uv"],
        computeShader: function() {
            var t = this._inputs
              , e = [t.samplerColor, t.uv];
            return t.samplerCoC && e.push(t.samplerCoC),
            o.callFunction("dofDownsampleColor", this._outputs.color, e)
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "dof.glsl"'
        }
    });
    var C = function() {
        u.apply(this),
        this._vertical = !1
    };
    C.prototype = r.objectInherit(u.prototype, {
        type: "DofDilateNear",
        validInputs: ["samplerCoC", "samplerDepth", "uv", "texSize", "dofScale", "dofBlurNearFarFocal"],
        setVertical: function(t) {
            return this._vertical = t,
            this
        },
        computeShader: function() {
            var t = this._inputs
              , e = this._vertical ? "V" : "H";
            return o.callFunction("dofDilateNear" + e, this._outputs.color, [t.samplerCoC, t.samplerDepth, t.uv, t.texSize, t.dofScale, t.dofBlurNearFarFocal])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "dof.glsl"'
        }
    });
    var M = function() {
        u.apply(this)
    };
    M.prototype = r.objectInherit(u.prototype, {
        type: "DofBlurCircular",
        validInputs: ["samplerColor", "samplerCoC", "uv", "texSize", "time", "dofScale", "dofBlurNearFarFocal"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("dofBlurCircular", this._outputs.color, [t.samplerColor, t.samplerCoC, t.uv, t.texSize, t.time, t.dofScale, t.dofBlurNearFarFocal])
        },
        getDefines: function() {
            var t = ["#define DOF_TAP(id) ", "ofs = fTaps_Poisson[id];", "ofs = uv + blurDist * vec2(dot(ofs, basis.xy), dot(ofs, basis.zw) );"];
            return this._inputs.samplerColor === this._inputs.samplerCoC ? (t.push("sample = texture2D(texColor, ofs);"),
            t.push("cocWeight = abs(sample.a * 2.0 - 1.0);"),
            t.push("cocWeight *= cocWeight * cocWeight;"),
            t.push("sumcol.rgb += sample.rgb * cocWeight;"),
            t.push("sumcol.a += cocWeight;")) : (t.push("cocWeight = abs(texture2D(texCoC, ofs).a * 2.0 - 1.0);"),
            t.push("cocWeight *= cocWeight * cocWeight;"),
            t.push("sumcol.rgb += decodeRGBM(texture2D(texColor, ofs), 7.0) * cocWeight;"),
            t.push("sumcol.a += cocWeight;")),
            [t.join("")]
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "dof.glsl"'
        }
    });
    var w = function() {
        u.apply(this)
    };
    w.prototype = r.objectInherit(u.prototype, {
        type: "DofCombine",
        validInputs: ["color", "samplerBlur", "samplerCoC", "samplerDepth", "uv", "range", "texSize", "dofScale", "dofBlurNearFarFocal"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("dofCombine", l(this._outputs.color), [l(t.color), t.samplerBlur, t.samplerCoC, t.samplerDepth, t.uv, t.range, t.texSize, t.dofScale, t.dofBlurNearFarFocal])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "dof.glsl"'
        }
    }),
    t.exports = {
        AntiAlias: h,
        SuperSample: d,
        ToneMapping: p,
        ColorBalance: f,
        ExtractBright: g,
        Vignette: m,
        Sharpen: _,
        ChromaticAberration: v,
        ComposeExtra: b,
        ComposeBackgroundColor: x,
        Distortion: A,
        DofDownsampleCoC: y,
        DofDownsampleColor: S,
        DofDilateNear: C,
        DofBlurCircular: M,
        DofCombine: w
    }
}
, function(t, e) {
    t.exports = '#pragma include "functions.glsl"\n\nfloat getLuminance(const in vec3 color) {\n    // http://stackoverflow.com/questions/596216/formula-to-determine-brightness-of-rgb-color\n    const vec3 colorBright = vec3(0.2126, 0.7152, 0.0722);\n    return dot(color, colorBright);\n}\n\nfloat RGBToL(const in vec3 color) {\n    float fmin = min(min(color.r, color.g), color.b);\n    float fmax = max(max(color.r, color.g), color.b);\n    return (fmax + fmin) / 2.0;\n}\n\n// ------- TONE MAPPING ---------\n\nvec3 toneMapping(const in vec3 color, const in float expos, const in float bright, const in float contr, const in float satur, const in int method) {\n    vec3 col = color * expos;\n    float luminance = dot(col * (1.0 + bright), vec3(0.2126, 0.7152, 0.0722));\n    col = mix(vec3(luminance), col * (1.0 + bright), vec3(satur));\n    if (contr > 0.0)\n        col = (col - 0.5) / (1.0 - contr) + 0.5;\n    else if(contr < 0.0)\n        col = (col - 0.5) * (1.0 + contr) + 0.5;\n\n    // simple reinhard and filmic\n    // http://filmicgames.com/archives/190\n    if(method == 1) { // reinhard (on luminance)\n        col /= 1.0 + getLuminance(col);\n    } else if( method == 2) { // filmic\n        vec3 x = max(vec3(0.0), col - 0.004);\n        col = (x * (6.2 * x + 0.5) ) / ( x * (6.2 * x + 1.7) + 0.06);\n        col = pow(col, vec3(2.2)); // filmic curve already encode srgb to linear\n    }\n    return col;\n}\n\n// ------- COLOR BALANCE ---------\n\nvec3 colorBalance(const in vec3 color, const in vec3 lrgb, const in vec3 mrgb, const in vec3 hrgb) {\n    float cLen = length(color);\n    if(cLen < 1e-5)\n        return color;\n\n    // TODO : I have no idea what I am doing, we should use a curve widge\n    float lightness = RGBToL(color);\n    // \'  lightness=(lightness*0.9-1.0)/(lightness*2.0+1.0) +1.0;\n    lightness = (1.5 * lightness) / (lightness + 0.5);\n    // https://github.com/liovch/GPUImage/blob/master/framework/Source/GPUImageColorBalanceFilter\n    float a = 0.25;\n    float b = 0.333;\n    float scale = 0.7;\n    vec3 low = lrgb * clamp((lightness - b) / -a + 0.5, 0.0, 1.0);\n    vec3 mid = mrgb * clamp((lightness - b) / a + 0.5, 0.0, 1.0) * clamp((lightness + b - 1.0) / -a + 0.5, 0.0, 1.0);\n    vec3 high = hrgb * clamp((lightness + b - 1.0) / a + 0.5, 0.0, 1.0);\n    vec3 newColor = max(color + (low + mid + high) * scale, vec3(0.0));\n    // newColor can be negative\n    float len = length(newColor);\n    return len < 1e-5 ? newColor * cLen : newColor * cLen / len;\n}\n\n// ------- BLOOM ---------\n\nvec3 extractBright(const in vec3 color, const in float threshold) {\n    // TODO manage hdr pixel with high frequency? (use derivative??), for now we clamp the extracted pixel :(\n    return clamp(color * clamp(getLuminance(color) - threshold, 0.0, 1.0), 0.0, 1.0);\n}\n\nvec3 extractBright(const in vec3 color, const in float threshold, const in float alpha) {\n    return alpha == 0.0 ? vec3(0.0) : extractBright(color * alpha, threshold);\n}\n\n// ------- VIGNETTE ---------\n\nvec3 vignette(const in vec3 color, const in vec2 uv, const in vec2 lens) {\n    float factor = clamp(smoothstep(lens.x, lens.y, distance(uv, vec2(0.5))), 0.0, 1.0);\n    return color.rgb * factor;\n}\n\n// when applied in the aa/ss pass srgb (no background case, also for performance reason if vignette is the ONLY mergeable postprocess)\n// there is a colorspace conversion to match the exact same vignette behaviour as with the other vignette (mergeable pass)\nvec4 vignette(const in vec4 color, const in vec2 uv, const in vec2 lens) {\n    float factor = clamp(smoothstep(lens.x, lens.y, distance(uv, vec2(0.5))), 0.0, 1.0);\n    return vec4( linearTosRGB(sRGBToLinear(color.rgb) * factor), clamp(color.a + (1.0 - factor), 0.0, 1.0));\n}\n\n// ------- CHROMA ---------\n\nvec3 chromaticAberration(const in sampler2D tex, const in vec2 uv, const in float factor, const in float range) {\n    vec2 dist = uv - 0.5;\n    vec2 offset = factor * dist * length(dist);\n    vec3 col;\n    col.r = decodeRGBM(texture2D(tex, uv - offset), range).r;\n    col.g = decodeRGBM(texture2D(tex, uv), range).g;\n    col.b = decodeRGBM(texture2D(tex, uv + offset), range).b;\n    return col;\n}\n\n// ------- SHARPEN ---------\n\nvec3 sharpen(const in vec3 color, const in sampler2D tex,  const in vec2 uv, const in vec2 texSize, const in float sharp, const in float pixelRatio) {\n    vec4 sw = pixelRatio * vec4(-1.0, 1.0, 1.0, -1.0) / texSize.xxyy;\n\n    // use useAA, 4 texFetch already in cache. perhaps we could cache ourself.\n    vec3 rgbNW = texture2D(tex, uv + sw.xw).rgb;\n    vec3 rgbNE = texture2D(tex, uv + sw.yw).rgb;\n    vec3 rgbSW = texture2D(tex, uv + sw.xz).rgb;\n    vec3 rgbSE = texture2D(tex, uv + sw.yz).rgb;\n\n    return color.rgb + sharp * (4.0 * color.rgb - rgbNW - rgbNE - rgbSW - rgbSE);\n}\n\nvec3 sharpen(const in vec3 color, const in sampler2D tex,  const in vec2 uv, const in vec2 texSize, const in float sharp, const in float pixelRatio, const in float alpha) {\n    if(alpha == 0.0) return color;\n    return sharpen(color, tex, uv, texSize, sharp * alpha, pixelRatio);\n}\n\n// ------- COMPOSITION ---------\n\nvec4 composeExtra(const in vec3 color, const in float alpha, const in vec4 extra) {\n    return extra + vec4(color.rgb, alpha) * (1.0 - extra.a);\n}\n\nvec3 composeBackgroundColor(const in vec3 color, const in float alpha, const in vec3 background) {\n    return color + background * (1.0 - alpha);\n}\n'
}
, function(t, e) {
    t.exports = '\n#pragma include "functions.glsl"\n\n// G3D version of FXAA\n// green (y) as luma\n// Quality 12\nvec3 fxaa(const in sampler2D tex, const in vec2 pos, const in vec2 texSize) {\n\n    vec2 fxaaQualityRcpFrame = 1.0 / texSize.xy;\n    float fxaaQualitySubpix = 0.75;\n    float fxaaQualityEdgeThreshold = 0.125;\n    float fxaaQualityEdgeThresholdMin = 0.0625;\n\n    vec2 posM = pos.xy;\n    vec4 rgbyM = texture2D(tex, posM);\n    float lumaM = rgbyM.y;\n\n    // Swizzler Offseter Util\n    vec4 sw = vec4(-1.0, 1.0, 1.0, -1.0) * fxaaQualityRcpFrame.xxyy;\n\n    float lumaS = texture2D(tex, posM + vec2(0.0, sw.z)).y;\n    float lumaE = texture2D(tex, posM + vec2(sw.y, 0.0)).y;\n    float lumaN = texture2D(tex, posM + vec2(0.0, sw.w)).y;\n    float lumaW = texture2D(tex, posM + vec2(sw.x, 0.0)).y;\n\n    float maxSM = max(lumaS, lumaM);\n    float minSM = min(lumaS, lumaM);\n\n    float maxESM = max(lumaE, maxSM);\n    float minESM = min(lumaE, minSM);\n\n    float maxWN = max(lumaN, lumaW);\n    float minWN = min(lumaN, lumaW);\n\n    float rangeMax = max(maxWN, maxESM);\n    float rangeMin = min(minWN, minESM);\n\n    float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    float range = rangeMax - rangeMin;\n    float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\n    bool earlyExit = range < rangeMaxClamped;\n    if(earlyExit)\n        return rgbyM.rgb;\n\n    float lumaNW = texture2D(tex, posM + sw.xw).y;\n    float lumaSE = texture2D(tex, posM + sw.yz).y;\n    float lumaNE = texture2D(tex, posM + sw.yw).y;\n    float lumaSW = texture2D(tex, posM + sw.xy).y;\n\n    float lumaNS = lumaN + lumaS;\n    float lumaWE = lumaW + lumaE;\n    float subpixRcpRange = 1.0/range;\n    float subpixNSWE = lumaNS + lumaWE;\n    float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    float edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\n    float lumaNESE = lumaNE + lumaSE;\n    float lumaNWNE = lumaNW + lumaNE;\n    float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\n    float lumaNWSW = lumaNW + lumaSW;\n    float lumaSWSE = lumaSW + lumaSE;\n    float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    float edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    float edgeVert = abs(edgeVert3) + edgeVert4;\n\n    float subpixNWSWNESE = lumaNWSW + lumaNESE;\n    float lengthSign = fxaaQualityRcpFrame.x;\n    bool horzSpan = edgeHorz >= edgeVert;\n    float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    float subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\n    float gradientN = lumaN - lumaM;\n    float gradientS = lumaS - lumaM;\n    float lumaNN = lumaN + lumaM;\n    float lumaSS = lumaS + lumaM;\n    bool pairN = abs(gradientN) >= abs(gradientS);\n    float gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\n\n    vec2 posB = posM.xy;\n    vec2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n\n    vec2 posN;\n    posN.x = posB.x - offNP.x;\n    posN.y = posB.y - offNP.y;\n    vec2 posP;\n    posP.x = posB.x + offNP.x;\n    posP.y = posB.y + offNP.y;\n    float subpixD = ((-2.0)*subpixC) + 3.0;\n    float lumaEndN = texture2D(tex, posN).y;\n    float subpixE = subpixC * subpixC;\n    float lumaEndP = texture2D(tex, posP).y;\n\n    if(!pairN) lumaNN = lumaSS;\n    float gradientScaled = gradient * 1.0/4.0;\n    float lumaMM = lumaM - lumaNN * 0.5;\n    float subpixF = subpixD * subpixE;\n    bool lumaMLTZero = lumaMM < 0.0;\n\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    bool doneN = abs(lumaEndN) >= gradientScaled;\n    bool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * 1.5;\n    if(!doneN) posN.y -= offNP.y * 1.5;\n    bool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * 1.5;\n    if(!doneP) posP.y += offNP.y * 1.5;\n\n    if(doneNP) {\n        if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n        if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * 2.0;\n        if(!doneN) posN.y -= offNP.y * 2.0;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * 2.0;\n        if(!doneP) posP.y += offNP.y * 2.0;\n\n        if(doneNP) {\n            if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n            if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * 4.0;\n            if(!doneN) posN.y -= offNP.y * 4.0;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * 4.0;\n            if(!doneP) posP.y += offNP.y * 4.0;\n\n            if(doneNP) {\n                if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n                if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * 12.0;\n                if(!doneN) posN.y -= offNP.y * 12.0;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * 12.0;\n                if(!doneP) posP.y += offNP.y * 12.0;\n\n            }\n\n        }\n\n    }\n\n    float dstN = posM.x - posN.x;\n    float dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n\n    bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    float spanLength = (dstP + dstN);\n    bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    float spanLengthRcp = 1.0/spanLength;\n\n    bool directionN = dstN < dstP;\n    float dst = min(dstN, dstP);\n    bool goodSpan = directionN ? goodSpanN : goodSpanP;\n    float subpixG = subpixF * subpixF;\n    float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    float subpixH = subpixG * fxaaQualitySubpix;\n\n    float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\n    return texture2D(tex, posM).xyz;\n}\n\n// access a linear texture as if a nearest texture\nvec4 textureNearest2D(const in sampler2D tex, const in vec2 uv, const in vec2 texSize)\n{\n  return texture2D(tex, (floor(uv*texSize)+0.5) / texSize, -99999.0);\n}\n\n// static in place amortized supersampling\nvec3 supersample(const in vec3 currFragColor,  const in sampler2D tex, const in vec2 uv, const in vec2 texSize, const in vec4 halton)\n{\n    float haltz = abs(halton.z);\n    if ( haltz == 1.0 ){\n         // jut return the color.\n        return currFragColor.rgb;\n    }\n\n    // same pixel for same projected interpolated vertex on prev frame\n    vec3 accumColorN = textureNearest2D(tex, uv.xy, texSize).rgb;\n\n    // mix frames\n    float lerpFac = 1.0 / halton.w;\n\n    if ( haltz == 3.0 ){\n        // No supersample, crude motion blur by accumulation\n       return mix( currFragColor, accumColorN, lerpFac);\n    }\n\n    // Supsersample, accumulation + jittering\n    // http://en.wikipedia.org/wiki/Moving_average#Cumulative_moving_average\n    // cumulative moving average over frameNum (which starts at 2)\n    // n is previous frame\n    // accumColorN = Accum(n)\n    // return value is accumColor( n +1 )\n    // Accum(n+1) = Accum(n) + ((x(n+1) - Accum(n)) / (n + 1)))\n    // formula above is equal to glsl  mix\n    return mix(accumColorN, currFragColor, lerpFac);\n\n}\n'
}
, function(t, e) {
    t.exports = "// https://github.com/borismus/webvr-boilerplate/blob/master/src/distortion/barrel-distortion-fragment-v2.js\n\nvec2 barrel(const in vec2 v, const in vec4 projection, const in vec4 unprojection, const in vec2 distort) {\n  vec2 w = (v + unprojection.zw) / unprojection.xy;\n  float val = dot(w, w);\n  // float poly = (showCenter == 1 && val < 0.00010) ? 10000.0 : 1.0 + (distort.x + distort.y * val) * val;\n  float poly = 1.0 + (distort.x + distort.y * val) * val;\n  return projection.xy * (poly * w) - projection.zw;\n}\n\nvec2 getDistortUV(const in sampler2D tex, const in vec2 texCoord, const in vec2 distort, const in vec4 projectionLeft, const in vec4 unprojectionLeft) {\n\n  if (abs(texCoord.x - 0.5) < .001) {\n    return vec2(-1.0);\n  }\n\n  vec2 a;\n\n  if (texCoord.x < 0.5){\n    a = barrel(vec2(texCoord.x / 0.5, texCoord.y), projectionLeft, unprojectionLeft, distort);\n  } else {\n    // right projections are shifted and vertically mirrored relative to left\n    const vec3 swi = vec3(1.0, -1.0, 0.0);\n    vec4 projectionRight = (projectionLeft + swi.zzxz) * swi.xxyx;\n    vec4 unprojectionRight = (unprojectionLeft + swi.zzxz) * swi.xxyx;\n    a = barrel(vec2((texCoord.x - 0.5) / 0.5, texCoord.y), projectionRight, unprojectionRight, distort);\n  }\n\n  if (a.x < 0.0 || a.x > 1.0 || a.y < 0.0 || a.y > 1.0) {\n    return vec2(-1.0);\n  } \n\n  return vec2(a.x * 0.5 + (texCoord.x < 0.5 ? 0.0 : 0.5), a.y);\n}\n\nvec3 distortion(const in sampler2D tex, const in vec2 texCoord, const in vec2 distort, const in vec4 projectionLeft, const in vec4 unprojectionLeft, const in sampler2D texExtra) {\n  vec2 distortUV = getDistortUV(tex, texCoord, distort, projectionLeft, unprojectionLeft);\n  if(distortUV.x < 0.0) return vec3(0.0);\n  \n  vec3 color = texture2D(tex, distortUV).rgb;\n  vec4 extra = texture2D(texExtra, distortUV);\n  return extra.rgb + color.rgb * (1.0 - extra.a);\n}\n\nvec3 distortion(const in sampler2D tex, const in vec2 texCoord, const in vec2 distort, const in vec4 projectionLeft, const in vec4 unprojectionLeft) {\n  vec2 distortUV = getDistortUV(tex, texCoord, distort, projectionLeft, unprojectionLeft);\n  if(distortUV.x < 0.0) return vec3(0.0);\n  return texture2D(tex, distortUV).rgb;\n}"
}
, function(t, e) {
    t.exports = '#ifdef GL_FRAGMENT_PRECISION_HIGH\n   precision highp float;\n#else\n   precision mediump float;\n#endif\n\nvarying vec2 vTexCoord0;\nuniform sampler2D Texture0;\nuniform sampler2D Texture1;\nuniform vec4 uHalton;\n\n#ifdef GRAIN\n// https://www.shadertoy.com/view/4djSRW\n// quote : "[...] it gives the same result on PCs and Macs/iOS etc. [...] The sine stuff varies a lot between GPUs."\n\nuniform float uGrainFactor;\nuniform float uTimeGrain;\n\n// integer : 0.1031, uv (0,1 range): 443.8975\nfloat nrand(const in vec3 uvt) {\n  vec3 p3 = fract(uvt * 443.8975);\n  p3 += dot(p3, p3.yzx + 19.19);\n  return fract((p3.x + p3.y) * p3.z);\n}\n\nfloat nrandTriangle( const in vec3 n ) {\n    float nrnd0 = nrand( n );\n\n    // Convert uniform distribution into triangle-shaped distribution.\n    float orig = nrnd0 * 2.0 - 1.0;\n    nrnd0 = orig * inversesqrt(abs(orig));\n    nrnd0 = max(-1.0, nrnd0); // Nerf the NaN generated by 0 * rsqrt(0). Thanks @FioraAeterna!\n    nrnd0 = nrnd0 - sign(orig) + 0.5;\n\n    // Result is range [-0.5,1.5] which is useful for actual dithering. convert to [0,1] for histogram.\n    return (nrnd0 + 0.5) * 0.5;\n    // return nrnd0;\n}\n\n#endif\n\n#ifdef DOF_CROSS\nuniform vec2 RenderSize;\nuniform float uPixelRatio;\nuniform vec3 uDofCross;\n#endif\n\nvoid main() {\n    vec4 color = uHalton.z > 0.0 ? texture2D(Texture0, vTexCoord0) : texture2D(Texture1, vTexCoord0);\n\n    #ifdef GRAIN\n    float grain = nrandTriangle(vec3(vTexCoord0.xy, fract( uTimeGrain ) * 0.07));\n    color.rgb = mix(color.rgb, color.rgb * (color.rgb + (1.0 - color.rgb) * 2.0 * grain), uGrainFactor);\n    #endif\n\n    #ifdef DOF_CROSS\n    float ratio = RenderSize.y / RenderSize.x;\n    float dist = distance(vec2(uDofCross.x, uDofCross.y * ratio), vec2(vTexCoord0.x, vTexCoord0.y * ratio));\n    float widthCircle = uPixelRatio / RenderSize.x;\n    color.rgb = mix(color.rgb, vec3(1.0), abs(dist - 60.0 * widthCircle) > widthCircle ? 0.0 : uDofCross.z);\n    #endif\n\n    gl_FragColor = color;\n}\n'
}
, function(t, e) {
    t.exports = '#pragma include "functions.glsl"\n\nconst float MAX_BLUR = 16.0;\nconst float EPS_EARLY_OUT = 0.01; // early out (typically when we move the camera fast and the dof might be not effective)\n\nfloat texDepthToCoC(const in sampler2D texDepth, const in vec2 uv, const in vec4 dofBlurNearFarFocal) {\n    vec4 fetch = texture2D(texDepth, uv).rgba;\n    // background should be always max blurred so that the near blur can expand onto the background (because of special dilate background codepath below)\n    if(fetch.x == 1.0) return max(dofBlurNearFarFocal.x, dofBlurNearFarFocal.y);\n\n    float coc = dot(fetch, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\n    coc = clamp((coc - dofBlurNearFarFocal.z) / coc, -1.0, 1.0);\n    return (coc < 0.0 ? coc * dofBlurNearFarFocal.x : coc * dofBlurNearFarFocal.y);\n}\n\n// ------- DOWNSAMPLE COC ---------\nvec4 dofDownsampleCoC(const in sampler2D texDepth, const in vec2 uv, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    return vec4(vec3(0.0), texDepthToCoC(texDepth, uv, dofBlurNearFarFocal) * 0.5 + 0.5);\n}\n\n// ------- DOWNSAMPLE COLOR ---------\nvec4 dofDownsampleColor(const in sampler2D texColor, const in vec2 uv) {\n    return texture2D(texColor, uv);\n}\n\nvec4 dofDownsampleColor(const in sampler2D texColor, const in vec2 uv, const in sampler2D texCoC) {\n    return vec4(decodeRGBM(texture2D(texColor, uv), 7.0), texture2D(texCoC, uv).a);\n}\n\nfloat dilateNear(const in sampler2D texCoC, const in vec2 uv, const in vec2 offset, const in bool isBG) {\n    // TODO DOF both the weights and the formula can be tweaked, also we could add a bit of jitter or something\n\n    float coc = 0.0;\n    vec2 ofs = MAX_BLUR * offset / 5.0;\n\n    float coc0 = texture2D(texCoC, uv).a * 2.0 - 1.0;\n    float coc1 = texture2D(texCoC, uv - 5.0 * ofs).a * 2.0 - 1.0;\n    float coc2 = texture2D(texCoC, uv - 4.0 * ofs).a * 2.0 - 1.0;\n    float coc3 = texture2D(texCoC, uv - 3.0 * ofs).a * 2.0 - 1.0;\n    float coc4 = texture2D(texCoC, uv - 2.0 * ofs).a * 2.0 - 1.0;\n    float coc5 = texture2D(texCoC, uv - 1.0 * ofs).a * 2.0 - 1.0;\n    float coc6 = texture2D(texCoC, uv + 1.0 * ofs).a * 2.0 - 1.0;\n    float coc7 = texture2D(texCoC, uv + 2.0 * ofs).a * 2.0 - 1.0;\n    float coc8 = texture2D(texCoC, uv + 3.0 * ofs).a * 2.0 - 1.0;\n    float coc9 = texture2D(texCoC, uv + 4.0 * ofs).a * 2.0 - 1.0;\n    float coc10 = texture2D(texCoC, uv + 5.0 * ofs).a * 2.0 - 1.0;\n\n    if(isBG == true){\n        // avoid "shrink" effect on the out of focus far part on the model edges\n        // gaussian weights (sigma 10), (doesn\'t have to be gaussian though), but the sum must be 1.0\n        // http://dev.theomader.com/gaussian-kernel-calculator/\n        coc = abs(coc0) * 0.095474 +\n        (abs(coc1) + abs(coc10)) * 0.084264 +\n        (abs(coc2) + abs(coc9)) * 0.088139 +\n        (abs(coc3) + abs(coc8)) * 0.091276 +\n        (abs(coc4) + abs(coc7)) * 0.093585 +\n        (abs(coc5) + abs(coc6)) * 0.094998;\n    } else {\n        // blur only near field (expand)\n        coc = min(coc0, 0.0);\n        coc = min(coc1 * 0.3, coc);\n        coc = min(coc2 * 0.5, coc);\n        coc = min(coc3 * 0.75, coc);\n        coc = min(coc4 * 0.8, coc);\n        coc = min(coc5 * 0.95, coc);\n        coc = min(coc6 * 0.95, coc);\n        coc = min(coc7 * 0.8, coc);\n        coc = min(coc8 * 0.75, coc);\n        coc = min(coc9 * 0.5, coc);\n        coc = min(coc10 * 0.3, coc);\n        if(abs(coc0) > abs(coc))\n            coc = coc0;\n    }\n\n    return coc;\n}\n\n// ------- DILATE NEAR H ---------\nvec4 dofDilateNearH(const in sampler2D texCoC, const in sampler2D texDepth, const in vec2 uv, const in vec2 texSize,\n    const in float dofScale, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    vec2 offset = vec2( dofScale / texSize.x, 0.0);\n    float coc = dilateNear(texCoC, uv, offset, texture2D(texDepth, uv).x == 1.0);\n\n    return vec4(0.0, 0.0, 0.0, coc * 0.5 + 0.5);\n}\n\n// ------- DILATE NEAR V ---------\nvec4 dofDilateNearV(const in sampler2D texCoC, const in sampler2D texDepth,  const in vec2 uv, const in vec2 texSize,\n    const in float dofScale, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n    \n    vec2 offset = vec2(0.0, dofScale / texSize.y);\n    float coc = dilateNear(texCoC, uv, offset, texture2D(texDepth, uv).x == 1.0);\n\n    return vec4(0.0, 0.0, 0.0, coc * 0.5 + 0.5);\n}\n\nfloat nrand(const in vec3 uvt) {\n  vec3 p3 = fract(uvt * 443.8975);\n  p3 += dot(p3, p3.yzx + 19.19);\n  return fract((p3.x + p3.y) * p3.z);\n}\n\n#ifndef DOF_TAP\n#define DOF_TAP(id)  \n#endif\n\nvec4 dofBlur16(const in sampler2D texColor, const in sampler2D texCoC, const in vec2 uv, const in vec2 blurDist, const in float ntime) {\n    float rnd = 6.28318 * nrand(vec3(uv, + 0.07 * fract(ntime)));\n    float cosa = cos(rnd);\n    float sina = sin(rnd);\n    vec4 basis = vec4(cosa, -sina, sina, cosa);\n\n    vec4 sumcol = vec4(0.0);\n\n    float total = 0.0;\n\n    vec2 fTaps_Poisson[17];\n    // https://github.com/bartwronski/PoissonSamplingGenerator\n    fTaps_Poisson[0] = vec2(0.343280198355, 0.921191856785);\n    fTaps_Poisson[1] = vec2(-0.116859107262, 0.873056831344);\n    fTaps_Poisson[2] = vec2(-0.646421287853, 0.760425284853);\n    fTaps_Poisson[3] = vec2(-0.0437332058416, 0.47196719804);\n    fTaps_Poisson[4] = vec2(0.48240473891, 0.464894594736);\n    fTaps_Poisson[5] = vec2(-0.718897237297, 0.352191304304);\n    fTaps_Poisson[6] = vec2(-0.939061387886, -0.0387376698953);\n    fTaps_Poisson[7] = vec2(0.546569494557, -0.0169516524446);\n    fTaps_Poisson[8] = vec2(-0.182644095652, -0.0702667761349);\n    fTaps_Poisson[9] = vec2(-0.576191305396, -0.252368997099);\n    fTaps_Poisson[10] = vec2(0.921914032366, -0.366530187909);\n    fTaps_Poisson[11] = vec2(-0.0582053944545, -0.510617206206);\n    fTaps_Poisson[12] = vec2(-0.783101528934, -0.601411360136);\n    fTaps_Poisson[13] = vec2(0.430604354377, -0.729559481383);\n    fTaps_Poisson[14] = vec2(-0.350716524868, -0.809522919973);\n    fTaps_Poisson[15] = vec2(0.0600898835968, -0.952568587297);\n    fTaps_Poisson[16] = vec2(0.0, 0.0); // dummy because of intel off-by-one bug\n\n    // for (int i = 0; i < 16; i++) {\n    //     vec2 ofs = fTaps_Poisson[i];\n\n    //     ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw) );\n\n    //     vec3 sample = decodeRGBM(texture2D(texColor, uv + blurDist * ofs), 7.0);\n\n    //     // TODO DOF premult to avoid bleeding, can be tweaked (currently x^3)\n    //     // tradeoff between bleeding dof and out of focus object that shrinks too much\n    //     float cocWeight = abs(sample.a * 2.0 - 1.0);\n    //     cocWeight *= cocWeight * cocWeight;\n\n    //     sumcol.rgb += decodeRGBM(texture2D(texColor, ofs), 7.0) * cocWeight;\n    //     sumcol.a += cocWeight;\n    // }\n\n    vec2 ofs;\n    vec4 sample;\n    float cocWeight;\n\n    DOF_TAP(0);\n    DOF_TAP(1);\n    DOF_TAP(2);\n    DOF_TAP(3);\n    DOF_TAP(4);\n    DOF_TAP(5);\n    DOF_TAP(6);\n    DOF_TAP(7);\n    DOF_TAP(8);\n    DOF_TAP(9);\n    DOF_TAP(10);\n    DOF_TAP(11);\n    DOF_TAP(12);\n    DOF_TAP(13);\n    DOF_TAP(14);\n    DOF_TAP(15);\n\n    return sumcol;\n}\n\n// ------- BLUR CIRCULAR ---------\nvec4 dofBlurCircular(const in sampler2D texColor, const in sampler2D texCoC, const in vec2 uv, const in vec2 texSize, const in float ntime,\n    const in float dofScale, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    vec2 blurDist = (1.0 / texSize.xy) * MAX_BLUR * (texture2D(texCoC, uv).a * 2.0 - 1.0) * dofScale;\n\n    // TODO optimize dofBlur16 (unroll...)\n    vec4 sumcol = dofBlur16(texColor, texCoC, uv, blurDist, ntime); // 16\n    if(dofBlurNearFarFocal.w > 0.5) sumcol += dofBlur16(texColor, texCoC, uv, blurDist, ntime + 0.532524); // 32\n    if(dofBlurNearFarFocal.w > 1.5) sumcol += dofBlur16(texColor, texCoC, uv, blurDist, ntime + 0.798742); // 48\n    if(dofBlurNearFarFocal.w > 2.5) sumcol += dofBlur16(texColor, texCoC, uv, blurDist, ntime + 0.175857); // 64\n\n    return encodeRGBM(sumcol.rgb / sumcol.a, 7.0);\n}\n\n// ------- DOF COMBINE ---------\nvec3 dofCombine(const in vec3 color, const in sampler2D texBlur, const in sampler2D texCoC, const in sampler2D texDepth, const in vec2 uv,\n    const in float range, const in vec2 texSize, const in float dofScale, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return color;\n\n    vec3 blur = decodeRGBM(texture2D(texBlur, uv), range);\n\n    vec2 off = vec2(1.0, -1.0) * dofScale;\n    blur += decodeRGBM(texture2D(texBlur, uv + off.xx / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.yy / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.xy / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.yx / texSize), range);\n    blur /= 5.0;\n\n    // try to merged the half coc haf res near blurred with the full res coc\n    float coc = abs(min(texture2D(texCoC, uv).a * 2.0 - 1.0, texDepthToCoC(texDepth, uv, dofBlurNearFarFocal)));\n\n    // TODO DOF can be tweaked, it merges full and half res buffers\n    return mix(color, blur, clamp(coc * coc * 16.0, 0.0, 1.0));\n}\n';
}
, function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1672)
      , a = i(1679)
      , s = {
        FeatureName: "webVR",
        ModelType: r,
        ViewListType: [a]
    }
      , o = n.create(s);
    o.prototype.getNode = function() {
        return this._views[0]._nodeWebVR
    }
    ,
    o.prototype.getNodeProxy = function() {
        return this._views[0]._proxyVR
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(234)
      , a = i(1465)
      , s = i(1673)
      , o = i(1676)
      , u = i(1678)
      , l = n.osg
      , c = r.Model.extend({
        defaults: {
            enable: !1,
            worldFactor: -1,
            deviceInfo: void 0,
            hasNativeHMD: !!navigator.getVRDisplays,
            modeLauncher: !1,
            hit: void 0,
            floorHeight: 0,
            humanMatrix: l.Matrix.create(),
            humanInAir: !1,
            boundingBox: new l.BoundingBox,
            boundingSphere: new l.BoundingSphere
        },
        init: function(t) {
            this._context = t,
            this._scene = t.getScene(),
            this._viewer = t.getViewer()
        },
        initWebVR: function() {
            navigator.getVRDisplays && navigator.getVRDisplays().then(function(t) {
                this.set("hasNativeHMD", t.length > 0)
            }
            .bind(this)),
            this.set("deviceInfo", this._initDeviceInfo());
            var t = this._context.getModel().get("options").vr;
            if (t && t.scale > 0) {
                this.set("worldFactor", t.scale),
                this.set("floorHeight", t.floorHeight);
                var e = this.get("humanMatrix")
                  , i = t.initialCamera;
                l.Matrix.makeRotateFromQuat(i.rotation, e),
                l.Matrix.setTrans(e, i.position[0], i.position[1], i.position[2])
            }
            this.initBoundAndWorldFactor(),
            this.set("enable", a().cardboard > 0)
        },
        isDiorama: function() {
            var t = Math.min(this.get("boundingSphere").radius(), this.get("boundingBox").radius());
            return t < 2 * this.get("worldFactor")
        },
        initBoundAndWorldFactor: function() {
            var t = this.get("boundingBox");
            if (!(t.valid() && this.get("worldFactor") > 0)) {
                if (!t.valid()) {
                    var e = this._viewer.getViewerOSGJS().getManipulator().getNode()
                      , i = new u;
                    e.accept(i);
                    var n = i.getPreciseBox();
                    t.copy(n);
                    var r = this.get("boundingSphere");
                    r.set(n.center(r.center()), n.radius()),
                    e.getBoundingBox().copy(n);
                    var a = e.getBoundingSphere();
                    a.set(n.center(a.center()), n.radius())
                }
                if (t.valid() && this.get("worldFactor") <= 0) {
                    var s = t.getMin()[2]
                      , o = Math.min(this.get("boundingSphere").radius(), this.get("boundingBox").radius());
                    this.set("worldFactor", .5 * o),
                    this.set("floorHeight", s),
                    l.Matrix.makeTranslate(0, -o, s, this.get("humanMatrix"))
                }
                t.valid() && this.get("worldFactor") > 0 && this.trigger("vrReady")
            }
        },
        _initDeviceInfo: function() {
            var t = new o((!1))
              , e = new s(t.getDeviceParams());
            return a().cardboard > 1 && e.setViewer(s.Viewers.CardboardV2),
            e
        },
        getName: function() {
            return "WebVR"
        },
        getJSON: function() {
            var t = l.Matrix.copy(this.get("humanMatrix"), l.Matrix.create())
              , e = l.Matrix.getScale(t, l.Vec3.create());
            l.Vec3.set(1 / e[0], 1 / e[1], 1 / e[2], e);
            var i = l.Matrix.preMultScale(t, e)
              , n = l.Quat.create();
            return l.Quat.normalize(l.Matrix.getRotate(i, n), n),
            {
                scale: this.get("worldFactor"),
                initialCamera: {
                    position: l.Matrix.getTrans(i, l.Vec3.create()),
                    rotation: n
                },
                floorHeight: this.get("floorHeight")
            }
        }
    });
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    function n(t) {
        this.viewer = f.CardboardV1,
        this.updateDeviceParams(t)
    }
    var r = i(1198)
      , a = i(1674)
      , s = i(1675)
      , o = r.osg
      , u = 180 / Math.PI
      , l = Math.PI / 180
      , c = function(t) {
        this.id = t.id,
        this.label = t.label,
        this.fov = t.fov,
        this.interLensDistance = t.interLensDistance,
        this.baselineLensDistance = t.baselineLensDistance,
        this.screenLensDistance = t.screenLensDistance,
        this.distortionCoefficients = t.distortionCoefficients,
        this.inverseCoefficients = t.inverseCoefficients
    }
      , h = function(t) {
        this.width = t.width || s.getScreenWidth(),
        this.height = t.height || s.getScreenHeight(),
        this.widthMeters = t.widthMeters,
        this.heightMeters = t.heightMeters,
        this.bevelMeters = t.bevelMeters
    }
      , d = new h({
        widthMeters: .11,
        heightMeters: .062,
        bevelMeters: .004
    })
      , p = new h({
        widthMeters: .1038,
        heightMeters: .0584,
        bevelMeters: .004
    })
      , f = {
        CardboardV1: new c({
            id: "CardboardV1",
            label: "Cardboard I/O 2014",
            fov: 40,
            interLensDistance: .06,
            baselineLensDistance: .035,
            screenLensDistance: .042,
            distortionCoefficients: [.441, .156],
            inverseCoefficients: [-.4410035, .42756155, -.4804439, .5460139, -.58821183, .5733938, -.48303202, .33299083, -.17573841, .0651772, -.01488963, .001559834]
        }),
        CardboardV2: new c({
            id: "CardboardV2",
            label: "Cardboard I/O 2015",
            fov: 60,
            interLensDistance: .064,
            baselineLensDistance: .035,
            screenLensDistance: .039,
            distortionCoefficients: [.34, .55],
            inverseCoefficients: [-.33836704, -.18162185, .862655, -1.2462051, 1.0560602, -.58208317, .21609078, -.05444823, .009177956, -.0009904169, 6183535e-11, -16981803e-13]
        })
    };
    n.prototype.updateDeviceParams = function(t) {
        this.device = this.determineDevice_(t) || this.device
    }
    ,
    n.prototype.getDevice = function() {
        return this.device
    }
    ,
    n.prototype.setViewer = function(t) {
        this.viewer = t
    }
    ,
    n.prototype.determineDevice_ = function(t) {
        if (!t)
            return s.isIOS() ? (console.warn("Using fallback iOS device measurements."),
            p) : (console.warn("Using fallback Android device measurements."),
            d);
        var e = .0254
          , i = e / t.xdpi
          , n = e / t.ydpi
          , r = s.getScreenWidth()
          , a = s.getScreenHeight();
        return new h({
            widthMeters: i * r,
            heightMeters: n * a,
            bevelMeters: .001 * t.bevelMm
        })
    }
    ,
    n.prototype.getDistortedFieldOfViewLeftEye = function() {
        var t = this.viewer
          , e = this.device
          , i = new a(t.distortionCoefficients)
          , n = t.screenLensDistance
          , r = (e.widthMeters - t.interLensDistance) / 2
          , s = t.interLensDistance / 2
          , o = t.baselineLensDistance - e.bevelMeters
          , l = e.heightMeters - o
          , c = u * Math.atan(i.distort(r / n))
          , h = u * Math.atan(i.distort(s / n))
          , d = u * Math.atan(i.distort(o / n))
          , p = u * Math.atan(i.distort(l / n));
        return {
            leftDegrees: Math.min(c, t.fov),
            rightDegrees: Math.min(h, t.fov),
            downDegrees: Math.min(d, t.fov),
            upDegrees: Math.min(p, t.fov)
        }
    }
    ,
    n.prototype.getFieldOfViewLeftEye = function(t) {
        return t ? this.getUndistortedFieldOfViewLeftEye() : this.getDistortedFieldOfViewLeftEye()
    }
    ,
    n.prototype.getFieldOfViewRightEye = function(t) {
        var e = this.getFieldOfViewLeftEye(t);
        return {
            leftDegrees: e.rightDegrees,
            rightDegrees: e.leftDegrees,
            upDegrees: e.upDegrees,
            downDegrees: e.downDegrees
        }
    }
    ,
    n.prototype.getProjectionMatrixLeftEye = function(t) {
        var e = this.getFieldOfViewLeftEye(t)
          , i = o.Matrix.create()
          , n = .1
          , r = 1e3
          , a = Math.tan(l * e.leftDegrees) * n
          , s = Math.tan(l * e.rightDegrees) * n
          , u = Math.tan(l * e.downDegrees) * n
          , c = Math.tan(l * e.upDegrees) * n;
        return o.Matrix.makeFrustum(-a, s, -u, c, n, r, i),
        i
    }
    ,
    n.prototype.getUndistortedViewportLeftEye = function() {
        var t = this.getUndistortedParams_()
          , e = this.viewer
          , i = this.device
          , n = e.screenLensDistance
          , r = i.widthMeters / n
          , a = i.heightMeters / n
          , s = i.width / r
          , o = i.height / a
          , u = Math.round((t.eyePosX - t.outerDist) * s)
          , l = Math.round((t.eyePosY - t.bottomDist) * o);
        return {
            x: u,
            y: l,
            width: Math.round((t.eyePosX + t.innerDist) * s) - u,
            height: Math.round((t.eyePosY + t.topDist) * o) - l
        }
    }
    ,
    n.prototype.getUndistortedFieldOfViewLeftEye = function() {
        var t = this.getUndistortedParams_();
        return {
            leftDegrees: u * Math.atan(t.outerDist),
            rightDegrees: u * Math.atan(t.innerDist),
            downDegrees: u * Math.atan(t.bottomDist),
            upDegrees: u * Math.atan(t.topDist)
        }
    }
    ,
    n.prototype.getUndistortedParams_ = function() {
        var t = this.viewer
          , e = this.device
          , i = new a(t.distortionCoefficients)
          , n = t.screenLensDistance
          , r = t.interLensDistance / 2 / n
          , s = e.widthMeters / n
          , o = e.heightMeters / n
          , u = s / 2 - r
          , c = (t.baselineLensDistance - e.bevelMeters) / n
          , h = t.fov
          , d = i.distortInverse(Math.tan(l * h))
          , p = Math.min(u, d)
          , f = Math.min(r, d)
          , g = Math.min(c, d)
          , m = Math.min(o - c, d);
        return {
            outerDist: p,
            innerDist: f,
            topDist: m,
            bottomDist: g,
            eyePosX: u,
            eyePosY: c
        }
    }
    ,
    n.Viewers = f,
    t.exports = n
}
, function(t, e) {
    "use strict";
    var i = function(t) {
        this.coefficients = t
    };
    i.prototype.distortInverse = function(t) {
        for (var e = t / .9, i = .9 * t, n = t - this.distort(e); Math.abs(i - e) > 1e-4; ) {
            var r = t - this.distort(i)
              , a = i - r * ((i - e) / (r - n));
            e = i,
            i = a,
            n = r
        }
        return i
    }
    ,
    i.prototype.distort = function(t) {
        return t * this.distortionFactor_(t)
    }
    ,
    i.prototype.distortionFactor_ = function(t) {
        for (var e = 1, i = 1, n = t * t, r = 0; r < this.coefficients.length; r++) {
            var a = this.coefficients[r];
            i *= n,
            e += a * i
        }
        return e
    }
    ,
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = {};
    a.base64 = function(t, e) {
        return "data:" + t + ";base64," + e
    }
    ,
    a.isMobile = function() {
        var t = !1;
        return function(e) {
            (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0, 4))) && (t = !0)
        }(navigator.userAgent || navigator.vendor || window.opera),
        t
    }
    ,
    a.isFirefox = function() {
        return /firefox/i.test(navigator.userAgent)
    }
    ,
    a.isIOS = function() {
        return /(iPad|iPhone|iPod)/g.test(navigator.userAgent)
    }
    ,
    a.isIFrame = function() {
        try {
            return window.self !== window.top
        } catch (t) {
            return !0
        }
    }
    ,
    a.appendQueryParameter = function(t, e, i) {
        var n = t.indexOf("?") < 0 ? "?" : "&";
        return t += n + e + "=" + i
    }
    ,
    a.getQueryParameter = function(t) {
        t = t.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var e = new RegExp("[\\?&]" + t + "=([^&#]*)")
          , i = e.exec(location.search);
        return null === i ? "" : decodeURIComponent(i[1].replace(/\+/g, " "))
    }
    ,
    a.isLandscapeMode = function() {
        return 90 === window.orientation || window.orientation === -90
    }
    ,
    a.getScreenWidth = function() {
        return Math.max(window.screen.width, window.screen.height) * window.devicePixelRatio
    }
    ,
    a.getScreenHeight = function() {
        return Math.min(window.screen.width, window.screen.height) * window.devicePixelRatio
    }
    ,
    a.projectionMatrixToVector_ = function(t, e) {
        var i = e || {}
          , n = i.xScale || 1
          , a = i.yScale || 1
          , s = i.xTrans || 0
          , o = i.yTrans || 0
          , u = r.Vec4.create();
        return u[0] = t[0] * n * .5,
        u[1] = t[5] * a * .5,
        u[2] = .5 * (t[8] - 1 - s),
        u[3] = .5 * (t[9] - 1 - o),
        u
    }
    ,
    a.leftProjectionVectorToRight_ = function(t) {
        return r.Vec4.createAndSet(t[0], t[1], -t[2] - 1, t[3])
    }
    ,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1677)
      , r = i(1675)
      , a = "https://storage.googleapis.com/cardboard-dpdb/dpdb.json"
      , s = function(t) {
        this.xdpi = t.xdpi,
        this.ydpi = t.ydpi,
        this.bevelMm = t.bevelMm
    }
      , o = !1
      , u = function(t) {
        o && console.log(t)
    }
      , l = function(t) {
        o && console.error(t)
    }
      , c = function(t) {
        o && console.warn(t)
    }
      , h = function(t, e) {
        if (this.dpdb = n,
        this.recalculateDeviceParams_(),
        t) {
            this.onDeviceParamsUpdated = e,
            u("Fetching DPDB...");
            var i = new XMLHttpRequest
              , r = this;
            i.open("GET", a, !0),
            i.addEventListener("load", function() {
                r.loading = !1,
                i.status >= 200 && i.status <= 299 ? (u("Successfully loaded online DPDB."),
                r.dpdb = JSON.parse(i.response),
                r.recalculateDeviceParams_()) : l("Error loading online DPDB!")
            }),
            i.send()
        }
    };
    h.prototype.getDeviceParams = function() {
        return this.deviceParams
    }
    ,
    h.prototype.recalculateDeviceParams_ = function() {
        u("Recalculating device params.");
        var t = this.calcDeviceParams_();
        u("New device parameters:"),
        u(t),
        t ? (this.deviceParams = t,
        this.onDeviceParamsUpdated && this.onDeviceParamsUpdated(this.deviceParams)) : l("Failed to recalculate device parameters.")
    }
    ,
    h.prototype.calcDeviceParams_ = function() {
        var t = this.dpdb;
        if (!t)
            return l("DPDB not available."),
            null;
        if (1 !== t.format)
            return l("DPDB has unexpected format version."),
            null;
        if (!t.devices || !t.devices.length)
            return l("DPDB does not have a devices section."),
            null;
        var e = navigator.userAgent || navigator.vendor || window.opera
          , i = r.getScreenWidth()
          , n = r.getScreenHeight();
        if (u("User agent: " + e),
        u("Pixel width: " + i),
        u("Pixel height: " + n),
        !t.devices)
            return l("DPDB has no devices section."),
            null;
        for (var a = 0; a < t.devices.length; a++) {
            var o = t.devices[a];
            if (o.rules)
                if ("ios" === o.type || "android" === o.type) {
                    if (r.isIOS() === ("ios" === o.type)) {
                        for (var h = !1, d = 0; d < o.rules.length; d++) {
                            var p = o.rules[d];
                            if (this.matchRule_(p, e, i, n)) {
                                u("Rule matched:"),
                                u(p),
                                h = !0;
                                break
                            }
                        }
                        if (h) {
                            var f = o.dpi[0] || o.dpi
                              , g = o.dpi[1] || o.dpi;
                            return new s({
                                xdpi: f,
                                ydpi: g,
                                bevelMm: o.bw
                            })
                        }
                    }
                } else
                    c("Device[" + a + "] has invalid type.");
            else
                c("Device[" + a + "] has no rules section.")
        }
        return c("No DPDB device match."),
        null
    }
    ,
    h.prototype.matchRule_ = function(t, e, i, n) {
        if (!t.ua && !t.res)
            return !1;
        if (t.ua && e.indexOf(t.ua) < 0)
            return !1;
        if (t.res) {
            if (!t.res[0] || !t.res[1])
                return !1;
            var r = t.res[0]
              , a = t.res[1];
            if (Math.min(i, n) !== Math.min(r, a) || Math.max(i, n) !== Math.max(r, a))
                return !1
        }
        return !0
    }
    ,
    t.exports = h
}
, function(t, e) {
    "use strict";
    var i = {
        format: 1,
        last_updated: "2016-01-26T23:11:18Z",
        devices: [{
            type: "android",
            rules: [{
                mdmh: "asus/*/Nexus 7/*"
            }, {
                ua: "Nexus 7"
            }],
            dpi: [320.8, 323],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "asus/*/ASUS_Z00AD/*"
            }, {
                ua: "ASUS_Z00AD"
            }],
            dpi: [403, 404.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "HTC/*/HTC6435LVW/*"
            }, {
                ua: "HTC6435LVW"
            }],
            dpi: [449.7, 443.3],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "HTC/*/HTC One XL/*"
            }, {
                ua: "HTC One XL"
            }],
            dpi: [315.3, 314.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "htc/*/Nexus 9/*"
            }, {
                ua: "Nexus 9"
            }],
            dpi: 289,
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "HTC/*/HTC One M9/*"
            }, {
                ua: "HTC One M9"
            }],
            dpi: [442.5, 443.3],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "HTC/*/HTC One_M8/*"
            }, {
                ua: "HTC One_M8"
            }],
            dpi: [449.7, 447.4],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "HTC/*/HTC One/*"
            }, {
                ua: "HTC One"
            }],
            dpi: 472.8,
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Huawei/*/Nexus 6P/*"
            }, {
                ua: "Nexus 6P"
            }],
            dpi: [515.1, 518],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/Nexus 5X/*"
            }, {
                ua: "Nexus 5X"
            }],
            dpi: [422, 419.9],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LGMS345/*"
            }, {
                ua: "LGMS345"
            }],
            dpi: [221.7, 219.1],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LG-D800/*"
            }, {
                ua: "LG-D800"
            }],
            dpi: [422, 424.1],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LG-D850/*"
            }, {
                ua: "LG-D850"
            }],
            dpi: [537.9, 541.9],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/VS985 4G/*"
            }, {
                ua: "VS985 4G"
            }],
            dpi: [537.9, 535.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/Nexus 5/*"
            }, {
                ua: "Nexus 5 B"
            }],
            dpi: [442.4, 444.8],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/Nexus 4/*"
            }, {
                ua: "Nexus 4"
            }],
            dpi: [319.8, 318.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LG-P769/*"
            }, {
                ua: "LG-P769"
            }],
            dpi: [240.6, 247.5],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LGMS323/*"
            }, {
                ua: "LGMS323"
            }],
            dpi: [206.6, 204.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LGLS996/*"
            }, {
                ua: "LGLS996"
            }],
            dpi: [403.4, 401.5],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Micromax/*/4560MMX/*"
            }, {
                ua: "4560MMX"
            }],
            dpi: [240, 219.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Micromax/*/A250/*"
            }, {
                ua: "Micromax A250"
            }],
            dpi: [480, 446.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Micromax/*/Micromax AQ4501/*"
            }, {
                ua: "Micromax AQ4501"
            }],
            dpi: 240,
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/DROID RAZR/*"
            }, {
                ua: "DROID RAZR"
            }],
            dpi: [368.1, 256.7],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT830C/*"
            }, {
                ua: "XT830C"
            }],
            dpi: [254, 255.9],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1021/*"
            }, {
                ua: "XT1021"
            }],
            dpi: [254, 256.7],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1023/*"
            }, {
                ua: "XT1023"
            }],
            dpi: [254, 256.7],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1028/*"
            }, {
                ua: "XT1028"
            }],
            dpi: [326.6, 327.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1034/*"
            }, {
                ua: "XT1034"
            }],
            dpi: [326.6, 328.4],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1053/*"
            }, {
                ua: "XT1053"
            }],
            dpi: [315.3, 316.1],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1562/*"
            }, {
                ua: "XT1562"
            }],
            dpi: [403.4, 402.7],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/Nexus 6/*"
            }, {
                ua: "Nexus 6 B"
            }],
            dpi: [494.3, 489.7],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1063/*"
            }, {
                ua: "XT1063"
            }],
            dpi: [295, 296.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1064/*"
            }, {
                ua: "XT1064"
            }],
            dpi: [295, 295.6],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1092/*"
            }, {
                ua: "XT1092"
            }],
            dpi: [422, 424.1],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1095/*"
            }, {
                ua: "XT1095"
            }],
            dpi: [422, 423.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "OnePlus/*/A0001/*"
            }, {
                ua: "A0001"
            }],
            dpi: [403.4, 401],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "OnePlus/*/ONE E1005/*"
            }, {
                ua: "ONE E1005"
            }],
            dpi: [442.4, 441.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "OnePlus/*/ONE A2005/*"
            }, {
                ua: "ONE A2005"
            }],
            dpi: [391.9, 405.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "OPPO/*/X909/*"
            }, {
                ua: "X909"
            }],
            dpi: [442.4, 444.1],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9082/*"
            }, {
                ua: "GT-I9082"
            }],
            dpi: [184.7, 185.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G360P/*"
            }, {
                ua: "SM-G360P"
            }],
            dpi: [196.7, 205.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/Nexus S/*"
            }, {
                ua: "Nexus S"
            }],
            dpi: [234.5, 229.8],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9300/*"
            }, {
                ua: "GT-I9300"
            }],
            dpi: [304.8, 303.9],
            bw: 5,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-T230NU/*"
            }, {
                ua: "SM-T230NU"
            }],
            dpi: 216,
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SGH-T399/*"
            }, {
                ua: "SGH-T399"
            }],
            dpi: [217.7, 231.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-N9005/*"
            }, {
                ua: "SM-N9005"
            }],
            dpi: [386.4, 387],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SAMSUNG-SM-N900A/*"
            }, {
                ua: "SAMSUNG-SM-N900A"
            }],
            dpi: [386.4, 387.7],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9500/*"
            }, {
                ua: "GT-I9500"
            }],
            dpi: [442.5, 443.3],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9505/*"
            }, {
                ua: "GT-I9505"
            }],
            dpi: 439.4,
            bw: 4,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G900F/*"
            }, {
                ua: "SM-G900F"
            }],
            dpi: [415.6, 431.6],
            bw: 5,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G900M/*"
            }, {
                ua: "SM-G900M"
            }],
            dpi: [415.6, 431.6],
            bw: 5,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G800F/*"
            }, {
                ua: "SM-G800F"
            }],
            dpi: 326.8,
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G906S/*"
            }, {
                ua: "SM-G906S"
            }],
            dpi: [562.7, 572.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9300/*"
            }, {
                ua: "GT-I9300"
            }],
            dpi: [306.7, 304.8],
            bw: 5,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-T535/*"
            }, {
                ua: "SM-T535"
            }],
            dpi: [142.6, 136.4],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-N920C/*"
            }, {
                ua: "SM-N920C"
            }],
            dpi: [515.1, 518.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9300I/*"
            }, {
                ua: "GT-I9300I"
            }],
            dpi: [304.8, 305.8],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9195/*"
            }, {
                ua: "GT-I9195"
            }],
            dpi: [249.4, 256.7],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SPH-L520/*"
            }, {
                ua: "SPH-L520"
            }],
            dpi: [249.4, 255.9],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SAMSUNG-SGH-I717/*"
            }, {
                ua: "SAMSUNG-SGH-I717"
            }],
            dpi: 285.8,
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SPH-D710/*"
            }, {
                ua: "SPH-D710"
            }],
            dpi: [217.7, 204.2],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-N7100/*"
            }, {
                ua: "GT-N7100"
            }],
            dpi: 265.1,
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SCH-I605/*"
            }, {
                ua: "SCH-I605"
            }],
            dpi: 265.1,
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/Galaxy Nexus/*"
            }, {
                ua: "Galaxy Nexus"
            }],
            dpi: [315.3, 314.2],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-N910H/*"
            }, {
                ua: "SM-N910H"
            }],
            dpi: [515.1, 518],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-N910C/*"
            }, {
                ua: "SM-N910C"
            }],
            dpi: [515.2, 520.2],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G130M/*"
            }, {
                ua: "SM-G130M"
            }],
            dpi: [165.9, 164.8],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G928I/*"
            }, {
                ua: "SM-G928I"
            }],
            dpi: [515.1, 518.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G920F/*"
            }, {
                ua: "SM-G920F"
            }],
            dpi: 580.6,
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G920P/*"
            }, {
                ua: "SM-G920P"
            }],
            dpi: [522.5, 577],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G925F/*"
            }, {
                ua: "SM-G925F"
            }],
            dpi: 580.6,
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G925V/*"
            }, {
                ua: "SM-G925V"
            }],
            dpi: [522.5, 576.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Sony/*/C6903/*"
            }, {
                ua: "C6903"
            }],
            dpi: [442.5, 443.3],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "Sony/*/D6653/*"
            }, {
                ua: "D6653"
            }],
            dpi: [428.6, 427.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Sony/*/E6653/*"
            }, {
                ua: "E6653"
            }],
            dpi: [428.6, 425.7],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Sony/*/E6853/*"
            }, {
                ua: "E6853"
            }],
            dpi: [403.4, 401.9],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Sony/*/SGP321/*"
            }, {
                ua: "SGP321"
            }],
            dpi: [224.7, 224.1],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "TCT/*/ALCATEL ONE TOUCH Fierce/*"
            }, {
                ua: "ALCATEL ONE TOUCH Fierce"
            }],
            dpi: [240, 247.5],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "THL/*/thl 5000/*"
            }, {
                ua: "thl 5000"
            }],
            dpi: [480, 443.3],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "ZTE/*/ZTE Blade L2/*"
            }, {
                ua: "ZTE Blade L2"
            }],
            dpi: 240,
            bw: 3,
            ac: 500
        }, {
            type: "ios",
            rules: [{
                res: [640, 960]
            }],
            dpi: [325.1, 328.4],
            bw: 4,
            ac: 1e3
        }, {
            type: "ios",
            rules: [{
                res: [640, 1136]
            }],
            dpi: [317.1, 320.2],
            bw: 3,
            ac: 1e3
        }, {
            type: "ios",
            rules: [{
                res: [750, 1334]
            }],
            dpi: 326.4,
            bw: 4,
            ac: 1e3
        }, {
            type: "ios",
            rules: [{
                res: [1242, 2208]
            }],
            dpi: [453.6, 458.4],
            bw: 4,
            ac: 1e3
        }, {
            type: "ios",
            rules: [{
                res: [1125, 2001]
            }],
            dpi: [410.9, 415.4],
            bw: 4,
            ac: 1e3
        }]
    };
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = function() {
        r.ComputeBoundsVisitor.call(this),
        this._minBox = new r.BoundingBox,
        this._visitedBuffers = {}
    };
    a.prototype = r.objectInherit(r.ComputeBoundsVisitor.prototype, {
        getPreciseBox: function() {
            return this._minBox
        },
        apply: function(t) {
            if (t instanceof r.Transform)
                return void this.applyTransform(t);
            if (t instanceof r.Geometry) {
                var e = this._matrixStack.length
                  , i = e > 0 ? this._matrixStack[e - 1] : r.Matrix.identity
                  , n = t.getVertexAttributeList().Vertex
                  , a = this._visitedBuffers[n.getInstanceID()];
                if (a && r.Matrix.equal(a.matrix, i))
                    return;
                var s = t.computeTransformedVertices ? t.computeTransformedVertices() : n.getElements();
                this._visitedBuffers[n.getInstanceID()] = {
                    buffer: s,
                    matrix: r.Matrix.copy(i, r.Matrix.create())
                };
                for (var o = i[0], u = i[1], l = i[2], c = i[3], h = i[4], d = i[5], p = i[6], f = i[7], g = i[8], m = i[9], v = i[10], _ = i[11], b = i[12], x = i[13], A = i[14], y = i[15], S = 1 / 0, C = 1 / 0, M = 1 / 0, w = -(1 / 0), T = -(1 / 0), E = -(1 / 0), I = 0, k = s.length; I < k; I += 3) {
                    var F = s[I]
                      , D = s[I + 1]
                      , N = s[I + 2]
                      , R = c * F + f * D + _ * N + y || 1
                      , P = (o * F + h * D + g * N + b) / R
                      , L = (u * F + d * D + m * N + x) / R
                      , O = (l * F + p * D + v * N + A) / R;
                    P < S && (S = P),
                    L < C && (C = L),
                    O < M && (M = O),
                    P > w && (w = P),
                    L > T && (T = L),
                    O > E && (E = O)
                }
                var V = this._minBox.getMin()
                  , B = this._minBox.getMax();
                return S < V[0] && (V[0] = S),
                C < V[1] && (V[1] = C),
                M < V[2] && (V[2] = M),
                w > B[0] && (B[0] = w),
                T > B[1] && (B[1] = T),
                void (E > B[2] && (B[2] = E))
            }
            this.traverse(t)
        }
    }),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = i(258)
      , s = i(1482)
      , o = i(1658)
      , u = i(1486)
      , l = i(1675)
      , c = i(1516)
      , h = i(1514)
      , d = i(1191)
      , p = i(1465)
      , f = i(1680)
      , g = i(1639)
      , m = i(285)
      , v = i(1683)
      , _ = i(1698)
      , b = i(1701)
      , x = i(1704)
      , A = i(1707)
      , y = i(1712)
      , S = new f({
        device: "VWR"
    })
      , C = r.osg
      , S = new f({
        device: "VWR",
        listen: !0
    })
      , M = 1.8
      , w = 1.02
      , T = a.extend({
        initialize: function() {
            a.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:enable", this.onEnable, this),
            t.bind("change:worldFactor", this.onWorldFactor, this),
            t.bind("change:floorHeight", this.onFloorHeight, this),
            t.bind("doubleTap", this.onDoubleTap, this),
            t.bind("snapHumanOnFloor", this.snapHumanOnFloor, this),
            this._standaloneViewer = !p().messaging,
            S.on("message:requestPresent", this.onRequestPresent, this),
            this._viewer = this.options.context.getViewer(),
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._manipulator = this._viewerOSGJS.getManipulator(),
            this._cullConfig = o.vrConfig,
            this._lastSelectedHotspot = void 0,
            this._lastHoveredHotspot = void 0,
            this._lastFloorHeight = 0,
            this._lastTime = 0,
            this._lastWorldFactor = -1,
            this._lastMouse = C.Vec2.create(),
            this._interpolatorAlpha = new r.osgGA.OrbitManipulator.Interpolator(1),
            this._interpolatorAlpha.setDelay(.1),
            this._webvrMobileHeight = this.getCorrectionMobilePixelRatio(),
            this._nodeWebVR = new C.Node,
            this._nodeWebVR.setName("Feature - WebVR"),
            this._proxyVR = new C.Node,
            this._proxyVR.setName("WebVR - Proxy"),
            this._proxyVR.setNodeMask(0),
            this._floorMT = new x(t),
            this._humanMT = new v(t),
            this._teleportNode = new _,
            this._cursorMT = new b,
            this._controllerMT = new A(t,this._viewer.getCanvas()),
            this._nodeMenu = new y(t),
            this._nodeMenu.setHomeAction(this._exitVR.bind(this)),
            this._nodeMenu.setNextAction(this.goToNextHotspot.bind(this)),
            this._nodeMenu.setPrevAction(this.goToPrevHotspot.bind(this)),
            this._dataDownloaded = !1,
            this._scaleControlEnabled = !0,
            this._frameData = void 0,
            this.onFloorHeight(),
            this.initGraphNodes(),
            this.hookComputeCanvasSize();
            var e = this._viewer.getCanvas();
            window.addEventListener("keydown", this.onKeyDown.bind(this)),
            d() && e.addEventListener("mousemove", this.onMouseMove.bind(this)),
            window.addEventListener("vrdisplayactivate", function() {
                s.getModelDisplayed().isFulfilled() ? t.set("enable", !0) : s.getModelDisplayed().then(function() {
                    t.set("enable", !0)
                });
                var e = this.getConfigWebVR();
                e.isPresenting || this._viewerOSGJS.setPresentVR(!0).then(this.notifyPresentVR.bind(this))
            }
            .bind(this)),
            window.addEventListener("vrdisplaydeactivate", function() {
                this._standaloneViewer && !this.model.get("modeLauncher") && this.model.set("enable", !1)
            }
            .bind(this)),
            s.getModelDisplayed().then(this.initWebVR.bind(this))
        },
        getCorrectionMobilePixelRatio: function() {
            return m.any ? Math.min(window.screen.width, window.screen.height) * Math.min(1.75, window.devicePixelRatio) : -1
        },
        onRequestPresent: function(t) {
            this._standaloneViewer ? C.log("Launcher onRequestPresent") : C.log("Viewer onRequestPresent"),
            this.startEnable(!0, !0),
            t.removeFromHash()
        },
        initWebVR: function() {
            this._nodeWebVR.addUpdateCallback(this)
        },
        setProxyVisible: function(t) {
            this._proxyVR.setNodeMask(t ? h.NO_SHADOW : 0)
        },
        onDoubleTap: function(t) {
            if (!this.model.get("enable") && t.nodepath.indexOf(this._humanMT) === -1) {
                var e = this._viewer.getFeaturesManager()
                  , i = C.Vec3.create();
                e.getWorldPositionFromHit(t, i),
                C.Matrix.setTrans(this._humanMT.getMatrix(), i[0], i[1], i[2]),
                u.draw()
            }
        },
        onKeyDown: function(t) {
            var e = this.model.get("worldFactor");
            if (!(e <= 0)) {
                var i = 1;
                if (79 === t.which)
                    i = 1.2;
                else {
                    if (80 !== t.which)
                        return;
                    i = 1 / 1.2
                }
                this.model.set("worldFactor", e * i)
            }
        },
        onMouseMove: function(t) {
            this._lastMouse[0] = void 0 === t.offsetX ? t.layerX : t.offsetX,
            this._lastMouse[1] = void 0 === t.offsetY ? t.layerY : t.offsetY
        },
        onFloorHeight: function() {
            var t = this.model.get("floorHeight")
              , e = .05 * this.model.get("worldFactor");
            Math.abs(this._humanMT.getMatrix()[14] - this._lastFloorHeight) <= e && (this._humanMT.getMatrix()[14] = t),
            this._floorMT.getMatrix()[14] = t,
            this._lastFloorHeight = t
        },
        initGraphNodes: function() {
            this._nodeWebVR.addChild(this._proxyVR),
            this._proxyVR.addChild(this._floorMT),
            this._proxyVR.addChild(this._humanMT),
            this._proxyVR.addChild(this._teleportNode),
            this._proxyVR.addChild(this._cursorMT),
            this._proxyVR.addChild(this._controllerMT),
            this._proxyVR.addChild(this._nodeMenu);
            var t = this._proxyVR.getOrCreateStateSet();
            t.setRenderBinDetails(c.TRANSPARENT_BIN_NO_EARLYZ_POST, "RenderBin"),
            t.setAttributeAndModes(new C.Depth(C.Depth.LESS,0,1,(!1))),
            t.setAttributeAndModes(new C.CullFace(C.CullFace.DISABLE))
        },
        resetCameraToHuman: function() {
            var t = C.Vec3.create()
              , e = C.Vec3.create()
              , i = C.Matrix.create();
            return function() {
                var n = this.getConfigWebVR()
                  , r = n.capabilities.hasPosition && n.stageParameters
                  , a = C.Matrix.copy(this._humanMT.getMatrix(), i);
                C.Matrix.getScale(a, t),
                C.Vec3.set(1 / t[0], 1 / t[1], 1 / t[2], t),
                C.Matrix.preMultScale(a, t);
                var s = this._manipulator.getFirstPersonManipulator()
                  , o = s.getPostMultRotate();
                C.Quat.normalize(C.Matrix.getRotate(a, o), o),
                n.displayName.toLowerCase().indexOf("oculus") >= 0 ? (this._cb && window.removeEventListener("vrdisplayactivate", this._cb),
                this._cb = this._cb || function() {
                    s.setResetInitialRotationVR(!0),
                    window.removeEventListener("vrdisplayactivate", this._cb)
                }
                .bind(this),
                window.addEventListener("vrdisplayactivate", this._cb)) : s.setResetInitialRotationVR(!0),
                C.Matrix.getTrans(a, e),
                r && C.Matrix.isIdentity(r.sittingToStandingTransform) && this.handleBuggyStandingTransform(n, 3),
                e[2] += this.getEyeLevel(),
                this._viewer.getFeaturesManager().focusOnTargetAndEye(void 0, e)
            }
        }(),
        requestData: function(t, e) {
            var i = this.model.get("modeLauncher");
            !t || i || this._dataDownloaded || (this._dataDownloaded = !0,
            this._teleportNode.initTextureTeleport(),
            this._floorMT.initTextureFloor(),
            this._nodeMenu.initialize(e))
        },
        notifyPresentVR: function() {
            var t = this.model.get("enable")
              , e = this.model.get("modeLauncher");
            e && (this._scaleControlEnabled = !1);
            var i;
            this._standaloneViewer ? !t && e && (C.log("Launcher sending requestPresent"),
            i = S.createMessage({
                data: "requestPresent"
            }),
            i.appendToHash(),
            C.log("Launcher sent requestPresent")) : (C.log("Viewer enable after Promise" + t),
            t || (C.log("Viewer SendingExit"),
            i = S.createMessage({
                data: "exit"
            }),
            i.appendToHash(),
            C.log("Viewer SentExit")))
        },
        _exitVR: function() {
            if (p().isApp) {
                var t = S.createMessage({
                    data: "exit"
                });
                t.appendToHash()
            } else
                this.model.set("enable", !1)
        },
        startEnable: function(t, e) {
            var i = this._viewer.getFeatures();
            this.setProxyVisible(t),
            this.requestData(t, i),
            this.updateDistortion(),
            i.background.getModel().set("webVR", t),
            i.postProcess.getModel().set("webVR", t),
            i.manipulator.getModel().set("webVR", t),
            i.hotspot.getModel().set("webVR", t),
            i.shadingStyle.getModel().set("webVR", t),
            i.lighting.getModel().set("webVR", t),
            this._cullConfig.doVR = t,
            this._controllerMT.setListenToEvents(t),
            t ? (this._floorMT.updateNodeVR(this.model.get("boundingBox"), this.model.get("boundingSphere"), this.model.get("worldFactor")),
            this.resetCameraToHuman()) : this._viewer.getFeaturesManager().focusOnHomePosition(),
            this._standaloneViewer ? C.log("Launcher StartEnable: enabled:" + t + " doPresentVR: " + e) : C.log("Viewer StartEnable: enabled:" + t + " doPresentVR: " + e);
            var n = this.getConfigWebVR();
            t && !e || n.isPresenting === t || (this.model.get("hasNativeHMD") ? this._viewerOSGJS.setPresentVR(t).then(this.notifyPresentVR.bind(this), this.notifyPresentVR.bind(this)) : (n.isPresenting = t,
            this.notifyPresentVR()))
        },
        onEnable: function() {
            var t = this.model.get("enable");
            this.startEnable(t, this._standaloneViewer)
        },
        handleBuggyStandingTransform: function(t, e) {
            0 !== e && (C.warn("VR: Handling buggy standing transform Vive"),
            navigator.getVRDisplays().then(function(i) {
                for (var n = 0; n < i.length; ++n)
                    if (i[n].displayName === t.displayName) {
                        t = i[n];
                        break
                    }
                var r = t.capabilities.hasPosition && t.stageParameters;
                if (r && C.Matrix.isIdentity(r.sittingToStandingTransform))
                    return void setTimeout(this.handleBuggyStandingTransform.bind(this, t, --e), 5e3)
            }
            .bind(this)))
        },
        updateDistortion: function() {
            if (!this.model.get("hasNativeHMD")) {
                var t = this._viewer.getFeatures().postProcess.getModel();
                t.set("doDistortionVR", !0);
                var e = this.model.get("deviceInfo")
                  , i = e.getProjectionMatrixLeftEye()
                  , n = e.getProjectionMatrixLeftEye(!0)
                  , r = e.getUndistortedViewportLeftEye()
                  , a = e.device
                  , s = {
                    xScale: r.width / (a.width / 2),
                    yScale: r.height / a.height,
                    xTrans: 2 * (r.x + r.width / 2) / (a.width / 2) - 1,
                    yTrans: 2 * (r.y + r.height / 2) / a.height - 1
                };
                t.set("distortion", e.viewer.distortionCoefficients),
                t.set("projectionLeft", l.projectionMatrixToVector_(i)),
                t.set("unprojectionLeft", l.projectionMatrixToVector_(n, s))
            }
        },
        snapHumanOnFloor: function() {
            this._humanMT.getMatrix()[14] -= this._humanMT.computeDistanceToFloor()
        },
        getEyeLevel: function() {
            var t = this.getConfigWebVR()
              , e = t.capabilities.hasPosition && t.stageParameters;
            return e ? this.getPosVR()[2] : this.model.get("worldFactor") * M
        },
        snapOnFloor: function() {
            var t = this.model.get("worldFactor")
              , e = this._manipulator.getEyePosition(C.Vec3.create())
              , i = C.Vec3.copy(e, C.Vec3.create());
            i[2] -= 5 * t;
            var n = this._viewer.getFeaturesManager()
              , r = n.computeNearestIntersection3D(e, i, h.PICK_GEOMETRY_FAST, this._nodeWebVR);
            if (r) {
                var a = C.Vec3.create();
                n.getWorldPositionFromHit(r, a),
                a[2] += this.getEyeLevel(),
                n.focusOnTargetAndEye(void 0, a)
            }
        },
        onWorldFactor: function() {
            var t = this.model.get("worldFactor");
            this._lastWorldFactor > 0 && this._lastWorldFactor !== t && (C.Vec3.mult(this.getPosVR(), t / this._lastWorldFactor, this.getPosVR()),
            this.model.get("enable") && this.snapOnFloor()),
            this._lastWorldFactor = t;
            var e = this.getConfigWebVR()
              , i = this._cullConfig
              , n = e.getEyeParameters("left")
              , r = e.getEyeParameters("right");
            e.getFrameData(this._frameData);
            var a = 1;
            this._webvrMobileHeight > 0 && (a = Math.min(1, this._webvrMobileHeight / (n.renderHeight || 512))),
            p().vrScaleRTT > 0 && (a = p().vrScaleRTT),
            i.leftRenderWidth = Math.floor(n.renderWidth * a) || 512,
            i.leftRenderHeight = Math.floor(n.renderHeight * a) || 512,
            i.rightRenderWidth = Math.floor(r.renderWidth * a) || 512,
            i.rightRenderHeight = Math.floor(r.renderHeight * a) || 512,
            C.Matrix.copy(this._frameData.leftProjectionMatrix, i.leftProjection),
            C.Matrix.copy(this._frameData.rightProjectionMatrix, i.rightProjection),
            C.Matrix.makeTranslate(-t * n.offset[0], -t * n.offset[1], -t * n.offset[2], i.leftOffsetView),
            C.Matrix.makeTranslate(-t * r.offset[0], -t * r.offset[1], -t * r.offset[2], i.rightOffsetView);
            var s = this._viewerOSGJS.getEventProxy().WebVR;
            s.setWorldScale(t),
            u.draw()
        },
        perspectiveMatrixFromVRFieldOfView: function(t, e, i, n) {
            var r = n || C.Matrix.create()
              , a = Math.PI / 180
              , s = Math.tan(t.upDegrees * a) * e
              , o = Math.tan(t.downDegrees * a) * e
              , u = Math.tan(t.leftDegrees * a) * e
              , l = Math.tan(t.rightDegrees * a) * e;
            return C.Matrix.makeFrustum(-u, l, -o, s, e, i, r),
            r
        },
        hookComputeCanvasSize: function() {
            var t = this._viewerOSGJS
              , e = t.computeCanvasSize
              , i = this
              , n = this._cullConfig;
            t.computeCanvasSize = function(r) {
                var a = i.model.get("enable");
                if (!a)
                    return e.call(t, r);
                i.model.get("hasNativeHMD") && i.onWorldFactor();
                var s = Math.floor(n.leftRenderWidth + n.rightRenderWidth)
                  , o = Math.floor(Math.max(n.leftRenderHeight, n.rightRenderHeight))
                  , u = Math.max(s, o);
                if (!a && u > 4096) {
                    var l = 4096 / u;
                    s = Math.floor(s * l),
                    o = Math.floor(o * l)
                }
                var c = !1;
                return this._canvasWidth !== s && (r.width = s,
                this._canvasWidth = s,
                c = !0),
                this._canvasHeight !== o && (r.height = o,
                this._canvasHeight = o,
                c = !0),
                c
            }
        },
        getConfigWebVR: function() {
            var t = this._viewerOSGJS
              , e = t.getVRDisplay();
            if (e)
                return this._frameData = new window.VRFrameData,
                e;
            if (this._defaultHMD)
                return this._defaultHMD;
            var i = this.model.get("deviceInfo")
              , n = .5 * i.viewer.interLensDistance
              , r = i.getUndistortedViewportLeftEye();
            this._frameData = {
                leftProjectionMatrix: this.perspectiveMatrixFromVRFieldOfView(i.getFieldOfViewLeftEye(!1), .1, 1e3, C.Matrix.create()),
                rightProjectionMatrix: this.perspectiveMatrixFromVRFieldOfView(i.getFieldOfViewRightEye(!1), .1, 1e3, C.Matrix.create())
            };
            var a = {
                left: {
                    offset: C.Vec3.createAndSet(-n, 0, 0),
                    renderWidth: r.width,
                    renderHeight: r.height
                },
                right: {
                    offset: C.Vec3.createAndSet(n, 0, 0),
                    renderWidth: r.width,
                    renderHeight: r.height
                }
            };
            return this._defaultHMD = {
                displayName: "fake-cardboard",
                isPresenting: !1,
                getFrameData: function(t) {
                    return t
                },
                getEyeParameters: function(t) {
                    return a[t]
                },
                capabilities: {
                    hasPosition: !1,
                    hasRotation: !1,
                    hasExternalDisplay: !1
                }
            },
            this._defaultHMD
        },
        getPosVR: function() {
            var t = C.Vec3.create();
            return function() {
                return this._manipulator.getCurrentManipulator()._vrPos || C.Vec3.init(t)
            }
        }(),
        getTeleportPosFromHotspot: function() {
            var t = C.Vec3.create()
              , e = C.Vec3.create()
              , i = C.Vec3.create()
              , n = C.Vec3.create();
            return function(r, a, s, o) {
                var u = this._viewer.getFeaturesManager()
                  , l = this.model.get("worldFactor");
                u.getWorldPositionFromScenePoint(C.Matrix.getTrans(r.getHotspotMatrix(), t), e),
                C.Vec3.sub(e, a, t),
                t[2] = 0,
                C.Vec3.normalize(t, t),
                C.Vec3.mult(t, 2.5 * l, t),
                C.Vec3.sub(e, t, i),
                i[2] = e[2] + l,
                C.Vec3.copy(i, n),
                n[2] -= 3.5 * l;
                var c = u.computeNearestIntersection3D(i, n, h.PICK_GEOMETRY_FAST, this._nodeWebVR);
                c ? (u.getWorldPositionFromHit(c, s, o),
                c.backface && C.Vec3.neg(o, o)) : (C.Vec3.copy(i, s),
                s[2] -= this.getEyeLevel(),
                C.Vec3.set(0, 0, 1, o)),
                this._teleportNode.setHotspotHint(r.canTeleport(), s, e, l),
                r.setWorldTeleportPosition(e, s, l)
            }
        }(),
        updateHitHotspot: function() {
            var t = function(t) {
                return t instanceof g
            };
            return function(e, i, r, a, s) {
                var o = this._viewer.getFeatures().hotspot.getNodeProxy()
                  , u = e && e.nodepath.indexOf(o) !== -1;
                if (this._lastHoveredHotspot && this._lastHoveredHotspot.setHovered(!1),
                !u)
                    return this._lastHoveredHotspot && this._lastHoveredHotspot.updateCardHit(),
                    this._lastHoveredHotspot = void 0,
                    void this._teleportNode.setHotspotHint(!1);
                var l = this._lastHoveredHotspot = n.find(e.nodepath, t);
                if (l.updateCardHit(e),
                l.setHovered(!0),
                l.isFullyVisibleCard())
                    return l;
                this.getTeleportPosFromHotspot(l, i, a, s);
                var c = this._viewer.getFeatures().hotspot.getModel();
                return c.set("currentHotspotIndex", l.getIndex()),
                l
            }
        }(),
        handleHitPicking: function(t, e, i, n, r, a, s) {
            var o, u = this._viewer.getFeaturesManager(), l = this.model.get("worldFactor"), c = this._floorMT.getBoundingSphere(), d = C.Vec3.distance(e, c.center()) + c.radius();
            return t ? o = u.computeNearestIntersection2D(this._lastMouse[0], this._lastMouse[1], h.PICK_GEOMETRY_FAST) : this._controllerMT.isPosedController() ? (o = this._controllerMT.raycastFromController(this._nodeWebVR, u, d, a, s),
            o ? (u.getWorldPositionFromHit(o, n, r),
            o.backface && C.Vec3.neg(r, r),
            this._controllerMT.updatePointerScaleFromHit(n, l),
            this._cursorMT.setColor(C.Vec3.createAndSet(.1, .66, .85))) : (this._controllerMT.resetPointerScale(),
            C.Vec3.copy(s, n))) : (C.Vec3.copy(e, a),
            C.Vec3.copy(i, s),
            C.Vec3.mult(i, d, s),
            C.Vec3.add(a, s, s),
            o = u.computeNearestIntersection3DHotspotFirst(a, s, h.PICK_GEOMETRY_FAST, this._nodeWebVR),
            o ? (u.getWorldPositionFromHit(o, n, r),
            o.backface && C.Vec3.neg(r, r)) : (C.Vec3.mult(i, 3 * l, n),
            C.Vec3.add(e, n, n))),
            o
        },
        goToNextHotspot: function() {
            var t = this._viewer.getFeatures().postProcess.getModel();
            t.fadeForTeleportVR(this.doTeleportToHotspot.bind(this, 1))
        },
        doTeleportToHotspot: function(t) {
            this._nodeMenu && this._nodeMenu.isVisible() && this._nodeMenu.hide();
            var e = this.computeHotspotIndex(t);
            e !== -1 && (this.moveToHotspotWithIndex(e),
            this.displayHotspotCardForIndex(e))
        },
        goToPrevHotspot: function() {
            var t = this._viewer.getFeatures().postProcess.getModel();
            t.fadeForTeleportVR(this.doTeleportToHotspot.bind(this, -1))
        },
        displayHotspotCardForIndex: function(t) {
            var e = this._viewer.getFeatures().hotspot.getNodeProxy().children[t];
            e.isFullyVisibleCard() ? e.onCardHit(this) : (this._lastSelectedHotspot && this._lastSelectedHotspot.setVisibleCard(!1),
            this._lastSelectedHotspot = e,
            e && e.setVisibleCard(!0))
        },
        computeHotspotIndex: function(t) {
            var e = this._viewer.getFeatures().hotspot.getModel()
              , i = e.get("hotspots");
            if (0 === i.length)
                return -1;
            if (1 !== t && t !== -1)
                return console.error("computeHotspotIndex was called with an invalid direction argument. Valid values are 1 for foward -1 for backward."),
                0;
            var n = e.get("currentHotspotIndex")
              , r = i.length;
            return n += t,
            n < 0 && (n = -1),
            n = (n % r + r) % r,
            e.set("currentHotspotIndex", n),
            n
        },
        moveToHotspotWithIndex: function() {
            var t = C.Vec3.create()
              , e = C.Vec3.create()
              , i = C.Vec3.create();
            return function(n) {
                var r = this._viewer.getFeaturesManager()
                  , a = this._viewer.getFeatures().hotspot.getNodeProxy()
                  , s = a.children[n]
                  , o = this._viewer.getFeatures().hotspot.getModel().get("hotspots").at(n);
                r.getWorldPositionFromScenePoint(o.get("eye"), e),
                r.getWorldPositionFromScenePoint(o.get("position"), t),
                this.getTeleportPosFromHotspot(s, e, e, i),
                e[2] += this.getEyeLevel();
                var u = this._manipulator.getFirstPersonManipulator();
                u.setInitialPoseVR(e, t)
            }
        }(),
        update: function() {
            var t = C.Vec3.create()
              , e = C.Vec3.create()
              , i = C.Vec3.create()
              , n = C.Vec3.create()
              , r = C.Vec3.create()
              , a = C.Vec3.create()
              , s = C.Vec3.create()
              , o = C.Vec3.create();
            return function(l, c) {
                var h = this._viewer.getFeaturesManager()
                  , d = this._viewer.getFeatures()
                  , f = this.model.get("enable")
                  , g = this.model.get("modeLauncher")
                  , m = this._viewer.getOptions().widgetAPI
                  , v = !(!m || "vr" !== m.getTabbedWidget().get());
                if (this.setProxyVisible(f || v),
                d.background.getModel().set("webVR", f || v),
                d.postProcess.getModel().set("webVR", f || v),
                !f && !v)
                    return !0;
                var _ = this.model.get("worldFactor")
                  , b = c.getFrameStamp()
                  , x = b.getSimulationTime()
                  , A = b.getDeltaTime()
                  , y = this.getConfigWebVR();
                this._manipulator.getEyePosition(i),
                this._manipulator.getTarget(n),
                C.Vec3.sub(n, i, n),
                C.Vec3.normalize(n, n);
                var S = this._viewer.getCamera()
                  , M = .02 * this._viewerOSGJS.getCanvasClientWidth() * C.Matrix.getScale(this._cullConfig.leftProjection, o)[0];
                this._controllerMT.updateNodeVR(_, y, A, C.Vec3.sub(i, this.getPosVR(), o));
                var T = this.handleHitPicking(!f && v, i, n, e, t, r, a);
                this.model.set("hit", T),
                C.Vec3.copy(e, s);
                var E = f && !g && this._controllerMT.isTeleportPressed()
                  , I = !g && this._controllerMT.isClickPressed()
                  , k = this._nodeMenu && this._controllerMT.isMenuPressed(this._nodeMenu.isVisible())
                  , F = T && T.nodepath.indexOf(this._nodeMenu) === -1 && (E || I) && this._nodeMenu.isVisible()
                  , D = f && p().vrMenu && (k || F);
                D && (this._manipulator.getTarget(o),
                this._nodeMenu.isVisible() ? this._nodeMenu.hide() : this._nodeMenu.display(i, o, this.model.get("worldFactor")));
                var N, R, P = !1;
                if (f && !g) {
                    R = this._nodeMenu.updateHit(T),
                    N = this.updateHitHotspot(T, r, a, s, t),
                    this._teleportNode.updateWorldNormal(b, t);
                    var L = T && t[2] > .5
                      , O = N ? N.canTeleport() : L
                      , V = T && T.nodepath.indexOf(this._floorMT) !== -1
                      , B = N ? N.canTeleport() : L && (!this.model.isDiorama() || V);
                    E && x - this._lastTime > .5 && (O && (P = !0,
                    this._lastTime = x,
                    s[2] += this.getEyeLevel(),
                    h.focusOnTargetAndEye(C.Vec3.add(s, n, o), s)),
                    N && (N.isFullyVisibleCard() ? N.onCardHit(this) : (this._lastSelectedHotspot && this._lastSelectedHotspot.setVisibleCard(!1),
                    this._lastSelectedHotspot = N,
                    N && N.setVisibleCard(!0))),
                    R && R.click()),
                    this._interpolatorAlpha.setTarget(B ? 1 : 0),
                    this._interpolatorAlpha.update(b.getDeltaTime())
                }
                var U = C.Vec3.distance(i, e) / M
                  , G = D ? 0 : this._interpolatorAlpha.getCurrent()[0];
                this._cursorMT.setVisible(f),
                this._teleportNode.setVisible(!P && T && !g && f && !k),
                this._humanMT.setVisible(v),
                this._floorMT.setVisible(!g),
                this._floorMT.updateNodeVR(this.model.get("boundingBox"), this.model.get("boundingSphere"), _),
                this._humanMT.updateNodeVR(T, x),
                this._teleportNode.updateNodeVR(G, T, b, s, _, U, t),
                this._cursorMT.updateNodeVR(g || N ? 1 : 1 - G, S, e, U),
                this._nodeMenu && this._lastSelectedHotspot && this._nodeMenu.isVisible() && this._lastSelectedHotspot.isFullyVisibleCard() && this._lastSelectedHotspot.setVisibleCard(!1);
                var z = this._controllerMT.checkScaleChangeValue();
                return this._scaleControlEnabled && 0 !== z && (z = this.model.get("worldFactor") * Math.abs(z) * (z > 0 ? w : 1 / w),
                this.model.set("worldFactor", z)),
                this._controllerMT.resetButtons(),
                u.draw(),
                !0
            }
        }()
    });
    t.exports = T
}
, function(t, e, i) {
    var n = i(1681)
      , r = ":"
      , a = ";"
      , s = ","
      , o = "="
      , u = "&"
      , l = function(t) {
        t = t || "",
        t = decodeURIComponent(t);
        var e = {}
          , i = t.split(u);
        return i.forEach(function(t) {
            if (t.indexOf(o) > -1) {
                var i = t.split(o);
                e[i[0]] = i[1]
            } else
                e = t.indexOf(s) > -1 ? t.split(s) : t
        }
        .bind(this)),
        e
    }
      , c = function(t, e) {
        var i = t;
        i.indexOf("#") > -1 && (i = i.slice(1));
        var n = i.split(a)
          , r = [];
        for (var s in n) {
            var o = new d(h(n[s]));
            o.from && o.from === e || !o.data || r.push(o)
        }
        return r
    }
      , h = function(t) {
        var e = t
          , i = {};
        e.indexOf("#") > -1 && (e = e.slice(1));
        var n = e.split(r);
        return 1 === n.length ? i.data = n[0] : 2 === n.length ? (i.from = n[0].toUpperCase(),
        i.data = n[1]) : 3 === n.length && (i.from = n[0].toUpperCase(),
        i.to = n[1].toUpperCase(),
        i.data = n[2]),
        i.data && (i.stringData = i.data,
        i.data = l(i.data)),
        i._originalString = t + a,
        i
    }
      , d = function(t) {
        var e = t;
        "string" == typeof t && (e = h(t)),
        this._msg = e,
        this.from = e.from,
        this.to = e.to,
        this.data = p(e.data)
    }
      , p = function(t) {
        return "string" == typeof t ? t = decodeURIComponent(t) : Array.isArray(t) ? t = t.map(decodeURIComponent) : "object" === (typeof t).toLowerCase() && Object.keys(t).forEach(function(e) {
            "string" == typeof t[e] ? t[e] = decodeURIComponent(t[e]) : Array.isArray(t[e]) && (t[e] = t[e].map(decodeURIComponent))
        }
        .bind(this)),
        t
    };
    d.prototype._getStringifiedData = function() {
        var t = "";
        if ("string" == typeof this.data)
            return encodeURIComponent(this.data);
        if (Array.isArray(this.data))
            return this.data.map(encodeURIComponent).join(",");
        if ("object" == typeof this.data)
            for (var e in this.data) {
                var i;
                "string" == typeof this.data[e] ? i = encodeURIComponent(this.data[e]) : Array.isArray(this.data[e]) && (i = this.data[e].map(encodeURIComponent).join(",")),
                t += e + o + i
            }
        return t
    }
    ,
    d.prototype.toString = function() {
        var t = "";
        return this.from && (t += this.from + r),
        this.to && (t += this.to + r),
        t += this._getStringifiedData() + a
    }
    ;
    var f = function(t) {
        if (t = t || {},
        !t.device)
            throw new Error('ViewerHashAPI options need to contain the "device" identifier property');
        t.listen && this.listen(t.listen),
        this.device = t.device
    };
    f.prototype.appendToHash = function(t, e) {
        t instanceof d && (t = t.toString()),
        "string" == typeof t && (e = g(e),
        e.location.hash.indexOf(t) === -1 && (e.location.hash = e.location.hash + t))
    }
    ,
    f.prototype.removeFromHash = function(t, e) {
        if (!(t instanceof d))
            throw new Error("Please supply an instance of ViewerHashMessage");
        e = g(e);
        var i = e.location.hash;
        i = t._msg && t._msg._originalString ? i.replace(t._msg._originalString, "") : i.replace(t.toString(), ""),
        e.location.hash = i
    }
    ;
    var g = function(t) {
        if (t = (t === !0 ? window : t) || window,
        t && t.tagName && "iframe" === t.tagName.toLowerCase() && (t = t.contentWindow),
        !t.addEventListener)
            throw new Error("Could not bind an event to supplied target. Please supply an instance of window or an iframe.");
        return t
    };
    f.prototype.listen = function(t) {
        return t = g(t),
        t.addEventListener("hashchange", this._onHashChange.bind(this, t), !1)
    }
    ,
    f.prototype._onHashChange = function(t) {
        var e = this.getMessages(t.location.hash)
          , i = e.messages || [];
        i.forEach(function(t) {
            if (t)
                if (t.data && !Array.isArray(t)) {
                    var e = t.data;
                    if ("object" == typeof t.data) {
                        var i = Object.keys(t.data);
                        e = t.data._key ? t.data._key : i[0]
                    }
                    e && this.trigger("message:" + e, t)
                } else
                    this.trigger("message", t)
        }
        .bind(this))
    }
    ,
    f.prototype.getMessages = function(t) {
        var e = c(t, this.device)
          , i = t;
        for (var n in e)
            i = e[n]._msg && e[n]._msg._originalString ? i.replace(e[n]._msg._originalString, "") : i.replace(e[n].toString(), "");
        return {
            messages: e,
            hash: i
        }
    }
    ,
    f.prototype.createMessage = function(t) {
        return t = t || {},
        t.from = this.device,
        new d(t)
    }
    ,
    n.mixin(f.prototype),
    d.prototype.removeFromHash = function() {
        f.prototype.removeFromHash.call(this, this)
    }
    ,
    d.prototype.appendToHash = function() {
        f.prototype.appendToHash.call(this, this)
    }
    ,
    t.exports = f
}
, function(t, e, i) {
    t.exports = i(1682)
}
, function(t, e, i) {
    !function() {
        function i() {
            return {
                keys: Object.keys || function(t) {
                    if ("object" != typeof t && "function" != typeof t || null === t)
                        throw new TypeError("keys() called on a non-object");
                    var e, i = [];
                    for (e in t)
                        t.hasOwnProperty(e) && (i[i.length] = e);
                    return i
                }
                ,
                uniqueId: function(t) {
                    var e = ++o + "";
                    return t ? t + e : e
                },
                has: function(t, e) {
                    return a.call(t, e)
                },
                each: function(t, e, i) {
                    if (null != t)
                        if (r && t.forEach === r)
                            t.forEach(e, i);
                        else if (t.length === +t.length)
                            for (var n = 0, a = t.length; n < a; n++)
                                e.call(i, t[n], n, t);
                        else
                            for (var s in t)
                                this.has(t, s) && e.call(i, t[s], s, t)
                },
                once: function(t) {
                    var e, i = !1;
                    return function() {
                        return i ? e : (i = !0,
                        e = t.apply(this, arguments),
                        t = null,
                        e)
                    }
                }
            }
        }
        var n, r = Array.prototype.forEach, a = Object.prototype.hasOwnProperty, s = Array.prototype.slice, o = 0, u = i();
        n = {
            on: function(t, e, i) {
                if (!c(this, "on", t, [e, i]) || !e)
                    return this;
                this._events || (this._events = {});
                var n = this._events[t] || (this._events[t] = []);
                return n.push({
                    callback: e,
                    context: i,
                    ctx: i || this
                }),
                this
            },
            once: function(t, e, i) {
                if (!c(this, "once", t, [e, i]) || !e)
                    return this;
                var n = this
                  , r = u.once(function() {
                    n.off(t, r),
                    e.apply(this, arguments)
                });
                return r._callback = e,
                this.on(t, r, i)
            },
            off: function(t, e, i) {
                var n, r, a, s, o, l, h, d;
                if (!this._events || !c(this, "off", t, [e, i]))
                    return this;
                if (!t && !e && !i)
                    return this._events = {},
                    this;
                for (s = t ? [t] : u.keys(this._events),
                o = 0,
                l = s.length; o < l; o++)
                    if (t = s[o],
                    a = this._events[t]) {
                        if (this._events[t] = n = [],
                        e || i)
                            for (h = 0,
                            d = a.length; h < d; h++)
                                r = a[h],
                                (e && e !== r.callback && e !== r.callback._callback || i && i !== r.context) && n.push(r);
                        n.length || delete this._events[t]
                    }
                return this
            },
            trigger: function(t) {
                if (!this._events)
                    return this;
                var e = s.call(arguments, 1);
                if (!c(this, "trigger", t, e))
                    return this;
                var i = this._events[t]
                  , n = this._events.all;
                return i && h(i, e),
                n && h(n, arguments),
                this
            },
            stopListening: function(t, e, i) {
                var n = this._listeners;
                if (!n)
                    return this;
                var r = !e && !i;
                "object" == typeof e && (i = this),
                t && ((n = {})[t._listenerId] = t);
                for (var a in n)
                    n[a].off(e, i, this),
                    r && delete this._listeners[a];
                return this
            }
        };
        var l = /\s+/
          , c = function(t, e, i, n) {
            if (!i)
                return !0;
            if ("object" == typeof i) {
                for (var r in i)
                    t[e].apply(t, [r, i[r]].concat(n));
                return !1
            }
            if (l.test(i)) {
                for (var a = i.split(l), s = 0, o = a.length; s < o; s++)
                    t[e].apply(t, [a[s]].concat(n));
                return !1
            }
            return !0
        }
          , h = function(t, e) {
            var i, n = -1, r = t.length, a = e[0], s = e[1], o = e[2];
            switch (e.length) {
            case 0:
                for (; ++n < r; )
                    (i = t[n]).callback.call(i.ctx);
                return;
            case 1:
                for (; ++n < r; )
                    (i = t[n]).callback.call(i.ctx, a);
                return;
            case 2:
                for (; ++n < r; )
                    (i = t[n]).callback.call(i.ctx, a, s);
                return;
            case 3:
                for (; ++n < r; )
                    (i = t[n]).callback.call(i.ctx, a, s, o);
                return;
            default:
                for (; ++n < r; )
                    (i = t[n]).callback.apply(i.ctx, e)
            }
        }
          , d = {
            listenTo: "on",
            listenToOnce: "once"
        };
        u.each(d, function(t, e) {
            n[e] = function(e, i, n) {
                var r = this._listeners || (this._listeners = {})
                  , a = e._listenerId || (e._listenerId = u.uniqueId("l"));
                return r[a] = e,
                "object" == typeof i && (n = this),
                e[t](i, n, this),
                this
            }
        }),
        n.bind = n.on,
        n.unbind = n.off,
        n.mixin = function(t) {
            var e = ["on", "once", "off", "trigger", "stopListening", "listenTo", "listenToOnce", "bind", "unbind"];
            return u.each(e, function(e) {
                t[e] = this[e]
            }, this),
            t
        }
        ,
        "undefined" != typeof t && t.exports && (e = t.exports = n),
        e.BackboneEvents = n
    }(this)
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1597)
      , a = i(1516)
      , s = i(1514)
      , o = i(1191)
      , u = i(1684)
      , l = i(1692)
      , c = i(1693)
      , h = i(1694)
      , d = i(1695)
      , p = i(1696)
      , f = i(1697)
      , g = n.osg
      , m = n.osgUtil
      , v = .1
      , _ = g.Vec3.createAndSet(.1, .4, .8)
      , b = g.Vec3.createAndSet(1, .7, .1)
      , x = g.Vec3.createAndSet(1, 0, 0)
      , A = function(t) {
        g.MatrixTransform.call(this),
        this._model = t,
        this.setMatrix(t.get("humanMatrix")),
        this.setName("WebVR - Human"),
        this.setNodeMask(s.NO_SHADOW),
        this.editMask = m.NodeGizmo.NO_FULL_CIRCLE | m.NodeGizmo.PICK_PLANE_Z | m.NodeGizmo.PICK_ARROW | m.NodeGizmo.PICK_ARC_Z,
        this._humanMT = new g.MatrixTransform,
        g.Matrix.makeRotate(Math.PI, 0, 0, 1, this._humanMT.getMatrix()),
        this._geoHuman = new g.Geometry,
        this._humanMT.addChild(this._geoHuman),
        this._uColorCylinder = g.Uniform.createFloat3(g.Vec3.copy(_, g.Vec3.create()), "uColor"),
        this._uColorHint = g.Uniform.createFloat3(g.Vec3.copy(b, g.Vec3.create()), "uColor"),
        this._hintToFloorMT = new g.MatrixTransform,
        this._geoHintToFloor = g.createTexturedBoxGeometry(0, 0, -.5, .02, .02, 1),
        this._hintToFloorMT.addChild(this._geoHintToFloor),
        this._hintToFloorMT.setNodeMask(s.NO_PICK),
        this._geoCylinder = m.GizmoGeometry.createCylinderGeometry(1, 1, 1, 50, 1, !1, !1),
        this._geoCylinder.setNodeMask(s.NO_PICK);
        for (var e = 0, i = this._geoCylinder.getAttributes().Vertex.getElements(), n = i.length / 3; e < n; ++e)
            i[3 * e + 2] += .5;
        this._cylinderMT = new g.MatrixTransform,
        g.Matrix.makeScale(1, 1, .5, this._cylinderMT.getMatrix()),
        this._cylinderMT.addChild(this._geoCylinder),
        this.addChild(this._humanMT),
        this.addChild(this._cylinderMT),
        this.addChild(this._hintToFloorMT),
        this._boundingBoxComputed = !0,
        this._boundingSphereComputed = !0,
        this.init()
    };
    A.prototype = g.objectInherit(g.MatrixTransform.prototype, {
        init: function() {
            this.getOrCreateStateSet().setAttributeAndModes(new g.CullFace(g.CullFace.BACK));
            var t = this._humanMT.getOrCreateStateSet();
            t.setAttributeAndModes(r.createShader(l, c, "webVR-human", "VRHuman")),
            t.setRenderBinDetails(a.OPAQUE_BIN, "RenderBin"),
            o() && u.getHuman(this.initHumanMesh.bind(this));
            var e = this._geoHintToFloor.getOrCreateStateSet();
            e.setAttributeAndModes(r.createShader(p, f, "webVR-hintToFloor", "VRHintToFloor")),
            e.addUniform(this._uColorHint),
            e.setRenderBinDetails(a.TRANSPARENT_BIN_NO_EARLYZ_POST, "RenderBin");
            var i = this._geoCylinder.getOrCreateStateSet();
            i.setAttributeAndModes(r.createShader(h, d, "webVR-humanCylinder", "VRHumanCylinder")),
            i.addUniform(this._uColorCylinder),
            i.addUniform(g.Uniform.createFloat(1, "uAlpha")),
            i.setRenderBinDetails(a.TRANSPARENT_BIN_NO_EARLYZ_POST, "RenderBin")
        },
        initHumanMesh: function(t) {
            var e = this._geoHuman;
            e.getAttributes().Vertex = new g.BufferArray(g.BufferArray.ARRAY_BUFFER,t.VERTEX,3),
            e.getAttributes().Color = new g.BufferArray(g.BufferArray.ARRAY_BUFFER,t.COLOR,4),
            e.getPrimitives().push(new g.DrawElements(g.PrimitiveSet.TRIANGLES,new g.BufferArray(g.BufferArray.ELEMENT_ARRAY_BUFFER,t.TRIANGLES,1))),
            e.getPrimitives().push(new g.DrawElements(g.PrimitiveSet.TRIANGLE_STRIP,new g.BufferArray(g.BufferArray.ELEMENT_ARRAY_BUFFER,t.STRIP,1)))
        },
        setVisible: function(t) {
            this.setNodeMask(t ? s.NO_SHADOW : 0)
        },
        computeDistanceToFloor: function() {
            var t = g.Vec3.create()
              , e = g.Vec3.create();
            return function() {
                var i = this.getMatrix()
                  , n = this._model
                  , r = n._viewer.getFeaturesManager()
                  , a = n.get("worldFactor")
                  , o = n.get("floorHeight");
                g.Matrix.getTrans(i, t),
                g.Vec3.copy(t, e);
                var u = v * a;
                t[2] += u,
                e[2] -= 100 * a,
                this.setVisible(!1);
                var l = r.computeNearestIntersection3D(t, e, s.PICK_GEOMETRY_SLOW);
                return this.setVisible(!0),
                u = l ? g.Vec3.distance(t, r.getWorldPositionFromHit(l, e)) : t[2] - o,
                Math.max(0, u - v * a)
            }
        }(),
        updateNodeVR: function() {
            var t = g.Vec3.create();
            return function(e, i) {
                if (0 !== this.getNodeMask()) {
                    var n = this.getMatrix()
                      , r = this._model
                      , a = r._viewer.getFeaturesManager()
                      , s = r.get("worldFactor")
                      , o = r.get("floorHeight");
                    g.Vec3.lerp(.5 * Math.sin(10 * i) + .5, b, x, this._uColorHint.getInternalArray()),
                    g.Matrix.getScale(n, t),
                    g.Vec3.set(s / t[0], s / t[1], s / t[2], t),
                    g.Matrix.preMultScale(n, t),
                    n[14] = Math.max(n[14], o);
                    var u = a._nodeGizmo._attachedNode === this || e && e.nodepath.indexOf(this._humanMT) !== -1;
                    g.Vec3.copy(u ? b : _, this._uColorCylinder.getInternalArray());
                    var l = this.computeDistanceToFloor() / s
                      , c = l > .05;
                    g.Matrix.makeScale(1, 1, c ? l : 1e-7, this._hintToFloorMT.getMatrix()),
                    this._model.set("humanInAir", c),
                    this.dirtyBound()
                }
            }
        }()
    }),
    t.exports = A
}
, function(t, e, i) {
    "use strict";
    t.exports = {
        getBaseVR: function(t) {
            i.e(13, function() {
                t(i(1685))
            })
        },
        getController: function(t) {
            i.e(14, function() {
                t(i(1690))
            })
        },
        getHuman: function(t) {
            i.e(15, function() {
                t(i(1691))
            })
        }
    }
}
, , , , , , , , function(t, e) {
    t.exports = "attribute vec3 Vertex;\nattribute vec4 Color;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec3 vColor;\n\nvoid main(void) {\n  vColor = Color.rgb;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec3 vColor;\n\nuniform int uOutputLinear;\nuniform float uRGBMRange;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec3 color = uOutputLinear == 0 ? linearTosRGB(vColor) : vColor;\n\n  gl_FragColor = encodeRGBM(color, uRGBMRange);\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying float vHeight;\n\nvoid main(void) {\n  vHeight = Vertex.z;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"
}
, function(t, e) {
    t.exports = 'uniform vec3 uColor;\nuniform float uAlpha;\nuniform int uOutputLinear;\n\nvarying float vHeight;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uColor, 1.0) * uAlpha * smoothstep(1.0, 0.0, pow(vHeight, 0.3));\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'
}
, 1694, function(t, e) {
    t.exports = 'uniform vec3 uColor;\nuniform int uOutputLinear;\n\nvarying float vHeight;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uColor, 1.0) * smoothstep(1.0, 0.0, vHeight + 1.0);\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1597)
      , a = i(1514)
      , s = i(1197)
      , o = i(1684)
      , u = i(1484)
      , l = i(1699)
      , c = i(1700)
      , h = i(1694)
      , d = i(1695)
      , p = n.osg
      , f = n.osgUtil
      , g = function() {
        p.Node.call(this),
        this.setName("WebVR - Teleport"),
        this.setVisible(!0),
        this._interpolatorNormal = new n.osgGA.OrbitManipulator.Interpolator(3),
        this._interpolatorNormal.setDelay(.08),
        this._geoCircle1 = p.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0),
        this._geoCircle2 = p.createTexturedQuadGeometry(-.5, -.5, .15, 1, 0, 0, 0, 1, 0),
        this._geoCircle3 = p.createTexturedQuadGeometry(-.5, -.5, .15, 1, 0, 0, 0, 1, 0),
        this._uAlpha1 = p.Uniform.createFloat(1, "uAlpha"),
        this._uAlpha2 = p.Uniform.createFloat(1, "uAlpha"),
        this._uAlpha3 = p.Uniform.createFloat(1, "uAlpha"),
        this._uScale1 = p.Uniform.createFloat(1, "uScale"),
        this._uScale2 = p.Uniform.createFloat(.99, "uScale"),
        this._uScale3 = p.Uniform.createFloat(.99, "uScale"),
        this._geoCylinder = f.GizmoGeometry.createCylinderGeometry(1, 1, 1, 50, 1, !1, !1);
        for (var t = 0, e = this._geoCylinder.getAttributes().Vertex.getElements(), i = e.length / 3; t < i; ++t)
            e[3 * t + 2] += .5;
        this._cylinderMT = new p.MatrixTransform,
        p.Matrix.makeScale(.38, .38, .125, this._cylinderMT.getMatrix()),
        this._cylinderMT.addChild(this._geoCylinder),
        this._hotspotHintMT = new p.MatrixTransform,
        this._hotspotHintMT.addChild(this._geoCylinder),
        this._hotspotHintMT.setNodeMask(0),
        this._teleportMT = new p.MatrixTransform,
        this._teleportMT.addChild(this._geoCircle1),
        this._teleportMT.addChild(this._geoCircle2),
        this._teleportMT.addChild(this._geoCircle3),
        this._teleportMT.addChild(this._cylinderMT),
        this.addChild(this._teleportMT),
        this.addChild(this._hotspotHintMT),
        this.init()
    };
    g.prototype = p.objectInherit(p.Node.prototype, {
        init: function() {
            var t = this.getOrCreateStateSet();
            t.setAttributeAndModes(r.createShader(l, c, "webVR-teleportCircle", "VRTeleportCircle")),
            t.addUniform(p.Uniform.createInt(0, "uTextureTeleportCircle")),
            t.setTextureAttributeAndModes(0, u.dummyTexture),
            this._geoCircle1.getOrCreateStateSet().addUniform(this._uScale1),
            this._geoCircle2.getOrCreateStateSet().addUniform(this._uScale2),
            this._geoCircle3.getOrCreateStateSet().addUniform(this._uScale3),
            this._geoCircle1.getOrCreateStateSet().addUniform(this._uAlpha1),
            this._geoCircle2.getOrCreateStateSet().addUniform(this._uAlpha2),
            this._geoCircle3.getOrCreateStateSet().addUniform(this._uAlpha3);
            var e = this._cylinderMT.getOrCreateStateSet();
            e.addUniform(p.Uniform.createFloat3(p.Vec3.createAndSet(.7, .7, .3), "uColor")),
            e.addUniform(this._uAlpha1);
            var i = this._hotspotHintMT.getOrCreateStateSet();
            i.addUniform(p.Uniform.createFloat3(p.Vec3.createAndSet(.1, .66, .85), "uColor")),
            i.addUniform(this._uAlpha1),
            this._geoCylinder.getOrCreateStateSet().setAttributeAndModes(r.createShader(h, d, "webVR-teleportCylinder", "VRTeleportCylinder"))
        },
        initTextureTeleport: function() {
            o.getBaseVR(this.replaceTextureTeleport.bind(this))
        },
        replaceTextureTeleport: function(t) {
            this.getOrCreateStateSet().setTextureAttributeAndModes(0, s.instance.getOrCreateTexture(t.TELEPORT_CIRCLE).texture)
        },
        setVisible: function(t) {
            this.setNodeMask(t ? a.NO_PICK_NO_SHADOW : 0)
        },
        setHotspotHint: function() {
            var t = p.Vec3.create()
              , e = p.Vec3.createAndSet(0, 0, 1)
              , i = p.Quat.create();
            return function(n, r, a, s) {
                if (this._hotspotHintMT.setNodeMask(n ? -1 : 0),
                r) {
                    p.Vec3.sub(a, r, t);
                    var o = p.Vec3.length(t);
                    p.Vec3.normalize(t, t),
                    p.Quat.makeRotateFromTo(e, t, i);
                    var u = this._hotspotHintMT.getMatrix();
                    p.Matrix.makeRotateFromQuat(i, u);
                    var l = .02;
                    p.Matrix.preMultScale(u, p.Vec3.set(l * s, l * s, o, t)),
                    p.Matrix.setTrans(u, r[0], r[1], r[2])
                }
            }
        }(),
        updateWorldNormal: function(t, e) {
            this._interpolatorNormal.setTarget(e[0], e[1], e[2]),
            this._interpolatorNormal.update(t.getDeltaTime()),
            p.Vec3.normalize(this._interpolatorNormal.getCurrent(), e)
        },
        updateNodeVR: function() {
            var t = p.Vec3.createAndSet(0, 0, 1)
              , e = p.Vec3.create();
            return function(i, n, r, s, o, u, l) {
                var c = this._teleportMT.getMatrix();
                if (this.getNodeMask()) {
                    var h = Math.acos(p.Vec3.dot(t, l));
                    p.Vec3.cross(l, t, e),
                    p.Matrix.makeRotate(-h, e[0], e[1], e[2], c);
                    var d = Math.min(Math.max(o, u), 50 * u);
                    p.Matrix.preMultScale(c, p.Vec3.set(d, d, d, e)),
                    p.Matrix.setTrans(c, s[0], s[1], s[2] + .05 * o),
                    this.setNodeMask(a.NO_PICK_NO_SHADOW)
                }
                var f = r.getSimulationTime()
                  , g = f % .99
                  , m = (f + .2) % .99;
                this._uScale2.setFloat(g),
                this._uScale3.setFloat(m),
                this._uAlpha1.setFloat(i),
                this._uAlpha2.setFloat(i * (1 - g * g)),
                this._uAlpha3.setFloat(i * (1 - m * m)),
                this._teleportMT.dirtyBound()
            }
        }()
    }),
    t.exports = g
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nuniform float uScale;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n\n  vec3 posLocal = Vertex.xyz * vec3(uScale, uScale, 1.0 - uScale);\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(posLocal, 1.0));\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureTeleportCircle;\nuniform float uScale;\nuniform float uAlpha;\nuniform int uOutputLinear;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec3 tex = sRGBToLinear(texture2D(uTextureTeleportCircle, vTexCoord0).rgb);\n  vec4 color = uScale == 1.0 ? vec4(tex.rrr, 1.0) * uAlpha * tex.g : vec4(uAlpha * tex.b);\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1597)
      , a = i(1514)
      , s = i(1516)
      , o = i(1702)
      , u = i(1703)
      , l = n.osg
      , c = function() {
        l.MatrixTransform.call(this),
        this.setName("WebVR - Cursor"),
        this.setVisible(!0),
        this._geom = l.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0),
        this._uAlpha = l.Uniform.createFloat(1, "uAlpha"),
        this._uColor = l.Uniform.createFloat3(l.Vec3.createAndSet(.7, .7, .7), "uCursorColor"),
        this.addChild(this._geom),
        this.init()
    };
    c.prototype = l.objectInherit(l.MatrixTransform.prototype, {
        init: function() {
            var t = l.StateAttribute.OVERRIDE | l.StateAttribute.ON
              , e = this.getOrCreateStateSet();
            e.setAttributeAndModes(r.createShader(o, u, "webVR-cursor", "VRCursor"), t),
            e.setRenderBinDetails(s.VR_CURSOR, "RenderBin"),
            e.setAttributeAndModes(new l.BlendFunc(l.BlendFunc.ONE,l.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            e.addUniform(this._uColor),
            e.addUniform(this._uAlpha)
        },
        setVisible: function(t) {
            this.setNodeMask(t ? a.NO_PICK_NO_SHADOW : 0)
        },
        setColor: function(t) {
            l.Vec3.copy(t, this._uColor.getInternalArray())
        },
        updateNodeVR: function() {
            var t = l.Vec3.create()
              , e = l.Quat.create();
            return function(i, n, r, a) {
                var s = this.getMatrix();
                l.Matrix.inverse(n.getViewMatrix(), s),
                l.Matrix.makeRotateFromQuat(l.Matrix.getRotate(s, e), s),
                l.Matrix.preMultScale(s, l.Vec3.set(a, a, a, t)),
                l.Matrix.setTrans(s, r[0], r[1], r[2]),
                this._uAlpha.setFloat(i),
                this.dirtyBound()
            }
        }()
    }),
    t.exports = c
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vLocalVertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vLocalVertex = Vertex.xy;\n\n  vec3 posLocal = Vertex.xyz * 0.5;\n  posLocal += vec3(0.0, 0.0, 0.1);\n\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(posLocal, 1.0));\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec2 vLocalVertex;\n\nuniform float uAlpha;\nuniform int uOutputLinear;\nuniform vec3 uCursorColor;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uCursorColor, 1.0) * uAlpha * smoothstep(0.0, 1.0, 1.0 - 2.0 * length(vLocalVertex));\n\n  gl_FragColor = linearTosRGB(color);\n}\n'
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1597)
      , a = i(1514)
      , s = i(1197)
      , o = i(1516)
      , u = i(1191)
      , l = i(1684)
      , c = i(1484)
      , h = i(1705)
      , d = i(1706)
      , p = n.osg
      , f = function(t) {
        p.MatrixTransform.call(this),
        this._model = t,
        this._postMultRotate = t._viewer.getViewerOSGJS().getManipulator().getFirstPersonManipulator().getPostMultRotate(),
        this.setName("WebVR - Floor"),
        this.setNodeMask(a.NO_SHADOW),
        this._cam = new p.Camera,
        this._cam.setNearFarRatio(5e-5),
        this._geom = p.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0),
        this._uScaleToMeter = p.Uniform.createFloat(1, "uScaleToMeter"),
        this._cam.addChild(this._geom),
        this.addChild(this._cam),
        this.init()
    };
    f.prototype = p.objectInherit(p.MatrixTransform.prototype, {
        init: function() {
            var t = this.getOrCreateStateSet();
            t.setAttributeAndModes(r.createShader(h, d, "webVR-floor", "VRFloor")),
            t.addUniform(p.Uniform.createInt(0, "uTextureFloor")),
            t.setTextureAttributeAndModes(0, c.dummyTexture),
            t.addUniform(this._uScaleToMeter),
            t.setRenderBinDetails(o.TRANSPARENT_BIN_NO_EARLYZ_PRE, "RenderBin"),
            t.setAttributeAndModes(new p.Depth(p.Depth.LEQUAL,1,1,(!1))),
            t.setAttributeAndModes(new p.CullFace(p.CullFace.BACK)),
            u() && this.initTextureFloor()
        },
        initTextureFloor: function() {
            l.getBaseVR(this.replaceTextureFloor.bind(this))
        },
        replaceTextureFloor: function(t) {
            this.getOrCreateStateSet().setTextureAttributeAndModes(0, s.instance.getOrCreateTexture(t.FLOOR).texture)
        },
        setVisible: function(t) {
            this.setNodeMask(t ? a.NO_SHADOW : 0)
        },
        updateNodeVR: function() {
            var t = p.Vec3.create();
            return function(e, i, n) {
                var r = this.getMatrix()
                  , a = i.center()
                  , s = e.getMin()[2]
                  , o = 15 * Math.min(i.radius(), e.radius())
                  , u = r[14];
                p.Matrix.makeRotateFromQuat(this._postMultRotate, r),
                p.Matrix.preMultScale(r, p.Vec3.set(o, o, o, t)),
                r[12] = a[0],
                r[13] = a[1],
                r[14] = Math.min(u, s),
                this._uScaleToMeter.setFloat(o / n),
                this._model.set("floorHeight", r[14]),
                this.dirtyBound()
            }
        }()
    }),
    t.exports = f
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  gl_Position = (uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0))).xyww;\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureFloor;\nuniform float uScaleToMeter;\nuniform int uOutputLinear;\n\n#define PI 3.14159265359\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  float fade = smoothstep(0.0, 1.0, 1.0 - length(vTexCoord0 * 2.0 - 1.0));\n  vec4 color = vec4(fade * sRGBToLinear(texture2D(uTextureFloor, (vTexCoord0 * 1.0 - 0.5) * uScaleToMeter).r));\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1597)
      , a = i(1514)
      , s = i(1516)
      , o = i(1684)
      , u = i(285)
      , l = i(1708)
      , c = i(1709)
      , h = i(1710)
      , d = i(1711)
      , p = n.osg
      , f = 20
      , g = .05
      , m = 1.2
      , v = {
        SCALE_THRESHOLD: .3,
        CIRCULAR_BUTTON: 0,
        TRIGGER: 1,
        MENU: 3
    }
      , _ = {
        SCALE_THRESHOLD: .7,
        STICK: 0,
        TRIGGER_UP: 1,
        TRIGGER_SIDE: 2,
        AX: 3,
        BY: 4,
        HOME: 5
    }
      , b = {
        CIRCULAR_BUTTON: 0,
        HOME: 1,
        CIRCULAR_UP: 5,
        CIRCULAR_DOWN: 4
    }
      , x = {
        SCALE_THRESHOLD: .7,
        CIRCULAR_BUTTON: 0
    }
      , A = {
        TOUCHPAD_BUTTON: 0
    }
      , y = function(t, e) {
        p.MatrixTransform.call(this),
        this.setName("WebVR - Controller"),
        this.setNodeMask(a.NO_PICK_NO_SHADOW),
        this._pointerMT = new p.MatrixTransform,
        this._proxyController = new p.Node,
        this._geomPointer = p.createTexturedQuadGeometry(-.5, 0, 0, 1, 0, 0, 0, 1, 0),
        this._geomController = new p.createTexturedBoxGeometry(0,(-.1),0,.1,.2,.1),
        this.addChild(this._proxyController),
        this.addChild(this._pointerMT),
        this._pointerMT.addChild(this._geomPointer),
        this._proxyController.addChild(this._geomController),
        this._activeController = void 0,
        this._isPosedController = !1,
        this._model = t,
        this._postMultRotate = t._viewer.getViewerOSGJS().getManipulator().getFirstPersonManipulator().getPostMultRotate(),
        this._uPointerAlpha = p.Uniform.createFloat1(1, "uAlpha"),
        this._hitScaleOffset = f,
        this._canvas = e,
        this._dataDownloaded = !1,
        this._pressedButtons = [],
        this._gamepadType = void 0,
        this._pointerClicked = !1,
        this._timeSinceLastPointerClick = 0,
        this._menuPressed = !1,
        this._clickPressed = !1,
        this._teleportPressed = !1,
        this._scaleValueChange = 0,
        this._cbPointerDown = this.onPointerDown.bind(this),
        this._cbPointerUp = this.onPointerUp.bind(this),
        this._cbMouseDown = this.onMouseDown.bind(this),
        this._canvasX = 0,
        this._canvasY = 0,
        this.init()
    };
    y.prototype = p.objectInherit(p.MatrixTransform.prototype, {
        init: function() {
            var t = this._proxyController.getOrCreateStateSet();
            t.setAttributeAndModes(r.createShader(l, c, "webVR-controller", "VRController")),
            t.setRenderBinDetails(s.OPAQUE_BIN, "RenderBin"),
            t.addUniform(p.Uniform.createFloat3(p.Vec3.createAndSet(.93, .93, .93), "uMatColor"));
            var e = this._geomPointer.getOrCreateStateSet();
            e.addUniform(this._uPointerAlpha),
            e.setRenderBinDetails(s.VR_CURSOR, "RenderBin"),
            e.setAttributeAndModes(new p.BlendFunc(p.BlendFunc.ONE,p.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            e.setAttributeAndModes(r.createShader(h, d, "webVR-laser", "VRLaser"))
        },
        setEventListeners: function() {
            this._canvas.addEventListener("touchstart", this._cbPointerDown),
            this._canvas.addEventListener("touchend", this._cbPointerUp),
            this._canvas.addEventListener("mousedown", this._cbMouseDown),
            this._canvas.addEventListener("mouseup", this._cbPointerUp)
        },
        removeEventListeners: function() {
            this._canvas.removeEventListener("touchstart", this._cbPointerDown),
            this._canvas.removeEventListener("touchend", this._cbPointerUp),
            this._canvas.removeEventListener("mousedown", this._cbMouseDown),
            this._canvas.removeEventListener("mouseup", this._cbPointerUp)
        },
        setListenToEvents: function(t) {
            t ? this.setEventListeners() : this.removeEventListeners()
        },
        isPosedController: function() {
            return this._isPosedController
        },
        replaceControllerMesh: function(t) {
            var e = this._geomController;
            this._proxyController.removeChild(e);
            var i = t.BODY;
            this._geomController = new p.Geometry,
            this._geomController.getAttributes().Vertex = new p.BufferArray(p.BufferArray.ARRAY_BUFFER,i.VERTEX,3),
            this._geomController.getAttributes().Normal = new p.BufferArray(p.BufferArray.ARRAY_BUFFER,i.NORMAL,3),
            this._geomController.getAttributes().Color = new p.BufferArray(p.BufferArray.ARRAY_BUFFER,i.COLOR,1),
            this._geomController.getPrimitives().push(new p.DrawElements(p.PrimitiveSet.TRIANGLES,new p.BufferArray(p.BufferArray.ELEMENT_ARRAY_BUFFER,i.TRIANGLES,1))),
            this._geomController.getPrimitives().push(new p.DrawElements(p.PrimitiveSet.TRIANGLE_STRIP,new p.BufferArray(p.BufferArray.ELEMENT_ARRAY_BUFFER,i.STRIP,1))),
            this._proxyController.addChild(this._geomController);
            var n = t.BUTTON;
            this._geomControllerButtons = new p.Geometry,
            this._geomControllerButtons.getAttributes().Vertex = new p.BufferArray(p.BufferArray.ARRAY_BUFFER,n.VERTEX,3),
            this._geomControllerButtons.getAttributes().Normal = new p.BufferArray(p.BufferArray.ARRAY_BUFFER,n.NORMAL,3),
            this._geomControllerButtons.getAttributes().Color = new p.BufferArray(p.BufferArray.ARRAY_BUFFER,n.COLOR,1),
            this._geomControllerButtons.getPrimitives().push(new p.DrawElements(p.PrimitiveSet.TRIANGLES,new p.BufferArray(p.BufferArray.ELEMENT_ARRAY_BUFFER,n.TRIANGLES,1))),
            this._geomControllerButtons.getPrimitives().push(new p.DrawElements(p.PrimitiveSet.TRIANGLE_STRIP,new p.BufferArray(p.BufferArray.ELEMENT_ARRAY_BUFFER,n.STRIP,1))),
            this._proxyController.addChild(this._geomControllerButtons),
            this._geomControllerButtons.getOrCreateStateSet().addUniform(p.Uniform.createFloat3(p.Vec3.createAndSet(.03, .59, .78), "uMatColor"))
        },
        onPointerDown: function() {
            u.any && !this._activeController && (this._pointerClicked = !0)
        },
        onPointerUp: function(t) {
            this._pointerClicked = !1,
            u.any || (2 === t.button ? this._menuPressed = !0 : Math.abs(t.pageX - this._canvasX) < 5 && Math.abs(t.pageY - this._canvasY) < 5 && (this._clickPressed = !0,
            this._teleportPressed = !0))
        },
        onMouseDown: function(t) {
            u.any && !this._activeController && this._model.get("hasNativeHMD") && (this._teleportPressed = !0),
            u.any || (this._canvasX = t.pageX,
            this._canvasY = t.pageY)
        },
        updateButtonsPressed: function() {
            if (this._activeController)
                for (var t = this._pressedButtons.length, e = 0; e < t; ++e) {
                    var i = this._activeController.buttons[e].pressed;
                    i !== this._pressedButtons[e] && (this._pressedButtons[e] = i,
                    i ? this.onButtonDown(e) : this.onButtonUp(e))
                }
        },
        updateHoverAxes: function() {
            this._gamepadType === _ && (this._scaleValueChange = 0,
            this.updateScaleChangeFromXAxis(_.SCALE_THRESHOLD))
        },
        updateScaleChangeFromXAxis: function(t) {
            var e = this._activeController.axes[0];
            e > t ? this._scaleValueChange = 1 : e < -t && (this._scaleValueChange = -1)
        },
        updatePointerClick: function(t) {
            if (this._pointerClicked) {
                if (this._timeSinceLastPointerClick > m)
                    return this._menuPressed = !0,
                    this._pointerClicked = !1,
                    void (this._timeSinceLastPointerClick = 0);
                this._timeSinceLastPointerClick += t
            } else
                this._timeSinceLastPointerClick > 0 && this._timeSinceLastPointerClick < m && (u.any && (this._clickPressed = !0,
                this._teleportPressed = !0),
                this._timeSinceLastPointerClick = 0)
        },
        onButtonUp: function(t) {
            if (this._gamepadType === v)
                switch (t) {
                case v.TRIGGER:
                    this._clickPressed = !0,
                    this._teleportPressed = !0;
                    break;
                case v.CIRCULAR_BUTTON:
                    this._scaleValueChange = 0;
                    break;
                case v.MENU:
                    this._menuPressed = !0
                }
            else if (this._gamepadType === _)
                switch (t) {
                case _.TRIGGER_UP:
                    this._clickPressed = !0,
                    this._teleportPressed = !0;
                    break;
                case _.BY:
                    this._menuPressed = !0
                }
            else if (this._gamepadType === b)
                switch (t) {
                case b.CIRCULAR_BUTTON:
                    this._clickPressed = !0,
                    this._teleportPressed = !0;
                    break;
                case b.HOME:
                    this._menuPressed = !0;
                    break;
                case b.CIRCULAR_UP:
                case b.CIRCULAR_DOWN:
                    this._scaleValueChange = 0
                }
            else if (this._gamepadType === x)
                switch (t) {
                case x.CIRCULAR_BUTTON:
                    0 !== this._scaleValueChange && (this._menuPressed = !1,
                    this._pointerClicked = !1,
                    this._teleportPressed = !1),
                    this._pointerClicked = !1,
                    this._scaleValueChange = 0
                }
            else if (this._gamepadType === A)
                switch (t) {
                case A.TOUCHPAD_BUTTON:
                    this._pointerClicked = !1
                }
        },
        onButtonDown: function(t) {
            if (this._gamepadType === v)
                switch (t) {
                case v.CIRCULAR_BUTTON:
                    this.updateScaleChangeFromXAxis(v.SCALE_THRESHOLD)
                }
            else if (this._gamepadType === b)
                switch (t) {
                case b.CIRCULAR_UP:
                    this._scaleValueChange = 1;
                    break;
                case b.CIRCULAR_DOWN:
                    this._scaleValueChange = -1
                }
            else if (this._gamepadType === x)
                switch (t) {
                case x.CIRCULAR_BUTTON:
                    this.updateScaleChangeFromXAxis(x.SCALE_THRESHOLD),
                    this._pointerClicked = 0 === this._scaleValueChange
                }
            else if (this._gamepadType === A)
                switch (t) {
                case A.TOUCHPAD_BUTTON:
                    this._pointerClicked = !0
                }
        },
        getAndSetActiveController: function() {
            if (navigator.getGamepads) {
                var t = navigator;
                try {
                    if (t = window.parent.navigator,
                    !t)
                        throw new Error("Host is not defined")
                } catch (e) {
                    t = navigator
                }
                var i = this._activeController;
                this._isPosedController = void 0,
                this._activeController = void 0;
                var n = t.getGamepads()
                  , r = 0
                  , a = n.length;
                for (r = 0; r < a; ++r) {
                    var s = n[r];
                    if (s) {
                        var o = s.pose && s.pose.hasOrientation;
                        if ((!o || s.pose.orientation) && (this._activeController = s,
                        this._isPosedController = o,
                        o && "Oculus Touch (Left)" !== s.id))
                            break
                    }
                }
                if (this._activeController || (this._pressedButtons.length = 0),
                this._activeController && i !== this._activeController) {
                    var u = this._pressedButtons.length = this._activeController.buttons.length;
                    for (r = 0; r < u; ++r)
                        this._pressedButtons[r] = !1;
                    this._gamepadType = void 0;
                    var l = this._activeController && this._activeController.id;
                    if (l)
                        return l = l.toLowerCase(),
                        l.indexOf("oculus") !== -1 ? void (l.indexOf("touch") !== -1 ? this._gamepadType = _ : this._gamepadType = b) : l.indexOf("daydream") !== -1 ? void (this._gamepadType = x) : l.indexOf("vive") !== -1 || l.indexOf("openvr") !== -1 ? void (this._gamepadType = v) : l.indexOf("gear vr") !== -1 ? void (this._gamepadType = A) : void 0
                }
            }
        },
        applyPoseMatrix: function() {
            var t = p.Quat.create()
              , e = p.Vec3.create()
              , i = p.Matrix.create();
            return function(n, r, a, s, o) {
                if (r) {
                    var u = a.stageParameters && a.stageParameters.sittingToStandingTransform
                      , l = r.orientation;
                    r.hasOrientation && l && (u && (l = p.Matrix.getRotate(u, t),
                    p.Quat.mult(l, r.orientation, l)),
                    l = p.Quat.set(l[0], -l[2], l[1], l[3], t),
                    p.Quat.mult(this._postMultRotate, l, l),
                    p.Matrix.preMult(n, p.Matrix.makeRotateFromQuat(l, i)));
                    var c = r.position;
                    if (r.hasPosition && c)
                        u && (c = p.Matrix.transformVec3(u, c, e)),
                        c = p.Vec3.set(c[0] * s, -c[2] * s, c[1] * s, e),
                        p.Quat.transformVec3(this._postMultRotate, c, c),
                        p.Matrix.setTrans(n, c[0] + o[0], c[1] + o[1], c[2] + o[2]);
                    else if (!r.hasPosition) {
                        var h = .2
                          , d = .2
                          , f = .5;
                        e[0] = h * s * ("left" === a.hand ? -1 : 1),
                        e[1] = d * s,
                        e[2] = 0,
                        p.Quat.transformVec3(t, e, e),
                        e[2] -= f * s,
                        p.Vec3.add(e, o, e),
                        p.Matrix.setTrans(n, e[0], e[1], e[2])
                    }
                }
            }
        }(),
        updatePointerScaleFromHit: function(t, e) {
            var i = p.Matrix.getTrans(this.getMatrix(), p.Vec3.create())
              , n = p.Vec3.distance(t, i);
            this._hitScaleOffset = n / e
        },
        resetPointerScale: function() {
            this._hitScaleOffset = f
        },
        isMenuPressed: function() {
            return this._menuPressed
        },
        isTeleportPressed: function() {
            return this._teleportPressed
        },
        isClickPressed: function() {
            return this._clickPressed
        },
        checkScaleChangeValue: function() {
            return this._scaleValueChange
        },
        updateNodeVR: function(t, e, i, n) {
            this.getAndSetActiveController(),
            this._isPosedController && !this._dataDownloaded && (this._dataDownloaded = !0,
            o.getController(this.replaceControllerMesh.bind(this))),
            this.updatePointerClick(i),
            this.updateButtonsPressed(),
            this.updateHoverAxes();
            var r = this.getMatrix();
            p.Matrix.makeScale(g, this._hitScaleOffset, 1, this._pointerMT.getMatrix()),
            p.Matrix.makeScale(t, t, t, r),
            this._isPosedController ? (this.setNodeMask(a.NO_PICK_NO_SHADOW),
            this.applyPoseMatrix(r, this._activeController.pose, e, t, n)) : this.setNodeMask(0),
            this.dirtyBound()
        },
        resetButtons: function() {
            this._clickPressed = !1,
            this._menuPressed = !1,
            this._teleportPressed = !1
        },
        raycastFromController: function() {
            var t = p.Vec3.createAndSet(0, f, 0);
            return function(e, i, n, r, s) {
                p.Matrix.getTrans(this.getMatrix(), r),
                p.Vec3.set(0, n / this._model.get("worldFactor"), 0, s),
                p.Matrix.transformVec3(this.getMatrix(), s, s);
                var o = i.computeNearestIntersection3DHotspotFirst(r, s, a.PICK_GEOMETRY_FAST, e);
                return o || p.Matrix.transformVec3(this.getMatrix(), t, s),
                o
            }
        }()
    }),
    t.exports = y
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\nattribute vec3 Normal;\nattribute float Color;\n\nuniform mat4 uModelViewNormalMatrix;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec4 vViewVertex;\nvarying vec3 vNormal;\nvarying float vAO;\n\nvoid main(void) {\n  vViewVertex = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  vNormal = vec3(uModelViewNormalMatrix * vec4(Normal.xyz, 0.0));\n  vAO = Color;\n  gl_Position = uProjectionMatrix * vViewVertex;\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec4 vViewVertex;\nvarying vec3 vNormal;\nvarying float vAO;\n\nuniform int uOutputLinear;\nuniform float uRGBMRange;\nuniform vec3 uMatColor;\n\n#pragma include "lightsPBR.glsl"\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec3 color = vec3(0.0);\n\n  // MATERIAL\n  vec3 eyeVector = -normalize(vViewVertex.xyz);\n  vec3 normal = normalize(vNormal);\n\n  vec3 albedo = vec3(1.0);\n  float f0 = 0.04;\n  float metalness = 0.0;\n  float roughness = 0.5;\n  vec3 diffuse = sRGBToLinear(uMatColor) * (1.0 - metalness);\n\n  vec3 specular = mix(vec3(f0), albedo, metalness);\n  vec4 prepSpec = LightingFuncPrep(normal, eyeVector, roughness);\n\n  // LIGHT 1\n  vec3 eyeLightDir = normalize(vec3(0.0, 0.3, 0.9));\n  vec3 lightColor = vec3(0.7, 0.7, 0.9);\n  // compute NdL\n  float NdotL = dot(eyeLightDir, normal);\n  if (NdotL > 0.0){\n      color += computeLight(lightColor, diffuse, normal, eyeVector, eyeLightDir, specular, prepSpec, NdotL);\n  }\n\n  // emissive\n  color += vec3(0.07);\n\n  color *= vAO;\n\n  color = uOutputLinear == 0 ? linearTosRGB(color) : color;\n\n  gl_FragColor = encodeRGBM(color, uRGBMRange);\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec3 vLocalVertex;\n\nvoid main(void) {\n  vLocalVertex = Vertex;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec3 vLocalVertex;\n\nuniform int uOutputLinear;\nuniform float uAlpha;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = linearTosRGB(vec4(0.1, 0.66, 0.85, 1.0)) * (smoothstep(1.0, 0.0, vLocalVertex.y) * smoothstep(1.0, 0.0, abs(vLocalVertex.x * 4.0))) * uAlpha;\n\n  gl_FragColor = color;\n}\n'
}
, function(t, e, i) {
    "use strict";
    var n = i(1684)
      , r = i(1713)
      , a = i(1714)
      , s = i(1198)
      , o = s.osgAnimation
      , u = i(1197)
      , l = i(1715);
    i(605);
    var c = s.osg
      , h = .15
      , d = -.05
      , p = o.easeOutCubic
      , f = function(t) {
        c.Node.call(this),
        this._menuPanel = new a(.9),
        this._menuPanel.setClickAction("vrHelpButton", this.displayHelp.bind(this)),
        this._menuPanel.setClickAction("vrExitButton", this.hide.bind(this)),
        this._menuPanel.setVisible(!1);
        var e = new r(c.Vec3.createAndSet(0, 0, d),h,p,this._menuPanel,t);
        this._menuPanel.setAnimation(e),
        this.addChild(this._menuPanel),
        this._helpPanel = new l(2,2),
        this._helpPanel.setPanelClickAction(this.hideHelp.bind(this)),
        this._helpPanel.setVisible(!1);
        var i = new r(c.Vec3.createAndSet(0, 0, 0),.3,p,this._helpPanel,t);
        this._helpPanel.setAnimation(i),
        this.addChild(this._helpPanel),
        this._model = t
    };
    f.prototype = c.objectInherit(c.Node.prototype, {
        initialize: function(t) {
            this._menuPanel.initialize("skfb_front/macros/vrMenu", {
                hasModelAnnotations: t.hotspot._views[0]._hotspots.length
            }),
            n.getBaseVR(function(t) {
                var e = u.instance.getOrCreateTexture(t.MENU_HELP).texture;
                this._helpPanel.initialize(e, {
                    width: 1e3,
                    height: 500
                })
            }
            .bind(this))
        },
        display: function(t, e, i) {
            this._menuPanel.displayInView(t, e, i)
        },
        hide: function() {
            this._menuPanel.setVisible(!1),
            this._helpPanel.isVisible() && this._helpPanel.setVisible(!1)
        },
        setHomeAction: function(t) {
            this._menuPanel.setClickAction("vrHomeButton", t)
        },
        setNextAction: function(t) {
            this._menuPanel.setClickAction("vrNextButton", t)
        },
        setPrevAction: function(t) {
            this._menuPanel.setClickAction("vrPrevButton", t)
        },
        displayHelp: function() {
            c.Matrix.copy(c.Matrix.create(), this._helpPanel.getMatrix()),
            c.Matrix.setTrans(this._helpPanel.getMatrix(), 0, 0, .2 * this._model.get("worldFactor")),
            c.Matrix.postMult(this._menuPanel.getMatrix(), this._helpPanel.getMatrix()),
            this._helpPanel.setVisible(!0)
        },
        hideHelp: function() {
            this._helpPanel.isVisible() && this._helpPanel.setVisible(!1)
        },
        isVisible: function() {
            return this._menuPanel.isVisible()
        },
        isHelpVisible: function() {
            return this._helpPanel.isVisible()
        },
        updateHit: function(t) {
            return this._helpPanel.isVisible() ? this._helpPanel.updateHit(t) : this._menuPanel.isVisible() ? this._menuPanel.updateHit(t) : void 0
        },
        click: function() {
            this._helpPanel.isVisible() ? this._helpPanel.click() : this._menuPanel.isVisible() && this._menuPanel.click()
        }
    }),
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = n.osg
      , a = .05
      , s = function(t, e, i, n, a) {
        this._startPosOffset = t,
        this._startPos = r.Vec3.create(),
        this._targetPos = r.Vec3.create(),
        this._duration = e,
        this._easingFunc = i,
        this._result = r.Vec3.create(),
        this._hasStarted = !1,
        this._reverse = !1,
        this._finished = !0,
        this._node = n,
        this._model = a
    };
    s.prototype = {
        isFinished: function() {
            return this._finished
        },
        _reverseAnim: function() {
            this._reverse = !this._reverse
        },
        start: function() {
            var t = r.Vec3.create();
            return function(e) {
                this._started = -e * a,
                this._hasStarted = !1,
                this._finished = !1,
                r.Vec3.mult(this._startPosOffset, this._model.get("worldFactor"), t),
                this._reverse ? (r.Matrix.getTrans(this._node.getMatrix(), this._startPos),
                r.Vec3.add(this._startPos, t, this._targetPos),
                this._node.setOpacity(1)) : (r.Matrix.getTrans(this._node.getMatrix(), this._targetPos),
                r.Vec3.add(this._targetPos, t, this._startPos),
                this._node.setOpacity(0)),
                r.Matrix.setTrans(this._node.getMatrix(), this._startPos[0], this._startPos[1], this._startPos[2])
            }
        }(),
        update: function(t, e) {
            if (!this._finished) {
                var i = e.getFrameStamp().getSimulationTime();
                if (this._started < 0)
                    return this._started += e.getFrameStamp().getDeltaTime(),
                    !0;
                this._hasStarted || (this._started = i,
                this._hasStarted = !0);
                var n = (i - this._started) / this._duration;
                return n > 1 && (this._finished = !0,
                n = 1),
                this._easingFunc && (n = this._easingFunc(n)),
                this.interpolate(n, t),
                this._finished && (this._reverseAnim(),
                this._onFinishCallback && this._onFinishCallback(),
                this._node.dirtyBound()),
                !0
            }
        },
        interpolate: function(t, e) {
            r.Vec3.lerp(t, this._startPos, this._targetPos, this._result),
            r.Matrix.setTrans(e.getMatrix(), this._result[0], this._result[1], this._result[2]),
            this._reverse ? this._node.setOpacity(1 - t) : this._node.setOpacity(t)
        },
        setOnFinishCallback: function(t) {
            this._onFinishCallback = t
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1684)
      , r = i(1198)
      , a = i(1715)
      , s = r.osg
      , o = i(220)
      , u = i(216)
      , l = function(t, e) {
        a.call(this, t, e)
    };
    l.prototype = s.objectInherit(a.prototype, {
        initialize: function(t, e) {
            var i = new s.Texture;
            i.setTextureSize(1, 1),
            n.getBaseVR(function(n) {
                var r = o(n.TEMPLATES.getFromMacro(t, "panel", [u.extend({}, e)]));
                o(".gui").append(r),
                o("html, body, .viewer, .tooltip").css({
                    overflow: "visible"
                });
                var s = this._extractMetaData(r);
                n.H2C(r, {
                    background: void 0,
                    allowTaint: !1,
                    letterRendering: !0,
                    width: s.width,
                    height: s.height,
                    onrendered: function(t) {
                        var e = document.createElement("canvas");
                        e.width = 1024,
                        e.height = 1024;
                        var n = e.getContext("2d");
                        n.drawImage(t, 0, 0, 1024, 1024),
                        i.setImage(e),
                        o("html, body, .viewer, .tooltip").css({
                            overflow: ""
                        }),
                        a.prototype.initialize.call(this, i, s)
                    }
                    .bind(this)
                }),
                r.hide()
            }
            .bind(this))
        },
        _extractMetaData: function(t) {
            for (var e = t.find("button"), i = t.offset().top, n = t.outerHeight(), r = t.offset().left, a = t.outerWidth(), s = n / a, u = {
                width: a,
                height: n,
                aspectRatio: s,
                items: [],
                areas: []
            }, l = 0; l < e.length; l++) {
                var c = e[l].id;
                if (c && !u[c]) {
                    var h = o(e[l])
                      , d = [];
                    d[0] = h.offset().left - r,
                    d[1] = d[0] + h.outerWidth(),
                    d[2] = h.offset().top - i,
                    d[3] = d[2] + h.outerHeight(),
                    u.items[l] = c,
                    u.areas[l] = d
                }
            }
            return u
        }
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1514)
      , a = i(1516)
      , s = i(1597)
      , o = i(1716)
      , u = i(1717)
      , l = i(216)
      , c = n.osg
      , h = c.BufferArray
      , d = c.Geometry
      , p = c.PrimitiveSet
      , f = c.DrawElements
      , g = -.2
      , m = 0
      , v = 1
      , _ = 12
      , b = c.Vec4.createAndSet(1, 1, 1, 1)
      , x = "WHOLE_PANEL"
      , A = 2.5
      , y = 1
      , S = function(t, e) {
        c.MatrixTransform.call(this),
        this._distanceFromCam = A,
        this._width = y,
        e && (this._distanceFromCam = e),
        t && (this._width = t),
        this._clickActions = {},
        this._opacity = 1,
        this._visible = !0
    };
    S.prototype = c.objectInherit(c.MatrixTransform.prototype, {
        initialize: function(t, e) {
            this._texPanel = t,
            this._metaData = this._computeMetaData(e),
            this._height = this._width / this._metaData.aspectRatio;
            var i = this._createTexturedGridGeometry(.5 * -this._width, .5 * -this._height, 0, this._width, this._height, 10, 10, _, .2);
            this.addChild(i);
            var n = i.getOrCreateStateSet()
              , r = c.Uniform.createFloat1(this._opacity, "uAlpha");
            this._uAlpha = r.getInternalArray(),
            n.addUniform(r);
            var l = c.Uniform.createFloat1(e.aspectRatio, "uRatio");
            this._uRatio = l.getInternalArray(),
            n.addUniform(l),
            n.addUniform(c.Uniform.createInt(0, "uTexturePanel")),
            n.setTextureAttributeAndModes(0, this._texPanel),
            n.setAttributeAndModes(new c.CullFace(c.CullFace.DISABLE));
            var h = s.getOrCreateShader(o, u, "textured-panel", "TexturedPanel");
            n.setAttributeAndModes(h);
            var d = c.Uniform.createFloat4(b, "uHoveredArea");
            this._uHoveredArea = d.getInternalArray(),
            n.addUniform(d),
            n.setRenderBinDetails(a.VR_MENU, "RenderBin"),
            n.setAttributeAndModes(new c.BlendFunc(c.BlendFunc.ONE,c.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            this._initialized = !0
        },
        setVisible: function(t) {
            this._visible = t,
            this._animation ? (t && this._doSetVisible(!0),
            this._animation.start(0)) : this._doSetVisible(t)
        },
        _doSetVisible: function(t) {
            this.setNodeMask(t ? r.PICK_GEOMETRY_FAST : 0),
            this._uAlpha && (this._uAlpha[0] = 1)
        },
        isVisible: function() {
            return this._visible
        },
        setOpacity: function(t) {
            this._opacity = t,
            this._uAlpha && (this._uAlpha[0] = t)
        },
        updateHit: function(t) {
            if (this._initialized) {
                var e = t && t.point;
                if (!t || t.nodepath.indexOf(this) === -1)
                    return this._currentHovered = void 0,
                    void c.Vec4.copy(b, this._uHoveredArea);
                var i = this._metaData.areas;
                if (i)
                    for (var n = (e[0] + .5 * this._width) / this._width, r = (e[1] + .5 * this._height) / this._height, a = 0; a < i.length; a++) {
                        var s = i[a];
                        if (n > s[0] && n < s[1] && r < s[2] && r > s[3])
                            return this._currentHovered = this._metaData.items[a],
                            c.Vec4.copy(i[a], this._uHoveredArea),
                            this
                    }
                return this._currentHovered = x,
                c.Vec4.copy(b, this._uHoveredArea),
                this
            }
        },
        click: function() {
            if (this._currentHovered)
                if (this._currentHovered !== x) {
                    var t = this._clickActions[this._currentHovered];
                    t && t()
                } else
                    this._panelClickAction && this._panelClickAction()
        },
        setClickAction: function(t, e) {
            this._clickActions[t] = e
        },
        removeClickAction: function(t) {
            delete this._clickActions[t]
        },
        setPanelClickAction: function(t) {
            this._panelClickAction = t
        },
        removePanelClickAction: function() {
            this._panelClickAction = void 0
        },
        displayInView: function() {
            var t = c.Vec3.create()
              , e = c.Vec3.create()
              , i = c.Vec3.createAndSet(0, 0, .1)
              , n = c.Vec3.create();
            return function(r, a, s) {
                c.Vec3.copy(a, t),
                t[2] = r[2];
                var o = c.Matrix.makeLookAt(r, t, i, this.getMatrix());
                c.Matrix.inverse(o, o);
                var u = s;
                c.Matrix.preMultScale(o, c.Vec3.set(u, u, u, e)),
                c.Vec3.sub(t, r, n),
                c.Vec3.normalize(n, n),
                c.Vec3.mult(n, this._distanceFromCam * s, n),
                c.Vec3.add(r, n, n),
                c.Matrix.setTrans(o, n[0], n[1], n[2] + g * s),
                this.dirtyBound(),
                this.setVisible(!0)
            }
        }(),
        setAnimation: function(t) {
            t.setOnFinishCallback(this._onAnimationFinished.bind(this)),
            this._animation = t,
            this.addUpdateCallback(t)
        },
        _onAnimationFinished: function() {
            this._visible || this._doSetVisible(!1)
        },
        _computeMetaData: function(t) {
            var e = l.extend(t, {
                aspectRatio: t.width / t.height
            });
            if (e.areas)
                for (var i = 0; i < e.areas.length; i++) {
                    var n = e.areas[i];
                    n[0] = n[0] / e.width,
                    n[1] = n[1] / e.width,
                    n[2] = 1 - n[2] / e.height,
                    n[3] = 1 - n[3] / e.height
                }
            return e
        },
        _createTexturedGridGeometry: function(t, e, i, n, r, a, s, o, u) {
            t = void 0 !== t ? t : -.5,
            e = void 0 !== e ? e : -.5,
            i = void 0 !== i ? i : 0,
            n = void 0 !== n ? n : 1,
            r = void 0 !== r ? r : 1,
            a = void 0 !== a ? a : 5,
            s = void 0 !== s ? s : a,
            o && (u = void 0 !== u ? u : .2);
            for (var l = (a + 1) * (s + 1), c = new d, g = new Float32Array(3 * l), b = new Float32Array(2 * l), x = new Float32Array(a * s * 6), A = n / a, y = r / s, S = 0, C = 0, M = 0, w = 0, T = 0, E = 0, I = 0; I <= s; I++)
                for (var k = 0; k <= a; k++)
                    C = 3 * S,
                    M = 2 * S,
                    b[M] = k / a,
                    b[M + 1] = I / s,
                    o && (o !== m && o !== _ || (T = k / a - .5,
                    T = T * T * u),
                    o !== v && o !== _ || (E = I / s - .5,
                    E = E * E * u)),
                    g[C] = t + A * k,
                    g[C + 1] = e + y * I,
                    g[C + 2] = i + T + E,
                    S++;
            for (var F = 0; F < a * s; F++)
                w = 6 * F,
                S = F + Math.floor(F / a),
                x[w] = S,
                x[w + 1] = a + 1 + S,
                x[w + 2] = a + 1 + S + 1,
                x[w + 3] = a + 1 + S + 1,
                x[w + 4] = S + 1,
                x[w + 5] = S;
            c.getAttributes().Vertex = new h(h.ARRAY_BUFFER,g,3),
            c.getAttributes().TexCoord0 = new h(h.ARRAY_BUFFER,b,2);
            var D = new f(p.TRIANGLES,new h(h.ELEMENT_ARRAY_BUFFER,x,1));
            return c.getPrimitives().push(D),
            c
        }
    }),
    t.exports = S
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\n\n// uniform mat4 uModelMatrix;\n// uniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat4 uModelViewMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  \n}\n"
}
, function(t, e) {
    t.exports = 'varying vec2 vTexCoord0;\n\nuniform sampler2D uTexturePanel;\nuniform vec4 uHoveredArea;\nuniform float uAlpha;\nuniform float uRatio;\n\n#pragma include "functions.glsl"\n\n// signed distance to a 2D rounded box\nfloat sdRoundBox( const in vec2 p, const in vec2 b, const in float r ) {\n    vec2 q = abs(p) - b;\n    vec2 m = vec2( min(q.x,q.y), max(q.x,q.y) );\n    float d = (m.x > 0.0) ? length(q) : m.y; \n    return d - r;\n}\n\nvoid main(void) {\n  vec4 color = texture2D(uTexturePanel, vTexCoord0);\n\n  float lerpValue = step(0.0, -vTexCoord0.x);\n  lerpValue += step(1.0 , vTexCoord0.x);\n\n  // vTexCoord is [0, 1]\n  float round = 0.02;\n  float left = uHoveredArea.x + round;\n  float right = uHoveredArea.y - round;\n  float top = uHoveredArea.z - round;\n  float bottom = uHoveredArea.w + round;\n  \n  vec2 halfSize = abs(vec2(left - right, top - bottom) * 0.5);  \n  vec2 center = vec2(halfSize.x + left, halfSize.y + bottom);\n\n  lerpValue += max(0.0, -sign(sdRoundBox( vTexCoord0 - center, halfSize, round)));\n\n  color.rgb = mix(color.rgb, color.rgb + vec3(0.03, 0.59, 0.78), lerpValue); // min/max not necessary\n\n  color.a *= uAlpha;\n  color.rgb *= color.a;\n\n  gl_FragColor = color;\n}\n'
}
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(1195)
      , r = i(1794)
      , a = {
        FeatureName: "saveUI",
        ModelName: "Material",
        ViewListType: [r]
    };
    t.exports = n.create(a)
}
, function(t, e, i) {
    "use strict";
    var n = i(235)
      , r = i(220)
      , a = i(216)
      , s = i(215)
      , o = i(233)
      , u = i(1198)
      , l = i(1470)
      , c = i(258)
      , h = i(266)
      , d = i(1635)
      , p = i(265)
      , f = u.osg;
    t.exports = c.extend({
        savingEnabled: !1,
        initialize: function() {
            c.prototype.initialize.apply(this, arguments),
            r(".save-model").click(this.onSave.bind(this));
            var t = this.options.context.getModel();
            t && !this.maintenance && this.listenTo(t, "status:loaded", this.enableSaving.bind(this))
        },
        onSave: function(t) {
            t.preventDefault(),
            p.isMaintenance() ? p.showPopup() : this.save()
        },
        save: function() {
            if (!this.savingEnabled)
                return n.reject();
            if (r(".save-model").hasClass("progress"))
                return n.reject();
            r(".save-model").addClass("progress");
            var t = this.options.context.getModel().get("uid")
              , e = this.options.context.getModel().get("user").uid
              , i = {
                modelUID: t,
                userUID: e
            }
              , a = this
              , s = [];
            return n.settle([this.saveBackgroundImages(i, s), this.saveMaterialImages(i, s), this.saveTexturesColorspace(i, s), this.saveHotspots(i, s), this.saveAnimations(i, s)]).then(function() {
                return s.length > 0 ? n.reject() : a.saveOptions()
            }).then(function() {
                return s.length > 0 ? n.reject() : n.settle([a.deleteTextures(s), a.deleteBackgroundImages(s), a.deleteAnimations(s), a.deleteEnvironments(s)])
            }).then(function() {
                return s.length > 0 ? n.reject() : (r(".save-model").removeClass("progress"),
                r(".save-model").addClass("success"),
                void setTimeout(function() {
                    r(".save-model").removeClass("success")
                }, 4e3))
            }
            .bind(this))["catch"](function(t) {
                if (r(".save-model").removeClass("progress"),
                503 === event.target.status)
                    p.showPopup();
                else {
                    var e = "";
                    if (s.length)
                        e = s.join("<br/>");
                    else {
                        if (e = "An unexpected error happened while saving the following settings : <br/><ul>",
                        t && t.responseJSON && t.responseJSON.detail) {
                            var i = t.responseJSON.detail;
                            f.error(i);
                            for (var n = "string" == typeof i ? [i] : Object.keys(i), a = 0; a < n.length; ++a)
                                e += "<li>&bullet; " + n[a] + "</li>"
                        }
                        e += "</ul>"
                    }
                    e += "<br/>Please contact the support team at support@sketchfab.com.";
                    var o = new h({
                        title: "Error",
                        text: e,
                        buttons: {
                            ok: !0
                        },
                        safe: !0
                    });
                    o.open().then(o.close.bind(o))
                }
            })
        },
        deleteUnusedResources: function(t, e, i) {
            if (0 === t.length)
                return n.resolve();
            var r = "Errors while deleting the following " + e + " :<br/><ul>"
              , s = !1
              , o = a.map(t, function(t) {
                return n.resolve(t.destroy())["catch"](function(e) {
                    var i = e && e.responseJSON && e.responseJSON.detail;
                    r += "<li>&bullet; " + t.get("name") + " : " + i + "</li>",
                    t.trigger("restore", t),
                    s = !0
                })
            });
            return t.length = 0,
            n.all(o).then(function() {
                if (s)
                    return i.push(r + "</ul>"),
                    n.reject()
            })
        },
        deleteTextures: function(t) {
            var e = this.options.context.getViewer().getFeatures().material.getModel()._deletedTextures || []
              , i = a.map(e, function(t) {
                return new l({
                    uid: t
                })
            });
            return e.length = 0,
            this.deleteUnusedResources(i, "material textures", t)
        },
        deleteAnimations: function(t) {
            return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().animation.getModel().get("animations")._trashbin, "animations", t)
        },
        deleteEnvironments: function(t) {
            return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().environment.getModel()._trashbin, "environments", t)
        },
        deleteBackgroundImages: function(t) {
            return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().background.getModel()._trashbin, "backgrounds", t)
        },
        saveBackgroundImages: function(t, e) {
            var i = this
              , r = []
              , a = this.options.context.getViewer().getFeatures().background;
            return a.getModel().backgroundCollection.each(function(n) {
                if (n.isNew()) {
                    var a = i.saveImage(n, t);
                    a && (a["catch"](function(t) {
                        var i = 0;
                        if (t.responseJSON.detail.imageFile)
                            for (i = 0; i < t.responseJSON.detail.imageFile.length; i++)
                                t.responseJSON.detail.imageFile[i].match("The image should be less than 4mb") && e.push("Background image is too big (max: 4MB)")
                    }),
                    r.push(a))
                }
            }),
            n.all(r)
        },
        saveImage: function(t, e) {
            return n.resolve(t.save(e).then(function(e) {
                t.set("uid", e.uid)
            }))
        },
        _saveImageToBlob: function(t, e, i, n) {
            var r, a = t.getImage(), s = t.getTextureProxy().getImage().getImage();
            if (s.toBlob) {
                var o = this;
                return void s.toBlob(function(t) {
                    t.name = e.name,
                    a.set("imageFile", t),
                    i(o.saveImage(a, n))
                }, e.type, .95)
            }
            if (s.toDataURL)
                r = d(s.toDataURL(e.type, .95)),
                r.name = e.name,
                a.set("imageFile", r),
                i(this.saveImage(a, n));
            else {
                var u = s;
                s = document.createElement("canvas"),
                s.width = u.width,
                s.height = u.height,
                s.getContext("2d").drawImage(u, 0, 0)
            }
            r = d(s.toDataURL(e.type, .95)),
            r.name = e.name,
            a.set("imageFile", r),
            i(this.saveImage(a, n))
        },
        saveMaterialImages: function(t, e) {
            var i = this
              , r = []
              , s = {}
              , o = this.options.context.getViewer().getFeatures().material
              , u = "Errors while saving the following texture materials :<br/><ul>"
              , l = !1;
            return a.each(o.getModel().attributes, function(e) {
                var o = e.getChannels();
                a.each(o, function(e) {
                    var a = e.getTexture();
                    if (a) {
                        var o = a.getImage();
                        if (o && o.isNew()) {
                            var c = o.getUID();
                            if (1 !== s[c]) {
                                s[c] = 1;
                                var h = new n(function(e) {
                                    var n = o.get("imageFile");
                                    if (0 === n.size)
                                        i._saveImageToBlob(a, n, e, t);
                                    else if (window.File) {
                                        var r = new FileReader;
                                        r.onload = function() {
                                            this.readyState === FileReader.DONE ? e(i.saveImage(o, t)) : i._saveImageToBlob(a, n, e, t)
                                        }
                                        ,
                                        r.onerror = function() {
                                            i._saveImageToBlob(a, n, e, t)
                                        }
                                        ,
                                        r.readAsArrayBuffer(n)
                                    }
                                }
                                );
                                r.push(h["catch"](function(t) {
                                    var e = t && t.responseJSON && t.responseJSON.detail;
                                    u += "<li>&bullet; " + o.getName() + " : " + e + "</li>",
                                    l = !0
                                }))
                            }
                        }
                    }
                })
            }),
            n.all(r).then(function() {
                if (l)
                    return e.push(u + "</ul>"),
                    n.reject()
            })
        },
        saveOptions: function() {
            var t = this.options.context
              , e = t.getViewer()
              , i = e.getOptionsJSON();
            if (e.getFeaturesManager().registerOptionsJSON(i),
            i.animation)
                for (var r = e.getFeatures().animation.getModel().get("animations")._trashbin, a = 0; a < r.length; a++)
                    r[a] && i.animation.order.splice(a, 0, r[a].get("uid"));
            return n.resolve(t.getModel().save({
                options: i
            }, {
                patch: !0
            }))
        },
        saveHotspot: function(t, e, i) {
            return t.save(e)["catch"](function(e) {
                if (i.push("Annotation #" + (+t.get("order") + 1) + " could not be saved."),
                e.responseJSON && e.responseJSON.detail) {
                    var n = 0;
                    if (e.responseJSON.detail.name)
                        for (n = 0; n < e.responseJSON.detail.name.length; n++)
                            e.responseJSON.detail.name[n].match("This field is required.") && i.push("Title is required."),
                            e.responseJSON.detail.name[n].match("Ensure this value has at most 64 characters") && i.push("Title is too long (64 characters max).");
                    if (e.responseJSON.detail.content)
                        for (n = 0; n < e.responseJSON.detail.content.length; n++)
                            e.responseJSON.detail.content[n].match("Ensure this value has at most 256 characters") && i.push("Description is too long (256 characters max).")
                }
            })
        },
        deleteHotspot: function(t, e, i, n) {
            return t.remove(e)["catch"](function() {
                n.push(t),
                i.push("An annotation could not be deleted. Please try saving your settings again.")
            })
        },
        saveHotspots: function(t, e) {
            var i = this.options.context.getViewer().getFeatures().hotspot
              , r = i.getModel()
              , u = r.get("hotspots")
              , l = s.maxHotspotsPerModel[o.me().get("account")]
              , c = u.length - l;
            if (u.length > l) {
                var h = "You have reached the maximum number of annotations allowed by your plan (" + l + ").";
                return o.me().canUpgradeToPro() && (h += 1 === c ? '<br>Delete the last annotation you created or <a class="upgrade-link underlined" href="/plans" data-title="maximum-annotation-upgrade" target="_blank">upgrade your account</a>.' : "<br>Delete the " + c + ' last annotations you created or <a class="upgrade-link underlined" href="/plans" data-title="maximum-annotation-upgrade" target="_blank">upgrade your account</a>.'),
                void r.trigger("hotspot-error", h)
            }
            var d = []
              , p = []
              , f = this;
            return a.each(r.hotspotsToBeDeleted, function(i) {
                d.push(f.deleteHotspot(i, t, e, p))
            }),
            r.hotspotsToBeDeleted = p,
            n.all(d).then(function() {
                var i = [];
                return u.each(function(n) {
                    n.set("order", u.indexOf(n)),
                    i.push(f.saveHotspot(n, t, e))
                }),
                n.all(i)
            })
        },
        saveTexturesColorspace: function(t, e) {
            var i = "Errors while changing the following texture colorspace :<br/><ul>"
              , r = !1
              , a = [];
            return this.model.imageCollection.each(function(t) {
                !t.isNew() && t.hasChanged("colorSpace") && a.push(t.saveColorspace()["catch"](function(e) {
                    var n = e && e.responseJSON && e.responseJSON.detail;
                    i += "<li>&bullet; " + t.get("name") + " : " + n + "</li>",
                    r = !0
                }))
            }),
            n.all(a).then(function() {
                if (r)
                    return e.push(i + "</ul>"),
                    n.reject()
            })
        },
        saveAnimations: function(t, e) {
            var i = this.options.context.getViewer().getFeatures().animation
              , r = i.getModel()
              , a = "Errors while saving the following animations :<br/><ul>"
              , s = !1
              , o = r.get("animations").map(function(e) {
                return e.save(t)["catch"](function(t) {
                    var i = t && t.responseJSON && t.responseJSON.detail;
                    a += "<li>&bullet; " + e.get("name") + " : " + i + "</li>",
                    s = !0
                })
            });
            return n.all(o).then(function() {
                if (s)
                    return e.push(a + "</ul>"),
                    n.reject()
            })
        },
        enableSaving: function() {
            this.savingEnabled = !0,
            r(".save-model").removeClass("btn-disabled")
        }
    })
}
, , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(220)
      , a = i(285);
    i(276);
    var s = i(1680)
      , o = i(258)
      , u = i(255)
      , l = i(424)
      , c = i(1191)
      , h = i(1804)
      , d = i(224)
      , p = i(241)
      , f = i(1805)
      , g = i(383)
      , m = i(1807)
      , v = i(1809)
      , _ = i(1810)
      , b = i(1811)
      , x = i(1814)
      , A = i(1815)
      , y = i(1817)
      , S = i(1819)
      , C = i(1818)
      , M = i(1820)
      , w = i(1821)
      , T = i(1482)
      , E = i(1822)
      , I = i(1826)
      , k = i(1465)
      , F = i(1569)
      , D = i(215)
      , N = D.shortcuts;
    i(567);
    var R = 3500
      , P = new s({
        device: "WEB",
        listen: !0
    });
    t.exports = o.extend({
        subviews: {},
        events: {
            'click [data-action="start"]': "onStart",
            'click [data-action="stop"]': "onStop",
            click: "globalCloseEvent",
            touchend: "globalCloseEvent"
        },
        templates: {
            viewerMode: p.getFromMacro("skfb_front/macros/viewer", "help_viewer_mode"),
            viewerVr: p.getFromMacro("skfb_front/macros/viewer", "help_vr_mode")
        },
        initialize: function() {
            o.prototype.initialize.apply(this, arguments),
            this.proxySettings = new g({
                shadingStyle: null,
                viewerMode: null,
                wireframeColor: null,
                wireframeEnable: null,
                hasWireframe: null,
                annotationsVisible: null,
                textureQuality: null,
                speed: null,
                cycleMode: null,
                fps: null
            }),
            this.initializeMandatorySubviews(),
            this.initializeHashMessages(),
            this.delegateGlobalMoveEvent(),
            this.delegateSubviews(),
            this.isVR() && a.apple.device && this.hackIosCanvasRender(),
            h() && this.$el.addClass("in-twitter-iphone")
        },
        _createSubview: function(t, e, i) {
            return this.subviews[t] = new e(n.extend({}, {
                viewer: this,
                widgets: this.subviews
            }, i)),
            this.subviews[t]
        },
        globalCloseEvent: function(t) {
            r(t.target).hasClass("has-menu") || r(t.target).parents(".has-menu").length || (this.subviews.hotspots && this.subviews.hotspots.toggleAnnotationList(null, !1),
            this.subviews.gui.closeMenus())
        },
        delegateGlobalMoveEvent: function() {
            var t = function(t) {
                "canvas" === t.target.tagName.toLowerCase() && (clearTimeout(this._showGuiTimeout),
                clearTimeout(this._hideGuiTimeout),
                this._hideGuiTimeout = setTimeout(function() {
                    this.$el.addClass("moving")
                }
                .bind(this), 150))
            }
              , e = function(t) {
                "canvas" === t.target.tagName.toLowerCase() && (clearTimeout(this._hideGuiTimeout),
                clearTimeout(this._showGuiTimeout),
                t.preventDefault(),
                this._showGuiTimeout = setTimeout(function() {
                    this.$el.hasClass("moving") && this.$el.removeClass("moving")
                }
                .bind(this), 500))
            }
              , i = function(t) {
                var e = t.relatedTarget || t.toElement;
                a.any || (clearTimeout(this.globalIdleTimeout),
                e || (this.globalIdleTimeout = setTimeout(this.onGlobalIdleTimeout.bind(this), R)))
            }
              , s = function() {
                clearTimeout(this.globalIdleTimeout),
                (this.$el.hasClass("idle") || this.$el.hasClass("moving")) && (this.$el.removeClass("idle moving"),
                n.each(this.subviews, function(t) {
                    t.trigger("idle", !1)
                }))
            };
            if (!c()) {
                var o;
                this.$el.on("touchmove", this.preventScroll.bind(this)),
                this.$el.on("mousedown touchstart", t.bind(this)),
                this.$el.on("mouseup touchend", e.bind(this)),
                this.$el.on("mousewheel", function(t) {
                    "canvas" === t.target.tagName.toLowerCase() && (this.$el.addClass("moving"),
                    clearTimeout(o),
                    o = setTimeout(function() {
                        this.$el.removeClass("moving")
                    }
                    .bind(this), 300))
                }
                .bind(this)),
                r(document).on("mouseout", i.bind(this)),
                r(document).on("mouseenter mousein", s.bind(this))
            }
        },
        preventScroll: function(t) {
            this.subviews && this.subviews.helpOverlay && !this.subviews.helpOverlay.isVisible() && t.preventDefault()
        },
        onGlobalIdleTimeout: function() {
            c() || (this.$el.addClass("idle"),
            n.each(this.subviews, function(t) {
                t.trigger("idle", !0)
            }))
        },
        initializeMandatorySubviews: function() {
            this._createSubview("gui", m, {
                el: this.$el
            }),
            this._createSubview("loading", v, {
                el: this.$(".loading-container")
            }),
            this._createSubview("hint", _, {
                el: this.$el,
                fallback: !l()
            }),
            this._createSubview("generalControls", b, {
                el: this.$(".general-controls"),
                fallback: !l()
            }),
            this._createSubview("header", x, {
                el: this.$(".titlebar")
            }),
            this._createSubview("snapshot", A, {
                el: this.$el
            }),
            this._createSubview("helpOverlay", y, {
                el: this.$(".help.overlay")
            }),
            this._createSubview("hotspotsOverlay", S, {
                el: this.$(".hotspots-overlay")
            }),
            this._createSubview("helperVrOverlay", C.extend({
                setUrl: function(t) {
                    this.$(".url").attr("href", t).text(t)
                }
            }), {
                el: this.$(".helper-vr-overlay")
            }),
            this._createSubview("osd", M, {
                el: this.$el
            })
        },
        initShortcuts: function() {
            this.viewerRenderingShortcuts = new f(N.viewerRendering),
            this.viewerRenderingShortcuts.on("toggleWireframe", function() {
                this.proxySettings.set("wireframeEnable", !this.proxySettings.get("wireframeEnable"))
            }
            .bind(this)),
            this.viewerRenderingShortcuts.listen([this.viewerRenderingShortcuts.getShortcut("toggleWireframe")]),
            this.viewerRenderingShortcuts.on("defaultRenderingMode", function() {
                this.proxySettings.set("shadingStyle", "lit")
            }
            .bind(this)),
            this.viewerRenderingShortcuts.on("shadelessRenderingMode", function() {
                this.proxySettings.set("shadingStyle", "shadeless")
            }
            .bind(this)),
            this.viewerRenderingShortcuts.on("matcapRenderingMode", function() {
                this.proxySettings.set("shadingStyle", "matcap")
            }
            .bind(this)),
            this.updateShorcuts()
        },
        updateShorcuts: function() {
            var t = this._currentModel.get("options").shading.type;
            "lit" === t || c() ? this.viewerRenderingShortcuts.listen([this.viewerRenderingShortcuts.getShortcut("defaultRenderingMode"), this.viewerRenderingShortcuts.getShortcut("shadelessRenderingMode"), this.viewerRenderingShortcuts.getShortcut("matcapRenderingMode")]) : this.viewerRenderingShortcuts.stopListening(["defaultRenderingMode", "shadelessRenderingMode", "matcapRenderingMode"])
        },
        initializeHashMessages: function() {
            k().isApp && P.on("message:vrMode", function(t) {
                var e = parseInt(t.data.vrMode, 10);
                this.subviews.hotspots && (this.subviews.hotspots.hideTooltips(),
                this.subviews.hotspots.currentHotspot = -1,
                this.subviews.hotspots.renderControl());
                var i = this.scene.getFeatures().webVR.getModel();
                i.set("enable", !!e),
                t.removeFromHash()
            }
            .bind(this))
        },
        initializeHotspotsSubviews: function(t) {
            i.e(16, function() {
                var e = i(1837);
                this._createSubview("hotspots", e, {
                    el: this.$el,
                    container: this.$(".hotspots"),
                    fallback: !l()
                }),
                "function" == typeof t && t()
            }
            .bind(this))
        },
        initializeAnimationSubviews: function(t) {
            i.e(17, function() {
                var e = i(1839)
                  , n = this.scene.getFeatures().animation.getModel();
                this._createSubview("animationControls", e, {
                    el: this.$(".animation-controls"),
                    model: n,
                    currentModel: this._currentModel
                }),
                "function" == typeof t && t()
            }
            .bind(this))
        },
        delegateSubviews: function() {
            this.isCardboard() ? (this.subviews.gui.disable(),
            this.subviews.header.disable()) : (this.subviews.loading.on("loaded", setTimeout.bind(window, this.subviews.gui.enable.bind(this.subviews.gui), 500)),
            this.subviews.header.enable()),
            this.subviews.loading.on("loaded", function() {
                var t = k().transparent;
                t || this.$el.addClass("transparent-pattern")
            }
            .bind(this))
        },
        onStart: function() {
            this.start(),
            this._startTracked || (this._startTracked = !0)
        },
        start: function(t) {
            return this.$el.addClass("started"),
            t === !0 ? u.modelEmbedAutostart(this._currentUid) : u.modelEmbedPlayButtonClicked(this._currentUid),
            this._options && this.load(),
            this.scene && this.scene.getViewerOSGJS && this.scene.getViewerOSGJS().done() && (this.scene.getViewerOSGJS().setDone(!1),
            this.scene.getViewerOSGJS().run()),
            this.trigger("started"),
            this
        },
        onStop: function() {
            this.stop()
        },
        stop: function() {
            var t = this._currentModel ? this._currentModel.get("uid") : this._currentUid;
            return u.modelEmbedStopButtonClicked(t),
            this.$el.removeClass("started"),
            this.scene.getViewerOSGJS && this.scene.getViewerOSGJS().setDone(!0),
            this.subviews.hotspots && this.subviews.hotspots.triggerHotspotCycle(!1),
            this.trigger("started"),
            this
        },
        load: function() {
            if (this._options) {
                var t = this._options;
                this._options = null,
                this.scene && (this.scene.drop(),
                this.scene = null),
                this.subviews.loading.reset(),
                this.$el.removeClass("model-loaded"),
                this.$el.addClass("model-loading"),
                g.get(t.uid).then(this.onModelLoad.bind(this, t))
            }
        },
        lookat: function(t, e, i) {
            void 0 === i && (i = 1);
            var n = this.scene.getFeatures()
              , r = n.cameraAnimation.getModel();
            r.set("duration", i),
            r.setTargetAndEye(e, t)
        },
        isVR: function() {
            return this.scene ? this.scene.getFeatures().webVR.getModel().get("enable") : k().cardboard > 0
        },
        isCardboard: function() {
            return k().cardboard > 0
        },
        onModelLoad: function(t, e) {
            this._currentModel = e,
            e.hit();
            var i = this.scene = this.createScene(e, t);
            this.subviews.loading.handleLoading({
                model: e,
                scene: i
            }),
            i.run(e),
            this.initShortcuts(),
            this.initViewerFeatures();
            var n = this.scene.getFeatures();
            this._createSubview("unsupportedAnimation", w, {
                el: this.$(".animation-not-supported"),
                model: n.animation.getModel()
            }),
            this.subviews.hint.show(),
            this.trigger("model-loaded")
        },
        setScene: function(t) {
            if (this.scene)
                throw new Error("It is currently impossible to reset a scene");
            return this._options = t,
            this._currentUid = t.uid,
            this
        },
        createScene: function(t, e) {
            if (l()) {
                var i = {};
                return i.el = this.$(".webgl"),
                i.features = e.features,
                i.widgetAPI = e.widgetAPI,
                i.model = t,
                i.viewerAPI = e.viewerAPI,
                T.getPolygon().then(function(t) {
                    u.modelViewerPolygonLoaded(t.time)
                }),
                T.getWireframe().then(function(t) {
                    u.modelViewerWireframeLoaded(t.time)
                }),
                T.getLowResLoaded().then(function(t) {
                    u.modelViewerLowResTexturesLoaded(t.time, t.count)
                }),
                T.getHighResLoaded().then(function(t) {
                    u.modelViewerHighResTexturesLoaded(t.time, t.count)
                }),
                T.getModelDisplayed().then(function(t) {
                    u.modelViewerModelDisplayed(t.time)
                }),
                new I(i)
            }
            return u.modelViewerFallbackDisplayed(t.get("uid")),
            new E({
                model: t,
                el: this.$(".fallback"),
                features: e.features
            })
        },
        initViewerFeatures: function() {
            T.getHasAnimation().then(function(t) {
                t && this.initializeAnimation()
            }
            .bind(this)),
            this.initializeHotspots(),
            this.initializeShadingStyle(),
            this.initializeViewerMode(),
            this.initializeTextureQuality(),
            this.initializeVr()
        },
        getHotspotModel: function() {
            var t = this.scene.getFeatures().hotspot;
            return t && t.getModel()
        },
        initializeHotspots: function() {
            var t = this.getHotspotModel();
            t && !this.isVR() && this.initializeHotspotsSubviews(function() {
                var e = this.subviews.hotspots;
                t.setUpdateCallback(e.refreshHotspots.bind(e));
                var i = t.get("hotspots");
                i.on("add remove sort change:title change:description change:position", e.refreshHotspots, e),
                i.on("add remove sort change:name", e.updateHotspotsControls, e),
                i.on("add remove", n.debounce(this.subviews.generalControls.renderSettings, 100), this.subviews.generalControls),
                i.on("select", e.onHotspotSelected, e),
                this.proxySettings.on("change:annotationsVisible", function() {
                    this.proxySettings.get("annotationsVisible") === !0 ? e.showAnnotations() : e.hideAnnotations()
                }
                .bind(this)),
                this.proxySettings.set("annotationsVisible", k().annotationsVisible),
                e.updateHotspotsControls(),
                T.getFirstCameraAnimation().then(function() {
                    e.refreshHotspots(),
                    t.on("hotspot-error", this.subviews.osd.show.bind(this.subviews.osd)),
                    k().annotation > 0 && i.trigger("select", i.at(k().annotation - 1)),
                    k().annotationCycleAutostart === !0 && (this.subviews.hotspots.trackHotspotCycle(!0),
                    this.subviews.hotspots.triggerHotspotCycle(!0))
                }
                .bind(this))
            }
            .bind(this))
        },
        initializeAnimation: function() {
            var t = this.scene.getFeatures().animation
              , e = t.getModel();
            this.initializeAnimationSubviews(function() {
                this.$el.addClass("has-animation"),
                this.subviews.generalControls.setHasAnimations(!0),
                this.proxySettings.set("speed", e.get("speed")),
                this.proxySettings.set("cycleMode", e.get("cycleMode")),
                this.proxySettings.set("fps", e.get("fps")),
                this.proxySettings.on("change:speed", function(t, i) {
                    e.set("speed", i)
                }),
                this.proxySettings.on("change:cycleMode", function(t, i) {
                    e.set("cycleMode", i)
                }),
                this.proxySettings.on("change:fps", function(t, i) {
                    e.set("fps", i)
                }),
                e.on("change:fps", function(t, e) {
                    this.proxySettings.set("fps", e)
                }
                .bind(this)),
                this.$(".osd").addClass("padded"),
                this.$(".timeline").removeClass("disabled")
            }
            .bind(this))
        },
        initializeTextureQuality: function() {
            var t = this
              , e = this.scene.getFeatures().quality;
            if (e) {
                var i = e.getModel();
                i.on("qualityReady", this.subviews.generalControls.settings.onTextureQualityReady.bind(this.subviews.generalControls.settings)),
                this.proxySettings.on("change:textureQuality", function() {
                    var e = parseInt(this.get("textureQuality"), 10);
                    window.requestAnimationFrame(function() {
                        i.set("level", e)
                    });
                    var n = t.subviews.generalControls.getSettingLabelForValue("textureQuality", e + "");
                    t.$(".control-badge").text(n).addClass("active")
                })
            }
        },
        initializeViewerMode: function() {
            var t = this.scene.getFeatures().manipulator;
            if (t) {
                var e = t.getModel()
                  , i = e.get("indexManipulator");
                this.proxySettings.set("viewerMode", i),
                this.subviews.gui.renderSetting("viewerMode", i),
                this.proxySettings.on("change:viewerMode", function() {
                    e.set("indexManipulator", parseInt(this.proxySettings.get("viewerMode"), 10)),
                    this.scene.getFeaturesManager().focusOnSavedCamera(1),
                    this.$("canvas").focus()
                }
                .bind(this))
            }
        },
        initializeShadingStyle: function() {
            var t = this.scene.getFeatures().shadingStyle;
            if (t) {
                var e = t.getModel()
                  , i = this
                  , n = function() {
                    i.proxySettings.set("shadingStyle", e.get("style")),
                    i.proxySettings.set("wireframeColor", e.get("wireframeColor")),
                    i.proxySettings.set("wireframeEnable", e.get("wireframeEnable")),
                    i.proxySettings.set("hasWireframe", e.get("hasWireframe")),
                    i.subviews.gui.renderSetting("wireframeColor", i.proxySettings.get("wireframeColor")),
                    i.subviews.gui.renderSetting("wireframeEnable", i.proxySettings.get("wireframeEnable") ? 1 : 0),
                    i.subviews.gui.renderSetting("shadingStyle", i.proxySettings.get("shadingStyle")),
                    i.subviews.gui.renderSetting("hasWireframe", i.proxySettings.get("hasWireframe") ? 1 : 0)
                };
                n(),
                this.proxySettings.listenTo(e, "change", n),
                this.proxySettings.on("change:shadingStyle", function() {
                    e.set("style", this.get("shadingStyle"))
                }),
                this.proxySettings.on("change:wireframeColor", function() {
                    this.get("wireframeEnable") ? e.setWireframeColorSmooth(this.get("wireframeColor")) : e.set("wireframeColor", this.get("wireframeColor"))
                }),
                this.proxySettings.on("change:wireframeEnable", function() {
                    e.set("wireframeEnable", !!this.get("wireframeEnable"))
                }),
                this.listenTo(e, "nextBlendingShader", function(t) {
                    var e = {};
                    e[F.MATCAP | F.WIREFRAME] = "Matcap + Wireframe",
                    e[F.MATCAP | F.GEOMETRY | F.WIREFRAME] = "Matcap + Normal + Wireframe",
                    e[F.DEFAULT & ~F.DIFFUSE] = "No diffuse",
                    e[F.DEFAULT] = "Default",
                    this.subviews.osd.show(e[t], {
                        duration: 5e3,
                        position: "top",
                        style: "compact"
                    })
                }
                .bind(this))
            }
        },
        initializeVr: function() {
            if (this.isVR()) {
                this.$el.addClass("vr-mode");
                var t = 1 === d.get("show_vr_hint", 1);
                if (t) {
                    var e = this.templates.viewerVr([this.subviews.generalControls.hasFullscreen()]);
                    this.subviews.osd.show(e, {
                        duration: 8e3
                    })
                }
                d.set("show_vr_hint", 0, {
                    expires: 504e5,
                    path: "/"
                })
            }
        },
        hackIosCanvasRender: function() {
            n.defer(function() {
                r("canvas")[0].style.width = r("canvas")[0].clientWidth + 1 + "px",
                n.defer(function() {
                    r("canvas")[0].style.width = r("canvas")[0].clientWidth - 1 + "px",
                    r("canvas")[0].style.width = ""
                })
            })
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(285);
    t.exports = function() {
        var t = navigator.userAgent
          , e = t.indexOf("Twitter for iPhone") !== -1;
        return e && n.apple.phone
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(220)
      , a = i(234)
      , s = i(1806)
      , o = function(t, e) {
        if (Array.isArray(t))
            this.shortcuts = t || [];
        else {
            if (!n.isObject(t))
                throw new Error("Shortcut manager needs a shortcut object to function");
            this.shortcutGroup = t,
            this.shortcuts = t.shortcuts || []
        }
        this.options = e || {},
        this.handlers = {},
        this.options = n.defaults({}, this.options, {
            listen: !1
        }),
        this.options.listen && this.listen()
    }
      , u = new s;
    u.stopCallback = function(t, e) {
        return !((" " + e.className + " ").indexOf(" mousetrap ") > -1) && ("button" === document.activeElement.tagName.toLowerCase() || ("INPUT" === e.tagName || "SELECT" === e.tagName || "TEXTAREA" === e.tagName || e.contentEditable && "true" === e.contentEditable))
    }
    ,
    n.extend(o.prototype, a.Events),
    o.prototype.listen = function(t) {
        void 0 === t ? this.shortcuts.forEach(this._listen.bind(this)) : Array.isArray(t) ? (this.shortcuts = this.shortcuts.concat(t),
        t.forEach(this._listen.bind(this))) : this._listen(t)
    }
    ,
    o.prototype.stopListening = function(t) {
        t.forEach(function(t) {
            u.unbind(this._getShortcut(t).keyCombinations),
            delete this.handlers[t]
        }
        .bind(this))
    }
    ,
    o.prototype.getTitle = function() {
        return this.shortcutGroup ? this.shortcutGroup.name || "" : ""
    }
    ,
    o.prototype.getShortcut = function(t) {
        var e = "";
        return this.shortcuts.forEach(function(i) {
            i.id === t && (e = i)
        }
        .bind(this)),
        e
    }
    ,
    o.prototype.getShortDescriptionById = function(t) {
        var e = "";
        return this.shortcuts.forEach(function(i) {
            i.id === t && (e = this._formatKeyCombination(i.keyCombinations).replace("<br />", ""))
        }
        .bind(this)),
        e
    }
    ,
    o.prototype.generateHelpSection = function() {
        var t = r("<div />")
          , e = this.getTitle();
        return e && t.append("<h2>" + e + "</h2>"),
        this.shortcuts.forEach(function(e) {
            e.name && t.append("<b>" + e.name + "</b>"),
            t.append(this._formatKeyCombination(e.keyCombinations))
        }
        .bind(this)),
        t.html() || ""
    }
    ,
    o.prototype.hasKeyCombination = function(t) {
        var e = !1;
        return this.shortcuts.forEach(function(i) {
            e || (Array.isArray(i.shortcuts) ? i.shortcuts.forEach(function(i) {
                e = i === t
            }) : e = i.shortcuts === t)
        }),
        e
    }
    ,
    o.prototype._formatKeyCombination = function(t) {
        var e = "";
        return e = Array.isArray(t) ? t.join("</kbd> or <kbd>") : t,
        e = "<kbd>" + e + "</kbd><br />"
    }
    ,
    o.prototype._listen = function(t) {
        this._validate(t) && !this.handlers[t.id] && (this.handlers[t.id] = this._notify.bind(this, t),
        u.bind(t.keyCombinations, this.handlers[t.id]))
    }
    ,
    o.prototype._getShortcut = function(t) {
        return n.find(this.shortcuts, function(e) {
            return e.id === t
        })
    }
    ,
    o.prototype._validate = function(t) {
        return void 0 !== t.keyCombinations && void 0 !== t.id
    }
    ,
    o.prototype._notify = function(t, e) {
        this.trigger(t.id, t, e)
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    var n;
    !function(r, a, s) {
        function o(t, e, i) {
            return t.addEventListener ? void t.addEventListener(e, i, !1) : void t.attachEvent("on" + e, i)
        }
        function u(t) {
            if ("keypress" == t.type) {
                var e = String.fromCharCode(t.which);
                return t.shiftKey || (e = e.toLowerCase()),
                e
            }
            return A[t.which] ? A[t.which] : y[t.which] ? y[t.which] : String.fromCharCode(t.which).toLowerCase()
        }
        function l(t, e) {
            return t.sort().join(",") === e.sort().join(",")
        }
        function c(t) {
            var e = [];
            return t.shiftKey && e.push("shift"),
            t.altKey && e.push("alt"),
            t.ctrlKey && e.push("ctrl"),
            t.metaKey && e.push("meta"),
            e
        }
        function h(t) {
            return t.preventDefault ? void t.preventDefault() : void (t.returnValue = !1)
        }
        function d(t) {
            return t.stopPropagation ? void t.stopPropagation() : void (t.cancelBubble = !0)
        }
        function p(t) {
            return "shift" == t || "ctrl" == t || "alt" == t || "meta" == t
        }
        function f() {
            if (!x) {
                x = {};
                for (var t in A)
                    t > 95 && t < 112 || A.hasOwnProperty(t) && (x[A[t]] = t)
            }
            return x
        }
        function g(t, e, i) {
            return i || (i = f()[t] ? "keydown" : "keypress"),
            "keypress" == i && e.length && (i = "keydown"),
            i
        }
        function m(t) {
            return "+" === t ? ["+"] : (t = t.replace(/\+{2}/g, "+plus"),
            t.split("+"))
        }
        function v(t, e) {
            var i, n, r, a = [];
            for (i = m(t),
            r = 0; r < i.length; ++r)
                n = i[r],
                C[n] && (n = C[n]),
                e && "keypress" != e && S[n] && (n = S[n],
                a.push("shift")),
                p(n) && a.push(n);
            return e = g(n, a, e),
            {
                key: n,
                modifiers: a,
                action: e
            }
        }
        function _(t, e) {
            return null !== t && t !== a && (t === e || _(t.parentNode, e))
        }
        function b(t) {
            function e(t) {
                t = t || {};
                var e, i = !1;
                for (e in x)
                    t[e] ? i = !0 : x[e] = 0;
                i || (S = !1)
            }
            function i(t, e, i, n, r, a) {
                var s, o, u = [], c = i.type;
                if (!m._callbacks[t])
                    return [];
                for ("keyup" == c && p(t) && (e = [t]),
                s = 0; s < m._callbacks[t].length; ++s)
                    if (o = m._callbacks[t][s],
                    (n || !o.seq || x[o.seq] == o.level) && c == o.action && ("keypress" == c && !i.metaKey && !i.ctrlKey || l(e, o.modifiers))) {
                        var h = !n && o.combo == r
                          , d = n && o.seq == n && o.level == a;
                        (h || d) && m._callbacks[t].splice(s, 1),
                        u.push(o)
                    }
                return u
            }
            function n(t, e, i, n) {
                m.stopCallback(e, e.target || e.srcElement, i, n) || t(e, i) === !1 && (h(e),
                d(e))
            }
            function r(t) {
                "number" != typeof t.which && (t.which = t.keyCode);
                var e = u(t);
                if (e)
                    return "keyup" == t.type && A === e ? void (A = !1) : void m.handleKey(e, c(t), t)
            }
            function s() {
                clearTimeout(_),
                _ = setTimeout(e, 1e3)
            }
            function f(t, i, r, a) {
                function o(e) {
                    return function() {
                        S = e,
                        ++x[t],
                        s()
                    }
                }
                function l(i) {
                    n(r, i, t),
                    "keyup" !== a && (A = u(i)),
                    setTimeout(e, 10)
                }
                x[t] = 0;
                for (var c = 0; c < i.length; ++c) {
                    var h = c + 1 === i.length
                      , d = h ? l : o(a || v(i[c + 1]).action);
                    g(i[c], d, a, t, c)
                }
            }
            function g(t, e, n, r, a) {
                m._directMap[t + ":" + n] = e,
                t = t.replace(/\s+/g, " ");
                var s, o = t.split(" ");
                return o.length > 1 ? void f(t, o, e, n) : (s = v(t, n),
                m._callbacks[s.key] = m._callbacks[s.key] || [],
                i(s.key, s.modifiers, {
                    type: s.action
                }, r, t, a),
                void m._callbacks[s.key][r ? "unshift" : "push"]({
                    callback: e,
                    modifiers: s.modifiers,
                    action: s.action,
                    seq: r,
                    level: a,
                    combo: t
                }))
            }
            var m = this;
            if (t = t || a,
            !(m instanceof b))
                return new b(t);
            m.target = t,
            m._callbacks = {},
            m._directMap = {};
            var _, x = {}, A = !1, y = !1, S = !1;
            m._handleKey = function(t, r, a) {
                var s, o = i(t, r, a), u = {}, l = 0, c = !1;
                for (s = 0; s < o.length; ++s)
                    o[s].seq && (l = Math.max(l, o[s].level));
                for (s = 0; s < o.length; ++s)
                    if (o[s].seq) {
                        if (o[s].level != l)
                            continue;
                        c = !0,
                        u[o[s].seq] = 1,
                        n(o[s].callback, a, o[s].combo, o[s].seq)
                    } else
                        c || n(o[s].callback, a, o[s].combo);
                var h = "keypress" == a.type && y;
                a.type != S || p(t) || h || e(u),
                y = c && "keydown" == a.type
            }
            ,
            m._bindMultiple = function(t, e, i) {
                for (var n = 0; n < t.length; ++n)
                    g(t[n], e, i)
            }
            ,
            o(t, "keypress", r),
            o(t, "keydown", r),
            o(t, "keyup", r)
        }
        if (r) {
            for (var x, A = {
                8: "backspace",
                9: "tab",
                13: "enter",
                16: "shift",
                17: "ctrl",
                18: "alt",
                20: "capslock",
                27: "esc",
                32: "space",
                33: "pageup",
                34: "pagedown",
                35: "end",
                36: "home",
                37: "left",
                38: "up",
                39: "right",
                40: "down",
                45: "ins",
                46: "del",
                91: "meta",
                93: "meta",
                224: "meta"
            }, y = {
                106: "*",
                107: "+",
                109: "-",
                110: ".",
                111: "/",
                186: ";",
                187: "=",
                188: ",",
                189: "-",
                190: ".",
                191: "/",
                192: "`",
                219: "[",
                220: "\\",
                221: "]",
                222: "'"
            }, S = {
                "~": "`",
                "!": "1",
                "@": "2",
                "#": "3",
                $: "4",
                "%": "5",
                "^": "6",
                "&": "7",
                "*": "8",
                "(": "9",
                ")": "0",
                _: "-",
                "+": "=",
                ":": ";",
                '"': "'",
                "<": ",",
                ">": ".",
                "?": "/",
                "|": "\\"
            }, C = {
                option: "alt",
                command: "meta",
                "return": "enter",
                escape: "esc",
                plus: "+",
                mod: /Mac|iPod|iPhone|iPad/.test(navigator.platform) ? "meta" : "ctrl"
            }, M = 1; M < 20; ++M)
                A[111 + M] = "f" + M;
            for (M = 0; M <= 9; ++M)
                A[M + 96] = M;
            b.prototype.bind = function(t, e, i) {
                var n = this;
                return t = t instanceof Array ? t : [t],
                n._bindMultiple.call(n, t, e, i),
                n
            }
            ,
            b.prototype.unbind = function(t, e) {
                var i = this;
                return i.bind.call(i, t, function() {}, e)
            }
            ,
            b.prototype.trigger = function(t, e) {
                var i = this;
                return i._directMap[t + ":" + e] && i._directMap[t + ":" + e]({}, t),
                i
            }
            ,
            b.prototype.reset = function() {
                var t = this;
                return t._callbacks = {},
                t._directMap = {},
                t
            }
            ,
            b.prototype.stopCallback = function(t, e) {
                var i = this;
                return !((" " + e.className + " ").indexOf(" mousetrap ") > -1) && (!_(e, i.target) && ("INPUT" == e.tagName || "SELECT" == e.tagName || "TEXTAREA" == e.tagName || e.isContentEditable))
            }
            ,
            b.prototype.handleKey = function() {
                var t = this;
                return t._handleKey.apply(t, arguments)
            }
            ,
            b.addKeycodes = function(t) {
                for (var e in t)
                    t.hasOwnProperty(e) && (A[e] = t[e]);
                x = null
            }
            ,
            b.init = function() {
                var t = b(a);
                for (var e in t)
                    "_" !== e.charAt(0) && (b[e] = function(e) {
                        return function() {
                            return t[e].apply(t, arguments)
                        }
                    }(e))
            }
            ,
            b.init(),
            r.Mousetrap = b,
            "undefined" != typeof t && t.exports && (t.exports = b),
            n = function() {
                return b
            }
            .call(e, i, e, t),
            !(n !== s && (t.exports = n))
        }
    }("undefined" != typeof window ? window : null, "undefined" != typeof window ? document : null)
}
, function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(1808)
      , a = i(255);
    t.exports = r.extend({
        VIEWER_MODE_ORBIT: 0,
        VIEWER_MODE_FPS: 1,
        HOTSPOT_CYCLE_PAUSE: 1e4,
        events: {
            "click .has-menu": "toggleMenu",
            "touchstart .has-menu": "toggleMenuTouch",
            keydown: "onKeydown",
            mousewheel: "onMousewheel",
            "mousedown  .webgl .canvas": "cameraMoveStart",
            "touchstart .webgl .canvas": "cameraMoveStart",
            "mousedown  .webgl": "mouseDownEvent",
            "mouseup    .webgl": "mouseUpEvent",
            "touchstart .webgl": "mouseDownEvent",
            "touchend   .webgl": "mouseUpEvent",
            "mousedown  .fallback": "mouseDownEvent",
            "touchstart .fallback": "mouseDownEvent",
            "click      .watermark": "onWatermarkClick",
            "touchend   .watermark": "onWatermarkClick"
        },
        constructor: function() {
            this.globalCloseEvent = this.globalCloseEvent.bind(this),
            this.globalMouseUpEvent = this.globalMouseUpEvent.bind(this),
            this.onKeydown = this.onKeydown.bind(this),
            r.prototype.constructor.apply(this, arguments)
        },
        delegateEvents: function() {
            r.prototype.delegateEvents.apply(this, arguments);
            var t = n(document);
            t.on("keydown", this.onKeydown),
            t.on("mousedown", this.globalCloseEvent),
            t.on("mouseup", this.globalMouseUpEvent),
            t.on("mousewheel.delegateEvents" + this.cid, ".annotation", this.preventScroll)
        },
        undelegateEvents: function() {
            r.prototype.undelegateEvents.apply(this, arguments);
            var t = n(document);
            t.off("keydown", this.onKeydown),
            t.off("mousedown", this.globalCloseEvent),
            t.off("mouseup", this.globalMouseUpEvent),
            t.off("mousewheel.delegateEvents" + this.cid, ".annotation", this.preventScroll)
        },
        enable: function() {
            this.$(".gui").addClass("enabled")
        },
        disable: function() {
            this.$(".gui").removeClass("enabled")
        },
        closeMenus: function() {
            this.$(".gui").find(".has-menu").removeClass("active"),
            this.viewer.subviews.generalControls && this.viewer.subviews.generalControls.settings && this.viewer.subviews.generalControls.settings.togglePane(!1)
        },
        cameraMoveStart: function() {
            this.viewer.$(".webgl").addClass("camera-moving"),
            this.viewer.subviews.hotspots && this.viewer.subviews.hotspots.pauseHotspotCycleInterval()
        },
        cameraMoveEnd: function() {
            this.viewer.$(".webgl").removeClass("camera-moving"),
            this.viewer.subviews.hotspots && this.viewer.subviews.hotspots._hotspotCycleIntervalPaused && this.viewer.subviews.hotspots.beginHotspotCycleInterval(this.HOTSPOT_CYCLE_PAUSE)
        },
        onMousewheel: function() {
            var t;
            if (this.viewer.scene) {
                var e = this.viewer.scene.getFeatures();
                e.hasOwnProperty("manipulator") && (t = e.manipulator.getModel().get("indexManipulator"))
            }
            if (t === this.VIEWER_MODE_FPS) {
                var i = this.viewer.scene.getViewerOSGJS().getManipulator().getCurrentManipulator()._stepFactor
                  , n = Math.round(i / 4 * 100);
                this.viewer.subviews.osd.show("Walking speed: " + n, {
                    duration: 1e3
                })
            }
        },
        onKeydown: function(t) {
            var e = document.activeElement
              , i = ""
              , n = ["BODY", "CANVAS"]
              , r = 32
              , a = 27;
            if (t.which === r && e && (i = e.tagName,
            n.indexOf(i) !== -1 && (this.recenter(),
            t.preventDefault())),
            t.which >= 96 && t.which <= 105 && this.timeline && this.timeline.setCurrentAnimation(t.which - 96),
            t.which === a) {
                if (this.viewer.subviews.hotspots) {
                    if (!this.viewer.subviews.hotspots._hotspots.length)
                        return;
                    this.viewer.subviews.hotspots.currentHotspot = -1,
                    this.viewer.subviews.hotspots.applyCurrentHotspot(),
                    this.viewer.subviews.hotspots.unrevealHotspots(),
                    this.viewer.subviews.hotspots.stopHotspotCycleInterval()
                }
                this.closeMenus()
            }
        },
        preventParentScroll: function(t, e) {
            var i = n(".hotspot-controls .list")
              , r = i.height()
              , a = i.children()[0].scrollHeight
              , s = i.children()[0].scrollTop;
            (s === a - r && e < 0 || 0 === s && e > 0) && t.preventDefault()
        },
        preventScroll: function(t) {
            t.preventDefault()
        },
        globalMouseUpEvent: function() {
            this.cameraMoveEnd()
        },
        globalCloseEvent: function(t) {
            n(t.target).hasClass("has-menu") || n(t.target).parents(".has-menu").length || this.closeMenus(t)
        },
        toggleMenu: function(t) {
            t.preventDefault(),
            t.stopPropagation();
            var e = n(t.currentTarget);
            e.hasClass("active") ? t.currentTarget === t.target && e.attr("data-title", e.attr("title")).removeClass("active") : (this.closeMenus(),
            e.attr("title", e.attr("data-title")).removeAttr("data-title").addClass("active"))
        },
        toggleMenuTouch: function(t) {
            t.preventDefault(),
            t.stopPropagation(),
            this.toggleMenu(t)
        },
        renderSetting: function(t, e) {
            this.viewer.$('[data-setting="' + t + '"]').removeClass("active"),
            "wireframeColor" === t && this.viewer.proxySettings.get("wireframeEnable") === !1 || this.viewer.$('[data-setting="' + t + '"][data-value="' + e + '"]').addClass("active")
        },
        getPointerPosition: function(t) {
            var e, i = t.originalEvent ? t.originalEvent : t, n = {};
            return i.touches && i.touches.length || i.changedTouches && i.changedTouches.length ? (e = i.touches && i.touches.length ? i.touches : i.changedTouches,
            e = e[0],
            n.x = e.pageX,
            n.y = e.pageY,
            n.type = "Touch") : (n.x = t.pageX,
            n.y = t.pageY,
            n.type = "Mouse"),
            n
        },
        mouseDownEvent: function(t) {
            this.mouseDownPosition = this.getPointerPosition(t),
            this.viewer.subviews.hint.hide(),
            "touchstart" === t.type && (t.target === t.currentTarget || this.scene && this.scene.getCanvas && t.target === this.viewer.scene.getCanvas()) && t.preventDefault()
        },
        mouseUpEvent: function(t) {
            if (this.mouseDownPosition) {
                var e = 20
                  , i = this.getPointerPosition(t);
                if (this.viewer.$el.hasClass("started")) {
                    if (Math.abs(this.mouseDownPosition.x - i.x) > e || Math.abs(this.mouseDownPosition.y - i.y) > e) {
                        var n = this.viewer._currentModel ? this.viewer._currentModel.get("uid") : this.viewer._currentUid;
                        a.modelEmbedModelInteraction(n, i.type)
                    }
                    this.mouseDownPosition = null
                }
            }
        },
        recenter: function() {
            this.viewer.scene && this.viewer.scene.getViewerOSGJS().getManipulator().computeHomePosition()
        },
        onWatermarkClick: function() {
            var t = n(".watermark").find("a").attr("href")
              , e = t.split("models/").pop().split("/")[0];
            a.modelEmbedWatermarkClicked(e)
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(258);
    t.exports = n.extend({
        constructor: function(t) {
            this.viewer = t.viewer,
            this.widgets = t.widgets,
            n.prototype.constructor.apply(this, arguments)
        },
        enable: function() {
            this.$el.removeClass("disabled")
        },
        disable: function() {
            this.$el.addClass("disabled")
        },
        isEnabled: function() {
            return this.$el.hasClass("disabled")
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1808)
      , a = i(1680)
      , s = i(1465)
      , o = n.osg
      , u = new a({
        device: "VWR"
    });
    t.exports = r.extend({
        reset: function() {
            this._primaryProgress = 0,
            this._secondaryProgress = 0,
            this._lowerSecondaryProgress = 0,
            this._actualSecondaryProgress = 0
        },
        handleLoading: function(t) {
            t.scene.on("primary-progress", function(t) {
                if (this.setPrimaryProgress(t.progress),
                s().isApp) {
                    var e = u.createMessage({
                        data: {
                            progress: t.progress + ""
                        }
                    });
                    this.previousMessage && this.previousMessage.removeFromHash(),
                    e.appendToHash(),
                    this.previousMessage = e
                }
            }
            .bind(this)),
            t.scene.on("secondary-progress", function(t) {
                this.setSecondaryProgress(t.progress)
            }
            .bind(this)),
            t.scene.on("success", function() {
                this.viewer.$el.removeClass("model-loading").addClass("model-loaded"),
                t.model.trigger("status:loaded"),
                this.trigger("loaded")
            }
            .bind(this)),
            t.scene.on("fail", function() {
                o.error("Viewer instanciation failed")
            }
            .bind(this))
        },
        setPrimaryProgress: function(t) {
            var e = Math.min(Math.max(0, t), 1);
            this._primaryProgress = e,
            this.updateMainProgressBar(this._primaryProgress),
            1 === this._primaryProgress && (this._lowerSecondaryProgress = this._actualSecondaryProgress,
            this.setSecondaryProgress(this._secondaryProgress))
        },
        setSecondaryProgress: function(t) {
            var e = Math.min(Math.max(0, t), 1);
            this._actualSecondaryProgress = e,
            this._secondaryProgress = (this._actualSecondaryProgress - this._lowerSecondaryProgress) / (1 - this._lowerSecondaryProgress),
            1 === this._lowerSecondaryProgress && (this._secondaryProgress = 1),
            this.updateSecondaryProgressBar(this._secondaryProgress)
        },
        updateMainProgressBar: function(t) {
            var e = 1 === this._primaryProgress;
            t = Math.max(t, this._previousPrimaryValue || 0),
            this._previousPrimaryValue = t,
            this.$(".main-progress").toggleClass("loading", !e),
            this.$(".main-progress-display").attr("value", t),
            this.$(".main-progress-percentage").text(Math.floor(100 * t) + " %")
        },
        updateSecondaryProgressBar: function(t) {
            t = Math.max(t, 0),
            this.$(".secondary-progress-percentage").text(Math.floor(100 * t) + " %"),
            this.$(".secondary-progress-display").css("width", 100 * t + "%");
            var e = 1 === this._primaryProgress
              , i = 1 === this._secondaryProgress;
            this.$(".secondary-progress").toggleClass("visible", e && !i)
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1808)
      , a = i(224);
    t.exports = r.extend({
        initialize: function() {
            r.prototype.initialize.apply(this, arguments),
            this.$hint = this.$(".viewer-hint"),
            this.options.fallback && this.$hint.addClass("fallback-position")
        },
        show: function(t) {
            t = n.defaults(n.extend({}, t), {
                force: !1
            });
            var e = 1 === a.get("show_viewer_hint", 1);
            (e || t.force) && this.$hint.addClass("active")
        },
        hide: function(t) {
            t = n.defaults(n.extend({}, t), {
                remember: !0
            }),
            this.$hint.removeClass("active"),
            t.remember && a.set("show_viewer_hint", 0, {
                expires: 15552e6,
                path: "/"
            })
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(216)
      , a = i(285)
      , s = i(271)
      , o = i(255)
      , u = i(1805)
      , l = i(1812)
      , c = i(1813)
      , h = i(215)
      , d = h.shortcuts
      , p = new u(d.viewerRendering)
      , f = {
        shadingStyle: {
            label: "Rendering",
            settings: [{
                label: "Lit",
                value: "lit",
                shortcut: p.getShortDescriptionById("defaultRenderingMode")
            }, {
                label: "Shadeless",
                value: "shadeless",
                shortcut: p.getShortDescriptionById("shadelessRenderingMode")
            }, {
                label: "MatCap",
                value: "matcap",
                shortcut: p.getShortDescriptionById("matcapRenderingMode")
            }],
            paneTemplate: r.template(['    <div class="setting-list-header">', '       <a class="back control-menu-back">Back</a>', '       <span class="setting-list-header-help">Key</span>', "   </div>", '    <ul class="setting-list" data-setting="<%= name %>">', "        <%= listItems %>", "    </ul>", '    <p class="wireframe-title wireframe-setting-group">Wireframe <span class="shortcut" title="Keyboard shortcut">' + p.getShortDescriptionById("toggleWireframe") + "</span></p>", '    <div class="wireframe-colors wireframe-setting-group">', '        <a class="colors-none" data-setting="wireframeEnable" data-value="0" title="Off"></a><!--', '        --><a class="colors-black" data-setting="wireframeColor" data-value="00000099" title="Black"></a><!--', '        --><a class="colors-white" data-setting="wireframeColor" data-value="ffffff99" title="White"></a><!--', '        --><a class="colors-red" data-setting="wireframeColor" data-value="ff507f99" title="Red"></a><!--', '        --><a class="colors-blue" data-setting="wireframeColor" data-value="4d9cff99" title="Blue"></a><!--', '        --><a class="colors-green" data-setting="wireframeColor" data-value="2d9e8499" title="Green"></a><!--', '        --><a class="colors-yellow" data-setting="wireframeColor" data-value="ebc71299" title="Yellow"></a>', "    </div>"].join(""))
        },
        annotationsVisible: {
            label: "Annotations",
            type: "bool",
            group: "annotation",
            settings: [{
                label: "Visible",
                value: !0
            }, {
                label: "Hidden",
                value: !1
            }]
        },
        cycleMode: {
            label: "Anim. Cycle",
            group: "animation",
            settings: [{
                label: "One",
                value: "one"
            }, {
                label: "All",
                value: "all"
            }, {
                label: "None",
                value: "none"
            }]
        },
        speed: {
            label: "Anim. Speed",
            group: "animation",
            settings: [{
                label: "x0.1",
                value: "0.1"
            }, {
                label: "x0.5",
                value: "0.5"
            }, {
                label: "x1",
                value: "1"
            }, {
                label: "x2",
                value: "2"
            }]
        },
        viewerMode: {
            label: "Navigation",
            settings: [{
                label: "Orbit",
                value: "0"
            }, {
                label: "First Person",
                value: "1"
            }]
        },
        textureQuality: {
            label: "Textures",
            group: "textureQuality",
            settings: [{
                label: "LD",
                value: "0"
            }, {
                label: "SD",
                value: "1"
            }, {
                label: "HD",
                value: "2"
            }]
        }
    };
    t.exports = l.extend({
        events: {
            "click .help": "onHelpClick",
            "click .vr": "onVrClick",
            "click .fullscreen": "onFullscreenClick"
        },
        constructor: function() {
            this.fullScreenChange = this.fullScreenChange.bind(this),
            this.onVrClick = this.onVrClick.bind(this),
            this.onFullscreenClick = this.onFullscreenClick.bind(this),
            l.prototype.constructor.apply(this, arguments)
        },
        initialize: function() {
            l.prototype.initialize.apply(this, arguments),
            this.enableVR = !1,
            !this.hasFullscreen() && s() && (this.viewer.$el.addClass("no-fullscreen"),
            this.viewer.$el.find(".controls .settings").addClass("shift-menu-left")),
            this.viewer.on("model-loaded", function() {
                this.renderSettings()
            }
            .bind(this))
        },
        delegateEvents: function() {
            l.prototype.delegateEvents.apply(this, arguments),
            this.onFullScreenChange(this.fullScreenChange),
            this.viewer.proxySettings.on("change", this.renderSettings, this)
        },
        undelegateEvents: function() {
            return l.prototype.undelegateEvents.apply(this, arguments),
            this.$el ? (this.offFullScreenChange(this.fullScreenChange),
            void this.viewer.proxySettings.off("change", this.renderSettings, this)) : this
        },
        setHasAnimations: function(t) {
            this.hasAnimations = t
        },
        getSettingLabelForValue: function(t, e) {
            return f[t].settings.find(function(t) {
                return t.value === e
            }).label
        },
        onHelpClick: function(t) {
            t.preventDefault(),
            t.stopPropagation(),
            o.modelViewerHelpButtonCliked(),
            this.viewer.subviews.helpOverlay.show()
        },
        renderSettings: function() {
            this.settings || (this.settings = new c({
                el: this.$(".settings-menu"),
                viewer: this.viewer,
                settings: f
            })),
            this.settings.render()
        },
        onVrClick: function(t) {
            t.stopPropagation(),
            this.widgets.hotspots && (this.widgets.hotspots.hideTooltips(),
            this.widgets.hotspots.currentHotspot = -1,
            this.widgets.hotspots.renderControl());
            var e = this.viewer.scene.getFeatures().webVR.getModel();
            e.get("hasNativeHMD") ? (e.set("enable", !e.get("enable")),
            o.modelViewerVrButtonClicked("nativeVR")) : a.any ? (this.fullscreenVR(t),
            o.modelViewerVrButtonClicked("mobile")) : (this.openVrInstructions(),
            o.modelViewerVrButtonClicked("desktop"))
        },
        openVrWindow: function() {
            this.viewer._currentModel && window.open(this.viewer._currentModel.get("embedUrl") + "?cardboard=1&autostart=1", "skfbCardboard", "menubar=no,toolbar=no")
        },
        openVrInstructions: function() {
            this.viewer._currentModel.sharing().then(function() {
                var t = this.viewer._currentModel.get("sharing").shortUrl;
                this.viewer.subviews.helperVrOverlay.setUrl(t),
                this.viewer.subviews.helperVrOverlay.show()
            }
            .bind(this))
        },
        onFullscreenClick: function(t, e) {
            t.stopPropagation(),
            this.hasFullscreen() ? this.isFullscreen() ? this.exitFullscreen() : this.requestFullscreen() : e ? this.openVrWindow() : this.openFakeFullscreen()
        },
        openFakeFullscreen: function() {
            this.viewer._currentModel && (a.any ? window.open(this.viewer._currentModel.get("embedUrl")) : window.open(this.viewer._currentModel.get("embedUrl"), "skfbFullscreenFallback", "menubar=no,toolbar=no"))
        },
        onFullScreenChange: function(t) {
            var e = n(document);
            e.on("fullscreenchange", t),
            e.on("webkitfullscreenchange", t),
            e.on("msfullscreenchange", t),
            e.on("mozfullscreenchange", t)
        },
        offFullScreenChange: function(t) {
            var e = n(document);
            e.off("fullscreenchange", t),
            e.off("webkitfullscreenchange", t),
            e.off("msfullscreenchange", t),
            e.off("mozfullscreenchange", t)
        },
        fullScreenChange: function() {
            n('[data-action="fullscreen"] > .icon').toggleClass("icon-fullscreen-icon").toggleClass("icon-fullscreen-off-icon"),
            this.viewer.$el.toggleClass("fullscreen", this.isFullscreen());
            var t = this.viewer.scene.getFeatures().webVR;
            if (t) {
                var e = t.getModel();
                this.isFullscreen() ? this.enableVR === !0 && e.set("enable", !0) : this.enableVR === !0 && (e.set("enable", !1),
                this.enableVR = !1)
            }
        },
        fullscreenVR: function(t) {
            return this.enableVR = !0,
            this.onFullscreenClick(t, !0)
        },
        hasFullscreen: function() {
            return document.fullscreenEnabled || document.webkitFullscreenEnabled || document.msFullscreenEnabled || document.mozFullScreenEnabled
        },
        isFullscreen: function() {
            return document.mozFullScreen || document.webkitIsFullScreen
        },
        requestFullscreen: function() {
            this.viewer.el.requestFullscreen ? this.viewer.el.requestFullscreen() : this.viewer.el.webkitRequestFullscreen ? this.viewer.el.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT) : this.viewer.el.msRequestFullscreen ? this.viewer.el.msRequestFullscreen() : this.viewer.el.mozRequestFullScreen && this.viewer.el.mozRequestFullScreen()
        },
        exitFullscreen: function() {
            document.exitFullscreen ? document.exitFullscreen() : document.webkitExitFullscreen ? document.webkitExitFullscreen() : document.msExitFullscreen ? document.msExitFullscreen() : document.mozCancelFullScreen && document.mozCancelFullScreen()
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(1808);
    t.exports = n.extend({})
}
, function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(216)
      , a = i(259)
      , s = i(255)
      , o = i(1808)
      , u = r.template(['<div class="setting" data-setting="<%= name %>" data-setting-group="<%= group %>" data-setting-type="<%= type %>">', '   <p class="setting-label"><%= label %></p>', '   <p class="setting-value" data-value="<%= value %>" ><%= prettyValue %></p>', "</div>"].join(""))
      , l = r.template(['   <a class="control-menu-back back">Back</a>', '   <ul class="setting-list" data-setting="<%= name %>" data-setting-type="<%= type %>">', "       <%= listItems %>", "   </ul>"].join(""))
      , c = r.template('<li class="setting-item <% if (selected) { %>selected<% } %>" data-value="<%= value %>"><%= prettyValue %><span class="shortcut" title="Keyboard shortcut"><%= shortcut %></span></li>');
    t.exports = o.extend({
        initialize: function(t) {
            this.settings = t.settings,
            this.viewer = t.viewer,
            this.settings || console.warn("No settings object given to SettingsMenu"),
            o.prototype.initialize.apply(this, arguments),
            this.$list = this.$(".control-menu-list"),
            this.$pane = this.$(".control-menu-pane"),
            this.$el.on("click touchend", ".setting", this.onSettingClick.bind(this)),
            this.$el.on("click touchend", ".back", this.togglePane.bind(this, !1)),
            this.$el.on("click touchend", ".setting-item", this.onSettingValueClick.bind(this)),
            this.$el.on("click touchend", ".wireframe-colors a", this.onColorClick.bind(this)),
            this.$el.on("click touchend", '[data-setting="viewerMode"] li', this.onViewerModeChange.bind(this)),
            this.viewer.proxySettings.on("change", this.render.bind(this))
        },
        onViewerModeChange: function(t) {
            t && "touchend" === t.type && t.preventDefault();
            var e = this.viewer.proxySettings.get("viewerMode");
            "0" === e ? this.viewer.subviews.osd.show("Click and hold to rotate", {
                position: "top",
                duration: 3e3
            }) : this.viewer.subviews.osd.show("Mouse to look around, keyboard to move", {
                position: "top",
                duration: 3e3
            })
        },
        onColorClick: function(t) {
            t && "touchend" === t.type && t.preventDefault();
            var e = n(t.currentTarget)
              , i = e.attr("data-value")
              , r = e.attr("data-setting")
              , a = this.viewer.proxySettings.get(r);
            i === a && (i = "0",
            e = e.parent().find('[data-value="' + i + '"]')),
            this.viewer.proxySettings.set(r, i),
            "0" !== i ? this.viewer.proxySettings.set("wireframeEnable", !0) : this.viewer.proxySettings.set("wireframeEnable", !1),
            e.parent().find(".active").removeClass("active"),
            e.addClass("active"),
            s.modelViewerWireframeColorSelected(i)
        },
        onSettingClick: function(t) {
            t && "touchend" === t.type && t.preventDefault && t.preventDefault();
            var e = n(t.currentTarget).attr("data-setting")
              , i = this.settings[e];
            i.name = e,
            this.renderSettingPane(i),
            this.togglePane(!0)
        },
        onSettingValueClick: function(t) {
            t.preventDefault(),
            t.stopPropagation();
            var e = n(t.currentTarget)
              , i = e.attr("data-value")
              , r = e.closest("[data-setting]").attr("data-setting")
              , a = e.closest("[data-setting]").attr("data-setting-type") || "string"
              , o = this.settings[r];
            switch ("shadingStyle" === r ? s.modelViewerShadingSelected(i) : "cycleMode" === r ? s.modelViewerAnimationRepeatModeSelected(i) : "annotationsVisible" === r ? s.modelViewerAnnotationsToggled(this.viewer._currentModel.get("uid"), "false" !== i) : "viewerMode" === r && s.modelViewerViewerModeSelected(i),
            this.viewer.proxySettings.once("change", function() {
                o.value = i,
                this.renderSettingPane(o),
                this.updateSetting(o),
                "shadingStyle" !== r && this.togglePane()
            }
            .bind(this)),
            a) {
            case "number":
                i = parseInt(i, 10);
                break;
            case "bool":
                i = "true" === i
            }
            this.viewer.proxySettings.set(r, i)
        },
        onSettingChangeWhileOpen: function() {
            this.renderSettingPane(this._currentSetting)
        },
        renderSettingPane: function(t) {
            var e = ""
              , i = ""
              , n = "string"
              , a = this.viewer.proxySettings.get(t.name)
              , s = this.getSettingFromValue(t.name, a)
              , o = this.viewer._currentModel.get("options").shading.type;
            this._currentSetting && this.viewer.proxySettings.off("change:" + this._currentSetting.name, this.onSettingChangeWhileOpen, this),
            this._currentSetting = t,
            this._currentSetting && this.viewer.proxySettings.on("change:" + this._currentSetting.name, this.onSettingChangeWhileOpen, this),
            "shadingStyle" === t.name && "lit" !== o || r.each(t.settings, function(t) {
                e += c({
                    value: t.value,
                    type: t.type || n,
                    prettyValue: t.label,
                    selected: s === t,
                    shortcut: t.shortcut || ""
                })
            });
            var u = t.paneTemplate || l;
            i = u({
                listItems: e,
                name: t.name,
                type: t.type || n
            }),
            this.$pane.html(i),
            "blending" !== this.viewer.proxySettings.get("shadingStyle") && this.viewer.proxySettings.get("hasWireframe") ? this.$(".wireframe-setting-group").show() : this.$(".wireframe-setting-group").hide();
            var h = this.$('[data-setting="wireframeColor"], [data-setting="wireframeEnable"]');
            if (this.viewer.proxySettings.get("wireframeEnable")) {
                var d = this.viewer.proxySettings.get("wireframeColor")
                  , p = this.$('[data-setting="wireframeColor"][data-value="' + d + '"]');
                p.length && (h.removeClass("active"),
                p.addClass("active"))
            } else
                h.removeClass("active"),
                this.$('[data-setting="wireframeEnable"]').addClass("active");
            var f = this.viewer.scene.getFeatures().webVR.getModel();
            "viewerMode" !== this._currentSetting.name || f.get("hasNativeHMD") ? this.$('[data-value="2"]').show() : this.$('[data-value="2"]').hide()
        },
        updateSetting: function(t) {
            var e = (this.getSettingFromValue(t.name, t.value) || {}).label || "Unknown Value"
              , i = this.$list.find('[data-setting="' + t.name + '"]');
            i.find(".setting-value").html(e)
        },
        getSettingFromValue: function(t, e) {
            var i;
            return (this.settings[t].settings || []).forEach(function(t) {
                t.value !== e && t.value + "" != e + "" || (i = t)
            }),
            i
        },
        togglePane: function(t, e) {
            e && "touchend" === e.type && e.preventDefault(),
            this.$el.toggleClass("detail", t),
            a(this.$(".control-menu-wrapper"), function() {
                this.$el.hasClass("detail") || this.clearPane()
            }
            .bind(this))
        },
        clearPane: function() {
            this.$pane.html("")
        },
        render: function() {
            var t = ""
              , e = this.viewer.scene.getFeatures().quality.getModel()
              , i = this.viewer.scene.getFeatures().manipulator.getModel()
              , n = this.viewer.scene.getFeatures().hotspot.getModel()
              , a = this.viewer.scene.getFeatures().animation.getModel();
            r.each(this.settings, function(e, i) {
                var n = this.getSettingFromValue(i, this.viewer.proxySettings.get(i)) || e.settings[0];
                t += u({
                    name: i,
                    label: e.label,
                    value: n.value,
                    prettyValue: n.label,
                    group: e.group,
                    type: n.type
                })
            }
            .bind(this)),
            this.$list.html(t),
            o.prototype.render.apply(this, arguments),
            a && a.get("animations").length ? this.$('[data-setting-group="animation"]').show() : this.$('[data-setting-group="animation"]').hide(),
            e && this._qualityReady ? this.$('[data-setting-group="textureQuality"]').show() : this.$('[data-setting-group="textureQuality"]').hide(),
            n && n.get("hotspots").length ? this.$('[data-setting-group="annotation"]').show() : this.$('[data-setting-group="annotation"]').hide();
            var s = this.getSettingFromValue("viewerMode", i.get("indexManipulator"));
            if (this.$('[data-setting="viewerMode"] .setting-value').attr("data-value", s.value).text(s.label),
            a) {
                var l = this.getSettingFromValue("speed", a.get("speed"));
                this.$('[data-setting="speed"] .setting-value').attr("data-value", l.value).text(l.label);
                var c = this.getSettingFromValue("cycleMode", a.get("cycleMode"));
                this.$('[data-setting="cycleMode"] .setting-value').attr("data-value", c.value).text(c.label)
            }
            e && window.requestAnimationFrame(function() {
                var t = this.getSettingFromValue("textureQuality", e.get("level"));
                this.$('[data-setting="textureQuality"] .setting-value').attr("data-value", t.value).text(t.label)
            }
            .bind(this))
        },
        onTextureQualityReady: function(t) {
            var e = this.viewer.scene.getFeatures().quality;
            if (e) {
                if (!t.low && !t.mid && !t.high)
                    return void this.$('[data-setting="textureQuality"]').remove();
                this._qualityReady = !0;
                var i = ["low", "mid", "high"]
                  , n = 0;
                i.forEach(function(e, i) {
                    if (!t[e]) {
                        var r = this.settings.textureQuality.settings;
                        r.splice(i - n, 1),
                        n++
                    }
                }
                .bind(this)),
                r.last(this.settings.textureQuality.settings).label = "HD";
                var a = 2;
                t.low && !t.high && (a = t.mid ? 1 : 0);
                var s = e.getModel()
                  , o = s.get("level");
                this.viewer.proxySettings.set("textureQuality", o),
                this.render()
            }
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(1808);
    t.exports = n.extend({
        events: {
            "click .close": "close"
        },
        close: function(t) {
            t && t.preventDefault && t.preventDefault()
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(235)
      , a = i(1198)
      , s = i(1808)
      , o = i(1816)
      , u = i(1793)
      , l = i(266)
      , c = i(1635)
      , h = a.osg;
    t.exports = s.extend({
        events: {
            "mouseover .snapshot .button": "showGuides",
            "mouseout .snapshot .button": "hideGuides"
        },
        initialize: function() {
            s.prototype.initialize.apply(this, arguments),
            this.$el.find(".snapshot .button").on("click", this.onSnapshot.bind(this))
        },
        onSnapshot: function(t) {
            var e = this.viewer.scene;
            t.preventDefault();
            var i = this.$el.find(".snapshot")
              , n = this.$el.find(".snapshot-flash")
              , a = this.$el.find(".img-container");
            if (!i.hasClass("progress")) {
                i.addClass("progress"),
                n.addClass("active"),
                setTimeout(function() {
                    n.removeClass("active")
                }, 2e3);
                var s = !0
                  , o = e.getFeatures();
                if (o.manipulator) {
                    o.manipulator && o.manipulator.getModel().saveCameraPosition();
                    var l = e.getFeatures().saveUI;
                    l || (l = new u,
                    l.init(e.getFeaturesManager()._context),
                    l._views[0].enableSaving()),
                    s = l._views[0].save(t)
                }
                r.all([e.getScreenShot(), s]).then(this.onTakeScreenshot.bind(this, i, a))
            }
        },
        onTakeScreenshot: function(t, e, i) {
            var n = i[0]
              , r = c(n.toDataURL("image/jpeg"))
              , a = new o({
                imageFile: r
            })
              , s = this.viewer._currentModel
              , u = a.save({
                modelUID: s.get("uid")
            })
              , d = e.find("img");
            d && (d.remove(),
            null !== this.previewTimeout && (window.clearTimeout(this.previewTimeout),
            this.previewTimeout = null));
            var p = new Image;
            p.src = n.toDataURL("image/jpeg"),
            e.prepend(p),
            e.removeClass("invisible"),
            this.previewTimeout = setTimeout(function() {
                e.addClass("invisible")
            }, 4e3),
            u.done(function() {
                t.removeClass("progress"),
                t.addClass("success"),
                setTimeout(function() {
                    t.removeClass("success")
                }, 2e3)
            }).fail(function() {
                var e = new l({
                    title: "Save settings error",
                    text: "An unexpected error happened. The thumbnail has NOT been saved.",
                    buttons: {
                        ok: !0
                    }
                });
                e.open().then(function() {
                    e.close()
                }),
                h.error("Error while saving snapshot"),
                t.removeClass("progress")
            })
        },
        showGuides: n.debounce(function() {
            this.$(".snapshot-guides").addClass("active")
        }, 100),
        hideGuides: n.debounce(function() {
            this.$(".snapshot-guides").removeClass("active")
        }, 100)
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(238);
    t.exports = r.extend({
        save: function(t, e) {
            null != t && "object" != typeof t || (e = t);
            var i = new FormData;
            return i.append("imageFile", this.get("imageFile")),
            i.append("source", this.get("source")),
            i.append("modelUid", e.modelUID),
            n.ajax({
                url: this.url(),
                data: i,
                processData: !1,
                contentType: !1,
                type: "POST"
            })
        },
        url: function() {
            return "/i/thumbnails"
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(216)
      , a = i(1805)
      , s = i(215).shortcuts
      , o = i(1818);
    t.exports = o.extend({
        events: r.extend({}, o.prototype.events, {
            "click .tabs a": "onTabClick",
            "touchstart .tabs a": "onTabClick",
            'click [data-action="reset-camera"]': "onResetCameraClick",
            'touchstart [data-action="reset-camera"]': "onResetCameraClick"
        }),
        initialize: function() {
            o.prototype.initialize.apply(this, arguments),
            this.renderingShortcuts = new a(s.viewerRendering),
            this.annotationShortcuts = new a(s.annotationControl),
            this.animationShortcuts = new a(s.animationControl),
            this.render()
        },
        onResetCameraClick: function(t) {
            t.preventDefault(),
            this.hide(),
            this.viewer.scene.getFeaturesManager().focusOnSavedCamera(2)
        },
        render: function() {
            var t = this.renderingShortcuts.generateHelpSection()
              , e = this.annotationShortcuts.generateHelpSection()
              , i = this.animationShortcuts.generateHelpSection();
            this.$(".rendering-shortcuts").html(t),
            this.$(".annotation-shortcuts").html(e),
            this.$(".animation-shortcuts").html(i)
        },
        onTabClick: function(t) {
            t.preventDefault();
            var e = n(t.currentTarget)
              , i = e.attr("data-target")
              , r = this.$("[data-tab].active")
              , a = this.$('[data-tab="' + i + '"]');
            this.$(".tabs li").removeClass("active"),
            e.parent().addClass("active"),
            r.removeClass("active"),
            a.addClass("active")
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(1808);
    t.exports = n.extend({
        events: {
            "click .close": "hide",
            "touchstart .close": "hide"
        },
        show: function(t) {
            t && t.preventDefault && t.preventDefault(),
            this.$el.removeClass("hidden")
        },
        hide: function(t) {
            t && t.preventDefault && t.preventDefault(),
            this.$el.addClass("hidden")
        },
        isVisible: function() {
            return !this.$el.hasClass("hidden")
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(394)
      , a = i(1818)
      , s = a.extend({
        events: n.extend({}, a.prototype.events, {
            "click .tabs a": "onTabClick",
            'click [data-action="reset-camera"]': "onResetCameraClick"
        }),
        setModel: function(t) {
            this.model = t,
            this.render()
        },
        render: function() {
            this.model && (this.$(".hotspot-title").html(this.model.get("name")),
            this.$(".hotspot-content").html(this.model.get("content").rendered),
            this.handleLazyLoading())
        }
    });
    n.extend(s.prototype, r),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(259)
      , a = i(1808);
    t.exports = a.extend({
        events: n.extend({}, a.prototype.events, {
            "click .osd": "hide"
        }),
        show: function(t, e) {
            e = n.extend({
                duration: 1 / 0,
                position: "center",
                style: "default"
            }, e),
            e.duration = Math.max(0, e.duration),
            window.clearTimeout(this.osdTimeout),
            this.$(".osd .osd-content").html(t);
            var i = this.$(".osd");
            i.removeClass("osd-default"),
            i.removeClass("osd-compact"),
            i.addClass("osd-" + e.style),
            i.removeClass("osd-top"),
            i.removeClass("osd-center"),
            i.removeClass("osd-bottom"),
            i.addClass("osd-" + e.position),
            e.duration > 0 && e.duration < 1 / 0 && (i.addClass("hud"),
            this.osdTimeout = setTimeout(this.hide.bind(this), e.duration)),
            i.hasClass("active") || (i.removeClass("hidden"),
            i.addClass("active"))
        },
        hide: function() {
            var t = this.$(".osd");
            t.removeClass("active"),
            r(t[0], function() {
                t.addClass("hidden"),
                t.removeClass("hud"),
                this.$(".osd .osd-content").empty()
            }
            .bind(this))
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1808);
    t.exports = r.extend({
        events: n.extend({}, r.prototype.events, {
            "click .close": "close",
            "touchstart .close": "close"
        }),
        initialize: function() {
            r.prototype.initialize.apply(this, arguments),
            this.toggle(),
            this.model.on("change:notSupported", this.toggle, this)
        },
        toggle: function() {
            var t = this.model.get("notSupported");
            this.$el.toggleClass("hidden", !t)
        },
        close: function(t) {
            t && t.preventDefault && t.preventDefault(),
            this.$el.addClass("hidden"),
            setTimeout(function() {
                this.$el.remove()
            }
            .bind(this), 300)
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(216)
      , a = i(258)
      , s = i(1823)
      , o = i(1824)
      , u = 1
      , l = 2
      , c = a.extend({
        _isLoaded: !1,
        _context: null,
        isMoving: !1,
        startX: 0,
        sensitivity: 20,
        sprite: {
            current: 0,
            steps: 15,
            ratio: null,
            width: 0
        },
        size: u,
        autospinTimer: null,
        events: r.extend({}, a.prototype.events, {
            mousedown: "onMouseDown",
            mouseup: "onMouseUp",
            "mousemove ": "onMouseMove",
            touchstart: "onTouchStart",
            touchend: "onTouchEnd",
            touchmove: "onTouchMove"
        }),
        constructor: function() {
            this._boundResizeEvent = this.onWindowResize.bind(this),
            a.prototype.constructor.apply(this, arguments)
        },
        initialize: function() {
            a.prototype.initialize.apply(this, arguments),
            this.$viewport = n(),
            this.$image = n()
        },
        delegateEvents: function() {
            a.prototype.delegateEvents.apply(this, arguments),
            n(window).on("resize", this._boundResizeEvent)
        },
        undelegateEvents: function() {
            a.prototype.undelegateEvents.apply(this, arguments),
            n(window).off("resize", this._boundResizeEvent),
            this.autospinTimer && clearInterval(this.autospinTimer)
        },
        isViewerReady: function() {
            return this._isLoaded
        },
        run: function() {
            var t = new s;
            this._context = t,
            this.$el.show(),
            this.$el.siblings(".webgl").hide(),
            this.$el.siblings(".osd").hide();
            var e = this.model.get("uid")
              , i = new o([],{
                uid: e
            });
            return i.fetch().then(function() {
                i.length > 0 ? this.displayFallback(i) : this.displayNoFallbackError()
            }
            .bind(this)).fail(function() {
                this.displayNoFallbackError()
            }
            .bind(this)),
            this._isLoaded = !0,
            !0
        },
        getContext: function() {
            return this._context
        },
        getFeatures: function() {
            return {}
        },
        hasFallback: function() {
            var t = this.model.get("fallback");
            return t && t.length > 0
        },
        displayFallback: function(t) {
            this.$viewport = n(".fallback-viewport"),
            this.$image = this.$viewport.find("img.fallback-sprite");
            var e = t.at(0).get("images")
              , i = e[0].url;
            this.$image.on("load", function(t) {
                var e = t.target.naturalHeight
                  , i = t.target.naturalWidth / this.sprite.steps;
                this.sprite.ratio = e ? i / e : 0,
                n(t.target).css("display", "block"),
                this.trigger("secondary-progress", {
                    progress: 1
                }),
                this.trigger("success"),
                this.displayFallbackWarning(),
                this.onWindowResize()
            }
            .bind(this)),
            this.$image.on("error", function(t) {
                console.error("Fallback loading failed. URL : " + i + " ERROR : " + t.toString()),
                this.trigger("fail"),
                this.displayFallbackLoadingError()
            }
            .bind(this)),
            this.$image.attr("src", i)
        },
        displayFallbackLoadingError: function() {
            this.$el.find(".fallback-error-loading").show()
        },
        displayNoFallbackError: function() {
            this.$el.find(".fallback-error-nofallback").show()
        },
        displayFallbackWarning: function() {
            this.$el.find(".fallback-warning").show(),
            this.fallbackWarning = setTimeout(function() {
                this.$el.find(".fallback-warning").fadeOut()
            }
            .bind(this), 5e3)
        },
        onWindowResize: function() {
            var t, e, i = this.$el.width(), n = this.$el.height(), r = i / n;
            this.size === l ? r < this.sprite.ratio ? (t = i,
            e = Math.floor(t / this.sprite.ratio)) : (e = n,
            t = Math.floor(e * this.sprite.ratio)) : r < this.sprite.ratio ? (e = n,
            t = Math.floor(e * this.sprite.ratio)) : (t = i,
            e = Math.floor(t / this.sprite.ratio)),
            this.$viewport.width(t).height(e).css({
                "margin-top": Math.round(-1 * e / 2),
                "margin-left": Math.round(-1 * t / 2)
            }),
            this.sprite.width = Math.round(this.$image.prop("scrollHeight") * this.sprite.ratio),
            this.$viewport.scrollLeft(this.sprite.width * this.sprite.current)
        },
        onMouseDown: function(t) {
            t.preventDefault(),
            this.isMoving = !0,
            this.startX = t.clientX
        },
        onMouseMove: function(t) {
            t.preventDefault(),
            this.move(t.clientX)
        },
        onMouseUp: function(t) {
            t.preventDefault(),
            this.isMoving = !1
        },
        onTouchStart: function(t) {
            t.preventDefault(),
            this.isMoving = !0;
            var e = t.originalEvent.touches[0];
            this.startX = e.clientX
        },
        onTouchMove: function(t) {
            t.preventDefault(),
            this.move(t.originalEvent.touches[0].clientX)
        },
        onTouchEnd: function(t) {
            t.preventDefault(),
            this.isMoving = !1
        },
        move: function(t) {
            this.isMoving && (this.autospinTimer && this.stopAutospin(),
            t > this.startX + this.sensitivity && (this.startX = t,
            this.moveRight()),
            t < this.startX - this.sensitivity && (this.startX = t,
            this.moveLeft()))
        },
        moveRight: function() {
            0 === this.sprite.current ? this.sprite.current = this.sprite.steps - 1 : this.sprite.current = this.sprite.current - 1,
            this.$viewport.scrollLeft(this.sprite.width * this.sprite.current)
        },
        moveLeft: function() {
            this.sprite.current = (this.sprite.current + 1) % this.sprite.steps,
            this.$viewport.scrollLeft(this.sprite.width * this.sprite.current)
        },
        startAutospin: function() {
            var t = 500;
            this.autospinTimer = setInterval(r.bind(function() {
                this.moveLeft()
            }, this), t)
        },
        stopAutospin: function() {
            clearInterval(this.autospinTimer),
            this.autospinTimer = null
        },
        toggleAutospin: function() {
            this.autospinTimer ? this.stopAutospin() : this.startAutospin()
        }
    });
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(1198)
      , a = r.osg
      , s = function(t) {
        this._model = void 0 !== t ? t.model : void 0,
        this._viewer = void 0 !== t ? t.viewer : void 0,
        this._scene = void 0 !== t ? t.scene : void 0,
        this._widgetAPI = void 0 !== t ? t.widgetAPI : void 0,
        this._features = {}
    };
    s.prototype = {
        getModel: function() {
            return this._model
        },
        getFeatures: function() {
            return this._features
        },
        getViewer: function() {
            return this._viewer
        },
        getScene: function() {
            return this._scene
        },
        getWidgetAPI: function() {
            return this._widgetAPI
        },
        addFeature: function(t) {
            if (t) {
                var e = t.getName();
                this._features[e] ? a.error("Feature already added" + e) : this._features[e] = t
            }
            return this._features
        },
        getModelByName: function(t) {
            if (t) {
                var e = n.find(this._features, function(e) {
                    var i = e.getModel();
                    return !(!i || !i.getName) && i.getName() === t
                });
                return e ? e.getModel() : void 0
            }
        },
        getViewsByName: function(t) {
            if (t) {
                var e = [];
                return n.forEach(this._features, function(i) {
                    if (i) {
                        var n = i._views.filter(function(e) {
                            return !!e.getName && e.getName() === t
                        });
                        Array.prototype.push.apply(e, n)
                    }
                }),
                e
            }
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(247)
      , r = i(1825);
    t.exports = n.extend({
        model: r,
        parse: function(t) {
            return t.results.images
        },
        url: function() {
            return "/i/models/" + this.options.uid + "/fallback"
        }
    })
}
, 245, function(t, e, i) {
    "use strict";
    var n = i(1548)
      , r = i(235)
      , a = i(216)
      , s = i(285)
      , o = i(1680)
      , u = i(1198)
      , l = i(215)
      , c = i(258)
      , h = i(1191)
      , d = i(221)
      , p = i(1827)
      , f = i(1658)
      , g = i(1828)
      , m = i(1197)
      , v = i(1823)
      , _ = i(1829)
      , b = i(1831)
      , x = i(1559)
      , A = i(1465)
      , y = i(1486)
      , S = i(1834)
      , C = i(1835)
      , M = i(1467)
      , w = i(1657)
      , T = i(1482)
      , E = u.osg
      , I = u.osgViewer
      , k = new o({
        device: "VWR"
    })
      , F = function(t) {
        var e = h() || M() ? 0 : 1;
        return a.find(t, {
            flag: e
        }) || t[0] || t
    }
      , D = function(t) {
        this._dataScene = t,
        this._modelFile = F(this._dataScene.files),
        this._root = new E.Node,
        this._root.setName("Scene - Root"),
        this._polygonNode = new E.Node,
        this._polygonNode.setName("Scene - PolygonNode"),
        this._wireframeNodes = [],
        this._resourcePromises = [];
        var e = function(t, e) {
            return t.concat(e)
        }
          , i = function(t) {
            var e = t.lastIndexOf("/")
              , i = t.substr(0, e + 1);
            return i
        }
          , n = i(this.getPolygonURL());
        this._dataScene.options && this._dataScene.options.materials && a.each(this._dataScene.options.materials, function(t) {
            a.each(t.channels, function(t) {
                t.texture && (t.texture.image && (t.texture.image = e(n, t.texture.image)),
                t.texture.url && (t.texture.url = e(n, t.texture.url)))
            })
        })
    };
    D.prototype = {
        addResourcePromise: function(t) {
            this._resourcePromises.push(t)
        },
        getJSON: function() {
            return this._dataScene
        },
        getPolygonURL: function() {
            return this._modelFile.osgjsUrl
        },
        getWireframeURL: function() {
            return this._modelFile.wireframeUrl
        },
        getPolygonSize: function() {
            return this._modelFile.modelSize
        },
        getWireframeSize: function() {
            return this._modelFile.wireframeSize
        },
        getResourceManager: function() {
            return this._resourceManager || m.instance
        },
        getRoot: function() {
            return this._root
        },
        resourcesReady: function() {
            return this._resourcePromises
        },
        getPolygonNode: function() {
            return this._polygonNode
        },
        getWireframeNodes: function() {
            return this._wireframeNodes
        },
        loadPolygon: function(t, e, i, n) {
            var a = {
                progress: t,
                size: this.getPolygonSize(),
                secondary: !1,
                idChannel: 1,
                node: this.getPolygonNode()
            };
            e && (a.wireframeOptions = {
                progress: n === !0 ? t : void 0,
                size: this.getWireframeSize(),
                secondary: !1,
                idChannel: 2,
                startPromise: i,
                deferDownload: r.defer(),
                nodes: this.getWireframeNodes()
            });
            var s = this.getResourceManager().getOrCreateModel(this.getPolygonURL(), a);
            if (e) {
                var o = E.Timer.instance().tick();
                a.wireframeOptions.deferDownload.promise.then(function() {
                    T.resolveWireframe({
                        time: E.Timer.instance().tick() - o
                    })
                }
                .bind(this))
            }
            return this.getRoot().addChild(this.getPolygonNode()),
            this.getResourceManager().run(),
            s.promise
        },
        loadWireframe: function(t) {
            var e = {
                progress: t,
                size: this.getWireframeSize(),
                secondary: !1,
                idChannel: 2,
                node: new E.Node
            }
              , i = this.getResourceManager().getOrCreateModel(this.getWireframeURL(), e);
            return this.getWireframeNodes().push(e.node),
            this.getRoot().addChild(e.node),
            i.promise
        }
    };
    var N = c.extend({
        initialize: function() {
            c.prototype.initialize.apply(this, arguments),
            this._root = null,
            this._features = this.options.features,
            this._widgetAPI = this.options.widgetAPI,
            this._viewerAPI = this.options.viewerAPI,
            this._widgetAPI && this._widgetAPI.getTabbedWidget().model.on("change", y.draw),
            this._featuresInstancied = {};
            var t = this.$(".canvas")
              , e = t[0];
            e.oncontextmenu = function() {
                return !1
            }
            ,
            E.time("processModelJSON"),
            this.options.model && _(this.options.model),
            E.timeEnd("processModelJSON"),
            E.Geometry.enableVAO = A().useVAO;
            var n = this._viewer = new I.Viewer(e,{
                rstats: this.getOptionRStats(),
                antialias: !1,
                depth: !1,
                stencil: !1,
                alpha: this._requireAlphaContext(this.options.model),
                premultipliedAlpha: !0,
                fullscreen: !1,
                preserveDrawingBuffer: A().preserveDrawingBuffer,
                enableFrustumCulling: !1,
                maxDevicePixelRatio: s.any ? 1.5 : -1,
                scrollwheel: A().scrollwheel,
                EventBackend: {
                    StandardMouseKeyboard: {
                        keyboardEventNode: t[0]
                    },
                    GamePad: {
                        enable: !1
                    }
                }
            })
              , r = E.TimerGPU.instance();
            r.enable(),
            w.setTimerGPU(r),
            n.setContextLostCallback(function() {
                this._contextLost = !0,
                E.warn("Context Lost");
                var t = i(266)
                  , e = new t({
                    title: "3D/WebGL context error",
                    text: "Your browser seems to have hit its 3D capability limit. The page needs to be reloaded to fix this. <br/>If the problems persists, you can try to close other tabs with 3D/WebGL or restart your browser entirely.",
                    safe: !0,
                    buttons: {
                        "continue": !0,
                        continueLabel: "Reload Current Page",
                        cancel: !1
                    }
                });
                e.open().then(function() {
                    window.location.reload()
                })
            }
            .bind(this)),
            n.getState().getShaderGeneratorProxy().addShaderGenerator("earlyZ", new S),
            n.getState().getShaderGeneratorProxy().addShaderGenerator("ShadowCastSkfb", new C);
            for (var a = x(), o = n.getState(), u = 0; u < a; u++)
                o.setGlobalDefaultTextureAttribute(u, E.Texture.textureNull);
            n.requestContinuousUpdate(A().continuousRender),
            t[0].setAttribute("tabindex", "0"),
            n.init(),
            this.getCamera().getRenderer().setCullVisitor(new f),
            n.setupManipulator(),
            this._root = new E.MatrixTransform,
            n.getCamera().setClearColor(E.Vec4.create()),
            n.setSceneData(this._root),
            y.setViewer(n),
            this._superSample = new g(this),
            this._superSample.setCanBeEnabled(A().supersample),
            y.setSuperSample(this._superSample),
            this._superSample.setRoot(this._root),
            n.getManipulator().computeHomePosition(),
            n._requestAnimationFrame = d.get(),
            n.run(),
            this._currentScene = void 0
        },
        _requireAlphaContext: function(t) {
            if (h() || A().transparent)
                return !0;
            var e = t && t.get("options")
              , i = e && e.background && e.background.enable;
            return "none" === i
        },
        getOptionRStats: function() {
            var t = ["EarlyOpaque", "EarlyTransparency", "ShadingOpaque", "ShadingTransparency", "Extra"]
              , e = ["ShadowMap0", "ShadowMap1", "ShadowMap2"]
              , i = ["MergeOpacity", "DofDownsampleCoC", "DofDownsampleColor", "DofNearDilateH", "DofNearDilateV", "DofBlurCircular", "DofCombine", "BloomExtractBright", "VBlur4", "HBlur4", "VBlur6", "HBlur6", "VBlur8", "HBlur8", "VBlur10", "HBlur10", "VBlur12", "HBlur12", "BloomMergeAdditive", "PostProcessMergeable", "Antialias", "DistortionVR", "AntiAliasVR", "PassTroughFinal"]
              , n = ["Total GL", "Shading", "PostProcess", "ShadowMap"]
              , r = {}
              , a = function(t) {
                for (var e = [], i = 0, n = t.length; i < n; ++i)
                    e[i] = t[i].toLowerCase(),
                    r[e[i]] = {
                        caption: t[i],
                        average: !0
                    };
                return e
            }
              , s = [{
                caption: "GL Total (ms)",
                values: a(n)
            }, {
                caption: "GL Shading (ms)",
                values: a(t)
            }, {
                caption: "GL PostProcess (ms)",
                values: a(i)
            }, {
                caption: "GL ShadowMap (ms)",
                values: a(e)
            }];
            return {
                values: r,
                groups: s
            }
        },
        getRootUserData: function() {
            return this._currentScene ? this._currentScene.getRoot().userDataMap || {} : {}
        },
        getWidth: function() {
            return this.getCanvas().width
        },
        getHeight: function() {
            return this.getCanvas().height
        },
        getOptions: function() {
            return this.options
        },
        isViewerReady: function() {
            return this._isLoaded
        },
        getViewerAPI: function() {
            return this._viewerAPI
        },
        createContext: function(t) {
            var e = new v({
                model: t.model,
                viewer: this,
                scene: t.scene,
                widgetAPI: this._widgetAPI
            });
            return e
        },
        updateProgress: function(t, e, i) {
            var n = e ? this._channelsSecondary : this._channelsPrimary
              , r = e ? this._channelsSecondaryWeights : this._channelsPrimaryWeights;
            n[i] = t;
            for (var a = 0, s = 0; s < n.length; ++s)
                a += n[s] * r[s];
            this.trigger(e ? "secondary-progress" : "primary-progress", {
                progress: a
            })
        },
        initProgress: function(t) {
            var e = A().preload;
            this._channelsPrimary = [0, 0],
            t && this._channelsPrimary.push(0),
            this._channelsPrimaryWeights = [],
            this._channelsPrimaryWeights[0] = e ? .5 : .1,
            this._channelsPrimaryWeights[1] = e ? .5 : .9,
            t && (this._channelsPrimaryWeights[2] = this._channelsPrimaryWeights[1] = .5 * this._channelsPrimaryWeights[1]),
            this._channelsSecondary = [0],
            this._channelsSecondaryWeights = [1]
        },
        setFakeSecondaryProgress: function(t, e) {
            this.setFakeProgress(t, !0, e)
        },
        setFakePrimaryProgress: function(t, e) {
            this.setFakeProgress(t, !1, e)
        },
        setFakeProgress: function(t, e, i) {
            void 0 === this._idLastProgress && (this._idLastProgress = 0),
            i = i || 0,
            t = void 0 !== t.length ? t : [t];
            var n = t.length;
            if (0 === n)
                return void this.updateProgress(1, e, i);
            for (var r = 0, a = ++this._idLastProgress, s = function() {
                a === this._idLastProgress && this.updateProgress(++r / n, e, i)
            }
            .bind(this), o = 0; o < n; ++o)
                t[o]["finally"](s);
            var u = 0
              , l = 0
              , c = function() {
                if (a === this._idLastProgress) {
                    if (u !== r) {
                        if (r === n)
                            return;
                        u = r,
                        l = r / n
                    }
                    var t = (r + 1) / n;
                    l < t && (l = Math.min(t - .01, l + .01 / n),
                    this.updateProgress(l, e, i)),
                    window.setTimeout(c, 100)
                }
            }
            .bind(this);
            window.setTimeout(c, 100)
        },
        preloadWire: function(t, e) {
            var i = t.loadWireframe(e)
              , n = E.Timer.instance().tick();
            return i.then(function() {
                T.resolveWireframe({
                    time: E.Timer.instance().tick() - n
                })
            }
            .bind(this)),
            i
        },
        run: function(t) {
            var e = r.defer();
            this._isLoaded = e.promise;
            var i = this
              , s = this.getOrCreateScene(t.toJSON());
            s.getResourceManager().setModelUID(t.get("uid")),
            T.resolveHasAnimation(s.getJSON().animationCount > 0 || h() && t.get("options").animation && t.get("options").animation.order && t.get("options").animation.order.length > 0);
            var o = this.createContext({
                model: t,
                scene: s
            })
              , u = []
              , l = A().preload
              , c = F(t.get("files"))
              , d = t.get("options").wireframe.enable === !0 && l === !0 && void 0 !== c.wireframeSize && c.wireframeSize > 0
              , p = !c.wireframeUrl || !c.wireframeSize
              , f = d ? r.resolve() : T.getHighResLoaded()
              , g = s.loadPolygon(this.updateProgress.bind(this), p, f, d);
            u.push(g);
            var m = E.Timer.instance().tick();
            return g.then(function() {
                T.resolvePolygon({
                    time: E.Timer.instance().tick() - m
                })
            }),
            !p && d && u.push(this.preloadWire(s, this.updateProgress.bind(this))),
            E.time("createAndInitFeatures"),
            i._features.forEach(function(t) {
                i.addFeature(t, o)
            }),
            E.timeEnd("createAndInitFeatures"),
            this.initProgress(d),
            r.all(u).then(function() {
                r.all(s.resourcesReady()).then(function() {
                    T.resolveModelDisplayed({
                        time: E.Timer.instance().tick() - m
                    }),
                    a.defer(a.defer.bind(a, function() {
                        if (A().messaging) {
                            var t = k.createMessage({
                                data: "ready"
                            });
                            t.appendToHash()
                        }
                    }
                    .bind(this))),
                    E.time("featureFinished"),
                    i.featureFinished(o, i._root),
                    E.timeEnd("featureFinished"),
                    p || d || T.getHighResLoaded().then(function() {
                        i.preloadWire(s)
                    }),
                    i.trigger("primary-progress", {
                        progress: 1
                    }),
                    n.logBound(i.getOrCreateScene().getRoot()),
                    n.showMessage(),
                    e.resolve(o),
                    i.trigger("success"),
                    i.trigger("viewerready"),
                    y.setLoaded(!0)
                })
            }),
            this._featuresInstancied = o.getFeatures(),
            e.promise
        },
        onFail: function(t, e) {
            E.error(e.stack),
            t.reject(e),
            this.trigger("failure")
        },
        addFeature: function(t, e) {
            if (!t)
                return console.warn("Feature undefined!"),
                !0;
            var i = new t;
            i.init(e)
        },
        drawFrame: function() {
            var t = this._viewer.getState()
              , e = t.getGraphicContext();
            e.colorMask(!1, !1, !1, !1),
            this._viewer.frame(),
            e.colorMask(!0, !0, !0, !0)
        },
        getCanvas: function() {
            return this._viewer.getGraphicContext().canvas
        },
        setTimeline: function(t) {
            this._timeline = t
        },
        getTimeline: function() {
            return this._timeline
        },
        getScreenShot: function(t, e) {
            return p(t, e, this)
        },
        getCamera: function() {
            return this._viewer.getCamera()
        },
        getFeatures: function() {
            return this._featuresInstancied
        },
        getSuperSample: function() {
            return this._superSample
        },
        getFeaturesManager: function() {
            return this._featuresManager
        },
        getViewerOSGJS: function() {
            return this._viewer
        },
        getOrCreateScene: function(t) {
            if (this._currentScene)
                return this._currentScene;
            var e = new D(t);
            return e.getResourceManager().setStateContextOSG(this._viewer.getState()),
            this._currentScene = e,
            e
        },
        featureFinished: function(t, e) {
            return this._featuresManager = new b(this,t),
            this._featuresManager.finished(e)
        },
        getOptionsJSON: function() {
            var t = this.getFeatures()
              , e = {};
            e.version = l.optionsVersion,
            e.background = t.background.getModel().getJSON(),
            e.environment = t.environment.getModel().getJSON(),
            e.lighting = t.lighting.getModel().getJSON(),
            e.scene = t.fov.getModel().getJSON(),
            e.materials = t.material.getModel().getJSON(),
            e.orientation = t.orientation.getModel().getJSON(),
            e.camera = t.manipulator.getModel().getJSON(),
            e.animation = t.animation.getModel().getJSON(),
            e.hotspot = t.hotspot.getModel().getJSON(),
            e.vr = t.webVR.getModel().getJSON(),
            e.scene = e.scene || {},
            e.scene.postProcess = t.postProcess.getModel().getJSON();
            var i = t.shadingStyle.getModel().getJSON();
            return e.shading = i.shading,
            e.wireframe = i.wireframe,
            _.readOptions(e)
        }
    });
    t.exports = N
}
, function(t, e, i) {
    "use strict";
    var n, r, a = i(1198), s = i(1465), o = i(1486), u = i(1482), l = a.osg, c = document.createElement("canvas"), h = document.createElement("canvas"), d = !1;
    u.getHasAnimation().then(function(t) {
        t && (d = t)
    });
    var p = function(t, e, i) {
        var n = t.getGraphicContext()
          , a = c
          , s = a.getContext("2d")
          , o = e.width
          , u = e.height
          , l = 4 * o
          , h = l * u;
        a.width === o && a.height === u || (a.width = o,
        a.height = u,
        r = new Uint8Array(h));
        for (var d = r; n.checkFramebufferStatus(n.FRAMEBUFFER, i) !== n.FRAMEBUFFER_COMPLETE; )
            ;
        n.flush(),
        n.finish(),
        n.readPixels(0, 0, o, u, n.RGBA, n.UNSIGNED_BYTE, d);
        var p = s.getImageData(0, 0, o, u);
        return p.data.set(d),
        s.putImageData(p, 0, 0),
        a
    }
      , f = function(t, e, i, r) {
        var a = e.width
          , o = e.height
          , u = i;
        u || (u = a);
        var l = 1 / (a / o);
        r && (l = r);
        var c = [u, Math.floor(u * l)]
          , d = p(t, e)
          , f = h;
        f.width === c[0] && f.height === c[1] || (f.width = c[0],
        f.height = c[1]);
        var g = 1 / (a / o)
          , m = l
          , v = f.getContext("2d")
          , _ = 0
          , b = 0
          , x = a
          , A = o;
        if (g < m) {
            var y = A / m;
            _ = (x - y) / 2,
            x = y
        } else if (g > m) {
            var S = x * m;
            b = (A - S) / 2,
            A = S
        }
        return v.clearRect(0, 0, c[0], c[1]),
        v.fillStyle = "transparent",
        v.fillRect(0, 0, c[0], c[1]),
        v.save(),
        v.scale(1, -1),
        v.drawImage(d, _, b, x, A, 0, -c[1], c[0], c[1]),
        v.restore(),
        s().downloadPicture && (n || (n = document.createElement("a"),
        document.body.appendChild(n),
        n.style.display = "none"),
        n.href = f.toDataURL("image/jpeg"),
        n.download = "image.jpg",
        n.click()),
        f
    }
      , g = !1
      , m = function(t, e, i) {
        g && l.warn("Screenshot already processing"),
        g = !0;
        var n, r, a, s, u, c, h, p, m, v, _ = i.getCanvas(), b = i.getSuperSample(), x = i.getViewerOSGJS(), A = i.getFeatures(), y = A.orientation, S = A.webVR, C = A.outline, M = A.lighting, w = A.hotspot, T = A.animation, E = i.getFeaturesManager().getNodeGizmo(), I = !1;
        d && T && (I = T.getModel().get("playing"),
        T.getModel().set("playing", !1));
        var k, F = i.getOptions().widgetAPI;
        F && (M && M.getModel().get("enable") && (r = M.getNodeLight(),
        c = r.getNodeMask(),
        r.setNodeMask(0),
        k = !0),
        E && E.getNodeMask() && (p = E.getNodeMask(),
        E.setNodeMask(0),
        k = !0),
        C && (a = C.getNode(),
        a.hideOutline()),
        y && (n = y.getNodeGrid(),
        n && n.isVisible() && (h = n.getNodeMask(),
        n.setNodeMask(0),
        k = !0))),
        w && (u = w.getNodeProxy(),
        u.getNodeMask() && (v = u.getNodeMask(),
        u.setNodeMask(0),
        k = !0)),
        S && (s = S.getNodeProxy(),
        s.getNodeMask() && (m = s.getNodeMask(),
        s.setNodeMask(0),
        k = !0));
        var D, N = b && b.canBeEnabled() ? b.getSampleCount() : 1;
        if (x.getCamera().setFinalDrawCallback(function(i) {
            N--,
            b && b.isEnabled() || (D = f(i, _, t, e),
            x.getCamera().setFinalDrawCallback(void 0),
            o.setPoseForScreenshot(!1),
            g = !1,
            I && T.getModel().set("playing", !0),
            k && (c && r.setNodeMask(c),
            h && n.setNodeMask(h),
            p && E.setNodeMask(p),
            m && s.setNodeMask(m),
            v && u.setNodeMask(v),
            o.draw()))
        }),
        o.setPoseForScreenshot(!0),
        N > 1 && b.forceEnable(),
        x.getCamera()) {
            var R = x.getCamera().getRenderer()
              , P = x.getScene()
              , L = x.getUpdateVisitor();
            if (P.updateSceneGraph(L),
            k && (c && r.setNodeMask(0),
            h && n.setNodeMask(0),
            p && E.setNodeMask(0),
            m && s.setNodeMask(0),
            v && u.setNodeMask(0)),
            R.cull(),
            R.draw(),
            N > 0)
                for (; b.isEnabled(); )
                    b.updateFrame(),
                    P.updateSceneGraph(L),
                    k && (c && r.setNodeMask(0),
                    h && n.setNodeMask(0),
                    p && E.setNodeMask(0),
                    m && s.setNodeMask(0),
                    v && u.setNodeMask(0)),
                    R.cull(),
                    R.draw()
        }
        return D
    };
    t.exports = m
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1465)
      , a = i(1486)
      , s = n.osg
      , o = [[.263385, -.0252475], [-.38545, .054485], [-.139795, -.5379925], [-.2793775, .6875475], [.7139025, .4710925], [.90044, -.16422], [.4481775, -.82799], [-.9253375, -.2910625], [.3468025, 1.02292], [-1.13742, .33522], [-.7676225, -.9123175], [-.2005775, -1.1774125], [-.926525, .96876], [1.12909, -.7500325], [.9603, 1.14625]]
      , u = function(t) {
        return u.instance ? u.instance : (this._canBeEnabled = !0,
        this._viewer = t,
        this._sampleCount = 15,
        this._isSupersampling = !1,
        this._frameNum = 1,
        this._switch = !0,
        u.instance = this,
        this)
    };
    u.prototype = {
        getSampleCount: function() {
            return this._sampleCount
        },
        setCanBeEnabled: function(t) {
            this._canBeEnabled = t
        },
        canBeEnabled: function() {
            return r().supersample && this._canBeEnabled
        },
        getOrCreateJitterUniform: function() {
            return this._jitterUniform ? this._jitterUniform : (this._jitterUniform = s.Uniform.createFloat4("uHalton"),
            this._jitter = this._jitterUniform.getInternalArray(),
            this._jitter[2] = 1,
            this._jitterUniform)
        },
        getSortedJitterTable: function() {
            return o
        },
        updateUniforms: function() {
            var t = this.getSortedJitterTable()[this._frameNum - 1];
            this._jitter[0] = t[0],
            this._jitter[1] = t[1]
        },
        setSwitch: function(t) {
            this._switch = t
        },
        updateFrame: function() {
            return this._jitter[2] = -this._jitter[2],
            this._postProcess.getModel().trigger("pingPongTexture0", this._jitter[2] > 0),
            !!this._isSupersampling && (this._jitter[3] = this._frameNum,
            this.updateUniforms(),
            this._frameNum++,
            this.isSupersampled() && (this._isSupersampling = !1),
            this._isSupersampling)
        },
        update: function(t, e) {
            if (this._switch) {
                var i = e.getFrameStamp().getFrameNumber();
                this._lastUpdateFrame !== i && (this._lastUpdateFrame = i,
                (this._postProcess || (this._postProcess = this._viewer.getFeatures().postProcess,
                this._postProcess)) && this.updateFrame() && a.drawSameFrame())
            }
        },
        isSupersampled: function() {
            return this._frameNum > this._sampleCount
        },
        isEnabled: function() {
            return this._isSupersampling
        },
        forceEnable: function() {
            this._isSupersampling = !0,
            this._jitter[0] = 0,
            this._jitter[1] = 0,
            this._jitter[2] = 2 * Math.sign(this._jitter[2]),
            this._jitter[3] = 0,
            this._frameNum = 1,
            a.drawSameFrame()
        },
        enable: function() {
            this.canBeEnabled() && 1 === this._frameNum && this.forceEnable()
        },
        reset: function() {
            this._jitter[0] = 0,
            this._jitter[1] = 0,
            this._jitter[2] = Math.sign(this._jitter[2]),
            this._frameNum = 1,
            this._isSupersampling = !1
        },
        setRoot: function(t) {
            var e = t.getOrCreateStateSet();
            e.addUniform(this.getOrCreateJitterUniform());
            var i = new s.Node("supersampleUpdateInterceptor");
            t.addChild(i),
            i.addUpdateCallback(this)
        }
    },
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(216)
      , a = i(1830)
      , s = n.osg
      , o = function(t, e) {
        var i = []
          , n = {}
          , a = 0
          , s = function(t, r) {
            if (!n[r]) {
                n[r] = r;
                var s = "https://media.sketchfab.com/urls/" + e + "/" + r
                  , o = {
                    uid: r,
                    name: r,
                    images: [{
                        url: s,
                        uid: r,
                        width: 4096,
                        height: 4096
                    }]
                };
                t.uid = n[r],
                delete t.image,
                delete t.url,
                i.push(o),
                a++
            }
            t.uid = n[r],
            delete t.image,
            delete t.url
        };
        r.each(t, function(t) {
            r.each(t.channels, function(t) {
                if (t.texture) {
                    var e = t.texture.url || t.texture.image;
                    !e && t.texture.uid && (e = t.texture.uid),
                    e && s(t.texture, e)
                }
            })
        }),
        window.prefetchedData["/i/models/" + e + "/textures"] = {
            results: i
        }
    }
      , u = function(t, e, i) {
        return Math.max(e, Math.min(i, t))
    }
      , l = function(t) {
        for (var e = Object.keys(t), i = 0, n = e.length; i < n; ++i) {
            var r = e[i]
              , s = t[r];
            "object" == typeof s ? void 0 === s.stateSetID ? delete t[s.id] : a(s) : delete t[r]
        }
    }
      , c = function(t, e) {
        if (t.orientation.axis) {
            var i = t.orientation.axis;
            i = s.Vec3.createAndSet(u(i[0], 0, 3), u(i[1], 0, 3), u(i[2], 0, 3)),
            delete t.orientation.axis;
            var n = (4 - i[0]) % 4
              , a = (4 - i[1]) % 4
              , o = (4 - i[2]) % 4;
            t.orientation.matrix = s.Matrix.makeRotate(.5 * Math.PI * (n + a + o), n, a, o, s.Matrix.create())
        }
        switch (t.shading.renderer || (t.shading.renderer = "pbr" === t.shading.type ? "pbr" : "classic"),
        t.shading.type) {
        case "lit":
        case "matcap":
        case "shadeless":
        case "pbr":
            break;
        case "blending":
        case "default":
        case "default-shading":
        case "predefined-shading":
        case "shading":
        case void 0:
            t.shading.type = "lit";
            break;
        default:
        case "no-shading":
            t.shading.type = "shadeless"
        }
        t.shading.vertexColor || "pbr" !== t.shading.renderer || (t.shading.vertexColor = {
            enable: !1,
            colorSpace: "linear"
        });
        var c = t.environment;
        void 0 !== c.exposure && (c.exposure *= void 0 !== c.light && c.light > 0 ? c.light : 1);
        var h = t.environment.backgroundEnable;
        if (void 0 !== h && t.environment.enable === !0 ? h === !0 ? t.background.enable = "environment" : t.background.enable = t.background.enable === !0 ? "fixed" : "none" : void 0 !== t.background.enable && (t.background.enable === !0 ? t.background.enable = "fixed" : t.background.enable === !1 && (t.background.enable = "none")),
        l(t.materials),
        t.lighting.lights)
            for (var d = t.lighting.lights, p = 0, f = d.length; p < f; ++p) {
                var g = d[p];
                g.hardness = Math.max(Math.min(g.hardness, 1), 0)
            }
        else
            t.lighting = {};
        return e ? t : r.cloneDeepWith(t, function(t) {
            if (t.byteLength)
                return Array.prototype.slice.call(t)
        })
    }
      , h = function(t) {
        var e = t.toJSON();
        void 0 === t.get("vertexCount") && t.set("vertexCount", e.nbVertexes),
        void 0 === t.get("faceCount") && t.set("faceCount", e.nbTriangles),
        void 0 === e.options && (e.options = {}),
        t.set("options", c(e.options, !0)),
        t.set("files", e.files);
        var i = !0;
        if (r.isEmpty(t.get("options").materials) && (i = !1),
        i === !0) {
            var n = window.prefetchedData["/i/models/" + t.get("uid") + "/textures"];
            n && n.results && n.results.length > 0 && (i = !1)
        }
        return i === !0 && o(e.options.materials, t.get("uid")),
        t
    };
    h.readOptions = c,
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(216)
      , a = n.osg
      , s = function(t, e) {
        return t - e
    }
      , o = r.invert(a.Texture)
      , u = ["magFilter", "minFilter", "wrapS", "wrapT", "textureTarget", "internalFormat"]
      , l = function(t) {
        t.image && (t.url = t.image,
        delete t.image);
        for (var e = 0, i = u.length; e < i; ++e) {
            var n = u[e];
            "number" == typeof t[n] && (t[n] = o[t[n]])
        }
        void 0 === t.texCoordUnit ? t.texCoordUnit = 0 : "string" == typeof t.texCoordUnit && (t.texCoordUnit = parseInt(t.texCoordUnit, 10)),
        t.format && delete t.format
    }
      , c = function(t) {
        return Math.max(0, Math.min(1, t))
    }
      , h = function(t, e, i) {
        if (void 0 !== t.factor) {
            var n = 0
              , r = 1;
            i <= 2 && ("Opacity" === e ? "alphaMask" === t.type ? n = .01 : "alphaBlend" === t.type && t.factor >= .99 && (t.factor = 1) : t.factor < .01 && (t.factor = 0)),
            "BumpMap" === e || "EmitColor" === e ? r = 10 : "SpecularHardness" === e ? r = 1e4 : "Displacement" === e && (r = 1e15),
            t.factor = Math.max(n, Math.min(r, t.factor))
        }
        if (t.color) {
            var s = t.color;
            t.color = a.Vec3.createAndSet(c(s[0]), c(s[1]), c(s[2]))
        }
        void 0 === t.enable && (t.enable = !0);
        var o = t.texture;
        if (o) {
            l(o);
            var u = o.internalFormat;
            if (u)
                switch (e) {
                case "NormalMap":
                case "SpecularPBR":
                    o.internalFormat = "RGB";
                    break;
                case "DiffuseColor":
                case "DiffuseIntensity":
                case "SpecularColor":
                case "EmitColor":
                case "DiffusePBR":
                case "AlbedoPBR":
                    "RGBA" === u && (o.internalFormat = "RGB");
                    break;
                case "Displacement":
                case "SpecularHardness":
                case "BumpMap":
                case "GlossinessPBR":
                case "RoughnessPBR":
                case "MetalnessPBR":
                case "SpecularF0":
                case "AOPBR":
                case "CavityPBR":
                    o.internalFormat = "LUMINANCE";
                    break;
                default:
                case "Opacity":
                    "RGBA" === u ? o.internalFormat = "ALPHA" : "RGB" === u && (o.internalFormat = "LUMINANCE")
                }
        }
    }
      , d = function(t) {
        var e = t.channels;
        e.Geometry && (e.NormalMap = e.Geometry,
        delete e.Geometry),
        e.Reflection && (void 0 === t.reflection && (t.reflection = e.Reflection.factor),
        delete e.Reflection),
        t.cullFace || t.cullFaceMode && (t.cullFace = t.cullFaceMode,
        delete t.cullFaceMode),
        t.depthCheckMode && (e.Opacity && !e.Opacity.type && (e.Opacity.type = "alphaBlend"),
        delete t.depthCheckMode),
        void 0 === t.texCoordUnitList ? t.texCoordUnitList = [] : void 0 === t.texCoordUnitList.length && (t.texCoordUnitList = r.map(t.texCoordUnitList, function(t, e) {
            return parseInt(e, 10)
        })),
        t.texCoordUnitList.sort(s);
        var i = t.version || 0;
        if (e)
            for (var n = Object.keys(e), a = 0, o = n.length; a < o; ++a) {
                var u = n[a];
                h(e[u], u, i)
            }
    };
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(220)
      , r = i(216)
      , a = i(1198)
      , s = i(283)
      , o = i(1191)
      , u = i(1521)
      , l = i(1482)
      , c = i(1624)
      , h = i(1197)
      , d = i(1832)
      , p = i(1833)
      , f = i(1514)
      , g = i(1516)
      , m = i(1465)
      , v = i(1466)
      , _ = i(1467)
      , b = a.osg
      , x = a.osgUtil
      , A = function(t, e) {
        this._viewerWebGL = t,
        this._viewerOSGJS = t.getViewerOSGJS(),
        this._urlOptions = t.options,
        this._features = t.getFeatures(),
        this._context = e,
        this._canvas = t.getCanvas(),
        this._nodeGizmo = null,
        this._mouseKeyboard = this._viewerOSGJS.getEventProxy().StandardMouseKeyboard;
        var i = this.onPointerUp.bind(this);
        window.addEventListener("touchend", i),
        window.addEventListener("touchcancel", i),
        window.addEventListener("mouseup", i),
        window.addEventListener("mouseout", i)
    };
    A.prototype = {
        getFeatures: function() {
            return this._features
        },
        getCanvas: function() {
            return this._canvas
        },
        getViewerWebGL: function() {
            return this._viewerWebGL
        },
        getViewerOSGJS: function() {
            return this._viewerOSGJS
        },
        getResourceManager: function() {
            return this._resourceManager || h.instance
        },
        onPointerUp: function() {
            this._mouseKeyboard.setEnable(!0)
        },
        focusOnTargetAndEye: function() {
            var t = b.Vec3.create();
            return function(e, i, n, r) {
                var a = this._viewerOSGJS.getManipulator();
                if (!n || n < 0)
                    return e && a.setTarget(e),
                    void (i && a.setEyePosition(i));
                var s = this._features.cameraAnimation.getModel();
                e || (e = a.getTarget(t)),
                i || (i = a.getEyePosition(t)),
                s.setTargetAndEye(e, i, r),
                s.set("duration", n)
            }
        }(),
        focusOnHomePosition: function(t) {
            var e = this._features
              , i = e.manipulator
              , n = e.cameraAnimation;
            if (i && i.getModel() && n) {
                var r = i.getManipulator().getCurrentManipulator()
                  , a = r.getHomeBound()
                  , s = a.center()
                  , o = r.getEyePosition(b.Vec3.create());
                b.Vec3.sub(s, o, o),
                b.Vec3.normalize(o, o),
                b.Vec3.mult(o, r.getHomeDistance(a), o),
                b.Vec3.sub(s, o, o),
                this.focusOnTargetAndEye(s, o, t)
            }
        },
        focusOnSavedCamera: function(t) {
            var e = this._context.getModel().get("options")
              , i = m()
              , n = this._viewerOSGJS.getManipulator()
              , r = i.cameraTarget || e.camera.target
              , a = i.cameraEye || e.camera.position
              , s = a && null !== a[0];
            return s ? s && !this._features.manipulator.getModel().validateEyeTarget(a, r) ? n.computeHomePosition() : void this.focusOnTargetAndEye(r, a, t) : n.computeHomePosition()
        },
        setInitialAnimation: function() {
            var t = this._features.cameraAnimation;
            if (t) {
                var e = m().camera;
                if (void 0 !== e && e === !1)
                    return void l.resolveFirstCameraAnimation();
                var i = 2.5
                  , n = b.Vec3.create()
                  , r = b.Vec3.create()
                  , a = this._viewerOSGJS.getManipulator();
                a.getEyePosition(r),
                a.getTarget(n);
                var s = [n[0] - r[0], n[1] - r[1], 0]
                  , o = s[0] > s[1] ? 0 : 1
                  , u = 0 === o ? 1 : 0
                  , c = b.Vec3.create();
                c[u] = 1;
                var h = s[o] < 0 ? -1 : 1;
                c[2] = .2 * h;
                var d = 1.5 * a.getNode().getMinimumBound().radius();
                b.Vec3.mult(c, 10 * d * h, c);
                var p = b.Vec3.add(r, c, b.Vec3.create());
                a.setEyePosition(p),
                this.focusOnTargetAndEye(n, r, i);
                var f = this._features.autospin;
                if (f) {
                    var g = f.getModel();
                    g.set("speed", -g.get("speed") * h)
                }
            }
        },
        linkAutospinWithEvents: function() {
            var t = this._features
              , e = t.autospin
              , i = t.manipulator
              , n = i ? i.getModel() : void 0
              , r = e.getModel()
              , a = 12500
              , s = 0
              , o = function() {
                clearTimeout(s),
                r.set("paused", !0)
            }
              , l = function() {
                var t = void 0 === n || n.get("indexManipulator") === u.ORBIT;
                t === !0 && (s = setTimeout(function() {
                    r.set("paused", !1)
                }, a))
            }
              , c = this._canvas;
            if (c.addEventListener("mousedown", o),
            c.addEventListener("touchstart", o),
            c.addEventListener("dragstart", o),
            c.addEventListener("mouseup", l),
            c.addEventListener("mouseout", l),
            c.addEventListener("touchend", l),
            c.addEventListener("touchcancel", l),
            c.addEventListener("touchleave", l),
            c.addEventListener("dragend", l),
            i) {
                var h = function() {
                    clearTimeout(s),
                    r.set("paused", n.get("indexManipulator") !== u.ORBIT)
                };
                n.bind("change:indexManipulator", h),
                h()
            }
        },
        linkSelectMaterialUI: function(t) {
            var e = this._features
              , i = e.materialUI
              , n = e.cameraAnimation
              , r = e.outline;
            if (i) {
                var a = function(t) {
                    b.NodeVisitor.call(this),
                    this._stateSet = t,
                    this._pushIfGeo = !1,
                    this._paths = []
                };
                a.prototype = b.objectInherit(b.NodeVisitor.prototype, {
                    apply: function(t) {
                        var e = t.getStateSet()
                          , i = this._pushIfGeo;
                        e && void 0 !== e._materialID && (this._pushIfGeo = e === this._stateSet),
                        t instanceof b.Geometry && this._pushIfGeo && this._paths.push(this.nodePath.slice(0)),
                        this.traverse(t),
                        this._pushIfGeo = i
                    }
                });
                var s = function(e) {
                    var i = new a(e);
                    t.accept(i);
                    var s = i._paths;
                    if (0 === s.length)
                        return void b.error("Cound not find nodes attached to the stateset.");
                    for (var o = t.getParents()[0].getWorldMatrices()[0], u = b.Vec3.create(), l = b.Vec3.create(), c = 0, h = s.length; c < h; ++c) {
                        var d = s[c]
                          , p = d[d.length - 1].getMinimumBound().center();
                        b.Matrix.transformVec3(b.computeLocalToWorld(d), p, l),
                        b.Matrix.transformVec3(o, l, l),
                        b.Vec3.add(l, u, u)
                    }
                    if (b.Vec3.mult(u, 1 / h, u),
                    n && this.focusOnTargetAndEye(u, void 0, 2),
                    r) {
                        var f = r.getNode();
                        f.setScene(s),
                        f.showOutline()
                    }
                }
                .bind(this);
                i.getModel().bind("displayOutline", s)
            }
        },
        initEventsOnClick: function() {
            var t = new s.Manager(this.getCanvas());
            t.add(new s.Tap({
                event: "doubletap",
                pointers: 1,
                taps: 2,
                time: 250,
                interval: 450,
                threshold: 5,
                posThreshold: 50
            })),
            t.add(new s.Tap({
                event: "doubletap2fingers",
                pointers: 2,
                taps: 2,
                time: 250,
                interval: 450,
                threshold: 5,
                posThreshold: 50
            })),
            t.add(new s.Tap({
                event: "singletap",
                pointers: 1,
                taps: 1,
                time: 250,
                interval: 450,
                threshold: 5,
                posThreshold: 20
            })),
            t.on("doubletap", this.onDoubleClick.bind(this)),
            t.on("doubletap2fingers", this.onDoubleClick.bind(this)),
            t.on("singletap", this.onSingleClick.bind(this))
        },
        focusAutoOnHit: function(t, e) {
            var i = b.Vec3.create();
            this.getWorldPositionFromHit(t, i);
            var n = this._features.cameraAnimation.getModel()
              , r = this._features.manipulator.getManipulator().getCurrentManipulator()
              , a = r.getEyePosition(b.Vec3.create());
            if (1 === m().cameraFollowBones) {
                var s = b.Vec3.create();
                b.Vec3.sub(i, r.getTarget(s), s),
                b.Vec3.add(a, s, a)
            } else {
                var o = b.Vec3.distance(a, r.getTarget(b.Vec3.create()));
                b.Vec3.sub(i, a, a),
                b.Vec3.normalize(a, a),
                b.Vec3.mult(a, o, a),
                b.Vec3.sub(i, a, a)
            }
            n.setTargetAndEye(i, a),
            n.set("duration", e)
        },
        focusOnHit: function(t, e, i) {
            var n = b.Vec3.create();
            this.getWorldPositionFromHit(t, n);
            var r = this._features.cameraAnimation.getModel()
              , a = this._features.manipulator.getManipulator().getCurrentManipulator()
              , s = a.getEyePosition(b.Vec3.create())
              , o = a.getHomeDistance(a.getHomeBound())
              , u = b.Vec3.distance(s, n)
              , l = i * o;
            u > l && (b.Vec3.sub(n, s, s),
            b.Vec3.normalize(s, s),
            b.Vec3.mult(s, l, s),
            b.Vec3.sub(n, s, s)),
            r.setTargetAndEye(n, s, !0),
            r.set("duration", e)
        },
        onSingleClick: function() {
            var t = b.Vec3.create()
              , e = b.Vec2.create();
            return function(i) {
                var r = this._features.postProcess
                  , a = r ? r.getModel() : void 0
                  , s = a && a.get("enable") && a.get("dofEnable")
                  , o = this._viewerWebGL.getViewerAPI();
                if (o || s) {
                    var u = i.center.x - n(i.target).offset().left + (window.scrollX || 0)
                      , l = i.center.y - n(i.target).offset().top + (window.scrollY || 0)
                      , c = this.computeNearestIntersection2D(u, l);
                    if (c) {
                        var h = s ? a.get("dofFocusPoint") : t;
                        this.getWorldPositionFromHit(c, h),
                        o && o.intersectPoint && (e[0] = u,
                        e[1] = l,
                        o.intersectPoint(c, h, e)),
                        s && a.trigger("change:dofFocusPoint", h)
                    }
                }
            }
        }(),
        onDoubleClick: function(t) {
            var e = this._features.manipulator;
            if (!e || !e.getModel().get("webVR")) {
                if (this._focusTimer && window.clearInterval(this._focusTimer),
                t.pointers.length > 1)
                    return void this.focusOnHomePosition(1);
                var i = t.center.x - n(t.target).offset().left + (window.scrollX || 0)
                  , r = t.center.y - n(t.target).offset().top + (window.scrollY || 0)
                  , a = this.computeNearestIntersection2D(i, r);
                if (!a)
                    return void this.focusOnHomePosition(1);
                if (this._urlOptions.widgetAPI) {
                    var s = this._urlOptions.widgetAPI.getTabbedWidget().get();
                    if ("vr" === s)
                        return void this._features.webVR.getModel().trigger("doubleTap", a);
                    if ("materials" === s) {
                        var o = this._features.material.getModel()
                          , u = o.findFirstMaterial(a.nodepath);
                        if (!u)
                            return;
                        var l = u.get("id");
                        return void (o.uiModel.get("material") === l ? o.trigger("displayOutline", u.get("stateSet")) : o.uiModel.set("material", l))
                    }
                    if ("annotations" === s)
                        return
                }
                m().cameraFollowBones && c(a.nodepath) ? this._focusTimer = window.setInterval(this.focusAutoOnHit.bind(this, a, 0), 16.6) : this.focusOnHit(a, 1, .2)
            }
        },
        canvasCoordToGL: function(t, e, i) {
            var n = this._canvas
              , r = i || b.Vec2.create()
              , a = this._viewerOSGJS.getCanvasPixelRatio();
            return r[0] = t * a,
            r[1] = (n.clientHeight - e) * (this._viewerOSGJS.getCanvasHeight() / n.clientHeight),
            r
        },
        glCoordToCanvas: function(t, e, i) {
            var n = this._canvas
              , r = i || b.Vec2.create()
              , a = this._viewerOSGJS.getCanvasPixelRatio();
            return r[0] = t / a,
            r[1] = n.clientHeight - e / a,
            r
        },
        computeIntersections3D: function() {
            var t = new x.IntersectionVisitor
              , e = new x.LineSegmentIntersector;
            return t.setIntersector(e),
            function(i, n, r, a) {
                return a || (a = this._features.webVR.getNode()),
                t.reset(),
                e.reset(),
                t.setTraversalMask(void 0 !== r ? r : f.PICK_GEOMETRY_SLOW),
                e.set(i, n),
                a.accept(t),
                e.getIntersections()
            }
        }(),
        computeNearestIntersection3D: function(t, e, i, n) {
            var r = this.computeIntersections3D(t, e, i, n);
            return this.sortIntersections(r)
        },
        computeNearestIntersection3DHotspotFirst: function(t, e, i, n) {
            var r = this.computeIntersections3D(t, e, i, n);
            if (0 !== r.length) {
                r.sort(function(t, e) {
                    return t.ratio - e.ratio
                });
                var a = 0
                  , s = r.length
                  , o = this._features.hotspot.getNodeProxy();
                for (a = 0; a < s; ++a)
                    if (r[a].nodepath.indexOf(o) !== -1)
                        return r[a];
                return this.getFirstVisibleHit(r)
            }
        },
        computeIntersections2D: function() {
            var t = b.Vec3.create()
              , e = b.Vec3.create()
              , i = b.Matrix.create();
            return function(n, r, a, s) {
                return s || (s = this._features.webVR.getNode()),
                this.canvasCoordToGL(n, r, t),
                this.canvasCoordToGL(n, r, e),
                t[2] = 0,
                e[2] = 1,
                this.getWorldPositionFromScreenPoint(t, t),
                this.getWorldPositionFromScreenPoint(e, e),
                s.getWorldMatrix(void 0, i),
                b.Matrix.inverse(i, i),
                b.Matrix.transformVec3(i, t, t),
                b.Matrix.transformVec3(i, e, e),
                this.computeIntersections3D(t, e, a, s)
            }
        }(),
        computeNearestIntersection2D: function(t, e, i, n) {
            var r = this.computeIntersections2D(t, e, i, n);
            return this.sortIntersections(r)
        },
        sortIntersections: function(t) {
            if (0 !== t.length)
                return t.sort(function(t, e) {
                    return t.ratio - e.ratio
                }),
                this.getFirstVisibleHit(t)
        },
        getFirstVisibleHit: function(t) {
            for (var e = this._features.material.getModel(), i = 0, n = t.length; i < n; ++i) {
                var r = t[i];
                if (!r.backface)
                    return r;
                var s = e.findFirstMaterial(r.nodepath);
                if (s && s.get("cullFace") === a.osg.CullFace.DISABLE)
                    return r
            }
        },
        getRelativePositionFromHit: function(t, e, i, n) {
            for (var r = t.nodepath, a = !1, s = 0, o = r.length; s < o; ++s)
                if (r[s] === n) {
                    r = r.slice(s),
                    a = !0;
                    break
                }
            var u = b.Matrix.create();
            return a === !1 && r[0].getWorldMatrix(n, u),
            b.computeLocalToWorld(r, !0, u),
            b.Matrix.transformVec3(u, t.point, e),
            i && (u[12] = u[13] = u[14] = 0,
            b.Matrix.inverse(u, u),
            b.Matrix.transpose(u, u),
            b.Matrix.transformVec3(u, t.TriangleIntersection.normal, i),
            b.Vec3.normalize(i, i)),
            e
        },
        getWorldPositionFromHit: function(t, e, i) {
            return this.getRelativePositionFromHit(t, e, i, this._viewerOSGJS.getSceneData())
        },
        getScenePositionFromHit: function(t, e, i) {
            return this.getRelativePositionFromHit(t, e, i, this._context.getScene().getRoot())
        },
        getWorldPositionFromScenePoint: function(t, e) {
            var i = e || b.Vec3.create()
              , n = this._features.orientation
              , r = this._features.autospin;
            return n && b.Matrix.transformVec3(n.getNode().getMatrix(), t, i),
            r && b.Matrix.transformVec3(r.getNode().getMatrix(), i, i),
            i
        },
        getScenePositionFromWorldPoint: function() {
            var t = b.Matrix.create();
            return function(e, i) {
                var n = i || b.Vec3.create()
                  , r = this._features.orientation
                  , a = this._features.autospin;
                return b.Matrix.makeIdentity(t),
                r && b.Matrix.preMult(t, r.getNode().getMatrix()),
                a && b.Matrix.preMult(t, a.getNode().getMatrix()),
                b.Matrix.inverse(t, t),
                b.Matrix.transformVec3(t, e, n)
            }
        }(),
        getScreenPositionFromScenePoint: function(t, e) {
            var i = this.getWorldPositionFromScenePoint(t, e);
            return this.getScreenPositionFromWorldPoint(i, i)
        },
        getScreenPositionFromWorldPoint: function() {
            var t = b.Matrix.create();
            return function(e, i) {
                var n = this._viewerOSGJS.getCamera();
                b.Matrix.makeIdentity(t),
                n.getViewport() && n.getViewport().computeWindowMatrix(t),
                b.Matrix.preMult(t, n.getProjectionMatrix()),
                b.Matrix.preMult(t, n.getViewMatrix());
                var r = i || b.Vec3.create();
                return b.Matrix.transformVec3(t, e, r)
            }
        }(),
        getWorldPositionFromScreenPoint: function() {
            var t = b.Matrix.create();
            return function(e, i) {
                var n = this._viewerOSGJS.getCamera();
                b.Matrix.makeIdentity(t),
                n.getViewport() && n.getViewport().computeWindowMatrix(t),
                b.Matrix.preMult(t, n.getProjectionMatrix()),
                b.Matrix.preMult(t, n.getViewMatrix()),
                b.Matrix.inverse(t, t);
                var r = i || b.Vec3.create();
                return b.Matrix.transformVec3(t, e, r)
            }
        }(),
        getScenePositionFromScreenPoint: function(t, e) {
            var i = this.getWorldPositionFromScreenPoint(t, e);
            return this.getScenePositionFromWorldPoint(i, i)
        },
        computeKdTree: function(t) {
            var e = new b.KdTreeBuilder({
                _numVerticesProcessed: 0,
                _targetNumTrianglesPerLeaf: 50,
                _maxNumLevels: 20
            });
            e.apply(t)
        },
        preloadMaxBackground: function() {
            var t = this._features.background;
            if (t) {
                var e = t.getModel();
                if (e && "fixed" === e.get("enable")) {
                    var i = e.getBackground();
                    if (i) {
                        var n = i.findImageNearestUpToResolution(window.screen.width, window.screen.height);
                        n && this.getResourceManager().getOrCreateTexture(n.url, {
                            minFilter: b.Texture.LINEAR_MIPMAP_LINEAR,
                            magFilter: b.Texture.LINEAR,
                            transferToGPU: !1,
                            convertNPOT: !1
                        })
                    }
                }
            }
        },
        applyAutospinToCamera: function(t, e) {
            var i = this._features.autospin;
            if (i) {
                var n = i.getNode().getMatrix();
                b.Matrix.transformVec3(n, t, t),
                b.Matrix.transformVec3(n, e, e)
            }
        },
        getCameraWithoutAutospin: function() {
            var t = b.Matrix.create();
            return function(e, i) {
                var n = this._viewerOSGJS.getManipulator();
                n.getEyePosition(e),
                n.getTarget(i);
                var r = this._features.autospin;
                r && (b.Matrix.inverse(r.getNode().getMatrix(), t),
                b.Matrix.transformVec3(t, e, e),
                b.Matrix.transformVec3(t, i, i))
            }
        }(),
        createGizmoNode: function() {
            var t = new b.Camera;
            t.getOrCreateStateSet().setRenderBinDetails(g.EDITOR_GIZMO, "RenderBin");
            var e = this._nodeGizmo = new d(this._viewerOSGJS);
            e.setTraversalMask(f.PICK_GIZMO_LIGHT),
            t.addChild(e);
            var i = this._urlOptions.widgetAPI;
            if (i) {
                var n = this._features.orientation;
                i.getTabbedWidget().model.on("change:value", function() {
                    e.attachToGeometry(null),
                    n && n.getModel().set("showGizmo", !1)
                })
            }
            return t
        },
        setManipulatorNode: function(t) {
            this._features.manipulator ? this._features.manipulator.getModel().set("node", t) : this._viewerOSGJS.getManipulator().setNode(t)
        },
        getNodeGizmo: function() {
            return this._nodeGizmo
        },
        initGraph: function(t) {
            var e = this._features
              , i = new b.Node;
            i.getOrCreateStateSet().setAttributeAndModes(new b.CullFace(b.CullFace.DISABLE)),
            i.setName("FeatureManager - Root");
            var n = e.orientation
              , r = e.autospin
              , a = e.outline
              , s = e.cameraAnimation
              , o = e.shadingStyle
              , u = e.environment
              , l = e.lighting
              , c = e.hotspot
              , h = e.postProcess
              , d = e.webVR
              , p = l.getNodeShadow()
              , f = i;
            h && (i.addChild(h.getNodeIn()),
            f = h.getNodeOut()),
            f.addChild(this.createGizmoNode(f)),
            f.addChild(p),
            f = p;
            for (var g = [s, u, l, d, r, n, c, a, o], m = 0, v = g.length; m < v; ++m) {
                var _ = g[m];
                _ && (f.addChild(_.getNode()),
                f = _.getNode())
            }
            return f.addChild(t),
            i
        },
        finished: function(t) {
            var e = this._features
              , i = this._context.getScene().getRoot();
            i.setNodeMask(f.PICK_GEOMETRY_SHADOW),
            i.setName("rootModel");
            var n = this.initGraph(i);
            return t.addChild(n),
            this.setManipulatorNode(e.autospin.getNode()),
            this.preloadMaxBackground(),
            this.linkAutospinWithEvents(),
            this.linkSelectMaterialUI(i),
            e.lighting && e.lighting.getModel().initLights(e.material.getSceneLights()),
            e.environment && e.environment.getNode().init(this._viewerOSGJS.getCamera()),
            b.time("compute KdTree"),
            this.computeKdTree(i),
            b.timeEnd("compute KdTree"),
            this.focusOnSavedCamera(),
            this._features.manipulator && this._features.manipulator.getModel().saveCameraPosition(),
            this.initEventsOnClick(),
            b.time("drawFirstFrame"),
            this._viewerWebGL.drawFrame(),
            b.timeEnd("drawFirstFrame"),
            e.webVR && e.webVR.getModel().initWebVR(),
            e.lighting && e.lighting.getModel().set("forceShadowRedraw", !0),
            b.time("drawSecondFrame"),
            this._viewerWebGL.drawFrame(),
            b.timeEnd("drawSecondFrame"),
            this.setInitialAnimation(),
            e.lighting && e.lighting.getModel().set("forceShadowRedraw", !1),
            o() && (this.registerOptionsJSON(this._viewerWebGL.getOptionsJSON()),
            window.addEventListener("beforeunload", this.onBeforeUnload.bind(this), !1)),
            !_() && "onhashchange"in window && window.addEventListener("hashchange", this._hashChanged.bind(this), !1),
            m().debug3d && p(this, n),
            n
        },
        registerOptionsJSON: function(t) {
            this._lastOptions = r.cloneDeep(t)
        },
        onBeforeUnload: function(t) {
            var e = this._viewerWebGL.getOptionsJSON()
              , i = r.reduce(this._lastOptions, function(t, i, n) {
                return r.isEqual(i, e[n]) ? t : t.concat(n)
            }, []);
            if (0 !== i.length) {
                var n = "You have unsaved changes:\n";
                return n += "- " + i.join("\n- "),
                n += "\n\nYou might want to save your changes before leaving.",
                t.returnValue = n,
                n
            }
        },
        _hashChanged: function() {
            var t = {};
            t = v(t),
            this._features.material.getModel().overrideMaterialChannels(t);
            var e = m();
            !e.debug3d && Boolean(t.debug3d) && (e.debug3d = !0,
            p(this, this._context.getScene().getRoot())),
            !e.stats && Boolean(t.stats) && (e.continuousRender = !0,
            e.stats = !0,
            this._viewerOSGJS.initStats({
                getBoolean: function(t) {
                    return "stats" === t
                }
            }))
        }
    },
    t.exports = A
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1486)
      , a = n.osg
      , s = n.osgUtil
      , o = s.NodeGizmo
      , u = function() {
        o.apply(this, arguments),
        this._forcePicking = !1
    };
    u.prototype = a.objectInherit(o.prototype, {
        setForcePicking: function(t) {
            this._forcePicking = t
        },
        onMouseUp: function(t) {
            this._isEditing && r.draw();
            var e = this._attachedNode;
            o.prototype.onMouseUp.call(this, t),
            e !== this._attachedNode && r.draw(),
            this._forcePicking && !this._attachedNode && (this._attachedNode = e)
        },
        onMouseMove: function(t) {
            var e = this._hoverNode;
            o.prototype.onMouseMove.call(this, t),
            (this._isEditing || e !== this._hoverNode) && r.draw()
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(216)
      , r = i(220)
      , a = i(1198)
      , s = i(1482)
      , o = i(1832)
      , u = i(1486)
      , l = i(1516)
      , c = i(1496)
      , h = i(1497)
      , d = a.osg
      , p = a.osgAnimation
      , f = a.osgUtil
      , g = d.StateAttribute.OVERRIDE | d.StateAttribute.ON
      , m = function() {
        f.DisplayNormalVisitor.call(this),
        this._tangentStateSet.setRenderBinDetails(l.DEBUG, "RenderBin"),
        this._normalStateSet.setRenderBinDetails(l.DEBUG, "RenderBin")
    };
    m.prototype = d.objectInherit(f.DisplayNormalVisitor.prototype, {
        apply: function(t, e) {
            t instanceof d.Geometry && t.getCullCallback() || f.DisplayNormalVisitor.prototype.apply.call(this, t, e)
        }
    });
    var v = function(t) {
        d.NodeVisitor.call(this),
        this._cullCallback = t ? void 0 : c.hideCullCallback
    };
    v.prototype = d.objectInherit(d.NodeVisitor.prototype, {
        apply: function(t) {
            t instanceof d.Geometry && t._isBoneBox && t.setCullCallback(this._cullCallback),
            this.traverse(t)
        }
    });
    var _ = function() {
        var t = f.DisplayGeometryVisitor.prototype.apply;
        f.DisplayGeometryVisitor.prototype.apply = function(e) {
            if (!e._isBoneBox && !e._isSkeleton) {
                t.apply(this, arguments);
                var i = e._originalStateSet;
                void 0 !== i && e.getStateSet() && i !== e.getStateSet() && e.getStateSet().setRenderBinDetails(l.DEBUG, "RenderBin")
            }
        }
    }
      , b = function(t) {
        var e = n.invert(l);
        t._graphRender.generateRenderBin = function(t, i) {
            var n = i.className() + " ( " + i.getInstanceID() + " )";
            i.getName() && (n += "\n" + i.getName());
            var r = i.getBinNumber();
            n += "\n" + e[r] || r,
            this._selectables.set(i.getInstanceID().toString(), i),
            t.addNode(i.getInstanceID(), {
                label: n,
                description: "",
                style: "fill: " + this.getColorFromClassName(i.className()) + ";stroke-width: 0px;"
            })
        }
    }
      , x = function() {
        var t = p.UpdateMorph.prototype.updateWeights;
        p.UpdateMorph.prototype.updateWeights = function() {
            if (void 0 !== this._debugActiveTarget) {
                var e = parseInt(this._debugActiveTarget, 0);
                if (e === -2) {
                    var i = this._weights;
                    return void (i[0] = i[1] = i[2] = i[3] = 0)
                }
                if (e !== -1)
                    for (var n = this._targets, r = 0, a = n.length; r < a; ++r)
                        n[r].value = r === e ? 1 : 0
            }
            return t.call(this)
        }
    }
      , A = function(t, e) {
        var i = function() {
            d.NodeVisitor.call(this, d.NodeVisitor.TRAVERSE_ALL_CHILDREN)
        };
        i.prototype = d.objectInherit(d.NodeVisitor.prototype, {
            apply: function(e) {
                for (var i = e.getUpdateCallbackList(), n = 0, r = i.length; n < r; ++n) {
                    var a = i[n];
                    if (a instanceof p.UpdateMorph) {
                        var s = {};
                        s.___DEFAULT = -1,
                        s["___NO MORPH"] = -2;
                        for (var o = a._targetNames, l = 0, c = o.length; l < c; ++l)
                            s[o[l]] = l;
                        a._debugActiveTarget = -1;
                        var h = t.add(a, "_debugActiveTarget", s).name("Name " + a.getName());
                        h.onChange(u.draw)
                    }
                }
                this.traverse(e)
            }
        });
        var n = new i;
        e._rootModel.accept(n)
    }
      , y = function() {
        c.DrawBones.prototype.apply = function(t) {
            var e = t.getInstanceID();
            this._visitedNodes[e] || (this._visitedNodes[e] = !0,
            t instanceof p.Bone && this.drawBone(t),
            this.traverse(t))
        }
    }
      , S = function(t, e) {
        this._fManager = t,
        this._rootModel = t._context.getScene().getRoot(),
        this._rootFeature = e,
        this._debugNormal = !1,
        this._debugTangent = !1,
        this._debugScale = .5,
        this._baseScale = .07 * this._rootModel.getMinimumBound().radius(),
        this._normalVisitor = new m,
        this._normalVisitor.setScale(this._baseScale * this._debugScale),
        this._geoColorVisitor = new f.DisplayGeometryVisitor,
        this._geoColorVisitor._stCenter.setRenderBinDetails(l.DEBUG_2, "RenderBin"),
        _(),
        this._debugGeometry = !1,
        this._debugSkinning = !1,
        this._debugShadow = !1,
        this._useGizmo = !1,
        this._useSync = !1,
        this._protoUpdateWeights = p.UpdateMorph.prototype.updateWeights,
        this._protoComputeChannels = p.UpdateMatrixTransform.prototype.computeChannels,
        this._enableRig = !0,
        t.getViewerOSGJS().getState().getShaderGeneratorProxy().addShaderGenerator("skeleton", new h),
        this._drawBonesVisitor = new c.DrawBones([]),
        y(),
        this._showSkeleton = !1,
        this._showBoneBoxes = !1,
        this._graphVisitor = f.DisplayGraph.instance(),
        b(this._graphVisitor),
        this._debugGraphNode = "Model",
        this._debugGraphRenderer = !1,
        this._displayGraph = !1,
        this._cbPick = this.onPickSelect.bind(this),
        this._fManager.getCanvas().addEventListener("dblclick", this.onTrianglePick.bind(this))
    };
    S.prototype = {
        onTrianglePick: function(t) {
            if (!this._displayGraph) {
                var e = void 0 === t.offsetX ? t.layerX : t.offsetX
                  , i = void 0 === t.offsetY ? t.layerY : t.offsetY
                  , n = this._fManager.computeNearestIntersection2D(e, i);
                if (n) {
                    window.hit = n;
                    var r = n.nodepath[n.nodepath.length - 1]
                      , a = n.TriangleIntersection;
                    console.log("Active hit : window.hit"),
                    console.log("Name geometry : " + r.getName()),
                    console.log("Vertex indices : " + a.i1 + ", " + a.i2 + ", " + a.i3),
                    console.log("Unique id : " + r._uniqueID);
                    var s = {};
                    s[a.i1] = {},
                    s[a.i2] = {},
                    s[a.i3] = {};
                    for (var o = r.getVertexAttributeList(), u = Object.keys(o), l = Object.keys(s), c = 0, h = l.length; c < h; ++c) {
                        var d = l[c]
                          , p = s[d];
                        d = parseInt(d);
                        for (var f = 0, g = u.length; f < g; ++f)
                            for (var m = u[f], v = o[m], _ = v.getItemSize(), b = v.getElements(), x = p[m] = [], A = 0; A < _; ++A)
                                x[A] = b[d * _ + A]
                    }
                    n.verts = s,
                    console.log("\n")
                }
            }
        },
        onDebugScale: function(t) {
            this._normalVisitor.setScale(this._baseScale * t),
            u.draw()
        },
        testCreateNormalVisitor: function() {
            this._normalVisitor._alreadyRun || (this._normalVisitor._alreadyRun = !0,
            this._normalVisitor.apply(this._rootModel))
        },
        onDebugNormal: function(t) {
            this.testCreateNormalVisitor(),
            this._normalVisitor.setNormalVisibility(t),
            u.draw()
        },
        onDebugTangent: function(t) {
            this.testCreateNormalVisitor(),
            this._normalVisitor.setTangentVisibility(t),
            u.draw()
        },
        onDebugGeometry: function() {
            this._debugGeometry ? this._geoColorVisitor.setGeometryDebug(this._rootModel) : this._debugSkinning ? this._geoColorVisitor.setSkinningDebug(this._rootModel) : this._geoColorVisitor.disableDebug(this._rootModel),
            u.draw()
        },
        resetGraph: function() {
            this._fManager.getCanvas().removeEventListener("dblclick", this._cbPick),
            this._graphVisitor.reset()
        },
        onDisplayGraph: function() {
            this.resetGraph(),
            this._displayGraph && (this._fManager.getCanvas().addEventListener("dblclick", this._cbPick),
            s.getModelDisplayed().then(this.createDebugGraph.bind(this)))
        },
        createDebugGraph: function() {
            var t;
            "Model" === this._debugGraphNode ? t = this._rootModel : "Feature" === this._debugGraphNode && (t = this._rootFeature),
            this._graphVisitor.setDisplayGraphRenderer(this._debugGraphRenderer),
            this._graphVisitor.createGraph(t),
            this._graphVisitor.setCallbackSelect(this.onNodeSelect.bind(this)),
            u.draw()
        },
        onDebugShadow: function(t) {
            var e = this._fManager.getFeatures().lighting;
            if (e) {
                e.getModel().set("forceShadowRedraw", t);
                for (var i = e.getModel().get("lights"), n = 0, r = i.length; n < r; ++n) {
                    var a = i[n];
                    a.getShadowMap() && (a.getShadowMap().setDebug(t),
                    a.dirty())
                }
                u.draw()
            }
        },
        onPickSelect: function(t) {
            var e = void 0 === t.offsetX ? t.layerX : t.offsetX
              , i = void 0 === t.offsetY ? t.layerY : t.offsetY
              , n = this._fManager.computeNearestIntersection2D(e, i);
            if (n) {
                this._graphVisitor.selectNode(n.nodepath[n.nodepath.length - 1]);
                var r = this._fManager.getFeatures().outline.getNode();
                r.setScene([n.nodepath]),
                r.showOutline(),
                this._graphVisitor.focusOnGraph()
            }
        },
        onNodeSelect: function(t) {
            if (!t.getParents())
                return void this._fManager.getFeatures().materialUI.getModel().trigger("displayOutline", t);
            for (var e = [t]; t.getParents().length > 0; )
                e.unshift(t.getParents()[0]),
                t = t.getParents()[0];
            var i = d.Vec3.create()
              , n = this._rootModel.getParents()[0].getWorldMatrices()[0]
              , r = e[e.length - 1].getMinimumBound().center();
            d.Matrix.transformVec3(d.computeLocalToWorld(e), r, i),
            d.Matrix.transformVec3(n, i, i),
            this._fManager.focusOnTargetAndEye(i, void 0, 1);
            var a = this._fManager.getFeatures().outline.getNode();
            a.setScene([e]),
            a.showOutline()
        },
        pasteCamera: function() {
            var t = d.Vec3.create()
              , e = d.Vec3.create();
            this._fManager.getCameraWithoutAutospin(t, e),
            window.prompt("For marc : ", "camera_eye=" + t + "&camera_target=" + e)
        },
        onEnableRig: function(t) {
            t ? p.UpdateMatrixTransform.prototype.computeChannels = this._protoComputeChannels : p.UpdateMatrixTransform.prototype.computeChannels = function() {
                this._dirty = !0;
                var t = this._matrix;
                d.Matrix.makeIdentity(t);
                for (var e = this._stackedTransforms, i = 0, n = e.length; i < n; i++) {
                    var r = e[i];
                    r.resetToDefaultValue(),
                    r.applyToMatrix(t)
                }
            }
            ,
            u.draw()
        },
        onShowSkeleton: function(t) {
            u.draw();
            var e = this._drawBonesVisitor;
            return t ? (e._geoStateSet.setAttributeAndModes(new d.Depth(d.Depth.ALWAYS), g),
            void (e._alreadyRun || (e._alreadyRun = !0,
            this._rootModel.accept(e)))) : void e._geoStateSet.setAttributeAndModes(new d.Depth(d.Depth.NEVER), g)
        },
        onShowBoneBoxes: function(t) {
            this._rootModel.accept(new v(t)),
            u.draw()
        },
        onUseGizmo: function(t) {
            this._gizmo || (this._gizmo = new o(this._fManager.getViewerOSGJS()),
            this._rootFeature.addChild(this._gizmo)),
            this._gizmo.attachToGeometry(null),
            this._gizmo._autoInsertMT = t,
            this._gizmo.setTraversalMask(t ? 1 : 0),
            u.draw()
        }
    };
    var C = function(t, e, i) {
        var n = t.addFolder("Debug graph")
          , r = {
            Model: "Model",
            Feature: "Feature",
            None: "None"
        };
        return i._graphNode = n.add(e, "_debugGraphNode", r).name("Root"),
        i._graphNode.onChange(e.onDisplayGraph.bind(e)),
        i._graphRenderer = n.add(e, "_debugGraphRenderer").name("Renderer"),
        i._graphRenderer.onChange(e.onDisplayGraph.bind(e)),
        i._displayGraph = n.add(e, "_displayGraph").name("Display graph"),
        i._displayGraph.onChange(e.onDisplayGraph.bind(e)),
        n.open(),
        n
    }
      , M = function(t, e, i) {
        var n = t.addFolder("Display vectors");
        return i._showNormal = n.add(e, "_debugNormal").name("Display normal"),
        i._showNormal.onChange(e.onDebugNormal.bind(e)),
        i._showTangent = n.add(e, "_debugTangent").name("Display tangent"),
        i._showTangent.onChange(e.onDebugTangent.bind(e)),
        i._vectorScale = n.add(e, "_debugScale").min(0).max(2).name("Scale vectors"),
        i._vectorScale.onChange(e.onDebugScale.bind(e)),
        n.open(),
        n
    }
      , w = function(t, e, i) {
        var n = t.addFolder("Animation");
        return i._useRig = n.add(e, "_enableRig").name("Use rig"),
        i._useRig.onChange(e.onEnableRig.bind(e)),
        x(),
        A(n, e),
        i._showSkeleton = n.add(e, "_showSkeleton").name("Show skeleton"),
        i._showSkeleton.onChange(e.onShowSkeleton.bind(e)),
        i._showBoxes = n.add(e, "_showBoneBoxes").name("Show boxes"),
        i._showBoxes.onChange(e.onShowBoneBoxes.bind(e)),
        i._showSkinning = n.add(e, "_debugSkinning").name("Display skinning"),
        i._showSkinning.onChange(function(t) {
            t && e._debugGeometry && i._showGeometry.setValue(!1),
            e.onDebugGeometry()
        }),
        n.open(),
        n
    }
      , T = function(t, e, i) {
        var n = t.addFolder("Misc");
        i._showGeometry = n.add(e, "_debugGeometry").name("Display geometry"),
        i._showGeometry.onChange(function(t) {
            t && e._debugSkinning && i._showSkinning.setValue(!1),
            e.onDebugGeometry(),
            i._showSkinning.updateDisplay()
        }),
        i._gizmo = n.add(e, "_useGizmo").name("Use gizmo"),
        i._gizmo.onChange(e.onUseGizmo.bind(e)),
        i._pasteCamera = n.add(e, "pasteCamera").name("Paste camera");
        var r = t.add(e, "_debugShadow").name("Debug Shadow");
        return r.onChange(e.onDebugShadow.bind(e)),
        n.open(),
        n
    }
      , E = function(t) {
        var e = new window.dat.GUI;
        e.domElement.style.paddingTop = "50px";
        var i = new S(this,t)
          , n = {};
        C(e, i, n),
        M(e, i, n),
        w(e, i, n),
        T(e, i, n)
    }
      , I = function(t, e) {
        var i = E.bind(t, e);
        r.getScript("https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5/dat.gui.min.js").done(i)
    };
    t.exports = I
}
, function(t, e, i) {
    "use strict";
    var n = i(1498)
      , r = i(1510)
      , a = function() {
        n.apply(this, arguments),
        this.setShaderCompiler(r)
    };
    a.prototype = n.prototype,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1836)
      , a = i(1558)
      , s = n.osg
      , o = n.osgShadow
      , u = function() {
        o.ShadowCastShaderGenerator.apply(this, arguments),
        this.setShaderCompiler(r)
    };
    u.prototype = s.objectInherit(o.ShadowCastShaderGenerator.prototype, {
        filterAttributeTypes: function(t) {
            if ("osgSketchfab" === t.libraryName()) {
                if (t.getTypeID && t.getTypeID() === a.typeID) {
                    var e = t.getName();
                    if ("AlphaMask" === e || "Opacity" === e || "Displacement" === e)
                        return t.isEnabled && !t.isEnabled()
                }
                return !0
            }
            return o.ShadowCastShaderGenerator.prototype.filterAttributeTypes.call(this, t)
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1198)
      , r = i(1510)
      , a = n.osg
      , s = n.osgShadow
      , o = s.ShadowCastCompiler
      , u = function() {
        r.apply(this, arguments)
    };
    u.prototype = a.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "ShadowCastSkfb"
        },
        getFragmentShaderName: function() {
            return this.getCompilerName()
        },
        initAttributes: o.prototype.initAttributes,
        applyAlphaBlendMasking: function(t) {
            var e = this.getOrCreateTextureChannel("Opacity");
            return e ? (this.getNode("InlineCode").code("if(%alpha < 1.0) discard;").inputs({
                alpha: e
            }).outputs({
                out: t
            }),
            t) : t
        },
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.applyAlphaMask(t),
            this.applyAlphaBlendMasking(t),
            o.prototype.createShadowCastDepth.call(this, t),
            [t]
        }
    }),
    t.exports = u
}
]));
//# sourceMappingURL=viewer-cee7ac7e7d1deaa77e45.js.map
